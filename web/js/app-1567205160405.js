!function(e){function t(t){for(var i,s,o=t[0],l=t[1],u=t[2],c=0,h=[];c<o.length;c++)s=o[c],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(d&&d(t);h.length;)h.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=a[0]))}return e}var i={},n={1:0},r=[];function s(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[],a=n[e];if(0!==a)if(a)t.push(a[2]);else{var i=new Promise(function(t,i){a=n[e]=[t,i]});t.push(a[2]=i);var r,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+""+({2:"delayedUI",3:"dimport"}[e]||e)+"-1567205160405.js"}(e);var l=new Error;r=function(t){o.onerror=o.onload=null,clearTimeout(u);var a=n[e];if(0!==a){if(a){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",l.name="ChunkLoadError",l.type=i,l.request=r,a[1](l)}n[e]=void 0}};var u=setTimeout(function(){r({type:"timeout",target:o})},12e4);o.onerror=o.onload=r,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=i,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="js/",s.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var d=l;r.push([500,0]),a()}({0:function(e,t,a){"use strict";a.r(t);var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(56),l=a.n(o),u=a(5),d=a.n(u),c=a(6),h=a.n(c),f=a(10),p=a.n(f),g=a(9),m=a.n(g),v=a(25),y=a.n(v),k=a(11),_=a.n(k),S=a(13),P=a.n(S),w=a(1);function I(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function b(){}I.prototype={tokenize:function(){for(var e,t=0,a=[],i=0,n=this.str.length;i<n;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(i),this.checkChar(e)}return this.list.forEach(function(e){e.value=(e.value||"").toString().trim(),e.value&&a.push(e)}),a},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},b.prototype={_handleAddress:function(e){var t,a,i,n,r=0,s=!1,o="text",l=[],u={address:[],comment:[],group:[],text:[]};for(i=0,n=e.length;i<n;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("operator"===(t=e[i]).type)switch(t.value){case"<":o="address";break;case"(":o="comment";break;case":":o="group",s=!0;break;default:o="text"}else t.value&&("address"===o&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),u[o].push(t.value))}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),s)u.text=u.text.join(" "),l.push({name:u.text||a&&a.name,group:u.group.length?this.parse(u.group.join(",")):[]});else{if(!u.address.length&&u.text.length){var d=0;for(i=u.text.length-1;i>=0;i--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(u.text[i].match(/^[^@\s]+@[^@\s]+$/)){u.address=u.text.splice(i,1);break}}var c=function(e){return u.address.length?e:(u.address=[e.trim()]," ")};if(!u.address.length){var h=0;for(i=u.text.length-1;i>=0;i--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(u.text[i]=u.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,c).trim(),u.address.length)break}}}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),u.address.length>1&&(u.text=u.text.concat(u.address.splice(1))),u.text=u.text.join(" "),u.address=u.address.join(" "),!u.address&&s)return[];(a={address:u.address||u.text||"",name:u.text||u.address||""}).address===a.name&&((a.address||"").match(/@/)?a.name="":a.address=""),l.push(a)}return l},parse:function(e){var t=this,a=0,i=new I(e).tokenize(),n=[],r=[],s=[];i.forEach(function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?r.push(e):(r.length&&n.push(r),r=[])}),r.length&&n.push(r),n.forEach(function(e){var a=t._handleAddress(e);a.length&&(s=s.concat(a))});for(var o=[],l=0;l<s.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o.push({type:"contact",text:s[l].name||s[l].address,email:s[l].address})}return o}};var D,E,C,A=new b,M=a(104),T=function(){if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{X.PAssert(597,X.isArray(e),"Must only supply array to pushArray")}catch(t){X.reportError(t)}return this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{X.PAssert(598,X.isArray(e),"Must only supply array to removeArray")}catch(t){X.reportError(t)}return this.filter(function(t){return!e||e.indexOf(t)<0})}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var a=this.indexOf(e,t);return a>=0&&this.removeAt.call(this,a),a}),"function"!==typeof Array.prototype.equals){var e=function e(t,a,i){return t&&a&&"object"===l()(t)&&"object"===l()(a)?Object.keys(t).length===Object.keys(a).length&&Object.keys(t).reduce(function(n,r){return n&&(i?e(t[r],a[r],i):t[r]===a[r])},!0):t===a};Array.prototype.equals=function(t,a){var i=0;if(!t)return!1;if(this.length!==t.length)return!1;for(var n=0,r=this.length;n<r;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this[n]instanceof Array&&t[n]instanceof Array){if(!this[n].equals(t[n]))return!1}else if(this[n]!==t[n]&&!e(this[n],t[n],a))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){var a=0;for(var i=0;i<this.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[i][e]===t)return i}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var a=0;try{X.PAssert(600,void 0!==e&&null!==e,"Require a valid element to insert")}catch(o){X.reportError(o)}try{X.PAssert(601,t,"Require a valid comparison function")}catch(o){X.reportError(o)}for(var i=0,n=this.length-1;i<=n;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i+n>>1,s=t(this[r],e);if(s<0)i=r+1;else{if(!(s>0))return r;n=r-1}}return i}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var a=this.findInsertIndex(e,t);if(0===t(this[a],e))return this[a]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var a=this.findInsertIndex(e,t);return this.splice.apply(this,[a,0,e]),a}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var a=0;if(!e)return this;for(var i=0,n=e.length;i<n;++i){var r=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var s=!0,o=0,l=this.length;o<l;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t&&t(e[i],this[o])||!t&&e[i]===this[o]){s=!1;break}}s&&this.push(e[i])}return this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var a=0,i=-1,n=t-1;n>=0;--n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[n]===e){i=n;break}}return i}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})},L=a(24),x=a(15),R=a(14),O=a(484),F=a.n(O),N=(a(515),{"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"}),B=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,U=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"],V=(D=function(){function e(){d()(this,e),T(),this.SESSION_BEGIN=Date.now(),this.LogLevel=w.a.LogLevels.Error|w.a.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this._itemAnimationMode=void 0,this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new M.a(50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.timeouts={},this.lastActivity=Date.now(),this.activityThreshold=this.seconds(5),this.activeInput=new x.a(null),this.lastDateRollover=0,this.__xhrRequests={},this.isRollbarConfigured=!1,this.lastErrorsReported={},this.timeouts={},this.numReported=0,this.isReporting=!1}return h()(e,[{key:"Assert",value:function(){}},{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"isFunction",value:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},{key:"isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"isObject",value:function(e){return"object"===l()(e)&&null!==e&&!this.isArray(e)}},{key:"isNumber",value:function(e){return"number"===typeof e&&!isNaN(e)}},{key:"isBoolean",value:function(e){return!0===e||!1===e}},{key:"isAnything",value:function(){return!0}},{key:"isValidColor",value:function(e){return this.isString(e)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(e)}},{key:"parseBoolean",value:function(e){return!0===e||"true"===e}},{key:"parseDate",value:function(e){var t=new Date(e);return this.isDateValid(t)?t:void 0}},{key:"clone",value:function(e,t){var a;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var i in a={},e)e.hasOwnProperty(i)&&(t&&void 0===e[i]||(a[i]=e[i]));else a=Object.assign({},e);return a}},{key:"cloneWithoutUndefineds",value:function(e){return this.clone(e,!0)}},{key:"cloneDeep",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"arrayDifference",value:function(e,t){for(var a=0,i=[],n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[e[n]]||i.push(e[n])}return i}},{key:"emptyFn",value:function(){}},{key:"newEmptyFn",value:function(){return function(){}}},{key:"weeks",value:function(e){return 6048e5*e}},{key:"days",value:function(e){return 864e5*e}},{key:"hours",value:function(e){return 36e5*e}},{key:"minutes",value:function(e){return 6e4*e}},{key:"seconds",value:function(e){return 1e3*e}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return parseInt(e,10)})},{key:"shouldLog",value:function(e){return this.__DEV__===e}},{key:"shouldWriteLocal",value:function(){return!this.noLocalWrites}},{key:"isLocalWriteReason",value:function(e){return this.noLocalWritesReason===e}},{key:"isValidChangeType",value:function(e){if(void 0!==e&&null!==e){var t=e&~w.a.ChangeType.All;if(this.inMaskOnly(e,w.a.ChangeType.Valid))return(t&w.a.ChangeType.Locations)===w.a.ChangeType.None||this.isOneFlagSet(t,w.a.ChangeType.Local|w.a.ChangeType.Remote|w.a.ChangeType.Auto)}return!1}},{key:"isRemoteChange",value:function(e){try{this.PAssert(417,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~w.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.a.ChangeType.Remote)}},{key:"isUndoRedoChange",value:function(e){try{this.PAssert(418,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~w.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.a.ChangeType.UndoRedo)}},{key:"isLocalChange",value:function(e){try{this.PAssert(419,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~w.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.a.ChangeType.Local)}},{key:"isAutoChange",value:function(e){try{this.PAssert(420,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~w.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.a.ChangeType.Auto)}},{key:"inMaskOnly",value:function(e,t){return 0===(~t&e)}},{key:"isOneFlagSet",value:function(e,t){var a=e&t;return 0!==a&&0===(a&a-1)}},{key:"isAtLeastOneFlagSet",value:function(e,t){return 0!==(e&t)}},{key:"forEachFlagSet",value:function(e,t){for(var a=0;0!==e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}}},{key:"generateTempId",value:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}},{key:"toLowerCase",value:function(e){return e.toLowerCase()}},{key:"numberComparator",value:function(e,t){return e-t}},{key:"insertIntoText",value:function(e,t,a){try{this.PAssert(421,a<=e.length)}catch(i){this.reportError(i)}return e.substr(0,a)+t+e.substr(a,e.length-a)}},{key:"arrayUnion",value:function(e,t){for(var a=0,i=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n.indexOf(e[r])<0&&n.push(e[r])}for(r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n.indexOf(t[r])<0&&n.push(t[r])}return n}},{key:"arrayUnionByKey",value:function(e,t,a){for(var i=0,n=0,r=[],s=0;s<e.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r.indexOfWithProperty(a,e[s][a])<0&&r.push(e[s])}for(s=0;s<t.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.indexOfWithProperty(a,t[s][a])<0&&r.push(t[s])}return r}},{key:"arrayDiff",value:function(e,t){for(var a=0,i=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[r])<0&&n.push(e[r])}for(r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(t[r])<0&&n.push(t[r])}return n}},{key:"arrayIntersection",value:function(e,t){for(var a=0,i=[],n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[n])>=0&&i.push(e[n])}return i}},{key:"arrayIntersectionByKey",value:function(e,t,a){for(var i=0,n=[],r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t.indexOfWithProperty(a,e[r][a])>=0&&n.push(e[r])}return n}},{key:"arrayUniques",value:function(e,t){return t?e.filter(function(a,i){return e.findIndex(function(e){return e[t]===a[t]})===i}):e.filter(function(t,a){return e.indexOf(t)===a})}},{key:"removeNullUndefined",value:function(e){var t;return Object.keys(e).forEach(function(a){null!=e[a]&&void 0!==e[a]||delete(t=t||Object.assign({},e))[a]}),t||e}},{key:"deepEqual",value:function(e,t,a){return a&&(this.isObject(e)&&(e=this.removeNullUndefined(e)),this.isObject(t)&&(t=this.removeNullUndefined(t))),F()(e,t)}},{key:"extend",value:function(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}},{key:"classNames",value:function(){for(var e=0,t=0,a=arguments.length,i=new Array(a),n=0;n<a;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[n]=arguments[n]}for(var r=arguments,s=[],o=0;o<r.length;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=r[o];if(u)if(this.isString(u)||this.isNumber(u))s.push(u);else if("object"===l()(u))for(var d in u)u.hasOwnProperty(d)&&u[d]&&s.push(d)}return s.join(" ")}},{key:"isPrefixTask",value:function(e){return e&&(e===w.a.Prefix.Task||e===w.a.Prefix.Task2||e===w.a.Prefix.Task3||e===w.a.Prefix.Task4||e===w.a.Prefix.Task5||e===w.a.Prefix.Task6||e===w.a.Prefix.Task7||e===w.a.Prefix.Task8)}},{key:"escape",value:function(e){return String(e).replace(/[&\"<>]/g,function(e){return N[e]})}},{key:"unescape",value:function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,function(e){for(var t in N)if(N.hasOwnProperty(t)&&N[t]===e)return t;try{this.PAssert(422,!1,"Should have found a character to replace")}catch(a){this.reportError(a)}return e})}},{key:"escapeRegExp",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"stripTagsBasic",value:function(e){return e.replace(/<.*>/g,"")}},{key:"stripFormattingTags",value:function(e){return e.replace(/<\/?[biu]>/g,"")}},{key:"invertObject",value:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}},{key:"filterWithNonMatches",value:function(e,t){for(var a=0,i={match:[],fail:[]},n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n];t(r)?i.match.push(r):i.fail.push(r)}return i}},{key:"isUrlImage",value:function(e){return(e=e.toLowerCase()).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")}},{key:"isDateSoft",value:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"isDateValid",value:function(e){return e&&e instanceof Date&&!isNaN(e.getTime())}},{key:"getItemAnimationMode",value:function(){return this._itemAnimationMode}},{key:"setItemAnimationMode",value:function(e){this._itemAnimationMode=e}},{key:"resetItemAnimationMode",value:function(){this._itemAnimationMode=w.a.ItemAnimationMode.Normal}},{key:"parseEmailAddresses",value:function(e){return A.parse(e)}},{key:"isTempId",value:function(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]}},{key:"isLocalItem",value:function(e){try{this.PAssert(423,e.id,"All items should have an ID even if it is a temp one")}catch(t){this.reportError(t)}return this.isTempId(e.id)}},{key:"getCurrentStack",value:function(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(a){this.log("Error stringifying stack message",a,e)}if(this.supportSimpleStack){var a=new Error(t||e);if(a.stack)return a.stack}this.supportSimpleStack=!1;try{for(var i=0,n=["GenError: "+(t||e)],r=arguments.callee.caller,s=75,o=0;r&&o++<s;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l,u=r.toString(),d=this.fnRegex.exec(u);l=d&&3===d.length&&""!==d[1]&&void 0!==d[1]?"at "+d[1]+"("+d[2].replace(/[\r\n]/g,"")+")":d&&3===d.length?"at <anonymous> ("+d[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",n.push(l),r=r.caller}return n.join("\n")}catch(c){this.log("Error generating stack trace",c)}return""}},{key:"isVMLI",value:function(e){return e&&e.__ISVMLI}},{key:"isPane",value:function(e){return e&&e.__ISPANE}},{key:"log",value:function(){for(var e=0,t=arguments.length,a=new Array(t),i=0;i<t;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[i]=arguments[i]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(n){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(r){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}},{key:"registerEvent",value:function(e,t,a){try{this.PAssert(424,!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once")}catch(n){this.reportError(n)}try{this.PAssert(425,void 0!==e,"Must specify a name for the event")}catch(n){this.reportError(n)}try{this.PAssert(426,void 0!==t,"Must specify a category for the event")}catch(n){this.reportError(n)}try{this.PAssert(427,void 0!==a,"Must specify an action for the event")}catch(n){this.reportError(n)}var i={category:t,action:a,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=i}},{key:"aggregateEvent",value:function(e,t){try{this.PAssert(428,this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it")}catch(a){this.reportError(a)}void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)}},{key:"UIAction",value:function(e){this.sendEvent("UIAction",e)}},{key:"getAggregateEvents",value:function(){return this.aggregateEvents}},{key:"getAnonUserIdentifier",value:function(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID}},{key:"murmurhash3_32_gc",value:function(e,t){var a,i,n,r,s,o,l,u,d=0;for(a=3&e.length,i=e.length-a,n=t,s=3432918353,o=461845907,u=0;u<i;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,n=27492+(65535&(r=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16)}switch(l=0,a){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}},{key:"hashString",value:function(e){try{this.PAssert(429,this.isString(e),"Must always be passing a string to hash")}catch(t){this.reportError(t)}return this.murmurhash3_32_gc(e,this.defaultSeed)}},{key:"isDemoMode",value:function(){return!1}},{key:"getUserIdentifier",value:function(){var e=this.getToolbox();return this.isDemoMode()?"demouser":e?e.settings.activeUser.get():"Missing toolbox"}},{key:"beginCompleteAction",value:function(){this._isInCompleteAction=!0}},{key:"isInCompleteAction",value:function(){return this._isInCompleteAction}},{key:"endCompleteAction",value:function(){this._isInCompleteAction=!1}},{key:"getObjectInfo",value:function(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return l()(e)}},{key:"hasTimeoutOnce",value:function(e){return!!this.timeouts[e]}},{key:"timeoutOnce",value:function(e,t,a,i,n,r,s,o){var l=this;try{this.PAssert(430,e,"Must supply a valid name")}catch(d){this.reportError(d)}try{this.PAssert(431,this.isFunction(t),"must supply a valid cb fn")}catch(d){this.reportError(d)}try{this.PAssert(432,arguments.length<=8,"Too many args passed in")}catch(d){this.reportError(d)}var u=this.timeouts[e];u&&clearTimeout(u),this.timeouts[e]=setTimeout(function(){delete l.timeouts[e],t(i,n,r,s,o)},a)}},{key:"clearTimeoutOnce",value:function(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])}},{key:"sendEvent",value:function(e,t,a){}},{key:"objectValues",value:function(e){return Object.keys(e).map(function(t){return e[t]})}},{key:"trimRight",value:function(e){for(var t=0,a=e.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[a])break;e=e.substr(0,a)}return e}},{key:"getToolbox",value:function(){return a(3).default}},{key:"searchVMLIArray",value:function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!e.headers||r.showInOverview()){if(!e.comparator||e.comparator(r,e))if(e.each)if(!1===e.each(r,e))return!1;this.searchFromVMLI(r,e,a+1)}}}},{key:"searchFromVMLI",value:function(e,t,a){a=a||0;var i,n=t.noCollapsed,r=t.pane,s=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||n&&0!==a&&e.isCollapsed(r,s)||(i=this.searchVMLIArray(t,e.items.get(),a))}},{key:"searchVMLIs",value:function(e){var t=this;try{this.PAssert(433,e,"Must supply a valid options param")}catch(i){this.reportError(i)}var a=this.getToolbox();try{if(e.itemStoreFilter)a.itemStoreManager.runForEachStore(function(a){var i=e.item,n=i&&i.belongsToItemStore(a)?i:a.getRoot();t.searchFromVMLI(n,e)},e.itemStoreFilter);else if(e.item){try{this.PAssert(434,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){this.reportError(i)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{this.PAssert(435,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){this.reportError(i)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else{try{this.PAssert(436,!1,"Must specify a valid search root, using the default root is deprecated")}catch(i){this.reportError(i)}a.itemStoreManager.getDefaultItemStore().getRoot()}}catch(n){this.reportError(n)}}},{key:"clamp",value:function(e,t,a){return Math.max(t,Math.min(a,e))}},{key:"pad2",value:function(e){return 1===(e=""+e).length?"0"+e:""+e}},{key:"parseSubtree",value:function(e,t){var a=0;try{this.PAssert(437,e,"Must supply a valid item to parse")}catch(r){this.reportError(r)}this.runSingleParse(e,t);for(var i=e.getItems(),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.parseSubtree(i[n],t)}}},{key:"runSingleParse",value:function(e,t){try{this.PAssert(438,e,"Must have a valid item to parse")}catch(a){this.reportError(a)}e.parseText("",t)}},{key:"notifyActivity",value:function(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}},{key:"checkLowActivity",value:function(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}},{key:"whenLowImpactBegin",value:function(){this._isLowImpact||(this._isLowImpact=!0,L.a.fireEvent("lowImpactBegin",[]))}},{key:"whenLowImpactEnd",value:function(){this._isLowImpact&&(L.a.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}},{key:"isLowImpact",value:function(){return this._isLowImpact}},{key:"parseEvernoteLink",value:function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(B.lastIndex=0,null!==(t=B.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t}},{key:"isOneNoteLink",value:function(e){return e.startsWith("onenote:https://")}},{key:"isBearLink",value:function(e){return e.startsWith("bear://x-callback-url/")}},{key:"runDateRollover",value:function(){var e=this,t=this.getToolbox();try{this.PAssert(439,this.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){this.reportError(r)}var a=+this.scheduledDateRollover-Date.now();this.log("---- Running Date Rollover: "+a+" ----"),this.lastDateRollover=Date.now(),this.scheduledDateRollover=0,clearTimeout(this.dateRolloverTimeout),this.dateRolloverTimeout=void 0,this.setupDateRollover();var i=function(){t.Measure.clearItemCache(),t.Measure.clearLineCache(),t.PaneUpdateBatcher.updateAllItems(!0,!0),t.timeline.updateNotifications(),e.log("-------------------------------")};if(Date.Parsing.Normalizer.buildReplaceData(),t.timeline.clearDailyCaches(),t.settings.syncContacts.get()){var n=setTimeout(function(){i()},1e4);clearTimeout(n),n=void 0,i()}else i();L.a.fireEvent("dateChanged",[])}},{key:"setupDateRollover",value:function(){try{this.PAssert(440,!this.dateRolloverTimeout,"Should never reschedule a date rollover over another one")}catch(a){this.reportError(a)}var e=new Date,t=+e.clone().addDays(1).clearTime();try{this.PAssert(441,t>+e,"Rollover time must be in the future")}catch(a){this.reportError(a)}try{this.PAssert(442,t>this.lastDateRollover,"Rollover time must be after the last rollover")}catch(a){this.reportError(a)}this.dateRolloverTimeout=setTimeout(this.runDateRollover,t-+e),this.scheduledDateRollover=t}},{key:"ensureDateRollover",value:function(){var e=this;setTimeout(function(){var t=Date.now();e.scheduledDateRollover-t<0&&e.runDateRollover()},1e4)}},{key:"ensureStatsXHR",value:function(e){var t=this.sanitizeURL(e).split("?")[0];return this.__xhrRequests[t]||(this.__xhrRequests[t]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[t]}},{key:"notifyStatsXHRRequest",value:function(e){this.ensureStatsXHR(e).requests++}},{key:"notifyStatsXHRSuccess",value:function(e){this.ensureStatsXHR(e).successes++}},{key:"notifyStatsXHRRetry",value:function(e){this.ensureStatsXHR(e).retries++}},{key:"notifyStatsXHRFailure",value:function(e){this.ensureStatsXHR(e).failures++}},{key:"getXHRStats",value:function(){return this.__xhrRequests}},{key:"sanitizeURL",value:function(e){return e.replace(/&?access_token=[^&]*/g,"")}},{key:"generateQueryString",value:function(e){var t="";if("object"===l()(e)){t=Object.keys(e).map(function(t){return void 0!==e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):""}).join("&").replace(/%20/g,"+")}else{try{this.PAssert(443,"string"===typeof e,"Only Objects or Strings are currently supported")}catch(a){this.reportError(a)}t=e}return t}},{key:"packedFnToString",value:function(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=e[i]+"."}return a}},{key:"unpackFn",value:function(e,t){try{this.PAssert(444,this.isFunction(e)||this.isArray(e),"Must supply either a valid function or packed function")}catch(r){this.reportError(r)}var a=NaN;if(this.isFunction(e))a=e;else if(e)try{var i=0;0,a=t||window;for(var n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{this.PAssert(445,this.isString(e[n]),"Packed fns must only contain strings: "+n)}catch(r){this.reportError(r)}try{this.PAssert(446,a,"Must be able to unpack each step in object chain: "+e[n]+" in "+this.packedFnToString(e))}catch(r){this.reportError(r)}if(!a){a=NaN;break}a=a[e[n]]}}catch(s){this.reportError(s),a=NaN}return a}},{key:"encodeMIMEHeader",value:function(e){return"=?UTF-8?B?"+this.btoa(unescape(encodeURIComponent(e)))+"?="}},{key:"utf8_to_b64",value:function(e){var t;try{t=this.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(a){this.reportError(a,e)}return t}},{key:"b64_to_utf8",value:function(e){var t;try{t=decodeURIComponent(escape(this.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(a){this.reportError(a,e)}return t}},{key:"qp_to_utf8",value:function(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(e,t){var a=parseInt(t,16);return String.fromCharCode(a)})}catch(a){this.reportError(a,e)}return t}},{key:"isTextNode",value:function(e){return e&&3===e.nodeType}},{key:"isWhiteSpace",value:function(e){return/^\s*$/.test(e)}},{key:"isAncestor",value:function(e,t){var a=0;try{this.PAssert(447,e,"Must have a valid element")}catch(i){this.reportError(i)}try{this.PAssert(448,t,"Must have a valid candidate")}catch(i){this.reportError(i)}for(;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentNode}return!!e}},{key:"isEmail",value:function(e){var t=!1;e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e),t&&(t=e.indexOf('"')<0));return t}},{key:"intervalUntil",value:function(e){var t=0;if(!e())var a=setInterval(function(){t++,(e()||t>100)&&clearInterval(a)},0);return!0}},{key:"hasGoogleError",value:function(e,t,a){try{this.PAssert(449,e,"Must specify a valid result object")}catch(l){this.reportError(l)}try{this.PAssert(450,t,"Must specify a valid error domain")}catch(l){this.reportError(l)}try{this.PAssert(451,a,"Must specify a valid error reason")}catch(l){this.reportError(l)}var i=!1;if(e&&e.error&&e.errors)for(var n=0,r=e.error.errors,s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[s];if(o.domain===t&&o.reason===a){i=!0;break}}return i}},{key:"handleJSError",value:function(e,t,i,n){if(!e.message||!e.message.startsWith("Firebase Storage: Max retry time"))if(e){n||(n=w.a.LogLevels.Error);var r=this.getToolbox();if(r&&r.rollbar)try{var s=this.lastErrorsReported[e.stack];if(!s||s<Date.now()-5e3){var o=this.__LOG_BUFFER.ordered().join("\r\n"),l=r.settings?r.settings.getUserIdentifier():"No User Identifier";this.isRollbarConfigured||(r&&r.settings&&"me"!==l&&(this.isRollbarConfigured=!0),r.rollbar.configure({payload:{person:{id:l}},maxItems:w.a.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var u=this.parseExtra(t);if(this.numReported++,this.numReported<=w.a.__MAX_ERRORS_REPORTED){var d=a(201).default,c={};if(!this.isReporting){this.isReporting=!0;try{d.getAppInfo(c)}catch(f){}this.isReporting=!1}c.numReported=this.numReported;var h=Object.assign(this.getRollbarData(),{logs:o,info:c,user:l,extra:u});this.sendRollbar(e,h,n)}}this.lastErrorsReported[e.stack]=Date.now()}catch(e){this.log("Badness happened reporting errors to server: ",e);try{r.rollbar.error(e)}catch(p){this.log("More badness happened reporting errors to rollbar: ",p)}}}else console.log(e)}},{key:"reportError",value:function(e,t,a,i){this.handleJSError(e,t,!1,a)}},{key:"rollbarIgnoreFn",value:function(e,t,a){return!!(a&&a.body&&a.body.trace&&a.body.trace.frames&&a.body.trace.frames[0]&&U.indexOf(a.body.trace.frames[0].filename)>=0)}},{key:"parseExtra",value:function(e){return e?this.safeStringify(e):void 0}},{key:"isVowel",value:function(e){var t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}},{key:"forEachValue",value:function(e,t){Object.keys(e).forEach(function(a){return t(e[a])})}},{key:"isHTTPStatusCode",value:function(e,t){return e&&e.error&&e.error.code===t}},{key:"safeStringify",value:function(e){try{return JSON.stringify(e)}catch(t){0}}},{key:"makeString",value:function(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=" "+this.safeStringify(e[i])}return a}},{key:"decodeHtmlEntity",value:function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)}).replace(/<[^>]*>/g,"")}},{key:"deepFreeze",value:function(e){return e}}]),e}(),P()(D.prototype,"parseBoolean",[R.a],Object.getOwnPropertyDescriptor(D.prototype,"parseBoolean"),D.prototype),P()(D.prototype,"parseDate",[R.a],Object.getOwnPropertyDescriptor(D.prototype,"parseDate"),D.prototype),P()(D.prototype,"cloneWithoutUndefineds",[R.a],Object.getOwnPropertyDescriptor(D.prototype,"cloneWithoutUndefineds"),D.prototype),P()(D.prototype,"checkLowActivity",[R.a],Object.getOwnPropertyDescriptor(D.prototype,"checkLowActivity"),D.prototype),P()(D.prototype,"runDateRollover",[R.a],Object.getOwnPropertyDescriptor(D.prototype,"runDateRollover"),D.prototype),D),H=a(23),j=a(7),z=a(88),q=a.n(z),W=a(488);!function(e){e[e.None=0]="None",e[e.Item=1]="Item",e[e.Element=2]="Element"}(C||(C={}));var G=[0,5,15,35,80,170,400,1200],K=[0,408,429,500,502,503,504],Y=(E=function(e){function t(){var e;return d()(this,t),e=p()(this,m()(t).call(this)),window.__infLoop=e.infLoop,e.vmMain=void 0,e.isShowingLogin=new x.a(!1),e.archivedPadding=34,e.itemTransitionTime=100,e.scrollbarWidth=12,e.hasFocus=!0,e.demoMode=!1,e.focusedPane=void 0,e.focusedItem=void 0,e.ClickThreshold=5,e.isReconnected=!1,e.isBlocked=!1,e.blockedMessage="",e.authImmediateFailed=!1,e.authUserLoggedIn=!1,e.noLocalWritesReason=w.a.LocalWriteReason.Enabled,e.isLoadingRemote=!1,e.isSendingEmail=!1,e.isSavingDrafts=!1,e.isKeyboardOpen=!1,e.itemMenuOpenedOn=void 0,e.errorPlatformInfo=void 0,e.elements={},e.MobileSideTapThreshold=40,e.MobileSideTapThresholdKeyboardOpen=15,e.colorBlue="#09d",e.colorLightBlue="#02b1ff",e.colorRed="#d43",e.colorLightRed="#f34433",e.MinItemWidth=50,e.paneTop=j.a.app?20:0,e.activeDisplayMode=w.a.DisplayMode.Default,e.eventStream=new M.a(25),e.currentFindPass=0,e.scrollTimeouts={},e.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},e.keyboardDestination=C.None,e.keyboardOpenedOn=void 0,e.keyboardBlurFn=void 0,e.keyboardStartScrollOffset=0,e.downloadToasts=[],e.numLastLoop=-1,e.timeLastLoop=void 0,window.onerror=e.onWindowError,e.wrapAsyncCallbacks(),e.wrapXHR(),j.a.demo&&e.enableDemoMode(),e}return _()(t,e),h()(t,[{key:"addDevFunctions",value:function(){var e=this,t=window;t.__globals=function(){return e};var a=1;this.shouldLog(w.a.LogLevels.Input)&&(t.__eventBuffer=new M.a(100)),this.tagEvent=function(i,n,r){i.id||(i.id=a++,e.shouldLog(w.a.LogLevels.Input)&&t.__eventBuffer.push(i)),e.shouldLog(w.a.LogLevels.Input)&&(i.activeHandler={owner:n,fn:r},i.handlers?i.handlers.push(i.activeHandler):i.handlers=[i.activeHandler])},this.Assert=function(){for(var e=0,a=0,i=arguments.length,n=new Array(i),r=0;r<i;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}if(!n[0])try{n.length>1?t.__error.apply(console,n.slice(1)):t.__error("Assert Failure!")}catch(s){t.__error("Problem reporting Assert!")}},this.DAssert=function(t){t||e.log("Debug ONLY assert was hit.")},t.__getXHRStats=this.getXHRStats}},{key:"_dbgCatch",value:function(e){var t=Array.prototype.slice.call(arguments,1);try{if(e)return e.apply(void 0,t)}catch(a){this.reportError(a,t)}}},{key:"fnCatch",value:function(e){try{this.PAssert(29,e,"Must specify a callback")}catch(t){this.reportError(t)}return this._dbgCatch.bind(this,e)}},{key:"getTransitionClass",value:function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t}},{key:"setTransformStyle",value:function(e,t,a){try{this.PAssert(30,e,"Must provide a valid element")}catch(i){this.reportError(i)}if(e){try{this.PAssert(31,void 0!==t,"Must supply a valid X offset")}catch(i){this.reportError(i)}try{this.PAssert(32,void 0!==a,"Must supply a valid Y offset")}catch(i){this.reportError(i)}j.a.ie?e.style[j.a.transform.style]="translate("+t+"px, "+a+"px)":e.style[j.a.transform.style]="translate3d("+t+"px, "+a+"px, 0px)"}}},{key:"setTransitionStyle",value:function(e,t,a,i){try{this.PAssert(33,e,"Must provide a valid element")}catch(n){this.reportError(n)}e&&(i=i||"ease",e.style[j.a.transition.style]=t+" "+a+"ms "+i,setTimeout(function(){e.style[j.a.transition.style]=""},a))}},{key:"setTransform",value:function(e,t,a,i,n){i>0?(this.setTransitionStyle(e,j.a.transform.prop,i,n),this.setTransformStyle(e,t,a)):t||a?this.setTransformStyle(e,t,a):e.style[j.a.transform.style]="none"}},{key:"reload",value:function(e){window.location.reload(e)}},{key:"parseTokensFromText",value:function(e){for(var t,a=0,i=[],n=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,r=0;null!==(t=n.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e.substring(r,t.index),o=t[1]||t[2],l=t[3]||t[5];r=n.lastIndex,s&&s.trim().length>0&&i.push({text:s,type:"text"}),i.push({text:o||l,email:l,type:"contact"})}var u=e.substring(r,e.length);return u&&u.length>0&&i.push({text:u,type:"text"}),i}},{key:"isRunningScript",value:function(){return this.AScript&&this.AScript.isRunning}},{key:"preventLocalWrites",value:function(e){try{this.PAssert(34,!this.noLocalWrites,"Should only disable local writes once")}catch(t){this.reportError(t)}try{this.PAssert(35,e>=0,"Must provide a valid reason for disabling local writes")}catch(t){this.reportError(t)}this.isDemoMode()||this.shouldLog(w.a.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=e}},{key:"enableDemoMode",value:function(){this.demoMode=!0;var e=H.a.getURLParam("dmode");e&&this.enableMinMode(e),this.preventLocalWrites(w.a.LocalWriteReason.DemoMode)}},{key:"isDemoMode",value:function(){return this.demoMode}},{key:"isDisplayModeActive",value:function(e){return(this.activeDisplayMode&e)===e}},{key:"isDemoInIframe",value:function(){return this.isDisplayModeActive(w.a.DisplayMode.InIframe)}},{key:"enableMinMode",value:function(e){var t=this.getToolbox();try{if(this.addClass(document.body,"minMode"),this.isMinMode=!0,e=this.parseInt(e),j.a.touch||(e&w.a.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),e&w.a.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),e&w.a.DisplayMode.NoPaneHeaders&&this.addClass(document.body,"noPaneHeaders"),e&w.a.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),e&w.a.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle")),e&w.a.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),e&w.a.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),e&w.a.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),e&w.a.DisplayMode.NoInteraction){var a=document.getElementById("outerWrapper"),i=document.createElement("div");i.id="preventInteraction",a.appendChild(i),e&w.a.DisplayMode.PromptStart&&this.setupClick(i,i,function(){var e=t.toasts.getMessageById(w.a.MessageID.PromptScriptStart);e&&(e.doAction(),e.hide())})}e&w.a.DisplayMode.ShowDemoExit&&setTimeout(function(){t.toasts.pushMessage(w.a.MessageID.ExitDemo)},0),e&w.a.DisplayMode.PromptStart&&setTimeout(function(){t.toasts.pushMessage(w.a.MessageID.PromptScriptStart)},0),this.activeDisplayMode=e}catch(n){this.reportError(n)}}},{key:"hasClass",value:function(e,t,a){try{this.PAssert(36,e,"Must pass in a valid element")}catch(s){this.reportError(s)}if(e.classList)for(var i=0,n=Array.prototype.slice.call(arguments,1),r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.classList.contains(n[r]))return!0}return!1}},{key:"removeClass",value:function(e,t){try{this.PAssert(37,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.remove(t)}},{key:"addClass",value:function(e,t){try{this.PAssert(38,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.add(t)}},{key:"toggleClass",value:function(e,t){try{this.PAssert(39,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.toggle(t)}},{key:"findChild",value:function(e,t){try{this.PAssert(40,e,"Must pass in a valid element")}catch(s){this.reportError(s)}if(e)for(var a=0,i=0;i<e.childElementCount;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e.children[i];if(this.hasClass(n,t))return n;var r=this.findChild(n,t);if(r)return r}}},{key:"setupClick",value:function(e,t,a){var i=this;try{this.PAssert(41,e,"Expecting an object to bind the click handlers to.")}catch(L){this.reportError(L)}try{this.PAssert(42,t,"Must specify a valid owner for click handlers")}catch(L){this.reportError(L)}this.shouldLog(w.a.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(e)),t||(t=e);var n,r,s,o,l,u,d,c,h,f,p,g,m,v=this,y=!1;this.isFunction(a)?a={onClick:a}:a&&a.useCapture&&(y=a.useCapture);var k=function(e,i){try{v.PAssert(43,!t.isDestroyed||!t.isDestroyed()||"onMove"===e||"onEnd"===e,"Owner must not be destroyed to handle a click")}catch(L){v.reportError(L)}return a[e].call(t,i)},_=function(e){v.shouldLog(w.a.LogLevels.Input)&&i.log("Move: ",e.id);var t=e.eventX-n,p=e.eventY-r;if(0!==t||0!==p){var g=!l;if(n=e.eventX,r=e.eventY,e.distanceX=s+=Math.abs(t),e.distanceY=o+=Math.abs(p),(l||e.distanceX>i.ClickThreshold||e.distanceY>i.ClickThreshold)&&(l=!0,e.moved=l),a.onMove||a.onFirstMove)if(e.diffX=e.eventX-u,e.diffY=e.eventY-d,e.xThisFrame=t,e.yThisFrame=p,e.startX=u,e.startY=d,e.startClientX=c,e.startClientY=h,e.startSrc=f,g&&a.onFirstMove&&k("onFirstMove",e),a.onMove)k("onMove",e)&&e.stopImmediatePropagation()}},S=function(t){v.shouldLog(w.a.LogLevels.Input)&&v.log("End: ",t.id,v.elementToString(t.target),v.elementToString(e));var i=Date.now();p=p||i;var s=Math.max(0,i-p);g?g++:g=1,t.moved=l,t.timeDelta=s,t.diffX=n-u,t.diffY=r-d,t.startX=u,t.startY=d,t.startSrc=f,f=void 0,s<w.a.DoubleClickTime&&s>0&&a.onDoubleClick&&!l&&k("onDoubleClick",t),isNaN(t.button)||t.button===w.a.ButtonCode.Left?(p=i,!a.onClick||l||j.a.mac&&t.ctrlKey||k("onClick",t),a.onEnd&&k("onEnd",t)):t.button===w.a.ButtonCode.Middle&&a.onMiddleClick&&!l&&k("onMiddleClick",t),setTimeout(function(){p=void 0,g=void 0},w.a.DoubleClickTime)},P=function(t){v.shouldLog(w.a.LogLevels.Input)&&v.log("Cancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),a.onCancel&&k("onCancel",t)},I=function(t){v.shouldLog(w.a.LogLevels.Input)&&v.log("Start: ",t.id,v.elementToString(t.target),v.elementToString(e)),t.timeStart=Date.now(),f=t.target,t.startSrc=t.target,l=!1,t.startX=u=t.eventX,t.startY=d=t.eventY,t.startClientX=c=t.clientX,t.startClientY=h=t.clientY,n=t.eventX,r=t.eventY,s=0,o=0,(isNaN(t.button)||t.button===w.a.ButtonCode.Left||t.button===w.a.ButtonCode.Right)&&((isNaN(t.button)||t.button===w.a.ButtonCode.Left)&&a.onStart?k("onStart",t):t.button===w.a.ButtonCode.Right&&a.onRightStart&&k("onRightStart",t)),isNaN(t.changeLastY)||(r+=t.changeLastY)},b=this.fnCatch(function(t){var a=j.a.ie?t:t.touches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,_.call(e,t),t.returnFalse)return!1}),D=this.fnCatch(function(t){v.shouldLog(w.a.LogLevels.Input)&&v.log("TouchUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(j.a.touchMoveEvent,b,y),document.removeEventListener(j.a.touchEndEvent,D,y),document.removeEventListener(j.a.touchCancelEvent,E,y);var a=j.a.ie?t:t.changedTouches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,S.call(e,t),t.returnFalse)return!1}),E=this.fnCatch(function(t){if(v.shouldLog(w.a.LogLevels.Input)&&v.log("TouchCancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(j.a.touchMoveEvent,b,y),document.removeEventListener(j.a.touchEndEvent,D,y),document.removeEventListener(j.a.touchCancelEvent,E,y),P.call(e,t),t.returnFalse)return!1}),C=this.fnCatch(function(t){if(!t.handled&&!m)return v.shouldLog(w.a.LogLevels.Input)&&v.log("MouseDown: ",t.id,v.elementToString(t.target),v.elementToString(e)),m=!1,t.eventX=t.pageX,t.eventY=t.pageY,I.call(e,t),t.ignore||(t.button===w.a.ButtonCode.Left&&document.addEventListener(j.a.moveEvent,A,y),document.addEventListener(j.a.upEvent,M,y)),!t.returnFalse&&void 0}),A=this.fnCatch(function(t){if(!m)return t.eventX=t.pageX,t.eventY=t.pageY,_.call(e,t),!t.returnFalse&&void 0}),M=this.fnCatch(function(t){if(!t.handled&&!m)return v.shouldLog(w.a.LogLevels.Input)&&v.log("MouseUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(j.a.moveEvent,A,y),document.removeEventListener(j.a.upEvent,M,y),t.button===w.a.ButtonCode.Left&&S.call(e,t),!t.returnFalse&&void 0}),T=this.fnCatch(function(t){t.handled||m||(v.shouldLog(w.a.LogLevels.Input)&&v.log("ContextMenu: ",t.id,v.elementToString(t.target),v.elementToString(e)),a.onRightClick&&k("onRightClick",t))});return e.addEventListener(j.a.downEvent,C,y),a.onRightClick&&e.addEventListener("contextmenu",T,y),this}},{key:"isDOMNode",value:function(e){return"HTMLElement"in window?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE}},{key:"ensureDOMNode",value:function(e){var t;return this.isDOMNode(e)?t=e:this.isTextNode(e)&&(t=e.parentElement),t}},{key:"enumToString",value:function(e,t){for(var a in e)if(e[a]===t)return a;return null}},{key:"elementToString",value:function(e,t){if(e){var a=e.nodeName;return e.id&&(a+="#"+e.id),e.className&&(a+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(a+=":"+e.innerText.length),a}return"UNDEFINED"}},{key:"getElementPath",value:function(e,t){var a=!0,i="";try{for(var n=0;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i+=a?this.elementToString(e,t)+" ":this.elementToString(e)+" ",a=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}}catch(r){i+=r.message}return i}},{key:"setDimension",value:function(e,t){window.ga&&!this.isDemoMode()&&ga("set",e,t)}},{key:"sendEvent",value:function(e,t,a){try{this.PAssert(45,void 0===a||this.isNumber(a),"Values must be numeric")}catch(i){this.reportError(i)}if(window.ga&&!this.isDemoMode())try{ga("send","event",e,t,this.getAnonUserIdentifier(),a)}catch(n){this.reportError(n,"Category: "+e+" Action: "+t+" Value: "+a)}}},{key:"sendToGoogle",value:function(e,t){var a="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(a+="&value="+t+"&currency_code=USD"),new Image(1,1).src=a}},{key:"sendToFacebook",value:function(e,t){new Image(1,1).src="//www.facebook.com/tr?id=118704468840748&ev=PageView"}},{key:"reportAdConversion",value:function(e,t){try{this.sendToGoogle(e,t)}catch(a){this.reportError(a)}try{this.sendToFacebook(e,t)}catch(a){this.reportError(a)}}},{key:"pageDataCleared",value:function(){this.isPageDataCleared=!0}},{key:"hasPageDataBeenCleared",value:function(){return this.isPageDataCleared}},{key:"findFirstDiff",value:function(e,t,a,i){var n=0;if(!e)return i?0:t.length;if(!t)return i?e.length:0;for(var r=Math.min(e.length,t.length),s=0;s<r;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a){if(e.charAt(s).toLowerCase()!==t.charAt(s).toLowerCase())return s}else if(e.charAt(s)!==t.charAt(s))return s}return i?e.length:t.length}},{key:"lerp",value:function(e,t,a){return e+(t-e)*a}},{key:"hashCode",value:function(e){var t,a=0,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=(i<<5)-i+e.charCodeAt(t),i|=0}return i}},{key:"sanitizePaneState",value:function(e){try{for(var t=0,a=JSON.parse(JSON.stringify(e)),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==a[i].search&&(a[i].search="HasSearch")}return JSON.stringify(a)}catch(n){return"Failed to sanitize pane state"}}},{key:"sanitizeLocalSettings",value:function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(a){return"Failed to parse settings"}}},{key:"sanitizeKey",value:function(e){switch(e){case w.a.KeyCode.Backspace:return"BACKSPACE";case w.a.KeyCode.Delete:return"DELETE";case w.a.KeyCode.Enter:return"ENTER";case w.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}},{key:"getLoadedScripts",value:function(e){try{for(var t=0,a=document.getElementsByTagName("script"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];r.src&&i.push(r.src)}e.loadedScripts=i}catch(s){e.loadedScripts="ERROR: "+s.message}}},{key:"getExtraReportData",value:function(e){e.platformConfig=j.a.getUserPlatformConfig()}},{key:"criticalErrorReported",value:function(){return this.hasCriticalError}},{key:"handleCriticalError",value:function(){var e=this;this.hasCriticalError=!0;try{this.isDemoMode()?this.reload():(document.body.innerHTML='<div class="centerVHFlex">There was a critical error while loading Moo.do. '.concat(j.a.actionVerb().capitalize()," to reload.</div>"),j.a.isTouchDevice?document.body.addEventListener(j.a.touchStartEvent,function(){e.reload()},!0):document.body.addEventListener(j.a.upEvent,function(){e.reload()},!0))}catch(t){this.reportError(t)}}},{key:"reportEvent",value:function(e){if(!this.isDemoMode()){var t=this.parseExtra(e);t&&this.eventStream.push(t)}}},{key:"getEventStream",value:function(){return this.eventStream.ordered()}},{key:"parseExtra",value:function(e){var t;if(e)try{var a;if(e instanceof KeyboardEvent){var i=this.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(i)<0&&(a={type:e.type,currentTarget:this.elementToString(e.currentTarget),target:i,keyCode:this.sanitizeKey(e.keyCode),normCode:this.sanitizeKey(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof MouseEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof TouchEvent){a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};var n=e.touches[0];n&&(a.clientX=n.clientX,a.clientY=n.clientY)}else if(window.PointerEvent&&e instanceof PointerEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof Event)a={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)a={rangeCount:0};else{var r=e.getRangeAt(0),s=r.startContainer,o=!1,l=r.endContainer,u=!1;s.nodeType===Node.TEXT_NODE&&(s=s.parentNode,o=!0),l.nodeType===Node.TEXT_NODE&&(l=l.parentNode,u=!0),a={rangeCount:e.rangeCount,startContainer:this.getElementPath(s),startWasTextNode:o,startOffset:r.startOffset,endContainer:this.getElementPath(l),endWasTextNode:u,endOffset:r.endOffset}}else a=e;t=a?this.safeStringify(a):void 0}catch(d){this.log("Error parsing extra "+d.message)}return t}},{key:"handleJSError",value:function(e,a,i,n){!i&&window.__error&&window.__error("JS Error: "+e.message,"  Stack: ",e.stack,"  Extra: ",a),y()(m()(t.prototype),"handleJSError",this).call(this,e,a,i,n)}},{key:"onWindowError",value:function(e,t,a,i,n){n?(this.log("Reported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+i),this.reportError(n)):(this.log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+i),this.reportError(e))}},{key:"checkpoint",value:function(e){window.__checkpoints|=e}},{key:"wrapFn",value:function(e,t){var a=this;return function(){try{return e.apply(this,arguments)}catch(i){i&&"auth/network-request-failed"===i.code||(a.reportError(i),t&&t(i))}}}},{key:"wrapAsyncCallbacks",value:function(){var e=this,t=function(t){var a=window[t];window[t]=function(){var t=Array.prototype.slice.call(arguments),i=t[0];return"function"===typeof i&&(t[0]=e.wrapFn(i)),a.apply?a.apply(this,t):a(t[0],t[1])}};t("setTimeout"),t("setInterval")}},{key:"mergeObjects",value:function(e,t){var a,i=this;return Array.isArray(t)?(a=(a=[]).concat(e=e||[]),t.forEach(function(t,n){"undefined"===typeof a[n]?a[n]=t:"object"===l()(t)?a[n]=i.mergeObjects(e[n],t):-1===e.indexOf(t)&&a.push(t)})):(a={},e&&"object"===l()(e)&&Object.keys(e).forEach(function(t){a[t]=e[t]}),Object.keys(t).forEach(function(n){"object"===l()(t[n])&&t[n]&&e[n]?a[n]=i.mergeObjects(e[n],t[n]):a[n]=t[n]})),a}},{key:"readyStateCallback",value:function(e,t,a){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},a&&(e.onerror=a)}},{key:"createPath",value:function(e){return window.location.protocol+"//"+window.location.host+"/"+e}},{key:"addScript",value:function(e,t,a,i){try{this.PAssert(46,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(r){this.reportError(r)}var n=document.createElement("script");n.src=e,t&&(n.id=t),a&&this.readyStateCallback(n,a,i);try{this.PAssert(47,"undefined"!==typeof n,"Should always be able to create a valid script object")}catch(r){this.reportError(r)}"undefined"!==typeof n&&document.getElementsByTagName("head")[0].appendChild(n)}},{key:"addScriptHack",value:function(e,t,a,i){window.define||(window.define={}),this.addScript(e,t,function(){window.define.amd={jQuery:!0},a&&a()},function(){window.define.amd={jQuery:!0},i&&i()})}},{key:"addStylesheet",value:function(e,t,a){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,t&&this.readyStateCallback(i,t,a),"undefined"!==typeof i&&document.getElementsByTagName("head")[0].appendChild(i)}},{key:"DAssert",value:function(e,t){}},{key:"PAssert",value:function(e,t){var a=this;if(!t){var i={isAssert:!0,tag:e};try{var n=Array.prototype.slice.call(arguments,2),r=this.makeString(n.map(function(e){return a.isFunction(e)?e():e}));arguments.length>2?this.log("Assert Failure "+e+": "+r):this.log("Assert Failure "+e),this.reportError(new Error("Assert Failure: "+r),i,w.a.LogLevels.Warning)}catch(s){this.log("Exception in PAssert "+e+": ",s),this.reportError(s,i)}}}},{key:"getElementParent",value:function(e){var t=0;for(0;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"item")||this.hasClass(e,"paneHiddenInput"))return e;e=e.parentNode}}},{key:"isItemValidForPass",value:function(e,t){return!!e&&(t?e.lastFindPass===this.currentFindPass:e.lastFindPass<this.currentFindPass)}},{key:"markItemForPass",value:function(e,t){if(e){var a=this.isItemValidForPass(e,t);try{this.PAssert(49,a,"Item should always be valid")}catch(i){this.reportError(i)}return e.lastFindPass=this.currentFindPass,a}return!1}},{key:"getPreviousItem",value:function(e,t,a){return this.currentFindPass++,this._getPreviousItem(e,t,a)}},{key:"_getPreviousItem",value:function(e,t,a){var i;var n=a&&a.isTest,r=a&&a.ignoreSearch,s=a&&a.sameLevel,o=a&&a.includeNotes;if(this.markItemForPass(e,n)){var l=e.parent();if(l){if(e.isNote())return e.parent();var u=l.getChildIndex(e);if(u>0)for(var d=0;!i;){var c=0;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;for(var h=!1,f=u-1;f>=0;f--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=l.getChild(f);if(!this.markItemForPass(p,n)){try{this.PAssert(51,!1,"Invalid child found during findPreviousItem")}catch(g){this.reportError(g)}return}if(s||!p.hasChildren()||t&&p.isCollapsed(t,!1)){if(r||!t||!p.isHidden(t,!1)){i=p,h=!0;break}}else if(r||!t||!p.isHidden(t,!1)){l=p,u=p.numChildren(),h=!0;break}}if(s)break;h||(i=l)}else s||(i=e.parent());o&&i&&i.hasNote()&&(i=i.getNote());try{this.PAssert(52,!s||!i||i.parent()===e.parent(),"Previous item must share the same parent")}catch(g){this.reportError(g)}try{this.PAssert(53,n||!i||t&&i.isCollapsed(t,!1)||e===this._getNextItem(i,t,{isTest:!0,ignoreSearch:r,sameLevel:s}),"Previous/Next should always match")}catch(g){this.reportError(g)}return i}}}},{key:"getNextItem",value:function(e,t,a){return this.currentFindPass++,this._getNextItem(e,t,a)}},{key:"_getNextItem",value:function(e,t,a){var i,n=0;var r=a&&a.isTest,s=a&&a.ignoreSearch,o=a&&a.sameLevel,l=a&&a.includeNotes;if(e){if(l&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!o&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1)))for(var u=0,d=e.numChildren(),c=0;c<d;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=e.getChild(c);if(!this.markItemForPass(h,r)){try{this.PAssert(55,!1,"Invalid child found during findNextItem A")}catch(y){this.reportError(y)}return}if(s||!t||!h.isHidden(t,!1)){i=h,a&&a.numLevels++;break}}for(var f=e;!i;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!this.markItemForPass(f,r)){try{this.PAssert(56,!1,"Invalid parent found during findNextItem B")}catch(y){this.reportError(y)}break}var p=f.parent();if(!p)break;var g=p.getChildIndex(f);d=p.numChildren();if(!t||!p.isCollapsed(t,!1))for(var m=0,v=g+1;v<d;++v){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;h=p.getChild(v);if(!this.markItemForPass(h,r)){try{this.PAssert(58,!1,"Invalid child found during findNextItem C")}catch(y){this.reportError(y)}return}if(s||!t||!h.isHidden(t,!1)){i=h;break}}if(f=p,a&&!i&&a.numLevels--,o||t&&f===t.getItem())break}try{this.PAssert(59,!o||!i||i.parent()===e.parent(),"Next item must share the same parent")}catch(y){this.reportError(y)}try{this.PAssert(60,r||!i||e===this._getPreviousItem(i,t,{isTest:!0,ignoreSearch:s,sameLevel:o}),"Previous/Next should always match")}catch(y){this.reportError(y)}return i}}},{key:"easeOut",value:function(e,t,a){return-a*e*(e-2)+t}},{key:"scrollTo",value:function(e,t,a,i,n){var r=this;try{this.PAssert(61,void 0!==e||void 0!==t,"Must be scrolling something")}catch(h){this.reportError(h)}try{this.PAssert(62,void 0===e||this.isNumber(e),"Must provide a valid scrollPosX")}catch(h){this.reportError(h)}try{this.PAssert(63,void 0===t||this.isNumber(t),"Must provide a valid scrollPosY")}catch(h){this.reportError(h)}try{this.PAssert(64,this.isNumber(a),"Must provide a valid duration")}catch(h){this.reportError(h)}try{this.PAssert(65,this.isDOMNode(i),"Must provide a valid element to scroll")}catch(h){this.reportError(h)}try{this.PAssert(66,!n||this.isFunction(n),"Must provide a valid scrollDone callback")}catch(h){this.reportError(h)}var s=i.getAttribute("data-moo-id")||i.id;try{this.PAssert(67,s,"Should only scroll elements with ids")}catch(h){this.reportError(h)}if(this.scrollTimeouts[s]&&(cancelAnimationFrame(this.scrollTimeouts[s]),delete this.scrollTimeouts[s]),i)if(a>0){if(void 0!==e)var o=i.scrollLeft,l=e-o;if(void 0!==t)var u=i.scrollTop,d=t-u;var c;if(Math.abs(l)>0||Math.abs(d)>0){0;this.scrollTimeouts[s]=requestAnimationFrame(function h(f){c||(c=f-20);var p=Math.min((f-c)/a,1);if(void 0!==e){var g=r.easeOut(p,o,l);i.scrollLeft=g}if(void 0!==t){var m=r.easeOut(p,u,d);i.scrollTop=m}1===p?(delete r.scrollTimeouts[s],n&&n()):r.scrollTimeouts[s]=requestAnimationFrame(h)})}}else i&&(void 0!==e&&(i.scrollLeft=e),void 0!==t&&(i.scrollTop=t)),n&&n();else this.reportError(new Error("Must specify an element to scroll to"))}},{key:"computeScrollSpeed",value:function(e,t,a,i,n){var r=(t-e-(t-(a=this.clamp(a,e,t))))/(t-e);return n<0&&(r-=1),r*i}},{key:"performScroll",value:function(){if(this.scrollState.pane||this.scrollState.panes){var e;if(this.scrollState.pane){var t=6*this.scrollState.speedPane;e=this.scrollState.pane.addScrollDelta(t)}else{var a=6*this.scrollState.speedPanes,i=this.element("panes"),n=i.scrollLeft;i.scrollLeft+=a,e=n!==i.scrollLeft}e?requestAnimationFrame(this.performScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}},{key:"repeatScroll",value:function(e,t,a,i){try{this.PAssert(68,i||a&&!this.isString(a),"Must pass a valid pane object to repeatScroll")}catch(n){this.reportError(n)}this.scrollState["speed"+(a?"Pane":"Panes")]=t,(this.scrollState.pane||this.scrollState.panes)&&a===this.scrollState.pane||(this.scrollState.pane=a,this.scrollState.panes=i,requestAnimationFrame(this.performScroll))}},{key:"cancelRepeatScrolls",value:function(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}},{key:"cancelRepeatScroll",value:function(e){this.scrollState[e]=void 0}},{key:"elementInPane",value:function(e){if(e){var t=0;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"pane")||this.hasClass(e,"paneOverview"))return!!e;e=e.parentElement}}return!1}},{key:"elementInPaneEdit",value:function(e){var t=!1,a=this.getPaneForElement(e);return a&&this.isAncestor(e,a.getContentElement())&&(t=!0),t}},{key:"elementInNonPaneEdit",value:function(e){var t=!1;if(e&&(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!this.elementInPaneEdit(e)))for(var a=0;e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.isKeyboardInputElement(e)){t=!0;break}e=e.parentElement}return t}},{key:"isNonPaneDropTarget",value:function(e){var t=!1;return this.elementInNonPaneEdit(e)?t=!0:this.findParent(e,"validDropTarget")&&(t=!0),t}},{key:"scrollIntoView",value:function(e,t,a){try{this.PAssert(69,this.isDOMNode(e),"Must supply a valid DOM node to scroll into view")}catch(c){this.reportError(c)}try{this.PAssert(70,this.isNumber(t)&&t>=0,"Must supply a valid scroll duration")}catch(c){this.reportError(c)}try{this.PAssert(71,!a||this.isFunction(a),"Callback must be a function")}catch(c){this.reportError(c)}try{this.PAssert(72,!this.getListCellForElement(e),"Use methods on VMPane to scroll VMLIs")}catch(c){this.reportError(c)}var i=!1;if(e){var n=this.findParent(e,"scroller")||this.findParent(e,"fancyScrollContent")||this.findParent(e,"fancyScroller");try{this.PAssert(73,n,"Every element must be a child of a scroller to be able to scroll it into view")}catch(c){this.reportError(c)}try{this.PAssert(74,!this.hasClass(n,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(c){this.reportError(c)}if(n){var r,s=n.getBoundingClientRect(),o=s.bottom,l=e.getBoundingClientRect(),u=Math.min(l.bottom,l.top+80),d=n.scrollTop;l.top<s.top?r=d+l.top-s.top:u>o&&l.top>s.top&&(r=d+u-o),void 0!==r&&(this.scrollTo(void 0,r,t,n,a),i=!0)}}return i}},{key:"isKeyboardInputElement",value:function(e){if(e){if("checkbox"===e.type)return!1;if("INPUT"===e.nodeName||"textarea"===e.type||this.findParentAttr(e,"contenteditable","true"))return!0}return!1}},{key:"blurActiveElement",value:function(e){var t=this;this.ignoreSelectionChange=!!e,this.shouldLog(w.a.LogLevels.Selection)&&this.log("Blur Active Element"),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),setTimeout(function(){t.ignoreSelectionChange=!1},100)}},{key:"trimString",value:function(e){for(var t=0,a=/\s/,i=(e=e.replace(/^\s\s*/,"")).length;a.test(e.charAt(--i));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,i+1)}},{key:"preventAndStop",value:function(e){this.preventDefault(e),this.stopPropagation(e)}},{key:"preventDefault",value:function(e){if(e&&e.preventDefault)e.preventDefault();else try{this.PAssert(75,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"stopPropagation",value:function(e){if(e&&e.stopPropagation)e.stopPropagation();else try{this.PAssert(76,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"preventClick",value:function(){var e=this;this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")})}},{key:"loadXML",value:function(e){try{var t=window;if("undefined"!==typeof t.DOMParser)return(new t.DOMParser).parseFromString(e,"text/xml");if("undefined"!==typeof t.ActiveXObject&&new t.ActiveXObject("Microsoft.XMLDOM")){var a=new t.ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(e),a}try{this.PAssert(77,!1,"No XML parser found")}catch(i){this.reportError(i)}return}catch(n){return void this.reportError(n)}}},{key:"getPluginForElement",value:function(e){return this.findParent(e,"plugin",4)}},{key:"findParentInItem",value:function(e,t){for(var a=0;e&&!this.hasClass(e,"item");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.hasClass(e,t))return e;e=e.parentNode}}},{key:"findParent",value:function(e,t,a){try{this.PAssert(78,e,"Must pass in a valid element")}catch(s){this.reportError(s)}if(a||(a=1e3),e)for(var i=0,n=e,r=0;r<a&&n;++r,n=n.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.hasClass(n,t))return n}}},{key:"findParentID",value:function(e,t,a){try{this.PAssert(80,e,"Must pass in a valid element")}catch(s){this.reportError(s)}if(a||(a=1e4),e)for(var i=0,n=e,r=0;r<a&&n;++r,n=n.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n.id===t)return n}}},{key:"findParentAttr",value:function(e,t,a){try{this.PAssert(81,e,"Must pass in a valid element")}catch(r){this.reportError(r)}if(e)for(var i=0,n=e;n&&n.getAttribute;n=n.parentNode){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n.getAttribute(t)===a)return n}}},{key:"prependChild",value:function(e,t){try{this.PAssert(82,e,"Must pass in a valid element")}catch(a){this.reportError(a)}try{this.PAssert(83,t,"Must pass in a valid element")}catch(a){this.reportError(a)}e.insertBefore(t,e.firstChild)}},{key:"getAncestorChain",value:function(e){var t=0;for(var a=e;a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.push(a),a=a.parentNode}return[]}},{key:"isAttachedToDoc",value:function(e){try{this.PAssert(85,e,"Must supply a valid element to check")}catch(t){this.reportError(t)}try{this.PAssert(86,e.ownerDocument,"Checked element must have a valid owner document")}catch(t){this.reportError(t)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)}},{key:"offset",value:function(e){try{this.PAssert(87,e,"Must pass in a valid element")}catch(r){this.reportError(r)}var t=e.getBoundingClientRect(),a=e.ownerDocument,i=e.ownerDocument.documentElement,n=a.defaultView;return{top:t.top+n.pageYOffset-i.clientTop,left:t.left+n.pageXOffset-i.clientLeft}}},{key:"position",value:function(e){var t=e.offsetParent,a=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{left:a.left-i.left,top:a.top-i.top}}},{key:"height",value:function(e){try{this.PAssert(89,e,"Must pass in a valid element")}catch(i){this.reportError(i)}var t=e.offsetHeight,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom)),t-=parseFloat(a.borderTopWidth)+parseFloat(a.borderBottomWidth)):this.shouldLog(w.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),t}},{key:"width",value:function(e){try{this.PAssert(91,e,"Must pass in a valid element")}catch(i){this.reportError(i)}var t=e.offsetWidth,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight)),t-=parseFloat(a.borderLeftWidth)+parseFloat(a.borderRightWidth)):this.shouldLog(w.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),t}},{key:"wrapXHR",value:function(){try{var e=window,t=e.XMLHttpRequest.prototype.open,a=e.XMLHttpRequest.prototype.send,i=this;e.XMLHttpRequest.prototype.open=function(e,a,n,r,s){this.url=a,void 0===n&&(n=!0);try{t.call(this,e,a,n,r,s)}catch(o){throw i.reportError(o),o}},e.XMLHttpRequest.prototype.send=function(e){this.timeout||(this.timeout=i.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&a.call(this,e)}catch(t){throw i.reportError(t),t}}}catch(n){this.reportError(n)}}},{key:"element",value:function(e,t){try{this.PAssert(93,e,"Tried to get an element without an id")}catch(a){this.reportError(a)}this.elements[e]&&!t||(this.elements[e]=document.getElementById(e));try{this.PAssert(94,this.elements[e],"Tried to get an element that doesn't exist",e)}catch(a){this.reportError(a)}return this.elements[e]}},{key:"openUrl",value:function(e,t,a){var i=this;try{this.PAssert(95,e,"Must always provide a valid URL to open")}catch(u){this.reportError(u)}if(!e)return!1;var n=this.getToolbox(),r=this.parseEvernoteLink(e);if(r){n&&n.settings.getUserIdentifier();var s=!!n&&n.settings.openEvernoteApp.get();if(void 0===s)return void n.menus.confirm("Open Evernote links in Evernote app?",function(r){n&&n.settings.openEvernoteApp.set(r),i.openUrl(e,t,a)});s&&(r.viewUrl?e=r.viewUrl:(e="evernote:///view/"+r.userId+"/"+r.shardId+"/"+r.noteGuid+"/"+r.noteGuid+"/",console.log(e)))}if(j.a.standalone){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer");var l=document.createEvent("HTMLEvents");l.initEvent("click",!0,!0),o.dispatchEvent(l)}else if(j.a.app){j.a.isChrome||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),n.nativeBridge.sendToApp("openURL",e),t&&(this.preventAndStop(t),t.returnFalse=!0)}else(a=a||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"))?open(e,"_this"):open(e,"_blank");return!0}},{key:"getLocationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"isSpellcheckEnabled",value:function(){return!1}},{key:"fFalse",value:function(){return!1}},{key:"fTrue",value:function(){return!0}},{key:"round",value:function(e,t){return t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)}},{key:"toFileSize",value:function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null}},{key:"saveFile",value:function(e,t){var a=new Blob([e],{type:"text/plain;charset=utf-8"});Object(W.saveAs)(a,t)}},{key:"downloadFile",value:function(e,t){var a=this.getToolbox();if(j.a.supportsNativeDownload()){try{this.PAssert(97,!this.downloadToasts[e],"Should not double create a download for the same file")}catch(r){this.reportError(r)}this.downloadToasts[e]=a.toasts.pushMessage({text:"Downloading "+t+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),a.nativeBridge.sendToApp("downloadURL",{url:e,name:t})}else if(document.createEvent){var i=document.createElement("a");i.href=e;var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)}else window.open(e,"_this")}},{key:"handleNativeDownloadProgress",value:function(e){var t=e.url,a=e.name,i=e.progress,n=this.downloadToasts[t];if(n)if(1===i)n.hide(),delete this.downloadToasts[t];else{var r=isNaN(i)?"...":Math.round(100*i)+"%";n.setText("Downloading "+a+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+r)}}},{key:"printPage",value:function(e){j.a.app||window.open(e).print()}},{key:"reactNodeForElement",value:function(e){var t=e;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),t=this.getParentWithMooKey(t))for(var a in t)if(a.startsWith("__reactInternalInstance$")){var i=t[a],n=i&&i.return&&i.return.stateNode;if(n&&n.props)return n}}},{key:"getParentWithMooKey",value:function(e){for(var t=0;e&&e!==document;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.getAttribute("data-moo-id"))return e;e=e.parentNode}}},{key:"getItemForElement",value:function(e){var t=this.reactNodeForElement(e),a=t&&t.getPaneObject&&t.getPaneObject(),i=a&&(this.isVMLI(a)?a:a.item);try{this.PAssert(98,!i||this.isVMLI(i),"Must always find a valid VMLI for a given element: "+this.elementToString(e))}catch(n){this.reportError(n)}if(i)return i}},{key:"getIndexForElement",value:function(e){var t=-1,a=this.findParent(e,"item");if(a){var i=this.reactNodeForElement(a);i&&(t=i.getIndex())}return t}},{key:"getPaneForElement",value:function(e){var t=this.findParent(e,"pane")||this.findParent(e,"paneOverviewScroller");if(t){var a=this.reactNodeForElement(t);return a&&a.getPane&&a.getPane()}}},{key:"getPaneObjectForElement",value:function(e){var t=this.reactNodeForElement(e);if(t&&t.getPaneObject)return t.getPaneObject()}},{key:"getCellForElement",value:function(e){var t=this.reactNodeForElement(e);if(t&&t.getCell)return t.getCell()}},{key:"getListCellForElement",value:function(e){var t=this.reactNodeForElement(e);if(t&&t.getCell)return t}},{key:"btoa",value:function(e){return window.btoa(e)}},{key:"atob",value:function(e){return window.atob(e)}},{key:"animFrameOnce",value:function(e,t){var a=this.timeouts[e];a&&cancelAnimationFrame(a),this.timeouts[e]=requestAnimationFrame(t)}},{key:"elementFromPoint",value:function(e,t){return document.elementFromPoint(e,t)}},{key:"parentTextForItem",value:function(e){for(var t=0,a=e.parents(),i="",n=1;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n>1&&(i+="  |  "),i+=a[n].generateTitleText()}return i}},{key:"batchRenderUpdates",value:function(e,t,a,i,n,r){return q.a.unstable_batchedUpdates(e,t,a,i,n,r)}},{key:"hexToRgb",value:function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}},{key:"hexToRgbStr",value:function(e){return parseInt(e.substr(1,2),16)+","+parseInt(e.substr(3,2),16)+","+parseInt(e.substr(5,2),16)}},{key:"rgbToHex",value:function(e,t,a){return[this.pad2(Math.round(e).toString(16)),this.pad2(Math.round(t).toString(16)),this.pad2(Math.round(a).toString(16))].join("")}},{key:"infLoop",value:function(e){if(!this.timeLastLoop||e<this.numLastLoop)this.timeLastLoop=Date.now();else if(e>this.numLastLoop&&e>3e4&&e%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(100,!1,"Infinite loop!",e)}catch(a){this.reportError(a)}var t=this.getToolbox();return t.toasts&&t.toasts.pushMessage(w.a.MessageID.ReactError),!0}this.numLastLoop=e}},{key:"XHR_PrivateAPI",value:function(e){var t=j.a.getDeployVar(w.a.DeployVariable.APIHost);e.url="https:".concat(t).concat(e.path),this.XHR(e)}},{key:"getRollbarData",value:function(){return{url:this.sanitizeURL(window.location.href),jsVersion:w.a.jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"}}},{key:"sendRollbar",value:function(e,t,a){window.Rollbar&&(a===w.a.LogLevels.Error?(Rollbar.error(e,t),this.sendEvent("ErrorReport","Error")):a===w.a.LogLevels.Warning?(Rollbar.warning(e,t),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(e,t),this.sendEvent("ErrorReport","Unknown")))}},{key:"textToJSONPromise",value:function(e){try{return Promise.resolve(JSON.parse(e))}catch(t){}}},{key:"textToTextPromise",value:function(e){return Promise.resolve(e)}},{key:"XHR",value:function(){var e=s()(n.a.mark(function e(t){var a,i,r,s,o,l,u,d,c,h,f=this;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:a=t.url,i=t.type,r=t.data,s=t.headers,o=t.autoRetry,l=t.timeout,u=t.maxRetries,d=t.username,c=t.password,h=this;try{h.PAssert(101,a,"Must specify a valid URL to use")}catch(p){h.reportError(p)}try{h.PAssert(102,i,"Must specify a valid request type")}catch(p){h.reportError(p)}return e.abrupt("return",new Promise(function(e){var t=0;u=Math.min(u||2,6),f.notifyStatsXHRRequest(a);var n=function(){try{h.PAssert(103,t<u,"Should not be calling retry once retries have been exhausted")}catch(p){h.reportError(p)}t<u?(t++,f.notifyStatsXHRRetry(a),setTimeout(g,1e3*G[t])):(f.notifyStatsXHRFailure(a),f.reportError(new Error("XHR Failed: "+a)))},g=function(){var h,p=new XMLHttpRequest;(void 0===l||isNaN(l)||(p.timeout=l),p.onreadystatechange=function(){if(4===p.readyState){var i=p;i.json=f.textToJSONPromise.bind(f,p.response),i.text=f.textToTextPromise.bind(f,p.response),200!==p.status?t<u?(p.retry=n,o&&K.indexOf(p.status)>=0?p.retry():e(i)):(f.notifyStatsXHRFailure(a),e(i)):(f.notifyStatsXHRSuccess(a),e(i))}},d&&c?p.open(i.toUpperCase(),a,!0,d,c):p.open(i.toUpperCase(),a,!0),s&&Object.keys(s).forEach(function(e){return p.setRequestHeader(e,s[e])}),r)?(p.setRequestHeader("Accept","*/*"),s&&s["Content-Type"]||p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h=r instanceof Blob?r:f.generateQueryString(r),p.send(h)):p.send()};g()}));case 5:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleIdleTask",value:function(e){setTimeout(e,100)}}]),t}(V),P()(E.prototype,"onWindowError",[R.a],Object.getOwnPropertyDescriptor(E.prototype,"onWindowError"),E.prototype),P()(E.prototype,"performScroll",[R.a],Object.getOwnPropertyDescriptor(E.prototype,"performScroll"),E.prototype),P()(E.prototype,"infLoop",[R.a],Object.getOwnPropertyDescriptor(E.prototype,"infLoop"),E.prototype),E),X=t.default=new Y},1:function(e,t,a){"use strict";var i,n=a(35),r=a.n(n);Error.stackTraceLimit=1/0;var s={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Minus:109,F1:112,F4:115,F12:123,Equals:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},o={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},l={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"},u="https://".concat("api.moo.do"),d={FirebaseAppID:"597847337936",FirebaseProjectID:"api-project-597847337936",APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"597847337936-ridipp5ac5bulesmmjici7rtjces027t.apps.googleusercontent.com",APIBaseURL:"api.moo.do",APIFullURL:u,CloudFunctionsURL:"".concat(u,"/appapi/1/"),EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:26,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:0,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:30,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},SettingsSections:{General:"General",Dates:"Dates",Plugins:"Enable Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Sync Accounts",Invite:"Invite Friends",DesktopApp:"Desktop App",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail",Agenda:"Agenda",Backups:"Backups",Security:"Security",Debug:"Debug"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:"None",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",Compose:"New Message"},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewModesNew:["Outline","List","Calendar","-","Archived","Deleted"],PaneModesNonTask:["Email","Files"],TaskViewGroups:["None","Project","Tag","Contact","Priority","Agenda","Date","Created","Modified","Completed"],TaskViewSorts:["None","Alphabetical","NumItems","Priority","Date","Created","Completed","Modified"],TaskAgendaOptions:["Today","Week","All"],TaskCalendarOptions:["Day","Custom","Week","Month"],TaskViewMode:{Outline:"Outline",List_Flat:"List_Flat",Groups_Project:"Groups_Project",Groups_Tag:"Groups_Tag",Groups_Contact:"Groups_Contact",Groups_Priority:"Groups_Priority",Agenda_Today:"Agenda_Today",Agenda_Week:"Agenda_Week",Agenda_All:"Agenda_All",Calendar_Day:"Calendar_Day",Calendar_Custom:"Calendar_Custom",Calendar_Week:"Calendar_Week",Calendar_Month:"Calendar_Month",Archived:"Archived",Deleted:"Deleted"},TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month",Archived:"Archive",Deleted:"Deleted"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar",Archived:"Archived Items",Deleted:"Deleted Items"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy",Archived:"icon-inbox",Deleted:"icon-delete"},TaskSortMode:{None:"None",Alphabetical:"Alphabetical",NumItems:"NumItems",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed",Modified:"Modified"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed",Modified:"Modified"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:120,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",Task5:"(",Task6:"()",Task7:")",Task8:"( )",NumList:"1."},SearchFilterTexts:{Star:"*",Pri0:"!!!",Pri1:"!!",Pri2:"!"},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PrefixOffsetFromItem:2,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",AttachChar:"\u2000",EmbedAttachChar:"\u2001",RNSpace:"\u2002",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[s.D1,s.D2,s.D3,s.D4,s.D5,s.D6,s.D7,s.D8,s.D9,s.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",TextMDHR:"---",KeyCode:s,KeyCodesModifiers:[s.LeftMeta,s.RightMeta,s.Ctrl,s.Alt,s.Shift],KeyCodesArrows:[s.UpArrow,s.DownArrow,s.LeftArrow,s.RightArrow],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:"},Regexp:{Link:/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,LinkExc:/(!?)\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,MDLink:/(!?)\[([^\[]*)\]\((\S+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"Added",Modified:"Modified",Removed:"Removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:o,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},ScrollDuration:{Snap:0,Default:200,Slow:500},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",WriteAccess:"writeAccess",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3,RichText:4},PluginRenderers:{Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ImportMoodo:"importMoodo",ConfirmEncrypt:"confirmEncrypt",Date:"date",Note:"note",AutocompleteList:"autocompleteList",Contact:"contact",ExternalLink:"ExternalLink",DropBucket:"dropBucket"},DisplayMode:{Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformOS:{Unknown:0,iPhone:1,iPad:2,iPod:3,Android:4,Mac:5,Windows:6,Linux:7,ChromeOS:8},PlatformBrowser:{Unknown:0,Electron:1,Mailbird:2,Chrome:3,Firefox:4,Safari:5,IE:6,Edge:7,Opera:8},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:l,GScopeArray:[l.Calendar,l.CalendarRO,l.Contacts,l.Drive,l.DriveMetadataRO,l.DriveFull,l.DriveReadOnly,l.GmailCompose,l.GmailModify,l.TasksRO,l.UserInfoEmail,l.UserInfoProfile,l.DriveAppData,l.Plus,l.Email,l.Profile,l.DriveInstall],jsVersion:"1567205160405",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,ProductName:"Moo.do",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PCMask:o.P0|o.P1|o.P2|o.Complete,PMask:o.P0|o.P1|o.P2,PriorityClass:(i={},r()(i,o.None," "),r()(i,o.P0," p0"),r()(i,o.P1," p1"),r()(i,o.P2," p2"),i),OverviewPaddingStartMobile:12,OverviewPaddingStart:32,OverviewPaddingIncrement:18,MobileItemIndentStart:30,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2},Colors:{Brand:"#0099dd",Red:"#C9302C",P0:"#f30",P1:"#fa0",P2:"#fc3",Star:"#ffb",Complete:"#d6d6d6",Mobile:{Header:"#f6f6f6"}},BlockType:{Item:"blockItem",Header:"blockHeader",AddItem:"blockAddItem",HR:"hr"},SPThresholdRight:42};t.a=d},100:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(0),h=a(1),f=a(3),p=a(8),g=a(17),m=a(116),v=a(109),y=a(37),k=function(){function e(){l()(this,e)}return d()(e,[{key:"_setSectionValue",value:function(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}},{key:"_parseSection",value:function(e,t){for(var a=0,i={},n=t;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n];if(r){var s=r.indexOf(":"),o=[r.substr(0,s),r.substr(s+1)],l=o[0].split(";");switch(l[0]){case"BEGIN":var u=this._parseSection(e,n+1);n+=u.size,i[o[1]]=u.section;break;case"END":return{section:i,size:n-t+1};default:if(l.length>1){for(var d=0,h={value:o[1]},f=1;f<l.length;++f){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=l[f].split("=");try{c.default.PAssert(630,!h.hasOwnProperty(p[0]),"Should never overwrite line values")}catch(g){c.default.reportError(g)}h[p[0]]=p[1]}this._setSectionValue(i,l[0],h)}else this._setSectionValue(i,l[0],o[1]);break;case void 0:case null:try{c.default.PAssert(631,!1,"Invalid ICS format: "+r)}catch(g){c.default.reportError(g)}}}}return i}},{key:"parseICS",value:function(e){for(var t=0,a=e.split("\n"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];r.startsWith(" ")?i[i.length-1]+=r.trim():i.push(r.trim())}return this._parseSection(i,0)}},{key:"parseHead",value:function(e){for(var t=0,a={},i=0;i<e.childElementCount;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.children[i],r=n.nodeName;if(n.firstChild){var s=n.firstChild.textContent;a[r]=s}}return a}},{key:"parseOPML",value:function(e,t){var a=this,i=t.getDocumentOwner();return p.d.beginAction(),function e(n,r){var s,o=!0;switch(n.nodeName){case"#document":case"body":case"opml":break;case"head":o=!1;var l=a.parseHead(n);l&&l.title&&i.setText(l.title);break;case"outline":r||t&&(r=t);var u=n.attributes.text,d=u?u.value:"",f=n.attributes.complete||n.attributes._complete,p=!(!f||"true"!==f.value),m=n.attributes.note||n.attributes._note||n.attributes.Notes,v={text:c.default.unescape(c.default.stripFormattingTags(d).replace(/[\r\n\t]/g," ")),isComplete:p};if(s=g.a.createVMLI(v,{parent:r,changeType:h.a.ChangeType.AllLocal,documentOwner:i}),r.insertItem(s),m&&!s.getNote()){var y={text:c.default.unescape(m.value),isNote:!0},k=g.a.createVMLI(y,{parent:s,changeType:h.a.ChangeType.AllLocal,documentOwner:i});s.setNote(k,h.a.ChangeType.AllLocal)}break;default:c.default.log("Unknown OPML Node: ",n)}if(o)for(var _=0,S=0;S<n.childElementCount;++S){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;e(n.children[S],s)}return s}(e,t),p.d.endAction(),!0}},{key:"createItemsFromTree",value:function(e,t){}},{key:"parseJSON",value:function(){var e=s()(n.a.mark(function e(t,a){var i,r,s,o;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(void 0===t.moodoVer||void 0===t.moodoRoot&&void 0===t.items){e.next=31;break}if(e.prev=1,c.default.parseInt(t.moodoVer),!t.doc){e.next=22;break}if(r={},!t.sentinel){e.next=16;break}if(!(o=f.default.crypto.getKeyBySentinel(t.sentinel))){e.next=13;break}return e.next=10,Promise.all(t.items.map(function(e){return y.a.decryptItemIn(e,f.default.crypto,o)}));case 10:s=e.sent,e.next=14;break;case 13:return e.abrupt("return",null);case 14:e.next=17;break;case 16:s=t.items.map(y.a.itemIn);case 17:a&&(s=s.map(function(e){var t=r[e.id];if(t||(t=g.a.generateID(),r[e.id]=t),e.id=t,e.parent){e.parent=r[e.parent];try{c.default.PAssert(632,e.parent,"Imported item has no parent")}catch(a){c.default.reportError(a)}}return e})),v.a.createItemHierarchy(s),i={rootData:s[0],root:s[0],text:t.doc.text,items:s},e.next=24;break;case 22:(i=(new m.a).translateDocument({root:t.moodoRoot},!1))&&(i.rootData=i.root);case 24:return a&&i&&(i.root.id=g.a.generateID()),e.abrupt("return",i);case 28:e.prev=28,e.t0=e.catch(1),c.default.reportError(e.t0);case 31:return e.abrupt("return",!1);case 32:case"end":return e.stop()}}},e,null,[[1,28]])}));return function(t,a){return e.apply(this,arguments)}}()},{key:"_findLineParent",value:function(e,t,a){for(var i,n=0,r=Math.min(e.length-1,t-1);r>=0;--r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=e[r];if(s&&s.indentLevel===a-1){i=s;break}}return i}},{key:"parseText",value:function(e){for(var t=0,a={items:[]},i=[],n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._parseTextLine(e[n]);if(r){i.push(r);var s=this._findLineParent(i,n,r.indentLevel)||a;r.parent=s,s.items.push(r)}}return a}},{key:"_parseTextLine",value:function(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:c.default.trimString(e.replace(/[\ud800-\udfff]+/g,"")),items:[]}}},{key:"_addMulti",value:function(e,t,a){return e[t]||(e[t]=a),e[t]}},{key:"_getReference",value:function(e,t){var a;return"Evernote"!==t.type&&(a=e[t.value]),a}},{key:"_hasReference",value:function(e,t){var a=!0;return"Evernote"!==t.type&&(a=!!e[t.value]),a}},{key:"_lookupNode",value:function(e,t){return e[c.default.hashString(t)]}},{key:"_storeNode",value:function(e,t,a){e[c.default.hashString(t)]=a}},{key:"_beginImport",value:function(e){this._reportedImportError=!1,this._rawImportData=e}},{key:"_endImport",value:function(){this._reportedImportError=!1,this._rawImportData=void 0}},{key:"_reportRecursiveImport",value:function(){this._reportRecursiveImport||c.default.reportError(new Error("Recursive import failure"),this._rawImportData)}},{key:"_parseEntries",value:function(e){var t=[];if(e){for(var a=0,i=0,n=e.split(", "),r=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],s=[],o=n.length-1;o>=0;o--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=n[o],u=/^([^:]*):\s(.*)/.exec(l);(!u||!u[1]||r.indexOf(u[1])<0)&&o>0?(n[o-1]+=", "+n[o],n.removeAt(o)):s.push(l)}for(o=0;o<s.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=s[o],c=d.indexOf(":");if(c>0){var h=d.substr(0,c),f=d.substr(c+2);t.push({type:h,value:f})}}}return t}},{key:"stripParents",value:function(e){if(e.parent=void 0,e.items)for(var t=0,a=0;a<e.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.stripParents(e.items[a])}}},{key:"parseClassName",value:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=h.a.VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=h.a.VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=h.a.VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}},{key:"traverseDOM",value:function(e){var t,a,i,n,r,s=this,o=0,l=e.root,u=e.stripParents,d=e.shouldPrint,h=e.preserveWhitespace,f=l.firstChild,p={text:"",parent:void 0,items:[]},g=p,m=!1,v=!1,y=!1,k=function(e){var n=e;if(e.nodeType===Node.TEXT_NODE){(v||m)&&(h||(g.text=g.text.replace(/^ +/g,"").replace(/ +$/g,"")),""===g.text&&y||(y||(y=!0,g={text:"",parent:g,date:void 0}),t={text:"",parent:g.parent,date:i},s.parseClassName(a,t),c.default.hasClass(e.parentNode,"note")?(t.isNote=!0,g._note=t):g.parent.items.push(t),g=t,i=void 0)),v=!1,m=!1;var r=e.nodeValue;""===g.text&&(r=h?r.replace(/^[\r\n\t]+/g,""):r.replace(/^[ \r\n\t]+/g,"")),s.parseClassName(a,g),i&&(g.date=i),g.text+=c.default.stripFormattingTags(r)}else e.nodeType===Node.COMMENT_NODE||("BR"===n.tagName||"P"===n.tagName||"LI"===n.tagName||"DIV"===n.tagName?(m=!0,a=n.className,i=n.getAttribute("data-date")):"A"===n.tagName&&n.getAttribute("href")!==n.textContent?(g.text&&!g.text.endsWith(" ")&&(g.text+=" "),g.text+="["):"UL"!==n.tagName&&"OL"!==n.tagName||(y=!0,g.text=g.text.replace(/^ +/g,"").replace(/ +$/g,""),t={text:"",parent:g},s.parseClassName(a,t),g.items?g.items.push(t):g.items=[t],g=t,m=!1,a="",i=void 0))},_=function(e){e.nodeType!==Node.TEXT_NODE&&("UL"===e.tagName||"OL"===e.tagName?(g=g.parent,v=!0):"DIV"===e.tagName||"P"===e.tagName?(m=!0,a="",i=void 0):"A"===e.tagName&&e.getAttribute("href")!==e.textContent&&(g.text+="]("+e.getAttribute("href")+")"))};do{if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(k(f),f.classList&&f.classList.contains("note")?(r=f,g.text=r.innerHTML,g.parent._note=g,g.isNote=!0,v=!0,m=!0,n=void 0):n=f.firstChild,n)f=n;else if(n=f.nextSibling)f=n;else{var S=0;do{if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;(n=f.parentNode.nextSibling)?(_(f.parentNode),f=n):_(f=f.parentNode)}while(!n&&f&&f.parentNode);if(!n)break}}while(f);if(u&&this.stripParents(p),d){!function e(t,a){var i=0;isNaN(a)&&(a=0);for(var n="",r=0;r<a;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n+="--"}if(a&&console.log(n,t.text),t.items){var s=0;for(r=0;r<t.items.length;r++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e(t.items[r],a+1)}}}(p)}return p.items&&p.items.length||(p={items:[p]}),p.items&&p.items.length&&!p.items[p.items.length-1].text&&p.items.splice(p.items.length-1,1),p}}]),e}();t.a=new k},101:function(e,t,a){"use strict";var i=a(68),n=a.n(i),r=a(82),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=a(2),k=a.n(y),_=function(e){function t(){return l()(this,t),h()(this,p()(t).apply(this,arguments))}return m()(t,e),d()(t,[{key:"getElement",value:function(){return this.refs.element}},{key:"onMouseDown",value:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"onMouseMove",value:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,stopImmediatePropagation:v.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}}},{key:"onClick",value:function(e){this.moveX<v.default.ClickThreshold&&this.moveY<v.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)}},{key:"onMouseUp",value:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"onTapStart",value:function(e){this.onMouseDown(e),e.stopPropagation()}},{key:"onTapClick",value:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())}},{key:"onTapMove",value:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()}},{key:"onTapEnd",value:function(e){this.onMouseUp(e),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=(e.onClick,e.globalEvents),a=s()(e,["onClick","globalEvents"]);return k.a.createElement("div",n()({},a,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}]),t}(a(21).a);t.a=_},104:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=function(){function e(t){n()(this,e),this._limit=t,this._offset=0,this._buffer=[]}return s()(e,[{key:"get",value:function(e){return this._buffer[e]}},{key:"push",value:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}},{key:"pop",value:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(e){this._limit=e}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var e=0,t=this.ordered(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+a+"] ----"),console.log(t[a])}}}]),e}();t.a=o},107:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(2),v=a.n(m),y=a(21),k=a(27),_=a(53),S=a(101),P=a(58),w=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){var e=this.props,t=e.item;e.renderLikePane&&!isNaN(e.paneObject.index)&&(this.styleProps=t.styleProps(e.paneObject,e.pane),this.metrics=e.pane.getMetricsForPaneObject(e.paneObject))}},{key:"onMount",value:function(){var e=this.props,t=e.item;this.listenTo(t.itemChanged);try{f.default.PAssert(607,e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane")}catch(a){f.default.reportError(a)}this.props.editable&&(this._needsSelect=isNaN(e.selectIndex)?t.getParsedText().length:e.selectIndex,k.default.selectElement(this.getEditable(),this._needsSelect))}},{key:"getEditable",value:function(){return this.refs.editable}},{key:"getElement",value:function(){return this.refs.element.getElement()}},{key:"getState",value:function(){var e=this.props,t=e.pane,a=e.item,i={flags:a.flags,renderLikePane:e.renderLikePane&&!isNaN(e.paneObject.index),styleProps:this.styleProps,priorityProps:e.showPriority&&a.getPriorityProps(),isComplete:a.isComplete(),hasPrefix:a.hasPrefix(),date:a.getMooDate()};return e.allowDrag&&(i.draggedInPane=a.draggedInPane,i.isBeingDragged=a.draggedInPane.get()===t),i.renderLikePane?(i.metrics=this.metrics,i.lines=i.metrics.styledLines):i.lines=[a.getStyledTextAsOneLine()],i}},{key:"focus",value:function(){var e=this.props.item.getParsedText().length;k.default.selectElement(this.getEditable(),e)}},{key:"onKeyDown",value:function(e){var t=this.props,a=t.item;e.keyCode===p.a.KeyCode.Backspace&&this.state.hasPrefix&&""===a.getParsedTextWithoutPrefix()&&a.setText("",!1!==t.shouldSave?p.a.ChangeType.Local:p.a.ChangeType.Auto),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyPress",value:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var a=this.props.item,i=k.default._getSelectionRange(),n=k.default.getSelectOffsetsInElement(e.target,i);if(this._needsSelect=void 0,n.start!==n.end){var r=a.getParsedText(),s=r.substr(0,n.start)+r.substr(n.end);a.setText(s,!1!==t.shouldSave?p.a.ChangeType.Local:p.a.ChangeType.Auto),this._needsSelect=n.start}}}},{key:"componentDidUpdate",value:function(){if(!isNaN(this._needsSelect)){var e=this.getEditable(),t=e.innerHTML;(t.indexOf("<br")>=0||t.indexOf("></span>")>0||""===t)&&(e.innerHTML=this.getRenderedHtml()),k.default.selectElement(e,Math.min(e.textContent.length,this._needsSelect)),this._needsSelect=void 0}}},{key:"convertElementToText",value:function(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=p.a.AttachChar;else for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}},{key:"stopResizing",value:function(){this.isResizing=!1}},{key:"onInput",value:function(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props.item,a=this.convertElementToText(e.target).replace(new RegExp(p.a.TextSpace,"g"),""),i=k.default._getSelectionRange();if(i){var n=k.default.getSelectOffsetsInElement(e.target,i);this._needsSelect=n.start}t.setText(a,p.a.ChangeType.Local),this.updateAutocomplete(),e.preventDefault()}},{key:"updateAutocomplete",value:function(){var e=this.getEditable(),t=this.props.autocompleteMode;if(t){var a=k.default.getSelectionInElement(e);a&&a.start===a.end&&_.a.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(p.a.TextSpace,"g"),""),offset:a.start,item:this.props.item,owner:this,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,onDatePickerClosed:this.onDatePickerClosed.bind(this),supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}},{key:"onDatePickerClosed",value:function(){var e=this;if(this.props.item.getRawText().includes(p.a.CharDate)){var t=this.props.item.getParsedText();t.length>0&&t!==p.a.TextSpace&&(this.getEditable().focus(),k.default.selectElement(this.getEditable(),t.length),setTimeout(function(){e.getEditable().focus(),k.default.selectElement(e.getEditable(),t.length)},0))}}},{key:"onAutocompleteSelected",value:function(e){var t=this;void 0!==e.value&&(this.props.item.setText(e.value,p.a.ChangeType.Local),k.default.selectElement(this.getEditable(),e.offset),setTimeout(function(){k.default.selectElement(t.getEditable(),e.offset)},0))}},{key:"onClick",value:function(e){if(!this.isResizing){var t=this.props;if(g.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&g.default.menus.closeContextMenu("ReactContextMenuContactDetails"),t.editOnClick)e.preventDefault(),e.stopPropagation(),g.default.menus.isContextMenuOpen()&&g.default.menus.closeContextMenu(),g.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:t.item,pane:t.pane});else{var a=!0;if((t.editable||t.inItemDetails)&&t.pane&&(a=!g.default.pluginManager.handleTapClick(t.item,t.pane,e)),a&&!t.inItemDetails&&f.default.hasClass(e.target,"contact")){var i=e.target.textContent,n=P.a.findMatchExact(i[0]===p.a.ContactPrefix?i.substr(1):i);n&&g.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:e.target,contact:n})}}}}},{key:"onMouseDown",value:function(e){if(e.button===p.a.ButtonCode.Left){var t=this.props,a=t.item,i=t.resizable;if(i){var n=this.getEditable().getBoundingClientRect(),r=Math.min(p.a.CalendarResizeHandleHeight,n.height/3);i=e.clientY-n.top<r?t.onItemResizeStart(a,this,!1):n.bottom-e.clientY<r&&t.onItemResizeStart(a,this,!0)}this.isResizing=i,!i&&t.allowDrag&&a.checkDragOnStart(e)}}},{key:"onMouseMove",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)}},{key:"onMouseUp",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)}},{key:"onClickDate",value:function(){g.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:this.getEditable(),item:this.props.item,pane:this.props.pane})}},{key:"onRightClick",value:function(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(g.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY}}),e.preventDefault(),e.stopPropagation())}},{key:"getRenderedHtml",value:function(){for(var e,t=0,a=this.props,i=a.paneObject,n=this.props.item,r=this.state.lines,s="",o=0;o<r.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=a.renderLikePane?"padding-top: "+(0===o?g.default.DisplaySettings.paddingForItemTop(i,n)+"px":0)+"; padding-bottom: "+(o===r.length-1?(a.noNotes?g.default.DisplaySettings.paddingForItemTop(i,n):g.default.DisplaySettings.paddingForItemBottom(i,n))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",s+='<span class="line'+(o===r.length-1?" last":"")+'" style="'+e+'">'+(r[o]||p.a.TextSpace)+"</span>"}return s}},{key:"render",value:function(){var e=this.props,t=e.item,a=this.state,i=(a.lines,e.editable&&g.default.pluginManager.allowTextEditing(t)),n=f.default.classNames("reactItemWrapper flexbox",e.className,e.coloredInCalendar&&"colored"),r=f.default.classNames("item itemNotInPane f1",a.styleProps,a.priorityProps,{hasPrefix:a.hasPrefix},{"itemBeingDragged c-bg-light":a.isBeingDragged},{autoSelect:i},{complete:a.isComplete},{"c-bg-dark":a.isComplete&&e.coloredInCalendar}),s={};a.renderLikePane&&e.padding&&(s.paddingLeft=e.padding);var o,l=this.getRenderedHtml();if(e.style&&(s=f.default.extend(e.style,s)),e.coloredInCalendar&&!a.isBeingDragged){a.isComplete||(s.backgroundColor=t.getCalendarColor());var u=t.getCalendarDisplayProps();if(u)for(var d in u.style)if(u.hasOwnProperty(d)){try{f.default.PAssert(608,!s[d],"Calendar display prop overwriting default styling")}catch(k){f.default.reportError(k)}s[d]=u.style[d]}}if(this.state.date&&e.inItemDetails&&!this.props.item.getRawText().includes(p.a.CharDate)){var c=this.state.date,h=c.isRepeatDate(),m=c.toText(!0),y=f.default.classNames("itemTime c-date pointer");o=v.a.createElement("div",{className:y,style:{},onClick:this.onClickDate},c.getGCalId()&&v.a.createElement("i",{className:"icon-calendar"}),h&&v.a.createElement("i",{className:"icon-spinner"}),m)}return v.a.createElement(S.a,{"data-moo-id":this.getUniqueID(),className:n,ref:"element"},v.a.createElement("span",{className:r,style:s,contentEditable:i,onClick:e.editOnClick||i||e.inItemDetails?this.onClick:void 0,onKeyDown:i?this.onKeyDown:void 0,onKeyPress:i?this.onKeyPress:void 0,onInput:i?this.onInput:void 0,onMouseDown:i?void 0:this.onMouseDown,onMouseMove:i?void 0:this.onMouseMove,onMouseUp:i?void 0:this.onMouseUp,onContextMenu:this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:l},ref:"editable"}),o)}}]),t}(y.a);t.a=w},109:function(e,t,a){"use strict";var i=a(37),n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(11),f=a.n(h),p=function(e){function t(){var e;r()(this,t),(e=u()(this,c()(t).call(this,"moodonew"))).version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"});var a={};["plugins","gmail","drive","gcal"].forEach(function(e){return a[e]="id"}),e.version(2).stores(a),e.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","Drive","GCalendar","Gmail"];var i={GmailMessages:"id",gmail:null,drive:null,gcal:null};return e.tableNames.forEach(function(e){return i[e]="id"}),i.Gmail="id,date",e.version(3).stores(i),e}return f()(t,e),o()(t,[{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}}]),t}(a(486).a),g=function(e,t,a){var i=function(e,t,a){for(var i=0,n=0,r=e.length-1;n<=r;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n+r>>1,o=a(e[s],t);if(o<0)n=s+1;else{if(!(o>0))return s;r=s-1}}return n}(e,t,a);return e.splice.apply(e,[i,0,t]),i},m=function(e,t){var a=0,n={},r={},s=function(e){n[e.id]||(n[e.id]=e,e.isRoot&&(r[e.docId]=e))};e.forEach(s),t&&Object.keys(t).forEach(function(e){s(t[e])});for(var o=0;o<e.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e[o],u=l.parent,d=n[u],c=!1;if(l.isArchived||l.isDeleted){var h=l.isDeleted,f=(h?"deleted":"archived")+"Items";if(!d||d.isRoot||(h?!d.isDeleted:!d.isArchived)){var p=r[l.docId];p&&(p[f]||(p[f]=[]),p[f].push(l)),c=!0}}c||(d||l.isRoot||console.log("Item without a parent",l.text,l.parent,u,l.docId,l),l.note&&(l.noteItem=n[l.note]),d&&(32===(32&l.flags)?d.note=l.id:void 0!==l.text&&(d.items||(d.items=[]),void 0===l.index&&(l.index=""+d.items.length),g(d.items,l,i.a.compareItemIndex))))}return n},v=function(e){for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[a]=i.a.itemIn(e[a])}return m(e)},y=function(){return new p};t.a={load:function(e,t,a){e||(e=y()),a=a||e.tableNames;var n={},r=a.length;a.forEach(function(e){return n[e]=void 0});var s=function(e,a){if(a||(a=[]),n[e]=a,"documents"===e){for(var s=0,o=a,l={},u={},d=0;d<o.length;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=i.a.documentIn(o[d]);l[o[d].id]=c,c.pendingSync&&(u[c.id]=!0)}n.documentsPending=u,n.documents=l}else if("items"===e){var h=function(e){var t={};return e=v(e),Object.keys(e).forEach(function(a){var i=e[a],n=i.items;if(i.pendingSync&&(t[i.id]=i.pendingSync),n){Number.NEGATIVE_INFINITY;if(!!n.find(function(e){32!==(32&e.flags)&&e.index})){var r=0;0;for(var s=0;s<n.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[s];o.pendingSync={index:o.index},o.index=s,t[o.id]=!0}}}}),{items:e,itemsPending:t}}(a),f=h.items,p=h.itemsPending;n.items=f,n.itemsPending=p}else if("settings"===e||"boards"===e){var g=function(e){var t={},a={};return e.forEach(function(e){t[e.id]=e,e.pendingSync&&(a[e.id]=e.pendingSync)}),{values:t,pending:a}}(a),m=g.values,y=g.pending;n[e]=m,n[e+"Pending"]=y,"boards"===e&&Object.keys(m).forEach(function(e){m[e]=i.a.boardIn(m[e])})}else if("plugins"===e){var k={};a.forEach(function(e){k[e.plugin]||(k[e.plugin]={}),k[e.plugin][e.id]=e}),n[e]=k}else if("localStorage"===e){var _={};a.forEach(function(e){return _[e.id]=e.value}),n[e]=_}else if("contacts"===e)n[e]=a.map(function(e){return i.a.contactIn(e)});else if("GCalendar"===e||"Gmail"===e||"GmailMessages"===e){var S={};a.forEach(function(e){return S[e.id]=e}),n[e]=S}0===--r&&t(n)},o=!1;for(var l in e.beginBatch(),n)e[l]&&e[l].toArray().then(s.bind(e[l],l)).catch(function(e){o||(o=!0,console.log(e),t({error:{name:e.name,message:e.message}}))});e.commitBatch()},transformItems:v,createItemHierarchy:m,createDB:y}},110:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(11),f=a.n(h),p=a(13),g=a.n(p),m=a(0),v=a(15),y=a(14),k=(i=function(e){function t(e,a,i){var n,s=0;r()(this,t),(n=u()(this,c()(t).call(this,void 0,i)))._destroyed=!1;for(var o=0;o<e.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[o].listen(n.onChanged)}return n._observables=e,a&&m.default.isFunction(a)?n.checkFn=a:n.checkFn="or"===a?n.checkFnOr:n.checkFnAnd,n._value=n.checkFn(),n}return f()(t,e),o()(t,[{key:"checkFnOr",value:function(){for(var e=0,t=!1,a=0;!t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t||this._observables[a].get()}return t}},{key:"checkFnAnd",value:function(){for(var e=0,t=!0,a=0;t&&a<this._observables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=t&&this._observables[a].get()}return t}},{key:"onChanged",value:function(e,t,a){var i=this._value,n=this.checkFn();(n!==i||a)&&this.set(n,a)}},{key:"destroy",value:function(){var e=0;this._destroyed=!0;for(var t=0;t<this._observables.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._observables[t].unlisten(this.onChanged)}}}]),t}(v.a),g()(i.prototype,"onChanged",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"onChanged"),i.prototype),i);t.a=k},116:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(13),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(17),v=a(66),y=a(33),k=a(7),_=a(37),S=a(65),P=a(64),w=p.a.DEBUG_DATE;if(w)var I=function(e,t){for(var a in e)if(e[a]===t)return a;return null};var b,D,E,C,A=new Date(9e12).getTime(),M=new Date(1401606e6),T=", . ? ! ) ( : ; [ ] ' \"".split(" "),L=/^(next|today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,x=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,R=/(?:^(?:[\*_]*?)@|[\(\s](?:[\*_]*?)@)([^\s\)\*_]{2,})(\s[^\s\)@\u2001\u2003\*_]{1,})?(\s[^\s\)@\u2001\u2003\*_]{1,})?/g,O={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(l|n|ly|ne)|aug(ust)?|oct(ober)?|(sep(t)?|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,in:/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?)(?:,|\sand\s)?)$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:x,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},F={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:p.a.RepeatFreq.Daily,weeks:p.a.RepeatFreq.Weekly,months:p.a.RepeatFreq.Monthly,years:p.a.RepeatFreq.Yearly},N={h:1,hr:1,hrs:1,hour:1,hours:1,Hours:1,m:2,min:2,mins:2,Minutes:2,d:3,day:3,days:3,Days:3,"-":1,until:1,to:1,till:1,EndDate:1,for:2,Duration:2},B={duration:/^(-\s|(?:for|until|to|till)\b)/i,len:/^(\d{0,3}(?:\.\d{1,2})?)(h(?:(?:ou)?r(?:s)?)?|m(?:in(?:s)?)?|d(?:ay(?:s)?)?)$/i},U=0,V=0,H=1,j=new(function(){function e(){l()(this,e)}return d()(e,[{key:"translateItemDate",value:function(e){var t,a,i,n=e.text,r=e.date,s=e.repeatDate,o=e.dateFormat||g.default.settings.dateFormat.get(),l=e.completedTime,u=0,d=R;for(d.lastIndex=0;null!==(t=d.exec(n));){var c=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;for(var h=t[0].indexOf("@"),m=(t[1],!1),v=1;v<t.length&&t[v];++v){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(m)t[v]=void 0;else{var y=t[v][t[v].length-1];T.indexOf(y)>=0&&(t[v]=t[v].slice(0,-1),m=!0)}}var k,_=this.parseRepeatDate(s,void 0,o,l,0,n.substr(t.index+h+1));if(_||t[1].startsWith("every")||"in"===t[1]){if(_){k=t.index+h,_.replacedDate&&(n=n.substr(0,k+1)+_.text+n.substr(k+_.repLength+1)),a?a.push(_):a=[_];var S=new Date(_.startDate);if(S.hasTimeOfDay()){D=k+_.text.length+1,E=n.substr(D);if(b=this.parseDuration(S,E,o)){_.oldText.length;i?i.push(b):i=[b]}}break}}else{var P=[t[1]?t[1]:"",t[2]?t[2]:"",t[3]?t[3]:""],w=this.computeDateInfo(r,void 0,o,g.default.International.getCurrentDateFormat(),0,P);if(w.isValid){var I;k=t.index+h,w.replacedDate?(n=n.substr(0,k+1)+w.text+n.substr(k+w.oldText.length+1),I={type:p.a.DateType.Once,date:w.date,dateFormat:w.format,origText:w.oldText,text:w.text,explicitTime:w.date.hasTimeOfDay()}):I={type:p.a.DateType.Once,date:w.date,dateFormat:w.format,origText:w.oldText,text:w.text,explicitTime:w.date.hasTimeOfDay()},a?a.push(I):a=[I];var b,D=k+w.text.length+1,E=n.substr(D);(b=this.parseDuration(w.date,E,o))&&(I.explicitTime||b.duration%f.default.days(1)===0||(I.explicitTime=!0),i?i.push(b):i=[b]);break}}}return{date:a?a[0]:void 0,duration:i?i[0]:void 0}}},{key:"getDurationLength",value:function(e){var t=B.len.exec(e),a=parseFloat(t[1]),i=0;switch(N[t[2].toLowerCase()]){case N.Hours:i=f.default.hours(a);break;case N.Minutes:i=f.default.minutes(a);break;case N.Days:i=f.default.days(a);break;default:try{f.default.PAssert(841,!1,"Invalid duration length: "+t[2])}catch(n){f.default.reportError(n)}}return i}},{key:"parseDuration",value:function(e,t,a){this.setDateTokens(t);var i,n=0;if(this.checkAndParse(B.duration)){if(N[b.toLowerCase()]===N.EndDate)if(this.checkAndParse(x,2)){var r=this.getTimeFromString(b),s=e.clone();s.setHours(r.hour),s.setMinutes(r.min),n=+s-+e}else this.checkAndParseDate(a)&&(n=E?+E-+e:0);else if(N[b.toLowerCase()]===N.Duration){for(var o=0;this.checkAndParse(B.len);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n+=this.getDurationLength(b)}n--}}else{for(var l=0;this.checkAndParse(B.len);){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;n+=this.getDurationLength(b)}n--}return n>0&&(i={durationText:t.substr(1,U).trim(),duration:n}),i}},{key:"getSoftText",value:function(e,t){return t<0?t>=-864e5?"yesterday":e.toString(g.default.International.getFormat(p.a.DFormat.MonthDayYear)):t<=864e5&&e.isToday()?"today":t<1728e5?"tomorrow":void 0}},{key:"runDateParse",value:function(e,t){var a=e.join(""),i=g.default.International.parseDate(a,t);return!i&&e[1]&&(a=e[0]+e[1],i=g.default.International.parseDate(a,t)),!i&&e[0]&&(a=e[0],i=g.default.International.parseDate(a,t)),{dt:i,dateString:a}}},{key:"computeDateInfo",value:function(e,t,a,i,n,r){var s,o,l,u,d=new Date(e).clearTime(),c=(new Date).clearTime(),h=+d-+c,m=t||r.join(""),v=m,y=!1;if(w&&(f.default.log("Prev Date Time: ",d),f.default.log("Curr Date Time: ",c),f.default.log("RawDiff: ",h),f.default.log("DiffDays: ",h/864e5)),this.isFlagSet(n,p.a.ChangeType.Auto)||this.isFlagSet(n,p.a.ChangeType.Remote)&&this.isFlagSet(n,p.a.ChangeType.DocLoad)){if(s=new Date(e),void 0!==e&&(h<0||h>=0&&h<1728e5)){if(L.lastIndex=0,null!==(l=L.exec(m))){if("NEXT"!==m.toUpperCase()&&(o=this.getSoftText(s,h))&&!m.toUpperCase().startsWith(o.toUpperCase())){if(void 0===t)m=(k=this.runDateParse(r,a)).dateString;v=m.replace(l[0],o),y=!0}}else if(null!==(l=x.exec(m))){if((o=this.getSoftText(s,h))&&"today"!==o){if(void 0===t)m=(k=this.runDateParse(r,a)).dateString;v=o+" "+m,y=!0}}else if(void 0===e||void 0===t){(k=this.runDateParse(r,a)).dateString!==t&&(s=k.dt,m=k.dateString,v=k.dateString)}}else if(void 0===e||void 0===t){if(f.default.isDemoMode()||!this.isFlagSet(n,p.a.ChangeType.Auto))s=(k=this.runDateParse(r,a)).dt,v=k.dateString,m=k.dateString;else void 0===e&&(s=void 0)}}else if(this.isFlagSet(n,p.a.ChangeType.Local)||this.isFlagSet(n,p.a.ChangeType.Remote)){if(this.isFlagSet(n,p.a.ChangeType.PluginLoad))s=e?new Date(e):void 0;else s=(k=this.runDateParse(r,a)).dt,m=k.dateString,v=k.dateString}else{var k;s=(k=this.runDateParse(r,a)).dt,m=k.dateString,v=k.dateString}w&&(f.default.log(">>> Date Rollver <<<"),f.default.log(">>> Change Type:  ",I(p.a.ChangeType,n)),f.default.log(">>> Prev Date:    ",new Date(e)),f.default.log(">>> New Date:     ",s),f.default.log(">>> Prev String:  ",m),f.default.log(">>> Trans String: ",o),f.default.log(">>> New String:   ",v),f.default.log("--------------------"));try{f.default.PAssert(842,!s||!isNaN(s.getTime()),"Must be a valid parsed date")}catch(_){f.default.reportError(_)}return a!==i?(u=g.default.International.convertDateFormat(v,a,i),y=!0):u=v,{isValid:!!s,oldText:m,text:u,date:s,format:a,replacedDate:y}}},{key:"getRepeatStartDate",value:function(e){if(e&&"string"===typeof e){var t=e.split("|");if(t.length>3&&"1"===t[0])return new Date(parseInt(t[1]))}}},{key:"setDateTokens",value:function(e){b="",D=e.split(" "),H=1,U=D[0].length,V=0,E=void 0}},{key:"checkAndParse",value:function(e,t){var a=!1;if(w&&void 0===e&&f.default.log("INVALID TOKEN TYPE"),void 0===(t=void 0!==t&&t>1?Math.min(D.length-H,t):t)||1===t)H<D.length&&(a=D[H].match(e))&&(b=D[H],H++,U+=b.length+1);else if(t>1&&H+t<=D.length)for(var i=0,n=t;n>0;n--){var r=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s="",o=0;o<n;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s+=D[H+o],o+1!==n&&(s+=" ")}if(a=!!s.match(e)){b=s,H+=n,U+=s.length+1;break}}return a}},{key:"checkAndParseDate",value:function(e){var t=!1;if(H+1<D.length&&!D[H+1].match(O.at)){var a=g.default.International.parseDate(D[H]+" "+D[H+1],e);a&&(t=!0,b=D[H]+D[H+1],E=a,H+=2,U+=b.length+2)}if(!t&&H<D.length){var i=g.default.International.parseDate(D[H],e);i&&(t=!0,b=D[H],E=i,H++,U+=b.length+1)}return t}},{key:"computeStartDate",value:function(e,t,a,i,n,r){var s=r||new Date,o=(r?new Date(r):new Date).clearTime();(void 0!==i&&o.setMonth(i),void 0!==a)&&(a>0&&a<=31&&((Date.getDaysInMonth(o.getFullYear(),o.getMonth())<a||a<o.getDate())&&void 0===i&&o.addMonths(1),o.setDate(a)));return void 0!==t?(o.moveToNthOccurrence(e,t),o.isBefore(s)&&(o.addMonths(1),o.moveToNthOccurrence(e,t))):void 0!==e&&o.getDay()!==e&&(o.moveToDayOfWeek(e,-1),o.isBefore(s)&&o.moveToDayOfWeek(e)),void 0!==i&&o.isBefore(s)&&(o.addYears(1),o.setMonth(i)),n&&this.updateDateWithTime(o,n),o}},{key:"updateDateWithTime",value:function(e,t){var a=this.getTimeFromString(t);e.setHours(a.hour),e.setMinutes(a.min),e.setMilliseconds(1)}},{key:"getTimeFromString",value:function(e){var t,a,i,n,r=x.exec(e),s=0;void 0!==r[1]?(a=(t=r[3].toUpperCase())===Date.CultureInfo.pmDesignator[0]||t===Date.CultureInfo.pmDesignator,s=f.default.parseInt(r[1])+(a?12:0),i=r[2]?f.default.parseInt(r[2]):0,n=r[1]):void 0!==r[4]&&void 0!==r[5]&&(s=f.default.parseInt(r[4]),i=f.default.parseInt(r[5]),n=r[4]);var o=!1;if(n){var l=f.default.parseInt(n);(n.startsWith("0")||0===l||l>12)&&(o=!0)}return t||o?t&&!o&&(a||12!==s?a&&24===s&&(s=12):s=0):s<8&&(s+=12),{hour:s,min:i}}},{key:"parseRepeatDate",value:function(e,t,a,i,n,r){var s,o,l,u,d,c,h,m,v=!1,y=Date.today(),k=p.a.RepeatFreq.Daily,_=1;if(r.match(O.repeat)){this.setDateTokens(r);var S=!1;if(this.checkAndParse(O.recur)){switch(b){case"other":_=2;break;case"last":k=p.a.RepeatFreq.NthMonthInst,c=-1;break;default:k=p.a.RepeatFreq.NthMonthInst,c=F[b.substr(0,3).toLowerCase()]}S=!0,w&&f.default.log("Parse Recur: ",b)}if(S&&"other"!==b||!this.checkAndParse(O.date))if(!S&&this.checkAndParse(O.count)){var P=f.default.parseInt(b);isNaN(P)&&(P=F[b]),this.checkAndParse(O.measure)&&(k=F[b.toLowerCase()],_=P,v=!0,w&&f.default.log("Parse Measure: ",b))}else if(this.checkAndParse(O.day)){var I,D=0;for(k!==p.a.RepeatFreq.NthMonthInst&&(k=p.a.RepeatFreq.Weekly),d=F[b.substr(0,3).toLowerCase()],w&&f.default.log("Parse Day: ",b);(b.endsWith(",")||this.checkAndParse(O.delim))&&this.checkAndParse(O.day);){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;var C=F[b.substr(0,3).toLowerCase()];I?I.push(C):I=[d,C],w&&f.default.log("Parse Day: ",b)}I&&(I.sort(),l=I),v=!0}else if(this.checkAndParse(O.daysOfWeek))k=p.a.RepeatFreq.Weekly,"weekday"===b?l=[1,2,3,4,5]:"weekend"===b&&(l=[0,6]),v=!0;else if(this.checkAndParse(O.month)){var T=b;if(w&&f.default.log("Parse Month: ",b),this.checkAndParse(O.date)){var L=parseInt(b);L>0&&L<=31&&(h=L,m=F[T.substr(0,3).toLowerCase()],k=p.a.RepeatFreq.Yearly,v=!0,w&&f.default.log("Parse Date: ",b))}}else if(S&&"other"!==b||!this.checkAndParse(O.len))if(S&&"last"!==b||!this.checkAndParse(O.len))S&&"other"!==b&&(k=p.a.RepeatFreq.DayOfMonth,h=c,c=void 0,v=!0);else switch(b){case"day":v=!0,k=p.a.RepeatFreq.EndOfMonthOffset}else{switch(b){case"day":k=p.a.RepeatFreq.Daily;break;case"week":k=p.a.RepeatFreq.Weekly;break;case"month":k=p.a.RepeatFreq.Monthly;break;case"year":k=p.a.RepeatFreq.Yearly;break;case"morning":k=p.a.RepeatFreq.Daily,u="9:00am";break;case"afternoon":k=p.a.RepeatFreq.Daily,u="2:00pm";break;case"night":k=p.a.RepeatFreq.Daily,u="7:00pm"}v=!0,w&&f.default.log("Parese Length: ",b)}else{var x,R=0,N=f.default.parseInt(this.trimPunc(b));for(w&&f.default.log("Parse Date: ",b);(b.endsWith(",")||this.checkAndParse(O.delim))&&this.checkAndParse(O.date);){if(R++>5e3&&__infLoop&&__infLoop(R))throw new RangeError;var B=f.default.parseInt(this.trimPunc(b));B>0&&B<=31&&(x?x.push(B):x=[N,B],w&&f.default.log("Parse Date: ",b))}x&&x.length>1?(x.sort(f.default.numberComparator),k=p.a.RepeatFreq.DayOfMonth,h=x[0],l=x,v=!0):N>0&&N<=31&&(isNaN(N)||(k=p.a.RepeatFreq.DayOfMonth,h=N,v=!0),this.checkAndParse(O.measure)?(k=F[b.toLowerCase()],_=N,h=void 0,v=!0,w&&f.default.log("Parse Measure: ",b)):(this.checkAndParse(O.of),this.checkAndParse(O.month)&&(h=N,m=F[b.substr(0,3).toLowerCase()],k=p.a.RepeatFreq.Yearly,v=!0,w&&f.default.log("Parse Month: ",b))))}var H=!1;this.checkAndParse(O.at)&&(H=!0,w&&f.default.log("Parse At: ",b)),this.checkAndParse(O.time,2)&&(u=b,v=!0,w&&f.default.log("Parse Time: ",b));var j,z,q,W=!1,G=!1;if(this.checkAndParse(O.in))G=!0,this.checkAndParse(O.month)&&(z=F[b.substr(0,3).toLowerCase()]),this.checkAndParse(O.year)&&(q=parseInt(b)),void 0===z&&void 0===q||(o=new Date,j=new Date,W=!0,q&&(o.setYear(q),o.setMonth(11),j.setYear(q),j.setMonth(0)),void 0!==z&&(void 0!==q&&(o.getMonth()>z&&o.addYears(1),j.getMonth()>z&&j.addYears(1)),o.setMonth(z),j.setMonth(z)),o.moveToLastDayOfMonth(),j.setDate(1));var K=U+1,Y=U;this.checkAndParse(O.from)?(K=U+1,this.checkAndParseDate(a)&&(W&&!E.isAfter(j)||(j=E),W=!1,V=U,w&&f.default.log("Parse From: ",b))):V=U;var X=!1;H||u||(this.checkAndParse(O.at)&&(H=!0,X=!0,w&&f.default.log("Parse Post-At: ",b)),this.checkAndParse(O.time,2)&&(u=b,X=!0,w&&f.default.log("Parse Post-Time: ",b))),G||this.checkAndParse(O.until)&&this.checkAndParseDate(a)&&(o=E,X=!0,w&&f.default.log("Parse until: ",b)),o&&o.isBefore(j)&&(v=!1)}else"everyday"===r&&(this.setDateTokens(r),v=!0,k=p.a.RepeatFreq.Daily,_=1);if(v){var Q=this.getRepeatStartDate(e),J=this.isFlagSet(n,p.a.ChangeType.Remote)?Q:j;if(l&&k===p.a.RepeatFreq.Weekly)for(var Z=0,$=(J||new Date).getDay(),ee=0;ee<l.length;++ee){if(Z++>5e3&&__infLoop&&__infLoop(Z))throw new RangeError;if(l[ee]>=$){d=l[ee];break}}var te=!!(y=this.computeStartDate(d,c,h,m,u,J));if(y&&(y.isBefore(M)&&(te=!1),o&&o.isBefore(y)&&(te=!1)),te){var ae,ie,ne=!1,re=r.substr(0,U);if(!i&&j&&e&&!W){ie=r.substr(K,V);var se=this.computeDateInfo(Q,void 0,a,a,n,[ie]);se.replacedDate&&(ie=se.text)}else i&&i!==A&&(this.isFlagSet(n,p.a.ChangeType.Text)||(ie=g.default.International.formatDate(new Date(i),p.a.DFormat.MonthDayYear,a)));if(ie){var oe=r.substr(K,V);if(oe.toUpperCase()!==ie.toUpperCase()){w&&f.default.log("Replaced From Date: ",oe,"->",ie);var le=g.default.International.parseDate(ie,a);le&&(u&&this.updateDateWithTime(le,u),re=re.substr(0,Y)+" from "+ie+(X?re.substr(V):""),ae=le.getTime(),ne=!0)}}var ue,de=r.substr(0,U),ce=g.default.International.getCurrentDateFormat();a!==ce?(ue=g.default.International.convertDateFormat(re,a,ce),ne=!0):ue=re,s={type:p.a.DateType.Repeat,repLength:U,oldText:de,text:ue,dateFormat:a,startDate:ae||y,endDate:o,frequency:k,separation:_,offsets:l,replacedDate:ne},w&&(f.default.log("Start: ",ae||y),f.default.log("End: ",o),f.default.log("Freq: ",k),f.default.log("Sep: ",_),f.default.log("Offsets: ",l?l.toString():void 0))}}return s}},{key:"getNowRelativeDate",value:function(e){var t;switch(e.toUpperCase()){case"NOW":t=Date.today().add({hours:11});break;case"NEXT":t=Date.today().add({hours:12});break;case"SOON":t=Date.today().add({days:2});break;case"LATER":t=Date.today().add({days:5});break;case"SOMEDAY":t=Date.today().add({days:14});break;default:try{f.default.PAssert(843,!1,"Must supply a valid now relative date string")}catch(a){f.default.reportError(a)}}return t}},{key:"isDateSoft",value:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"isFlagSet",value:function(e,t){return!1}}]),e}()),z=a(60),q=a(61),W=a(15),G=a(41),K=a(67),Y=a(14),X=f.default.invertObject({isArchived:"a",dateCreated:"c",date:"d",duration:"e",formats:"f",durationText:"g",favorites:"h",items:"i",isNote:"k",modifiedOffline:"l",isCollapsed:"m",note:"n",modifiedOfflineText:"o",priority:"p",dateFormat:"q",repeatDate:"r",dateText:"s",text:"t",versionText:"u",version:"v",isDeleted:"x",isComplete:"z",archivedItems:"ai",allDayDate:"ad",id:"id",isStarred:"*",dateCompleted:"^"}),Q={docSharing:"docSharing",paneState:"paneState",noSounds:"noSounds",lastMessageSync:"lastMessageSync",shownInstallInfo:"shownInstall",lastCalendarSync:"lastCalendarSync",lastEventSync:"lastEventSync",lastEventFullSync:"lastEventFullySync",calendarsImport:"calendarsImport",calendarExport:"calendarExport",syncGoogle:"syncGoogle",searchExpandsCollapsed:"searchExpandsCollapsed",pluginDrive:"pluginDrive",pluginGmail:"pluginGmail",layoutTheme:"layoutTheme",bulletColor:"bulletColor",bullerColor:"bullerColor",showBullets:"showBullets",verticalLinesColor:"verticalLinesColor",boards:"boards",enableOfflineAuth:"enableOfflineAuth"},J={grayscale:"grayscale",boldHeaders:"boldHeaders",indentSize:"indentSize",itemPadding:"itemPadding",itemIndentSize:"itemIndentSize",showVerticalLines:"showVerticalLines",fontSize:"fontSize",itemLineHeight:"itemLineHeight",paneHistoryMobile:"paneHistoryMobile"},Z=f.default.invertObject({theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",lastTaskSync:"lastTaskSync",lastQuickAddSync:"lastQuickAddSync",disableNotifications:"disableNotifications",notificationDelay:"notificationTime",rootFolderId:"rootFolderId",attachFolderId:"attachFolderId",backupFolderId:"backupFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",localRecoverVersion:"localRecoverVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",userId:"userId",displayName:"displayName",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",closedImport:"closedImport",closedHelps:"closedHelps",oauthScheme:"oauthScheme",premiumStatus:"zzp",enableOfflineAuth:"enableOfflineAuth",trialStart:"pzs",trialDuration:"pzd",trialExtended:"pze",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon",inTooltipIntro:"inTooltipIntro",keyboardToolbarScroll:"keyboardToolbarScroll",defaultItemPrefix:"defaultItemPrefix",showMarkdown:"showMarkdown",calendarCustomDays:"calendarCustomDays",selectFullItems:"selectFullItems",showFormattingToolbar:"showFormattingToolbar",showImagesInline:"showImagesInline",dayWeekStart:"dayWeekStart",trialOverHidden:"trialOverHidden",bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale",helpState:"helpState",localPaneState:"localPaneState",selectedBoard:"selectedBoard",paneHistoryMobile:"paneHistoryMobile",cacheSizeRatio:"cacheSizeRatio",monthlyInvoice:"monthlyInvoice",invoiceEmail:"invoiceEmail",invoiceCompany:"invoiceCompany",invoiceAddress:"invoiceAddress",isUnsubscribed:"isUnsubscribed",showSidebar:"showSidebar",sidebarWidth:"sidebarWidth",openEvernoteApp:"openEvernoteApp",closedVideo:"closedVideo",agendaSort:"agendaSort",dateFormat:"dateFormat",lastBackup:"lastBackup",needsBackup:"needsBackup",backupFrequency:"backupFrequency",encryptionKey:"encryptionKey",DefaultGroup:"Default",UISettingsGroup:"UISettings"}),$=(C=function(){function e(){l()(this,e),this.backing=S.a,this.waitingText=new W.a,this.documentsObs=new W.a({}),this.errorGapiImport=new W.a,this.showTryAgain=new W.a(!0)}return d()(e,[{key:"authAndImportDocuments",value:function(){this.authAndOpenModal(!0,this.listDocuments)}},{key:"authAndImportServer",value:function(e){var t=this;this.authAndOpenModal(!1,function(){t.doAuth().then(function(a){t.showTryAgain.set(!1),t.importServer(a,function(t){g.default.menus.closeModal(p.a.Modals.ImportMoodo),e(t)})})})}},{key:"authAndOpenModal",value:function(e,t){this.waitingText.set("Waiting for authentication...<br><br>You should see a popup window asking you to sign into your Moo.do account. If the popup doesn't open, please try again or contact support if it doesn't work."),t(),g.default.menus.openModal(p.a.Modals.ImportMoodo,{importer:this,backdropClose:!1,withDocuments:e,tryAgain:t})}},{key:"doAuth",value:function(){return new Promise(function(e,t){G.a.ensureGapi(function(){if(window.gapi&&window.gapi.auth){var a={client_id:"597847337936.apps.googleusercontent.com",scope:[p.a.GScope.Drive,"https://www.googleapis.com/auth/drive.appdata"].join(" "),immediate:!1,include_granted_scopes:!0,response_type:"token id_token",authuser:-1,prompt:"consent"};window.gapi.client.init({apiKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50"}).then(function(){window.gapi.auth.authorize(a,function(a){a&&!a.error?e(a):t("Error authorizing Google: "+a.error)})})}else t("Could not load Google APIs")})})}},{key:"listDocuments",value:function(){var e=this;this.doAuth().then(function(t){e.showTryAgain.set(!1),e.importServer(t,function(a){!0===a?(e.dateTime=Date.now(),e.waitingText.set("Getting documents list..."),e.getDataFromGapi(t,function(a,i){window.gapi.client.init({client_id:"597847337936.apps.googleusercontent.com"}).then(function(){e.token=t,e.settings=a,e.documents=i,e.waitingText.set("",!1),e.documentsObs.set(i)})})):g.default.toasts.pushMessage({text:"Error importing: ".concat(a),hold:!0})})}).catch(function(t){return e.errorGapiImport.set(t)})}},{key:"importWithDocuments",value:function(e){var t=this,a={};e.forEach(function(e){a[e]=t.documents[e]});try{f.default.PAssert(559,this.settings,"No settings")}catch(i){f.default.reportError(i)}this.settings&&this.importSettings(),g.default.DisplaySettings.init(),this.importDocuments(a),this.boards&&(this.importBoardsToFirebase(this.boards,a),y.a.setSelectedIndex(0,!0))}},{key:"getDataFromGapi",value:function(e,t){var a=this,i={maxPageResults:999,maxPages:12,token:e};g.default.remoteAPI().driveFilesList("mimeType='application/vnd.google-apps.drive-sdk.597847337936'",function(i){var n,r={};Promise.all(i.map(function(t){return new Promise(function(i){a.getDocument(e,t,function(e){if(e&&e.data)if(t.appDataContents){n=a.parseNode(e.data.value.settings);try{f.default.PAssert(560,n,"Failed to parse settings",e.data.value.settings)}catch(o){f.default.reportError(o)}}else if(!t.labels.trashed){var s=a.translateDocument(a.parseNode(e.data),!0);s.id=t.id,s.text=t.title,s.date=new Date(t.createdDate),r[t.id]=s}i()})})})).then(function(){t(n,r)}).catch(function(e){return f.default.reportError(e)})},function(e){t()},i)}},{key:"parseNode",value:function(e){var t,a=this;if("Map"===e.type){var i=e.value;t={id:e.id},Object.keys(i).forEach(function(e){t[e]=a.parseNode(i[e])})}else"List"===e.type?(t=[],e.value.forEach(function(e,i){t[i]=a.parseNode(e)})):e.json&&(t=void 0!==e.json.value||e.json.ver?e.json.value:e.json);return t}},{key:"getDocument",value:function(e,t,a){var i={token:e};g.default.remoteAPI().realtimeFileGet(t.id,function(e){a(e)},function(e){a()},i)}},{key:"importDocuments",value:function(e){var t=this;Object.keys(e).forEach(function(a){var i=e[a],n=v.a.create({id:a,text:i.text,rootData:i.root,backing:t.backing});m.a.addDocument(n)})}},{key:"importSettings",value:function(){var e=this;Object.keys(this.settings).forEach(function(t){var a=e.settings[t];"id"!==t&&Object.keys(a).forEach(function(i){var n=("UISettings"===t?"ui":"Default"!==t&&t)||"";"theme"===i&&(n="ui");var r=a[i];if("workspaces"===i)e.boards=JSON.parse(r);else if("id"!==i){var s="Default"===t||"UISettings"===t?Z[i]:i;if(!Q[i]&&("Default"!==t||!J[i])&&s){var o=n?g.default.settings[n]:g.default.settings;if(o){var l=o[s];0,l&&(("syncContacts"===s||"syncAccounts"===s||t.startsWith("plugin")&&"isEnabled"===s)&&(r=!1),l.set(r,!1),g.default.settings._save(s,n,r))}}}})})}},{key:"importBoardsToFirebase",value:function(e,t){var a=[],i=0;Object.keys(e).forEach(function(n){t[n]&&e[n].workspaces.forEach(function(e){e.index=i++,e.panes.forEach(function(e){e.document=n}),m.a.saveBoard(e),a.push(e)})}),y.a.setBoards(a)}},{key:"translateDocument",value:function(e,t){var a=e.root||e.docRoot;return e.root=this.translateItem(a,t,a,!1),e}},{key:"translateItem",value:function(e,t,a,i,n){var r=this,s=p.a.VMLIFlag.None,o={index:n};if(e===a&&(o.isRoot=!0,a=o),Object.keys(e).forEach(function(n){var s=e[n],l=t?X[n]:n;f.default.isArray(s)?s=s.length>0?s.map(function(e,i){return r.translateItem(e,t,a,"archivedItems"===l,i)}):void 0:f.default.isObject(s)&&(s=r.translateItem(s,t,a,!1)),"archivedItems"===l&&s&&(i?l="items":(a.archivedItems||(a.archivedItems=[]),s.forEach(function(e){e.isArchived=!0,e.parent=a.id}),a.archivedItems.pushArray(s),s=void 0)),l&&s&&(o[l]=s),o.undefined}),o.isComplete&&(s|=p.a.VMLIFlag.Complete,delete o.isComplete),o.isStarred&&(s|=p.a.VMLIFlag.Starred,delete o.isStarred),o.priority&&(s|=o.priority,delete o.priority),o.isNote)s|=p.a.VMLIFlag.Note,delete o.isNote;else try{this.translateItemDate(o)}catch(l){f.default.reportError(l,o.text)}return o.dateFormat||(o.dateFormat="mdy"),delete o.version,delete o.versionText,o.flags=s,o}},{key:"replaceText",value:function(e,t,a){return t&&(t="@"+t+(a?" "+a.durationText:""),e=e.replace(t,p.a.CharDate)),e}},{key:"translateItemDate",value:function(e){if(e.text&&(e.date||e.repeatDate)){var t=j.translateItemDate(e),a=t.date,i=t.duration;if(a){var n;if(e.text=e.text.replace(/@(next|soon|later|someday|now)/i,"#$1"),e.text=this.replaceText(e.text,a.text,i),e.text=this.replaceText(e.text,a.origText,i),e.text=this.replaceText(e.text,a.oldText,i),e.text=f.default.trimRight(e.text.replace(/  /g," ")),j.isDateSoft(a.text))delete e.date;else{if(a.type===p.a.DateType.Repeat){var r=a.text||a.origText;n=P.a.parseText(r)}else n=new z.a(new Date(e.date));if(i){var s=Math.round(i.duration);n.setDuration(s)}if(e.text.indexOf("p:GCalendar")>=0){var o=q.a.parseText(e.text),l=o.attachments;o.parsedText;if(l.length>0){var u=l[0];n.gcalId=u.id;var d="\u2001p:"+u.p+",id:"+u.id+(u.calendarID?"(?:,calendarID:"+u.calendarID+")":"")+"\u2001";e.text=e.text.replace(new RegExp(d),"")}}try{f.default.PAssert(561,n,"Was not able to import date",a)}catch(c){f.default.reportError(c)}n&&(e.date=n.toData())}delete e.dateText,delete e.dateFormat,delete e.repeatDate}}}},{key:"importServer",value:function(e,t){var a,i;if(this.waitingText.set("Importing user data..."),e&&e.id_token){var r=e.id_token,o=r.split(".");try{f.default.PAssert(562,o&&3===o.length&&o[0]&&o[1]&&o[2],"A valid JWT should always have three parts: "+r)}catch(g){f.default.reportError(g)}try{var l=JSON.parse(f.default.b64_to_utf8(o[1]));a=l.email.toLowerCase(),i=l.sub}catch(m){f.default.reportError(m,e.id_token)}}if(a&&i){var u={email:a,gid:i},d={gid:i,id_token:e.id_token,token:e},c=k.a.getDeployVar(p.a.DeployVariable.APIHost),h=["billingID","gid","inviteCode","invoiceAddress","invoiceCompany","invoiceEmail","joinDate","monthlyInvoice","nextBillingDate","planID","premiumCode","premiumSignupDate","premiumEndDate","premiumStatus","subscriptionID","trialDuration","trialStart","earlyAdopter","isUnsubscribed"];f.default.XHR({type:"POST",url:"https://".concat(c,"/private/v1/billing/getFullInfo"),data:u,headers:d,autoRetry:!0,maxRetries:6}).then(function(){var e=s()(n.a.mark(function e(a){var i,r,s;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(200!==a.status){e.next=17;break}return e.next=3,a.json();case 3:if(!(i=e.sent)){e.next=11;break}r=i.data,Object.keys(r).forEach(function(e){h.indexOf(e)<0&&delete r[e]}),r=_.a.userOut(r),K.a.createURL("user/migrateUser",{}).then(function(e){fetch(e,{method:"POST",body:JSON.stringify(r)}).then(function(e){200===e.status?t(!0):t(e.status)})}),e.next=15;break;case 11:return e.next=13,a.text();case 13:s=e.sent,t(!1,s);case 15:e.next=18;break;case 17:t(a.status);case 18:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}())}}}]),e}(),h()(C.prototype,"listDocuments",[Y.a],Object.getOwnPropertyDescriptor(C.prototype,"listDocuments"),C.prototype),C);t.a=$},118:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=function(){function e(t){n()(this,e),this.isLocalOnly=t,this.documents={}}return s()(e,[{key:"renameDocument",value:function(e,t){}}]),e}();t.a=o},119:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(17),l=a(8),u=a(1),d=function(){function e(){n()(this,e)}return s()(e,[{key:"onRemoteChange",value:function(e,t,a,i){var n=o.a.getItem(a),r=u.a.ChangeType.Remote;i.parent||t&&(i.parent=t.parent);var s=o.a.getItem(i.parent);if(s){if(l.d.beginAction(),n){if(32===(32&i.flags))!!(n.isDeleted()||i.isDeleted?void 0:n)!==s.hasNote()&&s.setNote(n.isDeleted()||i.isDeleted?void 0:n,r);n.onChangeRemote(i,r)}else if(!t||!t.isDeleted){var d=Object.assign({},t,i);(n=o.a.createVMLI(d,{parent:s,changeType:r,documentOwner:e})).onChangeRemoteParentOrIndex({id:d.id,parent:d.parent,index:d.index,flags:d.flags})}l.d.endAction()}}}]),e}();t.a=new d},120:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(2),v=a.n(m),y=a(21),k=a(7),_=a(53),S=a(63),P=a(4),w=a(27),I=a(45),b=a(157),D=a(59),E=a(20),C=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.refInput=v.a.createRef(),this.refSearchBox=v.a.createRef()}},{key:"onMount",value:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),this.forceUpdate()}},{key:"getState",value:function(){for(var e=0,t=this.props.pane,a=t.search,i={search:a.value,calendars:S.a.GCalendarsAvailable,displayCalendars:t.displayCalendars,displayLocalItems:t.displayLocalItems},n=0;n<a.filters.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a.filters[n];i[r.name]=r.value,i[r.name+"Enabled"]=r.enabled}return i}},{key:"onChange",value:function(e){this.props.pane.search.setValue(e)}},{key:"onParsed",value:function(e){this.props.pane.search.onParsed(e)}},{key:"setSearch",value:function(e,t){this.props.pane.search.setValue(e),!1!==t&&this.setSelectionOffset(e.length)}},{key:"getSelectionOffset",value:function(){return this.refInput.current.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.refInput.current.setSelectionOffset(e)}},{key:"onFocus",value:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=P.a.save(),P.a.reset(),t.isFocused.set(!0),_.a.hide(),f.default.sendEvent("SearchFocus","Desktop"),t.filters.length>0&&!g.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&g.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id,element:this.refSearchBox.current,positionOffset:{top:4},noBackdrop:!0,pane:e,showFilters:this.props.showFilters,onClosed:this.blur}))}},{key:"onBlur",value:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1)}},{key:"focus",value:function(){this.refInput.current.focus(),this.refInput.current.selectEnd()}},{key:"blur",value:function(){this.refInput.current&&this.refInput.current.blur()}},{key:"onTapX",value:function(e){var t=this.props.pane;if(this.state.search.length>0){var a=P.a.save();this.setSearch("",!1),a&&t.restoreSelection(a),f.default.preventDefault(e),f.default.sendEvent("Menu","ClearSearch")}else this.focus(),f.default.sendEvent("Menu","FocusSearch")}},{key:"onKeyDown",value:function(e){if(this.saveScrollOfTop(),k.a.mac&&e.ctrlKey&&e.keyCode===p.a.KeyCode.T)return f.default.preventDefault(e),this.blur(),void I.a.hotkeyAddPane();var t=this.props.pane;e.keyCode===p.a.KeyCode.Enter&&(t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length));if(e.keyCode===p.a.KeyCode.Tab||e.keyCode===p.a.KeyCode.Enter){var a=t.indexOfFirstItem();if(a>=0){var i=a,n=this._selectionBeforeBlur;n&&(P.a.restore(n)?(this._selectionBeforeBlur=void 0,i=n.startIndex):n=null),n||(this.blur(),t.selectIndex(a,0),setTimeout(function(){t.selectIndex(a,0)},0)),P.a.focusPane(t),i>=0&&f.default.focusedPane.scrollIndexIntoView(i,p.a.ScrollDuration.Default)}else t.type===p.a.PaneMode.Task&&t.addItem({e:e});e.preventDefault(),e.stopPropagation()}}},{key:"onAutocompleteSelected",value:function(e){if(e.item){var t=this.props.pane.search,a=t.getValue(),i=a.indexOf(p.a.PrefixItemAutocomplete);a=a.substr(0,i),t.setValue(a),this.props.pane.zoomIn(e.item,{forLoad:!1,showToast:!1,noSel:!0}),this.setSelectionOffset(a.length)}this.refInput.current.updateAutocomplete(),this.focus()}},{key:"onClickFilters",value:function(){this.focus()}},{key:"onClickPriority",value:function(){this.props.pane.search.setFilter("priority",0)}},{key:"onClickText",value:function(e){if(e.altKey){var t,a,i;if(f.default.hasClass(e.target,"fancyInputInput")){var n=w.default.getSelectionRange().getNativeRange();if(n){var r=(t=n.cloneRange()).startContainer.nodeValue;if(f.default.isString(r)){for(var s=0,o=0,l=0,u=r.length,d=t.startOffset;d>=0;d--){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(" "===r[d]||160===r.charCodeAt(d)){l=d+1;break}}for(d=t.endOffset;d<r.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(" "===r[d]||160===r.charCodeAt(d)){u=d;break}}a=u-l,i=l}}}else(t=w.default.createSelectionRange()).selectNodeContents(e.target),i=t.startOffset,a=t.toString().length;if(t&&!isNaN(i)&&a){t.setEnd(t.startContainer,i),t.setStart(t.startContainer.parentNode,0);var c=t.toString().length,h=this.props.pane.search,p=h.getValue();g.default.PaneUpdateBatcher.beginUpdateItems(),p=(p.substr(0,c)+p.substr(c+a)).replace(/  +/g," ").trim(),h.setValue(p),g.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(c)}}}},{key:"saveScrollOfTop",value:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)}},{key:"renderSearchButton",value:function(e){var t=this.props.pane;return v.a.createElement(b.a,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===p.a.VMLIFlag.P0?0:e===p.a.VMLIFlag.P1?1:e===p.a.VMLIFlag.P2&&2,a=f.default.classNames("searchPriority searchP"+t+" selected");return v.a.createElement("span",{key:"priority",className:a,onClick:this.onClickPriority})}},{key:"render",value:function(){var e=this.props,t=this.state,a=e.pane,i=a.search,n=t.search,r=n.length>0?"icon-close":"",s=p.a.SearchHeight,o=[];if(!1!==e.showFilters){for(var l=0,u=0;u<i.filters.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=i.filters[u];d.enabled.get()&&d.value.get()&&(d.icon?g.default.settings.testBetaFeatures.get()&&d.hideInView||o.push(this.renderSearchButton(d)):"priority"===d.name&&o.push(this.renderSearchPriority()))}a.isViewDates()&&a.isCalFilterActive()&&o.push(v.a.createElement("div",{key:"dateFilter",className:"searchButton icon-calendar selected yes",onClick:this.onClickFilters}))}var c=v.a.createElement(E.a,{className:"searchX c-button noShrink",width:24,height:s,icon:r,onClick:this.onTapX}),h=v.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},v.a.createElement(D.a,{ref:this.refInput,className:"search",id:"search",height:s,value:n,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refSearchBox.current,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:a.supportSearchItemAutocomplete,canAutocompleteItems:a.type===p.a.PaneMode.Task,noShowAutocomplete:!0,isSearch:!0,pane:a}));return v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:"searchWrap"},v.a.createElement("div",{className:"searchBox c-bg-light c-border-light flexbox",ref:this.refSearchBox},v.a.createElement("div",{className:"searchBoxInner flexbox"},h,c),o.length>0&&v.a.createElement("div",{className:"searchButtons noShrink"},o))))}}]),t}(y.a);t.a=C},121:function(e,t,a){"use strict";var i,n,r,s=a(5),o=a.n(s),l=a(6),u=a.n(l),d=a(13),c=a.n(d),h=a(0),f=a(23),p=a(1),g=a(3),m=a(17),v=a(8),y=a(7),k=a(15),_=a(10),S=a.n(_),P=a(9),w=a.n(P),I=a(11),b=a.n(I),D=a(42),E=a(4),C=a(49),A=function(){function e(){o()(this,e),this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new C.a}return u()(e,[{key:"kill",value:function(e){this.isLive=!1,this.index=-1,e?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0}},{key:"update",value:function(e,t,a,i,n,r){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isLive&&e===this.index&&t===this.width&&a===this.height&&i===this.offset&&r===this.paneObject||(this.isLive=!0,this.index=e,this.width=t,this.height=a,this.paneObject=r,this.offset=i,this.prevOffset=n,this.cellChanged.notify())}},{key:"getState",value:function(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}}]),e}(),M=a(24),T=a(77),L=a(14),x=(i=function(e){function t(e){var a;return o()(this,t),(a=S()(this,w()(t).call(this)))._pane=e.pane,a._isOverview=e.isOverview,a._itemsObs=e.itemsObs,a._getItemsList=e.itemsFn,a.minItemSize=e.minItemSize,a}return b()(t,e),u()(t,[{key:"objectAtIndex",value:function(e){var t=this._getItemsList();try{h.default.PAssert(1621,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(a){h.default.reportError(a)}return t[e]}},{key:"itemAtIndex",value:function(e){var t=this._getItemsList();try{h.default.PAssert(1622,e>=0&&e<t.length,"Invalid item index: "+e,t.length,this._pane.type)}catch(i){h.default.reportError(i)}var a=t[e];return a&&a.item}},{key:"indexOfItem",value:function(e,t,a){for(var i,n=0,r=h.default.isVMLI(e),s=this._getItemsList(),o=0;o<s.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=s[o];if(r){if((l===e||l.item===e)&&(!l.type||"blockItem"===l.type)&&(!t||!l.block||l.block.id===t.id))return o}else{if(l.id===e.id)return o;l.item&&l.item===e.item&&(i||(i=[]),i.push({index:o,item:l}))}}if(i){if(a){var u,d,c=0;for(o=0;o<i.length;o++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=Math.abs(i[o].index-a);(isNaN(d)||f<u)&&(d=o,u=f)}return i[d].index}return i[0].index}return-1}},{key:"handleItemNoteSet",value:function(e){this.clearItemInfoForItem(e.item)}}]),t}(T.a),c()(i.prototype,"handleItemNoteSet",[L.a],Object.getOwnPropertyDescriptor(i.prototype,"handleItemNoteSet"),i.prototype),i),R={None:0,OnScroll:1},O=function(e){function t(e){var a;return o()(this,t),(a=S()(this,w()(t).call(this,e))).getHeight=e.heightFn,a.getWidth=e.widthFn,a.hasSetHeightOnce=!1,a.scrollHandler=void 0,a._mobilePadBottom=!1,a.contentSize=new k.a(0),a.paddingBottom=new k.a(0),a._timeoutPointerEvents=void 0,a.disablePointerEvents=new k.a(!1),a._direction=p.a.Direction.None,a._scrollTop=0,a._lastProcessedScrollTop=0,a._itemInfoById={},a._savedScrollOfTop={},a._indexOfTop=0,a._inViewCount=0,a._reactList=void 0,a._isMounted=!1,a._panePadding=0,a.cellsObs=new D.a([]),a.cells=a.cellsObs.get(),a.cellsNew=[],a._tops=[],a.scrollListeners=[],a.offscreenScrollPadding=400,a._phase=R.None,a.init(),a}return b()(t,e),u()(t,[{key:"_validateCells",value:function(){}},{key:"init",value:function(){f.a.binder(this,"onListChanged","_onSettingChanged","_onResize","_onScroll","_handleScroll","handleItemTextChanged","_onTimeoutPointerEvents","_computeRenderItemsBatched","_onSetScrollComplete","_onSetScrollCompleteTimeout","_afterSetScrollComplete","reMount","onImageLoaded")}},{key:"getID",value:function(){return this._pane.id+(this._isOverview?"_o":"")}},{key:"notifyInit",value:function(e){this._pane.setIgnoreRestoreScroll();try{h.default.PAssert(1600,!this._isMounted,"Should not initialize a pane twice")}catch(t){h.default.reportError(t)}this.clearCache(),this.allocateCells(),this.onListChanged(),this._isMounted=!0,this._reactList=e,this._listenToItemsList(this.onListChanged),this._pane.rect.listen(this._onResize),g.default.settings.ui.listen(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.listen(this.onListChanged),M.a.listen("imageLoaded",this.onImageLoaded))}},{key:"notifyUnmounted",value:function(){f.a.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this.onListChanged),this._pane.rect.unlisten(this._onResize),g.default.settings.ui.unlisten(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.unlisten(this.onListChanged),M.a.unlisten("imageLoaded",this.onImageLoaded)),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,h.default.clearTimeoutOnce("afterScroll"+this.getID()),h.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._isOverview||(this._pane=void 0)}},{key:"allocateCells",value:function(){var e=this.cells.length,t=Math.ceil((y.a.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(t>e){for(var a=0,i=this.cells,n=e;n<t;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=new A;i.push(r)}this.cellsObs.set(i),this.cells=this.cellsObs.get()}}},{key:"setupScroller",value:function(e,t){this.scrollElement=e,this.addNativeScrollListener(this._onScroll)}},{key:"clearItemInfoForItem",value:function(e){var t=this._pane.getPaneObjectsForItem(e),a=this._itemInfoById;if(t)for(var i=0,n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];a[r.id]&&(a[r.id].needsUpdate=!0)}}},{key:"handleItemTextChanged",value:function(e){try{h.default.PAssert(1601,!this._isOverview,"Overviews should never listen to text changes")}catch(n){h.default.reportError(n)}var t=this._pane,a=!1;if(t&&t.isViewText())if(t.isItemInPane(e)){var i=this.indexOfItem(e);this.checkHeightChanged(e,i)&&(this.clearItemInfoForItem(e),a=!0)}else this.clearItemInfoForItem(e);return a}},{key:"getElementAtIndex",value:function(e){return this._reactList.getElementAtIndex(e)}},{key:"isIndexMounted",value:function(e){return this._reactList.isIndexMounted(e)}},{key:"hasItems",value:function(){return this._getItemsList().length>0}},{key:"numItems",value:function(){return this._getItemsList().length}},{key:"indexOfTop",value:function(){return this._indexOfTop}},{key:"inViewCount",value:function(){return this._inViewCount}},{key:"objectAtTop",value:function(){var e=this._getItemsList(),t=this.indexOfTop(),a=t>=0&&t<e.length;try{h.default.PAssert(1602,a,"Item at top is not in range",t,e.length)}catch(i){h.default.reportError(i)}return e[t]}},{key:"itemAtTop",value:function(){var e=this.objectAtTop();return e&&e.item}},{key:"indexPageUp",value:function(e){for(var t=0,a=this.size.height,i=0,n=e-1;n>=0;--n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[n])>a)return n+1}return 0}},{key:"indexPageDown",value:function(e){for(var t=0,a=this.size.height,i=0,n=this._sizes.length,r=e;r<n;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if((i+=this._sizes[r])>a)return r}return Math.max(n-1,0)}},{key:"_listenToItemsList",value:function(e){this._itemsObs.listen(e)}},{key:"_unlistenToItemsList",value:function(e){this._itemsObs.unlisten(e)}},{key:"sizeAtIndex",value:function(e){return this._pane.sizeAtIndex(e,this._isOverview)}},{key:"addNativeScrollListener",value:function(e){y.a.addPassiveListener(this.scrollElement,"scroll",e)}},{key:"removeNativeScrollListener",value:function(e){this.scrollElement&&this.scrollElement.removeEventListener("scroll",e)}},{key:"addScrollListener",value:function(e){this.scrollListeners.push(e)}},{key:"removeScrollListener",value:function(e){try{h.default.PAssert(1603,this.hasScrollListener(e),"Removing a listener that does not exist")}catch(t){h.default.reportError(t)}this.scrollListeners.remove(e)}},{key:"hasScrollListener",value:function(e){return this.scrollListeners.indexOf(e)>=0}},{key:"refreshScrollListener",value:function(){}},{key:"getScrollOffset",value:function(){if(this._isMounted){if(this.scrollElement){var e=this._pane.orientation.get()===p.a.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[e]}return 0}return 0}},{key:"getScrollSize",value:function(){var e=this._pane.orientation.get()===p.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(Math.max(this.contentSize.get(),e)+(h.default.noPanePadding?0:200),0)}},{key:"getMaxScrollOffset",value:function(){var e=this._pane.orientation.get()===p.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-e,0)}},{key:"setScrollOffset",value:function(e,t,a){var i=this;try{h.default.PAssert(1604,this.scrollElement,"Pane must have loaded a scrollable element")}catch(u){h.default.reportError(u)}try{h.default.PAssert(1605,h.default.isNumber(e),"Must supply a valid scroll offset")}catch(u){h.default.reportError(u)}if(this.scrollElement&&this._pane){if(this._pane.isFakePane)return;t=t||p.a.ScrollDuration.Snap;var n=this.getScrollOffset(),r=this.getMaxScrollOffset();if(e<0?e=0:e>r&&(e=r),e=Math.floor(e),this._isMounted&&this._scrollingTo!==e){this._scrollingTo=t?e:void 0,this._isSettingScroll=!0;var s,o,l=this._pane.orientation.get()===p.a.Orientation.Vertical;s=l?void 0:e,o=l?e:void 0,h.default.scrollTo(s,o,t,this.scrollElement,function(){i._onSetScrollComplete(),a&&a()})}else h.default.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0),a&&a();return e-n}}},{key:"_onSetScrollComplete",value:function(){this._restoringScroll?this._afterSetScrollComplete():h.default.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)}},{key:"_onSetScrollCompleteTimeout",value:function(){this._isMounted&&this.saveScrollOfTop(!0,!0),this._afterSetScrollComplete()}},{key:"_afterSetScrollComplete",value:function(){this._scrollingTo=void 0,this._isSettingScroll=!1}},{key:"_computeContentSize",value:function(e){var t=0,a=this.getPaddingTop(),i=a,n=this._getItemsList(),r=this._pane.getItem().levelsDeep.get();this._sizes=[],this._tops=[];for(var s=0;s<n.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o,l=n[s],u=n[s].item,d=h.default.isVMLI(u),c=this._itemInfoById[l.id],f=d?u.levelsDeep.get()-r:void 0;c&&!c.needsUpdate&&c.levelsDeep===f&&void 0===l.sizePad?o=c.size:(o=this.sizeAtIndex(s),c=this._itemInfoById[l.id]={size:o,levelsDeep:f,paneObject:l,needsUpdate:!1}),this._sizes[s]=o,this._tops[s]=s>0?this._tops[s-1]+this._sizes[s-1]:a,c.previousTop=c.top,c.top=this._tops[s],i+=c.size}return this.contentSize.set(i,e),i}},{key:"flushTimeoutPointerEvents",value:function(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())}},{key:"_onTimeoutPointerEvents",value:function(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)}},{key:"reMount",value:function(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])}},{key:"_onScroll",value:function(e){var t=0;if(!e||!h.default.findParent(e.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var a=0;a<this.scrollListeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.scrollListeners[a](e)}}}},{key:"_handleScroll",value:function(){if(this._phase=R.OnScroll,E.a.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),E.a.isMouseDown()||(this.isDelayingMounts=!0,h.default.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),g.default.tooltip.hideTip(),E.a.hoveredItem&&E.a.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?p.a.Direction.Down:p.a.Direction.Up;var e=Math.abs(this._scrollTop-this._lastProcessedScrollTop);if(this.alwaysRenderScroll||e>=this.offscreenScrollPadding/2)this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems();else this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=R.None}},{key:"_updateSize",value:function(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}}},{key:"onListChanged",value:function(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)}},{key:"_onSettingChanged",value:function(){this._needsResize=!0,h.default.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)}},{key:"_onResize",value:function(e,t,a){if(!g.default.PaneManager.isResizingPane){h.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var i=this.rect?this.rect.width:-1,n=this.rect?this.rect.height:-1;a||e&&(e.width!==i||e.height!==n)?(this.saveScrollOfTop(),this._updateSize(),this.clearCache(),this.allocateCells(),h.default.setItemAnimationMode(p.a.ItemAnimationMode.None),this.onListChanged(),h.default.resetItemAnimationMode(),E.a.getPane()===this._pane&&E.a.updateCaret()):this._updateSize()}}},{key:"saveScrollOfTop",value:function(e,t){this._savedScrollOfTop;if(this.numItems()>0&&(t||!this._pane.isIgnoringRestoreScroll())){for(var a,i,n=0,r=[],s=this.numItems(),o=e?this.getScrollOffset():this._scrollTop,l=this._indexOfTop;l<Math.min(this._indexOfTop+this._inViewCount-1,s);l++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=this.objectAtIndex(l),(i=o-this.topOfIndex(l))-this._sizes[l]<-this.getPaddingTop()&&r.push({index:l,paneObject:a,scrollOffset:i})}this._savedScrollOfTop.inView=r}}},{key:"restoreScrollOfTop",value:function(){var e=this._savedScrollOfTop;if(!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(e&&!h.default.isEmpty(e)){var t=e.inView;if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];if(this.restoreScroll(n))break}this._restoringScroll||this._pane.scrollToTop(p.a.ScrollDuration.Snap)}this._restoringScroll=!1}}},{key:"restoreScroll",value:function(e){var t=this,a=this.indexOfItem(e.paneObject);if(a>=0){var i=Math.max(this.topOfIndex(a)+(e.scrollOffset||0),0),n=this.getMaxScrollOffset();return i>n&&(i=n),this._restoringScroll=!0,this._scrollTop=i,this.setScrollOffset(i,p.a.ScrollDuration.Snap),h.default.animFrameOnce("restoreScroll_"+this.getID(),function(){t.setScrollOffset(i,p.a.ScrollDuration.Snap)}),!0}return!1}},{key:"clearCache",value:function(){var e=0;this._itemInfoById={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(a.width=a.height=void 0)}}},{key:"_isInBounds",value:function(e,t){var a=!1;return e>this._getPVRBottom()+this.offscreenScrollPadding||t<this._getPVRTop()-this.offscreenScrollPadding||(a=!0),a}},{key:"getScrollTop",value:function(){return this._scrollTop}},{key:"_getPVRTop",value:function(){return this._scrollTop}},{key:"_getPVRBottom",value:function(){return this._scrollTop+(this._pane.orientation.get()===p.a.Orientation.Vertical?this.size.height:this.size.width)}},{key:"killAllDeadCells",value:function(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];!a.isLive&&a.deadNeedsNotify&&a.kill(!0)}}},{key:"_startCellPassOnCell",value:function(e){e.seenInPass=!1}},{key:"startCellPass",value:function(){var e=0;this.cellsCurrent={};for(var t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&(this.cellsCurrent[a.paneObject.id]=a,this._startCellPassOnCell(a))}}},{key:"_pruneCellPassOnCell",value:function(e,t){if(!e.seenInPass||t){var a,i=e.index;(this._phase!==R.OnScroll||this._isInBounds(this._tops[i],this._tops[i]+this._sizes[i]))&&(a=!0),e.kill(a)}}},{key:"pruneCellPass",value:function(){for(var e=0,t=0;t<this.cells.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cells[t];a.isLive&&this._pruneCellPassOnCell(a)}}},{key:"updateCell",value:function(e){var t=this._pane,a=this._getItemsList()[e],i=a.id,n=this.cellsCurrent[i],r=this._isOverview||this._pane.orientation.get()===p.a.Orientation.Vertical,s=this._sizes[e],o=r?t.getContentWidth():s,l=r?s:t.getContentHeight(),u=this._tops[e],d=this._itemInfoById[i],c=d&&d.previousTop;n&&!n.seenInPass?n.update(e,o,l,u,c,a):!n&&this.cellsNew.indexOfWithProperty("index",e)<0&&this.cellsNew.push({index:e,width:o,height:l,offset:u,paneObject:a,prevOffset:c})}},{key:"_addPassOnCell",value:function(e){for(var t,a=0,i=0;i<this.cells.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!this.cells[i].isLive){t=this.cells[i];break}}try{h.default.PAssert(1606,t,"Must always have additional cells to use",y.a.windowHeight())}catch(n){h.default.reportError(n)}t||(t=new A,this.cells.push(t)),t.update(e.index,e.width,e.height,e.offset,e.prevOffset,e.paneObject)}},{key:"addCellPass",value:function(){for(var e=0,t=0;t<this.cellsNew.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.cellsNew[t];this._addPassOnCell(a)}this.cellsNew=[]}},{key:"_isIndexSeen",value:function(e){var t=this._getItemsList()[e].id,a=this.cellsCurrent[t];return a&&a.seenInPass}},{key:"_computeRenderItems",value:function(e){h.default.batchRenderUpdates(this._computeRenderItemsBatched,e)}},{key:"_computeRenderItemsBatched",value:function(e){var t,a,i,n,r=0,s=this._getItemsList(),o=0;this.startCellPass(),e&&this.restoreScrollOfTop();for(var l=0;l<s.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t=this._tops[l],a=this._sizes[l],this._isInBounds(t,t+a))isNaN(i)&&t+a>this._getPVRTop()&&(i=l),this.updateCell(l),!isNaN(i)&&Math.round(t)<this._getPVRBottom()-2&&o++;else if(t>this._getPVRBottom())break}isNaN(i)&&(i=0),this._indexOfTop=i,this._inViewCount=o,E.a.isValid()&&this._pane===E.a.getPane()&&(n=E.a.getStartIndex())<this._sizes.length&&!this._isIndexSeen(n)&&this.updateCell(n),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===R.OnScroll||this.saveScrollOfTop()}},{key:"updateTopIndex",value:function(){for(var e,t,a=0,i=this._getItemsList(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e=this._tops[n],t=this._sizes[n],this._isInBounds(e,e+t)&&e+t>this._getPVRTop()){this._indexOfTop=n;break}}}},{key:"getItemInfo",value:function(e){return this._itemInfoById[e]}},{key:"getItemInfosForItem",value:function(e){var t=this._itemInfoById,a=[];if(t[e.id])a.push(t[e.id]);else for(var i in this._itemInfoById)t.hasOwnProperty(i)&&t[i].paneObject.item===e&&a.push(t[i]);return a}},{key:"topOfItem",value:function(e){try{h.default.PAssert(1607,e,"Must provide a valid item to measure")}catch(a){h.default.reportError(a)}var t=this.indexOfItem(e);try{h.default.PAssert(1608,t>=0,"Must supply a valid item that is in this pane")}catch(a){h.default.reportError(a)}return this.topOfIndex(t)}},{key:"topOfIndex",value:function(e){try{h.default.PAssert(1609,e>=0,"Must supply a valid index")}catch(t){h.default.reportError(t)}return this._tops[e]}},{key:"scrollIndexToTop",value:function(e,t,a){var i=this.topOfIndex(e),n=this.getScrollOffset();if(i<n||i-n>200)return this.setScrollOffset(i-16,t,a);a&&a()}},{key:"scrollItemToTop",value:function(e,t,a){try{h.default.PAssert(1610,h.default.isVMLI(e),"Must be a valid VMLI instance")}catch(n){h.default.reportError(n)}try{h.default.PAssert(1611,h.default.isNumber(t),"Must have a valid scroll duration")}catch(n){h.default.reportError(n)}var i=this.indexOfItem(e);try{h.default.PAssert(1612,i>=0,"Must supply a valid item that is in this pane")}catch(n){h.default.reportError(n)}return this.scrollIndexToTop(i,t,a)}},{key:"scrollIndexToMiddle",value:function(e,t,a){if(this._isMounted){var i=this.topOfIndex(e),n=this._sizes[e],r=Math.floor(i+n/2-this.getHeight()/2);return this.setScrollOffset(r,t,a)}a&&a()}},{key:"scrollItemToMiddle",value:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);if(i>=0)return this.scrollIndexToMiddle(i,t,a)}else a&&a()}},{key:"scrollItemIntoView",value:function(e,t,a){if(this._isMounted){var i=this.indexOfItem(e);return this.scrollIndexIntoView(i,t,a)}a&&a()}},{key:"scrollIndexIntoView",value:function(e,t,a){t=isNaN(t)?p.a.ScrollDuration.Default:t;try{h.default.PAssert(1613,h.default.isNumber(e),"Must supply a valid index")}catch(y){h.default.reportError(y)}try{h.default.PAssert(1614,!a||h.default.isFunction(a),"Must supply a valid callback function")}catch(y){h.default.reportError(y)}var i=this.itemAtIndex(e);try{h.default.PAssert(1615,i,"Item does not exist to scroll to",e,this.numItems())}catch(y){h.default.reportError(y)}if(this._isMounted&&i){var n=this.topOfIndex(e),r=this.getHeight(),s=r;g.default.PaneManager.hasScrollbar()&&(s-=p.a.HorizScrollbarHeight);var o=this.getScrollOffset(),l=o+r,u=this._sizes[e],d=n+u,c=d>l,f=n<o;f&&u>s&&d>=l&&(f=!1);var m,v=0;return f?m=0===n?0:n:c&&(m=d-s),f||c?(v=m-o,this.setScrollOffset(m,t,function(){a&&setTimeout(a,0)})):a&&a(),v}return!1}},{key:"getPaddingTop",value:function(){return this._isOverview?0:this._pane.topBoxHeight.get()}},{key:"notifyDragStart",value:function(){}},{key:"notifyDragEnd",value:function(){}},{key:"notifySwappedIn",value:function(e){isNaN(e)||this.setScrollOffset(e)}},{key:"addScrollDelta",value:function(e){try{h.default.PAssert(1616,this.scrollElement,"Pane must have loaded a scrollable element")}catch(t){h.default.reportError(t)}return this.setScrollOffset(this.getScrollOffset()+e)}},{key:"setScrollHandler",value:function(e){this.scrollHandler=e}},{key:"setInitialScrollOffset",value:function(e){this._scrollTop=e||0}},{key:"checkHeightChanged",value:function(e,t){try{var a=this._pane,i=this.objectAtIndex(t),n=e.sizeInPane(a,t,!1)+(i.sizePad||0),r=this.getItemInfosForItem(e);if(r.length>0&&n!==r[0].size)return this.clearItemInfoForItem(e),!0}catch(s){h.default.reportError(s)}}},{key:"onImageLoaded",value:function(e){if(this._pane.isItemInPane(e)){var t=this.indexOfItem(e);(t<0||this.checkHeightChanged(e,t))&&(this._pane.setIgnoreRestoreScroll(),this.clearItemInfoForItem(e),this._pane.setItemsDirty(),g.default.PaneUpdateBatcher.updateAllItems())}}}]),t}(x),F=function(){function e(t,a,i){o()(this,e),this.pane=t,this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new k.a(a),this.isShowingContents=new k.a(i);this.transform=new k.a(-1),this.cursor=new k.a,this.topItem=void 0,this.dragHoverItem=void 0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd},this._infiniteList=new O({pane:t,isOverview:!0,itemsObs:t.headerPaneObjects,itemsFn:t.getHeaders,widthFn:t.getWidth,heightFn:t.getHeight,minItemSize:this.getMinItemSize}),this.init()}return u()(e,[{key:"init",value:function(){f.a.forceBind("onPaneScroll",this),f.a.forceBind("onPaneItemsUpdated",this),M.a.listen("itemsUpdated",this.onPaneItemsUpdated)}},{key:"destroy",value:function(){this.pane=void 0,M.a.unlisten("itemsUpdated",this.onPaneItemsUpdated),f.a.destroy(this)}},{key:"onPaneLoad",value:function(){this.pane.overviewCanTrackScroll&&this.isVisible.get()&&this._attachScrollListener()}},{key:"getInfiniteList",value:function(){return this._infiniteList}},{key:"getContentElement",value:function(){return this.contentElement}},{key:"getScrollOffset",value:function(){this._infiniteList.getScrollOffset()}},{key:"refreshScrollListener",value:function(){this._infiniteList.refreshScrollListener()}},{key:"onTapStart",value:function(e){if(!h.default.hasClass(e.target,"overviewList")&&h.default.findParent(e.target,"overviewList")){var t=h.default.getItemForElement(e.target);t&&(g.default.DragDrop.startDragItem=t)}}},{key:"onTapMove",value:function(e){var t=g.default.DragDrop.startDragItem||g.default.DragDrop.dragItem;t&&t.checkDragOnMove(e,!0)}},{key:"onTapClick",value:function(e){var t=this.pane,a=h.default.getPaneObjectForElement(e.target),i=h.default.getItemForElement(e.target),n=h.default.getElementParent(e.target);if(n&&i!==t&&i!==this&&h.default.findParent(e.target,"overviewList"))try{h.default.PAssert(1595,i,"Element in overview was text but was not an item")}catch(r){h.default.reportError(r)}if(i){try{h.default.PAssert(1596,n,"Item must have an overview element: "+(i.getRawText?i.getRawText():"not an item"))}catch(r){h.default.reportError(r)}if(n)e.clientX-h.default.offset(n).left<t.getPaddingForPaneObject(a,!0)?t.setPaneObjectCollapsed(!t.isPaneObjectCollapsed(a,!0),a,!0):h.default.hasClass(e.target,"overviewOptions")?(g.default.menus.openContextMenu({componentName:"ReactContextMenuOverviewOptions",key:"menu"+i.id+e.clientX+e.clientY,element:e.target,item:i,pane:t,pos:{left:e.pageX,top:e.pageY}}),h.default.preventAndStop(e)):this.pane.allowZoom(i)?(!this.pane.canScrollToItem()||y.a.mac&&e.metaKey||!y.a.mac&&e.ctrlKey||!this.pane.isOverviewVisibleInPane(i)?this.pane.zoomIn(i):this.scrollItemIntoView(i),h.default.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(i)}h.default.preventDefault(e)}},{key:"onTapEnd",value:function(e){var t=g.default.DragDrop.startDragItem||g.default.DragDrop.dragItem;t&&t.checkDragOnEnd(e)}},{key:"scrollItemIntoView",value:function(e){var t=0,a=this;this._disablePaneScrollListener=!0;for(var i=e;i&&i!==this.pane.getItem();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.pane.indexOfItem(i)>=0){this.pane.scrollItemToTop(i,p.a.ScrollDuration.Default);break}i=i.parent()}this.updateTopPaneItem(e),setTimeout(function(){a._disablePaneScrollListener=!1},2*p.a.ScrollDuration.Default)}},{key:"setVisibility",value:function(e){e&&(E.a.reset(),this._infiniteList.setInitialScrollOffset(0)),e!==this.isVisible.get()&&(this.isVisible.set(e),M.a.fireEvent("panesChanged",[]),g.default.PaneManager.updatePaneStateForPane(this),this.pane.overviewCanTrackScroll&&(e?this._attachScrollListener():this._detachScrollListener()))}},{key:"setShowingContents",value:function(e){this.isShowingContents.set(e),g.default.PaneManager.updatePaneStateForPane(this)}},{key:"_attachScrollListener",value:function(){try{h.default.PAssert(1597,!this._scrollListenerAttached,"Must not double attach scroll listener")}catch(e){h.default.reportError(e)}this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)}},{key:"_detachScrollListener",value:function(){try{h.default.PAssert(1598,this._scrollListenerAttached,"Must only detach overview listener when already attached")}catch(e){h.default.reportError(e)}this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)}},{key:"toggleDesktop",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),v.d.miscAction({type:v.b.Misc,misc:v.a.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})}},{key:"onPaneScroll",value:function(){if(!this._disablePaneScrollListener){try{h.default.PAssert(1599,this.isVisible.get(),"Should not be tracking scroll if overview is not open")}catch(t){h.default.reportError(t)}var e=this.findTopPaneItem();e&&(this.updateTopPaneItem(e),this._infiniteList.scrollItemToMiddle(e,p.a.ScrollDuration.Default))}}},{key:"findTopPaneItem",value:function(){var e=this.pane;if(this.pane.numItems()>0){for(var t,a,i=0,n=this.pane.indexOfTop(),r=e.getRootItem();n>=0&&n<e.numItems()&&!a;){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(t=this.pane.itemAtIndex(n);t&&t!==r&&!a;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;this._infiniteList.indexOfItem(t)<0?t=t.parent():a=t}a||n++}return!a&&this._infiniteList.numItems()>0&&(a=this._infiniteList.itemAtIndex(0)),a}}},{key:"updateTopPaneItem",value:function(e){var t=this.topItem;this.topItem=e,t&&t.itemChanged.notify(),e.itemChanged.notify()}},{key:"updateDragHoverItem",value:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,t&&t.itemChanged.notify(),e&&e.itemChanged.notify()}},{key:"onPaneItemsUpdated",value:function(e){if(e===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var t=this.findTopPaneItem();t&&this.updateTopPaneItem(t)}}},{key:"isItemAtTop",value:function(e){return e===this.topItem}},{key:"isItemDragHovered",value:function(e){return e===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return g.default.DisplaySettings.itemLineHeight()+2*g.default.DisplaySettings.itemPadding()}}]),e}(),N=a(105),B=a.n(N),U=a(61),V=a(58),H=p.a.MatchState,j=/([^\+]+)\+(\d+)/,z=(n=function(){function e(t,a,i){var n=0;o()(this,e),this.callback=i,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new k.a,this._destroyed=!1,f.a.binder(this,"isMatched","checkChildrenParams","hideNonMatches","handleItemTextChanged","update");var r={priority:{name:"priority",matchFn:this._matchFnPriority},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFn:this._matchFnProject},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(a){!1===a.showHierarchy&&(a.showOnlyMatches=1);var s=a.completeOption;!isNaN(s)&&isNaN(a.complete)&&(a.complete=s<0?1:s-1),0===a.showOnlyTopLevelProjects&&(a.showChildProjects=1)}for(var l=[],u=0;u<t.searchFilters.length;u++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=t.searchFilters[u];h.default.isString(d)?l.push(r[d]):l.push(d)}if(this.setupFilters(l,a),this.value=a&&a.text||"",this.onChanged=new C.a(i),this._updateSearchArr(),this.value){var c=U.a.parseText(this.value,V.a.getContacts(),!0,!0,!0);c&&this.onParsed(c)}}return u()(e,[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,f.a.destroy(this)}},{key:"setFilterTooltip",value:function(e,t){this.getFilter(e).tooltip=t}},{key:"getFilterTooltip",value:function(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+y.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}},{key:"setupFilters",value:function(e,t){for(var a=0,i=[],n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n],s=r.name,o=t?t[s]:void 0,l=r;l.value=new k.a(isNaN(o)?r.defaultValue||0:o),l.enabled=new k.a(void 0===r.enabled||r.enabled);try{h.default.PAssert(1617,!this.hasOwnProperty("filter_"+s),"Should not double define filter properties")}catch(u){h.default.reportError(u)}this["filter_"+s]=l,i.push(l)}this.filters=i}},{key:"setFilterEnabled",value:function(e,t){var a=this.filters.indexOfWithProperty("name",e);a>=0&&this.filters[a].enabled.set(t)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}},{key:"getRemoteValue",value:function(){for(var e=0,t=this.value,a=0;a<this.filters.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];if(i.remoteStringFn&&i.enabled.get()){var n=i.remoteStringFn(i.value.get());n&&(t+=" "+n)}}return t.trim()}},{key:"getState",value:function(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},a=0;a<this.filters.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.filters[a];t[i.name]=i.value.get()}return t}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(e){this.tags=e.tags,this.contacts=e.contacts}},{key:"setValue",value:function(e){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.value=e,this._updateSearchArr(),this.pane.getItemStore().numItems>5e3?h.default.timeoutOnce("searchDebounce",this.update,150,!0):this.update(!0),e&&v.d.miscAction({type:v.b.Misc,misc:v.a.SearchChanged,data:this.getState()}),this.updatingValue=!1}},{key:"addToValue",value:function(e){var t=this.getSelectionOffset(),a=this.value;a.length>0&&"-"!==a[a.length-1]&&"!"!==a[a.length-1]&&(e=" "+e),a+=e,this.setValue(a),this.setSelectionOffset(t+e.length)}},{key:"toggleText",value:function(e,t){var a=this.value.trim(),i="\\B(-*)("+h.default.escapeRegExp(e.toLowerCase())+")\\b",n=a.toLowerCase().match(i);n?(!n[1]&&t||n[1],a=(a.substr(0,n.index)+a.substr(n.index+n[0].length)).replace(/  +/g," ")):a+=" "+(t?"-":"")+e;a=a.trim(),this.setValue(a),this.setSelectionOffset(a.length)}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.UI.setSelectionOffset(e)}},{key:"getSearchBox",value:function(){return this.UI.refs.searchBox}},{key:"isSearched",value:function(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[t];if(a.enabled.get()&&a.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.filters[t].value.set(0)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var e=this,t=0,a={item:this.pane.getItem(),each:function(a){var i=a.id,n=e.matches[i];n!==H.No&&n!==H.Negated||t++}};return g.default.searchVMLIs(a),t}},{key:"isFlatSearchResult",value:function(e){return!this.showHierarchy()&&this.matches[e.id]===H.Yes}},{key:"isMatchStateMatch",value:function(e){return void 0===e||e===H.Yes||e===H.ChildYes||e===H.Unknown}},{key:"isMatched",value:function(e,t,a){if(e.isRoot)return H.Yes;if(this.pane.supportLocalSearch){var i=this.matches[e.id];return a||void 0!==i||!e.hasText()||this.pane.isSettingText||this.pane===h.default.focusedPane||(i=this.checkItem(e)),this.isMatchStateMatch(i)}return H.Yes}},{key:"handleItemChanged",value:function(e){if(g.default.PaneManager.isPaneActive(this.pane.id)){var t,a=this.isMatched(e,!0);if(e.parent()?(this.checkItem(e),t=this.isMatched(e)):t=!1,!t&&a&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),t!=a)return!0}}},{key:"handleItemTextChanged",value:function(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}},{key:"_updateSearchArr",value:function(){var e=0,t=0,a=this.value.toLowerCase().trim(),i=/(-*)"([^"]*)"|[^\s"]+/gi,n=[];do{if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=i.exec(a);null!=r&&n.push(r[2]?(r[1]?r[1]:"")+(r[2]?r[2]:""):r[0])}while(null!=r);this.searchArr=[],this.searchWords=[];for(var s=0,o=0;o<n.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=n[o].startsWith("-"),u=l?n[o].substr(1):n[o];if(u&&"and"!==u&&"-"!==u&&"$"!==u)if(o>0&&("or"===u||"|"===u||"||"===u))s++;else{this.searchArr[s]||(this.searchArr[s]=[]);var d={text:u,isNegated:l};if(u.startsWith(p.a.SearchDates.Before)||u.startsWith(p.a.SearchDates.After)||u.startsWith(p.a.SearchDates.Date)){var c=u.split(":"),h=B()(c,2),f=h[0],g=h[1],m="date"===f&&"overdue"===g,v=void 0;if(m)v=new Date;else{var y=g.match(j);v=y?Date.parse(y[1]).addDays(+y[2]):Date.parse(g)}v&&(d.dateInfo={prefix:f,dateText:g,date:v,dateCleared:v&&v.clearTime(),isOverdue:m})}this.searchArr[s].push(d),l||this.searchWords.push(u)}}}},{key:"toggleFilterDefault",value:function(e){var t=this["filter_"+e],a=t.value.get();a=a?0:t.initialValue,this.setFilter(e,a)}},{key:"toggleFilter",value:function(e,t){var a=t?-1:1,i=this["filter_"+e].value.get();i=i===a?0:a,this.setFilter(e,i)}},{key:"getFilter",value:function(e){return this["filter_"+e]}},{key:"getFilterObs",value:function(e){var t=this["filter_"+e];return t?t.value:void 0}},{key:"getFilterValue",value:function(e){var t=this["filter_"+e];return t?t.value.get():void 0}},{key:"setFilter",value:function(e,t,a){"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,a),this.update(!0,!0),v.d.miscAction({type:v.b.Misc,misc:v.a.SearchChanged,data:this.getState()})}},{key:"update",value:function(e,t,a){var i=this;this.isRunningSearch=!0,g.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=a&&!e&&h.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&(h.default.setItemAnimationMode(p.a.ItemAnimationMode.None),this.onChanged.notify(t)),g.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout(function(){i.isUpdatingSearch=!1,h.default.resetItemAnimationMode()},0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_checkMatch",value:function(e,t,a){var i=!0,n=a.text;if(a.dateInfo)i=this._matchDate(e,a);else if(n.length>0){i=!1;var r=n===p.a.SearchFilterTexts.Pri0,s=n===p.a.SearchFilterTexts.Pri1,o=n===p.a.SearchFilterTexts.Pri2;if(h.default.isPrefixTask(n))i=e.isPrefixTask();else if(n===p.a.SearchFilterTexts.Star)i=e.isStarred(this.pane);else if(r||s||o){i=e.getPriority(this.pane)===(r&&p.a.VMLIFlag.P0||s&&p.a.VMLIFlag.P1||o&&p.a.VMLIFlag.P2)}else i=n===p.a.Prefix.Bullet2?e.isPrefixBullet():n===p.a.Prefix.Header||n===p.a.Prefix.Header2?e.isPrefixHeader():i||t.indexOf(n)>=0}return i}},{key:"_isMatchStateOk",value:function(e){return e===H.Yes||e===H.Unknown||e===H.ChildYes}},{key:"_matchFilter",value:function(e,t){if(e)return t?e>0?H.Unknown:H.Negated:e>0?H.No:H.Unknown}},{key:"_matchFilters",value:function(e){for(var t=0,a=H.Unknown,i=0;i<this.filters.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.filters[i];if(n.matchFn&&n.enabled.get()){var r=n.matchFn(n.value.get(),e);r===H.Unknown||r!==H.Negated&&!this._isMatchStateOk(a)||(a=r)}}return a===H.Yes&&(a=H.Unknown),a}},{key:"_matchFnComplete",value:function(e,t){return this.pane.getSortModeBlocks()===p.a.TaskSortMode.Completed&&(e=1),1===e?t.isComplete()?H.Unknown:H.No:-1===e&&t.isComplete()?H.Negated:H.Unknown}},{key:"_matchFnStarred",value:function(e,t){return this._matchFilter(e,t.isStarred())}},{key:"_matchFnProject",value:function(e,t){return this._matchFilter(e,t.isPrefixHeader())}},{key:"_matchFnTask",value:function(e,t){return this._matchFilter(e,t.isPrefixTask())}},{key:"_matchFnPriority",value:function(e,t){var a=t.getPriority();return e>0?a>=e?H.Yes:H.No:H.Unknown}},{key:"_matchFnEmail",value:function(e,t,a){var i=t.getAttachments(),n=i&&i[0],r=n&&n.getPlugin()===g.default.pluginManager.getPluginGmail();return this._matchFilter(e,r)}},{key:"_matchDate",value:function(e,t){var a=e.getNextDate();if(a){var i=t.dateInfo,n=i.prefix,r=i.date,s=i.dateCleared,o=i.isOverdue,l=e.getMooDate();if(l.isRepeatDate()){if(o||"before"===n)return l.getFirstDate()<r;if("date"===n)return l.isOnDate(r);if("after"===n)return!!l.getNext(r);0}return!r||("before"===n||o)&&a<r||"date"===n&&a.clearTime().equals(s)||"after"===n&&a>=r}}},{key:"checkItem",value:function(e,t){var a,i=t&&t.searchExtras,n=i?i.root:this.pane.getRootItem(),r=i?i.showHierarchy:this.showHierarchy(),s=this.matches,o=e.isNote(),l=e.parent();if(e.isDestroyed())return a=H.No;try{h.default.PAssert(1618,l||e.isRootItem(),"Item parent does not exist while being searched",e===n)}catch(x){h.default.reportError(x)}if(this._stickyMatches[e.id])a=H.ChildYes;else if(e.isRootItem())a=H.Yes;else if(l)if(s[l.id]===H.Negated)a=H.Negated;else{var u,d,c,f=[],g=e.getSearchText(this.pane),m=(a=this._matchFilters(e))===H.Negated;if(!m&&this.searchArr.length){var v=0,y=0;for(d=0;d<this.searchArr.length;d++){var k=0;if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var _=this.searchArr[d];for(c=0;c<_.length;c++){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var S=_[c];if(S.isNegated){var P=S;try{h.default.PAssert(1619,P,"Each value in the search array should be valid at this point")}catch(x){h.default.reportError(x)}if(this._checkMatch(e,g,S)){f[d]=H.Negated,m=!0,y++;break}}}}y===this.searchArr.length&&(a=H.Negated)}if(this.isMatchStateMatch(a)){var w=0,I=0;for(d=0;d<this.searchArr.length;d++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if(f[d]!==H.Negated){var b=0,D=this.searchArr[d];for(c=0;c<D.length;c++){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;var E=D[c],C=E.text;try{h.default.PAssert(1620,C,"Each value in the search array should be valid at this point")}catch(x){h.default.reportError(x)}if(!E.isNegated)if(this._checkMatch(e,g,E))f[d]=H.Yes;else if(r){var A=0;for(u=e;u;){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;if(!(u=u.parent())||u===n){f[d]=H.No;break}if(this._checkMatch(u,u.getSearchText(),E))break}}else f[d]=H.No;if(f[d]===H.No)break}}}var M=!1;for(d=0;d<f.length;d++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;if(M=f[d]===H.Yes,a===H.Unknown&&f[d]===H.Negated)a=H.Negated;else if(a!==H.Yes&&f[d]===H.No)a=H.No;else if(f[d]===H.Yes||f[d]===H.Unknown){a=H.Yes;break}}if(M&&this.updatingValue&&this.getValue()){var T=0;for(u=l;u;){if(T++>5e3&&__infLoop&&__infLoop(T))throw new RangeError;u.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(u.id,p.a.PerPaneStateField.CollapsedSearch,!1),u=u.parent()}}a===H.Unknown&&(a=H.Yes)}if(!m&&this.pane.shouldSearchMatchParents&&l!==n&&r&&s[l.id]===H.Yes)return s[e.id]=H.Yes,s[e.id];a===H.No&&o&&(a=s[l.id])}else a=H.No;if(this.isMatchStateMatch(a)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(a=H.No),a===H.Yes){if(r){var L=0;for(u=l;u&&!u.isRootItem()&&s[u.id]!==H.Negated&&s[u.id]!==H.Yes;){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;s[u.id]=H.ChildYes,u.hasNote()&&(s[u.getNote().id]=H.Yes),u=u.parent()}}o&&(s[l.id]=H.Yes)}return s[e.id]=a,s[e.id]}},{key:"checkChildrenParams",value:function(e,t){return this.checkItem(e,t)!==H.Negated}},{key:"checkChildren",value:function(){var e={includeNotes:!0,comparator:this.checkChildrenParams,searchExtras:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};if(this.itemStoreFilter&&(e.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==g.default.itemStoreManager.getDefaultItemStore()?e.itemStore=this.pane.getItemStore():e.item=this.pane.getItem(),g.default.searchVMLIs(e),this.isAnimatingSearch)for(var t in this.matches)if(this.matches.hasOwnProperty(t)&&void 0!==this.prevMatches[t]&&this.isMatchStateMatch(this.prevMatches[t])&&!this.isMatchStateMatch(this.matches[t])){var a=m.a.getItem(t);a&&!this.isMatchStuck(a)&&this.stickMatchAfterSearch(a,this.prevMatches[a.id])}}},{key:"_getMatchedItem",value:function(e){return this._stickyMatches[e.id]||e}},{key:"getItemDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.date}},{key:"getItemRepeatDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.repeatDate}},{key:"getItemDateText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.dateText}},{key:"getItemDuration",value:function(e){var t=this._stickyMatches[e.id];return t&&t.duration}},{key:"getItemTagsLower",value:function(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}},{key:"getItemContacts",value:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts}},{key:"getItemSearchText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText}},{key:"getItemPrefix",value:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix}},{key:"getItemPriority",value:function(e){var t=this._stickyMatches[e.id];return t&&t.priority}},{key:"getItemStarred",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}},{key:"stickMatch",value:function(e,t){var a=h.default.isVMLI(e)?e:e.item;if(!this._stickyMatches[a.id]){this.matches[a.id]=H.Yes;var i=a.getStickySearchInfo();t&&(i.isHiding=!0),h.default.isInCompleteAction()&&(i.wasCompleted=!0),this._stickyMatches[a.id]=i}}},{key:"isMatchStuck",value:function(e){var t=h.default.isVMLI(e)?e:e.item;return!!this._stickyMatches[t.id]}},{key:"unstickMatch",value:function(e){var t=h.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];if(a){var i=t.getStickySearchInfo();return delete this._stickyMatches[t.id],!h.default.deepEqual(a,i)}return!1}},{key:"isMatchStuckHiding",value:function(e){var t=h.default.isVMLI(e)?e:e.item,a=this._stickyMatches[t.id];return a&&a.isHiding}},{key:"stickMatchAfterSearch",value:function(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500))}},{key:"hideNonMatches",value:function(){var e=this;if(!this._destroyed){var t=this.pane,a=this._stickyMatchesAwaitingClear,i=a.length,n=0;if(i>0){for(var r=0,s=0;s<i;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a[s],l=this._stickyMatches[o.id];l&&l.wasCompleted&&n++,this.unstickMatch(o)}var u=i+(i>1?" items":" item"),d={hold:!1};this.pane===h.default.focusedPane&&(n!==i?(d.text=u+" hidden because "+(i>1?"they do":"it does")+" not match search",d.actionText="UNHIDE",d.action=function(){if(t&&t.setIgnoreRestoreScroll){var n=0,r=E.a.save();t.setIgnoreRestoreScroll();for(var s=0;s<i;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=a[s];e.stickMatch(o),e._stickyMatchesAwaitingClear.push(o)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),E.a.restore(r)}}):(d.text=u+" completed",d.actionText="UNDO",d.action=function(){var n=0,r=E.a.save();t.setIgnoreRestoreScroll();for(var s=0;s<i;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a[s].setComplete(!1,p.a.ChangeType.Local)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),E.a.restore(r)}),g.default.toasts.pushMessage(d));var c=E.a.save();this._stickyMatchesAwaitingClear=[],t.setIgnoreRestoreScroll(),t.updateItemsImmediate(!0,void 0,void 0,!0),c&&c.pane===this.pane&&E.a.restore(c)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==p.a.PaneMode.Task||(g.default.settings.testBetaFeatures.get()||this.pane.getViewMode()!==p.a.TaskViewMode.List_Flat)&&1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===p.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===p.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===p.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.getInfiniteList().clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}},{key:"isSearchingDate",value:function(){return this.searchArr.some(function(e){return e.some(function(e){return!!e.dateInfo})})}}]),e}(),c()(n.prototype,"_matchFnComplete",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnComplete"),n.prototype),c()(n.prototype,"_matchFnStarred",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnStarred"),n.prototype),c()(n.prototype,"_matchFnProject",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnProject"),n.prototype),c()(n.prototype,"_matchFnTask",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnTask"),n.prototype),c()(n.prototype,"_matchFnPriority",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnPriority"),n.prototype),c()(n.prototype,"_matchFnEmail",[L.a],Object.getOwnPropertyDescriptor(n.prototype,"_matchFnEmail"),n.prototype),n),q=a(34),W=a(53),G=a(74),K=a(47),Y=a(162),X=a(73),Q=a(27),J=a(44),Z=a(41),$=0,ee=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"],te=(r=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,e),this.__ISPANE=!0,f.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","compositionStart","compositionEnd","onShowArchivedChanged","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","getSwipeMenuItemsNew","getMinItemSize"),this.title=a.title,this._createProps(a,{contextMenuMode:p.a.ContextMenuMode.Default,paneEmptyMessage:"Start typing to get started",paneEmptySearchMessage:"No search results",titleContextMenuHeader:"Zoom to item",searchFilters:[],dropEffect:function(){return p.a.DropEffect.Move},isWriteable:!0,isEditable:!1,isDraggable:!0,isDropTarget:!0,hasNonVMLIs:!1,canAddItem:!0,overrideCopyBehavior:!0,supportMenuIcon:!1,supportCollapsing:!0,supportCompleting:!0,supportCheckbox:!1,supportIndent:!0,supportOffline:!0,supportPerformArchive:!0,supportDataRefresh:!1,supportReportError:!1,supportCompose:!1,supportPagination:!1,supportVertLines:!0,supportStarClick:!1,supportSearchItemAutocomplete:!0,supportSearchListenTextChanges:!0,supportSearchFlat:!0,supportLocalSearch:!0,supportClone:!0,supportDates:!0,supportMultiselect:!0,supportDeferredItemLoad:!1,supportCellTransition:!0,supportViewMenu:!1,useLineCache:!0,supportSel:!0,shouldSearchMatchParents:!0,shouldUpdateOnTextChanged:!0,noOverviewStyle:!1,supportClickOverviewScroll:!0,overviewTracksScroll:!0,overviewHasPaneItems:!0,overviewPadLevels:0,minWidth:p.a.StdPaneWidthMin,minWidthFlex:p.a.StdPaneWidthMin,maxWidth:p.a.PaneWidthMax,maxWidthFlex:p.a.StdPaneWidthMax,maxWidthSingle:p.a.StdPaneWidthMax,widthBiggerInSingle:!0,collapsedFieldName:p.a.PerPaneStateField.Collapsed,hasMoreButtons:!0,supportsDocuments:!0,_topBoxHeight:h.default.activeDisplayMode&p.a.DisplayMode.NoPaneTop?0:36}),this.blockNoKey="",this.topBoxHeight=new k.a(this._topBoxHeight),this.rect=new k.a(t.rect),this.isExpanded=new k.a(!1);try{h.default.PAssert(1488,void 0!==t.id,"Must supply a valid pane id")}catch(i){h.default.reportError(i)}this.id=t.id,this.uniquePaneID=$++,this.isFakePane=t.isFakePane,this.plugin=t.plugin,t.document&&h.default.isString(t.document)&&(t.document=m.a.getDocumentById(t.document)),this.document=new k.a(t.document),this.documentSortMode=new k.a(t.documentSortMode||p.a.DocumentSortMode.Modified,this.saveState),t.item||(this.supportDeferredItemLoad?(t.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:t.deferredItemID,search:t.search,offset:0}):(t.item=this.getDefaultDisplayItem(),t.search=t.search||"")),this.name=new k.a(t.name),this.item=new k.a(t.item),this.items=new D.a,this.headersArr=[],this.headerPaneObjects=new D.a,this.paneObjectsByItem={},this.isDefaultPane=t.isDefaultPane,this.initialOffset=t.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new C.a,this.showArchived=new k.a(!1),this.onItemTextChanged=new C.a,this._panePadding=0,this.paneTopText=new k.a,this.toast=new k.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new k.a(!1),this.isFocused=new k.a(!1),this.caretPosition=new k.a,this.widthManual=t.widthManual,this.widthManualExpanded=t.widthManualExpanded,this.isReady=new k.a(!this.plugin||this.plugin.isReady()),this.isActive=new k.a(!0),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new k.a,this._infiniteList=new O({pane:this,offset:t.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.isLoadingNewPage=new k.a(!1),this.orientation=new k.a(p.a.Orientation.Vertical),this.showScrollbars=new k.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.defaultOffset=0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd,onDoubleClick:this.onTapDoubleClick,onRightClick:this.onTapRightClick},this.showArchived.listen(this.onShowArchivedChanged),this.search=new z(this,t.search,this.onSearchChanged.bind(this)),this.overview=new F(this,t.isOverviewVisible,t.isOverviewShowingContents),this.constructorExtra&&this.constructorExtra()}return u()(e,[{key:"_createProps",value:function(e,t){var a=this;Object.keys(t).forEach(function(i){a[i]=void 0!==e[i]?e[i]:t[i]})}},{key:"init",value:function(){var e=this.getItem(!0);e&&this.setItem(e,!1),this.plugin&&this.plugin.notifyPaneCreated()}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"activate",value:function(){try{h.default.PAssert(1489,!1,"Activating panes should only ever happen on mobile devices")}catch(e){h.default.reportError(e)}this.isActive.get()||(this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1))}},{key:"deactivate",value:function(){try{h.default.PAssert(1490,!1,"Deactivating panes should only ever happen on mobile devices")}catch(e){h.default.reportError(e)}this.isActive.set(!1)}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===g.default.itemStoreManager.getDefaultItemStore()&&M.a.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),this._infiniteList=void 0;try{h.default.PAssert(1491,h.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){h.default.reportError(e)}try{h.default.PAssert(1492,E.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){h.default.reportError(e)}try{h.default.PAssert(1493,!g.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){h.default.reportError(e)}this.onDestroyed.notify()}},{key:"notifyPluginLoaded",value:function(){try{h.default.PAssert(1494,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){h.default.reportError(e)}}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(e){return!1}},{key:"getInfiniteList",value:function(e){var t;if(e){var a=this.getOverview();try{h.default.PAssert(1495,a,"Trying to get infinite list for overview that doesnt exist.")}catch(i){h.default.reportError(i)}a&&(t=a.getInfiniteList())}else t=this._infiniteList;return t}},{key:"getItemStore",value:function(){return this.getRootItem().getItemStore()}},{key:"usesItemStore",value:function(e,t){return(!this.supportsDocuments||!t||t.getDocumentOwner()===this.getDocument())&&(e===this.getItemStore()||!!this._activeItemStores[e.id])}},{key:"useItemStore",value:function(e){try{h.default.PAssert(1496,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(t){h.default.reportError(t)}this._activeItemStores[e.id]=e}},{key:"stopUsingItemStore",value:function(e){try{h.default.PAssert(1497,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(t){h.default.reportError(t)}delete this._activeItemStores[e.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){return this.overview.isVisible.get()}},{key:"isOverviewShowingContents",value:function(){return this.overview.isShowingContents.get()}},{key:"numItems",value:function(){return this.getItems().length}},{key:"numHeaders",value:function(){return this.headersArr.length}},{key:"getItems",value:function(){return g.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headerPaneObjects.get()}},{key:"itemAtIndex",value:function(e){return this._infiniteList.itemAtIndex(e)}},{key:"objectAtIndex",value:function(e){return this._infiniteList.objectAtIndex(e)}},{key:"indexOfItem",value:function(e,t,a){return this._infiniteList.indexOfItem(e,t,a)}},{key:"indexOfObject",value:function(e){return this._infiniteList.indexOfItem(e)}},{key:"topOfItem",value:function(e){return this._infiniteList.topOfItem(e)}},{key:"topOfIndex",value:function(e){return this._infiniteList.topOfIndex(e)}},{key:"indexOfTop",value:function(){return this._infiniteList.indexOfTop()}},{key:"inViewCount",value:function(){return this._infiniteList.inViewCount()}},{key:"itemAtTop",value:function(){return this._infiniteList.itemAtTop()}},{key:"elementAtIndex",value:function(e){return this._infiniteList.getElementAtIndex(e)}},{key:"isIndexMounted",value:function(e){return this._infiniteList.isIndexMounted(e)}},{key:"notifyDragStart",value:function(){return this._infiniteList.notifyDragStart()}},{key:"notifyDragEnd",value:function(){return this._infiniteList.notifyDragEnd()}},{key:"notifySwappedIn",value:function(e){return this._infiniteList.notifySwappedIn(e)}},{key:"getScrollOffset",value:function(){return this._infiniteList.getScrollOffset()}},{key:"addScrollListener",value:function(e){return this._infiniteList.addScrollListener(e)}},{key:"removeScrollListener",value:function(e){return this._infiniteList.removeScrollListener(e)}},{key:"refreshScrollListener",value:function(){return this._infiniteList.refreshScrollListener()}},{key:"setScrollOffset",value:function(e,t,a){return this._infiniteList.setScrollOffset(e,t,a)}},{key:"scrollIndexIntoView",value:function(e,t,a){return this._infiniteList.scrollIndexIntoView(e,t,a)}},{key:"scrollItemIntoView",value:function(e,t,a){return this._infiniteList.scrollItemIntoView(e,t,a)}},{key:"scrollIndexToTop",value:function(e,t,a){return this._infiniteList.scrollIndexToTop(e,t,a)}},{key:"scrollItemToTop",value:function(e,t,a){return this._infiniteList.scrollItemToTop(e,t,a)}},{key:"scrollItemToMiddle",value:function(e,t,a){return this._infiniteList.scrollItemToMiddle(e,t,a)}},{key:"scrollIndexToMiddle",value:function(e,t,a){return this._infiniteList.scrollIndexToMiddle(e,t,a)}},{key:"addScrollDelta",value:function(e){return!!this._infiniteList&&this._infiniteList.addScrollDelta(e)}},{key:"getScrollTop",value:function(){return this._infiniteList.getScrollTop()}},{key:"closestIndexOfObject",value:function(e){return this.indexOfObject(e)}},{key:"sizeAtIndex",value:function(e,t){var a=0,i=t?this.overview._infiniteList:this._infiniteList;try{h.default.PAssert(1499,i,"Must have a valid owner")}catch(r){h.default.reportError(r)}if(i){var n=i.objectAtIndex(e);try{h.default.PAssert(1500,n,"Must have found a valid item")}catch(r){h.default.reportError(r)}n&&(a=this.sizeOfItem(n,e,t))}return a}},{key:"sizeOfItem",value:function(e,t,a){try{h.default.PAssert(1501,e,"Must provide a valid item to measure")}catch(r){h.default.reportError(r)}var i=0,n=e.sizeInPane;return void 0!==n&&(i=isNaN(n)?e.sizeInPane(this,t,a):n,e.sizePad&&(i+=e.sizePad)),i}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&h.default.isObject(e[t])&&(e[t]=h.default.clone(e[t]));return e}},{key:"getSaveInfo",value:function(){var e=this.document.get();return{id:this.id,name:this.name.get(),item:this.item.get().id,document:e?e.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isOverviewShowingContents:this.overview.isShowingContents.get(),isExpanded:this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}},{key:"getSaveInfoItemState",value:function(){var e=this._perPaneState,t={};for(var a in e)if(e.hasOwnProperty(a)){var i=m.a.getItem(a);if(i){var n=e[a];for(var r in n)if(n.hasOwnProperty(r)&&r.startsWith(p.a.PerPaneStateField.Collapsed)){var s=n[r];if(void 0!==s){var o=r.replace(p.a.PerPaneStateField.Collapsed,"");if("Search"===o||s!==this.getCollapsedDefault(i,"Overview"===o,o)||!s&&i.isDemandLoad()){var l=(n[r]?"":"un")+r;t[l]||(t[l]=[]),t[l].push(a)}}}}else delete e[a]}return t}},{key:"saveState",value:function(){g.default.PaneManager.updatePaneStateForPane(this)}},{key:"getPerPaneState",value:function(e,t){var a=this._perPaneState[e];if(a)return a[t]}},{key:"setPerPaneState",value:function(e,t,a){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=a}},{key:"clearPerPaneStateSearch",value:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][p.a.PerPaneStateField.CollapsedSearch]=void 0)}},{key:"deletePerPaneState",value:function(e){this._perPaneState[e]=void 0}},{key:"isSearched",value:function(){try{h.default.PAssert(1502,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){h.default.reportError(e)}return!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){try{h.default.PAssert(1503,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){h.default.reportError(e)}return!!this.search&&this.search.getValue()}},{key:"isSearchedFlat",value:function(){return!1}},{key:"onSearchChanged",value:function(e){var t=E.a.isValid();if(t&&E.a.reset(),this.updateItems(),t&&this.numItems()>0){var a=this.indexOfFirstItem();a>=0&&E.a.selectIndex(a,0)}this.saveState()}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(e,t,a){if(e)for(var i=0,n=0;n<e.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n];this.setPerPaneState(r,t,a)}}},{key:"applyItemState",value:function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var a=t.startsWith("un"+p.a.PerPaneStateField.Collapsed)?t.slice(2):t;if(a.startsWith(p.a.PerPaneStateField.Collapsed)){var i=e[t];this._applyItemStateArr(i,a,!t.startsWith("un"))}}}},{key:"requestDemandLoadData",value:function(e){try{h.default.PAssert(1504,!1,"SubClass must override - by default demand load is not supported")}catch(t){h.default.reportError(t)}}},{key:"requestDataPage",value:function(e){try{h.default.PAssert(1505,!1,"SubClass must override - by default data pagination is not supported")}catch(t){h.default.reportError(t)}}},{key:"getDefaultDisplayItem",value:function(e){return this.getRootItem()}},{key:"getRootItem",value:function(){return this.document.get().getRootItem()}},{key:"setRootItem",value:function(e,t){try{h.default.PAssert(1506,void 0===e.parent(),"Root should never have a parent")}catch(a){h.default.reportError(a)}try{h.default.PAssert(1507,this.getItem()!==e,"Should not be setting root to the same value")}catch(a){h.default.reportError(a)}this.setItem(e,t)}},{key:"scrollFromMousePosition",value:function(e,t,a){var i=a?this.getWidth():this.getHeight(),n=h.default.clamp(.1*i,20,40),r=n,s=a?this.getWidth():this.getHeight()-this.headerHeight(),o=s-n,l=a?e-this.scrollElement.getBoundingClientRect().left:t-this.contentTop(),u=0;l<r?u=h.default.computeScrollSpeed(0,r,l,4,-1):l>o&&(u=h.default.computeScrollSpeed(o,s,l,4)),0!==u?h.default.repeatScroll("pane",u,this,!1):h.default.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(e){return this.item.get()}},{key:"allowZoom",value:function(e){return!0}},{key:"performOverviewAction",value:function(e){}},{key:"setItem",value:function(e,t,a){this._numItemSets++;var i=this.getItem();this.item.set(e,!1),a||this.updateItemsImmediate(!0,!1,!0),i&&i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),t&&(e.itemChanged.notify(),i&&e!==i&&i.itemChanged.notify(),this.item.notify(e,i))}},{key:"getItemSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"isItemsHeightDirty",value:function(){return this.itemsHeightDirty}},{key:"_setDirtyState",value:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}},{key:"updateItems",value:function(e,t){this._setDirtyState(e,t),g.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(e,t,a,i){if(!this.isFakePane&&this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),h.default.shouldLog(p.a.LogLevels.React)&&h.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!i);var n=this.getItem(),r=[],s=this.getItemSearchParams(),o=s.each,l=this.hasCollapsed();s.each=function(e){e.isNote()&&e.parent()===n||(r.push(e),o&&o(e))},this.runItemSearch(s),this._numItemComputes++,this.setItems(r,t),this.updateHeaders(t||a),this.hasCollapsedObs.set(l),this.isInitialized||(this.isInitialized=!0),this.itemsHeightDirty=!1,M.a.fireEvent("itemsUpdated",[this])}}},{key:"updateItemHeights",value:function(){this.plugin||this._infiniteList.onListChanged()}},{key:"runItemSearch",value:function(e){g.default.searchVMLIs(e)}},{key:"updateOutline",value:function(e,t){var a,i=0,n=[],r={},s=this.getItem().levelsDeep.get();if(t){var o=0,l=0,u=[];for(a=0;a<e.length;a++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e[a].isNote()||u.push({item:e[a],index:u.length})}for(u.sort(t),e=[],a=0;a<u.length;a++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=u[a].item;e.push(d),d.hasNote()&&e.push(d.getNote())}}for(a=0;a<e.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=e[a],h=new G.a({type:"blockItem",item:c,id:c.id,pane:this,index:a,parentObject:r[c.parent().id],levelsDeep:(c.isNote()?c.parent():c).levelsDeep.get()-s-1,sizeInPane:c.sizeInPane});r[c.id]=h,this.addPaneObject(n,h)}this.items.set(n)}},{key:"_setItems",value:function(e,t){this.updateOutline(e)}},{key:"setItems",value:function(e,t){this._allPaneItems=e,this.paneObjectsByItem={},this._setItems(e,t),E.a.getPane()===this&&E.a.checkValid()}},{key:"updateHeaders",value:function(e){var t=[],a=this.getHeaderSearchParams();a.each=function(e){t.push(e)},g.default.searchVMLIs(a),this._numHeaderComputes++,this.setHeaders(t,e)}},{key:"setHeaders",value:function(e,t){var a=this;if(t||!e.equals(this.headersArr)){this.headersArr=e;var i=e.map(function(e,t){return new G.a({type:"blockItem",item:e,id:e.id,pane:a,index:t,levelsDeep:e.levelsDeep.get(),sizeInPane:p.a.OverviewItemHeightDesktop})});this.headerPaneObjects.set(i)}}},{key:"clearItems",value:function(e){this.items.set([],e)}},{key:"onLoad",value:function(){this.isLoaded=!0,this.getItemStore()===g.default.itemStoreManager.getDefaultItemStore()&&M.a.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))}},{key:"onInfiniteListLoaded",value:function(){}},{key:"onInfiniteListMounted",value:function(){}},{key:"onAfterLoaded",value:function(){var e=this;this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop(),setTimeout(function(){e._infiniteList&&e._infiniteList.addScrollListener(function(){h.default.timeoutOnce("onScrollSave"+e.id,g.default.PaneManager.savePaneState,1e3)})},1e3)),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var e=this.rect.get().width;try{h.default.PAssert(1508,e>100,"Pane width is not set",this.rect.get())}catch(t){h.default.reportError(t)}if(e>100)return e}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getItemHeight",value:function(){}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.overview.toggleDesktop()}},{key:"notifyDropFrom",value:function(e,t){}},{key:"notifyDropFromToEdit",value:function(e,t){if(!e.hasChildren()&&e.hasAttachmentType(p.a.PluginType.Storage))return e.getAttachmentByType(p.a.PluginType.Storage).getPlugin().notifyDropFromToEdit(e,t);var a=document.createElement("ul");return a.innerHTML=Y.a.toDropHtml(e),a}},{key:"dropEffectCopyBehavior",value:function(e,t){return e.clone(t,p.a.ChangeType.Local)}},{key:"_isNodeTextParent",value:function(e){return ee.every(function(t){return!e.classList.contains(t)})}},{key:"convertElementToText",value:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=p.a.AttachChar;else if(this._isNodeTextParent(e))for(var a=0,i=0;i<e.childNodes.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[i])}return t}},{key:"compositionStart",value:function(){E.a.isComposing=!0}},{key:"compositionEnd",value:function(e){E.a.isComposing=!1}},{key:"addItemToPane",value:function(e,t){var a=this.getItem();e.text||(e.text=""),this.setIgnoreRestoreScroll();var i=a.addItemAtIndex(e,t,this);return q.a.setSelected([t],this),i}},{key:"archiveItem",value:function(e,t){return t.archiveSelf(p.a.ChangeType.Local)}},{key:"archiveSelected",value:function(e){var t=this,a=0,i=this.indexOfPrevVMLI(E.a.getStartIndex(),!0,!0);if(this.applyToSelection(function(e){t.archiveItem(!0,e),a++}),a>0){if(i<0&&this.numItems()>0&&(i=this.indexOfFirstItem()),i>=0){var n=this.itemAtIndex(i).getParsedText().length;E.a.selectIndex(i,n)}var r=a>1?" items.":" item.";g.default.toasts.pushMessage({text:"Archived "+a+r,action:p.a.MessageAction.Undo,hold:!1,timeout:8e3})}}},{key:"deleteSelected",value:function(e,t){var a=this.indexOfPrevVMLI(E.a.getStartIndex(),!0,!0),i=0;if(K.a.saveDeleteSelection(),this.applyToSelection(function(t){e&&!e(t)||t.isDeleted()||(i+=t.numChildrenRecursive()+1,t.deleteSelf(p.a.ChangeType.Local))}),a<0&&this.numItems()>0&&(a=this.indexOfFirstItem()),a>=0){var n=this.itemAtIndex(a);if(n){var r=n.getParsedText().length;E.a.selectIndex(a,r)}else E.a.reset()}var s=i>1?" items.":" item.";g.default.toasts.pushMessage({text:"Deleted "+i+s,action:p.a.MessageAction.Undo,timeout:p.a.ToastTimeoutDefault})}},{key:"handleLeftSideTap",value:function(e,t){var a=e.item;if(this.supportCollapsing)if(y.a.mac&&t.metaKey||!y.a.mac&&t.ctrlKey)this.zoomIn(a);else if(a.isCollapsible()){var i=E.a.save(),n=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapseAll(a,n,!0):this.setPaneObjectCollapsed(n,e),i&&this.restoreSelectionAfterCollapse(i,a)}}},{key:"handleRightSideTap",value:function(e,t){this.supportCompleting&&(h.default.beginCompleteAction(),e.setComplete(!e.isComplete(),p.a.ChangeType.Local),h.default.endCompleteAction())}},{key:"onClickTitle",value:function(e){var t=this.getItem();return this.zoomOut(e),h.default.sendEvent("Menu","Title"),t!==this.getItem()}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"onTapStart",value:function(e){if(!h.default.findParent(e.target,"itemNotInPane")&&!h.default.hasClass(e.target,"androidInput")){var t,a;this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),E.a.setFocusedPane(this),a=h.default.getItemForElement(e.target);var i=h.default.getIndexForElement(e.target);if(a&&a.onStart&&a&&a.onStart){var n=this.objectAtIndex(i);(t=a.onStart(i,n,e))&&h.default.preventAndStop(e)}this._startPrevented=t}}},{key:"onTapMove",value:function(e){if(h.default.isAttachedToDoc(e.target)&&!h.default.findParent(e.target,"itemNotInPane")&&!h.default.hasClass(e.target,"androidInput")){var t=h.default.getItemForElement(e.startSrc);return g.default.DragDrop.isDragging&&(t=g.default.DragDrop.dragItem),t&&t.onMove&&t.onMove(e,!1),!1}}},{key:"onTapClick",value:function(e){if(!h.default.findParent(e.target,"itemNotInPane")&&!h.default.hasClass(e.target,"androidInput")&&!this._startPrevented){var t,a=h.default.getItemForElement(e.startSrc);if(a&&(e.targetItem=a),a&&a.onClick){void 0===t&&(t=h.default.getIndexForElement(e.startSrc));var i=this.objectAtIndex(t);this.onClickItem(t,a,i,e)}else h.default.hasClass(e.startSrc,"paneDataPageLoad")||e.startSrc.parentElement&&h.default.hasClass(e.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):h.default.hasClass(e.startSrc,"agendaCollapser")||(this.isWriteable&&0===this.numItems()&&this.canAddItem&&!h.default.hasClass(this.paneContent,"loading")?this.addItem({e:e}):h.default.preventDefault(e))}}},{key:"onTapEnd",value:function(e){E.a._isMouseDown=!1;var t=e.targetItem||h.default.getItemForElement(e.startSrc);g.default.DragDrop.isDragging&&(t=g.default.DragDrop.dragItem),t&&("paneContent"===e.startSrc.id&&h.default.preventDefault(e),t&&t.onEnd&&t.onEnd(e))}},{key:"onTapDoubleClick",value:function(e){if(!h.default.findParent(e.target,"itemNotInPane")){var t=h.default.getItemForElement(e.startSrc);if(t&&t.onDoubleClick){var a=h.default.getIndexForElement(e.startSrc);this.onDoubleClickItem(a,t,e)}}}},{key:"onTapRightClick",value:function(e){if(!h.default.findParent(e.target,"itemNotInPane")&&!h.default.isDisplayModeActive(p.a.DisplayMode.NoRightClick)){E.a.setFocusedPane(this);var t=h.default.getItemForElement(e.target);if(t&&t.onRightClick){var a=h.default.getIndexForElement(e.target);this.onRightClickItem(a,t,e)}v.d.miscAction({type:v.b.Misc,misc:v.a.RightClick,data:{element:void 0,pane:this}})}}},{key:"onClickItem",value:function(e,t,a,i){t.isNote()||t.onClick(e,a,i)}},{key:"onRightClickItem",value:function(e,t,a){t.onRightClick(e,a)}},{key:"onDoubleClickItem",value:function(e,t,a){t.onDoubleClick(e,a)}},{key:"addItem",value:function(e){e.index,e.prefix,e.text,e.toRoot,e.date,e.e}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(e){this.addItem({e:e})}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?h.default.sendEvent("Menu","OpenOverview"):h.default.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var e=g.default.PaneManager.removePane(this);if(e){try{h.default.PAssert(1509,e===this.id,"Pane IDs must match")}catch(t){h.default.reportError(t)}v.d.performAction(v.b.UIAction,{type:v.c.RemovePane,data:e}),h.default.sendEvent("Menu","ClosePane"),g.default.tooltip.hideTip(),this.onClose()}}},{key:"onClickArchiveCompleted",value:function(e){this.archiveCompleted(),h.default.preventAndStop(e),h.default.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(e){try{h.default.PAssert(1510,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(t){h.default.reportError(t)}this.refreshPaneData(),h.default.sendEvent("Menu","PaneDataRefresh"),h.default.preventAndStop(e)}},{key:"onClickReportError",value:function(e){try{h.default.PAssert(1511,this.supportReportError,"Pane does not support error reporting")}catch(t){h.default.reportError(t)}this.reportPaneError(),h.default.sendEvent("Menu","PaneReportError"),h.default.preventAndStop(e)}},{key:"refreshPaneData",value:function(e){m.a.isConnected()||g.default.toasts.pushMessage({text:"Your connection appears to be offline. Data will refresh when you go online."}),this._refreshPaneData(e)}},{key:"_refreshPaneData",value:function(e){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var e=[];return g.default.searchVMLIs({item:this.getItem(),each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e}},{key:"archiveCompleted",value:function(){var e,t,a,i=0;if(E.a.isValid()){var n=0;for(t=E.a.getEndIndex();t<this.items.length();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if((a=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var r=this.getItemsToArchive();for(v.d.beginAction(),g.default.PaneUpdateBatcher.beginUpdateItems(),t=r.length-1;t>=0;t--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a=r[t],h.default.shouldLog(p.a.LogLevels.Data)&&h.default.log("Archive Item: ",a.getParsedText()),a.archiveSelf(p.a.ChangeType.Local)}if(g.default.PaneUpdateBatcher.commitUpdateItems(),v.d.endAction(),r.length>0){var s=r.length>1?" items.":" item.";g.default.toasts.pushMessage({text:"Archived "+(r.length+s),action:p.a.MessageAction.Undo,hold:!1,timeout:8e3})}else g.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var o=this.indexOfObject(e);if(o>=0){a=this.itemAtIndex(o);try{h.default.PAssert(1512,a,"Could not restore selection to item")}catch(u){h.default.reportError(u)}if(a){var l=a.getParsedText().length;E.a.selectIndex(o,l)}}}else E.a.reset()}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.getItem().parents().concat(this.getItem())}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){return this.getDocument().text.get()}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&M.a.fireEvent("showArchived",[]),this.updateItems()}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)}},{key:"getFirstItem",value:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(e){e&&this.paneContent&&this.paneContent.focus(),this.isFocused.set(e)}},{key:"headerHeight",value:function(){return 68}},{key:"handleUndo",value:function(){K.a.undo()}},{key:"handleRedo",value:function(){K.a.redo()}},{key:"contentTop",value:function(){return g.default.DesktopUI.topBarHeight()+this.headerHeight()}},{key:"indexPageUp",value:function(e){return e=this._infiniteList.indexPageUp(e),this.itemAtIndex(e)||(e=this.indexOfNextVMLI(e)),e}},{key:"indexPageDown",value:function(e){return e=this._infiniteList.indexPageDown(e),this.itemAtIndex(e)||(e=this.indexOfPrevVMLI(e)),e}},{key:"adjustSelectionFromPaneObject",value:function(e){try{h.default.PAssert(1513,e,"Must pass in a valid saved selection")}catch(a){h.default.reportError(a)}var t=e;return e.startItem&&e.endItem&&(e.startIndex=this.indexOfObject(e.startObject),e.endIndex=this.indexOfObject(e.endObject),(e.startIndex<0||e.endIndex<0)&&(t=void 0)),t}},{key:"restoreSelection",value:function(e){try{h.default.PAssert(1514,e,"Must always have a valid saved selection")}catch(o){h.default.reportError(o)}if(e){var t=this.indexOfObject(e.startObject),a=this.indexOfObject(e.endObject);if(t>=0&&a>=0){var i=e.startOffset,n=e.endOffset,r=e.startItem.getParsedText(),s=e.endItem.getParsedText();(i<0||i>r.length||n<0||n>s.length)&&(i=-1,n=-1),E.a.selectIndices(t,i,a,n)}else E.a.reset()}else E.a.reset()}},{key:"restoreSelectionAfterCollapse",value:function(e,t){if(e){var a,i,n=e.startItem,r=this.indexOfItem(e.startItem),s=this.indexOfItem(e.endItem);if(r>=0&&s>=0)E.a.selectIndices(r,e.startOffset,s,e.endOffset),a=e.startItem;else if(r>=0)E.a.selectIndex(r,e.startOffset),a=e.startItem,i=!0;else if(s>=0)E.a.selectIndex(s,e.endOffset),a=e.endItem,i=!0;else if(!0===t){var o=0;for(a=n;a;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=a.parent();if(l===h.default.focusedPane.item.get()){E.a.selectItem(a,a===n?E.a.getStartOffset():-1),i=!0;break}a=l}}else E.a.reset();a&&i&&h.default.focusedPane.scrollItemToMiddle(a,p.a.ScrollDuration.Snap)}}},{key:"setCollapsedRecursive",value:function(e,t,a){var i=0,n=e.numChildren(),r=e.getItems();!a||this.isSearchedFlat()&&!this.search.isMatched(e)||e.setCollapsed(t,this,!1,!1);for(var s=0;s<n;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[s];o.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(o))&&this.setCollapsedRecursive(o,t,!0)}}},{key:"collapseAll",value:function(e,t,a,i){try{h.default.PAssert(1515,this.supportCollapsing,"Should not be collapsing all")}catch(s){h.default.reportError(s)}var n=e||this.item.get(),r=E.a.save();this.setIgnoreRestoreScroll(),g.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==t&&this.setCollapsedRecursive(n,t,!!a),this.saveState(),(i||this.isSearchedFlat())&&this.updateItems(),g.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(r,t)}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(this.item.get(),e)}}},{key:"hasCollapsed",value:function(e){for(var t=0,a=(e=e||this.item.get()).numChildren(),i=e.getItems(),n=0;n<a;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n];if(r.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(r))){if(r.isCollapsed(this,!1))return!0;if(this.hasCollapsed(r))return!0}}return!1}},{key:"onOverviewToggled",value:function(e){}},{key:"getPaddingForPaneObject",value:function(e,t){var a=e.levelsDeep,i=e.item,n=!t&&this.isSearchedFlat()?g.default.DisplaySettings.itemIndentStart():i.getPadding(this,t,a);return n>this.getWidth()-p.a.SPThresholdRight&&(n=this.getWidth()-p.a.SPThresholdRight-8),n}},{key:"maxWidthOfPaneObject",value:function(e){var t=this.getPaddingForPaneObject(e,!1);return this.getWidth()-t-p.a.SPThresholdRight-(e.item.hasPrefix()?this.shouldRenderPrefix(e)?p.a.PrefixWidth:5:0)}},{key:"prevPaneObjectAtSameLevel",value:function(e){var t=0;try{h.default.PAssert(1516,e>=0,"Must supply a valid selection index: "+e)}catch(s){h.default.reportError(s)}try{h.default.PAssert(1517,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(s){h.default.reportError(s)}for(var a=this.objectAtIndex(e),i=e-1;i>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.objectAtIndex(i),r=this.itemAtIndex(i);if(r&&a.item!==r&&!r.isNote()&&n.levelsDeep===a.levelsDeep)return n;i--}}},{key:"indexOfPrevVMLI",value:function(e,t,a){var i=0;try{h.default.PAssert(1518,e>=0,"Must supply a valid selection index: "+e)}catch(o){h.default.reportError(o)}try{h.default.PAssert(1519,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){h.default.reportError(o)}for(var n=t?this.itemAtIndex(e):void 0,r=e-1;r>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this.itemAtIndex(r);if(s&&n!==s&&(!a||!s.isNote()))return r;r--}return-1}},{key:"indexOfNextVMLI",value:function(e,t,a){var i=0;try{h.default.PAssert(1520,e>=-1,"Must supply a valid selection index: "+e)}catch(o){h.default.reportError(o)}try{h.default.PAssert(1521,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(o){h.default.reportError(o)}for(var n=t?this.itemAtIndex(e):void 0,r=e+1;r<this.numItems();){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this.itemAtIndex(r);if(s&&n!==s&&(!a||!s.isNote()))return r;r++}return-1}},{key:"indexOfNextSibling",value:function(e){var t=0;try{h.default.PAssert(1522,e>=-1,"Must supply a valid selection index: "+e)}catch(i){h.default.reportError(i)}try{h.default.PAssert(1523,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){h.default.reportError(i)}var a=this.itemAtIndex(e);for(e=this.indexOfNextVMLI(e);e>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.itemAtIndex(e).isDescendantOf(a))break;e=this.indexOfNextVMLI(e)}return e>=0?e:-1}},{key:"_getPrevNextItem",value:function(e,t,a){var i=a?this.indexOfNextVMLI:this.indexOfPrevVMLI,n=i.call(this,e);if(t)for(var r=0,s=this.itemAtIndex(e);n>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this.itemAtIndex(n);if(s.parent()===o.parent())return o;if(s.parent()===o||o.parent()===s.parent().parent()){n=-1;break}n=i.call(this,n)}else if(n>=0)return this.itemAtIndex(n)}},{key:"getPreviousItem",value:function(e,t){return this._getPrevNextItem(e,t,!1)}},{key:"getNextItem",value:function(e,t){return this._getPrevNextItem(e,t,!0)}},{key:"getFirstSelectedItem",value:function(){var e;return this.applyToSelection(function(t){return e=t,!1}),e}},{key:"getFirstSelectedIndex",value:function(){return E.a.getStartIndex()}},{key:"applyToSelection",value:function(e,t){var a=0;try{h.default.PAssert(1524,!t||!t.restoreSelection,"restoreSelection is no longer a valid option")}catch(r){h.default.reportError(r)}v.d.beginAction(),K.a.beginAction();var i=E.a.getSelectedObjects();g.default.PaneUpdateBatcher.beginUpdateItems();for(var n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!1===e(i[n].item,n,i.length,i[n]))break}g.default.PaneUpdateBatcher.commitUpdateItems(),K.a.endAction(),v.d.endAction()}},{key:"applyFnToSelection",value:function(e,t){var a=E.a.save(),i=t&&t.toggle,n=!t||void 0===t.value||t.value,r=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection(function(t){i&&t[i]()!==n&&(i=void 0),i||t[e](n,r)}),i){var s=s=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection(function(t){t[e](s,r)})}a&&!t.noRestoreSel&&this.restoreSelection(a)}},{key:"applyPriorityToSelection",value:function(e,t){t?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:e,value2:p.a.ChangeType.Local,emptyValue:p.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:p.a.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},function(e,t){var a=t.value.trim(),i=e.getParsedText()+" "+p.a.TagPrefix+a;e.setText(i,p.a.ChangeType.Local)})}},{key:"autocompleteMove",value:function(e,t){var a=this;(e=e||{}).mode=p.a.AutocompleteMode.Move,e.text="Select item to move to",e.documentSelector=!this.supportsDocuments,e.buttonText="MOVE",this._autocompletePopup(e,function(e,t){var i;t.subItemText?(i=a.createVMLI({text:t.subItemText},{parent:t.item,changeType:p.a.ChangeType.AllLocal}),t.item.insertItem(i,0)):t.item===e||t.item.isDescendantOf(e)||(i=t.item),i&&a.moveItem(e,i)},function(){t&&t(),E.a.updateCaret()})}},{key:"autocompleteJump",value:function(e,t){var a=this;(e=e||{}).mode=p.a.AutocompleteMode.Jump,e.text="Select item to jump to",e.buttonText="JUMP",this._autocompletePopup(e,function(){},function(e){e.item&&a.indexOfItem(e.item)>=0&&(E.a.selectItem(e.item,0,0),a.scrollItemToTop(e.item,p.a.ScrollDuration.Default)),t&&t(),E.a.updateCaret()})}},{key:"autocompleteSnooze",value:function(e,t,a){var i,n=this,r=g.default.pluginManager.getPlugin(p.a.PluginID.Gmail);if(!t){var s=e&&e.item||this.getFirstSelectedItem();s&&(i=s.getAttachmentByPlugin(r.id))&&(t=i.getField("accountID"))}Z.a.isLoaded?(g.default.toasts.clearMessage(p.a.MessageID.SnoozeOffline),(e=e||{}).mode="snooze",e.text="Snooze until date",e.buttonText="SNOOZE",e.allowCustom=!0,this._autocompletePopup(e,function(t,a){r.beginAction();var s=a.value.trim(),o=g.default.International.parseDateDefaultFormat(s);if(i=t.getAttachmentByPlugin(r.id))if(h.default.isDateValid(o))if(Z.a.isAuthorizedForScopes(i.getField("accountID"),[p.a.GScope.GmailModify])){var l=o.getTime()-Date.now();l<h.default.weeks(1)?r.performAction(p.a.PluginAction.Gmail.Snooze,!1,i,l):g.default.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:p.a.MessageAction.Okay})}else g.default.menus.closeContextMenu(),function(){var t=e&&e.elementDisplay;if(!t){var a=n.getFirstSelectedIndex();t=n.elementAtIndex(a)}g.default.menus.openContextMenu({componentName:"ReactContextMenuAuthorize",element:t,message:"Your account needs additional authorization to Snooze. Please update your authorization to enable Snooze."})}();else g.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:p.a.MessageAction.Okay});else g.default.toasts.pushMessage(p.a.MessageID.ReselectEmail);r.endAction()},a)):g.default.toasts.pushMessage(p.a.MessageID.SnoozeOffline)}},{key:"autocompleteSchedule",value:function(e,t){(e=e||{}).mode="date",e.text="Add event on date",e.buttonText="Add",e.allowCustom=!0;var a=g.default.pluginManager.getPlugin(p.a.PluginID.Gmail);this._autocompletePopup(e,function(e,t){v.d.beginAction();var i=t.value.trim(),n=g.default.International.parseDateDefaultFormat(i);h.default.isDateValid(n)?a.scheduleEmail(e,n):g.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:p.a.MessageAction.Okay}),v.d.endAction()},t)}},{key:"autocompleteLabel",value:function(e,t){var a,i=this,n=g.default.pluginManager.getPlugin(p.a.PluginID.Gmail),r=function(e){var t=e.getAttachmentByPlugin(n.id),i=t.getPlugin().getDisplayTags(t);a=a?h.default.arrayIntersection(a,i):i};(e=e||{}).item?r(e.item):this.applyToSelection(r),e.tokens=(a||[]).map(function(e){return{text:e}}),e.mode=p.a.AutocompleteMode.GmailLabel,e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(a){var r=a.text;n.beginAction();var s=function(e){var t=e.getAttachmentByPlugin(n.id);if(t)if(n.attachmentHasLabel(t,r))n.performAction(p.a.PluginAction.Gmail.RemoveLabel,!1,t,r);else try{h.default.PAssert(1525,!1,"Tried to remove a tag from an attachment without a tag")}catch(a){h.default.reportError(a)}else g.default.toasts.pushMessage(p.a.MessageID.ReselectEmail)};e.item?s(e.item):i.applyToSelection(s),n.endAction(),t&&t(a)},this._autocompletePopup(e,function(e,t){var a=t.value.trim();try{h.default.PAssert(1526,e.hasPluginAttachment(n.id),"Must have valid plugin attachment")}catch(s){h.default.reportError(s)}var i=e.getAttachmentByPlugin(n.id);if(i){if(a){var r=n.createLabelString(a);r?n.attachmentHasLabel(i,r)||n.performAction(p.a.PluginAction.Gmail.AddLabel,!1,i,r):g.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:p.a.MessageAction.Okay})}}else g.default.toasts.pushMessage(p.a.MessageID.ReselectEmail)})}},{key:"_autocompletePopup",value:function(e,t,a){var i=this;if(!e.elementDisplay){var n=E.a.getStartIndex(),r=this.elementAtIndex(n);e.elementDisplay=r}var s=e.item,o=e;o.pane=this,o.item||(o.item=this.getRootItem()),o.onSelected=function(e){s?t(s,e):i.applyToSelection(function(a){t(a,e)}),a&&a(e)},W.a.showPopup(o)}},{key:"moveItem",value:function(e,t,a){if(v.d.beginAction(),g.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},p.a.ChangeType.Local);else{var i=this.dropEffectCopyBehavior(e,t);i.setParent(t),t.insertItem(i)}g.default.PaneUpdateBatcher.commitUpdateItems(),v.d.endAction()}},{key:"setPropDefault",value:function(e,t){void 0===this[e]&&(this[e]=t)}},{key:"setExpanded",value:function(e,t){var a=this.isExpanded.get()!==e;this.isExpanded.set(e),a&&!1!==t&&(M.a.fireEvent("panesChanged",[]),this.saveState(),g.default.PaneManager.ensurePaneInView(this))}},{key:"modifyTextOnDropBasedOnSearch",value:function(e,t,a,i,n,r){var s=0;if(!a||!a.search)return e;var o,l,u=a.search,d=this.search,c=t[r](),h=u[r](),f=d[r](),p=[],g=[];for(o=0;f&&o<f.length;o++){var m=0;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l=f[o];for(var v=i,y=!c||c.indexOf(l)<0;y&&v;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=v[r]();k&&k.indexOf(l)>=0&&(y=!1),v=v.parent()}y&&p.push(n+l)}if(p.length){var _=0;for(o=0;c&&h&&o<h.length;o++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;l=h[o],c.indexOf(l)>=0&&f.indexOf(l)<0&&g.push(n+l)}var S=p.join(" ");if(g.length>0){var P=0;for(o=0;o<g.length;o++){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;l=g[o],e=0===o?e.replace(l,S):e.replace(l,"")}}else e=e+" "+S;e=e.replace(/  +/g," ")}return e}},{key:"canAcceptDragOver",value:function(e,t,a,i){return this.isDropTarget}},{key:"handleDragOver",value:function(e,t,a,i,n){var r=h.default.getElementParent(a),s=r&&h.default.getItemForElement(r),o=(r||h.default.findParent(a,"blockHeader"))&&h.default.getPaneObjectForElement(a),l={};return r&&h.default.findParent(r,"overviewList")?(this.overview.updateDragHoverItem(s),l={overview:!0,targetItem:s,targetElement:r}):(this.overview.updateDragHoverItem(null),l=this._handleDragOverPane(e,t,a,r,o,i,n)),l}},{key:"_handleDragOverPane",value:function(e,t,a,i,n,r,s){}},{key:"handleDragDrop",value:function(e,t,a,i){var n=!1;return a&&e!==a.targetItem&&a.targetItem&&(n=this._handleDragDrop(e,t.dataTransfer,a,t,i)),this.revertDrag(),n}},{key:"_handleDragDrop",value:function(e,t,a,i,n){for(var r=0,s=a.overview,o=!0,l=t.pane,u=e,d=a.targetItem,c=!1,f=d.parent();f&&o;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;f===e&&(o=!1,g.default.toasts.pushMessage({text:"Cannot drop an item into its own children",action:p.a.MessageAction.Okay})),f=f.parent()}if(o){var m,k=-1;if(s)k=(m=d).numChildren();else if(a.dropOnPane)m=d,k=a.atEnd?d.numItems():0;else if(a.position===p.a.DragDropPosition.Above)m=d.parent(),k=d.getIndex();else if(a.position===p.a.DragDropPosition.On){m=d,k=y.a.mac&&i.ctrlKey||!y.a.mac&&i.altKey?0:d.numItems()}else{var _=this.indexOfItem(d),S=this.getNextItem(_);S&&S.parent()===d&&!S.isNote()?(m=d,k=0):(m=d.parent(),k=d.getIndex()+1)}v.d.beginAction();try{h.default.PAssert(1527,m,"Trying to move without a target")}catch(D){h.default.reportError(D)}try{h.default.PAssert(1528,!isNaN(k),"Trying to move without a target index")}catch(D){h.default.reportError(D)}if(c=!0,t.dropEffect===p.a.DropEffect.Move){var P=e.parent();if(P){var w=e.getIndex();if(P.belongsToSameItemStore(m)){var I=e.isCollapsed(l);e.moveTo({parent:m,index:k},p.a.ChangeType.Local),v.d.performAction(v.b.Move,{itemID:e.id,oldParent:P.id,oldPosition:w,newParent:m.id,newPosition:k});var b=e.getRawText();b=this.modifyTextOnDropBasedOnSearch(b,e,l,m,p.a.TagPrefix,"getTags"),(b=this.modifyTextOnDropBasedOnSearch(b,e,l,m,p.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(b,p.a.ChangeType.Local),e.setCollapsed(I,this)}else e=e.clone(m,p.a.ChangeType.Local),m.insertItem(e,k),P.removeChildAtIndex(w,p.a.ChangeType.Local)}else e=e.clone(m,p.a.ChangeType.Local),m.insertItem(e,k)}else n||(e=t.pane?t.pane.dropEffectCopyBehavior(e,m):e.clone(m,p.a.ChangeType.Local)),e?(e.setParent(m),m.insertItem(e,k)):c=!1;c&&(M.a.fireEvent("droppedItem",[u,this,t.pane]),v.d.miscAction({type:v.b.Misc,misc:v.a.DropItem,data:{itemID:e.id,toPane:this,fromPane:t.pane}})),v.d.endAction(),c&&t.pane&&t.pane.notifyDropFrom(e,this)}return c}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}},{key:"onNotePopupClosed",value:function(){}},{key:"openNoteContextMenu",value:function(){var e=E.a.getStartItem(),t=E.a.getStartIndex(),a=E.a.getStartOffset(),i=E.a.getEndOffset(),n=this.elementAtIndex(t);if(n){try{h.default.PAssert(1529,n.firstChild,"Opening a note should have a firstChild",h.default.getElementPath(n))}catch(s){h.default.reportError(s)}n.firstChild&&(n=n.firstChild),void 0!==a&&void 0===i&&(i=a);var r={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:n,item:e.parent(),note:e,pane:this,noBackdrop:!1,index:t,position:"fill",selectionStart:a,selectionEnd:i};g.default.menus.isContextMenuOpen()&&g.default.menus.closeContextMenu(),E.a.clearSelection(!0),r.positionOffset={left:-4,top:-18},g.default.menus.openContextMenu(r)}}},{key:"closeNoteContextMenu",value:function(){g.default.menus.isContextMenuOpen()&&g.default.menus.closeContextMenu()}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(e,t,a,i){var n=t.isNoKey?"":t.name,r=a&&a.name.replace(i,""),s=e.getRawText();(""===n||s.indexOf(n)<0)&&(r?s=s.replace(i+r,n):s+=" "+n,e.setText(s,p.a.ChangeType.Local))}},{key:"applyDropOnBlock",value:function(e,t,a,i){var n,r=e;if(E.a.setFocusedPane(a),r.isStarred||r.isImportant)r.isStarred?t.setStarred(!0,p.a.ChangeType.Local):r.isImportant&&(n=p.a.VMLIFlag.P0),n&&t.setPriority(n,p.a.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,i&&i.isTag?i:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,i&&i.isContact?i:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,p.a.ChangeType.Local);else{var s=g.default.pluginManager.getPluginGCalendar(),o=!0;if(t.hasAttachmentType(p.a.PluginType.Calendar)){var l=t.getAttachmentByType(p.a.PluginType.Calendar);l&&l.getField("recurringEventId")&&t.getCalendarParsedText()===l.getField("summary")?(g.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),o=!1):s.isEnabled()?s.hasWritePermissionForAttach(l)||(g.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),o=!1):(g.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:p.a.MessageAction.OpenSettings}),o=!1)}if(o)if(t.setDate(e.date,e.duration||p.a.DefaultEventDuration,p.a.ChangeType.Local),h.default.isDateValid(r.date)&&s&&a!==this&&!t.hasAttachmentType(p.a.PluginType.Calendar))if(s.getDefaultExportCalendarID()){var u=g.default.pluginManager,d=p.a.PluginSettingsID.GCalendar.SyncDraggedEvents,c=function(){u.getSetting(p.a.PluginID.GCalendar,d)&&s.createEventForItem(t)};g.default.settings.shouldShowHelp("syncNewEvents")?g.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",function(e){g.default.settings.closeHelp("syncNewEvents"),u.setSetting(p.a.PluginID.GCalendar,d,e),c()}):c()}}if(a.isEditable){var f=a.indexOfItem(t,e);f>=0&&E.a.selectIndex(f,t.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(e,t){var a=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout(function(){a._ignoreRestoreScroll=!1,t&&t()},e||100)}},{key:"isIgnoringRestoreScroll",value:function(){return this._ignoreRestoreScroll}},{key:"zoomInOnSwipe",value:function(e){var t=this,a=this.item.get();this.zoomIn(e),g.default.toasts.pushMessage({text:"<b>Zoomed in to:</b>"+e.getParsedText(),action:function(){t.zoomIn(a)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(e){var t;(e.deleteSelf(p.a.ChangeType.Local),e.hasAttachmentType(p.a.PluginType.Email))?t=e.getAttachmentByType(p.a.PluginType.Email).getField("subject"):t=e.getParsedTextWithoutPrefix();g.default.toasts.pushMessage({text:"<b>Deleted:</b>"+t,action:function(){K.a.undo()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(e){this.supportCompleting&&(h.default.beginCompleteAction(),e.setComplete(!e.isComplete(),p.a.ChangeType.Local),h.default.endCompleteAction())}},{key:"getSwipeMenuItemsNew",value:function(e){var t=e.item;return{left:[{icon:"check",text:t.isComplete()?"Uncomplete":"Complete",backgroundColor:"#0c0",onActivated:this.completeOnSwipe.bind(this,t)}],right:[{icon:t.isCollapsed(this)?"keyboard-arrow-up":"keyboard-arrow-down",backgroundColor:"#777",onActivated:this.collapseOnSwipe.bind(this,t)},{icon:"zoom-in",backgroundColor:"#09d",onActivated:this.zoomInOnSwipe.bind(this,t)},{icon:"delete",backgroundColor:"#a30",onActivated:this.deleteOnSwipe.bind(this,t)}]}}},{key:"_openSelectedInMode",value:function(e){var t=E.a.getStartItem();t&&this.openEmailByItem(t,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(p.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(p.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(p.a.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(e,t){if(e){var a=e.getAttachmentByPlugin(p.a.PluginID.Gmail);(a&&a!==g.default.EmailPreview.getThreadAttach()||!g.default.EmailPreview.isOpenOnPane(this)||t)&&a.getPlugin().openEmailByItem(e,this,t)}}},{key:"markItemRead",value:function(e,t){var a=g.default.pluginManager.getPluginGmail(),i=t.getAttachmentByPlugin(a.id),n=e?p.a.PluginAction.Gmail.MarkRead:p.a.PluginAction.Gmail.MarkUnread;try{h.default.PAssert(1531,i,"Must be able to get a valid attachment")}catch(r){h.default.reportError(r)}(e&&a.isItemUnread(t)||!e&&!a.isItemUnread(t))&&a.performAction(n,!1,i)}},{key:"markReadSelected",value:function(e){var t=g.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}},{key:"toggleStarSelected",value:function(){var e,t=g.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(function(a){var i=a.getAttachmentByPlugin(t.id);try{h.default.PAssert(1532,i,"Must be able to get a valid attachment")}catch(r){h.default.reportError(r)}var n=t.isItemStarred(a);void 0===e&&(e=n?p.a.PluginAction.Gmail.Unstar:p.a.PluginAction.Gmail.Star),(n&&e===p.a.PluginAction.Gmail.Unstar||!n&&e===p.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,i)}),t.endAction()}},{key:"selectIndex",value:function(e,t){E.a.selectIndex(e,t||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){var e=this.indexOfFirstItem();e>=0&&E.a.selectIndex(e,0)}},{key:"isOverviewVisibleInPane",value:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(g.default.DisplaySettings.itemLineHeight()+2*g.default.DisplaySettings.itemPadding()+(g.default.DisplaySettings.noteLineHeight()+g.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){this.setScrollOffset(this.defaultOffset)}},{key:"widthOfDrag",value:function(e){}},{key:"getSubItems",value:function(e,t){var a=[],i={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||a.push(e)}};return this.runItemSearch(i),a}},{key:"getMetricsForPaneObject",value:function(e,t,a){var i;try{var n=g.default.settings.showMarkdown.get()&&a;i=g.default.Measure.measurePaneObject(e,this,n,n)}catch(r){h.default.reportError(r)}return i}},{key:"getStyledLinesForPaneObject",value:function(e,t,a){var i=e.item;if(i.isNote())return[i.getNotePreviewText()];var n=this.getMetricsForPaneObject(e,t,a);return n?n.styledLines:[i.getParsedText()]}},{key:"isItemInPane",value:function(e){return this.indexOfItem(e)>=0}},{key:"isItemTopLevel",value:function(e,t){return t.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"checkHeightChanged",value:function(e,t){return this._infiniteList.checkHeightChanged(e,t)}},{key:"getCollapsedDefault",value:function(e,t,a){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewGroups",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"isViewTag",value:function(){return!1}},{key:"canScrollToItem",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"isViewItems",value:function(){return!1}},{key:"isViewArchived",value:function(){return!1}},{key:"isViewDeleted",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"extraPaddingForPaneObject",value:function(e){return 0}},{key:"createVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=m.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"createTempVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=m.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"selectNearestItem",value:function(e){var t=this.indexOfNextSibling(e);t>=0&&E.a.selectIndex(t,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(e,t){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(e){this.setScrollOffset(0,e)}},{key:"setName",value:function(e){this.name.set(e),g.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=h.default.clamp(e,p.a.EmailPreviewSizeMin,p.a.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=h.default.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),this.saveState(),g.default.PaneManager.updatePaneRects(!isNaN(e))}},{key:"isPaneObjectCollapsed",value:function(e,t){return(h.default.isVMLI(e)?e:e.item).isCollapsed(this,t)}},{key:"setPaneObjectCollapsed",value:function(e,t,a,i){return(h.default.isVMLI(t)?t:t.item).setCollapsed(e,this,a,i)}},{key:"shouldRenderPrefix",value:function(e){return!0}},{key:"needsUpdateForDate",value:function(){return!1}},{key:"needsUpdateForTags",value:function(e){return!1}},{key:"needsUpdateForPriority",value:function(){return!1}},{key:"needsUpdateForModified",value:function(){return!1}},{key:"needsSearchUpdateForPriority",value:function(){return this.search.getFilterValue("filter")}},{key:"handleItemChanged",value:function(e,t,a){var i=this.getInfiniteList();if(a=a||!1,t.Items&&(g.default.DisplaySettings.boldHeaders()&&i.clearItemInfoForItem(e),a=!0),t.Text){if(i.handleItemTextChanged(e)&&(this.itemsHeightDirty=!0),this.supportSearchListenTextChanges){var n=this.search.handleItemTextChanged(e);a=a||n}this.onItemTextChanged.notify(e)}if(t.Search||t.Date&&this.search.isSearchingDate()){var r=this.search.handleItemChanged(e);a=a||r}if(t.Priority){var s=this.search.handleItemChanged(e);s||(s=this.needsUpdateForPriority()),a=a||s}if(t.Modified&&(a=a||this.needsUpdateForModified()),t.Date&&(a=a||this.needsUpdateForDate()),t.Tags&&(a=a||this.needsUpdateForTags(t.Tags)),a)return this.preventUpdateItemsForItem&&this.preventUpdateItemsForItem.item===e||this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(e,t){var a=t.item;e.push(t),a&&(this.paneObjectsByItem[a.id]?this.paneObjectsByItem[a.id].push(t):this.paneObjectsByItem[a.id]=[t])}},{key:"getPaneObjectsForItem",value:function(e){return this.paneObjectsByItem[e.id]}},{key:"_zoom",value:function(e,t,a){try{h.default.PAssert(1533,e,"Must supply a valid item to zoom to")}catch(n){h.default.reportError(n)}var i=this.item.get();i&&i.id===e.id||(E.a.reset(),this.setItem(e,!0,a),h.default.focusedItem=e,t||this.saveState())}},{key:"zoomIn",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{h.default.PAssert(1534,e,"Must supply a valid item to zoom to")}catch(u){h.default.reportError(u)}var i=a.forLoad,n=a.showToast,r=a.noSel,s=a.noUpdateItems,o=this.item.get();if(this._zoom(e,i,s),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),i||h.default.sendEvent("Menu","ZoomIn"),this.paneContent&&this.isWriteable&&!r){var l=this.indexOfFirstItem();l>=0?E.a.selectIndex(l,0,0):E.a.reset()}this.isLoaded&&this.onZoom(),i||v.d.performAction(v.b.Zoom,{itemID:e.id,oldItemID:o&&o.id,zoomIn:!0,time:0,pane:this}),n&&g.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){t.zoomIn(o)}})}},{key:"zoomOut",value:function(e,t){try{h.default.PAssert(1535,e,"Must supply a valid item to zoom to")}catch(u){h.default.reportError(u)}var a=this.item.get(),i=E.a.save()||E.a.getPreviousSelection();if(this._zoom(e,!1),h.default.sendEvent("Menu","ZoomOut"),this.isWriteable&&i){for(var n=0,r=i.startItem,s=i.startOffset,o=i.endItem,l=i.endOffset;r&&this.indexOfItem(r)<0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=r.parent(),s=0}r&&(this.indexOfItem(i.endItem)<0&&(o=r,l=s),E.a.selectItems(r,s,o,l),this.scrollItemToMiddle(r,p.a.ScrollDuration.Snap))}t||v.d.performAction(v.b.Zoom,{itemID:e.id,oldItemID:a.id,zoomOut:!0,time:0,pane:this})}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(e,t,a){e!==this.document.get()&&(this.setIgnoreRestoreScroll(1e3),this.document.set(e),this.zoomIn(e?this.getRootItem():void 0,{forLoad:t,noUpdateItems:a}))}},{key:"openItemEditor",value:function(e){e.pane=this,g.default.menus.openItemEditor(e)}},{key:"clearPreventUpdate",value:function(){}},{key:"getVisibleChildren",value:function(e){for(var t=0,a=e.item,i=this.items.get(),n=[],r=e.index;r<i.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r],o=s.item;o&&o.isDescendantOf(a)&&n.push(s)}return n}},{key:"isItemBold",value:function(e){return e.isPrefixHeader()||e.isHeader()&&g.default.DisplaySettings.boldHeaders()}}]),e}(),c()(r.prototype,"saveState",[L.a],Object.getOwnPropertyDescriptor(r.prototype,"saveState"),r.prototype),c()(r.prototype,"onClickReportError",[L.a],Object.getOwnPropertyDescriptor(r.prototype,"onClickReportError"),r.prototype),c()(r.prototype,"archiveCompleted",[L.a],Object.getOwnPropertyDescriptor(r.prototype,"archiveCompleted"),r.prototype),r);f.a.extendClass(te,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=function(e){function t(){return o()(this,t),S()(this,w()(t).apply(this,arguments))}return b()(t,e),u()(t,[{key:"constructorExtra",value:function(){f.a.binder(this,"onInput","onInputSetText")}},{key:"onInput",value:function(e){if(E.a.isValid()){var t=E.a.getStartItem(),a=this.convertElementToText(e.target),i=Q.default._getSelectionRange(),n=h.default.getElementParent(e.target),r=Q.default.getSelectOffsetsInElement(n,i),s=E.a.getStartIndex();this.onInputSetText(t,a,s,r.start,r.end,e)}}},{key:"onInputSetText",value:function(e,t,a,i,n,r){if(!this._hasDetectedEnterAndroid){t=t.replace(new RegExp(p.a.TextSpace,"g"),"");var s=U.a.checkMultiplePrefixes(t);if(s!==t){var o=t.length-s.length;i-=o,n-=o,t=s}g.default.settings.showMarkdown.get()||(h.default.shouldLog(p.a.LogLevels.Edit)&&console.log("check end",i-2,t[i-2]),i===n&&i>2&&")"===t[i-2]&&J.a.isInsideMarkup(e,i-2,!1,"mdMarkupEnd")&&(t=t.substr(0,i-1)+" "+t.substr(i-1),i++,n++,h.default.shouldLog(p.a.LogLevels.Edit)&&console.log("spacing eend",i)),h.default.shouldLog(p.a.LogLevels.Edit)&&console.log("check start",i,t[i]),i===n&&"["===t[i]&&J.a.isInsideMarkup(e,i-1,!1,"mdMarkupStart")&&(t=t.substr(0,i)+" "+t.substr(i),h.default.shouldLog(p.a.LogLevels.Edit)&&console.log("spacing start",i))),this.isSettingText=!0,e.setText(t,p.a.ChangeType.Local),t.length>0&&E.a.selectIndex(a,n),this.isSettingText=!1,X.a.updateAutocomplete(r)}this._hasDetectedEnterAndroid=!1}},{key:"keydown",value:function(e){if(e.handled)return!0;if(g.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!h.default.hasClass(this.paneContent,"loading")&&p.a.KeyCodesModifiers.indexOf(e.normCode)<0&&p.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem({e:e}),E.a.isValid()){this.getInfiniteList(!1).reMount(),0!==this.numItems()||h.default.hasClass(this.paneContent,"loading")||this.addItem({e:e});try{X.a.keydown(this,e)||(h.default.preventDefault(e),h.default.stopPropagation(e))}catch(t){h.default.reportError(t,e)}}}},{key:"keypress",value:function(e){if(E.a.isValid())try{X.a.keypress(this,e)||(h.default.preventDefault(e),h.default.stopPropagation(e))}catch(t){h.default.reportError(t,e)}}},{key:"keyup",value:function(e){if(h.default.notifyActivity(),E.a.isValid())try{X.a.keyup(this,e)||(h.default.preventDefault(e),h.default.stopPropagation(e))}catch(t){h.default.reportError(t,e)}}}]),t}(e);return t}(te),!0);var ae=t.a=te},122:function(e,t,a){"use strict";var i=a(35),n=a.n(i),r=a(5),s=a.n(r),o=a(6),l=a.n(o),u=a(1),d=a(0),c=a(3),h=a(29),f=function(){function e(){s()(this,e),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}return l()(e,[{key:"createFolderStructure",value:function(e,t){var a=e.type;try{d.default.PAssert(975,!d.default.isDemoMode(),"Should not be creating "+a+"folder in demo mode")}catch(r){d.default.reportError(r)}try{d.default.PAssert(976,void 0===e.id,"Must not already have a "+a+"folder")}catch(r){d.default.reportError(r)}e.parent&&(this.folders[e.parent].id||this.getFolder(this.folders[e.parent],this.createFolderStructure.bind(this,e)));try{d.default.PAssert(978,t,"Must supply a valid callback when done creating the "+a+" file structure")}catch(r){d.default.reportError(r)}var i=h.a.fns("drive").files.insert.packedFn,n={resource:{mimeType:this.FOLDER_MIMETYPE,title:e.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:e.prop,value:"TRUE",visibility:"PRIVATE"}]}};e.parent&&(n.resource.parents=[{id:this.folders[e.parent].id}]);c.default.remoteAPI().runRemoteSingleRequest(i,n,function(e){return d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Successfully created "+a+" folder",e),t(e.id)},function(e){return d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Error creating "+a+" folder",e),t()})}},{key:"getSetting",value:function(e){var t=c.default.settings.driveFolders.get();return t?t[e]:void 0}},{key:"setSetting",value:function(e,t){var a=Object.assign({},c.default.settings.driveFolders.get(),n()({},e,t));c.default.settings.driveFolders.set(a)}},{key:"getFolderByType",value:function(e,t){return this.getFolder(this.folders[e],t)}},{key:"getFolder",value:function(e,t){var a=this;d.default.isString(e)&&(e=this.folders[e]);try{d.default.PAssert(979,e,"Trying to get invalid folder")}catch(n){d.default.reportError(n)}try{d.default.PAssert(980,!d.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(n){d.default.reportError(n)}try{d.default.PAssert(981,t,"Must provide a valid callback when getting the root folder")}catch(n){d.default.reportError(n)}if(e){if(e.id)return t(e.id);var i=function(){var i=a.getSetting(e.type),r=function(){a.createFolderStructure(e,function(i){return i?(e.id=i,a.setSetting(e.type,i),t(i)):t(void 0)})};if(i){c.default.remoteAPI().driveFilesGet(i,function(a){if(a)return e.id=i,t(i);r()},function(i){if(a.setSetting(e.type,void 0),!i||!i.error||404!==i.error.code)return t(void 0);r()})}else{var s="properties has {key='"+e.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false";c.default.remoteAPI().driveFilesList(s,function(i){if(i.length>0){try{d.default.PAssert(982,1===i.length,"Must have a single root folder present")}catch(n){d.default.reportError(n)}return d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Successfully found root folder",i),e.id=i[0].id,a.setSetting(e.type,e.id),t(e.id)}r()},function(e){return d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Error getting root folder",e),t(void 0)},{getAllPages:!0})}};e.parent?this.getFolderByType(e.parent,i):i()}else t(void 0)}},{key:"copyFileToFolder",value:function(e,t,a){c.default.remoteAPI().driveParentsInsert(e,t,function(e){d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Error sharing file ",e),a(!0,e)},function(e){d.default.shouldLog(u.a.LogLevels.Folders)&&d.default.log("Successfully shared file ",e),a(!1,e)})}},{key:"getAttachFolder",value:function(e){return this.getFolderByType(u.a.DriveFolder.Attach,e)}},{key:"getRootFolder",value:function(e){return this.getFolderByType(u.a.DriveFolder.Root,e)}},{key:"getBackupFolder",value:function(e){return this.getFolderByType(u.a.DriveFolder.Backup,e)}},{key:"getDocumentFolder",value:function(e,t){var a={type:e,title:e,id:void 0,parent:u.a.DriveFolder.Root,prop:e};this.getFolder(a,t)}}]),e}();t.a=new f},123:function(e,t,a){"use strict";var i,n=a(12),r=a.n(n),s=a(22),o=a.n(s),l=a(35),u=a.n(l),d=a(5),c=a.n(d),h=a(6),f=a.n(h),p=a(13),g=a.n(p),m=a(0),v=a(1),y=a(3),k=a(7),_=a(163),S=a(17),P=a(14),w=a(41),I=a(28),b=a(65),D=10*v.a.MSPerMinute,E=(i=function(){function e(){c()(this,e)}return f()(e,[{key:"init",value:function(){y.default.settings.backupFrequency.listen(this.onTimeChanged),m.default.isBoolean(y.default.settings.needsBackup.get())&&y.default.settings.needsBackup.set({}),this.needsBackupDrive=Object.assign({},y.default.settings.needsBackup.get()||{}),I.a.onAuthed(this.checkBackup),setInterval(this.checkBackup,D)}},{key:"docNeedsBackup",value:function(e){var t=y.default.settings.needsBackup.get();return t&&t[e.id]&&Date.now()-t[e.id]>D}},{key:"setNeedsBackup",value:function(e,t){var a=Date.now();if(t){if(!e.isLocalOnly()||y.default.settings.backupLocal.get()){var i=y.default.settings.needsBackup.get();i&&i[e.id]||y.default.settings.needsBackup.set(Object.assign(u()({},e.id,a),i))}}else{var n=m.default.clone(y.default.settings.needsBackup.get());delete n[e.id],y.default.settings.needsBackup.set(n)}}},{key:"onTimeChanged",value:function(){this.needsBackupDrive={},w.a.onLoaded(this.checkBackupDrive)}},{key:"onDataSaved",value:function(e){this.setNeedsBackup(e,!0)}},{key:"checkBackup",value:function(){this.checkBackupAuto(),y.default.settings.backupFrequency.get()>0&&w.a.onLoaded(this.checkBackupDrive)}},{key:"checkBackupAutoDoc",value:function(e){this.docNeedsBackup(e)&&this.backupDocumentAuto(e)}},{key:"checkBackupAuto",value:function(){S.a.getDocumentsArray().forEach(this.checkBackupAutoDoc)}},{key:"checkBackupDriveDoc",value:function(e){var t=y.default.settings.backupsDrive.get(),a=t&&t[e.id];if(isNaN(a)||Date.now()-a>y.default.settings.backupFrequency.get())return this.backupDocumentDrive(e),!0}},{key:"checkBackupDrive",value:function(){y.default.settings.backupFrequency.get()>0&&S.a.getDocumentsArray().forEach(this.checkBackupDriveDoc)}},{key:"backupDrive",value:function(){var e=o()(r.a.mark(function e(){return r.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(S.a.getDocumentsArray().map(this.backupDocumentDrive)));case 1:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backupAuto",value:function(){var e=o()(r.a.mark(function e(){return r.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(S.a.getDocumentsArray().map(this.backupDocumentAuto)));case 1:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backupAll",value:function(){var e=o()(r.a.mark(function e(){return r.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupAuto(),this.backupDrive()]));case 1:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"backupDocumentAll",value:function(){var e=o()(r.a.mark(function e(t){return r.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupDocumentAuto(t),this.backupDocumentDrive(t)]));case 1:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentStorage",value:function(){var e=o()(r.a.mark(function e(t){var a,i,n;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(t.isLocalOnly()){e.next=15;break}return a=Date.now(),i=this.getCloudBackupFilename(t,a),e.next=4,t.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!0});case 4:return n=e.sent,e.prev=5,e.next=8,y.default.cloudStorage.uploadString(i,n);case 8:e.sent&&(t.addBackup(a),b.a.getAPIForDocument(t).addBackup(a),this.setNeedsBackup(t,!1)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),m.default.reportError(e.t0);case 15:case"end":return e.stop()}}},e,this,[[5,12]])}));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentAuto",value:function(){var e=o()(r.a.mark(function e(t){var a=this;return r.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return k.a.isNativeApp()&&y.default.settings.backupLocal.get()&&t.toJSON({exportArchived:!0,includeNotes:!0,encrypt:y.default.settings.encryptLocalFiles.get()}).then(function(e){var i=(new Date).toString("yy-MM-dd h-mm tt"),n=t.text.get()+" "+i+".json";y.default.ElectronBridge.saveBackup(n,e,function(e){e?m.default.reportError(e,"Backup error"):t.isLocalOnly()&&a.setNeedsBackup(t,!1)})}),e.abrupt("return",this.backupDocumentStorage(t));case 2:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentDrive",value:function(){var e=o()(r.a.mark(function e(t){return r.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!(y.default.settings.backupFrequency.get()>0)||t.isLocalOnly()){e.next=4;break}return e.next=3,t.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!1}).then(function(e){var a=new Blob([e],{type:"application/json"}),i=(new Date).toString("yy/MM/dd h:mm tt");return a.name=t.text.get()+" "+i,new Promise(function(e){new _.a(a,"me",v.a.DriveFolder.Backup,{docId:t.id},function(){},function(){var a=y.default.settings.backupsDrive.get();a&&m.default.isObject(a)||(a={}),y.default.settings.backupsDrive.set(Object.assign({},a,u()({},t.id,Date.now()))),e()},function(t){m.default.reportError(t,"Backup error"),e()}).upload()})});case 3:delete this.needsBackupDrive[t.id];case 4:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadBackup",value:function(){var e=o()(r.a.mark(function e(t,a){var i,n;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return i=this.getCloudBackupFilename(t,a),e.next=3,y.default.cloudStorage.getString(i);case 3:if(!(n=e.sent)){e.next=12;break}return e.prev=5,e.abrupt("return",JSON.parse(n));case 9:e.prev=9,e.t0=e.catch(5),m.default.reportError(e.t0);case 12:case"end":return e.stop()}}},e,this,[[5,9]])}));return function(t,a){return e.apply(this,arguments)}}()},{key:"getCloudBackupFilename",value:function(e,t){return"users/".concat(I.a.getUid(),"/documents/").concat(e.id,"/").concat(t,".json")}},{key:"isDriveBackupAuthorized",value:function(){return w.a.isAuthorizedForScopes(I.a.getDefaultAccountID(),[v.a.GScope.Drive])}},{key:"authorize",value:function(e){w.a.authAccount(I.a.getDefaultAccountID(),[v.a.GScope.Drive],function(t){e(t)})}},{key:"enable",value:function(){var e=this;this.authorize(function(t){t&&(y.default.settings.backupFrequency.set(v.a.DefaultBackupFrequency),e.backupDrive())})}},{key:"getLastBackup",value:function(){return S.a.getDocumentsArray().reduce(function(e,t){return Math.max(e,t.getLastBackup())},0)}}]),e}(),g()(i.prototype,"onTimeChanged",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"onTimeChanged"),i.prototype),g()(i.prototype,"checkBackup",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackup"),i.prototype),g()(i.prototype,"checkBackupAutoDoc",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupAutoDoc"),i.prototype),g()(i.prototype,"checkBackupAuto",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupAuto"),i.prototype),g()(i.prototype,"checkBackupDriveDoc",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupDriveDoc"),i.prototype),g()(i.prototype,"checkBackupDrive",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"checkBackupDrive"),i.prototype),g()(i.prototype,"backupDocumentStorage",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentStorage"),i.prototype),g()(i.prototype,"backupDocumentAuto",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentAuto"),i.prototype),g()(i.prototype,"backupDocumentDrive",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"backupDocumentDrive"),i.prototype),i);t.a=new E},15:function(e,t,a){"use strict";a(56);var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(160),l=function(){function e(t,a,i){n()(this,e),this._value=t,this._listeners=a?[a]:void 0,this._shouldFreeze=i}return s()(e,[{key:"get",value:function(){return this._value}},{key:"set",value:function(e,t){var a=this._value;return this._value=e,!1!==t&&this.notify(e,a,t),e}},{key:"onHasValue",value:function(e){if(void 0!==this._value)e(this._value);else var t,a=this.listen(function(i,n){void 0===i||t||(t=!0,e(i,n),setTimeout(function(){a.dispose()},0))})}},{key:"onValue",value:function(e,t){if(this._value===e)t();else var a,i=this.listen(function(n,r){n!==e||a||(a=!0,t(),setTimeout(function(){i.dispose()},0))})}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(e){return this._listeners||(this._listeners=[]),this._listeners.push(e),new o.a(this,e)}},{key:"unlisten",value:function(e){this._listeners&&this._listeners.remove(e)}},{key:"notify",value:function(e,t,a){0===arguments.length&&(e=this._value,t=this._value,a=!0);var i=this._listeners;if(i&&i.length>0&&(e!==t||!0===a)){var n=0;0;for(var r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!1===(0===arguments.length?i[r](this._value,void 0,a):i[r](e,t,a))&&(i.splice(r,1),r--)}0}}}]),e}();t.a=l},157:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(7),g=a(2),m=a.n(g),v=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue}},{key:"onMouseDown",value:function(e){f.default.preventAndStop(e)}},{key:"onClickIcon",value:function(e){var t=this.props.filter,a=this.props.filterValue;a=!1!==t.canBeNegated&&(!p.a.mac&&e.ctrlKey||p.a.mac&&e.metaKey)&&!isNaN(t.initialValue)&&a!==-t.initialValue?-t.initialValue:a?0:t.initialValue,this.props.search.setFilter(t.name,a,!0)}},{key:"render",value:function(){var e=this.props,t=e.filter,a=e.filterValue,i=this.firstValue===a,n=e.noClick?void 0:this.props.search.getFilterTooltip(t),r=f.default.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-button":!a},{selected:!!a},t.icon,t.isOption&&(1===a?"yes":-1===a?"only":""),!t.isOption&&((a?this.firstValue>0&&i||this.firstValue<0&&!i:this.firstValue>0)?"yes":"no"));return m.a.createElement("div",{className:r,"data-tooltip":n,onMouseDown:this.onMouseDown,onClick:e.noClick?void 0:this.onClickIcon})}}]),t}(a(21).a);t.a=v},158:function(e,t,a){"use strict";a.r(t);var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(62),d=a.n(u),c=a(9),h=a.n(c),f=a(25),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=a(1),k=a(3),_=a(8),S=a(23),P=a(45),w=a(15),I=a(4),b=a(24),D=function(){function e(){n()(this,e),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new w.a(!1),this.isInDrag=new w.a(!1),this.transform=new w.a({left:0,top:0}),this.linePosition=new w.a,this.isDraggingPane=new w.a(!1),this.draggingToOutline=new w.a,this.dragTargetHovered=new w.a,S.a.binder(this,"handleEscapeKey")}return s()(e,[{key:"stop",value:function(){var e=0;this.__hotkeyEscape&&(P.a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():k.default.PaneManager.runForEachPane(function(e){e.notifyDragEnd()});for(var t=this.draggingItems,a=function(e){return e.draggedInPane.set(void 0)},i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t[i].item.forEachChildRecursive(a,!0,!0)}this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.isVisible.set(!1),this.isInDrag.set(!1),this.blockTarget=void 0,b.a.fireEvent("endDrag",[])}},{key:"start",value:function(e,t,a,i,n,r,s,o){var l=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=P.a.pushStackEscape(this.handleEscapeKey),v.default.setItemAnimationMode(y.a.ItemAnimationMode.None),this.isDragging=!0,this.activePane=n,this.dragInfo=null,this.startPane=n,this.startInfo=r,this.dataTransfer=s,this.dragItem=e,this.startDragitem=e,this.fromOverview=o,this.externalData=void 0,this.draggingItems=t,this.position={left:a,top:i},this.transform.set({left:0,top:0},!1),I.a.reset();for(var u=function(e){return e.draggedInPane.set(v.default.focusedPane)},d=0;d<t.length;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t[d].item.forEachChildRecursive(u,!0,!0)}this.isInDrag.set(!0),this.isVisible.set(!0),this.activePane.notifyDragStart(),_.d.miscAction({type:_.b.Misc,misc:_.a.DragItem,data:{itemID:e.id,fromPane:n}})}},{key:"startExternal",value:function(e){this.isDragging=!0,this.activePane=e,this.startPane=e,this.draggingItems=[],this.isVisible.set(!0),this.isInDrag.set(!0),this.activePane.notifyDragStart()}},{key:"setExternalData",value:function(e){this.externalData=e}},{key:"setTransform",value:function(e,t){this.isVisible.set(!0,!1),this.isInDrag.set(!0,!1),this.transform.set({left:e,top:t})}},{key:"handleDragOver",value:function(e){var t=v.default.elementFromPoint(e.clientX,e.clientY),a=v.default.getPaneForElement(t);if(this.activePane&&a!==this.activePane&&this.revertDrag(),v.default.vmMain.checkDragForScroll(e),a){this.isDragging||this.startExternal(a),this.activePane=a;var i=!!v.default.findParent(t,"paneOverviewScroller");a.canAcceptDragOver(e.dataTransfer.pane,e.item,t,i)?this.dragInfo=a.handleDragOver(e.dataTransfer.pane,e.item,t,e.clientX,e.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||v.default.cancelRepeatScrolls(),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag()}},{key:"handleDropItem",value:function(e,t,a){var i,n=e,r=this.activePane;this.isDropping=!0,v.default.cancelRepeatScrolls();var s=t.target;return s&&v.default.findParent(s,"mobileDropBucket")?(k.default.dropBucket.addItemEntry(e,r),this.dragTargetHovered.set(void 0),i=n):this.dragInfo&&r&&(k.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),r.handleDragDrop(e,t,this.dragInfo,a),k.default.PaneUpdateBatcher.commitUpdateItems(),i=n),this.isDropping=!1,i}},{key:"handleDrop",value:function(e){var t=this,a=this.activePane;if(a&&(v.default.elementInPane(e.target)||e.fromDropBucket)){var i=e.dataTransfer.item;if(this.isDragging=!1,this.isVisible.set(!1),i)return this.handleDropItem(i,e),!0;k.default.pluginManager.handleDropEvent(e,function(i,n){_.d.beginAction();var r=a.createVMLI({text:i},{changeType:y.a.ChangeType.AllLocal,noParentOkay:!0});return r=t.handleDropItem(r,e,n),_.d.endAction(),!!r})}else v.default.isNonPaneDropTarget(e.target)&&e.dataTransfer.item&&this.handleDropItem(e.dataTransfer.item,e);this.isInDrag.set(!1),v.default.resetItemAnimationMode(),e.stopPropagation(),e.preventDefault()}},{key:"handleDragLeave",value:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isVisible.set(!1),this.isInDrag.set(!1))}},{key:"setBlockTarget",value:function(e){this.blockTarget=e}},{key:"stopDraggingToOutline",value:function(){this.draggingToOutline.get();this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd()}}]),e}(),E=a(27),C=a(7),A=function(e){function t(){var e;return n()(this,t),e=l()(this,h()(t).call(this)),window.addEventListener("dragover",e.handleDragOver.bind(d()(e))),window.addEventListener("dragleave",e.handleDragLeave.bind(d()(e))),window.addEventListener("drop",e.handleDrop.bind(d()(e))),e}return m()(t,e),s()(t,[{key:"handleDrop",value:function(e){if(!p()(h()(t.prototype),"handleDrop",this).call(this,e)){var i=this.activePane;if(e.dataTransfer.getData&&(e.dataTransfer.getData(C.a.ie?"Text":"text/plain")||e.dataTransfer.getData("text/html"))){var n=E.default.getCursorSelectionRange(e);try{v.default.PAssert(301,n,"Range should always be properly set")}catch(u){v.default.reportError(u)}I.a.setFocusedPane(i),_.d.beginAction();var r=i.createVMLI({text:""},{changeType:y.a.ChangeType.AllLocal,noParentOkay:!0});return r=this.handleDropItem(r,e,!0),I.a.selectItem(r,0),a(196).default.insert(e.dataTransfer,e,y.a.DataSource.Drop),_.d.endAction(),!0}if(this.externalData){var s=this.externalData;this.externalData=void 0;var o=s.split(":"),l=(o.removeAt(0),"["+o.removeAt(0)+"]("+o.join(":")+")");_.d.beginAction();r=i.createVMLI({text:l},{changeType:y.a.ChangeType.AllLocal});return r=this.handleDropItem(r,e,!0),_.d.endAction(),!0}}}},{key:"handleDropItem",value:function(e,a,i){var n=p()(h()(t.prototype),"handleDropItem",this).call(this,e,a,i);if(!n&&v.default.isNonPaneDropTarget(a.target)){var r,s=a.dataTransfer.pane;if(s){r=s.notifyDropFromToEdit(e,a.target);try{v.default.PAssert(302,!r||v.default.isDOMNode(r),"Must always return DOM elements to insert")}catch(l){v.default.reportError(l)}}if(r){var o=E.default._getCursorSelectionRange(a.clientX,a.clientY);E.default.setSelectionRange(o),E.default.insertNode(r)}}return n}}]),t}(D);t.default=A},159:function(e,t,a){"use strict";var i=a(68),n=a.n(i),r=a(82),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=a(2),k=a.n(y),_=a(21),S=a(7),P=function(e){function t(){return l()(this,t),h()(this,p()(t).apply(this,arguments))}return m()(t,e),d()(t,[{key:"init",value:function(){this.amtMoved=void 0,this.prevPos=void 0,this.isDragging=!1,this.createObservables({dragPosition:void 0})}},{key:"getElement",value:function(){return this.refs.element}},{key:"getDraggingElement",value:function(){return this.refs.draggingElement}},{key:"getDragPosition",value:function(){return this.state.dragPosition}},{key:"onMouseDown",value:function(e){var t=this.props.horizontal,a=t?e.clientX:e.clientY;this.amtMoved=0,this.prevPos={left:e.clientX,top:e.clientY},this.dragOffset=v.default.offset(this.refs.element)[t?"left":"top"]-a,this.props.allowDragOut&&(this.startPos={left:e.clientX,top:e.clientY}),document.addEventListener("mousemove",this.onMouseMoveDragging),document.addEventListener("mouseup",this.onMouseUpDragging)}},{key:"onMouseMoveDragging",value:function(e){var t=this.props,a=t.horizontal,i=a?e.clientX:e.clientY;if(this.amtMoved+=Math.abs(e.clientX-this.prevPos.left)+Math.abs(e.clientY-this.prevPos.top),this.amtMoved>3){this.isDragging||(this.isDragging=!0,t.onDragStart(this)),t.onDragMove(this,e);var n=a?"left":"top",r=this.refs.element.parentElement,s=v.default.offset(r),o=i+this.dragOffset-s[n],l={};a?(l.left=o,t.allowDragOut&&(l.top=e.clientY-this.startPos.top)):(l.top=o,t.allowDragOut&&(l.left=e.clientX-this.startPos.left)),this.dragPosition.set(l)}this.prevPos={left:e.clientX,top:e.clientY}}},{key:"onMouseUpDragging",value:function(e){this.isDragging&&this.props.onDragEnd(this,e),this.amtMoved=void 0,this.prevPos=void 0,this.dragOffset=void 0,this.isDragging=!1,this.dragPosition.set(void 0),document.removeEventListener("mousemove",this.onMouseMoveDragging),document.removeEventListener("mouseup",this.onMouseUpDragging)}},{key:"render",value:function(){var e=this.state,t=this.props,a=e.dragPosition,i=!v.default.isEmpty(a),n=v.default.classNames(t.className,"fancySortableItem",{noClick:t.noDrag},{dragging:i||t.isDragging}),r=v.default.classNames((i||t.isDragging)&&t.classDragging),s={};return a&&(s[S.a.transform.react]="translate3d("+(a.left||0)+"px,"+(a.top||0)+"px,0)"),k.a.createElement("div",{className:n,onMouseDownCapture:this.onMouseDown,ref:"element"},k.a.createElement("span",{className:r},t.children),i&&k.a.createElement("div",{className:"draggingElement",style:s,ref:"draggingElement"},t.children))}}]),t}(_.a),w=function(e){function t(){return l()(this,t),h()(this,p()(t).apply(this,arguments))}return m()(t,e),d()(t,[{key:"init",value:function(){this.createObservables({draggingChild:void 0})}},{key:"getElement",value:function(){return this.refs.element}},{key:"onDragStart",value:function(e){this.isDraggingInside=!0,this.dragDidMove=!1,this.draggingChild.set(e)}},{key:"findTargetIndex",value:function(e){for(var t=0,a=k.a.Children.count(this.props.children),i=this.props.horizontal?"left":"top",n=this.props.horizontal?"width":"height",r=e.props.owner===this?e.props.index:-1,s=e.getDraggingElement(),o=v.default.offset(s)[i],l=s.getBoundingClientRect()[n],u=-1,d=!1,c=0;c<a;c++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var h=this.refs["el_"+c];if(h!==this.draggingChild.get()){var f=h.getElement(),p=v.default.offset(f)[i],g=f.getBoundingClientRect()[n],m=Math.min(g,l)/2;if(c>r)o+m>=p&&(u=c,c===a-1&&!d&&o>p+m&&(u=a));else if(o<=p+m)return c}else d=!0}return u}},{key:"onDragMove",value:function(e,t){if(e.getDraggingElement()){var a=this,i=e.props.index,n=e.props.owner;0,this.props.getDragTargetFromElement&&!(a=this.props.getDragTargetFromElement(t.target))&&this.isDraggingInside&&(this.isDraggingInside=!1,this.props.onDragOut(i,n)),a&&(this.isDraggingInside=!0,a.handleDragMove(e,t))}}},{key:"handleDragMove",value:function(e,t){var a=e.props.index,i=e.props.owner,n=this.findTargetIndex(e);n>=0&&(n!==a||this!==i)&&(this.dragDidMove=!0,this.props.moveChild(a,n,i,this))}},{key:"onDragEnd",value:function(e,t){if(this.draggingChild.set(void 0),this.props.onDragEnd){var a=!1;if(this.props.getDragTargetFromElement){var i=this.props.getDragTargetFromElement(t.target);a=i&&i!==this}this.props.onDragEnd(e,a,this.dragDidMove||a)}}},{key:"render",value:function(){var e=this,t=this.props,a=(t.moveChild,t.horizontal),i=(t.getDragTargetFromElement,t.onDragOut,t.classDragging,t.onDragEnd,s()(t,["moveChild","horizontal","getDragTargetFromElement","onDragOut","classDragging","onDragEnd"])),r=v.default.classNames("fancySortableList",t.className,{dragging:!!this.state.draggingChild},{flexbox:a}),o=k.a.Children.map(t.children,function(i,n){return k.a.createElement(P,{owner:e,onDragStart:e.onDragStart,onDragMove:e.onDragMove,onDragEnd:e.onDragEnd,ref:"el_"+n,index:n,horizontal:a,noDrag:i.props["data-nodrag"],isDragging:i.props["data-isdragging"],allowDragOut:!!t.getDragTargetFromElement,classDragging:t.classDragging},i)});return k.a.createElement("div",n()({},i,{className:r,ref:"element"}),o)}}]),t}(_.a);t.a=w},160:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=function(){function e(t,a){n()(this,e),this.target=t,this.cb=a,this._disposed=!1}return s()(e,[{key:"dispose",value:function(){this._disposed=!0,this.target.unlisten(this.cb)}},{key:"isDisposed",value:function(){return this._disposed}}]),e}();t.a=o},161:function(e,t,a){"use strict";a.d(t,"a",function(){return r});a(105);var i=a(0),n=function(e,t){return"string"===typeof e&&(e=e.split(",")),e[e.length-1]=""+(+e[e.length-1]+t),e.join(",")},r=function(e,t){"number"===typeof e&&(e=""+e),"number"===typeof t&&(t=""+t);var a="0";if("string"===typeof e&&"string"===typeof t)a=function(e,t){var a=e.split(","),i=t.split(","),r=a.length,s=i.length;return r<s?+a[r-1]+1<+i[r-1]?n(a,1):n(i,-1):r>s?n(a,1):+a[r-1]+1<+i[s-1]?n(a,1):(a.push("0"),a.join(","))}(e,t);else if("string"===typeof e){var r=+e.split(",")[0];try{i.default.PAssert(140,!isNaN(r),"Index is not valid string",e)}catch(o){i.default.reportError(o)}a=""+Math.floor(r+1)}else if("string"===typeof t){var s=+t.split(",")[0];try{i.default.PAssert(141,!isNaN(s),"Index is not valid string",t)}catch(o){i.default.reportError(o)}a=""+Math.ceil(s-1)}return a}},162:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(0),h=a(1),f=a(3),p=a(37),g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},v=function(){function e(){l()(this,e)}return d()(e,[{key:"makePropString",value:function(e,t,a){return t?',"'+e+'":'+(a?a(t):t):""}},{key:"safeJSONText",value:function(e){return g.lastIndex=0,g.test(e)?e.replace(g,function(e){var t=m[e];return c.default.isString(t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e}},{key:"_addItemToArray",value:function(e,t,a,i){var n=t.getFullSaveData();if(!i&&n.note&&delete n.note,e.push(n),t.hasChildren())for(var r=0,s=t.getItems(),o=0;o<s.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=s[o];this._addItemToArray(e,l,a,i)}i&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var e=f.default.settings.encryptionKeys.get();return e&&e[h.a.EncryptionKeys.UserPassword]?h.a.EncryptionKeys.UserPassword:h.a.EncryptionKeys.Global}},{key:"getItemsData",value:function(){var e=s()(n.a.mark(function e(t,a){var i,r,s,o,l;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(i=a.exportArchived,r=a.includeNotes,s=a.encrypt,o=a.encryptionKey,l=[],this._addItemToArray(l,t,i,r),!s){e.next=8;break}try{c.default.PAssert(988,o,"getItemsData missing encryptionKey")}catch(u){c.default.reportError(u)}return e.abrupt("return",Promise.all(l.map(function(e){return p.a.encryptItemOut(e,f.default.crypto,o)})));case 8:return e.abrupt("return",Promise.resolve(l.map(function(e){return p.a.itemOut(e)})));case 9:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"toDropHtml",value:function(e){var t="";if(!e.isArchived()&&(t+="<li>"+c.default.escape(e.getParsedText())+"</li>",e.hasChildren())){var a=0;t+="<ul>";for(var i=0;i<e.numChildren();++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.toDropHtml(e.getChild(i))}t+="</ul>"}return t}},{key:"toHtml",value:function(e,t,a,i){var n="<ul>",r=e.getItems();if(r)for(var s=0,o=0;o<r.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=r[o],u=c.default.escape((i?l.getPrefix():"")+l.generateTitleText());if(!l.isArchived()||l.isArchived()&&t){if(n+="<li>"+u,a){var d=l.hasNote()&&l.getNote();d&&(n+="<li>",n+=c.default.escape(d.getParsedText()),n+="</li>")}l.numItems()>0&&(n+=this.toHtml(l,t,a,i)),n+="</li>"}}return n+="</ul>"}},{key:"toPlainText",value:function(e,t,a,i,n){isNaN(t)&&(t=0);var r="",s=e.getItems();if(s)for(var o=0,l=0;l<s.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l];if(!u.isArchived()||u.isArchived()&&a){for(var d=0,h=0;h<t;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;r+="\t"}if(r+=c.default.escape((n?u.getPrefix():"")+u.generateTitleText())+"\n",i){var f=u.hasNote()&&u.getNote();f&&(r+=f.getParsedText()+"\n")}u.numItems()>0&&(r+=this.toPlainText(u,t+1,a,i,n))}}return r}}]),e}();t.a=new v},163:function(e,t,a){"use strict";var i=a(0),n=a(1),r=a(122),s=a(41);function o(e,t,a,n,r,s,o){this.file=e,this.properties=n,this.contentType=e.type,this.accountID=t,this.folder=a,this.onComplete=s||i.default.emptyFn,this.onError=o||i.default.emptyFn,this.onProgress=r||i.default.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}o.prototype={upload:function(){var e=this;this._hasStarted=!0,i.default.isDemoMode()?setTimeout(function(){e.onComplete()},2e3):s.a.getDefaultAuthToken([n.a.GScope.Drive],function(t){if(t){var a={Authorization:"Bearer "+t.access_token,"Content-Type":"application/json","X-Upload-Content-Length":e.file.size,"X-Upload-Content-Type":e.contentType};r.a.getFolder(e.folder,function(t){var r,s={title:e.file.name,mimeType:e.contentType,parents:t?[{id:t}]:[]};e.properties&&(s.properties=Object.keys(e.properties).map(function(t){return{key:t,value:e.properties[t],visibility:"PRIVATE"}}));try{r=JSON.stringify(s)}catch(o){i.default.reportError(o)}r?i.default.XHR({url:e.url,type:"POST",headers:a,data:r,autoRetry:!0}).then(function(t){if(t.status<n.a.HTTPStatusCode.BadRequest){var a=t.getResponseHeader("Location");e.url=a,e._runUpload()}else e._onError(t)}):e._onError()})}})},_runUpload:function(){var e=this;try{i.default.PAssert(1007,this.url,"Must have a valid remote URL to run upload")}catch(s){i.default.reportError(s)}this._isRunning=!0;var t=Math.min(this.offset+this.chunkSize,this.file.size),a=this.file.slice(this.offset,t),r={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(t-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:r,data:a,autoRetry:!0}).then(function(t){if(t.status===n.a.HTTPStatusCode.Success||t.status===n.a.HTTPStatusCode.Created)e.isCanceled()||e._onComplete(t);else if(t.status===n.a.HTTPStatusCode.PermRedirect){var a=e._extractRange(t.getResponseHeader("Range"));e.offset=a,e._onProgress(e.offset/e.file.size),e.isCanceled()||e._runUpload()}else e._onError(t)})},resume:function(){var e=this;try{i.default.PAssert(1008,!this.isDone(),"Should not resume a completed upload")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1009,this._hasStarted,"Must have started an upload to resume it")}catch(a){i.default.reportError(a)}try{i.default.PAssert(1010,this.url,"Must have a valid remote URL to resume upload")}catch(a){i.default.reportError(a)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var t={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};i.default.XHR({url:this.url,type:"PUT",headers:t,autoRetry:!0}).then(function(t){if(t.status===n.a.HTTPStatusCode.PermRedirect){var a=e._extractRange(t.getResponseHeader("Range"));e.offset=a,e._onProgress(e.offset/e.file.size),e._runUpload()}else e._onError(t)})}else this.upload()},cancel:function(){try{i.default.PAssert(1011,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){i.default.reportError(e)}this._isCanceled=!0,this._isRunning=!1},_onError:function(e){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(e){var t=0;try{i.default.PAssert(1012,!this._isDone,"Should not call the complete CB twice")}catch(r){i.default.reportError(r)}try{i.default.PAssert(1013,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(r){i.default.reportError(r)}this._isDone=!0,this._isRunning=!1;var a={};if(e&&e.response)try{a=JSON.parse(e.response)}catch(s){i.default.reportError(s)}this._onProgress(1),this.onComplete(a);for(var n=0;n<this._callbacks.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[n](a)}catch(s){i.default.reportError(s)}}this._callbacks=[]},_onProgress:function(e){try{i.default.PAssert(1014,!this._hasError,"Should not make forward progress when an error has occurred")}catch(t){i.default.reportError(t)}this._percent=e,this.onProgress(e)},_extractRange:function(e){return i.default.parseInt(e.match(/\d+/g).pop())+1},_buildQueryString:function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},_buildURL:function(e,t){var a="https://www.googleapis.com/upload/drive/v2/files/";e&&(a+=e);var i=this._buildQueryString(t);return i&&(a+="?"+i),a},notifyOnComplete:function(e){try{i.default.PAssert(1015,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1016,!this.isDone(),"Should not notify on complete after done")}catch(t){i.default.reportError(t)}try{i.default.PAssert(1017,!this.hasError(),"Should not notify on complete after error")}catch(t){i.default.reportError(t)}this._callbacks.push(e)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},t.a=o},165:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(3),g=a(2),m=a.n(g),v=a(21),y=a(4),k=a(54),_=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],S={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},P=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),y.a.reset()}},{key:"parseColor",value:function(e){var t;return(t=S.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=S.hex6.exec(e))?e:void 0}},{key:"onClickColor",value:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)}},{key:"onChangeInputColor",value:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var a=this.parseColor(t);a&&(this.color.set(a),this.props.onChange(a)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))}},{key:"onChangeInputComponent",value:function(){var e=this.refs,t=+e.r.value,a=+e.g.value,i=+e.b.value;if(t>=0&&t<=255&&a>=0&&a<=255&&i>=0&&i<=255){var n="#"+f.default.rgbToHex(t,a,i);this.value.set(n),this.color.set(n),this.props.onChange(n)}}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.state.color,i=f.default.hexToRgb(a),n=[],r=0;r<_.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=_[r],o=f.default.classNames("fancyColor",{selected:s===a},{isWhite:"#FFFFFF"===s.toUpperCase()}),l={background:s};n.push(m.a.createElement("div",{key:s,className:o,style:l,onClick:this.onClickColor.bind(this,s)}))}var u=f.default.classNames("fancyColorInputColor",{invalid:!t.isValid});return m.a.createElement(k.a,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4}},m.a.createElement("div",{className:"fancyColors"},n),m.a.createElement("div",{className:"fancyColorText"},m.a.createElement("div",{key:a,className:"fancyColor",style:{background:a}}),m.a.createElement("input",{type:"text",className:u,value:t.value,onChange:this.onChangeInputColor}),m.a.createElement("span",null,"R"),m.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:i.r,onChange:this.onChangeInputComponent}),m.a.createElement("span",null,"G"),m.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:i.g,onChange:this.onChangeInputComponent}),m.a.createElement("span",null,"B"),m.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:i.b,onChange:this.onChangeInputComponent})))}}]),t}(v.a),w=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.createObservables({color:this.props.color})}},{key:"componentWillReceiveProps",value:function(e){e.color!==this.props.color&&this.color.set(e.color)}},{key:"openMenu",value:function(e){p.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"onChange",value:function(e){this.color.set(e),this.props.onChange(e)}},{key:"renderContextMenu",value:function(e){return m.a.createElement(P,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:e.element})}},{key:"render",value:function(){var e=f.default.extend({background:this.state.color,border:"1px solid #666"},this.props.style),t=f.default.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return m.a.createElement("div",{className:t,style:e,onClick:this.openMenu})}}]),t}(v.a);t.a=w},17:function(e,t,a){"use strict";var i,n,r=a(35),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(13),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(7),v=a(15),y=a(26),k=a(28),_=a(12),S=a.n(_),P=a(22),w=a.n(P),I=a(10),b=a.n(I),D=a(9),E=a.n(D),C=a(11),A=a.n(C),M=a(23),T=a(66),L=a(118),x=a(14),R=a(58),O=new(i=function(e){function t(){var e;return l()(this,t),(e=b()(this,E()(t).call(this,!0))).dataCache={},e.itemCache={},e.isLoaded=!1,e._demoId=1,e}return A()(t,e),d()(t,[{key:"init",value:function(e,t){var i=this,n=a(716).default,r=M.a.getURLParam("data"),o=r.split(","),l={},u=0,d=s()({},k.a.getUid(),{e:k.a.getDefaultAccountID(),t:k.a.getAccountName(),r:p.a.DocumentAccessRoles.Admin});this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]),n.areRemoteFunctionsHooked()||n.hookRemoteFunctions();var c=function(t,a){var n;if(a&&(n=a[0]),n){!function e(t){t.id||(t.id="demo"+u++),i.dataCache[t.id]=t;var a=t.note;a&&(a.id||(a.id="demo"+u++),e(a),t.note=a.id);var n=t.items;if(n){for(var r=0,s=[],o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=n[o];l.id||(l.id="demo"+u++),l.index=o,s.push(l.id),e(l)}t.items=s}}(n),i.isLoaded=!0;var r=new T.a({id:t,text:t,dateModified:Date.now(),rootData:n,acl:d,backing:i});r.createVMLIs(),l[r.id]=r,Object.keys(l).length===o.length&&(i.documents=l,e(l,i.dataCache))}};if(r&&o.length>0)o.forEach(function(e){n.loadRemoteData(e,c.bind(i,e))});else{try{f.default.PAssert(139,!1,"Test data must be defined using #data=XXX.YYY in URL")}catch(m){f.default.reportError(m)}var h={id:void 0,text:p.a.RootItemName,items:[]},g=new T.a({id:"Failed",text:"Failed",dateModified:Date.now(),rootData:h,acl:d,backing:this});c("Failed",[g])}}},{key:"loadDemoContacts",value:function(e){var t=0,a=[],i=0;function n(e){var t="test-"+e.split(" ")[0].toLowerCase()+"@moo.do";a.push({id:"contact_"+i++,name:e,isDemo:!0,emails:[{address:t,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}for(var r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n(e[r])}R.a.loadContacts(a)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,a,i,n){var r=this.dataCache[t.id]||{};return Object.assign(r,a),this.dataCache[t.id]=r,Promise.resolve()}},{key:"deleteItem",value:function(e,t,a){var i=t.parent();this.saveItem(e,i,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop),delete this.dataCache[t.id]}},{key:"addItem",value:function(e,t){this.saveItem(e,t.parent(),void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop),this.saveItem(e,t,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop)}},{key:"moveItem",value:function(e,t){var a=e.getDocumentOwner();this.saveItem(a,e,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop)}},{key:"setNote",value:function(e,t,a,i,n){this.saveItem(e,t,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop),a?this.saveItem(e,a,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop):delete this.dataCache[a.id]}},{key:"addDocument",value:function(e){var t=e.getRootItem();return this.documents[e.id]=e,this.saveItem(e,t,void 0,p.a.ChangeType.Local,p.a.SaveFlag.Prop)}},{key:"saveDocument",value:function(e){}},{key:"deleteDocument",value:function(e){}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){}},{key:"saveBoard",value:function(e){}},{key:"deleteBoard",value:function(e){}},{key:"getBoards",value:function(){return[]}},{key:"clearAllData",value:function(){var e=w()(S.a.mark(function e(){return S.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return""+this._demoId++}}]),t}(L.a),h()(i.prototype,"generateId",[x.a],Object.getOwnPropertyDescriptor(i.prototype,"generateId"),i.prototype),i),F=a(65),N=a(123),B=a(47),U=a(33),V=a(42),H=a(161),j=a(197),z=(n=function(){function e(){l()(this,e),this.isLoaded=new v.a(!1),this._isRemoteEnabled=!f.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new V.a,this.documentsEncryptedArray=new V.a,this._sources=[],this._idProvider=f.default.isDemoMode()?O.generateId:F.a.generateId,this.settingProvider=F.a,this.loadState=F.a.loadState,this.onlineStatus=new v.a(k.a.isOnline()?"Connecting":"Offline"),this.isLoadedLocal=new v.a(!1),this.isLoadedRemote=new v.a(!1),f.default.isDemoMode()?this._sources=[O]:(this._sources.push(F.a),m.a.supportLocalFiles()&&this._sources.push(j.a))}return d()(e,[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty",O),window.__clearLocalData=this.clearLocalData}},{key:"loadLocal",value:function(e){var t=this;this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach(function(e){return e.init(t.onSourceLoaded,t.onSourceDocumentsChanged)}),this._isRemoteEnabled&&N.a.init(),f.default.registerEvent("ItemCreated","ItemAction","Create"),f.default.registerEvent("ItemCompleted","ItemAction","Complete"),this.isLoadedLocal.set(!0)}},{key:"onSourceLoaded",value:function(e){var t=this;setTimeout(function(){return g.default.timeline.updateNotifications()},1e3),g.default.crypto.onLoad(function(){t._sourcesWaiting--,e.forEach(function(e){e.canDecrypt()&&(t._documentsById[e.id]=e,t.documentsArray.includes(e)||t.documentsArray.push(e,!1))}),0===t._sourcesWaiting&&(t.documentsArray.sort(T.a.comparatorModified),g.default.PaneManager.loadInitialState(),t.isLoaded.set(!0),t._cbOnLoad(e))})}},{key:"onSourceDocumentsChanged",value:function(e,t){var a=this,i=this.documentsArray.get();Object.keys(e).forEach(function(t){var n=e[t];a._documentsById[n.id]&&i.includes(n)?n.canDecrypt()||i.remove(n):n.canDecrypt()&&(a._documentsById[n.id]=n,i.push(n))}),(i=i.filter(function(e){return e.canDecrypt()})).sort(T.a.comparatorModified),this.documentsArray.set(i),t&&this.documentsEncryptedArray.set(Object.keys(t).map(function(e){return t[e]})),this.isLoadedRemote.set(!0)}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(e){return this._documentsById[e]}},{key:"getDefaultDocument",value:function(){return this.documentsArray.get().length>0?this.documentsArray.get()[0]:this.addEmptyDocument("My First Document",this.getDefaultBacking(),!1)}},{key:"getDocumentsArray",value:function(){return this.documentsArray.get()}},{key:"hasDocuments",value:function(){return this.documentsArray.get().length>0}},{key:"runOnAllDocuments",value:function(e){this.documentsArray.get().forEach(function(t){return e(t)})}},{key:"parseAll",value:function(e){this.runOnAllDocuments(function(t){t.parseAll(e)})}},{key:"runOnAllDocumentRoots",value:function(e){this.documentsArray.get().forEach(function(t){return e(t.getRootItem())})}},{key:"getItemDataLocal",value:function(e,t){return e.getBacking().getItemData(t)}},{key:"getDocumentBacking",value:function(e){return e.getBacking()}},{key:"getItemBacking",value:function(e){var t=e.getDocumentOwner();try{f.default.PAssert(12,t,"Item document must exist")}catch(a){f.default.reportError(a)}return t.getBacking()}},{key:"_getPreviousState",value:function(e,t){try{f.default.PAssert(13,e.getDocumentOwner(),"Missing document owner",e.getRawText())}catch(n){f.default.reportError(n)}var a=e.getDocumentOwner().getBacking().getItemData(e.id),i={};return a&&Object.keys(t).forEach(function(e){i[e]=a[e]}),i}},{key:"saveItem",value:function(e,t,a,i,n){var r=e.parent()||e.isRoot;try{f.default.PAssert(14,r,"Item must have parent unless root")}catch(o){f.default.reportError(o)}if(r&&(e.index||e.isNote()||(this.updateItemIndex(e),t.index=e.index),t.id=e.id,f.default.isLocalChange(a)&&B.a.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave())){var s=e.getDocumentOwner();s.getBacking().saveItem(s,e,f.default.clone(t),a,i),f.default.isDemoMode()||N.a.onDataSaved(s)}}},{key:"saveItemRemote",value:function(e,t){var a=e.getDocumentOwner();a.getBacking().saveItem(a,e,t,p.a.ChangeType.Local,p.a.SaveFlag.Prop)}},{key:"updateItemIndex",value:function(e){var t=e.parent();if(!e.isNote())if(t&&t.items.length()>1){var a=t.items.get(),i=a.indexOf(e),n=!e.isNote()&&i>0?a[i-1]:null,r=!e.isNote()&&i<a.length-1?a[i+1]:null;0,e.index=Object(H.a)(n?n.index:null,r?r.index:null)}else e.index="0"}},{key:"addItem",value:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!i){this.updateItemIndex(t),B.a.pushAdded(e,t);var n=t.getDocumentOwner();n.getBacking().addItem(n,t)}}},{key:"deleteItem",value:function(e,t,a){if(f.default.isLocalChange(a)){B.a.pushRemoved(e,t);var i=t.getDocumentOwner();i.getBacking().deleteItem(i,t,a)}}},{key:"moveItem",value:function(e,t,a,i){if(this.updateItemIndex(e),f.default.isLocalChange(i)){var n=e.getDocumentOwner(),r={parent:e.parent().id,index:e.index},s={parent:t.id,index:a};B.a.pushModified(e,r,s),n.getBacking().moveItem(e,t)}}},{key:"setNote",value:function(e,t,a,i){var n=e.getDocumentOwner();n.getBacking().setNote(n,e,t,a,i)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(e,t){e.createVMLIs();var a=t?Promise.resolve():this._sources[0].addDocument(e);return this._documentsById[e.id]=e,this.documentsArray.push(e,!1),this.documentsArray.sort(T.a.comparatorModified),a}},{key:"createEmptyDocument",value:function(e,t){t=t||this.getDefaultBacking();var a=this.generateID(),i={id:this.generateID(),isRoot:!0,text:"Root",items:[]},n=new T.a({id:a,text:e,dateModified:Date.now(),rootData:i,acl:s()({},k.a.getUid(),{t:k.a.getAccountName(),e:k.a.getDefaultAccountID(),r:p.a.DocumentAccessRoles.Admin}),backing:t});return n.createVMLIs(),n}},{key:"addEmptyDocument",value:function(e,t,a,i){var n=this.createEmptyDocument(e,t);return n.needsSave=!0,this.addDocument(n,a).then(function(){return i&&i()}),n}},{key:"saveDocument",value:function(e){e.getBacking().saveDocument(e)}},{key:"renameDocument",value:function(e,t){e.setText(t),e.needsSave?(e.needsSave=!1,e.getBacking().addDocument(e)):this.saveDocument(e)}},{key:"setSetting",value:function(e,t,a){a?this.settingProvider.setSetting(e,t):y.a.setSetting(e,{v:t})}},{key:"saveBoard",value:function(e){this.settingProvider.saveBoard(e)}},{key:"deleteBoard",value:function(e){return this.settingProvider.deleteBoard(e)}},{key:"getBoards",value:function(){return this.settingProvider.getBoards()}},{key:"setItem",value:function(e){this._itemCache[e.id]=e}},{key:"getItem",value:function(e){return this._itemCache[e]}},{key:"clearItem",value:function(e){delete this._itemCache[e]}},{key:"createVMLI",value:function(e,t){return g.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}},{key:"createTempVMLI",value:function(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,g.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}},{key:"destroyTempVMLI",value:function(e){g.default.itemStoreManager.getTempItemStore().destroyItem(e)}},{key:"clearLocalData",value:function(){return U.a.clear(),y.a.clearAllData().then(function(){f.default.reload()})}},{key:"deleteDocument",value:function(e,t){delete this._documentsById[e.id],this.documentsArray.remove(e),e.needsSave||(t?e.getBacking().unlistenDocument(e):e.getBacking().deleteDocument(e,t))}},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys(F.a.itemsPending).length>0}},{key:"isConnected",value:function(){return"Online"===this.onlineStatus.get()}},{key:"__clearAllData",value:function(){confirm("Are you sure you want to clear everything?")&&(U.a.clear(),Promise.all(this._sources.map(function(e){return e.clearAllData()})).then(function(){f.default.reload()}))}},{key:"getBackingRemote",value:function(){return F.a}},{key:"getBackingLocal",value:function(){return m.a.supportLocalFiles()?j.a:void 0}},{key:"onlineText",value:function(){var e=this.onlineStatus.get();return f.default.isDemoMode()?"DEMO":e}}]),e}(),h()(n.prototype,"onSourceLoaded",[x.a],Object.getOwnPropertyDescriptor(n.prototype,"onSourceLoaded"),n.prototype),h()(n.prototype,"onSourceDocumentsChanged",[x.a],Object.getOwnPropertyDescriptor(n.prototype,"onSourceDocumentsChanged"),n.prototype),h()(n.prototype,"clearLocalData",[x.a],Object.getOwnPropertyDescriptor(n.prototype,"clearLocalData"),n.prototype),h()(n.prototype,"__clearAllData",[x.a],Object.getOwnPropertyDescriptor(n.prototype,"__clearAllData"),n.prototype),n);t.a=new z},195:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(7),v=a(77),y=a(17),k=a(15),_=(a(84),function(e){function t(){var e;return n()(this,t),(e=l()(this,d()(t).call(this))).oldSettings={c:!0,u:!0,aA:!0},e.onLoadCbs=[],e.init(),e}return h()(t,e),s()(t,[{key:"init",value:function(){var e=this;this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var t=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",p.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["backupsDrive","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r"],["panesMobile","s"],["selectFullItems","t",!1],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["syncContacts","z"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"],["platforms","aK"],["encryptLocalFiles","aM"],["syncAccounts","aN",{}],["panesRN","aO"],["testBetaFeatures","aQ"]],a=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",p.a.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"],["backupLocal","aL",!0]],i=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",p.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",p.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["theme","ay","light"],["underlineP","az",!1],["verticalLinesOpacity","aC",6],["cursorBlink","aP",!0]];this.registerSettings(t,this,!0),this.registerSettings(a,this,!1),this.registerSettings(i,this.ui,!0),f.default.isDemoMode()&&this.activeUser.set("demo"),this.encryptionKeys.listen(function(t){e._encryptionKeyInfo={};var a={};Object.keys(t).forEach(function(e){a[e]=t[e]}),g.default.crypto.importKeys(a).then(function(t){e._encryptionKeyInfo=t})})}},{key:"load",value:function(e,t){var a=this;this._isLoading=!0;var i=[];Object.keys(e).forEach(function(t){var n=a.getSettingInfoFromAbbrev(t),r=n.group,s=n.key,o=e[t].v;if(r&&r[s])if("isEnabled"===s)i.push({group:r,key:s,value:o});else{var l=r[s].get();void 0===o||null===o?(void 0!==o&&null!==o||(o=r._settingsDefault[s]),r[s].set(o)):f.default.isObject(l)&&f.default.isObject(o)&&f.default.deepEqual(l,o)||r[s].set(o)}}),i.forEach(function(e){var t=e.group,a=e.key,i=e.value;t[a].set(i)});try{f.default.PAssert(15,!this.userId.get()||this.userId.get().length>4,"Bad UID",function(){return JSON.stringify({uid:a.userId.get(),name:a.displayName.get(),email:a.activeUser.get()})})}catch(n){f.default.reportError(n)}t&&(this._allSettings.forEach(function(t){if(!e[t.path]){var a=t.group._settingsDefault[t.key];t.setting.get()!==a&&t.setting.set(a)}}),!this.userEncryptionSentinel.get()&&g.default.crypto.getKeyInfo(p.a.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(p.a.EncryptionKeys.UserPassword),setTimeout(function(){var e=Object.assign({},a.platforms.get());e[m.a.getUserPlatformConfig()]={d:Date.now(),v:p.a.jsVersion},a.platforms.set(e)},0)),g.default.DisplaySettings.init(),this._isLoading=!1,this._isLoaded=!0,this.onLoadCbs.forEach(function(e){return e()}),this.onLoadCbs=[]}},{key:"registerGroup",value:function(e,t,a){var i,n=this,r=[];f.default.isString(e)&&(f.default.shouldLog(p.a.LogLevels.Settings)&&f.default.log("SETTINGS: Registered Group - ",e),i=e,this[e]={oldSettings:a},e=this[e]),e.listen=function(e){r.push(e)},e.unlisten=function(e){r.remove(e)},e.onChange=function(e,t,a){if(n._isLoaded&&(f.default.isObject(t)?!f.default.deepEqual(t,a):t!==a)){var s=0;n._save(e,i,t);for(var o=0;o<r.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;r[o](t,a)}}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),this._allGroups.push({id:t,group:e}),i&&(this._groupAbbrevs[i]=t,this._groupAbbrevsIn[t]=i)}},{key:"registerSettings",value:function(e,t,a){for(var i=0,n=0;n<e.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n],s=r[0],o=r[1],l=r[2];this.registerSetting(s,o,t,a,l)}}},{key:"registerSetting",value:function(e,t,a,i,n){if(f.default.isString(a)&&(a=this[a]),i&&(a._settingsRemote[e]=!0),void 0!==n&&(a._settingsDefault[e]=n),a._settingsAbbrevs[e]=t,a._settingsAbbrevsIn[t]=e,a[e]=new k.a(n,a.onChange.bind(this,e),!0),i){var r=this._allGroups.indexOfWithProperty("group",a);if(r>=0){var s=this._allGroups[r].id;this._allSettings.push({path:(s?s+"\\":"")+t,group:a,key:e,abbrev:t,setting:a[e]})}else 0}}},{key:"getDefaultItemText",value:function(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}},{key:"getSettingAbbrev",value:function(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}},{key:"getSettingInfoFromAbbrev",value:function(e){var t,a,i=e.split("\\");if(i.length>1?(a=this[a=this._groupAbbrevsIn[i[0]]],t=i[1]):(a=this,t=i[0]),!a.oldSettings||!a.oldSettings[t]){t=a._settingsAbbrevsIn[t];try{f.default.PAssert(16,a&&a[t],"Missing group for setting",e)}catch(n){f.default.reportError(n)}}return{group:a,key:t}}},{key:"getValueFromAbbrev",value:function(e){var t=this.getSettingInfoFromAbbrev(e),a=t.group,i=t.key;if(a&&a[i])return a[i].get()}},{key:"_save",value:function(e,t,a){var i=t?this[t]:this,n=!this._isLoading&&i._settingsRemote[e],r=i._settingsAbbrevs[e];var s=(t?this._groupAbbrevs[t]+"\\":"")+r;y.a.setSetting(s,a,n)}},{key:"getEncryptionKey",value:function(e){var t=this._encryptionKeyInfo;return t&&t[e]?t[e].key:void 0}},{key:"removeEncryptionKey",value:function(e){var t=Object.assign({},g.default.settings.encryptionKeys.get());g.default.crypto.removeKey(e),delete t[e],g.default.settings.encryptionKeys.set(t)}},{key:"addEncryptionKey",value:function(e,t){var a=Object.assign({},g.default.settings.encryptionKeys.get());a[e]=t,g.default.settings.encryptionKeys.set(a)}},{key:"shouldShowHelp",value:function(e){var t=this.closedHelps.get();return!t||!t[e]}},{key:"closeHelp",value:function(e){var t=f.default.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}},{key:"uncloseHelp",value:function(e){var t=f.default.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"hasUserPassword",value:function(){var e=g.default.settings.encryptionKeys.get();return e&&!!e[p.a.EncryptionKeys.UserPassword]}},{key:"getBestUserEncryption",value:function(){var e=g.default.settings.encryptionKeys.get();return e&&e[p.a.EncryptionKeys.UserPassword]?p.a.EncryptionKeys.UserPassword:p.a.EncryptionKeys.Global}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getUserIdentifier",value:function(){return f.default.isDemoMode()?"demouser":this.activeUser.get()}},{key:"onLoaded",value:function(e){this._isLoaded?e():this.onLoadCbs.push(e)}}]),t}(v.a));t.a=_},196:function(e,t,a){"use strict";a.r(t);var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(1),h=a(3),f=a(7),p=a(73),g=a(8),m=a(100),v=a(4),y=a(60),k=a(47),_=a(14),S=a(64),P=a(44),w=c.a.Regexp.Prefix,I=(i=function(){function e(){r()(this,e)}return o()(e,[{key:"init",value:function(){try{d.default.PAssert(144,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){d.default.reportError(e)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}},{key:"parseTextForPrefix",value:function(e){var t,a;return w.lastIndex=0,null!==(t=w.exec(e))&&(a=t[1],e=e.substr(t[0].length)),{prefix:a,text:e}}},{key:"insertToNote",value:function(e,t,a){try{d.default.PAssert(145,e,"Must have a valid start item")}catch(r){d.default.reportError(r)}try{d.default.PAssert(146,t,"Must have a valid end item")}catch(r){d.default.reportError(r)}var i,n=e.getParsedText();g.d.beginAction(),i=t===e?n.substring(0,v.a.getStartOffset())+a+n.substring(v.a.getEndOffset()):n.substring(0,v.a.getStartOffset())+a,e.setText(i,c.a.ChangeType.Local),g.d.endAction()}},{key:"processItem",value:function(e){if(!e.date){var t=e.text.indexOf("!");if(t>=0){for(var a,i,n=0,r=e.text.slice(t+1).split(" "),s="",o=0;o<r.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[o]){s+=(o>0?" ":"")+r[o];var l=S.a.parseText(s);l&&(i&&l.toData()===i.toData()||(a=s),i=l)}}i&&(e.date=i.toData(),e.text=e.text.replace("!"+a,c.a.CharDate))}}return e}},{key:"insert",value:function(e,t,a){if(!v.a.isValid()||d.default.elementInNonPaneEdit(t.target))return!1;var i,n,r,s="",o=d.default.focusedPane,l=f.a.ie?"Text":"text/plain";if(a===c.a.DataSource.Plugin)r={items:[{text:e}]};else if(e&&e.getData){if(g.d.miscAction({type:g.b.Misc,misc:g.a.Paste}),d.default.preventAndStop(t),s=f.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"),!f.a.ie&&s){if(d.default.shouldLog(c.a.LogLevels.Input)&&d.default.log(s),!s)return void(d.default.shouldLog(c.a.LogLevels.Input)&&d.default.log("Paste buffer is empty"));var u,_=document.createElement("div"),S=s.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/\u2022/g,"").replace(/onload/gi,"never");if((u=/<body(.|\s)*?\/body>/g.exec(S))&&(S=u[0]),_.innerHTML=S,v.a.isValid()&&v.a.getStartItem().isNote())this.insertToNote(v.a.getStartItem(),v.a.getEndItem(),_.innerText);else{var P=_.children[0];2===_.children.length&&"A"===P.nodeName&&d.default.isOneNoteLink(P.href)&&(_.innerHTML=P.outerHTML),1===(r=m.a.traverseDOM({root:_,shouldPrint:!1,stripParents:!0,preserveWhitespace:!f.a.ie&&e.getData("moodo/html")})).items.length&&""===r.items[0].text&&(r=r.items[0])}}else if(s=e.getData(l)){d.default.shouldLog(c.a.LogLevels.Input)&&d.default.log(s);var w,I=s.startsWith("<?xml "),b=s.startsWith("<?opml ")||s.startsWith("<opml ")||I&&s.indexOf("<opml ")>=0;if((I||b)&&(w=d.default.loadXML(s)),w){if(I&&!b)return h.default.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:c.a.MessageAction.Contact,hold:!0}),!1;if(b){var D=v.a.getStartItem(),E=D.parent(),C=o.createVMLI({text:"OPML Import"},{parent:E,changeType:c.a.ChangeType.AllLocal});return E.insertItem(C,D.getIndex()+1),m.a.parseOPML(w,C),!1}}else{var A=d.default.parseEvernoteLink(s),M=d.default.isBearLink(s);if(A||M){var T=v.a.save(),L="Enter title of "+(A?"Evernote":M&&"Bear")+" document";return void h.default.menus.prompt(L,function(e){e&&(s="["+e+"]("+s+")"),v.a.restore(T),this.insert(s,t,c.a.DataSource.Plugin)}.bind(this))}d.default.isUrlImage(s)&&h.default.settings.showImagesInline.get()&&(s="!"+s);S=s.replace(/[\t]/g,"    ");if(v.a.getStartItem().isNote())this.insertToNote(v.a.getStartItem(),v.a.getEndItem(),S);else{var x=S.split("\n");r=m.a.parseText(x)}}}else{if(e&&e.items&&e.items.length>0)return h.default.pluginManager.handleDropEvent(t,function(e){g.d.beginAction();var t=v.a.getStartItem(),a=t.parent(),i=o.createVMLI({text:e},{parent:a,changeType:c.a.ChangeType.AllLocal});a.insertItem(i,t.getIndex()+1),g.d.endAction()}),!1;d.default.shouldLog(c.a.LogLevels.Input)&&d.default.log("Paste buffer is empty");try{d.default.PAssert(147,!1,"Paste with unexpected data type",e.types)}catch($){d.default.reportError($)}}if(!r||!r.items||0===r.items.length)return!1}if(r){g.d.beginAction(),h.default.PaneUpdateBatcher.beginUpdateItems();var R=!0,O=v.a.getStartOffset(),F=v.a.getStartItem(),N=v.a.getEndItem(),B=v.a.getStartItem().parent(),U=v.a.getStartItem().getIndex(),V=v.a.getStartItem().getParsedText(),H=v.a.getEndItem().getParsedText();if(F!==N&&(N.isNote()&&(N=N.parent()),F!==N&&p.a.handleMultiselect({normCode:c.a.KeyCode.Backspace,preventDefault:d.default.emptyFn,stopPropagation:d.default.emptyFn,stopImmediatePropagation:d.default.emptyFn})),i=F,1!==r.items.length||r.items[0].items&&0!==r.items[0].items.length)if(o.isViewAgenda())h.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),R=!1;else{var j=0,z=0;d.default.shouldLog(c.a.LogLevels.Timing)&&console.time("paste"),o.clearPreventUpdate(),v.a.getStartOffset()>0&&U++;for(var q=0;r&&q<r.items.length;++q){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;var W=this.processItem(r.items[q]),G=void 0;W.isNote?B.getNote()||(G=o.createVMLI({text:W.text,isNote:!0},{parent:B,changeType:c.a.ChangeType.AllLocal}),B.setNote(G,c.a.ChangeType.Local)):(0===q&&0===F.getRawText().length&&0===F.numChildren()&&F.deleteSelf(c.a.ChangeType.Local),G=o.createVMLI(W,{parent:B,changeType:c.a.ChangeType.AllLocal}),B.insertItem(G,U++,!1),i=G),G&&g.d.performAction(g.b.Create,{itemID:G.id,parent:B.id,position:U-1,text:G.getParsedText()})}for(;i.hasChildren();){if(z++>5e3&&__infLoop&&__infLoop(z))throw new RangeError;i=i.getLastChild()}n=i.getParsedText().length}else{var K=this.processItem(r.items[0]),Y=K.text,X=O>0?this.parseTextForPrefix(Y).text:Y,Q=V.substring(0,O),J=H.substring(v.a.getEndOffset());!Q.length||Q.endsWith(" ")||X.startsWith(" ")||(X=" "+X),!J.length||X.endsWith(" ")||J.startsWith(" ")||(X+=" ");var Z=Q+X+J;if(g.d.performAction(g.b.Remove,{itemID:F.id,position:0,text:F.getParsedText()}),k.a.beginAction(),K.date)try{F.setMooDate(y.a.fromData(K.date),c.a.ChangeType.Local)}catch(ee){d.default.reportError(ee,"Error parsing MooDate in paste")}K.isStarred&&F.setStarred(!0,c.a.ChangeType.Local),K.priority&&F.setPriority(K.priority,c.a.ChangeType.Local),F.setText(Z,c.a.ChangeType.Local),g.d.performAction(g.b.Insert,{itemID:F.id,position:0,text:Z}),k.a.endAction(),n=v.a.getStartOffset()+X.length}h.default.PaneUpdateBatcher.commitUpdateItems(),g.d.endAction(),d.default.shouldLog(c.a.LogLevels.Timing)&&console.timeEnd("paste")}return R&&i&&(v.a.selectItem(i,n),d.default.focusedPane.scrollItemIntoView(i,c.a.ScrollDuration.Snap)),!1}},{key:"handlepaste",value:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;k.a.saveDeleteSelection(),k.a.beginAction();var a=this.insert(t,e,c.a.DataSource.Paste);return k.a.endAction(),a}},{key:"handlecut",value:function(e){var t=!0;if(v.a.isValid()){var a=v.a.getStartIndex(),i=v.a.getStartItem(),n=a===v.a.getEndIndex()&&v.a.getStartOffset()===v.a.getEndOffset();h.default.PaneUpdateBatcher.beginUpdateItems(),n&&v.a.setSelection(a,0,a,i.getParsedText().length),!this.handlecopy(e)&&(n?d.default.focusedPane.deleteSelected():p.a.keydown(void 0,{normCode:c.a.KeyCode.Backspace,preventDefault:d.default.emptyFn,stopPropagation:d.default.emptyFn,stopImmediatePropagation:d.default.emptyFn}),t=!1),h.default.PaneUpdateBatcher.commitUpdateItems()}return t}},{key:"padText",value:function(e,t){for(var a=0,i=0;i<t;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e="    "+e}return e}},{key:"printLI",value:function(e,t,a){var i=e.getParsedText(),n=i,r=e.getPrefix(),s=[],o=e.getPriority();t=t||0,isNaN(a)?(a=a||i.length,n=n.substring(t)):n=n.substr(t,a-t),n=n.replace(/\[([^\[]*)\]\(\1\)/g,function(e,t){return t}),t>=r.length&&(n=r+n);var l,u=n;if(e.hasAttachments()){for(var d=0,h=0,f=e.getNumAttachments()-1,p=i.length-1;p>=a&&f>=0;p--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;i[p]===c.a.AttachChar&&f--}for(p=n.length-1;p>=0&&f>=0;p--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(n[p]===c.a.AttachChar){if(p<a){var g=e.getAttachment(f);n=n.substr(0,p)+g.getTitleString()+n.substr(p+1),u=u.substr(0,p)+g.getEmbedString()+u.substr(p+1)}f--}}}else e.isNote()&&s.push("note");if(o&&(o===c.a.VMLIFlag.P0?s.push("high"):o===c.a.VMLIFlag.P1?s.push("medium"):o===c.a.VMLIFlag.P2&&s.push("low")),e.isComplete()&&s.push("complete"),e.isStarred()&&s.push("starred"),u.includes(c.a.CharDate)){var m=e.getMooDate();m&&(l=m.toData())}var v=r.length?n.substr(r.length):n,y=function(e){return"<li"+(s.length>0?' class="'+s.join(" ")+'"':"")+(l?' data-date="'.concat(l,'"'):"")+">"+e+"</li>"};return{html:y(v),plain:v,moodo:y(u)}}},{key:"handlecopy",value:function(e){var t=this,a=v.a.getPane();if(!v.a.isValid())return!0;if(!a.overrideCopyBehavior)return!0;var i=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(i){var n,r=0,s=v.a.getSelectedItems(!0,!0),o="<ul>",l="<ul>",u="",c=1,h=function(){o+="<ul>",l+="<ul>",c++},p=function(){o+="</ul>",l+="</ul>",c--},m=!f.a.ie,y=v.a.getEndItem(),k=v.a.getStartOffset(),_=v.a.getEndOffset(),S=v.a.getEndTotal();for(s.forEach(function(e,a){if(n){var i=e.levelsDeep.get()-n.levelsDeep.get();if(e.parent()===n&&i>0||e.isNote())h();else{for(var r=0,d=Math.min(c,-i),f=0;f<d;f++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;p()}c<=0&&h()}}var g,m;if((s.length>1||k!==_)&&(g=0===a?k:0,m=a===s.length-1?_:void 0,P.a.isInsideMarkup(y,m))){var v=y.getParsedText();m=P.a.moveRight(y,v,m,S)}var w=t.printLI(e,g,m);u+=(u?"\r\n":"")+t.padText(w.plain,c-1),o+=w.html,l+=w.moodo,n=e});c>0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;p()}return m&&o&&i.setData("text/html",o),m&&l&&i.setData("moodo/html",l),i.setData(f.a.ie?"Text":"text/plain",u),d.default.preventAndStop(e),g.d.miscAction({type:g.b.Misc,misc:g.a.Copy}),!1}}}]),e}(),u()(i.prototype,"handlepaste",[_.a],Object.getOwnPropertyDescriptor(i.prototype,"handlepaste"),i.prototype),u()(i.prototype,"handlecut",[_.a],Object.getOwnPropertyDescriptor(i.prototype,"handlecut"),i.prototype),u()(i.prototype,"handlecopy",[_.a],Object.getOwnPropertyDescriptor(i.prototype,"handlecopy"),i.prototype),i);t.default=new I},197:function(e,t,a){"use strict";var i,n=a(12),r=a.n(n),s=a(22),o=a.n(s),l=a(5),u=a.n(l),d=a(6),c=a.n(d),h=a(10),f=a.n(h),p=a(9),g=a.n(p),m=a(11),v=a.n(m),y=a(13),k=a.n(y),_=a(1),S=a(3),P=a(0),w=a(100),I=a(66),b=a(118),D=a(14),E=a(24),C=a(119),A=(i=function(e){function t(){var e;return u()(this,t),(e=f()(this,g()(t).call(this,!0))).dataCache={},e.dirtyDocs={},E.a.listen("onUnload",e.writeDocuments),e}return v()(t,e),c()(t,[{key:"init",value:function(){var e=o()(r.a.mark(function e(t,a){var i,n=this;return r.a.wrap(function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:this.cbOnDocumentsChanged=a,i=window.___electronAllDocs,S.default.ElectronBridge.listenToDocChanges(this.onFileChanged),S.default.crypto.onLoad(function(){S.default.crypto.onUpdated.listen(n.reload);var e=function(){var e=o()(r.a.mark(function e(a){var i;return r.a.wrap(function(e){for(var s=0,l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,Promise.all(a.map(function(){var e=o()(r.a.mark(function e(t){var a;return r.a.wrap(function(e){for(var i=0,r=0,s=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,n.parseJSON(t);case 2:if(!(a=e.sent)){e.next=6;break}return a.items&&a.items.forEach(function(e){n.dataCache[e.id]=e}),e.abrupt("return",n.createDoc(a));case 6:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:e.t0=function(e){return void 0!==e},i=e.sent.filter(e.t0),t(i),e.next=9;break;case 8:t([]);case 9:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}();i?i.value?e(i.value):(S.default.toasts.pushMessage({text:"Error loading local files. Please check that the directory is correct in the settings.",actionText:"SETTINGS",action:function(){return S.default.menus.openSettings(_.a.SettingsSections.DesktopApp)},hold:!0}),t([])):S.default.ElectronBridge.getAllDocs(e)});case 4:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"createDoc",value:function(e){var t=I.a.create(e);return t.createVMLIs(),this.documents[t.id]=t,t}},{key:"parseJSON",value:function(){var e=o()(r.a.mark(function e(t){var a,i;return r.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,!((a=JSON.parse(t)).moodoVer&&a.doc&&a.doc.root&&a.doc.id)){e.next=11;break}return e.next=5,w.a.parseJSON(a);case 5:if(!(i=e.sent)){e.next=10;break}return i.id=a.doc.id,i.backing=this,e.abrupt("return",i);case 10:console.log("No data for",a);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:case"end":return e.stop()}}},e,this,[[0,13]])}));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=this,t={};Object.keys(this.documents).forEach(function(e){return t[e]=!0}),S.default.ElectronBridge.getAllDocs(function(){var a=o()(r.a.mark(function a(i,n){return r.a.wrap(function(a){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(a.prev=a.next){case 0:return n=n||[],a.next=3,Promise.all(n.map(function(){var a=o()(r.a.mark(function a(i){var n;return r.a.wrap(function(a){for(var r=0,s=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(a.prev=a.next){case 0:return a.next=2,e.onFileChanged(_.a.CrudActions.Modified,i);case 2:(n=a.sent)&&delete t[n.id];case 4:case"end":return a.stop()}}},a)}));return function(e){return a.apply(this,arguments)}}()));case 3:Object.keys(t).forEach(function(t){return e.onFileChanged(_.a.CrudActions.Removed,t)}),e.cbOnDocumentsChanged(e.documents);case 5:case"end":return a.stop()}}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"onFileChanged",value:function(){var e=o()(r.a.mark(function e(t,a){var i,n,s,o,l,u=this;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==_.a.CrudActions.Removed){e.next=6;break}i=a,(n=this.documents[i])&&(n.delete(!0),delete this.documents[i]),e.next=14;break;case 6:return e.next=8,this.parseJSON(a);case 8:if(!(s=e.sent)){e.next=14;break}return(o=this.documents[s.id])?(l=s.items,o.text.set(s.text),this.checkFileItems(o,l)):(o=this.createDoc(s),this.cbOnDocumentsChanged(this.documents)),s.items&&s.items.forEach(function(e){u.dataCache[e.id]=e}),e.abrupt("return",o);case 14:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"checkFileItems",value:function(e,t){var a=0,i=this,n={};e.getAllItems().forEach(function(e){return n[e.id]=!0});for(var r=function(){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[s];if(!n.isRoot){var r,o=i.getItemData(t[s].id),l=!1,u={id:n.id};o?(r=_.a.CrudActions.Modified,Object.keys(n).forEach(function(e){o[e]!==n[e]&&("id"!==e&&(l=!0),u[e]=n[e])})):(r=_.a.CrudActions.Added,u=n,l=!0),l&&C.a.onRemoteChange(e,r,n.id,u)}},s=0;s<t.length;s++)r()}},{key:"writeDocuments",value:function(){var e=this;Object.keys(this.dirtyDocs).forEach(function(t){var a=e.dirtyDocs[t];delete e.dirtyDocs[t],a.dateModified.set(Date.now()),a.toJSON({exportArchived:!0,includeNotes:!0,encrypt:S.default.settings.encryptLocalFiles.get()}).then(function(e){S.default.ElectronBridge.saveDoc("".concat(a.id,".json"),e,function(e){e&&(console.log(e),S.default.toasts.pushMessage("Error saving ".concat(a.text.get(),". Please check that the destination file is writeable.")))})})})}},{key:"setDocNeedsWrite",value:function(e){this.dirtyDocs[e.id]=e,clearTimeout(this.timeoutWrite),this.timeoutWrite=setTimeout(this.writeDocuments,1e3)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,a,i,n){var r=new Date,s=this.dataCache[t.id]||{};Object.assign(s,a,{dateModified:+r}),t.dateModified=r,this.dataCache[t.id]=s,P.default.isLocalChange(i)&&!P.default.isUndoRedoChange(i)&&this.setDocNeedsWrite(e)}},{key:"deleteItem",value:function(e,t,a){delete this.dataCache[t.id],P.default.isLocalChange(a)&&!P.default.isUndoRedoChange(a)&&this.setDocNeedsWrite(e)}},{key:"addItem",value:function(e,t){var a=this;t.forEachChildRecursive(function(t){a.saveItem(e,t,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop)},!0,!0)}},{key:"moveItem",value:function(e,t){var a=this,i=e.getDocumentOwner(),n=t.getDocumentOwner();i===n?this.saveItem(e.getDocumentOwner(),e,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop):(e.forEachChildRecursive(function(e){a.saveItem(i,e,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop)},!0,!0),this.setDocNeedsWrite(n))}},{key:"setNote",value:function(e,t,a,i,n){this.saveItem(e,t,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop),a&&this.saveItem(e,a,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop)}},{key:"addDocument",value:function(){var e=o()(r.a.mark(function e(t){var a;return r.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:a=t.getRootItem(),this.documents[t.id]=t,this.saveItem(t,a,void 0,_.a.ChangeType.Local,_.a.SaveFlag.Prop);case 3:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e){this.setDocNeedsWrite(e)}},{key:"deleteDocument",value:function(e,t){S.default.ElectronBridge.deleteDoc("".concat(e.id,".json"))}},{key:"renameDocument",value:function(e,t){this.setDocNeedsWrite(e)}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){0}},{key:"saveBoard",value:function(e){0}},{key:"deleteBoard",value:function(e){0}},{key:"getBoards",value:function(){return[]}},{key:"clearAllData",value:function(){return Promise.resolve()}},{key:"generateId",value:function(){return P.default.generateTempId()}},{key:"numDocuments",value:function(){return Object.keys(this.documents).length}}]),t}(b.a),k()(i.prototype,"reload",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"reload"),i.prototype),k()(i.prototype,"onFileChanged",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"onFileChanged"),i.prototype),k()(i.prototype,"writeDocuments",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"writeDocuments"),i.prototype),i);t.a=new A},198:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(1),h=a(3),f=a(17),p=a(7),g=a(15),m=a(14),v=(i=function(){function e(){r()(this,e),this.useServiceWorker="serviceWorker"in navigator,this.notifiedOfNew=!1,this.hasUpdate=new g.a,this.ignoreUpdate=new g.a,setInterval(this.update,c.a.MSPerHour)}return o()(e,[{key:"init",value:function(){var e=this;this.useServiceWorker&&navigator.serviceWorker.addEventListener("message",function(t){h.default.settings.activeUser.get()&&("ServiceWorker_Activated"===t.data?e.onUpdateReady():"ServiceWorker_Installed"===t.data&&setTimeout(e.onUpdateReady,2e3))})}},{key:"update",value:function(e){if(!this.hasUpdate.get())try{if(this.useServiceWorker){var t=window.__registeredServiceWorker;t&&t.update().then(function(){e&&e(!!t.installing)})}}catch(a){}}},{key:"onUpdateReady",value:function(){d.default.log("Cache: New version available"),this.useServiceWorker&&d.default.log("Service worker has update"),this.updateAction()}},{key:"onFirstUpdateReady",value:function(){d.default.log("Cache: first update")}},{key:"onUpdateError",value:function(e){!p.a.demo&&f.a.isConnected()&&(d.default.log("Update Error: ",e),"quota"===e.reason&&h.default.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"}))}},{key:"onUpdateDownloading",value:function(){d.default.log("Cache: New version downloading")}},{key:"updateAction",value:function(){this.hasUpdate.set(!0)}}]),e}(),u()(i.prototype,"update",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"update"),i.prototype),u()(i.prototype,"onUpdateReady",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"onUpdateReady"),i.prototype),i);t.a=v},20:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(45),m=a(2),v=a(88),y=a(21),k=a(89),_=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return v.findDOMNode(this)}},{key:"onClick",value:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(e){if(!1!==this.props.enabled&&e.button===p.a.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}},{key:"onMouseUp",value:function(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onHold",value:function(e){this._clearHoldTimeout(),this.props.onHold(e)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(e){e.keyCode===p.a.KeyCode.Enter&&this.onClick(e)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var e,t=this.state,a=this.props,i=!1===a.enabled;a.color?e=a.color:a.primary?e=a.raised?"c-button-raised-primary":"c-button-primary":a.heavy?a.raised||(e="c-button-heavy"):e=a.cancel?a.raised?"c-button-raised-cancel":"c-button-cancel":a.raised?"c-button-raised":"c-button";var n={display:a.display,lineHeight:a.height?"auto"===a.height?null:a.height+"px":"36px",height:a.height,width:a.width,textAlign:"center",margin:a.margin,paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,fontWeight:a.fontWeight,fontSize:a.fontSize,color:a.color};void 0===a.margin&&(n.marginLeft=a.marginLeft,n.marginTop=a.marginTop,n.marginRight=a.marginRight,n.marginBottom=a.marginBottom),n=f.default.extend(n,this.props.style),a.raised&&!a.children&&a.icon&&!1!==a.round&&(n.borderRadius="50%");var r,s={fontSize:a.fontSize};if(a.icon){var o={height:a.height,fontSize:a.iconSize,color:a.color},l=f.default.classNames("fancyButtonIcon",a.icon,{"c-button":!!a.color});a.children?0!==a.padding&&(s.paddingLeft="6px",s.paddingRight=0,n.paddingLeft="16px",n.paddingRight="16px"):(n.width=a.width||36,n.height=a.height||36,n.maxWidth=a.width||36,n.maxHeight=a.height||36,n.textAlign="center"),r=m.createElement("i",{className:l,style:o})}isNaN(a.padding)||(s.padding="0 "+a.padding+"px");var u=a.children&&m.Children.count(a.children)>0,d=f.default.classNames("fancyButtonText"),c=u&&m.createElement("div",{className:d,style:s},a.children),h=f.default.classNames("fancyButton",e,{raised:a.raised},{loading:t.isLoading},{primary:a.primary},{cancel:a.cancel},{hasText:u},{hasIcon:!!a.icon},{disabled:i},{selected:a.selected},a.className),p=t.isLoading&&m.createElement("div",{className:"fancyButtonLoading"},m.createElement("i",{className:"icon-spinner"})),v=a.tooltipHotkey,y=v?f.default.isString(v)?v:g.a.printHotkeyByName(v.name,v.group):void 0;return m.createElement(k.a,{className:h,style:n,enabled:a.enabled,onMouseEnter:a.onMouseEnter,onMouseLeave:a.onMouseLeave,onMouseDown:a.onMouseDown&&this.onClick||a.onHold&&this.onMouseDown||void 0,onMouseUp:a.onHold||a.onMouseUp?this.onMouseUp:void 0,onClick:a.onClick?this.onClick:void 0,onDoubleClick:a.onDoubleClick,onRightClick:a.onRightClick,onKeyDown:this.onKeyDown,id:a.id,center:a.center||!!a.icon&&!u,ripple:a.ripple,tabIndex:a.tabIndex,"data-tooltip":!i&&a.tooltip?a.tooltip:null,"data-tooltiphotkey":i?null:y},r,c,p)}}]),t}(y.a);t.a=_},201:function(e,t,a){"use strict";a.r(t);var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(25),h=a.n(c),f=a(11),p=a.n(f),g=a(1),m=a(3),v=a(0),y=a(8),k=a(4),_=a(7),S=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"getAppInfo",value:function(e){h()(d()(t.prototype),"getAppInfo",this).call(this,e);var a=window;e.user={name:m.default.settings.displayName.get(),email:m.default.settings.activeUser.get()},e.gapiTimeout=a.gapiTimeout,e.sessionID=a.__SESSION_ID,e.appCacheUpdated=v.default.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),this.getRunningState(e),this.getAppStats(e),this.getPremiumInfo(e);try{e.cacheState=m.default.cacheManager.getInfo()}catch(i){e.cacheState="ERROR"}}},{key:"getRunningState",value:function(e){var t,a=window;try{m.default.PaneManager.hasLoadedPaneState()&&(t=m.default.PaneManager.getPaneState())}catch(i){v.default.log("Failed to get paneState")}e.isDebug=!1,e.isDemo=v.default.isDemoMode(),e.localWrites=v.default.shouldWriteLocal(),e.authUserLoggedIn=v.default.authUserLoggedIn,e.isReconnected=v.default.isReconnected,e.url=v.default.sanitizeURL(window.location.href),e.paneState=t?v.default.sanitizePaneState(t):"Missing Pane State",e.checkpoints=a.__checkpoints,e.gapiLoadError=a.gapiLoadError,e.gapiTimeout=a.gapiTimeout,e.gapiClientLoadError=a.gapiClientLoadError,e.gapiClientTimeout=a.gapiClientTimeout,e.DOMReadyState=document.readyState,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=v.default.getEventStream(),e.trackerStream=y.d.stringifyGroups(),e.criticalErrorReported=v.default.criticalErrorReported(),v.default.getLoadedScripts(e);try{e.nativesel=v.default.parseExtra(window.getSelection())}catch(i){e.nativesel="Error: "+i.message}try{e.customsel=k.a.dumpState()}catch(i){e.customsel="Error: "+i.message}try{e.errorPlatformInfo=JSON.stringify(v.default.errorPlatformInfo)}catch(i){e.errorPlatformInfo="Error: "+i.message}try{e.validScreens=JSON.stringify(a.Screens)}catch(i){e.validScreens="Error: "+i.message}e.lastActivity=v.default.lastActivity}},{key:"getPremiumInfo",value:function(e){if(m.default.billingManager){var t={premiumStatus:m.default.billingManager.getPremiumStatus(),billingIdentifier:m.default.billingManager.getBillingIdentifier(),lastSignupError:m.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"}},{key:"computeRealtimeLoadStatus",value:function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&v.default.isFunction(window.gapi.drive.realtime.load))}}},{key:"getAppStats",value:function(e){var t=window;if(e.numPanes=t.__TOTAL_PANES,e.numItems=v.default.totalItems,e.numArchivedItems=v.default.totalArchivedItems,e.numArchiveParents=v.default.totalArchivedParents,e.parseTextCalls=t.__PARSE_STATS,e.notificationUpdatesFull=v.default.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=v.default.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=v.default.getXHRStats(),m.default.pluginManager){try{e.pluginStats=m.default.pluginManager.getStats()}catch(a){e.pluginStats="Error: "+a.message}try{e.pluginState=m.default.pluginManager.getState()}catch(a){e.pluginState="Error: "+a.message}}if(m.default.recurringTaskManager)try{e.taskStats=m.default.recurringTaskManager.getStats()}catch(a){e.taskStats="Error: "+a.message}g.a.DETAILED_STATS;try{e.measureStats=m.default.Measure.getMeasureStats()}catch(a){e.measureStats="Error: "+a.message}}}]),t}(function(){function e(){n()(this,e)}return s()(e,[{key:"getAppInfo",value:function(e){var t=Date.now();e.user={name:m.default.settings.displayName.get(),email:m.default.settings.activeUser.get()},e.sessionStart=v.default.SESSION_BEGIN,e.reportTime=t,e.runningTime=t-v.default.SESSION_BEGIN,_.a.getPlatformInfo(e),e.jsVersion=g.a.jsVersion}}]),e}());t.default=new S},202:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=a(3),u=a(23),d=a(7),c=a(28),h=a(1),f=a(17),p=a(8),g=a(4),m=a(24),v=a(15),y=a(53);function k(){var e=this;this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new v.a,o.default.isDemoMode()&&window.addEventListener("message",function(e){if(e.data&&o.default.isString(e.data)&&e.data.indexOf("{")<0)for(var t=0,a=e.data.split("&"),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=a[i].split("=");try{o.default.PAssert(190,n.length>=0,"Invalid number of params in message")}catch(r){o.default.reportError(r)}switch(n[0]){case"script":this.runScript(n[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":l.default.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:o.default.emptyFn});break;case"help":"1"===n[1]?o.default.vmMain.showHelp(h.a.HelpMode.Normal):l.default.intro.close();break;case"panes":this.loadPanes(n[1])}}}.bind(this),!1),window.pauseScript=function(){e.isDisabled||(o.default.log("pause script"),e.isDisabled=!0)}}var _=function(e,t,a,i,n,r){this.queue.apply(this,arguments)},S=function(e,t,a,i){if(_("createItemAfter",void 0,t),void 0!==a&&0!==a)for(var n=0,r=0;r<Math.abs(a);r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;_("indent",a<0)}_(i?"setText":"typeString",void 0,e)},P=function(e){_("delay",e)};k.prototype={runScript:function(e){if(!this.isDisabled){0;var t=this.createScript(e);switch(this.activeScript=t,e){case"wait":this.demoEmpty(t);break;case"introEmail":this.demoEmail(t);break;case"introStyle":this.demoStyle(t);break;case"press":this.demoPress(t);break;case"none":return void this.notify("demoReady")}if(t.runQueue.length>0)this._scriptQueue.push(t);else try{o.default.PAssert(191,!1,"Invalid script request: ",e)}catch(a){o.default.reportError(a)}this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){l.default.toasts.clearMessage(h.a.MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,y.a.hide(),l.default.DragDrop.stop(),l.default.DragDrop.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(e){this.wasResumed||this.pause(),this.notify("demoReady"),e()},switchDemo:function(e){this.stop(),o.default.isDemoRunning=!0;var t=this[e]();this.resetData(function(){this._scriptQueue.push(t),this.activeScript=t,this.start()}.bind(this))},loadPanes:function(e){l.default.PaneManager.loadDemoPanes(e.split(":"))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},createScript:function(){var e={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(e){var t=Array.prototype.slice.call(arguments,1),a=this.runQueue;return a.push({id:this._nextId++,name:e,args:t}),a},repeat:function(e){this._repeat=e},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return _=_.bind(e),S=S.bind(e),e},run:function(){if(!this.isDisabled&&this.activeScript)if(this.isPaused)this.stoppedFromPause=!0;else{try{o.default.PAssert(193,this.activeScript,"Must have a script active to be running")}catch(a){o.default.reportError(a)}var e=this.activeScript.nextStep();if(e){var t=e.args;t.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[e.name].apply(this,t)}catch(a){o.default.reportError(a),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(e,t,a,i,n){try{o.default.PAssert(194,e,"Must provide a valid item to select")}catch(s){o.default.reportError(s)}o.default.isNumber(e)&&(e=l.default.PaneManager.getPaneAtIndex(t).itemAtIndex(e));e=this.getItemIfString(e);var r=t>=0?l.default.PaneManager.getPaneAtIndex(t):o.default.focusedPane;o.default.focusedPane&&o.default.focusedPane.id===r.id||g.a.focusPane(r),void 0===a||null===a?a=0:a<0&&(a=e.getParsedText().length+a+1),g.a.selectItem(e,a,a+i),this.hasSelection=!0,this.selectedItem=e,n&&n()},clearSelection:function(e){g.a.reset(),this.hasSelection=!1,this.selectedItem=void 0,e&&e()},scrollTo:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e);try{o.default.PAssert(195,i,"Must have selected a valid pane")}catch(n){o.default.reportError(n)}i.setScrollOffset(t),a&&a()},scrollMain:function(e,t,a){o.default.vmMain.setScrollOffset(e,t),setTimeout(a,t)},setText:function(e,t,a){(e=e||this.selectedItem).setText(t,h.a.ChangeType.Local),a&&a()},appendText:function(e,t,a){e.setText(e.getParsedText()+t,!0),a&&a()},setPriority:function(e,t,a){(e=this.getItemIfString(e)||this.selectedItem).setPriority(t,h.a.ChangeType.Local),a&&a()},setStarred:function(e,t,a){(e=e||this.selectedItem).setStarred(t,h.a.ChangeType.Local),a&&a()},setComplete:function(e,t,a,i){(e=this.getItemIfString(e)||this.selectedItem).dateCompleted=a,e.isComplete(t,h.a.ChangeType.Local),i&&i()},removeItem:function(e,t){(e=this.getItemIfString(e)||this.selectedItem).deleteSelf(h.a.ChangeType.Local),t()},setStarredEmail:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e),n=i.itemAtIndex(t);i.toggleStar(n),a()},setPriorityEmail:function(e,t,a,i){var n=l.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t),r=l.default.pluginManager.getPluginGmail();n&&r.setAttachmentPriority(n.getAttachmentByPlugin(h.a.PluginID.Gmail),a),i()},indent:function(e,t){var a={normCode:h.a.KeyCode.Tab,shiftKey:e};g.a.fireKeyEvent(void 0,a),t&&t()},collapse:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(t);(e=this.getItemIfString(e)||this.selectedItem).setCollapsed(!0,i),a&&a()},backspace:function(e,t,a,i){var n=this;try{o.default.PAssert(200,i,"typeString should always have a callback")}catch(c){o.default.reportError(c)}e=this.getItemIfString(e)||this.selectedItem;try{o.default.PAssert(201,e,"Must be an item")}catch(c){o.default.reportError(c)}try{o.default.PAssert(202,this.hasSelection,"Must set selection before typing")}catch(c){o.default.reportError(c)}try{o.default.PAssert(203,!this.isTyping,"Must wait until previous typing is finished")}catch(c){o.default.reportError(c)}var r=0,s=function(){n.intervalTyping&&(clearInterval(n.intervalTyping),n.intervalTyping=void 0),n.isTyping=!1},l=this.activeScript,u=e.getParsedText();function d(){this.isTyping=!0,this.activeScript===l?(u=u.substr(0,a-1)+u.substr(a,u.length-a),a--,e.setText(u,h.a.ChangeType.Local),++r>=t&&(s(),i&&i())):s()}d.apply(this),t>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(d.bind(this),this.typingSpeed))},typeString:function(e,t,a){try{o.default.PAssert(204,a,"typeString should always have a callback")}catch(l){o.default.reportError(l)}e=this.getItemIfString(e)||this.selectedItem;try{o.default.PAssert(205,e,"Must be an item")}catch(l){o.default.reportError(l)}try{o.default.PAssert(206,this.hasSelection,"Must set selection before typing")}catch(l){o.default.reportError(l)}try{o.default.PAssert(207,!this.isTyping,"Must wait until previous typing is finished")}catch(l){o.default.reportError(l)}try{o.default.PAssert(208,void 0!==t,"Must supply a string to be typed")}catch(l){o.default.reportError(l)}var i=0,n=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),r=this.activeScript;function s(){if(this.isTyping=!0,this.activeScript===r){var s=t.charCodeAt(i);if(s===h.a.KeyCode.Delete&&(s=h.a.KeyCode.Period),s===h.a.KeyCode.End){var o=g.a.getStartOffset(),l=e.getParsedText(),u=l.substr(0,o)+t.charAt(i)+l.substr(o);e.setText(u,h.a.ChangeType.Local),g.a.selectItem(e,o+1)}else g.a.fireKeyEvent(void 0,{normCode:s});++i>=t.length&&(n(),a&&a())}else n()}t&&(s.apply(this),t.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(s.bind(this),this.typingSpeed)))},typeIntoEmail:function(e,t,a){var i=o.default.reactEmailCompose.refs.body,n=0,r=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),s=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(function(){if(this.activeScript===s){var t=e[n];i.insertCharAtIndex(t,n),++n>=e.length&&(r(),a&&a())}else r()}.bind(this),t)},setSearch:function(e,t,a){l.default.PaneManager.getPaneAtIndex(t).search.setValue(e),a&&a()},createItemAfter:function(e,t,a){var i=this;e=e||this.selectedItem,this.setSelection(e,void 0,e.getParsedText().length,0),g.a.fireKeyEvent(void 0,{normCode:h.a.KeyCode.Enter}),requestAnimationFrame(function(){i.clearSelection(function(){var n;n=e.isHeader()?e.getChild(0):e.parent().getChild(e.getIndex()+1);try{o.default.PAssert(213,n,"Error getting new item: ",t)}catch(r){o.default.reportError(r)}t&&(i.savedItems[t]=n),i.selectedItem=n,i.setSelection(n,void 0,-1,0,a)})})},zoomPane:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e);t=this.getItemIfString(t),i.setItem(t,!0),a&&a()},zoomGmailPane:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e),n=l.default.pluginManager.getPluginGmail(),r=n._getLabelByName("me",t);try{o.default.PAssert(218,r,"Must be able to get a valid label if clicking a valid label")}catch(u){o.default.reportError(u)}var s=n.getVMLIForLabel("me",r);i.setItem(s,!0),i.selectIndex(-1),a&&a()},delay:function(e,t){var a=this;t&&(0===e?t&&t():(this.delayCb=t,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(function(){a.delayCb=a.timeoutDelay=void 0,t()},e)))},addPane:function(e,t,a,i,n,r){var s={};if(a)s.item=this.getItemIfString(a);else{var o=f.a.getDefaultDocument();s.item=o.getRootItem()}i&&(s.search=i);l.default.PaneManager.createPaneAtIndex(e,t,s,n);r()},removePane:function(e,t,a){l.default.PaneManager.removePaneAtIndex(e,t),a&&a()},cullPanes:function(e,t){var a=l.default.PaneManager.paneCount();a>e?(this.removePane(a-1),setTimeout(this.cullPanes.bind(this,e,t),60)):t()},selectItemInPane:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t);this.selectedItem=i,a()},dragTo:function(e,t,a,i,n,r){var s=l.default.PaneManager.getPaneAtIndex(e),u=l.default.PaneManager.getPaneAtIndex(t),d=s.itemAtIndex(a),c=s.elementAtIndex(a),f=-1===i;f&&(i=u.numItems()-1);var p,m,v=u.elementAtIndex(i),y=u.itemAtIndex(i),k=u.objectAtIndex(i),_=c.getBoundingClientRect(),S=v.getBoundingClientRect(),P=s.dragMarginTop||0,w=_.top+(P||10),I=S.left-_.left,b=S.top-w+(f?l.default.DisplaySettings.lineItemHeight(k,y,1):0);g.a.focusPane(s);var D=null;var E=this,C=this.activeScript;l.default.DragDrop.startDragItem=d,d.dragStart({startSrc:c,eventX:_.left+10,eventY:w}),requestAnimationFrame(function e(t){if(E.activeScript===C){D||(D=t);var a,i=(a=(t-D)/n)<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1;if(p=I*i+_.left+10,m=b*i+w,i>=1){var s,l=document.getElementById("preventInteraction");l&&(s=l.parentElement).removeChild(l)}d.dragMove({eventX:p,eventY:m,diffY:b>_.top?1:-1,preventDefault:o.default.emptyFn,stopPropagation:o.default.emptyFn}),l&&s.appendChild(l),i>=1?(d.dragEnd({clientX:p,clientY:m,target:c}),r&&r()):requestAnimationFrame(e)}else g.a.fireMouseUp(c,h.a.ButtonCode.Left)})},getItemIfString:function(e){var t;if(o.default.isString(e)){t=f.a.getItem(e)||this.savedItems[e];try{o.default.PAssert(225,t,"Item was not saved correctly")}catch(a){o.default.reportError(a)}}else if(e){try{o.default.PAssert(226,o.default.isVMLI(e),"Must supply a valid VMLI: ",o.default.getObjectInfo(e))}catch(a){o.default.reportError(a)}t=e}return t},pushMessage:function(e,t){if(this._currentToast)return l.default.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,e,t);var a;if(a=o.default.isString(e)?l.default.toasts.pushMessage({text:e,hold:!0}):l.default.toasts.pushMessage(e),this._currentToast=a,e===h.a.MessageID.ThisIsDemo){m.a.listen("tapMain",function e(){l.default.toasts.clearMessage(a),m.a.unlisten("tapMain",e)})}t&&t()},notify:function(e,t){window.parent.postMessage(e,"*"),t&&t()},demoDone:function(e){g.a.reset(),this.notify("done"),o.default.isDemoRunning=!1;var t=document.getElementById("preventInteraction");t&&t.parentElement.removeChild(t),e()},addClass:function(e,t){o.default.addClass(document.documentElement||document.body,e),t&&t()},removeClass:function(e,t){o.default.removeClass(document.documentElement||document.body,e),t&&t()},switchClass:function(e,t,a){this.removeClass(e),this.addClass(t),a()},selectEmail:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e);try{o.default.PAssert(227,i,"Must have selected a valid pane")}catch(n){o.default.reportError(n)}g.a.focusPane(i),i.selectIndex(t),a&&a()},openEmail:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e);try{o.default.PAssert(228,i,"Must have selected a valid pane")}catch(r){o.default.reportError(r)}i.selectIndex(t);var n=i.itemAtIndex(t);i.openEmailByItem(n),a&&a()},closeEmail:function(e){l.default.EmailPreview.close(),e&&e()},sendEmail:function(e){o.default.reactEmailCompose.onClickSend(),e()},toggleMessageExpanded:function(e,t){o.default.reactEmailPreview.toggleExpanded(e),t()},replyToMessage:function(e){l.default.EmailPreview.setLastMessageResponseMode(h.a.EmailResponseMode.Reply),e()},archiveEmail:function(e,t,a){var i=l.default.PaneManager.getPaneAtIndex(e),n=i.itemAtIndex(t);i.archiveItem(!0,n),a()},addEmail:function(e,t){l.default.pluginManager.getPluginGmail().refreshThreadCacheData("me",e,void 0,function(){},t)},waitPaneItems:function(e,t){var a=l.default.PaneManager.getPaneAtIndex(e);try{o.default.PAssert(229,a,"Must have selected a valid pane")}catch(i){o.default.reportError(i)}if(a.items.length()>0)t();else{a.items.listen(function e(i){i.length>0&&(a.items.unlisten(e),t())})}},displaySetting:function(e,t){l.default.DisplaySettings.changeTheme(e,e),t()},caption:function(e,t,a){this.demoCaption.set({text:e,opacity:1,center:t,light:e.indexOf("<b>")>=0}),a()},captionFade:function(e){var t=this.demoCaption.get();this.demoCaption.set({text:t.text,opacity:0,center:t.center,light:t.light}),e()},waitAction:function(e,t){this._waitTracker={check:e,cb:t}},onTrackerAction:function(e){var t=this._waitTracker;t&&t.check(e)&&t.cb()},demoEmail:function(e){return o.default.isDemoRunning=!0,_("waitPaneItems",0),_("zoomGmailPane",1,"Needs Reply"),_("zoomGmailPane",2,"Starred"),_("removeClass","invisible"),_("demoReady"),P(1e3),_("dragTo",0,1,0,-1,1e3),P(200),_("dragTo",0,1,0,-1,1e3),P(800),_("setStarredEmail",0,1),P(500),_("setStarredEmail",0,3),P(800),_("setPriorityEmail",2,0,h.a.VMLIFlag.P0),P(500),_("setPriorityEmail",2,2,h.a.VMLIFlag.P2),P(1200),_("selectEmail",0,0),P(200),_("openEmail",0,0),_("pushMessage",h.a.MessageID.ThisIsDemo),_("demoDone"),e},demoStyle:function(e){var t=0,a=0;o.default.isDemoRunning=!0,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),_("removeClass","invisible"),_("demoReady"),P(500),_("dragTo",0,1,1,1,1e3),P(1e3),_("setSelection","tracking",0,-1,0),_("typeString",void 0," #Android"),P(800),_("typeString",void 0," @tomorrow "),P(800),_("setSelection","tracking",0,0,0),_("typeString",void 0,"+Grant "),P(1500),_("zoomPane",1,"release"),P(1500);for(var i="#Android",n=i.length;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;_("setSearch",i.substr(0,n),2),P(40)}P(800),i="+Grant";for(n=0;n<=i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;_("setSearch",i.substr(0,n),2),P(40)}_("pushMessage",h.a.MessageID.ThisIsDemo),_("demoDone")},demoPress:function(e){p.d.addListener(this.onTrackerAction.bind(this)),_("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),_("waitAction",function(e){return e.type===p.d.TrackerType.Misc&&e.misc===p.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===h.a.PaneMode.Gmail}),_("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),_("waitAction",function(e){return e.type===p.b.Misc&&e.misc===p.a.ChangeDate||e.type===p.b.Insert&&"@"===e.data[0].text}),_("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:h.a.MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(e){o.default.isDemoRunning=!0,_("demoReady"),_("pushMessage",h.a.MessageID.ThisIsDemo),_("demoDone")}};var w,I=k;!function(e){e.Normal="Sign in with Google",e.Connecting="Connecting...",e.LoggingIn="Logging In...",e.Loading="Loading...",e.Offline="Offline"}(w||(w={}));var b=function(){function e(){var t;n()(this,e),t=navigator.onLine?w.Normal:w.Offline,this.loginStatus=new v.a(t),this.popupClosedError=new v.a,this.gapiFailedToLoad=new v.a,this.loggedOutByAuthFailure=new v.a,this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=d.a.canDownloadNativeApp(),this.loginRequested=!1,this.loginRequestTimer=void 0}return s()(e,[{key:"getDownloadIcon",value:function(){return d.a.getPlatformIcon()}},{key:"getDownloadText",value:function(){return d.a.getPlatformName()}},{key:"userLogin",value:function(){var e=this;c.a.onAuthed(function(){o.default.authUserLoggedIn=!0,e.loginRequested=!1,e.loginStatus.set(w.Normal),l.default.settings.localIntegrity.set(!0),e.popupClosedError.set(void 0),l.default.PaneManager.setupInitialTimeout()}),this.loginStatus.set(w.LoggingIn),c.a.signIn()}},{key:"shouldShowLogin",value:function(){return this.loginStatus.get()===w.Normal||this.loginStatus.get()===w.LoggingIn}},{key:"logout",value:function(){l.default.settings.activeUser.get()&&(o.default.log("Logging out"),c.a.signOut().then(function(){f.a.clearLocalData()}))}},{key:"logoutClicked",value:function(){var e=this;o.default.isDemoMode()?u.a.removeURLParam("demo"):f.a.hasPendingRemoteUpdates()?l.default.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(t){t&&e.logout()}):this.logout()}},{key:"initDemo",value:function(){o.default.AScript||(o.default.AScript=new I)}},{key:"runScript",value:function(e){o.default.AScript.runScript(e)}},{key:"_reportLoginTapSkip",value:function(e){}},{key:"closeConnectionError",value:function(){l.default.tooltip.hideSticky(this.textErrorConnecting)}}]),e}();t.a=b},206:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(2),g=a.n(p),m=a(21),v=a(4),y=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){var e={value:this.props.value||0,tempValue:void 0};this.createObservables(e)}},{key:"componentWillReceiveProps",value:function(e){e.value!==this.state.value&&this.value.set(e.value)}},{key:"getValue",value:function(){return this.value.get()}},{key:"setValue",value:function(e){try{f.default.PAssert(609,f.default.isNumber(e),"Must only report a numerical value")}catch(t){f.default.reportError(t)}e=f.default.clamp(e,this.props.minValue||0,this.props.maxValue||1/0),this.value.get()!==e&&(this.tempValue.set(void 0),this.value.set(e),this.props.onChange&&this.props.onChange(e))}},{key:"focus",value:function(){this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"onFocus",value:function(){f.default.activeInput.set(this)}},{key:"onBlur",value:function(){f.default.activeInput.set(null),void 0!==this.tempValue.get()&&(this.refs.input.value=""+this.value.get(),this.tempValue.set(void 0))}},{key:"onMouseDown",value:function(){v.a.reset()}},{key:"interval",value:function(){return this.props.interval||1}},{key:"onClickUp",value:function(){if(!this.props.readonly){var e=this.value.get()+this.interval();this.setValue(e)}}},{key:"onClickDown",value:function(){if(!this.props.readonly){var e=this.value.get()-this.interval();this.setValue(e)}}},{key:"onChange",value:function(){var e=this.props.parseFn||f.default.parseInt,t=+this.refs.input.value,a=e(t);isNaN(a)?this.tempValue.set(t):this.setValue(a)}},{key:"render",value:function(){var e=this.state,t=this.props,a=void 0!==e.tempValue?e.tempValue:e.value,i=f.default.classNames("fancyInputNumber c-border",t.className);return g.a.createElement("div",{className:i,id:t.id,style:{}},g.a.createElement("input",{className:"c-foreground",readOnly:t.readonly,onMouseDown:this.onMouseDown,onChange:this.onChange,value:a,ref:"input",onFocus:this.onFocus,onBlur:this.onBlur}),g.a.createElement("div",{className:"fancyInputNumberButton up icon-caret-up",onClick:this.onClickUp}),g.a.createElement("div",{className:"fancyInputNumberButton down icon-caret-down",onClick:this.onClickDown}))}}]),t}(m.a);t.a=y},21:function(e,t,a){"use strict";a.d(t,"a",function(){return T});var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(62),h=a.n(c),f=a(11),p=a.n(f),g=a(56),m=a.n(g),v=a(0),y=a(23),k=a(1),_=a(3),S=a(2),P=a(45),w=a(15),I=a(42),b=a(24),D=a(49),E=0;function C(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}var A=function(e,t,a){var i=0;if(C(e,t))return!0;if("object"!==m()(e)||null===e||"object"!==m()(t)||null===t)return!1;var n,r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(var o=0;o<r.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n=void 0,!hasOwnProperty.call(t,r[o]))return!1;if(a&&!1===(n=a(r[o],e[r[o]],t[r[o]])))return!1;if(void 0===n&&!C(e[r[o]],t[r[o]]))return!1}return!0},M={constructor:!0,componentWillMount:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},T=function(e){function t(e){var a;n()(this,t),a=l()(this,d()(t).call(this,e));var i=Object.getPrototypeOf(h()(a)),r=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertyNames(i.__proto__)),s=[h()(a)].concat(v.default.arrayDifference(r,M));return y.a.binder.apply(y.a,s),a.state=a.getInitialState(),a}return p()(t,e),s()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!A(this.props,e,this.arePropsEqual)||!A(this.state,t,this.areStatesEqual)}},{key:"getInitialState",value:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=v.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t}},{key:"createObservables",value:function(e){try{v.default.PAssert(303,!this._listeners,"You have to run createObservables in init()")}catch(i){v.default.reportError(i)}for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];v.default.isArray(a)?e[t]=new I.a(a):e[t]=new w.a(a);try{v.default.PAssert(304,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(i){v.default.reportError(i)}this[t]=e[t]}try{v.default.PAssert(305,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(i){v.default.reportError(i)}this._observables=e}},{key:"_addListener",value:function(e){try{v.default.PAssert(306,e&&e.target,"Must add a valid listener")}catch(t){v.default.reportError(t)}this._ensureListeners();try{v.default.PAssert(307,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(t){v.default.reportError(t)}this._listeners.push(e)}},{key:"refreshListeners",value:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=v.default.extend(t,this._observables)),t&&this.setupListeners(t)}},{key:"_ensureListeners",value:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])}},{key:"setupListeners",value:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var a=e[t];a instanceof w.a&&this._addListener(a.listen(this.onListener))}}},{key:"disposeListeners",value:function(e){if(this._listeners){for(var t=0,a=0;a<this._listeners.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[a].dispose()}if(this._listeners=[],e){var i=0;for(a=0;a<this._permanentListeners.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._permanentListeners[a].dispose()}}}e&&this.disposeDispatcherListeners()}},{key:"disposeDispatcherListeners",value:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._dispatcherListeners[t],i=a[0],n=a.slice(1);i.unlisten.apply(i,n)}this._dispatcherListeners=[]}}},{key:"listenTo",value:function(e,t){try{v.default.PAssert(308,e&&(e instanceof D.a||e instanceof w.a),"Can only listen to an Observable or a Trigger object")}catch(i){v.default.reportError(i)}if(e instanceof D.a||e instanceof w.a){var a=e.listen(this.onListener);!1!==t?this._addListener(a):this._permanentListeners.push(a)}}},{key:"listenToDispatcher",value:function(e,t){this._dispatcherListeners||(this._dispatcherListeners=[]);var a,i=Array.prototype.slice.call(arguments);v.default.isString(i[0])?a=b.a:(a=i[0],i.splice(0,1)),i.push(this.onListener),a.listen.apply(a,i);var n=[a].concat(i);this._dispatcherListeners.push(n)}},{key:"_hasListener",value:function(e){var t=0;try{v.default.PAssert(309,e,"Must have a valid target")}catch(n){v.default.reportError(n)}for(var a=!1,i=0;i<this._listeners.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[i].target===e){a=!0;break}}return a}},{key:"_getState",value:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=v.default.extend(t,this._observables)),this.transformState(t)}},{key:"transformState",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a&&a instanceof w.a&&(e[t]=a.get(),a instanceof I.a&&(e[t+"_arrVer"]=a.version))}return e}},{key:"onListener",value:function(){this.updateState()}},{key:"updateState",value:function(e){try{v.default.PAssert(311,this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.name)}catch(n){v.default.reportError(n)}if(this._isMounted){var t=this.state,a=this._getState(e);if(this.onBeforeChanged){var i=this.onBeforeChanged(a,t);void 0!==i&&(a=i)}!1!==a&&(this.setState(a),this.onAfterChanged&&this.onAfterChanged(a,t))}}},{key:"componentWillUnmount",value:function(){this.disposeListeners(!0),this.__hotkeys&&(P.a.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1}},{key:"getChildByKey",value:function(e){var t;return S.Children.forEach(this.props.children,function(a){a&&a.key===e&&(t=a)}),t}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=P.a.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=P.a.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()}},{key:"getUniqueID",value:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+E++),this.__id)}},{key:"componentDidCatch",value:function(e,t){this.onComponentError&&this.onComponentError(e,t),v.default.reportError(e,t,void 0,"React Component Error: "),_.default.toasts.pushMessage(k.a.MessageID.ReactError)}}]),t}(S.Component)},225:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(3),h=a(14),f=(i=function(){function e(){r()(this,e)}return o()(e,[{key:"tagComparator",value:function(e,t){return e.localeCompare(t)}},{key:"tagComparatorNumber",value:function(e,t){var a=e.count,i=t.count;return a===i?e.text.localeCompare(t.text):a>i?-1:1}},{key:"findMatchExact",value:function(e){return!1}},{key:"findMatchLike",value:function(e,t,a,i){var n={},r=[],s=e.toLowerCase(),o={comparator:function(e){if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var a=0,o=0;o<t.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=t[o];if(!s||l.startsWith(s)&&(i||l!==s)){if(!n[l]){var u=n[l]={type:"tag",text:l,count:0};r.push(u)}n[l].count++}}}}};return a?o.item=a:o.itemStore=c.default.itemStoreManager.getDefaultItemStore(),d.default.searchVMLIs(o),r.sort(this.tagComparatorNumber),r.length>t&&(r=r.slice(0,t)),r}},{key:"printStats",value:function(e){var t=0;d.default.log("--- Tag stats ---",e);for(var a=this.findMatchLike("",100),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(a[i].text,a[i].count)}}},{key:"getAll",value:function(){return this.findMatchLike("")}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,void 0,void 0,!0).forEach(function(e){t.push({text:e.text,rightText:e.count})}),t.sort(this.tagComparatorNumber),t}}]),e}(),u()(i.prototype,"tagComparatorNumber",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"tagComparatorNumber"),i.prototype),u()(i.prototype,"getRNList",[h.a],Object.getOwnPropertyDescriptor(i.prototype,"getRNList"),i.prototype),i);t.a=new f},23:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=function(){function e(){n()(this,e),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}return s()(e,[{key:"extendPrototype",value:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e.prototype[a]=t[a])}},{key:"extendClass",value:function(e,t,a){for(var i=0,n=Object.getOwnPropertyNames(t.prototype),r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[r];a&&e[s]||(e.prototype[s]=t.prototype[s])}}},{key:"defineBase",value:function(e){e.prototype.constructor=e}},{key:"extend",value:function(e,t,a,i){if(t)for(var n in t)if(t.hasOwnProperty(n)&&(!i||!e[n])){var r=t[n],s=a&&r&&r.bind?r.bind(e):r;e[n]=s}return e}},{key:"inherit",value:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}},{key:"binder",value:function(e){var t=0;for(var a=0;a<(arguments.length<=1?0:arguments.length-1);a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];e[i]=e[i].bind(e)}}},{key:"forceBind",value:function(e,t){var a=t[e].bind(t);return t[e]=a,a}},{key:"destroy",value:function(e){}}]),e}(),p=a(1).a.URLPart;function g(e,t){e===p.Search?window.location.search=t:e===p.Hash&&(window.location.hash=t)}function m(e){return e===p.Search?window.location.search:e===p.Hash?window.location.hash:void 0}function v(e){return"state"===e?p.Search:p.Hash}var y=function(e){function t(){return n()(this,t),l()(this,d()(t).call(this))}return h()(t,e),s()(t,[{key:"hasURLParam",value:function(e,t){var a=e+"=";return t&&(a+=t),m(v(e)).indexOf(a)>=0}},{key:"getURLParam",value:function(e,t){var i=t||v(e);if(i===p.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===n?void 0:decodeURIComponent(n[1].replace(/\+/g," "))}if(i!==p.Hash)a(0).default.log("Invalid URL part");else for(var r,s=0,o=m(p.Hash).substring(1),l=/([^&=]+)=([^&]*)/g;r=l.exec(o);){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(decodeURIComponent(r[1])===e)return decodeURIComponent(r[2])}}},{key:"insertURLParam",value:function(e,t,a){var i=0;e=encodeURIComponent(e),t=encodeURIComponent(t);for(var n=v(e),r=m(n).substr(1).split("&"),s=r.length-1;s>=0;s--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[s].split("=");if(o[0]==e){o[1]=t,r[s]=o.join("=");break}}s<0&&(r[r.length]=[e,t].join("=")),g(n,r.join("&")),n!==p.Hash||a||window.location.reload()}},{key:"removeURLParam",value:function(e,t){for(var a=0,i=v(e=encodeURIComponent(e)),n=m(i).substr(1).split("&"),r=n.length-1;r>=0;r--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n[r].split("=")[0]==e){n.splice(r,1),g(i,n.join("&")),i!==p.Hash||t||window.location.reload();break}}}},{key:"genPromise",value:function(e){e.then=function(e,t,a){},e.execute=function(e,t,a){}}}]),t}(f);t.a=new y},24:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(10),s=a.n(r),o=a(9),l=a.n(o),u=a(11),d=a.n(u),c=function(e){function t(){return n()(this,t),s()(this,l()(t).apply(this,arguments))}return d()(t,e),t}(a(77).a);t.a=new c},26:function(e,t,a){"use strict";var i,n=a(12),r=a.n(n),s=a(22),o=a.n(s),l=a(35),u=a.n(l),d=a(5),c=a.n(d),h=a(6),f=a.n(h),p=a(10),g=a.n(p),m=a(9),v=a.n(m),y=a(25),k=a.n(y),_=a(11),S=a.n(_),P=a(0),w=a(109),I=a(13),b=a.n(I),D=a(1),E=a(3),C=a(7),A=a(28),M=a(37),T=a(66),L=a(14),x=a(58);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function O(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=null!=arguments[a]?arguments[a]:{};a%2?R(i,!0).forEach(function(t){u()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var F=function(e){function t(){var e;return c()(this,t),(e=g()(this,v()(t).call(this))).TEST_DOC_ID="",e.canWrite=!P.default.isDemoMode(),e.clearOldDatabases(),e}return S()(t,e),f()(t,[{key:"clearOldDatabases",value:function(){window.indexedDB&&(this.deleteDatabase("Drive"),this.deleteDatabase("GCalendar"),this.deleteDatabase("Gmail"),this.deleteDatabase("Gmail_RawCache"),this.deleteDatabase("QuickAdd"))}},{key:"deleteDatabase",value:function(e){window.indexedDB.deleteDatabase(e)}},{key:"preload",value:function(e){var t=this;if(this.canWrite){this.db=w.a.createDB();var a=window.__preload;a?a.data?this.onPreload(a.data,e):a.worker.onmessage=function(a){t.onPreload(a.data,e)}:w.a.load(this.db,function(a){t.onPreload(a,e)})}}},{key:"_saveItemDataToDB",value:function(e){this.canWrite&&this.db.items.put(e)}},{key:"_deleteItemData",value:function(e){this.canWrite&&this.db.items.delete(e)}},{key:"_saveDocumentDataToDB",value:function(e){this.canWrite&&this.db.documents.put(e)}},{key:"setSetting",value:function(e,a){k()(v()(t.prototype),"setSetting",this).call(this,e,a),this.canWrite&&(null!=a&&void 0!==a?this.db.settings.put(O({id:e},a)):this.db.settings.delete(e))}},{key:"deleteSettings",value:function(e){var a=this;k()(v()(t.prototype),"deleteSettings",this).call(this,e),this.canWrite&&Object.keys(e).forEach(function(e){return a.db.settings.delete(e)})}},{key:"saveSettings",value:function(e){k()(v()(t.prototype),"saveSettings",this).call(this,e);var a=Object.keys(e).map(function(t){return O({id:t},e[t])});this.canWrite&&this.db.settings.bulkPut(a)}},{key:"saveBoard",value:function(e){if(k()(v()(t.prototype),"saveBoard",this).call(this,e),this.canWrite){var a=M.a.boardOut(e);this.db.boards.put(a)}}},{key:"deleteBoard",value:function(e){k()(v()(t.prototype),"deleteBoard",this).call(this,e),this.canWrite&&this.db.boards.delete(e)}},{key:"deleteDocument",value:function(e){var a=this;k()(v()(t.prototype),"deleteDocument",this).call(this,e),this.canWrite&&(e.getAllItems().forEach(function(e){a.db.items.delete(e.id)}),this.db.documents.delete(e.id))}},{key:"saveContacts",value:function(e,a){if(k()(v()(t.prototype),"saveContacts",this).call(this,e,a),this.canWrite){var i=a.map(function(e){return M.a.contactOut(e)});this.db.contacts.bulkPut(i)}}},{key:"clearContacts",value:function(){k()(v()(t.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(){var e=o()(r.a.mark(function e(t,a){var i;return r.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(i=[],a&&a.length>0&&i.push(this.db.items.bulkDelete(a)),t.length>0&&this.canWrite&&i.push(this.db.items.bulkPut(t)),!(i.length>0)){e.next=5;break}return e.abrupt("return",Promise.all(i));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"getLegacyLocalStorage",value:function(e){var a=k()(v()(t.prototype),"getLegacyLocalStorage",this).call(this,e);return a||(a=localStorage.getItem(e))&&k()(v()(t.prototype),"setLegacyLocalStorage",this).call(this,e,a),a}},{key:"setLegacyLocalStorage",value:function(e,a){k()(v()(t.prototype),"setLegacyLocalStorage",this).call(this,e,a),P.default.isString(a)||(a=JSON.stringify(a)),localStorage.setItem(e,a)}},{key:"deleteLegacyLocalStorage",value:function(e){k()(v()(t.prototype),"deleteLegacyLocalStorage",this).call(this,e),localStorage.removeItem(e)}},{key:"setValue",value:function(e,a){var i=this.getValue(e);i===a||P.default.deepEqual(i,a)||(k()(v()(t.prototype),"setValue",this).call(this,e,a),this.db.localStorage.put({id:e,value:a}))}},{key:"clearAllData",value:function(){var e=o()(r.a.mark(function e(){return r.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(this.db.tables.map(function(e){return e.clear()})));case 1:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deletePluginUsage",value:function(e,a){k()(v()(t.prototype),"deletePluginUsage",this).call(this,e,a),this.db.plugins.delete(a)}},{key:"savePluginUsage",value:function(e,a){k()(v()(t.prototype),"savePluginUsage",this).call(this,e,a),this.db.plugins.put(a)}},{key:"tablePut",value:function(e,t){return this.db[e].put(t)}},{key:"tableClear",value:function(e){return this.db[e].clear()}},{key:"tableFilter",value:function(e,t){return this.db[e].filter(t).toArray()}},{key:"tableGet",value:function(e,t){return this.db[e].get(t)}},{key:"tableDelete",value:function(e,t){return this.db[e].delete(t)}}]),t}((i=function(){function e(){c()(this,e),this.documentsPreloaded=[],this.dataCache={settings:{},items:{},documents:{},boards:[],contacts:[],localStorage:{},user:{}}}return f()(e,[{key:"init",value:function(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}},{key:"transformFieldsDocument",value:function(e){var t=P.default.clone(e);return P.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,t=M.a.documentOut(t,{forLocal:!0})}},{key:"transformFieldsItem",value:function(e){var t=P.default.clone(e);return P.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.noteItem,delete t.archivedItems,delete t.deletedItems,M.a.itemOut(t)}},{key:"getItemData",value:function(e,t){return this.dataCache.items[e]}},{key:"getDocumentData",value:function(e){return this.dataCache.documents[e]}},{key:"getSetting",value:function(e){return this.dataCache.settings[e]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getBoard",value:function(e){return this.dataCache.boards[e]}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"saveDocument",value:function(e,t){var a=e.getSaveInfo();t&&(a=Object.assign(a,t)),this.dataCache.documents[e.id]=a,this._saveDocumentDataToDB(M.a.documentOut(a,{forLocal:!0}))}},{key:"setSetting",value:function(e,t){this.dataCache.settings[e]=t}},{key:"saveSettings",value:function(e){Object.assign(this.dataCache.settings,e)}},{key:"saveBoard",value:function(e){this.dataCache.boards[e.id]=Object.assign(this.dataCache.boards[e.id]||{},e)}},{key:"saveContacts",value:function(e,t){this.dataCache.contacts=e}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"cacheItem",value:function(e){this.dataCache.items[e.id]=e}},{key:"saveItem",value:function(e,t){var a=this.dataCache.items[e.id];if(a)e.docId=e.docId||a.docId,e.docId||t&&(e.docId=t.getDocumentOwner().id),Object.assign(a,e);else if(t){var i=t.getFullSaveData(),n=t.getItems().map(function(e){return e.getFullSaveData()});a=Object.assign(i,{items:n})}else 0;try{P.default.PAssert(19,a.id,"Saved item must have id")}catch(o){P.default.reportError(o)}try{P.default.PAssert(20,a.isRoot||a.parent,"Saved item must have parent or be root")}catch(o){P.default.reportError(o)}try{P.default.PAssert(21,a.docId,"Saved item must have docId")}catch(o){P.default.reportError(o)}if((!a.docId||!a.isRoot&&!a.parent)&&t){var r=t.getItems().map(function(e){return e.getFullSaveData()});a=Object.assign(t.getFullSaveData(),{items:r},e);try{P.default.PAssert(22,a.isRoot||a.parent,"Saved item had root or parent overridden")}catch(o){P.default.reportError(o)}try{P.default.PAssert(23,a.docId,"Saved item had docId overridden")}catch(o){P.default.reportError(o)}}this.dataCache.items[a.id]=a;var s=this.transformFieldsItem(a);this._saveItemDataToDB(s)}},{key:"deleteItem",value:function(e){var t=this.dataCache.items[e.id];if(t){this.dataCache.items[t.id].isDeleted=!0,t.isDeleted=!0;var a=this.transformFieldsItem(t);this._saveItemDataToDB(a)}else{0,e.isDeleted=!0;var i=this.transformFieldsItem(e);this._saveItemDataToDB(i)}}},{key:"deleteBoard",value:function(e){delete this.dataCache.boards[e]}},{key:"deleteDocument",value:function(e){var t=this;e.getAllItems().forEach(function(e){delete t.dataCache.items[e.id]}),delete this.dataCache.documents[e.id]}},{key:"deleteSettings",value:function(e){var t=this;Object.keys(e).forEach(function(e){delete t.dataCache.settings[e]})}},{key:"clearAllData",value:function(){var e=o()(r.a.mark(function e(){return r.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"ensureMirror",value:function(){var e=o()(r.a.mark(function e(t,a){var i,n,s,o,l,u,d,c,h,f,p=0,g=arguments;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:i=g.length>2&&void 0!==g[2]&&g[2],n=[],s=[],o=!this.TEST_DOC_ID,l=t.length>0&&!!t[0].id,u=0;case 4:if(!(u<t.length)){e.next=12;break}if(!(p++>5e3&&__infLoop&&__infLoop(p))){e.next=7;break}throw new RangeError;case 7:if(d=l?t[u]:t[u].value,c=l?"load":t[u].type,h=this.dataCache.items[d.id],"Removed"===c)s.push(d.id);else if(!h||!this.areObjectsEqual(d,h)){i&&!o&&console.log("THIS IS BAD, document mismatch"),f=Object.assign(h||{},d),a&&delete f.pendingSync;try{P.default.PAssert(24,f.id,"Saved item must have id")}catch(m){P.default.reportError(m)}try{P.default.PAssert(25,f.isRoot||f.parent,"Saved item must have parent or be root")}catch(m){P.default.reportError(m)}try{P.default.PAssert(26,f.docId,"Saved item must have docId")}catch(m){P.default.reportError(m)}void 0!==f.text&&f.date&&!f.text.includes(D.a.CharDate)&&delete f.date,this.dataCache.items[d.id]=f,n.push(f)}case 9:u++,e.next=4;break;case 12:return e.abrupt("return",this.bulkSave(n,s));case 13:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"areObjectsEqual",value:function(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete t.deletedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,delete e.deletedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,P.default.deepEqual(e,t))}},{key:"onDataReady",value:function(){this.dataCache.settings&&E.default.settings.load(this.dataCache.settings,!1),this.dataCache.contacts&&x.a.loadContacts(),this.fireLocalLoaded()}},{key:"fireLocalLoaded",value:function(){var e=this;A.a.onActiveUser(function(){try{P.default.PAssert(27,e.dataCache.documents,"Must be documents in cache at this point")}catch(n){P.default.reportError(n)}if(e.dataCache.documents){var t=P.default.objectValues(e.dataCache.documents),a=P.default.filterWithNonMatches(t,e.checkDocHasRoot);if(a.fail.length>0&&(console.log("Failed docs",a.fail),a.fail.forEach(function(t){delete e.dataCache.documents[t.id]})),t=a.match.map(function(t){var a=!1,i=e.dataCache.items[t.root];return a?a.createVMLIs(i):(t.rootData=i,(a=T.a.fromData(t,e._backing)).createVMLIs()),a}),e.cbOnLoad){var i={documentsPending:e.dataCache.documentsPending,itemsPending:e.dataCache.itemsPending,settingsPending:e.dataCache.settingsPending,boardsPending:e.dataCache.boardsPending,isPreload:e.isPreload};e.cbOnLoad(t,i)}e.isPreload?e.documentsPreloaded=t:e.cbOnLoad=void 0}})}},{key:"checkDocHasRoot",value:function(e){return!!this.dataCache.items[e.root]}},{key:"getLegacyLocalStorage",value:function(e){return this.dataCache.localStorage[e]}},{key:"setLegacyLocalStorage",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteLegacyLocalStorage",value:function(e){delete this.dataCache.localStorage[e]}},{key:"getValue",value:function(e){return this.dataCache.localStorage[e]}},{key:"setValue",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteValue",value:function(e){delete this.dataCache.localStorage[e]}},{key:"onPreload",value:function(e,t){if(e&&e.error){try{P.default.PAssert(28,"OpenFailedError"===e.error.name,"Unknown error in Dexie",e.error)}catch(a){P.default.reportError(a)}C.a.blockedReason.set("Moo.do cannot run because it is unable to access data storage in your browser. This could be because you are in Private mode, you have disabled history, or your hard drive is full. Please try Moo.do in a normal browsing session or download the app.")}else this.dataCache=e;t()}},{key:"saveEncryptionKey",value:function(e,t){}},{key:"bulkSave",value:function(){var e=o()(r.a.mark(function e(t,a){var i,n=this;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return a&&a.length>0&&a.forEach(function(e){delete n.dataCache.items[e]}),t.forEach(function(e){n.dataCache.items[e.id]=e}),i=t.map(this.transformFieldsItem),e.abrupt("return",this._bulkSaveItems(i,a));case 5:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"getItemsMap",value:function(){return this.dataCache.items}},{key:"savePluginUsage",value:function(e,t){this.dataCache.plugins[e]||(this.dataCache.plugins[e]={}),this.dataCache.plugins[e][t.id]=t}},{key:"getPluginTableUsage",value:function(e){return this.dataCache.plugins[e]}},{key:"getPluginUsage",value:function(e,t){if(this.dataCache.plugins[e])return this.dataCache.plugins[e][t]}},{key:"deletePluginUsage",value:function(e,t){this.dataCache.plugins[e]&&delete this.dataCache.plugins[e][t]}},{key:"getTableData",value:function(e){return this.dataCache[e]}},{key:"getTableValue",value:function(e,t){var a=this.getTableData(e);if(a){var i=a[t];if(void 0!==i)return i}}},{key:"setTableValue",value:function(e,t,a){var i=this.getTableData(e);i&&(i[t]=a)}},{key:"ensureTableLoaded",value:function(e,t){return t(),!0}},{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}}]),e}(),b()(i.prototype,"checkDocHasRoot",[L.a],Object.getOwnPropertyDescriptor(i.prototype,"checkDocHasRoot"),i.prototype),i));t.a=new F},27:function(e,t,a){"use strict";a.r(t);var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=function(){function e(t){n()(this,e),this._range=t,this._range||(this._range=a(27).default._getSelectionRange())}return s()(e,[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return o.default.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return o.default.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(e){return a(27).default.getSelectOffsetsInElement(e,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}}]),e}(),u=a(1),d=function(){function e(){n()(this,e)}return s()(e,[{key:"createFakeRange",value:function(e,t,a,i){try{var n=this.createSelectionRange();return n.setStart(e,t),n.setEnd(a,i),new l(n)}catch(r){o.default.reportError(r)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(e,t,a,i,n){if("TEXTAREA"===e.nodeName){try{o.default.PAssert(503,e===a,"Cannot multiselect textareas")}catch(s){o.default.reportError(s)}e.focus(),e.selectionStart=t,e.selectionEnd=i}else{var r=this.createSelectionRange();this.setSelectionValues(r,e,t,a,i),this.setSelectionRange(r)}}},{key:"setSelectionRange",value:function(e){var t=window.getSelection();o.default.shouldLog(u.a.LogLevels.Selection)&&o.default.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof l&&(e=e.getNativeRange()),t.addRange(e)}},{key:"insertNode",value:function(e){var t=this._getSelectionRange();t&&t.insertNode(e)}},{key:"selectAfterNode",value:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var e=this._getSelectionRange();o.default.shouldLog(u.a.LogLevels.Selection)&&o.default.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()}},{key:"getSelectionRange",value:function(e){var t;return e&&(t=this._getSelectionRange()),new l(t)}},{key:"_getSelectionRange",value:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}},{key:"getSelectionNode",value:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var e=window.getSelection();o.default.shouldLog(u.a.LogLevels.Selection)&&o.default.log("Clear Selection"),e.removeAllRanges()}},{key:"hasSelection",value:function(){var e=this._getSelectionRange();return!(!e||e.startContainer===document.documentElement)&&(o.default.getPaneForElement(e.startContainer)&&o.default.findParent(e.startContainer,"paneContent"))}},{key:"hasRawSelection",value:function(){return!!window.getSelection().anchorNode}},{key:"getCursorSelectionRange",value:function(e){var t,a=e.target,i=o.default.ensureDOMNode(e.target);if(i){var n=o.default.getElementParent(a),r=0,s=o.default.getItemForElement(a),d=o.default.getPaneObjectForElement(a);try{o.default.PAssert(504,n,"getCursorSelectionRange must only be called when hovered item is item",i)}catch(p){o.default.reportError(p)}o.default.findParent(a,"line")||(i=n.firstElementChild,r=u.a.LineLeftPad+(!d.isBlockHeader&&s.hasPrefix()?u.a.PrefixWidth:0));var c=i.getBoundingClientRect(),h=o.default.clamp(e.clientY,c.top+9,c.bottom-9),f=o.default.clamp(e.clientX,c.left+r,c.right-1);t=this._getCursorSelectionRange(f,h)}return t?new l(t):void 0}},{key:"_getCursorSelectionRange",value:function(e,t){var a;if(document.caretRangeFromPoint)a=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var i=document.caretPositionFromPoint(e,t);i&&((a=document.createRange()).setStart(i.offsetNode,i.offset),a.setEnd(i.offsetNode,i.offset))}else if(document.body.createTextRange){var n=this._getSelectionRange(),r=document.body.createTextRange();try{r.moveToPoint(e,t),r.select(),a=this._getSelectionRange(),this.setSelectionRange(n)}catch(s){}}else try{o.default.PAssert(505,!1,"Unable to get selection range at cursor")}catch(l){o.default.reportError(l)}return a}},{key:"_getPreviousComponentNode",value:function(e){var t=e.previousSibling;return t&&!this._isComponentNode(t)&&1===t.childNodes.length&&this._isComponentNode(t.childNodes[0])&&(t=t.childNodes[0]),t}},{key:"_ensureSelectionInElement",value:function(e,t){try{o.default.PAssert(506,e,"Must have a valid element")}catch(d){o.default.reportError(d)}try{o.default.PAssert(507,t,"Must have a valid range")}catch(d){o.default.reportError(d)}if(o.default.isAncestor(t.startContainer,e)||t.setStart(e,0),o.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),o.default.hasClass(t.startContainer,"textSelected")&&t.setStart(t.startContainer.parentElement.firstElementChild,t.startContainer.textContent.length),o.default.hasClass(t.endContainer,"textSelected")&&t.setEnd(t.endContainer.parentElement.firstElementChild,t.endContainer.textContent.length),o.default.hasClass(t.startContainer,"itemIgnoreText")){var a=this._getPreviousComponentNode(t.startContainer);a&&t.setStart(a,a.textContent.length)}if(o.default.hasClass(t.endContainer,"itemIgnoreText")){var i=this._getPreviousComponentNode(t.endContainer);i&&t.setEnd(i,i.textContent.length)}var n=o.default.getPluginForElement(t.startContainer);if(n){var r=n.textContent.length;!(l=n.nodeType===Node.TEXT_NODE)&&0===t.startOffset||l&&t.startOffset<r/2?t.setStartBefore(n):t.setStartAfter(n)}var s=o.default.getPluginForElement(t.endContainer);if(s){var l,u=s.textContent.length;!(l=s.nodeType===Node.TEXT_NODE)&&0===t.endOffset||l&&t.endOffset<u/2?t.setEndBefore(s):t.setEndAfter(s)}}},{key:"getSelectOffsetsInElement",value:function(e,t){var a={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){a.start=e.selectionStart,a.end=e.selectionEnd,a.total=e.value.length;var i=e.value.indexOf("\n");i>=0&&a.start>i&&(a.start--,a.end--,a.total--)}else if(e){try{o.default.PAssert(508,t,"Must provide a valid range")}catch(p){o.default.reportError(p)}if(t){this._ensureSelectionInElement(e,t);var n=this._getComponentNode(t.startContainer),r=t.startOffset,s=this._getComponentNode(t.endContainer),l=t.endOffset;!n||n.textContent!==u.a.TextSpace&&0!==n.textContent.length||(r=0),!s||s.textContent!==u.a.TextSpace&&0!==s.textContent.length||(l=0);var d=0,c=this._getComponentNodesIn(e);if(c.length>0)for(var h=0,f=0;f<c.length;++f){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;c[f]===n&&(a.start=d+r),c[f]===s&&(a.end=d+l),d+=this._getComponentNodeLength(c[f]),void 0===s&&(f===l-1?a.end=d:0===f&&0===l&&(a.end=0)),void 0===n&&(f===r-1?a.start=d:0===f&&0===r&&(a.start=0))}else a.start=0,a.end=0;a.total=d,isNaN(a.end)&&(a.end=d),a.start>a.total&&(a.start=a.total),a.end>a.total&&(a.end=a.total)}}try{o.default.PAssert(509,!isNaN(a.start)&&!isNaN(a.end),"Must have valid start and end",a)}catch(p){o.default.reportError(p)}return a}},{key:"getSelectOffsetsForMouseEvent",value:function(e){var t=o.default.getElementParent(e.target),a=this.getCursorSelectionRange(e);return a&&a.getSelectOffsetsInElement(t)}},{key:"getOffsetChildElement",value:function(e,t){try{o.default.PAssert(510,e,"Must supply a valid element")}catch(l){o.default.reportError(l)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{o.default.PAssert(512,this._isComponentSelectable(e),"Component must be selectable")}catch(l){o.default.reportError(l)}return{element:e,offset:t}}for(var a=0,i=0,n=this._getComponentNodesIn(e),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._getComponentNodeLength(n[r]);if(i+s>=t)return{element:n[r],offset:t-i};i+=s}try{o.default.PAssert(511,!1,"Unable to find offset child element")}catch(l){o.default.reportError(l)}}},{key:"getChildNodeOffset",value:function(e){var t=0;try{o.default.PAssert(513,e,"Must supply a valid child element")}catch(s){o.default.reportError(s)}for(var a=0,i=this._getComponentNodesIn(o.default.getElementParent(e)),n=this._getComponentNodesIn(e),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(i[r]===n[0])break;a+=this._getComponentNodeLength(i[r])}return a}},{key:"_getComponentNodeLength",value:function(e){try{o.default.PAssert(514,this._isComponentNode(e),"Supplied node must be a valid component")}catch(t){o.default.reportError(t)}return o.default.hasClass(e,"plugin")?1:o.default.hasClass(e,"mdImageWrapper")?0:1===e.length&&e.textContent===u.a.TextSpace?0:e.length}},{key:"_getComponentNodesIn",value:function(e){if(this._isComponentNode(e))return[e];var t=[];return this._getComponentNodes(t,e),t}},{key:"_isComponentNode",value:function(e){var t=!1;return e&&(e.nodeType===Node.TEXT_NODE&&!o.default.getPluginForElement(e)||o.default.hasClass(e,"plugin")||o.default.hasClass(e,"mdImageWrapper"))&&(t=!0),t}},{key:"_isComponentSelectable",value:function(e){try{o.default.PAssert(515,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(a){o.default.reportError(a)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}},{key:"_getComponentNodes",value:function(e,t){if(t)if(this._isComponentNode(t))e.push(t);else if(!o.default.hasClass(t,"itemTime")&&t.childNodes)for(var a=0,i=0;i<t.childNodes.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t.childNodes[i];this._getComponentNodes(e,n)}}},{key:"_getComponentNode",value:function(e){var t;if(this._isComponentNode(e))t=e;else{var a=o.default.getPluginForElement(e);a&&(t=a)}return t}},{key:"setSelectionValues",value:function(e,t,a,i,n){try{o.default.PAssert(516,e,"Range must be supplied")}catch(r){o.default.reportError(r)}try{o.default.PAssert(517,this._isComponentNode(t),"Must be selecting a valid component")}catch(r){o.default.reportError(r)}try{o.default.PAssert(518,this._isComponentNode(i),"Must be selecting a valid component")}catch(r){o.default.reportError(r)}try{o.default.PAssert(519,t!==i||a<=n,"Select elements must be different, or selection must start before it ends")}catch(r){o.default.reportError(r)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,a);else{try{o.default.PAssert(520,o.default.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(r){o.default.reportError(r)}try{o.default.PAssert(521,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(r){o.default.reportError(r)}0===a?this._selectBeforeComponent(e,t,"setStart"):1===a&&this._selectAfterComponent(e,t,"setStart")}if(i.nodeType===Node.TEXT_NODE)e.setEnd(i,n);else{try{o.default.PAssert(522,o.default.hasClass(i,"plugin"),"Only other valid component is plugin")}catch(r){o.default.reportError(r)}try{o.default.PAssert(523,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(r){o.default.reportError(r)}0===n?this._selectBeforeComponent(e,i,"setEnd"):1===n&&this._selectAfterComponent(e,i,"setEnd")}o.default.shouldLog(u.a.LogLevels.Selection)&&o.default.log("Set Selection: ["+a+","+n+"] - [",t+","+i+"]")}},{key:"_selectBeforeComponent",value:function(e,t,a){var i=this._getPrevComponent(t);if(this._isComponentSelectable(i))e[a](i,this._getComponentNodeLength(i));else{var n=document.createTextNode("");t.parentNode.insertBefore(n,t),e[a](n,0)}}},{key:"_selectAfterComponent",value:function(e,t,a){var i=this._getNextComponent(t);if(this._isComponentSelectable(i))e[a](i,0);else{var n=document.createTextNode("");t.parentNode.insertBefore(n,void 0),e[a](n,0)}}},{key:"_getPrevComponent",value:function(e){try{o.default.PAssert(524,e,"Must supply a valid node")}catch(a){o.default.reportError(a)}try{o.default.PAssert(525,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){o.default.reportError(a)}var t=e.previousSibling;try{o.default.PAssert(526,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){o.default.reportError(a)}return t}},{key:"_getNextComponent",value:function(e){try{o.default.PAssert(527,e,"Must supply a valid node")}catch(a){o.default.reportError(a)}try{o.default.PAssert(528,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){o.default.reportError(a)}var t=e.nextSibling;try{o.default.PAssert(529,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){o.default.reportError(a)}return t}},{key:"selectElement",value:function(e,t,a){var i;if(isNaN(a)&&(a=t),isNaN(t))(i=this.createSelectionRange()).selectNodeContents(e);else{var n=this.getOffsetChildElement(e,t),r=t!==a?this.getOffsetChildElement(e,a):n;n&&(i=this.createFakeRange(n.element,n.offset,r.element,r.offset))}i&&this.setSelectionRange(i)}},{key:"getSelectionInElement",value:function(e){var t=this._getSelectionRange();if(t&&o.default.isAncestor(t.startContainer,e)&&o.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}},{key:"deleteRangeContents",value:function(){var e=this._getSelectionRange();e&&e.deleteContents()}}]),e}();t.default=new d},28:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(3),y=a(0),k=a(1),_=function(){function e(){l()(this,e),this.onAuthedCallbacks=[]}return d()(e,[{key:"getScopes",value:function(){return[k.a.GScope.UserInfoEmail,k.a.GScope.UserInfoProfile]}},{key:"onSignInWithUser",value:function(e){var t=this;this.user=e,v.default.settings.onLoaded(function(){v.default.settings.userId.set(e.uid),v.default.settings.activeUser.set(e.email),v.default.settings.displayName.set(e.displayName);try{y.default.PAssert(123,e.uid===t._getUid())}catch(a){y.default.reportError(a)}t.runAuthedCallbacks()})}},{key:"runAuthedCallbacks",value:function(){this.onAuthedCallbacks.length>0&&this.onAuthedCallbacks.forEach(function(e){return e()})}},{key:"getUserSync",value:function(){return this.user}},{key:"getUser",value:function(){var e=s()(n.a.mark(function e(){var t=this;return n.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.user){e.next=4;break}return e.abrupt("return",Promise.resolve(this.user));case 4:return e.abrupt("return",new Promise(function(e){t.onAuthedCallbacks.push(function(){e(t.user)})}));case 5:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onAuthed",value:function(e){this.user?e():this.onAuthedCallbacks.push(e)}},{key:"onActiveUser",value:function(e){v.default.settings.activeUser.onHasValue(e)}},{key:"getAccountName",value:function(){return y.default.isDemoMode()?"Demo User":v.default.settings.displayName.get()}},{key:"getDefaultAccountID",value:function(){return y.default.isDemoMode()?"demoemail@moo.do":v.default.settings.activeUser.get()}},{key:"getUid",value:function(){return v.default.settings.userId.get()}},{key:"getEncryptionUid",value:function(){return v.default.settings.userId.get()}}]),e}(),S=a(51),P=function(e){function t(){return l()(this,t),h()(this,p()(t).call(this))}return m()(t,e),d()(t,[{key:"init",value:function(){var e=this,t={clientId:k.a.ClientID,apiKey:k.a.APIKey,authDomain:k.a.APIBaseURL,databaseURL:"https://".concat(k.a.FirebaseProjectID,".firebaseio.com"),projectId:k.a.FirebaseProjectID,storageBucket:"".concat(k.a.FirebaseProjectID,".appspot.com"),messagingSenderId:k.a.FirebaseAppID,scopes:this.getScopes()};S.a.initializeApp(t),window.firebase=S.a,S.a.auth().onAuthStateChanged(function(t){t&&v.default.settings.activeUser.get()?e.onSignInWithUser(t):(v.default.settings.userId.set(void 0),v.default.settings.activeUser.set(void 0),v.default.settings.displayName.set(void 0))}),this._isOnline=navigator.onLine,window.addEventListener("online",function(){e._isOnline=navigator.onLine})}},{key:"signIn",value:function(){var e=this;this._isSigningIn=!0;var t=new S.a.auth.GoogleAuthProvider,a=this.getScopes();t.setCustomParameters({prompt:"select_account"}),a.forEach(function(e){t.addScope(e)}),S.a.auth().signInWithPopup(t).then(function(t){t.additionalUserInfo&&(e.userProfile=t.additionalUserInfo.profile);try{y.default.PAssert(5,t.user,"Somehow signed in without a valid user")}catch(a){y.default.reportError(a)}t.user&&e.onSignInWithUser(t.user)}).catch(function(e){if("auth/popup-closed-by-user"===e.code)v.default.setup.popupClosedError.set({message:"Error signing in. Please try again."});else if("auth/network-request-failed"===e.code)v.default.setup.popupClosedError.set({message:"Connection error. Please try again."});else if("auth/web-storage-unsupported"===e.code){try{y.default.PAssert(6,!1,"Still getting web-storage-unsupported error")}catch(t){y.default.reportError(t)}v.default.setup.popupClosedError.set({message:"There may be a configuration problem in your browser. Please contact support@moo.do and we can help you."})}else try{y.default.PAssert(7,!1,"Error on signin",e.code,e.message)}catch(t){y.default.reportError(t)}})}},{key:"_getUid",value:function(){return y.default.isDemoMode()?"demouid":S.a.auth().getUid()}},{key:"signOut",value:function(){var e=s()(n.a.mark(function e(){return n.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return v.default.settings.activeUser.set(void 0),e.abrupt("return",S.a.auth().signOut());case 2:case"end":return e.stop()}}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"isOnline",value:function(){return navigator.onLine}}]),t}(_);t.a=new P},29:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(11),f=a.n(h),p=a(13),g=a.n(p),m=a(14),v=a(0),y=a(1),k=(i=function(){function e(t,a){r()(this,e),this._batchConstructor=t,this._batchParams=a,this._batchedRequests={},this._successCB=v.default.emptyFn,this._failureCB=v.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=v.default.generateTempId()}return o()(e,[{key:"add",value:function(e,t,a){try{v.default.PAssert(666,e,"Must provide a valid request to add to batch")}catch(n){v.default.reportError(n)}try{v.default.PAssert(667,t,"Must supply a valid group ID when adding to a batch")}catch(n){v.default.reportError(n)}try{v.default.PAssert(668,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(n){v.default.reportError(n)}var i=this._ensureGroup(t);return this._addRequestToGroup(t,a,e),i}},{key:"then",value:function(e,t,a){this._successCB=e||v.default.newEmptyFn(),this._failureCB=t||v.default.newEmptyFn(),this._context=a,this._run()}},{key:"execute",value:function(e){this._successCB=e,this._failureCB=e,this._run()}},{key:"getBatchID",value:function(){return this._batchID}},{key:"_ensureGroup",value:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t}},{key:"_addRequestToGroup",value:function(e,t,a){var i=this._getGroupBatch(e),n=this._getGroupSize(e);try{v.default.PAssert(669,n<=y.a.MaxBatchSize,"Too many requests for a single batch")}catch(r){v.default.reportError(r)}t?i.add(a,{id:t}):i.add(a)}},{key:"_getGroupBatch",value:function(e){try{v.default.PAssert(670,this._batchedRequests[e],"Must ensure before querying")}catch(t){v.default.reportError(t)}return this._batchedRequests[e].batch}},{key:"_getGroupSize",value:function(e){try{v.default.PAssert(671,this._batchedRequests[e],"Must ensure before querying")}catch(t){v.default.reportError(t)}return this._batchedRequests[e].size}},{key:"_run",value:function(){try{v.default.PAssert(672,!this._hasRun,"Should never run a batch twice")}catch(t){v.default.reportError(t)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess,this._handleFailure)}}},{key:"_createBatchInternal",value:function(){return new this._batchConstructor(this._batchParams)}},{key:"_handleSuccess",value:function(e){try{v.default.PAssert(673,this._hasRun,"Must run batch before success")}catch(t){v.default.reportError(t)}this._successCB.call(this._context,e)}},{key:"_handleFailure",value:function(e){try{v.default.PAssert(674,this._hasRun,"Must run batch before failure")}catch(t){v.default.reportError(t)}this._failureCB.call(this._context,e)}}]),e}(),g()(i.prototype,"_handleSuccess",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleSuccess"),i.prototype),g()(i.prototype,"_handleFailure",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"_handleFailure"),i.prototype),i),_=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return f()(t,e),o()(t,[{key:"_sendRequest",value:function(e){var t;try{v.default.PAssert(539,window.gapi&&window.gapi.client,"Trying to make a request with no gapi")}catch(a){v.default.reportError(a)}return window.gapi&&window.gapi.client&&(t=window.gapi.client.request(e)),t}},{key:"createBatch",value:function(e){return new k(window.gapi.client.newBatch,e)}}]),t}(function(){function e(){r()(this,e),this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}return o()(e,[{key:"fns",value:function(e){return this._data.gapi.client[e]}},{key:"_iterateAPI",value:function(e,t){if(v.default.isString(e.path))e.packedFn||(v.default.log("WARNING: Missing Pre-Packed Fn: [ '"+t.join("', '")+"' ]"),e.packedFn=t.slice(0));else for(var a in e)v.default.isObject(e[a])&&(t.push(a),this._iterateAPI(e[a],t),t.pop())}},{key:"_constructPath",value:function(e,t){var a=v.default.clone(t);return Object.keys(t).forEach(function(i){var n=new RegExp("\\{"+i+"\\}"),r=e.replace(n,encodeURIComponent(t[i]));r!==e&&delete a[i],e=r}),delete a.resource,delete a.timeoutMS,delete a.forceNoDupe,{path:e,fields:a}}},{key:"_constructHeaders",value:function(e,t,a){try{v.default.PAssert(692,t||a,"Must have either accountID or token")}catch(n){v.default.reportError(n)}try{v.default.PAssert(693,a||v.default.isDemoMode(),"Should have a token at this point")}catch(n){v.default.reportError(n)}var i={Authorization:a?"Bearer "+a.access_token:void 0};return e&&Object.keys(e).forEach(function(t){i[t]=e[t]}),i}},{key:"canConstruct",value:function(e){var t=!1;return v.default.isFunction(e)||(t=!!v.default.unpackFn(e,this._data)),t}},{key:"createRequest",value:function(e,t,a,i){var n,r=v.default.unpackFn(t,this._data);try{v.default.PAssert(694,r,"Function should always be unpackable")}catch(u){v.default.reportError(u)}if(r){var s=this._constructPath(r.path,a),o=this._constructHeaders(r.headers,e,i),l={path:s.path,method:r.method||"GET",params:s.fields,body:a.resource,headers:o};v.default.isDemoMode()&&(l.__packedFn=t,l.__rawParams=a),n=this._sendRequest(l)}return n}},{key:"getAPIForRequest",value:function(e){try{v.default.PAssert(695,v.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(t){v.default.reportError(t)}return v.default.unpackFn(e.__packedFn)}}]),e}());t.a=new _},3:function(e,t,a){"use strict";a.r(t);var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(25),f=a.n(h),p=a(11),g=a.n(p),m=a(0),v=a(1),y=a(195),k=a(24),_=a(17),S=function(){function e(){r()(this,e),this._localized=[],this._loadedDateFormat=void 0}return o()(e,[{key:"init",value:function(){var e=this,t=sr.settings.dateFormat.get()||v.a.DateFormat.MDY;this._loadLocalized(t),sr.settings.dateFormat.listen(function(t){e._loadLocalized(t||v.a.DateFormat.MDY),_.a.parseAll(v.a.ChangeType.Auto),k.a.fireEvent("clearMeasureCacheAll",[]),sr.PaneUpdateBatcher.updateAllItems(!1,!0)})}},{key:"parseDate",value:function(e,t){return Date.parse(this.normalizeDateString(e,t))}},{key:"parseDateDefaultFormat",value:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(e){try{m.default.PAssert(312,this._localized[e],"Invalid format request")}catch(t){m.default.reportError(t)}return this._localized[e]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||v.a.DateFormat.MDY}},{key:"_loadLocalized",value:function(e){if(this._loadedDateFormat=e,this._localized[v.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[v.a.DFormat.ShortTime]="h:mm tt",this._localized[v.a.DFormat.MonthDay]="MMM d",this._localized[v.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[v.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[v.a.DFormat.MonthDayLong]="MMMM d",this._localized[v.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===v.a.DateFormat.MDY)this._localized[v.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[v.a.DFormat.ShortDate]="MM/dd",this._localized[v.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[v.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[v.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[v.a.DFormat.DayDate]="ddd M/d",this._localized[v.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[v.a.DFormat.MonthDayShort]="M/d";else if(e===v.a.DateFormat.DMY)this._localized[v.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[v.a.DFormat.ShortDate]="dd/MM",this._localized[v.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[v.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[v.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[v.a.DFormat.DayDate]="ddd d/M",this._localized[v.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[v.a.DFormat.MonthDayShort]="d/M";else if(e===v.a.DateFormat.DMYDot)this._localized[v.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[v.a.DFormat.ShortDate]="dd.MM",this._localized[v.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[v.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[v.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[v.a.DFormat.DayDate]="ddd d.M",this._localized[v.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[v.a.DFormat.MonthDayShort]="d.M";else if(e===v.a.DateFormat.YMD)this._localized[v.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[v.a.DFormat.ShortDate]="MM/dd",this._localized[v.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[v.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[v.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[v.a.DFormat.DayDate]="ddd M/d",this._localized[v.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[v.a.DFormat.MonthDayShort]="M/d";else if(e===v.a.DateFormat.YMDDot)this._localized[v.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[v.a.DFormat.ShortDate]="MM.dd",this._localized[v.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[v.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[v.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[v.a.DFormat.DayDate]="ddd M.d",this._localized[v.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[v.a.DFormat.MonthDayShort]="M.d";else try{m.default.PAssert(313,!1,"Unsupport date format requested: "+e)}catch(t){m.default.reportError(t)}}},{key:"formatDate",value:function(e,t,a){try{m.default.PAssert(314,m.default.isDateValid(e),"Must provide a valid date to format")}catch(r){m.default.reportError(r)}try{m.default.PAssert(315,t,"Must provide a valid format for the date")}catch(r){m.default.reportError(r)}var i;if(m.default.isDateValid(e)){var n=e.toString(this.getFormat(t));i=a&&a!==this._loadedDateFormat?this.convertDateFormat(n,this._loadedDateFormat,a):n}return i}},{key:"_isParsedDateValid",value:function(e,t,a){var i=!0,n=m.default.parseInt(e),r=m.default.parseInt(t),s=m.default.parseInt(a);return void 0!==e&&n<13?i=!1:r<=0||r>12?i=!1:(s<=0||s>31)&&(i=!1),i}},{key:"_detectDelim",value:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}},{key:"convertDateFormat",value:function(e,t,a){try{m.default.PAssert(316,t,"Must provide a date format to convert from")}catch(h){m.default.reportError(h)}try{m.default.PAssert(317,a,"Must provide a date format to convert to")}catch(h){m.default.reportError(h)}var i=e;if(t!==a){var n,r,s=0;for(w.lastIndex=0,P.lastIndex=0,n=t===v.a.DateFormat.YMD||t===v.a.DateFormat.YMDDot?w:P;null!==(r=n.exec(i));){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var o,l,u,d,c=this._detectDelim(i);if(t===v.a.DateFormat.DMYDot?t=v.a.DateFormat.DMY:t===v.a.DateFormat.YMDDot&&(t=v.a.DateFormat.YMD),a===v.a.DateFormat.MDY)switch(t){case v.a.DateFormat.DMY:r[4]?(l=r[4],o=(u=r[3])+c+(d=r[2])+c+l):r[2]&&r[3]&&(o=(u=r[3])+c+(d=r[2]));break;case v.a.DateFormat.YMD:r[2]?(l=r[2],o=(u=r[3])+c+(d=r[4])+c+l):r[3]&&r[4]&&(o=(u=r[3])+c+(d=r[4]));break;default:try{m.default.PAssert(318,!1,"Invalid date format requested from MDY: ",t)}catch(h){m.default.reportError(h)}}else if(a===v.a.DateFormat.DMY)switch(t){case v.a.DateFormat.MDY:r[4]?(l=r[4],u=r[2],o=(d=r[3])+c+u+c+l):r[2]&&r[3]&&(u=r[2],o=(d=r[3])+c+u);break;case v.a.DateFormat.YMD:r[2]?(l=r[2],u=r[3],o=(d=r[4])+c+u+c+l):r[3]&&r[4]&&(u=r[3],o=(d=r[4])+c+u);break;default:try{m.default.PAssert(319,!1,"Invalid date format requested from DMY: ",t)}catch(h){m.default.reportError(h)}}else if(a===v.a.DateFormat.YMD)switch(t){case v.a.DateFormat.MDY:r[4]?o=(l=r[4])+c+(u=r[2])+c+(d=r[3]):r[2]&&r[3]&&(o=(u=r[2])+c+(d=r[3]));break;case v.a.DateFormat.DMY:r[4]?o=(l=r[4])+c+(u=r[3])+c+(d=r[2]):r[2]&&r[3]&&(o=(u=r[3])+c+(d=r[2]));break;default:try{m.default.PAssert(320,!1,"Invalid date format requested from YMD: ",t)}catch(h){m.default.reportError(h)}}else try{m.default.PAssert(321,!1,"Invalid date format requested: ",a)}catch(h){m.default.reportError(h)}o&&this._isParsedDateValid(l,u,d)&&(i=i.substr(0,r.index)+r[1]+o+i.substr(r.index+r[0].length))}}return i}},{key:"normalizeDateString",value:function(e,t){var a=e;return this.convertDateFormat(a,t,v.a.DateFormat.MDY)}},{key:"getAppendDateText",value:function(e,t,a){var i,n=Date.today();i=e<n||e.getFullYear()!==n.getFullYear()?this.getFormat(v.a.DFormat.MonthDayYearShort):this.getFormat(v.a.DFormat.MonthDayShort);var r=e.toString(i);if(t instanceof Date)i=0===t.getMinutes()?" htt":" h:mmtt",r+=t.toString(i);else if(m.default.isNumber(t)){var s=Math.floor(t),o=s%12;0===o&&(o=12),r+=" "+o+":"+m.default.pad2(60*(t-s))+(s>11?"pm":"am")}return isNaN(a)||(r+=" "+m.default.round(a,2)+"hr"),r}}]),e}(),P=/([\s]|^)(\d{1,2})[-\/.](\d{1,2})(?:[-\/.](\d{2,4}))?/g,w=/([\s]|^)(?:(\d{2,4})[-\/.])?(\d{1,2})(?:[-\/.](\d{1,2}))/g,I=S,b=a(13),D=a.n(b),E=a(77),C=a(14),A=(i=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this))).styles={},e.stylesheet={},e.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},e.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,Colors:{light:{bulletColor:"#222222",projectColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",projectColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},e.timeoutSettingChanged=void 0,e}return g()(t,e),o()(t,[{key:"init",value:function(){this.updateSettingValues(),sr.settings.ui.listen(this.onSettingChanged),this.updateStyles()}},{key:"getSettingValue",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=sr.settings.ui[e].get();return t===this.Defaults.Desktop.Colors.light[e]?this.Defaults.Desktop.Colors[this._colorTheme][e]:t}},{key:"getThemeValue",value:function(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=this.Defaults.Desktop[e]),void 0===t&&(t=this.Defaults.Desktop.Colors[this._colorTheme][e]),t}},{key:"setFromThemeValue",value:function(e,t){sr.settings.ui[t].set(this.getThemeValue(t))}},{key:"updateSettingValues",value:function(){this._colorTheme=sr.settings.ui.theme.get()||"Light",this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._projectColor=this.Defaults.Desktop.Colors[this._colorTheme].projectColor,this._verticalLinesColor=this.Defaults.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders=this.getSettingValue("boldHeaders"),this._showVerticalLines=this.getSettingValue("showVerticalLines"),this._fontSize=this.getSettingValue("fontSize",!0),this._fontSizeHeader=this.getSettingValue("fontSizeHeader",!0),this._fontSizeHeaderTopLevel=this.getSettingValue("fontSizeHeaderTopLevel",!0),this._noteFontSize=this.getSettingValue("noteFontSize",!0),this._itemPadding=this.getSettingValue("itemPadding",!0),this._notePadding=this.getSettingValue("notePadding",!0),this._itemLineHeight=this.getSettingValue("itemLineHeight",!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue("itemIndentSize",!0),this._bulletOpacity=this.getSettingValue("bulletOpacity",!0),this._projectOpacity=this.getSettingValue("projectOpacity",!0),this._checkboxOpacity=this.getSettingValue("checkboxOpacity",!0),this._checkboxBackgroundOpacity=this.getSettingValue("checkboxBackgroundOpacity",!0),this._verticalLinesOpacity=this.getSettingValue("verticalLinesOpacity",!0),this._tagColor=this.getSettingValue("tagColor",!0),this._dateColor=this.getSettingValue("dateColor",!0),this._contactColor=this.getSettingValue("contactColor",!0),this._linkColor=this.getSettingValue("linkColor",!0),this._grayscale=this.getSettingValue("grayscale"),this._cursorBlink=this.getSettingValue("linkColor",!0)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var e=this._fontSize,t=this._fontSizeHeader,a=this._fontSizeHeaderTopLevel,i=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var n=this._fontSize!==e||this._fontSizeHeader!==t||this._fontSizeHeaderTopLevel!==a||this._noteFontSize!==i;this.fireEvent("settingsChanged",[n]),sr.PaneManager&&sr.PaneManager.clearPaneCaches(),this.updateStyles(),sr.PaneUpdateBatcher.updateAllItems(!1,!0)}},{key:"fontSize",value:function(){return this._fontSize}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize}},{key:"itemPadding",value:function(){return this._itemPadding}},{key:"notePadding",value:function(){return this._notePadding}},{key:"itemLineHeight",value:function(){return this._itemLineHeight}},{key:"noteLineHeight",value:function(){return this._noteLineHeight}},{key:"itemIndentSize",value:function(){return this._itemIndentSize}},{key:"itemIndentStart",value:function(){return 45}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(e,t,a){return t.hasNote()?a&&a.isViewProject()&&a.isItemTopLevel(e,t)?this.itemPadding():0:this.itemPadding()}},{key:"paddingForItemTop",value:function(e,t){return t.isNote()?this.notePadding():this.itemPadding()}},{key:"fontSizeForItem",value:function(e,t,a){if(t.isPrefixHeader()){if(a.isItemTopLevel(e,t))return this.fontSizeHeaderTopLevel();if(a.isViewOutline())return this.fontSizeHeader()}else if(t.isNote())return this.noteFontSize();return this.fontSize()}},{key:"lineHeightForItem",value:function(e,t,a){var i=this.itemLineHeight()-this.fontSize();return t.isNote()?this.noteLineHeight():this.fontSizeForItem(e,t,a)+i}},{key:"boldHeaders",value:function(){return this._boldHeaders}},{key:"createSheet",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}},{key:"changeColorTheme",value:function(e){e!==this._colorTheme&&(this._colorTheme=e,sr.settings.ui.theme.set(e),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(e,t){this.isChangingTheme=!0;var a=this.Themes[t];for(var i in a)a.hasOwnProperty(i)&&sr.settings.ui[i].set(a[i]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}this.createSheet();var a=[];if(this.boldHeaders()&&a.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var i=this.itemIndentSize(),n=this._verticalLinesColor,r="rgba("+n+","+n+","+n+",",s=r+.01*this._verticalLinesOpacity+")",o=r+"0)";a.push(".vertLines { background: repeating-linear-gradient(to right, "+o+" 0, "+s+" 1px, "+o+" 2px, "+o+" "+i+"px) }")}a.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),a.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),a.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }");var l="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._bulletOpacity+")";a.push(".prefixBullet:before { color: "+l+"; }");var u="rgba("+m.default.hexToRgbStr(this._projectColor)+","+.01*this._projectOpacity+")";a.push(".prefixHeader:before { color: "+u+"; }"),a.push(".collapser { color: "+l+"; }");var d="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";a.push(".prefixTask { border-color: "+d+"; }");var c="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";a.push(".prefixTask:not(.searchButton):before { background-color: "+c+"; }"),a.push(".c-tag { color: "+this._tagColor+";}"),a.push(".c-date { color: "+this._dateColor+";}"),a.push(".c-contact { color: "+this._contactColor+";}"),a.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),a.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }"),sr.settings.ui.underlineP.get()?m.default.addClass(document.body,"underlineTags"):m.default.removeClass(document.body,"underlineTags"),this._grayscale?m.default.addClass(document.body,"grayscale"):m.default.removeClass(document.body,"grayscale"),m.default.removeClass(document.body,"theme-light"),m.default.removeClass(document.body,"theme-dark"),m.default.addClass(document.body,"theme-"+this._colorTheme);for(var h=0;h<a.length;h++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(a[h],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"lineItemHeight",value:function(e,t,a,i){return m.default.isNumber(i)&&!t.isNote()||(i=1),this.paddingForItemTop(e,t)+this.paddingForItemBottom(e,t,a)+this.lineHeightForItem(e,t,a)*i}}]),t}(E.a),D()(i.prototype,"onSettingChanged",[C.a],Object.getOwnPropertyDescriptor(i.prototype,"onSettingChanged"),i.prototype),D()(i.prototype,"_updateSettings",[C.a],Object.getOwnPropertyDescriptor(i.prototype,"_updateSettings"),i.prototype),D()(i.prototype,"updateStyles",[C.a],Object.getOwnPropertyDescriptor(i.prototype,"updateStyles"),i.prototype),i),M=a(56),T=a.n(M),L=a(23),x=a(7),R=a(4),O=a(34),F=a(8),N=a(53),B=a(58),U=a(61),V=a(50),H=a(37),j=a(60),z=a(15),q=a(42),W=a(49);function G(){this._favMap={}}G.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var a=this._ensureGroup(t);try{m.default.PAssert(1170,a.indexOf(e)<0,"Should not double add item to group")}catch(i){m.default.reportError(i)}a.push(e)},notifyRemove:function(e,t){var a=this._ensureGroup(t);try{m.default.PAssert(1171,a.indexOf(e)>=0,"Must have been added to group before removing")}catch(i){m.default.reportError(i)}a.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};var K,Y=new G,X=a(64),Q=new Date(9e12),J=(K=function(){function e(t,a){r()(this,e),L.a.binder(this,"sizeInPane","onInsertLink"),"dragScroll"in this&&L.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{m.default.PAssert(848,a,"Each VMLI must be given a set of additional info")}catch(n){m.default.reportError(n)}try{m.default.PAssert(849,m.default.isValidChangeType(a.changeType),"Must specify a valid change type when creating a VMLI")}catch(n){m.default.reportError(n)}try{m.default.PAssert(850,a.store,"Must supply a valid itemStore for each VMLI")}catch(n){m.default.reportError(n)}try{m.default.PAssert(851,!a.parent||a.parent._store===a.store,"All VMLIs in a tree must share the same owner")}catch(n){m.default.reportError(n)}this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1;try{m.default.PAssert(852,void 0===t.v,"We should never be passing in 'v'")}catch(n){m.default.reportError(n)}try{m.default.PAssert(853,void 0===t.extern,"We should never be passing in 'extern'")}catch(n){m.default.reportError(n)}try{m.default.PAssert(854,a.store,"Must specify a valid item store this item belongs to")}catch(n){m.default.reportError(n)}this._store=a.store,this._parent=a.parent,this._documentOwner=a.documentOwner,this._rawText=t.text||"",this._searchText=t.text?t.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this.id=void 0,this.index=t.index,this._isArchived=t.isArchived||!1,this.items=new q.a([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new W.a,this._demandLoadChildren=t.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=a.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new z.a;var i=t.flags;t.isNote&&(i|=v.a.VMLIFlag.Note),t.isComplete&&(i|=v.a.VMLIFlag.Complete),t.isStarred&&(i|=v.a.VMLIFlag.Starred),t.priority&&(i|=t.priority),this.flags=new z.a(i),this.prefix=void 0,this._favorites=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.dateModified=t.dateModified?new Date(t.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=t.isRoot||a.isRoot,this._isDeleted=t.isDeleted||!1,this.highlightTimeout=void 0,this._version=v.a.UninitializedVersion,this._versionText=v.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new z.a(a.isEditable||!1),this.levelsDeep=new z.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new z.a,m.default.totalItems++,t.isArchived&&m.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(t,a),this.isInitialized=!0}return o()(e,[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){try{m.default.PAssert(855,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){m.default.reportError(e)}return this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!(this.flags.get()&v.a.VMLIFlag.HasPageToken)}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(e){try{m.default.PAssert(856,e,"Should never be setting an undefined token - use clear instead")}catch(t){m.default.reportError(t)}try{m.default.PAssert(857,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){m.default.reportError(t)}this._paginationToken=e,this.setFlags(this.flags.get()|v.a.VMLIFlag.HasPageToken)}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~v.a.VMLIFlag.HasPageToken)}},{key:"beginDataPageLoad",value:function(){try{m.default.PAssert(859,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){m.default.reportError(e)}try{m.default.PAssert(860,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){m.default.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(e){try{m.default.PAssert(862,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){m.default.reportError(t)}try{m.default.PAssert(863,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){m.default.reportError(t)}e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~v.a.VMLIFlag.HasPageToken)}},{key:"notifyPaginationUpdate",value:function(){try{m.default.PAssert(864,this._paginationToken,"Must have a valid token to get next page of data")}catch(e){m.default.reportError(e)}this._paginationToken&&m.default.focusedPane.requestDataPage(this)}},{key:"canHaveNote",value:function(){var e=this.belongsToItemStore(sr.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(sr.itemStoreManager.getTempItemStore());return e||t}},{key:"createNote",value:function(){try{m.default.PAssert(865,!this.isNote(),"Should never create a note on a note item")}catch(t){m.default.reportError(t)}var e;return this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({id:void 0,text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:v.a.ChangeType.AllLocal}),this.setNote(e,v.a.ChangeType.Local)),e}},{key:"hasNote",value:function(){return void 0!==this._note}},{key:"getNote",value:function(){try{m.default.PAssert(866,this.hasNote(),"Must have a note to get one")}catch(e){m.default.reportError(e)}return this._note}},{key:"setNote",value:function(t,a){try{m.default.PAssert(867,m.default.isValidChangeType(a),"Must supply a valid changeType")}catch(n){m.default.reportError(n)}try{m.default.PAssert(868,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(n){m.default.reportError(n)}try{m.default.PAssert(869,!this.isNote(),"Should never set a note on a note")}catch(n){m.default.reportError(n)}try{m.default.PAssert(870,!this._note||!t,"Should never set a note multiple times on a single item")}catch(n){m.default.reportError(n)}try{m.default.PAssert(871,!t||t.isNote(),"Should only set items that are notes as notes")}catch(n){m.default.reportError(n)}try{m.default.PAssert(872,!t||!t.isDeleted(),"Should note set a deleted note")}catch(n){m.default.reportError(n)}try{m.default.PAssert(873,!t||t instanceof e,"Note must be a valid VMLI")}catch(n){m.default.reportError(n)}try{m.default.PAssert(874,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(n){m.default.reportError(n)}var i=this._note;this._note=t,this.shouldSave()&&(F.d.beginAction(),_.a.setNote(this,t,i,a),F.d.endAction()),k.a.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()}},{key:"isNote",value:function(e){if(void 0===e)return this._isFlagHelper(v.a.VMLIFlag.Note);if(e!==this._isFlagHelper(v.a.VMLIFlag.Note)){var t=e?this.flags.get()|v.a.VMLIFlag.Note:this.flags.get()&~v.a.VMLIFlag.Note;this.setFlags(t)}}},{key:"addFavorite",value:function(e,t){this._favorites||(this._favorites=[]);try{m.default.PAssert(875,this._favorites.indexOf(e)>=0,"Must not already be in the favorites group")}catch(i){m.default.reportError(i)}if(this._favorites.push(e),Y.notifyAdd(this,e),this.shouldSave()){var a={favorites:this._favorites};_.a.saveItem(this,a,t,v.a.SaveFlag.Prop)}}},{key:"removeFavorite",value:function(e,t){try{m.default.PAssert(876,this._favorites,"Must always have favorites defined before removing from item")}catch(i){m.default.reportError(i)}try{m.default.PAssert(877,this._favorites.indexOf(e)>=0,"Must already be in the favorites group")}catch(i){m.default.reportError(i)}if(this._favorites.remove(e),Y.notifyRemove(this,e),this.shouldSave()){var a={favorites:this._favorites};_.a.saveItem(this,a,t,v.a.SaveFlag.Prop)}}},{key:"setFavorites",value:function(e,t){for(var a=0,i=0,n=(e||[]).removeArray(this._favorites),r=(this._favorites||[]).removeArray(e),s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;Y.notifyRemove(this,r[s])}for(s=0;s<n.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;Y.notifyAdd(this,n[s])}if(this._favorites=e,this.shouldSave()){var o=0,l=[];for(s=0;s<e.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l[s]=m.default.clone(e[s])}var u={favorites:l};_.a.saveItem(this,u,t,v.a.SaveFlag.Prop)}}},{key:"getFavorites",value:function(){return this._favorites}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;try{m.default.PAssert(878,e&&e.getItem(),"Invalid pane")}catch(s){m.default.reportError(s)}if(this.isNote())return this.parent().getPadding(e,t,a);if(isNaN(a)){var i;if(t)i=1;else if(e.isSearchedFlat()){for(var n=0,r=this;r;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.search.isFlatSearchResult(r)){i=r.levelsDeep.get()-1;break}r=r.parent()}try{m.default.PAssert(879,!isNaN(i),"Item has no root depth",!!this.parent())}catch(s){m.default.reportError(s)}isNaN(i)&&(i=1)}else i=e.getItem().levelsDeep.get();a=this.levelsDeep.get()-i-(t?e.overviewPadLevels:1)}return this.getPaddingForLevel(a,e,t)}},{key:"getPaddingForLevel",value:function(e,t,a){var i;e=Math.max(e,0),i=a?v.a.OverviewPaddingStart+e*v.a.OverviewPaddingIncrement:sr.DisplaySettings.itemIndentStart()+e*sr.DisplaySettings.itemIndentSize();try{m.default.PAssert(880,m.default.isNumber(i),"Must have a valid padding")}catch(n){m.default.reportError(n)}return i}},{key:"_updateStylePadding",value:function(e,t){try{m.default.PAssert(881,this._parent,"Must have a valid parent to update padding, root should never change")}catch(o){m.default.reportError(o)}var a=e+(this.isNote()?0:1),i=this.levelsDeep.get()!==a;if(i||t){var n=0;i&&this.levelsDeep.set(a);for(var r=this.getItems(),s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[s]._updateStylePadding(a,t)}}}},{key:"setFlags",value:function(e){this.flags.set(e)}},{key:"getPriorityProps",value:function(){var e=this.flags.get();return v.a.PriorityClass[e&v.a.PMask]+" "}},{key:"styleProps",value:function(e,t){var a=this.flags.get(),i=this.isHeader()&&!t.isSearchedFlat()?"pHeader ":"";this.isPrefixHeader()?i+="itemHeader ":this.isPrefixTask()?i+="itemTask ":this.isPrefixBullet()?i+="itemBullet ":this.isPrefixNumList()&&(i+="itemNumList "),this.prefix&&(i+="hasPrefix "),t.isItemTopLevel(e,this)&&(i+="topLevel ");var n=!1;if(a&v.a.VMLIFlag.Complete?n=!0:!(a&v.a.VMLIFlag.Note)&&a&v.a.VMLIFlag.DisplayComplete&&(n=!0),n?(i+="pComplete ",t.search.isMatchStuckHiding(this)||(i+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):a&v.a.PMask?i+=v.a.PriorityClass[a&v.a.PMask]+" ":i+="pNormal ",a&v.a.VMLIFlag.Starred&&!(a&v.a.VMLIFlag.Complete||a&v.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star "),a&v.a.VMLIFlag.Note){i+="pNote c-foreground-faded ";var r=this.parent().flags.get();(r&v.a.VMLIFlag.Complete||r&v.a.VMLIFlag.DisplayComplete)&&(i+="pComplete c-foreground-super-faded c-before-super-faded "),r&v.a.PMask&&(i+=v.a.PriorityClass[r&v.a.PMask]+" "),r&v.a.VMLIFlag.Starred&&!(r&v.a.VMLIFlag.Complete||r&v.a.VMLIFlag.DisplayComplete)&&(i+="pStar c-star ")}var s=this.getAttachments();if(s)for(var o=0,l=0;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l];if(u.isLoaded()){var d=u.getPlugin().getCssClass(u,t);d&&(i+=d)}}return i}},{key:"onAttachmentIDChange",value:function(e,t){if(e.getPlugin().id===v.a.PluginID.GCalendar){var a=this.getMooDate();a&&(a.setGCalId(e.id),this.onMooDateUpdated(v.a.ChangeType.Local,!0))}this.setTextToWhatItAlreadyIs(v.a.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(e,t,a){var i=e.getPlugin();if(i===sr.pluginManager.getPluginGCalendar()){var n=this.getMooDate();if(n&&!n.getGCalCalendar()&&e.hasField("calendarID")){var r=e.getField("calendarID");if(n.setGCalCalendar(r),this.shouldSave()){var s={date:this._date?this._date.toData():null};_.a.saveItem(this,s,v.a.ChangeType.Local,v.a.SaveFlag.Text)}}}else i===sr.pluginManager.getPluginGmail()&&t&&t.includes("accountID")&&this.onAttachInlineUpdate();t&&e.fieldsHaveParseEffect(t)&&(k.a.fireEvent("clearMeasureCacheItem",[this.id]),this.parseText(this.getRawText(),a),V.a.beginBatch(this),V.a.itemTextChanged(this))}},{key:"setAttachments",value:function(e,t,a){var i=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var n=0,r=0,s=this._attachments,o=0;o<s.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.indexOf(s[o])<0&&(s[o].unsubscribe(this),s[o].notifyItemTextChanged(this,!0),this.shouldSave()&&s[o].markUnused(t),i=!0)}for(o=0;o<e.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[o];if(s.indexOf(l)<0){if(l.shouldBeDeleted()){var u=l.getEmbedString(),d=this.getRawText().replace(u,"File failed to upload");return void this.setText(d,v.a.ChangeType.Local)}l.subscribe(this),this.shouldSave()&&l.markInUse(t),i=!0}}i&&(this._attachments=e)}i&&!1!==a&&this.itemChanged.notify()}},{key:"getAttachment",value:function(e){try{m.default.PAssert(882,this._attachments,"Must have valid attachments in order to query")}catch(t){m.default.reportError(t)}if(this._attachments)return this._attachments[e]}},{key:"hasAttachment",value:function(e){if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].id===e)return!0}return!1}},{key:"hasPluginAttachment",value:function(e){try{m.default.PAssert(883,e,"Must provide a valid plugin type to query")}catch(i){m.default.reportError(i)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].getPlugin().id===e)return!0}return!1}},{key:"getAttachmentByType",value:function(e){try{m.default.PAssert(884,e,"Must provide a valid plugin type to query")}catch(n){m.default.reportError(n)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._attachments[a];if(i.isType(e))return i}}},{key:"getAttachmentByPlugin",value:function(e){try{m.default.PAssert(885,e,"Must provide a valid plugin type to query")}catch(n){m.default.reportError(n)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._attachments[a];if(i.isPlugin(e))return i}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(e){return sr.pluginManager.hasAttachmentType(this,e)}},{key:"copyProperties",value:function(e){this.setStarred(e.isStarred(),v.a.ChangeType.Auto),this.setComplete(e.isComplete(),v.a.ChangeType.Auto),this.setPriority(e.getPriority(),v.a.ChangeType.Auto)}},{key:"moveNote",value:function(e,t){try{m.default.PAssert(886,e.hasNote(),"Must have a note to move")}catch(i){m.default.reportError(i)}try{m.default.PAssert(887,!this.hasNote(),"Must not already have a note")}catch(i){m.default.reportError(i)}var a=e.getNote();e.setNote(void 0,t),a&&(a.setParent(this),this.setNote(a,t))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(e){var t=this._parent;return this._parent=e,e&&e!==t&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}},{key:"getParser",value:function(){var e,t=this.getItemStore();return t&&(e=t.getParser()),e}},{key:"requireStoredEls",value:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}},{key:"getItemStore",value:function(){try{m.default.PAssert(888,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){m.default.reportError(e)}return this._store}},{key:"belongsToSameItemStore",value:function(e){return this.getItemStore()===e.getItemStore()}},{key:"belongsToItemStore",value:function(e){return this.getItemStore()===e}},{key:"notifyItemPropertyChanged",value:function(e,t){if(this.hasAttachments())for(var a=0,i=this.getAttachments(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].notifyItemPropertyChanged(this,e,t)}}},{key:"unArchive",value:function(e){this._documentOwner.unArchiveItem(this,e)}},{key:"archiveSelf",value:function(e){this._documentOwner.archiveItem(this,e)}},{key:"isArchived",value:function(){return this._isArchived}},{key:"setArchived",value:function(e,t){this._isArchived=e}},{key:"isHidden",value:function(e){try{m.default.PAssert(889,e,"Must specify the pane for the item being checked")}catch(t){m.default.reportError(t)}try{m.default.PAssert(890,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(t){m.default.reportError(t)}return!(!e||!e.search)&&!e.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){try{m.default.PAssert(891,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){m.default.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}try{m.default.PAssert(892,void 0!==this._searchText,"Item should always have search text")}catch(a){m.default.reportError(a)}return this._searchText}},{key:"setRawText",value:function(e){void 0!==e&&null!==e||(e="");try{m.default.PAssert(893,e.indexOf(v.a.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){m.default.reportError(t)}this._rawText=e,this._searchText=this.generateSearchText(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(e){this._parsedText=e,this._needsParse=!1,this._searchText=this.generateSearchText()}},{key:"generateSearchText",value:function(){var e=this.getParsedTextWithoutPrefix().toLowerCase();return this.hasAttachments()?this._generateUsableText(e,"getTitleString").replace(/[\*_]/g,"").toLowerCase():e}},{key:"getPriority",value:function(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&v.a.PMask}},{key:"setPriority",value:function(e,t){try{m.default.PAssert(895,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(s){m.default.reportError(s)}try{m.default.PAssert(896,null===e||v.a.PriorityClass[e],"Priority must be defined in globals")}catch(s){m.default.reportError(s)}var a=this.getPriority();if(e!==a){var i=this.flags.get(),n=i&~v.a.PCMask|e;if(i&v.a.VMLIFlag.Complete&&(n&=~v.a.VMLIFlag.Complete),this.setFlags(n),this.shouldSave()){var r={flags:n};_.a.saveItem(this,r,t,v.a.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),V.a.itemPriorityChanged(this),F.d.performAction(F.b.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:a})}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(e,t){if(e){var a=e.search.getItemDuration(this);if(a)return a}if(this._date)return this._date.duration||v.a.DefaultEventDuration}},{key:"setDuration",value:function(e){this._date?this._date.setDuration(e):this._date=new j.a(void 0,{duration:e})}},{key:"getEndDate",value:function(e){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();this.getDate().isSameDay(t)||(e=!0)}return e}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"onMooDateUpdated",value:function(e,t){var a=this;if(sr.timeline.updateNotifications(this),t||m.default.isFlagSet(e,v.a.ChangeType.ItemLoad)||V.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var i={date:this._date?this._date.toData():null};m.default.timeoutOnce("setMooDate",function(){a.shouldSave()&&_.a.saveItem(a,i,e,v.a.SaveFlag.Text),!t&&a._attachments&&m.default.isLocalChange(e)&&a._attachments.forEach(function(e){e.getPlugin().id===v.a.PluginID.GCalendar&&e.notifyItemDateChanged(a)})},500)}}},{key:"setMooDate",value:function(e,t,a){if(this._date&&e?this._date.copyFrom(e):this._date=e,!1!==a){var i=this.getRawText();this.onMooDateUpdated(t),!e&&i.includes(v.a.CharDate)&&(i=m.default.trimRight(i.replace(new RegExp(v.a.CharDate,"g"),"").replace(/'  '/g," ")),this.setText(i,t)),m.default.isLocalChange(t)&&F.d.miscAction({type:F.b.Misc,misc:F.a.ChangeDate,data:{itemID:this.id,date:this._date}})}}},{key:"setDate",value:function(e,t,a){if(this._date)e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(a));else if(this.setMooDate(new j.a(e),a),this.getRawText().indexOf(v.a.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+v.a.CharDate,v.a.ChangeType.Local)}}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(e){return this._date?this._date.getNext(e):void 0}},{key:"getDate",value:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_isFlagHelper",value:function(e,t){if(void 0===t)return!!(this.flags.get()&e);var a=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(a)}},{key:"isDeleted",value:function(){return this._isDeleted}},{key:"setDeleted",value:function(e,t){try{m.default.PAssert(897,m.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(o){m.default.reportError(o)}if(this._isDeleted=e,e){var a=0;e!==this._isDeleted&&this.shouldSave()&&_.a.deleteItem(this.parent(),this,t);for(var i=0;this._favorites&&i<this._favorites.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._favorites[i];e?Y.notifyRemove(this,n):Y.notifyAdd(this,n)}if(this._attachments){var r=0,s=this._attachments;for(i=0;i<s.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e?(s[i].unsubscribe(this),this.shouldSave()&&s[i].markUnused(t)):(s[i].subscribe(this),this.shouldSave()&&s[i].markInUse(t))}}}}},{key:"isImportant",value:function(e){return this.getPriority(e)}},{key:"forceComplete",value:function(e,t){return this.setComplete(e,t,!0)}},{key:"isDisplayComplete",value:function(){return this._isFlagHelper(v.a.VMLIFlag.DisplayComplete)}},{key:"computeDisplayComplete",value:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e._isFlagHelper(v.a.VMLIFlag.DisplayComplete));this._isFlagHelper(v.a.VMLIFlag.DisplayComplete,t)}},{key:"propagateDisplayComplete",value:function(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.itemAtIndex(t);a.isComplete()||a.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._isFlagHelper(v.a.VMLIFlag.Complete)&&(!this.isRepeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===Q.getTime())}},{key:"setComplete",value:function(e,t,a){var i=e,n={};try{m.default.PAssert(898,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(r){m.default.reportError(r)}e?(this.isRepeatDate()?(this._date.complete(),this.onMooDateUpdated(t),i=!1,sr.toasts.pushMessage({text:"Completed. Next occurrence: "+X.a.toHumanText(this._date.getNext()),action:v.a.MessageAction.Undo,hold:!1})):this.dateCompleted||(this.dateCompleted=new Date,n.dateCompleted=this.getDateCompletedTime()),m.default.isLocalChange(t)&&m.default.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,n.dateCompleted=null),this._isFlagHelper(v.a.VMLIFlag.Complete,i),m.default.isRemoteChange(t)||(n.flags=this.flags.get(),this.shouldSave()&&_.a.saveItem(this,n,t,v.a.SaveFlag.Text),F.d.performAction(F.b.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),sr.timeline.updateNotifications(this),V.a.itemSearchChanged(this)}},{key:"setStarred",value:function(e,t){if(void 0!==e){try{m.default.PAssert(899,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(r){m.default.reportError(r)}if(e!==this._isFlagHelper(v.a.VMLIFlag.Starred)){var a=this.flags.get();e&&a&v.a.VMLIFlag.Complete&&(a&=~v.a.VMLIFlag.Complete);var i=e?a|v.a.VMLIFlag.Starred:a&~v.a.VMLIFlag.Starred;this.setFlags(i);var n={flags:i};this.shouldSave()&&_.a.saveItem(this,n,t,v.a.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),V.a.itemSearchChanged(this),F.d.performAction(F.b.Update,{itemID:this.id,field:"isStarred",newValue:e,oldValue:!e})}}}},{key:"isStarred",value:function(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._isFlagHelper(v.a.VMLIFlag.Starred)}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(e){if(!this.isNote()){for(var t=0,a=this.getItems(),i=[],n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[n].isHidden(e)||i.push(a[n])}return i}}},{key:"hasVisibleChildren",value:function(e){if(this.isNote())return!1;for(var t=0,a=this.getItems(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!a[i].isHidden(e))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),a=0;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[a].isHeader())return!0}return!1}},{key:"getCollapsedField",value:function(e,t){return t?v.a.PerPaneStateField.CollapsedOverview:e.collapsedFieldName}},{key:"isCollapsed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;try{m.default.PAssert(900,e,"Must specify the pane for the item being checked for collapsed")}catch(n){m.default.reportError(n)}if(!e||!t&&e.isSearchedFlat())return!1;var i=!a&&e.isSearchedText()?e.getPerPaneState(this.id,v.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===i&&void 0===(i=e.getPerPaneState(this.id,this.getCollapsedField(e,t)))&&(i=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!i}},{key:"setCollapsed",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;try{m.default.PAssert(901,t,"Must specify the pane for the item being checked for collapsed")}catch(r){m.default.reportError(r)}if(!t)return!1;var n=this.isCollapsed(t,a);void 0!==e&&(e&&!this.isCollapsible()||(t.isSearchedText()&&t.setPerPaneState(this.id,v.a.PerPaneStateField.CollapsedSearch,void 0),t.setPerPaneState(this.id,this.getCollapsedField(t,a),e),!1!==i&&sr.PaneManager.updatePaneStateForPane(t),F.d.performAction(F.b.Update,{itemID:this.id,field:"isCollapsed",pane:t,newValue:e,oldValue:n}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,m.default.focusedPane),e!==n&&t.updateItems())),this.itemChanged.notify()}},{key:"setCollapsedQuiet",value:function(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)}},{key:"toggleCollapsed",value:function(e){try{m.default.PAssert(902,e,"Must specify the pane that this item is being collapsed in")}catch(t){m.default.reportError(t)}k.a.fireEvent("clearMeasureCacheItem",[this.id]),this.setCollapsed(!this.isCollapsed(e,!1),e,!1)}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(e,t){var a=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||m.default.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map(function(e){return e.toLowerCase()}):void 0,a&&a.length>0&&!m.default.isFlagSet(t,v.a.ChangeType.ItemLoad)&&V.a.itemTagsChanged(this,a)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}},{key:"setContacts",value:function(e,t){var a=!(this._activeContacts&&e&&this._activeContacts.equals(e));this._activeContacts=e,a&&!m.default.isFlagSet(t,v.a.ChangeType.ItemLoad)&&V.a.itemSearchChanged(this)}},{key:"getContacts",value:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(e){return e.toString(sr.International.getFormat(v.a.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(e,t){var a=this,i=this.getDate(t);if(i){var n=this.getEndDate(t);i=i.clone().clearTime().equals(i)?i:n.clone().clearTime().equals(i)?n:i}else if(this.isRepeatDate()){var r=this.getMooDate();r&&(i=r.getNext(e))}try{m.default.PAssert(903,i,"No display date with duration",function(){return a.getMooDate()&&a.getMooDate().toData()})}catch(s){m.default.reportError(s)}return i}},{key:"getTime",value:function(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){var a;if(t.hasTimeOfDay())this.getDuration()>0&&(a=this.getDisplayDateWithDuration()),a?a.equals(t)?e=[this._formatDateTime(t),this._formatDateTime(this.getEndDate())]:a.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate())):e=this._formatDateTime(t)}return e}},{key:"createDateString",value:function(e){return e.isBefore(Date.today().addWeeks(1))?e.toString(sr.International.getFormat(v.a.DFormat.LongDayTime)):e.toString(sr.International.getFormat(v.a.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var e=this.getDate();if(!e)return"";this.createDateString(e)}},{key:"init",value:function(e,t){this._shouldSave=!(t&&t.noSave);try{m.default.PAssert(904,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(n){m.default.reportError(n)}if(this.id=e.id||_.a.generateID(),e.date){var a=e.date instanceof j.a?e.date.clone():j.a.fromData(e.date);a?this._date=a:m.default.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.favorites&&this.setFavorites(e.favorites,t.changeType),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.initItems(e.items,e.note,t.changeType),this.__TEMP_InitCalled=!0;try{m.default.PAssert(905,t,"Missing required properties in extraInfo")}catch(n){m.default.reportError(n)}var i=t?t.changeType:v.a.ChangeType.Auto;try{m.default.PAssert(906,m.default.isValidChangeType(i),"Must supply a valid changetype to VMLIs")}catch(n){m.default.reportError(n)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!m.default.isAutoChange(t.changeType))?(m.default.isLocalChange(t.changeType)?v.a.SaveFlag.All:v.a.SaveFlag.None,this.getItemStore().trackGlobally()&&_.a.setItem(this)):this.getItemStore().trackGlobally()&&_.a.setItem(this);this.parseText(this.getRawText(),t.changeType|v.a.ChangeType.ItemLoad),m.default.isLocalChange(t.changeType)&&m.default.aggregateEvent("ItemCreated")}},{key:"onLoad",value:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}},{key:"destroy",value:function(e){try{m.default.PAssert(907,this._canDestroy||e,"VMLI must be explicitly marked as destroyable")}catch(r){m.default.reportError(r)}try{m.default.PAssert(908,e||!this.shouldSave()||m.default.isDemoMode(),"Should never destroy a saveable VMLI")}catch(r){m.default.reportError(r)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var a=0,i=this._attachments,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&_.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),V.a.itemSearchChanged(this),this._store=void 0,L.a.destroy(this)}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return m.default.focusedItem===this}},{key:"findItem",value:function(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}},{key:"setItems",value:function(e){for(var t=0,a=this.items.get(),i=a.length>0,n=!1,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e[r],o=a.indexOfWithProperty("id",s.id);if(o>=0){var l=a[o];s.items&&l.setItems(s.items)}else a.push(this._store.createItemRaw(s,{documentOwner:this._documentOwner,parent:this,changeType:v.a.ChangeType.Auto})),n=!0}n&&(i&&a.sort(H.a.compareItemIndex),this.items.set(a),this.itemsHasMutated())}},{key:"initItems",value:function(t,a,i){var n=!1;if(t&&t.length>0){var r=0;try{m.default.PAssert(909,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(g){m.default.reportError(g)}for(var s=0;s<t.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t[s],l=void 0;if(o instanceof e?l=o:m.default.isString(o)&&(l=_.a.getItem(o)),l){var u=_.a.getItem(l.parent().id);if(u&&u.id!==this.id){var d=u.items.indexOf(l.id);try{m.default.PAssert(912,-1===d,"Expect that the old parent has been notified")}catch(g){m.default.reportError(g)}var c=l.getIndex();c>-1&&l.parent().removeChildAtIndex(c,i)}l.setParent(this)}else if("object"!==T()(o)){var h=_.a.getItemDataLocal(this._documentOwner,o);try{m.default.PAssert(910,h,"Referenced item doesn't exist",o)}catch(g){m.default.reportError(g)}h&&(l=this._store.createItemRaw(h,{documentOwner:this._documentOwner,parent:this,changeType:i}))}else{try{m.default.PAssert(911,o,"Item must exist otherwise we arent creating anything")}catch(g){m.default.reportError(g)}o&&(l=this._store.createItemRaw(o,{documentOwner:this._documentOwner,parent:this,changeType:i}))}try{m.default.PAssert(913,l,"There must be a model at this point")}catch(g){m.default.reportError(g)}if(l){if(l.isNote()){a=l.id;continue}n=!0,this.items.push(l)}}}if(a){try{m.default.PAssert(914,!this._note,"Must not already have a valid note set")}catch(g){m.default.reportError(g)}try{m.default.PAssert(915,m.default.isString(a)||m.default.isObject(a),"Note must be a valid ID")}catch(g){m.default.reportError(g)}var f;if(m.default.isString(a)){if(!(f=_.a.getItem(a))){var p=_.a.getItemDataLocal(this._documentOwner,a);try{m.default.PAssert(916,p,"Referenced note doesn't exist",a)}catch(g){m.default.reportError(g)}p&&(p.isDeleted?f=null:(p=Object.assign({isNote:!0},p),f=this._store.createItemRaw(p,{documentOwner:this._documentOwner,parent:this,changeType:i})))}}else m.default.isObject(a)&&(f=this._store.createItemRaw(a,{documentOwner:this._documentOwner,parent:this,changeType:i}));try{m.default.PAssert(917,void 0!==f,"Must have a valid note VM at this point")}catch(g){m.default.reportError(g)}f&&(this._note=f,n=!0)}n&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(e,t,a){try{m.default.PAssert(918,a,"Must pass pane when adding item at index")}catch(n){m.default.reportError(n)}F.d.beginAction();var i=a.createVMLI(e,{documentOwner:this._documentOwner,parent:this,changeType:v.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(i,t),F.d.performAction(F.b.Create,{itemID:i.id,parent:this.id,position:isNaN(t)?this.numItems()-1:t,text:e.text}),this.isCollapsed(a,!1)&&this.setCollapsed(!1,a),F.d.endAction(),i}},{key:"insertItem",value:function(e,t,a){try{m.default.PAssert(919,!this.isNote(),"Notes cannot use this function")}catch(i){m.default.reportError(i)}try{m.default.PAssert(920,e,"Must specify a valid item to be inserted")}catch(i){m.default.reportError(i)}try{m.default.PAssert(921,this!==e,"Should not insert an item into itself")}catch(i){m.default.reportError(i)}try{m.default.PAssert(922,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(i){m.default.reportError(i)}this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&_.a.addItem(this,e,t,a))}},{key:"insertSorted",value:function(e,t,a){try{m.default.PAssert(923,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(924,e,"Must specify a valid item to be inserted")}catch(n){m.default.reportError(n)}try{m.default.PAssert(925,t,"Must supply a valid comparator")}catch(n){m.default.reportError(n)}try{m.default.PAssert(926,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(n){m.default.reportError(n)}var i=this.items.insertSorted(e,t,a);this.shouldSave()&&_.a.addItem(this,e,i)}},{key:"moveTo",value:function(t,a){var i=t.parent,n=t.index,r=t.shouldBeArchived;try{m.default.PAssert(927,i instanceof e,"New parent must be a valid VMLI")}catch(h){m.default.reportError(h)}void 0===n&&(n=-1),void 0===r&&(r=!1);var s=this.parent(),o=s.findItem(this),l=this.index;if(o)if(i.getDocumentOwner().getBacking()!==s.getDocumentOwner().getBacking())sr.toasts.pushMessage({text:"Moving items between local and synced documents is not yet supported. Please copy and paste these items for now."});else{var u=n;if(s===i){if(o.index===u)return;o.index<u&&u--}sr.PaneUpdateBatcher.beginUpdateItems(),o.arr.splice(o.index,1),V.a.itemSearchChanged(this);var d=i.items;u<0?d.push(this,!1):d.splice(u,0,this,!1);var c=i.getDocumentOwner();c!==this.getDocumentOwner()&&this.forEachChildRecursive(function(e){return e.setDocumentOwner(c)},!0,!0),this.setParent(i),d.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),sr.PaneUpdateBatcher.commitUpdateItems();try{m.default.PAssert(928,this.shouldSave(),"Item must be marked as saveable")}catch(h){m.default.reportError(h)}try{m.default.PAssert(929,s.shouldSave(),"Old parent must be marked as saveable")}catch(h){m.default.reportError(h)}try{m.default.PAssert(930,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(h){m.default.reportError(h)}this.shouldSave()&&_.a.moveItem(this,s,l,a),s.propagateDisplayComplete(),i.propagateDisplayComplete()}else sr.toasts.pushMessage({text:"Error moving item"})}},{key:"getItemsArrayForSave",value:function(){var e=0;try{m.default.PAssert(931,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}for(var t=[],a=this.getItems(),i=0;i<a.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(a[i].id)}return t}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(Q))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(e){var t=new Date(e);try{m.default.PAssert(932,m.default.isDateValid(t),"Must provide a valid alert date: "+e)}catch(a){m.default.reportError(a)}return t=e.hasTimeOfDay()?t.addMinutes(-sr.settings.notificationDelay.get()):t.addDays(-1).clearTime().addHours(17),{id:this.id,text:this.generateTitleText(void 0,!0),date:e,alertDate:t}}},{key:"getNotificationEntry",value:function(){try{m.default.PAssert(933,this.getNextDate(),"Must have a valid date")}catch(t){m.default.reportError(t)}try{m.default.PAssert(934,!this.allDayDate(),"All day dates should not be scheduled")}catch(t){m.default.reportError(t)}if(!this.allDayDate())try{var e=this.getNextDate();if(e&&e>new Date)return this._generateNotificationEntry(e)}catch(a){return void m.default.reportError(a)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}},{key:"getFullSaveData",value:function(){try{m.default.PAssert(935,this.shouldSave(),"Item must be marked as saveable")}catch(a){m.default.reportError(a)}var e=this.flags.get();try{m.default.PAssert(936,this._documentOwner,"Item has no document")}catch(a){m.default.reportError(a)}var t={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:e||void 0,isRoot:this.isRoot,docId:this._documentOwner?this._documentOwner.id:void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0};return Object.keys(t).forEach(function(e){void 0===t[e]&&delete t[e]}),t}},{key:"highlight",value:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){e.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted.set(!1)},2e3)}},{key:"removeChild",value:function(e,t){try{m.default.PAssert(937,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(938,!e.isNote(),"Do not use remove child to remove notes from items")}catch(a){m.default.reportError(a)}return this.items.remove(e)}},{key:"removeChildAtIndex",value:function(e,t){try{m.default.PAssert(939,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(940,!this.itemAtIndex(e).isArchived())}catch(a){m.default.reportError(a)}this.items.removeAt(e)}},{key:"_moveChildrenHelper",value:function(e,t){var a=e.newParent,i=e.index,n=e.isArchived;try{m.default.PAssert(941,void 0!==a&&void 0!==n,"_moveChildrenHelper is missing parameters")}catch(d){m.default.reportError(d)}var r=this.getItems();if(r.length>0){var s=0,o=a.getItems();!n&&(isNaN(i)||i<0)&&(i=o.length);for(var l=0;r.length>0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;try{m.default.PAssert(942,r[l]!==a,"Should never be reparenting to a child")}catch(d){m.default.reportError(d)}var u=r[0].id;r[0].moveTo({parent:a,index:i+l,shouldBeArchived:n},t),F.d.performAction(F.b.Move,{itemID:u,oldParent:this.id,oldPosition:l,newParent:a.id,newPosition:i+l}),l++}}}},{key:"moveChildren",value:function(e,t,a){try{m.default.PAssert(943,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(944,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(n){m.default.reportError(n)}if(e.parent()===this){var i=this.removeChild(e,a);F.d.performAction(F.b.Delete,{itemID:e.id,parent:this.id,position:i})}sr.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},a),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},a),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(e){this.parent().deleteChild(this,void 0,void 0,e)}},{key:"deleteChild",value:function(e,t,a,i,n){try{m.default.PAssert(945,e,"Must provide a valid child to delete")}catch(u){m.default.reportError(u)}try{m.default.PAssert(946,!this.isNote(),"Notes cannot use this function")}catch(u){m.default.reportError(u)}if(F.d.beginAction(),sr.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,i);else if(e.hasChildren())if(t)e.moveChildren(t,a,i);else for(var r=0,s=e.getItems(),o=s.length-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.deleteChild(s[o],void 0,void 0,i,!0)}e.hasNote()&&e.getNote().setDeleted(!0,i);if(!e.isDeleted()){if(!e.isNote()&&!n){var l=this.removeChild(e,i);l>=0&&F.d.performAction(F.b.Delete,{itemID:e.id,parent:this.id,position:l})}this._documentOwner&&this._documentOwner.deleteItem(e,i,n)}e.notifyItemPropertyChanged(i,"isDeleted"),V.a.itemItemsChanged(this),sr.timeline.updateNotifications(e),sr.PaneUpdateBatcher.commitUpdateItems(),F.d.endAction()}},{key:"unDelete",value:function(e){if(this._documentOwner.unDeleteItem(this,e),this.hasNote()){var t=this.getNote();t.isDeleted()&&this._documentOwner.unDeleteItem(t,e)}}},{key:"replaceChild",value:function(e,t,a){try{m.default.PAssert(947,!this.isNote(),"Notes cannot use this function")}catch(s){m.default.reportError(s)}try{m.default.PAssert(948,!e.isNote(),"Old child should not be a note")}catch(s){m.default.reportError(s)}try{m.default.PAssert(949,!t.isNote(),"New child should not be a note")}catch(s){m.default.reportError(s)}var i=e.getIndex();this.items.removeAt(i),F.d.performAction(F.b.Delete,{itemID:e.id,parent:this.id,position:i}),_.a.deleteItem(this,e,a),t.moveTo({parent:this,index:i},a),e.moveChildren(t,t.numChildren(),a);var n=t.parent().id;if(n!==this.id){var r=t.parent().items.remove(t);F.d.performAction(F.b.Move,{itemID:t.id,oldParent:n,oldPosition:r,newParent:this.id,newPosition:i})}}},{key:"forEachChildRecursive",value:function(e,t,a){a&&e(this),t&&this.hasNote()&&e(this.getNote()),this.items.get().forEach(function(a){return a.forEachChildRecursive(e,t,!0)})}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(e){try{m.default.PAssert(950,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}try{m.default.PAssert(951,e>=0,"Child index is out of range: ",e)}catch(t){m.default.reportError(t)}try{m.default.PAssert(952,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(t){m.default.reportError(t)}return this.itemAtIndex(e)}},{key:"getFirstChild",value:function(){try{m.default.PAssert(953,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){try{m.default.PAssert(954,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){try{m.default.PAssert(955,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){try{m.default.PAssert(956,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(e){for(var t=0,a=this.parent();a&&a!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a=a.parent()}return void 0!==a}},{key:"hasChild",value:function(e){return this.getIndexOf(e.id)>=0}},{key:"getChildIndex",value:function(e){try{m.default.PAssert(957,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}try{m.default.PAssert(958,!e.isNote(),"Should not get the index of an item note")}catch(t){m.default.reportError(t)}return this.getIndexOf(e.id)}},{key:"getIndexOf",value:function(e){try{m.default.PAssert(959,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(960,m.default.isString(e),function(){return"ID must be a valid string: "+m.default.getObjectInfo(e)})}catch(r){m.default.reportError(r)}var t=-1,a=this.getItems();if(a)for(var i=0,n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a[n].id===e){t=n;break}}return t}},{key:"getIndex",value:function(){try{m.default.PAssert(961,!this.isNote(),"Should never be getting a child index of a note")}catch(e){m.default.reportError(e)}return this.parent().getChildIndex(this)}},{key:"indexInItemFromStringIndex",value:function(e){var t={index:e},a=this.items.get(),i=a.findIndex(function(e){return H.a.compareItemIndex(e,t)>0});return i>=0?i:a.length}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){try{m.default.PAssert(962,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(e){for(var t=0,a=[],i=this.parent();i&&i!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.splice(0,0,i),i=i.parent()}return a}},{key:"getSiblings",value:function(e){try{m.default.PAssert(963,!this.isNote(),"Notes cannot use this function")}catch(s){m.default.reportError(s)}e=e||0;var t=[];if(this.parent())for(var a=0,i=this.parent().getItems(),n=e,r=i.length;n<r;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n]!==this&&t.push(i[n])}return t}},{key:"nextSibling",value:function(){var e=this.getIndex();return this.parent().getItems()[e+1]}},{key:"isRootItem",value:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)}},{key:"clone",value:function(e,t){var a=0;try{m.default.PAssert(964,!m.default.isAutoChange(t),"Cloning should always be a user action")}catch(o){m.default.reportError(o)}for(var i=e.getItemStore().createItemRaw({id:void 0,text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:e.getDocumentOwner()||this._documentOwner,changeType:t}),n=0;n<this.numItems();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.itemAtIndex(n).clone(i,t);i.insertItem(r)}if(this.hasNote()){var s=this.getNote().clone(i,t);i.setNote(s,t)}return i}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(e){return this.items.get()[e]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){try{m.default.PAssert(965,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){m.default.reportError(e)}!this._destroyed&&this.isInitialized&&V.a.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(){var e=0,t={item:this,each:function(t){e++}};return m.default.searchVMLIs(t),e}},{key:"isOnDate",value:function(e){return!!this._date&&this._date.isOnDate(e)}},{key:"getCalendarColor",value:function(){var e,t=sr.pluginManager.getPluginGCalendar();if(this.isComplete())return"#ddd";if(this.hasAttachmentType(v.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(v.a.PluginType.Calendar);e=t.getCalendarBackgroundColor(a.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}},{key:"getCalendarDisplayProps",value:function(){var e,t=sr.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(v.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(v.a.PluginType.Calendar);e=t.getCalendarDisplayProps(a.getField("calendarID"))}return e}},{key:"allowTextEditing",value:function(){return!0}},{key:"getPreviousItem",value:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},{key:"isRepeatDate",value:function(){return this._date&&this._date.isRepeatDate()}},{key:"getEls",value:function(){return this.els}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"setDocumentOwner",value:function(e){this._documentOwner=e}},{key:"onAttachInlineUpdate",value:function(){this.setText(this.getParsedText(),v.a.ChangeType.Local)}},{key:"renderRichText",value:function(e,t){return this.els||m.default.runSingleParse(this,v.a.ChangeType.Auto),sr.ElementRenderer.renderRichText(this.els,{pane:e,item:this,overview:t})}},{key:"setDateModified",value:function(e){this.dateModified=e,V.a.itemModifiedChanged(this)}}]),e}(),D()(K.prototype,"itemsHasMutated",[C.a],Object.getOwnPropertyDescriptor(K.prototype,"itemsHasMutated"),K.prototype),K);L.a.extendClass(J,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return g()(t,e),o()(t,[{key:"_runAndGetSaveData",value:function(e,t){if(this.shouldSave())var a=this.getMetaTextSaveData();var i=this.getRawText();if(this.setRawText(this.generateSaveText(e)),this.parseText(i,t),this.shouldSave()){var n=this.getMetaTextSaveData(),r={};for(var s in n)a[s]!==n[s]&&(r[s]=n[s])}return r}},{key:"setText",value:function(e,t){try{m.default.PAssert(1181,m.default.isLocalChange(t)||!e||e.indexOf(v.a.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1182,this.isNote()||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1183,!e||m.default.isRemoteChange(t)||e.indexOf(v.a.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(n){m.default.reportError(n)}t|=v.a.ChangeType.Text;var a=this.isPrefixHeader();!this.isNote()&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),this.isInitialized&&k.a.fireEvent("clearMeasureCacheItem",[this.id]),V.a.beginBatch(this);var i=this._runAndGetSaveData(e,t);this.shouldSave()&&(i.text=this.generateSaveText(e),_.a.saveItem(this,i,t,v.a.SaveFlag.Text)),V.a.itemTextChanged(this),this.isPrefixHeader()!==a&&V.a.itemFontChanged(this),V.a.commitBatch(this)}},{key:"metricsInPane",value:function(e,t){var a;try{var i=t>=0&&R.a.isSelected(t,e),n=e.objectAtIndex(t);a=e.getMetricsForPaneObject(n,!1,i)}catch(r){m.default.reportError(r)}return a}},{key:"sizeInPane",value:function(e,t,a){if(a)return v.a.OverviewItemHeightDesktop;if(this.isNote()){var i=e.objectAtIndex(t);return sr.DisplaySettings.lineItemHeight(i,this,e,1)}var n=e.objectAtIndex(t),r=this.metricsInPane(e,t).height;return this.shouldShowParents(n,e)&&(r+=v.a.HeightAgendaParents),r}},{key:"shouldShowParents",value:function(e,t){return t.type===v.a.PaneMode.Task&&e.item&&!t.isSearchedFlat()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeep&&e.item.getItemStore()===sr.itemStoreManager.getDefaultItemStore()&&e.item.parent()!==t.getItem()}},{key:"generateSaveText",value:function(e,t){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString",t):null}},{key:"generateTitleText",value:function(e,t){var a="";if(e&&!this.parent())return e.titleOfFirstItem();if(e&&this.els&&this.els.length>0)for(var i=0,n=0;n<this.els.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=this.els[n];r.hasClass("mdMarkup")||r.hasClass("itemPrefix")||r.hasClass("inlineDate")||(a+=m.default.unescape(r.getUnstyledText(e)))}else a=this.getParsedTextWithoutPrefix();return(this.hasAttachments()?this._generateUsableText(a,"getTitleString",void 0,t):a).replace(/[\*_]/g,"").trim()}},{key:"_generateUsableText",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1184,this.hasAttachments()||e.indexOf(v.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(l){m.default.reportError(l)}var r=e;if(this.hasAttachments()&&e.indexOf(v.a.AttachChar)>=0){var s=a||0,o=this.getNumAttachments();r=e.replace(new RegExp(v.a.AttachChar,"g"),function(){if(s<o){var e=n.getAttachment(s);return s++,!e.isLoaded()||i&&e.getPlugin().id===v.a.PluginID.Date?"":e[t]()}try{m.default.PAssert(1185,!1,"Unable to find valid attachment for AttachChar")}catch(l){m.default.reportError(l)}return""});try{m.default.PAssert(1186,r.indexOf(v.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(l){m.default.reportError(l)}}return r}},{key:"splitUsableText",value:function(e,t,a){var i=this;try{m.default.PAssert(1187,this.hasAttachments()||e.indexOf(v.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(l){m.default.reportError(l)}var n=e.substring(0,t)+e.substring(a),r=t;if(this.hasAttachments()&&e.indexOf(v.a.AttachChar)>=0){var s=0,o=this.getNumAttachments();n=e.replace(/\u2000/g,function(e,a){if(s<o){var n=i.getAttachment(s);s++;var l=n.getEmbedString();return a<t&&(r+=Math.max(l.length-1,0)),l}return v.a.AttachChar});try{m.default.PAssert(1188,n.indexOf(v.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(l){m.default.reportError(l)}}return{before:n.substring(0,r),after:n.substring(r)}}},{key:"parseText",value:function(e,t){if(!this._isParsing){try{m.default.PAssert(1189,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1190,m.default.isValidChangeType(t),"Must specify a valid changetype")}catch(s){m.default.reportError(s)}var a;this._isParsing=!0;try{var i;if(this.__TEMP_ParseCalled=!0,this.isNote())i=U.a.parseNote(this);else{var n=this.getParser();try{m.default.PAssert(1191,n,"Must be able to get valid parse function for item")}catch(s){m.default.reportError(s)}if(!n)return;i=n(this,t)}m.default.isFlagSet(t,v.a.ChangeType.Local)&&i.numContacts>0&&F.d.miscAction({type:F.b.Misc,misc:F.a.AddContact,data:[{itemID:this.id}]});var r=this.isPrefixNumList();a=this.styleText(i,e,t),this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==r&&k.a.fireEvent("numListChanged",[])}catch(o){m.default.reportError(o)}return this._isParsing=!1,a}}},{key:"styleText",value:function(e,t,a){try{m.default.PAssert(1192,m.default.isValidChangeType(a),"Must specify a valid changetype")}catch(k){m.default.reportError(k)}var i=!1,n=[];if(e){this.prefix=e.prefix;var r=(!t.includes(v.a.CharDate)||this.getRawText().includes(v.a.CharDate))&&this.getMooDate();if(r&&""!==e.parsedText){var s=r.getGCalId();if(s){var o=r.getGCalCalendar();e.attachments||(e.attachments=[]),e.attachments.push({p:v.a.PluginID.GCalendar,id:s,calendarID:o,hasInlineData:!0})}}if(e.attachments||this.hasAttachments()){for(var l=0,u=[],d=0;e.attachments&&d<e.attachments.length;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=e.attachments[d];c.p===v.a.PluginID.Date&&(c.id=this.id);var h=sr.pluginManager.getAttachment(c,c.hasInlineData);h&&(u.push(h),m.default.isLocalChange(a)&&!h.getOldID()&&n.push(h))}i=!0,this.setAttachments(u,a,!1)}this.setParsedText(e.parsedText);try{m.default.PAssert(1193,e.els||m.default.isFlagSet(a,v.a.ChangeType.ItemLoad),"Must always return an els list")}catch(k){m.default.reportError(k)}e.els&&(this.els=e.els),this.prefix&&F.d.miscAction({type:F.b.Misc,misc:F.a.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),(e.tags||this._activeTags)&&this.setTags(e.tags,a),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,a);var f=this.getRawText();!(t&&this.getMooDate()&&t.includes(v.a.CharDate))||f&&f.includes(v.a.CharDate)||this.setMooDate(void 0,a)}if(this.isInitialized){if(n.length>0){var p=0;for(d=0;d<n.length;d++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;n[d].notifyItemTextChanged(this,!1)}}if(m.default.isLocalChange(a)&&this.isNote()&&this.parent().hasAttachments()){var g=0,y=this.parent().getAttachments();for(d=0;d<y.length;++d){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;y[d].notifyItemNoteChanged(this)}}i&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){var e;this.hasAttachmentType(v.a.PluginType.Email)?e=this.getAttachmentByType(v.a.PluginType.Email).getField("subject"):e=this.getParsedTextWithoutPrefix().replace(/\u2000/g,"");return e.trim()}},{key:"getStyledTextAsOneLine",value:function(e,t){var a;return t&&(a='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>"),sr.ElementRenderer.render(this.els,{convertSpaces:!1,noPrefix:e,suffix:a,item:this})}},{key:"hasText",value:function(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(e){var t=this.getRawText(),a=this.getPrefix();a&&(t=t.substr(a.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,v.a.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===v.a.Prefix.Header||t[0]===v.a.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&m.default.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===v.a.Prefix.Bullet||this.prefix===v.a.Prefix.Bullet2||this.prefix===v.a.Prefix.Bullet3}},{key:"isPrefixNumList",value:function(){return!!(this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10)}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var e=0,t=1,a=this.parent(),i=this.getIndex()-1;i>=0;--i,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=a.getChild(i);if(!n||!n.isPrefixNumList())break}return t}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}},{key:"applyFormatToSelection",value:function(e,t,a,i){var n,r,s,o=0,l=0,u=this.getParsedText(),d=t,c=a,h=!1;for(t===a&&(t=0,a=u.length),t<this.getPrefixLength()&&(t=this.getPrefixLength()),a<this.getPrefixLength()&&(a=this.getPrefixLength()),s=t;s>=Math.max(t-e.length,0);s--){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u.substr(s,e.length)===e){n=s;break}}for(s=a-e.length;s<=a;s++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u.substr(s,e.length)===e){r=s;break}}return isNaN(n)||isNaN(r)||i===v.a.SetMode.Yes?i!==v.a.SetMode.No&&(d+=e.length,c+=e.length,u=u.substr(0,t)+e+u.substr(t,a-t)+e+u.substr(a),h=!0):(d-=e.length,c-=e.length,u=u.substr(0,n)+u.substr(n+e.length,r-n-e.length)+u.substr(r+e.length)),this.setText(u,v.a.ChangeType.Local),{didSet:h,selStart:d,selEnd:c}}},{key:"insertLinkAtSelection",value:function(){var e=R.a.getStartIndex();if(R.a.isValid()&&e===R.a.getEndIndex()){var t,a=R.a.getStartOffset(),i=R.a.getEndOffset(),n=this.getRawText();if(a!==i)t=n.substr(a,i-a);else if(a>0&&i<n.length){for(var r,s,o=0,l=this.getEls(),u=0,d=-1,c=0;c<l.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l[c].hasClass("mdMarkupStart")&&"["===l[c].getParsedText())d=u;else if(l[c].hasClass("mdMarkupEnd")&&")"===l[c].getParsedText()&&d>=0){var h=u+l[c].getOrigTextLength();if(a>=d&&i<=h){r=d,s=h;break}d=-1}u+=l[c].getOrigTextLength()}r||s||" "===n[a-1]||" "===n[a]||(r=n.prevIndexOf(" ",a)+1,(s=n.indexOf(" ",i))<0&&(s=n.length)),isNaN(r)||isNaN(s)||r===a||s===i||(t=n.substr(r,s-r),R.a.selectIndices(e,r,e,s))}sr.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:R.a.getEndElement(),onInsertLink:this.onInsertLink,text:t})}}},{key:"onInsertLink",value:function(e,t){if(R.a.isValid()&&R.a.getStartIndex()===R.a.getEndIndex()){t&&!e.text&&(e.text=e.url);var a=R.a.getStartOffset(),i=R.a.getEndOffset(),n=this.getRawText(),r=n.substr(a,i-a),s=e.url?e.text?(t?"!":"")+"["+e.text+"]("+e.url+")":e.url:e.text,o=i+s.length-r.length;n=n.substr(0,a)+s+n.substr(i),this.setText(n,v.a.ChangeType.Local),R.a.selectIndex(R.a.getStartIndex(),o)}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewText",value:function(){var e=this.getParsedText();if(e){var t=(e=e.substr(0,Math.min(e.length,400))).match(/[^\r\n]+/);if(t){for(var a=0,i=(e=t[0]).split(/<\/?(?:div|p|br)[^>]*>\s*/im),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i[n]){var r=document.createElement("div");if(r.innerHTML=i[n],e=m.default.escape(r.textContent||r.innerText))break}}e=e.substr(0,Math.min(e.length,200))}}return e}},{key:"setTextToWhatItAlreadyIs",value:function(e){var t=this.getParsedText();this.setText(t,v.a.ChangeType.Local)}}]),t}(e);return t}(J),!0),L.a.extendClass(J,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return g()(t,e),o()(t,[{key:"dragStart",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.pane||m.default.focusedPane;try{m.default.PAssert(1174,i.isItemDraggable(this),"Pane must be draggable in order to start a drag")}catch(w){m.default.reportError(w)}try{m.default.PAssert(1175,sr.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(w){m.default.reportError(w)}var n=m.default.getElementParent(e.startSrc||e.target);try{m.default.PAssert(1176,n,"Must have a valid target node")}catch(w){m.default.reportError(w)}if(n){var r,s;if(sr.DragDrop.startDragItem=void 0,sr.DragDrop.dragItem=this,i.isViewCalendar()||a||m.default.findParent(n,"itemNotInPane"))r=[{item:this,levelsDeep:0}];else{var o=m.default.getPaneObjectForElement(n),l=this.levelsDeep.get(),u=o.levelsDeep;if(r=[o],s=o.block,!this.isCollapsed(i)){var d=0,c=this.getVisibleChildren(i),h={},f=[];h[this.id]=o;for(var p=0;p<c.length;p++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var g=c[p],v={item:g,levelsDeep:g.levelsDeep.get()-l+u,index:o.index+p+1,parentObject:h[g.parent().id]};h[g.id]=v,f.push(v)}r=r.concat(f)}}var y=m.default.offset(n),k=y.left,_=y.top;sr.PaneManager.runForEachPane(function(e){e.addScrollListener(t.dragScroll)});var S={x:e.clientX,y:e.clientY,items:r},P={dropEffect:i.dropEffect(this),item:this,element:n,block:s,pane:i};sr.DragDrop.start(this,r,k,_,i,S,P,a),m.default.disableMouseMove=!0}}},{key:"dragMove",value:function(e){try{m.default.PAssert(1177,sr.DragDrop.startInfo,"Must have started a drag to be valid")}catch(n){m.default.reportError(n)}if(sr.DragDrop.startInfo){"touchmove"===e.type&&(e.returnValue=!1,e.returnFalse=!0,m.default.preventAndStop(e));var t=e.clientX-sr.DragDrop.startInfo.x,a=e.clientY-sr.DragDrop.startInfo.y,i=m.default.elementFromPoint(e.clientX,e.clientY);sr.DragDrop.setTransform(t,a),i&&sr.DragDrop.handleDragOver({item:this,target:i,dataTransfer:sr.DragDrop.dataTransfer,diffY:e.diffY,clientX:e.clientX,clientY:e.clientY,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,stopImmediatePropagation:m.default.emptyFn})}}},{key:"dragScroll",value:function(e){if(sr.DragDrop.isDragging&&!isNaN(R.a.mousePos.x)&&!isNaN(R.a.mousePos.y)){var t={clientX:R.a.mousePos.x,clientY:R.a.mousePos.y,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,diffY:0};this.dragMove(t)}}},{key:"dragEnd",value:function(e){var t=this;m.default.disableMouseMove=!1,sr.DragDrop.stop(),e&&e.target!==document.documentElement&&sr.DragDrop.handleDrop({target:e.target,clientX:e.clientX,clientY:e.clientY,dataTransfer:sr.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,stopImmediatePropagation:m.default.emptyFn}),sr.DragDrop.finish(),sr.PaneManager.runForEachPane(function(e){e.getInfiniteList().hasScrollListener(t.dragScroll)&&e.removeScrollListener(t.dragScroll)}),m.default.disableMouseMove=!1}},{key:"checkDragOnStart",value:function(e){sr.DragDrop.escapedDragging=!1,sr.DragDrop.startDragItem=this,m.default.preventDefault(e),m.default.stopPropagation(e)}},{key:"checkDragOnMove",value:function(e,t){if(sr.DragDrop.startDragItem&&!sr.DragDrop.escapedDragging&&(!x.a.touch||Math.abs(e.distanceY)>m.default.ClickThreshold&&Math.abs(e.distanceX)<m.default.ClickThreshold)){var a=e.pane||m.default.focusedPane;sr.DragDrop.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,t)}sr.DragDrop.isDragging&&(this.dragMove(e),m.default.preventAndStop(e))}},{key:"checkDragOnEnd",value:function(e){sr.DragDrop.startDragItem=void 0,sr.DragDrop.isDragging&&this.dragEnd(e)}},{key:"onStart",value:function(e,t,a){var i=m.default.focusedPane,n=!1;return m.default.hasClass(a.target,"paneScroller")||(m.default.hasClass(a.target,"prefixNumList")||m.default.hasClass(a.target,"mdImage")?n=!0:m.default.hasClass(a.target,"emptyItemAddButton")?(sr.menus.openContextMenu({componentName:"ReactContextMenuAddItem",element:a.target,item:this,paneObject:t,pane:i}),n=!0):this.isDraggable()&&i.isItemDraggable()&&(m.default.hasClass(a.target,"collapser")||m.default.hasClass(a.target,"itemMenuIcon")||m.default.findParent(a.target,"agendaTime")||m.default.hasClass(a.target,"itemEditButton")||m.default.hasClass(a.target,"itemPrefix")||m.default.findParent(a.target,"plugin")&&!i.isEditable)?(this.checkDragOnStart(a),m.default.vmMain.updateCursorFromEvent(a)):m.default.hasClass(a.target,"itemCheckbox")||(m.default.hasClass(a.target,"blockHeaderNumItems")?n=!0:sr.pluginManager.handleTapStart(this,i,a))),n}},{key:"onMove",value:function(e,t){this.checkDragOnMove(e,!1)}},{key:"onClick",value:function(e,t,a){var i=m.default.focusedPane;if(m.default.hasClass(a.target,"blockCollapser"))t.block.toggleCollapsed();else if(m.default.hasClass(a.target,"prefixHeader")||m.default.hasClass(a.target,"prefixBullet"))i.zoomIn(this,{forLoad:!1,showToast:!0}),m.default.preventAndStop(a);else if((m.default.hasClass(a.target,"itemPrefix")||m.default.hasClass(a.target,"collapser")||m.default.hasClass(a.target,"itemMenuIcon"))&&(x.a.mac&&a.metaKey||!x.a.mac&&a.ctrlKey))i.zoomIn(this,{forLoad:!1,showToast:!0}),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"collapser"))i.handleLeftSideTap(t,a),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"itemMenuIcon"))this.openItemMenu(a),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"itemTime"))sr.menus.openContextMenu({componentName:"ReactContextMenuDate",element:a.target,item:this,pane:i}),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"link")){var n=a.target.getAttribute("data-href"),r=R.a.isSelected(e,i);r||x.a.mac&&a.metaKey||!x.a.mac&&a.ctrlKey||!m.default.isUrlImage(n)?(x.a.mac&&a.metaKey||!x.a.mac&&a.ctrlKey||m.default.findParent(a.target,"appLink",2)&&!r)&&(m.default.openUrl(n,a),m.default.preventAndStop(a)):(sr.menus.openLightbox(n),m.default.preventAndStop(a))}else if(m.default.hasClass(a.target,"itemCheckbox"))i.handleRightSideTap(this,a),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"prefixTask"))i.supportCompleting&&(m.default.beginCompleteAction(),this.setComplete(!this.isComplete(),v.a.ChangeType.Local),i.selectNearestItem(e),m.default.endCompleteAction()),m.default.preventAndStop(a);else if(m.default.hasClass(a.target,"itemAddButton")){var s=sr.settings.getDefaultItemText();this.addItemAtIndex({text:s},0,i);var o=i.indexOfNextVMLI(e,!1,!0);R.a.selectIndex(o,0),m.default.preventAndStop(a)}else if(m.default.hasClass(a.target,"itemEditButton"))R.a.reset(),sr.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:m.default.findParent(a.target,"item"),item:this,pane:i,selectIndex:0}),m.default.preventAndStop(a);else if("SPAN"===a.target.tagName&&m.default.hasClass(a.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(m.default.hasClass(a.target,"tag")||m.default.hasClass(a.target,"contact")){var l=a.target.textContent,u=x.a.mac&&a.metaKey||!x.a.mac&&a.ctrlKey,d=a.altKey;if((u||d)&&(R.a.reset(),O.a.reset()),u)i.search.toggleText(l,a.shiftKey);else if(d){F.d.beginAction(),sr.PaneUpdateBatcher.beginUpdateItems();var c=this.getParsedText();c=c.replace(new RegExp(l,"g"),"").replace(/  +/g," "),this.setText(c,v.a.ChangeType.Local),sr.PaneUpdateBatcher.commitUpdateItems(),F.d.endAction()}else if(m.default.hasClass(a.target,"contact")){var h=B.a.findMatchExact(l[0]===v.a.ContactPrefix?l.substr(1):l);h&&sr.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:a.target,contact:h})}}else if(m.default.hasClass(a.target,"email")){if(x.a.mac&&a.metaKey||!x.a.mac&&a.ctrlKey){var f=sr.pluginManager.getPluginGmail();if(f.isActive()){R.a.reset();var p={to:[{text:"",email:a.target.textContent}]};sr.menus.openComposeEmail(f,void 0,void 0,p)}}}else sr.pluginManager.handleTapClick(this,i,a)?sr.DragDrop.isDragging&&this.dragEnd(a):N.a.hide()}},{key:"onEnd",value:function(e){this.checkDragOnEnd(e),this.isLoupeOpen=!1,m.default.vmMain.updateCursorFromEvent(e)}},{key:"onCancel",value:function(e){sr.DragDrop.isDragging&&this.dragEnd(e)}},{key:"openItemMenu",value:function(e){sr.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+this.id+e.clientX+e.clientY,element:e.target,item:this,pane:m.default.focusedPane,pos:{left:e.pageX,top:e.pageY}})}},{key:"onRightClick",value:function(e,t){this.openItemMenu(t),m.default.preventDefault(t),m.default.stopPropagation(t)}},{key:"onDoubleClick",value:function(e,t){var a=m.default.focusedPane;sr.pluginManager.handleDoubleTap(this,a,t)&&sr.DragDrop.isDragging&&this.dragEnd(t)}}]),t}(e);return t}(J),!0),L.a.extendClass(J,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return g()(t,e),o()(t,[{key:"onChangeRemote",value:function(e,t){var a=this,i=!1,n=this.getRawText();Object.keys(e).map(function(r){var s,o=e[r];switch(r){case"text":a.onChangeRemoteText(o,t);break;case"parent":i||a.parent()&&a.parent().id===o&&(a.parent().hasChild(a)||a.isNote())||(a.onChangeRemoteParentOrIndex(e),i=!0);break;case"index":i||a.index===o||(a.onChangeRemoteParentOrIndex(e),i=!0);break;case"priority":a.setPriority(o||0,t);break;case"isComplete":a.setComplete(o||!1,t);break;case"isStarred":a.setStarred(o||!1,t);break;case"dateCompleted":a.dateCompleted=o?new Date(o):null,s=!0;break;case"date":a.setMooDate(j.a.fromData(o),t);break;case"note":o?a.addRemoteNote(o,t):a.hasNote()&&a.removeRemoteNote(t);break;case"dateModified":a.setDateModified(new Date(o));break;case"flags":var l=m.default.isFlagSet(o,v.a.VMLIFlag.Complete);a.isComplete()!==l?a.setComplete(l,t):a.setFlags(o),V.a.itemSearchChanged(a);break;case"isArchived":o!==a.isArchived()&&(o?a.archiveSelf(t):a.unArchive(t));break;case"isDeleted":o!==a.isDeleted()&&(o?a.deleteSelf(t):a.unDelete(t))}s&&a.parseText(n,t)})}},{key:"onChangeRemoteText",value:function(e,t){this.setText(e,t)}},{key:"onChangeRemoteParentOrIndex",value:function(e){var t=this.parent(),a=e.parent?_.a.getItem(e.parent):t;try{m.default.PAssert(1172,a,"Must have a new parent")}catch(s){m.default.reportError(s)}if(a){if(sr.PaneUpdateBatcher.beginUpdateItems(),32===(32&e.flags)||this.isNote())this.setParent(a),a.hasNote()&&a.getNote()===this||this.isDeleted()||a.setNote(this,v.a.ChangeType.Remote);else{if(void 0===e.index){var i=_.a.getItemDataLocal(this.getDocumentOwner(),e.id);i&&(e.index=i.index)}try{m.default.PAssert(1173,void 0!==e.index,"Index is undefined")}catch(s){m.default.reportError(s)}if(void 0!==e.index&&(this.index=e.index),!0!==e.isDeleted&&!this.isDeleted()&&!0!==e.isArchived&&!this.isArchived())if(t===a&&a.hasChild(this))a.items.sort(H.a.compareItemIndex);else{this.setParent(a);var n=void 0!==e.index?e.index:this.index,r=a.indexInItemFromStringIndex(n);a.items.splice(r,0,this),t&&t!==a&&t.items.remove(this)}}V.a.itemSearchChanged(this),sr.PaneUpdateBatcher.commitUpdateItems()}}},{key:"addRemoteNote",value:function(e,t){}},{key:"removeRemoteNote",value:function(e){}}]),t}(e);return t}(J),!0);var Z,$,ee,te,ae,ie,ne=J,re=(Z=function(){function e(t,a,i,n,s,o,l,u,d){r()(this,e),this.id=t,this.numItems=0;try{m.default.PAssert(540,m.default.isFunction(u),"Must supply a valid parser")}catch(c){m.default.reportError(c)}this._readonly=!!a,this._isDestructible=!!i,this._enabledFilters=l,this._trackGlobally=!!n,this._requireStoredEls=!!s,this._parser=u,this._owner=d,this._root=void 0,this._data={},this._destroyed=!1}return o()(e,[{key:"getParser",value:function(){return this._parser}},{key:"areFiltersEnabled",value:function(e){return m.default.isAtLeastOneFlagSet(this._enabledFilters,e)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"isOwner",value:function(e){return this._owner===e}},{key:"destroy",value:function(){try{m.default.PAssert(541,this._isDestructible,"Item store must be destructible to destroy")}catch(e){m.default.reportError(e)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){try{m.default.PAssert(542,!this._destroyed,"Should not be using a destroyed item store")}catch(e){m.default.reportError(e)}}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var e in sr.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();sr.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},v.a.ChangeType.None),this._root}},{key:"createItem",value:function(e,t,a,i,n,r){try{m.default.PAssert(543,a||i&&i.isRoot,"Must always specify a valid parentID when creating a new item")}catch(d){m.default.reportError(d)}this.checkDestroyed();try{m.default.PAssert(544,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(d){m.default.reportError(d)}var s;if(void 0===n&&(n=v.a.ChangeType.None),a){s=this._data[a];try{m.default.PAssert(545,s,"Parent must be valid if defined")}catch(d){m.default.reportError(d)}}var o={id:e,text:t};if(i)for(var l in i)i.hasOwnProperty(l)&&(o[l]=i[l]);var u=new ne(o,{store:this,parent:s,changeType:n,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:r});return this.numItems++,this._data[u.id]=u,u}},{key:"createItemRaw",value:function(e,t){try{m.default.PAssert(546,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(i){m.default.reportError(i)}this.checkDestroyed();try{m.default.PAssert(547,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(i){m.default.reportError(i)}try{m.default.PAssert(548,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(i){m.default.reportError(i)}t.store=this;var a=new ne(e,t);try{m.default.PAssert(549,!this._data[a.id],"Should not create an item that already exists in this store",function(){return m.default.safeStringify(e)})}catch(i){m.default.reportError(i)}return this._data[a.id]=a,this.numItems++,a}},{key:"destroyItem",value:function(e){try{m.default.PAssert(550,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(a){m.default.reportError(a)}var t=this._data[e];try{m.default.PAssert(551,t,"Must always destroy a valid item")}catch(a){m.default.reportError(a)}try{m.default.PAssert(552,!t.isDestroyed(),"Should never destroy an item twice")}catch(a){m.default.reportError(a)}t.parent()&&(t.parent().getChildIndex(t)>=0&&t.parent().removeChild(t,v.a.ChangeType.Local),t.setParent(void 0)),t.destroy(),delete this._data[e]}},{key:"removeItemFromStore",value:function(e){this._data[e].destroy(!0),delete this._data[e]}},{key:"modifyItemID",value:function(e,t){try{m.default.PAssert(553,e.belongsToItemStore(this),"Item must belong to this item store")}catch(a){m.default.reportError(a)}try{m.default.PAssert(554,e.id!==t,"Must actually be modifying the item ID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(555,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){m.default.reportError(a)}try{m.default.PAssert(556,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){m.default.reportError(a)}delete this._data[e.id],this._data[t]=e}},{key:"manualModifyItemID",value:function(e,t){try{m.default.PAssert(557,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(i){m.default.reportError(i)}var a=this._data[e];try{m.default.PAssert(558,a,"Must have valid item to change its ID")}catch(i){m.default.reportError(i)}a&&(delete this._data[e],this._data[t]=a)}},{key:"addItemToRoot",value:function(e){this._root.items.push(e)}},{key:"removeItemFromRoot",value:function(e){this._root.items.remove(e)}},{key:"getItem",value:function(e){return this.checkDestroyed(),this._data[e]}},{key:"hasItem",value:function(e){return this.checkDestroyed(),!!this._data[e]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(e){return this.checkDestroyed(),this._root===e}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])}},{key:"_markPaneDirty",value:function(e){e.usesItemStore(this)&&e!==m.default.focusedPane&&e.setItemsDirty()}},{key:"updateItems",value:function(e){var t=this;e&&!e.belongsToItemStore(this)||(sr.PaneManager.runForEachPane(function(a){a.usesItemStore(t,e)&&(a.preventUpdateItemsForItem&&a.preventUpdateItemsForItem.item===e||a.setItemsDirty())}),sr.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(e,t){var a,i=this;e&&!e.belongsToItemStore(this)||(sr.PaneManager.runForEachPane(function(n){if(n.usesItemStore(i,e)){var r=n.handleItemChanged(e,t);a=a||r}}),sr.PaneUpdateBatcher.updateAllItemHeights()),a&&sr.PaneUpdateBatcher.updateAllItems()}}]),e}(),D()(Z.prototype,"_markPaneDirty",[C.a],Object.getOwnPropertyDescriptor(Z.prototype,"_markPaneDirty"),Z.prototype),D()(Z.prototype,"updateItems",[C.a],Object.getOwnPropertyDescriptor(Z.prototype,"updateItems"),Z.prototype),Z),se=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this)))._itemStores={},e._iteratingStores=!1,e.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},e}return g()(t,e),o()(t,[{key:"init",value:function(){var e=v.a.ItemStoreFilter.Dates|v.a.ItemStoreFilter.Priority;this.registerItemStore("DefaultStore",void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(e,t,a){try{m.default.PAssert(296,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(c){m.default.reportError(c)}try{m.default.PAssert(297,!this._iteratingStores,"Should never add a store while iterating")}catch(c){m.default.reportError(c)}var i=!0,n=!0,r=!0,s=!0,o=!1,l=v.a.ItemStoreFilter.None,u=U.a.runParseText;a&&(void 0!==a.isReadonly&&(i=a.isReadonly),void 0!==a.isDestructible&&(n=a.isDestructible),void 0!==a.enabledFilters&&(l=a.enabledFilters),void 0!==a.parserFn&&(u=a.parserFn),void 0!==a.trackGlobally&&(r=a.trackGlobally),void 0!==a.requireStoredEls&&(s=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(o=a.listenToItemStateChanged));var d=new re(e,i,n,r,s,o,l,u,t);return a&&a.noRegister||(this._itemStores[e]=d,this.fireEvent(this.Events.StoreAdded,d.getEnabledFilters(),[d])),d}},{key:"unregisterItemStore",value:function(e){try{m.default.PAssert(298,this._itemStores[e],"Must register an item store before destroying it")}catch(a){m.default.reportError(a)}try{m.default.PAssert(299,!this._iteratingStores,"Should never remove a store while iterating")}catch(a){m.default.reportError(a)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}},{key:"getItemStore",value:function(e){try{m.default.PAssert(300,this._itemStores[e],"Must register an item store before using it")}catch(t){m.default.reportError(t)}return this._itemStores[e]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(e,t){for(var a in t=t||v.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(a)){var i=this._itemStores[a];if(t===v.a.ItemStoreFilter.None||i.areFiltersEnabled(t))try{e(i)}catch(n){m.default.reportError(n)}}this._iteratingStores=!1}}]),t}(E.a),oe=a(57),le=($=function(){function e(){r()(this,e),this.enableTempPanePosition=!1,this.totalWidth=new z.a(0),this._panesById={},this._panes=new q.a,this.displayPanes=new q.a,this.isLoading=new z.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}return o()(e,[{key:"init",value:function(){}},{key:"load",value:function(){sr.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),x.a.onResize.listen(this.onResize),k.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"getStats",value:function(e){var t={};return void 0===e?this.runForEachPane(function(e){t[e.id]=e.getStats()}):t=this.getPaneById(e).getStats(),t}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++m.default.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(e,t){for(var a=0,i=[],n=this.paneCount(),r=0;r<n;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this.getPaneAtIndex(r);i.push(s.getPerPaneState(e,t))}return i}},{key:"setAllPerPaneState",value:function(e,t,a){for(var i=0,n=this.paneCount(),r=0;r<n;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.getPaneAtIndex(r).setPerPaneState(e,t,a)}}},{key:"deletePerPaneState",value:function(e,t){var a=this.getPaneById(e);a&&a.deletePerPaneState(t)}},{key:"updatePaneStateForPane",value:function(e){try{m.default.PAssert(579,e,"Must pass in a valid pane to update")}catch(t){m.default.reportError(t)}this.savePaneState()}},{key:"recreatePaneState",value:function(){var e=[];return this.runForEachPane(function(t){e.push(t.getSaveInfo())}),e}},{key:"isPaneActive",value:function(e){return!!this._panesById[e]}},{key:"createPaneAtIndex",value:function(e,t,a,i){try{m.default.PAssert(580,e,"Must supply a valid pane type")}catch(r){m.default.reportError(r)}try{m.default.PAssert(581,!this._iteratingPanes,"Should not change pane array while iterating")}catch(r){m.default.reportError(r)}isNaN(t)&&(t=this.paneCount()),(a=a||{}).id=a.id||this.getNextPaneID(),a.document=a.document||_.a.getDefaultDocument(),m.default.isString(a.item)&&(a.item=_.a.getItem(a.item));var n=oe.a.createPane(e,a);return n?this.addPaneAtIndex(n,t,!1,i):m.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),n}},{key:"addPaneAtIndex",value:function(e,t,a,i){try{m.default.PAssert(582,e,"Must supply a valid pane")}catch(s){m.default.reportError(s)}this._panesById[e.id]&&(e.id=this.getNextPaneID());try{m.default.PAssert(583,!this._panesById[e.id],"Should never add the same pane twice")}catch(s){m.default.reportError(s)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var n=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:n,left:n.rect.get().left+v.a.PaneSpaceSize}}if(isNaN(t)?this._panes.push(e,i):this._panes.splice(t,0,e,i),e.init(),e.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!a){var r=this.getPaneState();isNaN(t)?r.push(e.getSaveInfo()):r.splice(t,0,e.getSaveInfo()),this.savePaneState()}}},{key:"unloadPane",value:function(e){e.unload(),e.isExpanded.unlisten(this.onResize),k.a.fireEvent("paneRemoved",[e]);try{m.default.PAssert(584,this._panesById[e.id],"Should never add the same pane twice")}catch(t){m.default.reportError(t)}this._panesById[e.id]=void 0,e.destroy()}},{key:"removePaneAtIndex",value:function(e,t){try{m.default.PAssert(585,!isNaN(e),"Must supply a valid index to remove from")}catch(n){m.default.reportError(n)}try{m.default.PAssert(586,!this._iteratingPanes,"Should not change pane array while iterating")}catch(n){m.default.reportError(n)}var a,i=this._panes.splice(e,1,void 0,t)[0];try{m.default.PAssert(587,i,"Must have removed a valid pane")}catch(n){m.default.reportError(n)}return this.unloadPane(i),this.getPaneState().splice(e,1),this.savePaneState(),a=i.id,this.ensurePaneInView(),a}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,a=t&&_.a.getItem(t),i=e.document,n=_.a.getDocumentById(i);a&&a.isDeleted()&&(a=void 0);var r,s=e.type||"PaneTask",o=m.default.clone(e);return o.item=a,o.document=n,o.deferredItemID=a?void 0:t,o.offset=e.offset,o.id&&this.isPaneActive(o.id)||(r=oe.a.createPane(s,o))&&(e.id=r.id,e.showarch&&r.showArchived.set(!0),r.applyItemState(e.itemState)),r}},{key:"removeFocusedPane",value:function(){return this.removePane(m.default.focusedPane)}},{key:"removePane",value:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}},{key:"clearPanes",value:function(e){try{m.default.PAssert(588,m.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){m.default.reportError(t)}R.a.setFocusedPane(void 0),this.runForEachPane(function(e){e.destroy()}),this._panesById={},this._panes.set([],e)}},{key:"clearPaneCaches",value:function(){this.runForEachPane(function(e){e.getInfiniteList().clearCache()})}},{key:"getPaneAtIndex",value:function(e){return this._panes.get()[e]}},{key:"getPaneIndex",value:function(e){return this._panes.get().indexOf(e)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(m.default.focusedPane)}},{key:"getPaneById",value:function(e){try{m.default.PAssert(591,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(t){m.default.reportError(t)}return this._panesById[e]}},{key:"getPaneByName",value:function(e){try{m.default.PAssert(592,this._panesByName[e],"Should never request a pane that is not currently loaded")}catch(t){m.default.reportError(t)}return this._panesByName[e]}},{key:"getPanesByType",value:function(e){for(var t=0,a=[],i=this.paneCount(),n=0;n<i;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.getPaneAtIndex(n);e&&r.type!==e||a.push(r)}return a}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(e,t){var a=0;this._iteratingPanes=!0;for(var i=this.paneCount(),n=0;n<i;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.getPaneAtIndex(n);try{m.default.PAssert(593,!r.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(s){m.default.reportError(s)}if(!t||r.type===t)try{e(r)}catch(o){m.default.reportError(o)}}this._iteratingPanes=!1}},{key:"applyFnToPanes",value:function(e,t){var a=0;this._iteratingPanes=!0;for(var i=this.paneCount(),n=0;n<i;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.getPaneAtIndex(n);try{m.default.PAssert(594,!r.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){m.default.reportError(o)}if(!t||r.type===t){var s=r[e];try{m.default.PAssert(595,s,"Must provide a valid function name for the given pane type")}catch(o){m.default.reportError(o)}try{s.apply(r,Array.prototype.slice.call(arguments,2))}catch(l){m.default.reportError(l)}}}this._iteratingPanes=!1}},{key:"dragPaneTo",value:function(e,t,a){for(var i,n=0,r=this._panes.get(),s=r.indexOf(e),o=-1,l=Number.MAX_VALUE,u=this.paneCount(),d=0;d<u;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=this.getPaneAtIndex(d).rect.get(),h=Math.abs(d<=s?c.left-t:c.right-a);h<l&&(l=h,o=d)}if(o>=0){var f=r.indexOf(e);f!==o&&(r.splice(o,0,r.splice(f,1)[0]),this._panes.set(r),this.savePaneState(),i=!0)}return i}},{key:"paneSortFn",value:function(e,t){return e.uniquePaneID-t.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,sr.toasts.clearMessage(v.a.MessageID.PaneLoadTimeout)}},{key:"updateDisplayPanes",value:function(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),a=[],i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[i];n.isOverviewVisible()&&a.push({type:"overview",pane:n}),a.push({type:"pane",pane:n}),n.isExpanded.get()&&a.push({type:"emailPreview",pane:n})}this.updatePaneRects(),this.displayPanes.set(a),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>x.a.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(e,t,a,i){var n=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:a});return n&&(F.d.performAction(F.b.UIAction,{type:F.c.AddPane,data:{type:e,pane:n}}),m.default.sendEvent("Menu","AddPane_"+e)),R.a.setFocusedPane(n),n.onAdded(),n}},{key:"addPaneByButton",value:function(e,t,a){if(oe.a.canCreatePane(e))return this._addPaneByButton(e,t,a)}},{key:"emailPreviewSize",value:function(e){var t=this._panes.length()>1?v.a.EmailPreviewSizeMaxFlex:v.a.EmailPreviewSizeMax,a=e.widthManual||v.a.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(a+=v.a.OverviewWidth),Math.max(Math.min(t,x.a.windowWidth()-a),v.a.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}]),e}(),D()($.prototype,"onResize",[C.a],Object.getOwnPropertyDescriptor($.prototype,"onResize"),$.prototype),D()($.prototype,"updateDisplayPanes",[C.a],Object.getOwnPropertyDescriptor($.prototype,"updateDisplayPanes"),$.prototype),$),ue=a(33),de=(ee=function(e){function t(){return r()(this,t),u()(this,c()(t).call(this))}return g()(t,e),o()(t,[{key:"load",value:function(){var e=this;this.isLoaded||(ue.a.init(),f()(c()(t.prototype),"load",this).call(this),sr.DesktopUI.sidebarChanged.listen(this.onResize),sr.intro&&setTimeout(function(){sr.intro.isVisible.listen(e.onResize)},0))}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadPanesFromState",value:function(){this.load();var e=this.getPaneState();if(e){var t=0,a=!1;this._isLoading=!0;var i=[];if(sr.PaneUpdateBatcher.beginUpdateItems(),this.paneCount()>0){for(var n=0,r=0;r<this.paneCount();++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this.getPaneAtIndex(r);i.push(s.id),this.unloadPane(s)}this._panes.set([],!1)}for(var o=0;o<e.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=e[o];i.indexOf(l.id)>=0&&(l.id=this.getNextPaneID());var u=this.loadPaneFromState(l);u?(this.addPaneAtIndex(u,void 0,!0,!1),u.zoomIn(u.getItem(!0),{forLoad:!0})):(e.splice(o,1),a=!0,--o)}this.paneCount()>0&&R.a.setFocusedPane(this.getPaneAtIndex(0)),this._isLoading=!1,a&&this.savePaneState(),this.notifyPanes(),sr.PaneUpdateBatcher.commitUpdateItems()}}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,a=t&&_.a.getItem(t),i=e.document,n=_.a.getDocumentById(i);a&&a.isDeleted()&&(a=void 0);var r,s=e.type||"PaneTask",o=m.default.clone(e);return o.item=a,o.document=n,o.deferredItemID=a?void 0:t,o.offset=e.offset,this._panesById[e.id]&&(e.id=this.getNextPaneID()),o.id&&this.isPaneActive(o.id)||(r=oe.a.createPane(s,o))&&(e.id=r.id,e.showarch&&r.showArchived.set(!0),r.applyItemState(e.itemState)),r}},{key:"savePaneState",value:function(){try{m.default.PAssert(347,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(t){m.default.reportError(t)}if(this._isInitialStateLoaded&&sr.settings.activeUser.get()){var e=this.recreatePaneState();ue.a.savePaneState(e)}}},{key:"getPaneState",value:function(){return ue.a.getPaneState()}},{key:"hasLoadedPaneState",value:function(){return ue.a.hasLoadedPaneState()}},{key:"loadInitialState",value:function(){var e=m.default.isDemoMode()&&L.a.getURLParam("panes"),t=e&&e.split(":");t?this.loadDemoPanes(t):this.loadPanesFromState(),ue.a.selectedChanged.listen(this.onBoardChanged.bind(this)),this._isInitialStateLoaded=!0}},{key:"addBoard",value:function(){var e=ue.a.add();return this.switchToBoard(e),e}},{key:"switchToBoard",value:function(e){ue.a.switchTo(e)}},{key:"removePanesByType",value:function(e){var t=0,a=[];this.runForEachPane(function(e){a.push(e)},e);for(var i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.removePane(a[i])}}},{key:"getAvailableArea",value:function(){return sr.DesktopUI.getSidebarWidth()-2}},{key:"updatePaneRects",value:function(e){this.isResizingPane=e;var t,a=this._panes.get(),i=sr.DesktopUI.getSidebarWidth(),n=x.a.windowWidth()-(sr.DesktopUI.getSidebarWidth()-2),r=x.a.windowHeight()-sr.DesktopUI.topBarHeight();if(m.default.isDemoInIframe()&&(n-=5),a.length>0){var s,o,l=0,u=0,d=0,c=v.a.PaneSpaceSize,h=[],f=[],p=0;for(t=0;t<a.length;t++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var g=a[t];g.widthManual?(f[t]=g.widthManual,p+=g.widthManual):g.isExpanded.get()?(f[t]=v.a.ExpandedPaneWidth,p+=v.a.ExpandedPaneWidth):h.push({index:t,pane:g}),g.isExpanded.get()&&(p+=g.widthManualExpanded||this.emailPreviewSize(g)),g.getOverview().isVisible.get()?p+=v.a.OverviewWidth:t>0&&(p+=c)}for(var y=n-p;h.length>0;){var _=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var S=Math.floor(y/h.length),P=-1,w=S;for(t=0;t<h.length;t++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;var I=h[t].pane;I.maxWidthFlex<w&&(P=t,w=I.maxWidthFlex)}if(P>=0){var b=h[P].pane;s=Math.min(1===a.length?b.widthBiggerInSingle?b.maxWidthSingle:b.maxWidthFlex:h[P].pane.maxWidthFlex,y),f[h[P].index]=s,p+=s,y-=s,h.splice(P,1)}else{var D=0,E=-1,C=S;for(t=0;t<h.length;t++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;var A=h[t].pane;A.minWidthFlex>C&&(E=t,C=A.minWidthFlex)}if(!(E>=0)){var M=0;for(t=0;t<h.length;t++){if(M++>5e3&&__infLoop&&__infLoop(M))throw new RangeError;f[h[t].index]=S,p+=S}break}s=h[E].pane.minWidthFlex,f[h[E].index]=s,p+=s,y-=s,h.splice(E,1)}}var T=Math.max((n-p)/2,0),L=Math.floor(T)+i,R=!1;for(L!==Math.round(T)&&(R=p+1===n),m.default.isDemoInIframe()&&(L+=2),t=0;t<a.length;t++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var O=a[t];s=f[t]+(R&&t===a.length-1?1:0),o=O.isExpanded.get()?O.widthManualExpanded||this.emailPreviewSize(O):0,O.isOverviewVisible()?L+=v.a.OverviewWidth:0!==t&&(L+=c),this.tempPositionForNewPane&&O.rect.get()?(O.rect.get().width=s,O.rect.notify()):O.rect.set({left:L,top:0,width:s,height:r,right:L+s,bottom:r,isFirst:0===t,widthExpanded:o}),L+=s,O.isExpanded.get()&&(L+=o)}sr.intro&&sr.intro.isVisible&&sr.intro.isVisible.get()&&(L+=c,sr.intro.position.set(L))}if(this.tempPositionForNewPane){var F=a[a.length-1].rect.get(),N=this.tempPositionForNewPane;F.left=N.left+N.pane.rect.get().width}this.totalWidth.set(L),e||k.a.fireEvent("paneSizeChanged",[])}},{key:"ensurePaneInView",value:function(e){if(m.default.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var a=e.rect.get();if(a){var i=a.width+(e.isExpanded.get()?a.widthExpanded:0),n=x.a.windowWidth()-(sr.DesktopUI.getSidebarWidth()-2),r=m.default.vmMain.getScrollOffset(),s=a.left-r,o=a.left+i-r;(s<0||o>n)&&m.default.vmMain.setScrollOffset(a.left+i-n)}}}}},{key:"scrollToAndHighlightItem",value:function(e,t){e.highlight(),this.runForEachPane(function(a){if(a!==t){var i=a.indexOfItem(e);if(i<0&&a.type===v.a.PaneMode.Task&&a.isViewOutline()&&e.isDescendantOf(a.item.get())&&a.search.isMatched(e)){var n=0;sr.PaneUpdateBatcher.beginUpdateItems();for(var r=e.parent();r&&r!==a.item.get();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.isCollapsed(a,!1)&&(a.setIgnoreRestoreScroll(),r.setCollapsed(!1,a,!1)),r=r.parent()}sr.PaneUpdateBatcher.commitUpdateItems(),i=a.indexOfItem(e)}i>=0&&a.scrollIndexToMiddle(i,v.a.ScrollDuration.Default)}})}},{key:"_timeoutLoadFailed",value:function(){0===this._panes.length()&&0===sr.menus.modalStack.length()&&(m.default.reportError(new Error("Pane Load Timeout")),sr.toasts.pushMessage(v.a.MessageID.PaneLoadTimeout))}},{key:"loadDemoPanes",value:function(e){var t=0;this.load(),sr.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a].split(",");if("help"===i[0])m.default.vmMain.showHelp();else{var n=i[0],r={document:_.a.getDefaultDocument()};if("1"===n||"Outline"===n?(n=v.a.PaneMode.Task,r.viewState={viewMode:v.a.TaskViewMode.Outline}):("2"===n||"Calendar"===n)&&(n=v.a.PaneMode.Task,r.viewState={viewMode:v.a.TaskViewMode.Calendar_Week}),i.length>1){if(i[1]){for(var s=0,o={text:i[1]},l=i[1].split(" "),u=0;u<l.length;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=!1,c="-"===l[u][0],h=l[u].replace("-","");if(h.indexOf("//")>=0)d=!0,o.complete=c?-1:1;else if(h.indexOf("*")>=0)d=!0,o.starred=c?-1:1;else if(h.indexOf("!")>=0){var f;d=!0,3===h.length?f=v.a.VMLIFlag.P0:2===h.length?f=v.a.VMLIFlag.P1:1===h.length&&(f=v.a.VMLIFlag.P2),o.priority=f}d&&(o.text=o.text.replace(l[u],""))}r.search=o}var p=void 0;i[2]&&(p=_.a.getItem(i[2])),r.item=p}var g=oe.a.createPane(n,r);g&&this.addPaneAtIndex(g)}}var y=this.getPaneAtIndex(0);try{m.default.PAssert(348,y,"Must always have at least one valid pane in demo mode")}catch(k){m.default.reportError(k)}y&&(R.a.setFocusedPane(y),y.zoomIn(y.getItem(),{forLoad:!0})),this.notifyPanes(),sr.PaneUpdateBatcher.commitUpdateItems()}}]),t}(le),D()(ee.prototype,"savePaneState",[C.a],Object.getOwnPropertyDescriptor(ee.prototype,"savePaneState"),ee.prototype),ee),ce=a(158),he=a(63),fe=new(te=function(){function e(){r()(this,e),this.scheduledItems=[],this.notifiedItems={},this.timeouts={},this.timeoutNextNotification=void 0,this.frequency=15*v.a.MSPerMinute}return o()(e,[{key:"scheduleItems",value:function(e){var t=this;this.scheduledItems=e,x.a.hasNotificationPermission()?this.runNotifications():Notification.requestPermission(function(){t.runNotifications()})}},{key:"runNotifications",value:function(){for(var e=0,t=0;t<this.scheduledItems.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.scheduledItems[t];this.notifiedItems[a.id]&&this.notifiedItems[a.id]===a.date||this.runNotification(a)}m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Next Notifications in: ",this.frequency),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,this.frequency)}},{key:"runNotification",value:function(e){var t=e.id,a=new Date,i=e.alertDate,n=Math.max(i.getTime()-a.getTime(),0);n<0&&this.doNotification(e),n>=0&&n<=this.frequency?(clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(this.doNotification.bind(this,e),n)):this.notifiedItems[t]=e.date}},{key:"doNotification",value:function(e){var t=e.date,a=Math.ceil((t.getTime()-Date.now())/v.a.MSPerMinute);new Notification(e.text,{body:a>0?"in "+a+" minutes":"now",icon:x.a.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[e.id]=e.date,m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Show HTML5 Notification: ",e)}}]),e}(),D()(te.prototype,"runNotifications",[C.a],Object.getOwnPropertyDescriptor(te.prototype,"runNotifications"),te.prototype),te),pe=new(function(){function e(){r()(this,e)}return o()(e,[{key:"setNotifications",value:function(e){x.a.usesHTML5Notifications()?(fe.scheduleItems(e),m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("HTML5 Scheduling Completed: ",e.length)):sr.nativeBridge.isEnabled()?sr.nativeBridge.sendToApp("scheduledItems",this.convertForSend(e)):sr.nativeBridge.hasEmbedBridge()&&sr.nativeBridge.sendToEmbed("scheduledItems",this.convertForSend(e))}},{key:"convertForSend",value:function(e){return e.map(function(e){return{id:e.id,text:e.text,date:e.date.toJSON(),alertDate:e.date.toJSON()}})}}]),e}()),ge=(ae=function(){function e(){r()(this,e),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=sr.settings.agendaSort}return o()(e,[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(e){try{m.default.PAssert(293,e,"Must provide a valid item to schedule notifications for")}catch(t){m.default.reportError(t)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Add Notification: ",e)}},{key:"removeNotification",value:function(e){try{m.default.PAssert(294,e,"Must provide a valid item to unschedule notifications for")}catch(t){m.default.reportError(t)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Remove Notification: ",e))}},{key:"clearNotifications",value:function(){for(var e in this.notificationItems)this.notificationItems.hasOwnProperty(e)&&(this.notificationItems[e]=void 0,this.numNotificationItemsChanged++);clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Clear Notifications")}},{key:"shouldNotify",value:function(e,t){var a=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&a&&a>t&&+a-Date.now()<864e5}},{key:"updateNotifications",value:function(e){var t=this;if(x.a.supportsNotifications()&&he.a.isNotificationsEnabled()&&!m.default.isDemoMode()){var a=new Date;e?(m.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,a)?this.addNotification(e):this.removeNotification(e)):(m.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),_.a.runOnAllDocumentRoots(function(e){m.default.searchVMLIs({item:e,each:function(e){t.shouldNotify(e,a)&&t.addNotification(e)}})}))}}},{key:"setupNotifications",value:function(){try{m.default.PAssert(295,x.a.supportsNotifications(),"Platform must support notifications")}catch(n){m.default.reportError(n)}var e=[];for(var t in this.notificationItems)if(this.notificationItems.hasOwnProperty(t)){var a=this.notificationItems[t];if(a&&a.getNotificationEntry){var i=a.getNotificationEntry();i&&e.push(i)}else delete this.notificationItems[t]}pe.setNotifications(e),m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,m.default.shouldLog(v.a.LogLevels.Timeline)&&m.default.log("Scheduled Notifications: ",e)}},{key:"getDateForKey",value:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}},{key:"saveAgendaSort",value:function(e){this.agendaSort.set(e),sr.settings.agendaSort.set(e),sr.PaneManager.runForEachPane(function(e){e.isViewAgenda()&&e.setItemsDirty()}),sr.PaneUpdateBatcher.updateAllItems()}}]),e}(),D()(ae.prototype,"updateNotifications",[C.a],Object.getOwnPropertyDescriptor(ae.prototype,"updateNotifications"),ae.prototype),D()(ae.prototype,"setupNotifications",[C.a],Object.getOwnPropertyDescriptor(ae.prototype,"setupNotifications"),ae.prototype),ae),me=function(){function e(){r()(this,e),this._registeredRenderers=[],this._registeredRenderers[v.a.PluginRenderTypes.Generic]={},this._registeredRenderers[v.a.PluginRenderTypes.StyledText]={},this._registeredRenderers[v.a.PluginRenderTypes.UnstyledText]={},this._registeredRenderers[v.a.PluginRenderTypes.Measure]={}}return o()(e,[{key:"registerDefaultRenderers",value:function(){var e=this;this.registerRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.DriveFile,function(e,t,a,i){if(e.isLoaded()){var n=e.getField("title");return i&&i.highlightSearch&&(n=sr.ElementRenderer.replaceTextWithSearch(n,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?n+"  (Deleted)":n}return e.hasField("title")?e.getField("title")+"  (Loading...)":e.isLocalOnlyAttachment()?"Failed upload":"Loading..."},["title"]),this.registerRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.DriveFile,function(e){return e.hasField("title")?e.getField("title"):"Loading..."},["title"]),this.registerRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.DriveFile,function(t,a,i){var n=e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.DriveFile);return sr.Measure.measureWord(a,n(t),i,!1)},["title"]),this.registerRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.EmailThread,function(e,t,a,i){var n="";if(e&&e.isLoaded()){var r=e.getField("count"),s=e.getPlugin(),o=e.getField("subject");if(o&&""!==o||(o="(no subject)"),i&&i.highlightSearch&&(o=sr.ElementRenderer.replaceTextWithSearch(o,t)),o='<span class="subject c-foreground">'+o+"</span>",t&&t.type===v.a.PaneMode.Gmail){var l=s.getDisplayTags(e,t);n+='<span class="line1"><span class="from">'+s.getDisplayParticipants(e)+"</span>";var u,d=e.getField("date");if(u=d.isToday()?sr.International.getFormat(v.a.DFormat.ShortTime):d.getYear()!==(new Date).getYear()?sr.International.getFormat(v.a.DFormat.MonthDayYearShort):sr.International.getFormat(v.a.DFormat.MonthDay),n+='<span class="emailDate c-foreground-faded">'+d.toString(u)+"</span></span>",n+='<span class="line2">'+o,(e.getField("hasAttachments")||r>1)&&(n+='<span class="line2Right">',e.getField("hasAttachments")&&(n+='<span class="attach icon-attach_file"></span>'),r>1&&(n+='<span class="count">'+r+"</span>"),n+="</span>"),n+="</span>",e.hasField("snippet")||l.length){if(n+='<span class="line3">',e.hasField("snippet")&&(n+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),l.length){var c=0;n+='<span class="tags">';for(var h=0;h<l.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;n+='<span class="emailLabel c-tag">'+l[h]+"</span>"}n+="</span>"}n+="</span>"}}else n=o}else n="Loading...";return n},["from","subject","snippet","count","date"]),this.registerRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.EmailThread,function(e){if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)")," "+t+" "}return"Loading..."},["from","subject"]),this.registerRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.EmailThread,function(e,t,a){var i;return e.isLoaded()?(i=e.getField("subject"))&&""!==i||(i="(no subject)"):i="Loading...",sr.Measure.measureWord(t,i,a,!1)},[]),this.registerRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.CalendarEvent,function(e){return""},[]),this.registerRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.CalendarEvent,function(t,a,i){var n=e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.CalendarEvent);return sr.Measure.measureWord(a,n(t),i,!1)},[]),this.registerRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.Unknown,function(e){return"Unknown Plugin"},[]),this.registerRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.Unknown,function(e,t,a){return sr.Measure.measureWord(t,"Unknown Plugin",a,!0)},[])}},{key:"registerRenderer",value:function(e,t,a,i){try{m.default.PAssert(603,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(n){m.default.reportError(n)}try{m.default.PAssert(604,!this._registeredRenderers[e][t],"Cannot register a renderer twice",e,t)}catch(n){m.default.reportError(n)}this._registeredRenderers[e][t]={fn:a,fields:i}}},{key:"useRenderer",value:function(e,t){try{m.default.PAssert(605,this._registeredRenderers[e],"Invalid renderer type",e,t)}catch(a){m.default.reportError(a)}try{m.default.PAssert(606,this._registeredRenderers[e][t],"Renderer has not been registered yet",e,t)}catch(a){m.default.reportError(a)}return this._registeredRenderers[e][t].fn}},{key:"ensureRendererFields",value:function(e,t,a){}}]),e}(),ve=a(26),ye=a(41),ke={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7},_e=function(){function e(t,a,i){r()(this,e),this.id=a,this._oldLocalID=void 0,this._plugin=t,this._loadState=ke.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=i,this.load()}return o()(e,[{key:"load",value:function(e){this._loadState=ke.Waiting,this._plugin.requestData(this,e)}},{key:"notifyDataRequested",value:function(){try{m.default.PAssert(1465,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){m.default.reportError(e)}this._numRemoteRequests++,this._loadState=ke.Requesting}},{key:"notifyDataLoaded",value:function(e,t,a,i){try{m.default.PAssert(1466,t||this._loadState!==ke.LoadedFull||m.default.isFlagSet(e,v.a.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1467,!t||this._loadState===ke.LoadedPreview||m.default.isFlagSet(e,v.a.PluginLoad.Full),"Incoming update much match previous type")}catch(n){m.default.reportError(n)}this._loadState=m.default.isFlagSet(e,v.a.PluginLoad.Full)?ke.LoadedFull:ke.LoadedPreview,this.onUpdate(!0,a,i)}},{key:"notifyDataMutated",value:function(e,t){try{m.default.PAssert(1468,e&&m.default.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(a){m.default.reportError(a)}this.onUpdate(!0,e,t)}},{key:"notifyDataRequestFailed",value:function(){try{m.default.PAssert(1469,this._loadState===ke.FailedRequest||this._loadState===ke.Requesting||this._loadState===ke.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){m.default.reportError(e)}if(this._loadState===ke.FailedRequest);else if(this._loadState===ke.Requesting)this._loadState=ke.FailedRequest;else if(this._loadState===ke.LoadedPreview)try{m.default.PAssert(1470,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){m.default.reportError(e)}else try{m.default.PAssert(1471,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){m.default.reportError(e)}}},{key:"isLoaded",value:function(){return this._loadState===ke.LoadedPreview||this._loadState===ke.LoadedFull}},{key:"needsRemoteData",value:function(){return this._loadState!==ke.LoadedFull}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(e){try{m.default.PAssert(1472,this.id!==e,"Change the ID of an attachment to the same value")}catch(n){m.default.reportError(n)}if(this.id!==e){var t=0,a=this.id;this.id=e,this._oldLocalID=a;try{m.default.PAssert(1473,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(n){m.default.reportError(n)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[i].onAttachmentIDChange(this,a)}catch(r){m.default.reportError(r)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var e=0;try{m.default.PAssert(1474,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(n){m.default.reportError(n)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._subscribers[t];try{var i=a.onAttachmentIDChange.bind(a,this,this.id);setTimeout(i,0)}catch(r){m.default.reportError(r)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(e){return this._plugin.isFieldDefined(e)}},{key:"hasField",value:function(e){return this._plugin.hasAttachField(this,e)}},{key:"getField",value:function(e){return this._plugin.getAttachField(this,e)}},{key:"updateField",value:function(e,t,a,i){return this._plugin.updateAttachField(this,e,t,a,i)}},{key:"fieldsHaveParseEffect",value:function(e){return this._plugin.fieldsHaveParseEffect(e)}},{key:"isFieldDefault",value:function(e){return this._plugin.isAttachFieldDefault(this,e)}},{key:"fieldNeedsWrite",value:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}},{key:"getFieldAsDate",value:function(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(sr.International.getFormat(v.a.DFormat.MonthDay));try{m.default.PAssert(1475,!1,"Invalid attachment date field: ",this._plugin.id,e)}catch(a){m.default.reportError(a)}}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=ke.Unloaded,this._plugin.releaseAttachment(this)}},{key:"match",value:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}},{key:"markInUse",value:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}},{key:"markUnused",value:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{m.default.PAssert(1476,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){m.default.reportError(t)}}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(e){try{m.default.PAssert(1477,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1478,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1479,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){m.default.reportError(t)}this._subscribers.push(e)}},{key:"unsubscribe",value:function(e){try{m.default.PAssert(1481,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1482,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){m.default.reportError(t)}this._subscribers.remove(e)}},{key:"forEachItem",value:function(e,t){var a=0;try{m.default.PAssert(1484,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(n){m.default.reportError(n)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(m.default.isVMLI(this._subscribers[i])&&(!e||this._subscribers[i].belongsToItemStore(e)))try{t(this._subscribers[i])}catch(r){m.default.reportError(r)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(e,t,a){var i=0;try{m.default.PAssert(1485,!t||m.default.isArray(t),"Must supply a valid value for updateFields:",t)}catch(s){m.default.reportError(s)}if(a=a||v.a.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(o){m.default.reportError(o)}if(e||(a|=v.a.ChangeType.PluginLoad),t)for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{m.default.PAssert(1486,this._plugin.isFieldDefined(t[r]),"Invalid field supplied to be updated: ",t[r])}catch(s){m.default.reportError(s)}}try{m.default.PAssert(1487,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){m.default.reportError(s)}this._iteratingSubscribers=!0;for(r=0;r<this._subscribers.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{this._subscribers[r].onAttachmentUpdate(this,t,a)}catch(o){m.default.reportError(o)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(e){this._plugin.notifyItemNoteChanged(this,e)}},{key:"notifyItemTextChanged",value:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)}},{key:"notifyItemDateChanged",value:function(e){this._plugin.notifyItemDateChanged(this,e)}},{key:"notifyItemPropertyChanged",value:function(e,t,a){this._plugin.notifyItemPropertyChanged(this,e,t,a)}},{key:"isLocalOnlyAttachment",value:function(){return m.default.isTempId(this.id)}},{key:"isType",value:function(e){return this._plugin.getType()===e}},{key:"isPlugin",value:function(e){return this._plugin.id===e}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===ke.FailedRequest&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"setInlineData",value:function(e){this._inlineData=e,this._loadState=ke.LoadedFull}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}]),e}(),Se=(ie=function(){function e(t){r()(this,e),this._taskCB=t,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,k.a.listen("lowImpactBegin",this.handleLowImpactBegin)}return o()(e,[{key:"getStats",value:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}}},{key:"disable",value:function(){this._disabled=!0}},{key:"enable",value:function(){this._disabled=!1}},{key:"handleLowImpactBegin",value:function(){this._startTaskRun()}},{key:"requestRun",value:function(){this._forceRun=!0,this._startTaskRun()}},{key:"notifyWorkAvailable",value:function(){this._workAvailable=!0,m.default.isLowImpact()&&!this._isRunning&&this._startTaskRun()}},{key:"_startTaskRun",value:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{m.default.PAssert(1217,this._forceRun||m.default.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){m.default.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}}},{key:"_onTaskEndRun",value:function(e){try{m.default.PAssert(1218,this._isRunning,"Must be currently running task to finish")}catch(t){m.default.reportError(t)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,m.default.isLowImpact()&&this._startTaskRun())}}]),e}(),D()(ie.prototype,"handleLowImpactBegin",[C.a],Object.getOwnPropertyDescriptor(ie.prototype,"handleLowImpactBegin"),ie.prototype),D()(ie.prototype,"_onTaskEndRun",[C.a],Object.getOwnPropertyDescriptor(ie.prototype,"_onTaskEndRun"),ie.prototype),ie);function Pe(e,t,a,i,n,r){try{m.default.PAssert(1219,m.default.isFunction(n),"Must supply a valid entry CB")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1220,m.default.isFunction(r),"Must supply a valid done CB")}catch(s){m.default.reportError(s)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=a,this._maxResults=i,this._entryCB=n,this._doneCB=r}var we={updateToken:function(e){try{m.default.PAssert(1221,this._nextPageToken!==e,"Should never update token to be same value")}catch(t){m.default.reportError(t)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{m.default.PAssert(1222,!this._inUse,"Should not currently be in use")}catch(e){m.default.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{m.default.PAssert(1223,this._inUse,"Should always be using token when done")}catch(e){m.default.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};L.a.defineBase(Pe),L.a.extend(Pe.prototype,we);var Ie=Pe,be=a(29),De=[1,5,20,40,80,170],Ee=[v.a.HTTPStatusCode.Network,v.a.HTTPStatusCode.Timeout,v.a.HTTPStatusCode.TooMany,v.a.HTTPStatusCode.ServerError,v.a.HTTPStatusCode.BadGateway,v.a.HTTPStatusCode.Unavailable,v.a.HTTPStatusCode.GatewayTimeout,null],Ce=[v.a.HTTPStatusCode.Forbidden,v.a.HTTPStatusCode.TooMany],Ae={};Ae[v.a.PluginDependency.DemoMode]={online:!1},Ae[v.a.PluginDependency.GoogleLogin]={online:!0},Ae[v.a.PluginDependency.PremiumSub]={online:!1},Ae[v.a.PluginDependency.EarlyAccess]={online:!1};var Me=v.a.DETAILED_STATS,Te=function(){function e(t,a,i,n,s){var o=this;r()(this,e);try{m.default.PAssert(1021,t,"Must supply a valid id")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1022,i,"Must supply a valid name")}catch(l){m.default.reportError(l)}this.id=t,this.name=i,this.DefaultRequestTimeout=m.default.seconds(15),this.LongWaitThreshold=m.default.seconds(7),this._paneType="Pane"+t,this._acProviderId="AC"+t,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new z.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.supportSyncAccounts=!1,this.Settings={},L.a.binder(this,"_retryRemoteRequest","_reqSortFn"),sr.settings.registerGroup(this._settingsGroup,a,s),this.registerSetting("IsEnabled","isEnabled","e",!0,n),this.getDataPane()&&oe.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),Me&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),this.onSettingChanged(this.Settings.IsEnabled,function(e,t){e&&sr.pluginManager.activatePlugin(o)})}return o()(e,[{key:"getType",value:function(){return v.a.PluginType.Unknown}},{key:"sendEvent",value:function(e,t){return m.default.sendEvent(this.id,e,t)}},{key:"getSettingObs",value:function(e){return sr.settings[this._settingsGroup][e]}},{key:"getSetting",value:function(e){return sr.settings[this._settingsGroup][e].get()}},{key:"setSetting",value:function(e,t,a){return sr.settings[this._settingsGroup][e].set(t,a)}},{key:"registerSetting",value:function(e,t,a,i,n){this.Settings[e]=t,sr.settings.registerSetting(t,a,this._settingsGroup,i,n)}},{key:"onSettingChanged",value:function(e,t){sr.settings[this._settingsGroup][e].listen(t)}},{key:"getCacheStats",value:function(e){var t={},a=Object.keys(this._registeredCaches).length,i=0,n=function(n){t[n.id]=n,a===++i&&e(t)};if(a>0)for(var r in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(r))this._registeredCaches[r].getStats(n)}else e()}},{key:"getCacheState",value:function(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var a=this._registeredCaches[t];e[t]=a.getState()}return e}},{key:"registerLocalCache",value:function(e,t,a){var i=sr.cacheManager.registerLocalCache(e,t,a);return this._registeredCaches[e]=i,i}},{key:"registerDeferredTaskType",value:function(e,t,a,i){try{m.default.PAssert(1023,e,"Must specify a valid deferred task type")}catch(n){m.default.reportError(n)}sr.deferredTaskManager.registerTaskType(e,t,a,i)}},{key:"scheduleDeferredTask",value:function(e,t,a,i){try{m.default.PAssert(1024,e,"Must supply a valid local ID for deferred task")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1025,t,"Must specify a valid deferred task type")}catch(n){m.default.reportError(n)}sr.deferredTaskManager.scheduleTask(e,t,a,!1,void 0,i)}},{key:"cancelDeferredTask",value:function(e,t){sr.deferredTaskManager.cancelTask(e,t)}},{key:"createRecurringTask",value:function(e,t){var a,i=this.id+"_"+e,n=sr.recurringTaskManager;return this.hasRecurringTask(e)?a=n.getRecurringTask(i):(this._recurringTasks.push(e),a=sr.recurringTaskManager.createRecurringTask(i,t)),a}},{key:"getRecurringTask",value:function(e){return sr.recurringTaskManager.getRecurringTask(this.id+"_"+e)}},{key:"hasRecurringTask",value:function(e){return sr.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}},{key:"cancelRecurringTask",value:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),sr.recurringTaskManager.cancelRecurringTask(t)}},{key:"cancelRecurringTasks",value:function(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var e=0,t={},a=0;a<this._recurringTasks.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._recurringTasks[a],n=this.getRecurringTask(i);t[i]=n.getStats()}return t}},{key:"registerLowImpactTask",value:function(e,t){try{m.default.PAssert(1026,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(i){m.default.reportError(i)}var a=new Se(t);return this._lowImpactTasks[e]=a,a}},{key:"getLowImpactStats",value:function(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var a=this._lowImpactTasks[t];e[t]=a.getStats()}return e}},{key:"getTrackedStat",value:function(e){if(Me)return this.__TrackedStats[e]}},{key:"addTrackedStat",value:function(e){if(Me){try{m.default.PAssert(1027,!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin")}catch(t){m.default.reportError(t)}this.__TrackedStats[e]=0}}},{key:"reportTrackedStat",value:function(e){if(Me){try{m.default.PAssert(1028,this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it")}catch(t){m.default.reportError(t)}this.__TrackedStats[e]++}}},{key:"getStats",value:function(){return{fnCalls:Me?this.__Stats:void 0,tracked:Me?this.__TrackedStats:void 0,remoteReqs:Me?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}},{key:"isPluginPane",value:function(e){return e.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(e){var t=this.isActiveObs.get();if(t||(this.isActiveObs.set(!0),this.useItemStore()&&(this._defaultItemStore=sr.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this.isActive()?this.useItemStore():this.id+"Root","")),this._hasLoadedCaches||(this.supportUsageCache()&&m.default.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()),this._unloadedDependencies)for(var a in e)e.hasOwnProperty(a)&&this.onDependencyLoaded(a,e[a]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),t||sr.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!t}},{key:"deactivate",value:function(){try{m.default.PAssert(1029,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){m.default.reportError(e)}return this.isActiveObs.set(!1),sr.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&oe.a.deactivatePaneType(this._paneType),this.useItemStore()&&(sr.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){(!this.hasDependency(v.a.PluginDependency.PremiumSub)||sr.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!oe.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||m.default.isDemoMode())&&oe.a.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return m.default.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){var e=!1,t=this.hasDependency(v.a.PluginDependency.EarlyAccess),a=this.hasDependency(v.a.PluginDependency.PremiumSub);try{m.default.PAssert(1030,!a||!t,"Must not require both early access and premium sub: "+this.id)}catch(r){m.default.reportError(r)}var i=sr.billingManager.hasEarlyAccess(),n=sr.billingManager.hasPremiumFeatures();return t&&i?e=!0:a&&n?e=!0:t||a?m.default.isDemoMode()&&(e=!0):e=!0,e}},{key:"hasSettingsError",value:function(){return!1}},{key:"isCurrentlyAuthorized",value:function(e){var t=this.googleScopes();return!t||ye.a.isAuthorizedForScopes(e,t)}},{key:"onAuthorized",value:function(e){this._pendingRequests.length>0&&sr.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(e){return!0}},{key:"notifyUnauthorized",value:function(e,t){}},{key:"isOnline",value:function(){return sr.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"onDocumentShared",value:function(e){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(e,t){if(this._unloadedDependencies){var a=this._unloadedDependencies.indexOf(e);if(a>=0&&(m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(a),e===v.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var i=0,n=!1,r=0;r<this._unloadedDependencies.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this._unloadedDependencies[r];Ae[s].online||(n=!0)}!n&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){this.isActiveObs.get()&&(m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin All Dependencies Loaded: ",this.id),this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load())}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}},{key:"migrateOldOfflineCache",value:function(){if(this.supportUsageCache()&&m.default.shouldWriteLocal()){var e="ocache_"+this.id,t=ve.a.getLegacyLocalStorage(e);if(t)try{var a=JSON.parse(t);if(a){var i=0;try{m.default.PAssert(1031,a,"Must provide a valid dataset to load")}catch(u){m.default.reportError(u)}a.props;var n=a.data;try{m.default.PAssert(1032,n,"Load object must contain valid data")}catch(u){m.default.reportError(u)}for(var r=Object.keys(n),s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[s],l=this.createEntryFromLocal(o,n[o]);l.id=o,ve.a.savePluginUsage(this.id,l)}ve.a.deleteLegacyLocalStorage(e)}}catch(d){m.default.reportError(d)}else m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("No offline cache present: ",this.id)}}},{key:"loadUsageCache",value:function(){var e=this;if(this.supportUsageCache()&&m.default.shouldWriteLocal()){this.migrateOldOfflineCache();var t=ve.a.getPluginTableUsage(this.id);t&&Object.keys(t).forEach(function(a){return e._dataCache[a]=e.createEntryFromLocal(a,t[a])})}}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportUsageCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(e,t){try{m.default.PAssert(1033,!1,"SubClass must override")}catch(a){m.default.reportError(a)}}},{key:"clearData",value:function(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}},{key:"changeID",value:function(e,t,a){try{m.default.PAssert(1034,t!==a,"Should never be switching to the same ID")}catch(s){m.default.reportError(s)}if(this._attachCache[a])e.delayChangeID(),delete this._attachCache[t],this._attachKeys.remove(t),delete this._dataCache[t];else{var i=this._attachCache[t];try{m.default.PAssert(1035,e===i,"Attach entries must match")}catch(s){m.default.reportError(s)}i&&(delete this._attachCache[t],this._attachCache[a]=i,this._attachKeys.remove(t),this._attachKeys.push(a));var n=this._dataCache[t];delete this._dataCache[t],n&&(n.id===t&&(n.id=a),this._dataCache[a]=n);var r=e.isLocalOnlyAttachment();e.isInUse()&&r&&this.deleteAttachmentFromUsageCache(e),e.changeID(a),e.isInUse()&&r&&this.saveAttachmentToUsageCache(e)}}},{key:"_isFullData",value:function(e){for(var t=0,a=this.getPropertySet(v.a.PluginLoad.Full),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(a[i]).isOpt&&!e.hasOwnProperty(a[i]))return!1}return!0}},{key:"cacheData",value:function(e,t,a,i,n){try{m.default.PAssert(1036,e,"Must supply a valid key for data")}catch(o){m.default.reportError(o)}Me&&this.__Stats.cacheWrites++;this._dataCache[e];if(this._dataCache[e]=t,this._attachCache[e]){var r=this._attachCache[e],s=this._getPluginLoadType(t);try{m.default.PAssert(1038,s,"Must contain valid full data")}catch(o){m.default.reportError(o)}r.notifyDataLoaded(s,a,i,n)}}},{key:"getCacheData",value:function(e){return this._dataCache[e]}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(e){var t=!1;if(e){var a=this._attachMetadataFields();if(a)for(var i=0,n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a.indexOf(e[n])<0){t=!0;break}}else t=!0}else t=!0;return t}},{key:"isFieldDefined",value:function(e){return!!this.getPropertyDescriptor(e)}},{key:"hasAttachField",value:function(e,t){var a=!1,i=this._dataCache[e.id];if(i&&i.hasOwnProperty(t))a=!0;else{var n=this.getPropertyDescriptor(t);try{m.default.PAssert(1040,n,"Must have a valid field descriptor",t)}catch(s){m.default.reportError(s)}if(n&&n.isOpt)a=!0;else{var r=e.getInlineData();r&&r.hasOwnProperty(t)&&void 0!==r[t]&&(a=!0)}}return a}},{key:"getAttachField",value:function(e,t){var a,i=this._dataCache[e.id];if(i&&i.hasOwnProperty(t))a=i[t];else{var n=this.getPropertyDescriptor(t);try{m.default.PAssert(1041,n,"Must have a valid field descriptor",t)}catch(s){m.default.reportError(s)}var r=e.getInlineData();a=r&&r.hasOwnProperty(t)?r[t]:n?n.defaultValue:void 0}return a}},{key:"updateAttachField",value:function(e,t,a,i,n){var r=!1;try{m.default.PAssert(1043,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(l){m.default.reportError(l)}var s=this._dataCache[e.id];try{m.default.PAssert(1044,s,"Invalid field request: ",this.id,t)}catch(l){m.default.reportError(l)}s&&((n||this.dataFieldNeedsWrite(s,t,a))&&(s[t]=a,this.cacheData(e.id,s,!0,[t])),r=!0);var o=e.getInlineData();if(o&&o.hasOwnProperty(t)&&!i)try{m.default.PAssert(1047,o[t]===a,"Should never change inline field value")}catch(l){m.default.reportError(l)}return r}},{key:"isAttachFieldDefault",value:function(e,t){var a=!1,i=this._dataCache[e.id];try{m.default.PAssert(1048,i,"Invalid field request: ",this.id,t)}catch(r){m.default.reportError(r)}if(i){var n=this.getPropertyDescriptor(t);try{m.default.PAssert(1049,n,"Must have a valid field descriptor",t)}catch(r){m.default.reportError(r)}i.hasOwnProperty(t)?n&&n.isOpt&&n.defaultValue===i[t]&&(a=!0):n&&n.isOpt&&(a=!0)}return a}},{key:"fieldNeedsWrite",value:function(e,t,a){var i=this._dataCache[e.id];try{m.default.PAssert(1050,i,"Invalid field request: ",this.id,t)}catch(n){m.default.reportError(n)}return this.dataFieldNeedsWrite(i,t,a)}},{key:"dataFieldNeedsWrite",value:function(e,t,a){var i=!1;if(e){var n=this.getPropertyDescriptor(t);try{m.default.PAssert(1051,n,"Must have a valid field descriptor",t)}catch(s){m.default.reportError(s)}var r=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===a&&r===n.defaultValue||(n&&n.comparator?n.comparator(r,a)||(i=!0):r!==a?i=!0:(m.default.isObject(r)||m.default.isObject(a)||m.default.isArray(r)||m.default.isArray(a))&&(i=!0)):void 0!==a&&(n&&n.isOpt&&n.defaultValue===a||(i=!0))}return i}},{key:"hasCacheData",value:function(e){return!!this._dataCache[e]}},{key:"findCachedItemsByField",value:function(e,t,a){var i=this;Me&&this.__Stats.findByField++;var n=[];return Object.keys(this._dataCache).some(function(r){var s=i._dataCache[r];if(s&&s[e]===t&&(n.push(s),n.length>=a))return!0}),n}},{key:"findCachedItemsByFn",value:function(e,t){var a=this;try{m.default.PAssert(1052,e,"Must supply a valid match function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1053,m.default.isFunction(e),"Match function must be a valid function")}catch(n){m.default.reportError(n)}Me&&this.__Stats.findByFn++;var i=[];return Object.keys(this._dataCache).some(function(n){var r=a._dataCache[n];if(e(r)&&(i.push(r),i.length>=t))return!0}),i}},{key:"notifyAttachmentInUse",value:function(e,t){try{m.default.PAssert(1054,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(a){m.default.reportError(a)}this._activeAttachments.push(e),m.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e,!0)}},{key:"notifyAttachmentUpdated",value:function(e){this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e)}},{key:"notifyAttachmentUnused",value:function(e,t){try{m.default.PAssert(1055,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(a){m.default.reportError(a)}this._activeAttachments.remove(e),m.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(e)}},{key:"onAuthorizedSetting",value:function(e,t){}},{key:"notifyItemNoteChanged",value:function(e,t){}},{key:"notifyItemDateChanged",value:function(e,t){}},{key:"notifyItemTextChanged",value:function(e,t,a){}},{key:"notifyItemPropertyChanged",value:function(e,t,a,i){}},{key:"getAttachment",value:function(e,t){try{m.default.PAssert(1056,e,"Must provide a valid key")}catch(a){m.default.reportError(a)}return e&&(this._attachCache[e]?t&&!this._attachCache[e].hasInlineData()&&this._attachCache[e].setInlineData(t):(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e))),this._attachCache[e]}},{key:"hasAttachment",value:function(e){return!!this._attachCache[e]}},{key:"forEachActiveAttachment",value:function(e){for(var t=0,a=0;a<this._activeAttachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[a])}}},{key:"forEachAttachment",value:function(e){for(var t=0,a=0;a<this._attachKeys.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[a]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentEmbedString",value:function(e){for(var t=0,a=v.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id,i=this.getPropertySet(v.a.PluginLoad.Inline),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n],s=this.getPropertyDescriptor(r),o=encodeURIComponent(e.getField(r));try{m.default.PAssert(1057,s.isOpt||o&&o.indexOf(":")<0&&o.indexOf(" ")<0,"Property value is invalid: "+r+", "+o)}catch(l){m.default.reportError(l)}void 0!==o&&"undefined"!==o&&(a+=","+r+":"+o)}return a+=v.a.EmbedAttachChar}},{key:"getAttachmentTitleString",value:function(e){return this.getUnstyledText(e)}},{key:"_getTextForItem",value:function(e){try{m.default.PAssert(1058,e,"Must pass in a valid item to get text for")}catch(t){m.default.reportError(t)}return v.a.EmbedAttachChar+"p:"+this.id+",id:"+e.id+v.a.EmbedAttachChar}},{key:"_requestAttachment",value:function(e,t){try{m.default.PAssert(1059,e,"Must provide a valid key")}catch(a){m.default.reportError(a)}return Me&&this.__Stats.createdAttachments++,new _e(this,e,t)}},{key:"releaseAttachment",value:function(e){}},{key:"saveAttachmentToUsageCache",value:function(e,t){this.supportUsageCache()&&m.default.shouldWriteLocal()&&(t&&ve.a.getPluginUsage(this.id,e.id)||ve.a.savePluginUsage(this.id,this.serializeEntry(e.id)))}},{key:"deleteAttachmentFromUsageCache",value:function(e){this.supportUsageCache()&&m.default.shouldWriteLocal()&&ve.a.deletePluginUsage(this.id,e.id)}},{key:"dataHasChanged",value:function(e,t){for(var a=0,i=!e,n=this.getPropertySet(v.a.PluginLoad.Full),r=0;!i&&r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n[r];this.dataFieldNeedsWrite(e,s,t[s])&&(i=!0)}return i}},{key:"getChangedFields",value:function(e,t){for(var a=0,i=[],n=this.getPropertySet(v.a.PluginLoad.Full),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n[r];this.dataFieldNeedsWrite(e,s,t[s])&&i.push(s)}return i}},{key:"matchAttachment",value:function(e,t){try{m.default.PAssert(1060,!1,"SubClass must override")}catch(a){m.default.reportError(a)}}},{key:"getStyledText",value:function(e,t,a,i){try{m.default.PAssert(1061,!1,"SubClass must override")}catch(n){m.default.reportError(n)}}},{key:"getUnstyledText",value:function(e){try{m.default.PAssert(1062,!1,"SubClass must override")}catch(t){m.default.reportError(t)}return""}},{key:"getRichText",value:function(e){try{m.default.PAssert(1063,!1,"SubClass must override")}catch(t){m.default.reportError(t)}return""}},{key:"getBlockedText",value:function(e){return"Blocked"}},{key:"getAttachMeasure",value:function(e,t,a){}},{key:"useRenderer",value:function(e,t){var a,i=sr.pluginManager.useRenderer(e,t);switch(e){case v.a.PluginRenderTypes.StyledText:a="getStyledText";break;case v.a.PluginRenderTypes.UnstyledText:a="getUnstyledText";break;case v.a.PluginRenderTypes.RichText:a="getRichText";break;case v.a.PluginRenderTypes.Measure:a="getAttachMeasure";break;default:try{m.default.PAssert(1064,!1,"Unknown plugin renderer type")}catch(n){m.default.reportError(n)}}a&&(this[a]=i)}},{key:"_getDisplayText",value:function(e,t,a,i){return this.isPluginBlocked()?this.getBlockedText(e):this.getStyledText(e,t,a,i)}},{key:"createDisplayElement",value:function(e){var t=this.getAttachmentClass(e);try{m.default.PAssert(1065,m.default.isArray(t),"Must have a valid class list")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1066,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(r){m.default.reportError(r)}t.push("plugin"),this.isPluginBlocked()&&t.push("blocked");var a=this._getDisplayText(e),i={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:a},n=this.getAttachmentTooltip(e);return n&&(i.attrs["data-tooltip"]=n),i}},{key:"measureAttachment",value:function(e,t){try{m.default.PAssert(1067,t&&t.attrs&&t.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(s){m.default.reportError(s)}var a;if(t.attrs&&!t.attrs.isUnknown){var i=this.getAttachment(t.attrs["plugin-id"]);try{m.default.PAssert(1068,i,"Must have valid attachment to measure: ",t.attrs["plugin-id"])}catch(s){m.default.reportError(s)}if(this.isPluginBlocked())a=sr.Measure.measureWord(e,this.getBlockedText(i),t);else if(void 0===(a=this.getAttachMeasure(i,e,t))){var n=this.getWordStyles();a=sr.Measure.measureWord(e,this.getUnstyledText(i),Object.assign({},t,n)),n.padding&&(a+=n.padding)}}else a=sr.Measure.measureWord(e,"Unknown Plugin",t);if(t.attrs&&t.attrs.cls){var r=t.attrs.cls;a+=this.pluginMargin,r.indexOf("padB")>=0&&(a+=this.pluginMargin)}return a+=this.pluginPadding}},{key:"getAttachmentClass",value:function(e){return[]}},{key:"getAttachmentTooltip",value:function(e){}},{key:"isPluginBlocked",value:function(){var e=!1;return sr.billingManager.hasPremiumFeatures()||!this.hasDependency(v.a.PluginDependency.PremiumSub)&&!this.hasDependency(v.a.PluginDependency.EarlyAccess)||(e=!0),e}},{key:"_displayMissingProperties",value:function(e,t,a){var i=0,n=!1,r=this.getPropertySet(a);m.default.log("Displaying Missing Properties: ",e);for(var s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.getPropertyDescriptor(r[s]).isOpt||t.hasOwnProperty(r[s])||(m.default.log(" Missing Property: ",r[s]),n=!0)}try{m.default.PAssert(1069,n,"Must be missing props to run this")}catch(o){m.default.reportError(o)}}},{key:"_getPluginLoadType",value:function(e){try{m.default.PAssert(1070,e,"Must be querying loaded data for load state with valid data")}catch(a){m.default.reportError(a)}var t=v.a.PluginLoad.None;return this._isFullData(e)&&(t|=v.a.PluginLoad.Full),t}},{key:"requestData",value:function(e,t){var a=this;Me&&this.__Stats.requestData++,t=t||v.a.PluginLoad.Full;var i,n=this.getCacheData(e.id);n?(i=this._getPluginLoadType(n),m.default.isFlagSet(i,t)?e.notifyDataLoaded(i,!1,void 0,v.a.ChangeType.Remote):(m.default.forEachFlagSet(t,function(t){a._displayMissingProperties(e.id,n,t)}),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(i=v.a.PluginLoad.None,this.allowRemoteRequests()&&!m.default.isFlagSet(i,t)&&this._getRemoteAttachmentData(e,t))}},{key:"_getRemoteAttachmentData",value:function(e,t){this.getRemoteAttachmentData(e,t)}},{key:"getRemoteAttachmentData",value:function(e,t){try{m.default.PAssert(1071,!1,"SubClass must override")}catch(a){m.default.reportError(a)}}},{key:"_appendDupeRequest",value:function(e,t){try{m.default.PAssert(1072,e,"Must provide a valid queued request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1073,t,"Must provide a valid duped request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1074,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(a){m.default.reportError(a)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestFnsEqual",value:function(e,t){var a=!1;return e===t?a=!0:m.default.isArray(e)&&m.default.isArray(t)&&(a=e.equals(t)),a}},{key:"_areRequestsEqual",value:function(e,t){try{m.default.PAssert(1075,e,"Must have a valid request A")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1076,t,"Must have a valid request B")}catch(r){m.default.reportError(r)}var a=!0;if(e.accountID!==t.accountID)a=!1;else if(e.forceNoDupe||t.forceNoDupe)a=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)a=!0;else{for(var i in e.data){if(!e.data.hasOwnProperty(i)||!t.data.hasOwnProperty(i)){a=!1;break}if(e.data[i]!==t.data[i]){a=!1;break}}if(a)for(var n in t.data){if(!e.data.hasOwnProperty(n)||!t.data.hasOwnProperty(n)){a=!1;break}if(e.data[n]!==t.data[n]){a=!1;break}}}else a=!1;return a}},{key:"_getDupeRequest",value:function(e){for(var t,a=0,i=0,n=0;!t&&n<this._outstandingRequests.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._outstandingRequests[n].duped&&this._areRequestsEqual(this._outstandingRequests[n],e)&&(t=this._outstandingRequests[n])}for(var r=0;!t&&r<this._pendingRequests.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;!this._pendingRequests[r].duped&&this._areRequestsEqual(this._pendingRequests[r],e)&&(t=this._pendingRequests[r])}return t}},{key:"_combineRequest",value:function(e,t){try{m.default.PAssert(1077,e,"Must provide a valid queued request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1078,t,"Must provide a valid combine request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1079,!e.combined,"Must never use an already combined request as a target for another request")}catch(a){m.default.reportError(a)}e.data=m.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestsCombinable",value:function(e,t){try{m.default.PAssert(1080,e,"Must have a valid request A")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1081,t,"Must have a valid request B")}catch(i){m.default.reportError(i)}var a=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(a=!0):a=!0),a}},{key:"_getCombineRequest",value:function(e){var t;if(e.combinable)for(var a=0,i=0;!t&&i<this._pendingRequests.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._pendingRequests[i].combined&&this._areRequestsCombinable(this._pendingRequests[i],e)&&(t=this._pendingRequests[i])}return t}},{key:"_handleBatchRequestResponse",value:function(e){this._numOutstandingReqs--;try{m.default.PAssert(1082,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){m.default.reportError(t)}}},{key:"_handleRequestResponse",value:function(e,t){if(!t){this._numOutstandingReqs--;try{m.default.PAssert(1083,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){m.default.reportError(a)}}}},{key:"_handleRequestTimeout",value:function(e){if(this._pendingRequests.indexOf(e)>=0){var t=0;e.timedOut=!0;for(var a={error:{code:v.a.HTTPStatusCode.Network,message:"Internal request timeout"}},i=0;i<e.failureCB.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.failureCB[i](a)}catch(n){m.default.reportError(n)}}0,this._pendingRequests.remove(e)}}},{key:"_queueRemoteRequestMulti",value:function(e,t,a,i,n,r,s,o){try{m.default.PAssert(1084,e,"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1085,!m.default.isArray(e),"Missing accountID paramter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1086,!m.default.isFunction(e),"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1087,!o||void 0===o.accountID,"AccountID is specified as a separate param")}catch(u){m.default.reportError(u)}var l=o?m.default.clone(o):{};return l.accountID=e,this._queueRemoteRequest(t,a,i,n,r,s,l)}},{key:"_computeTimeoutMS",value:function(e){var t;return e&&void 0!==e.timeoutMS&&(0===e.timeoutMS?t=this.DefaultRequestTimeout:e.timeoutMS>=1e3&&(t=e.timeoutMS)),t}},{key:"_updateRequestTimeout",value:function(e){e.timeoutMS&&(this._clearRequestTimeout(e),e.timeout=setTimeout(this._handleRequestTimeout.bind(this,e),e.timeoutMS))}},{key:"_clearRequestTimeout",value:function(e){e.timeout&&(clearTimeout(e.timeout),e.timeout=void 0)}},{key:"_queueRemoteRequest",value:function(e,t,a,i,n,r,s){var o=this;s=s||{};try{m.default.PAssert(1088,e&&m.default.isArray(e),"RequestFn must be a valid packed function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1089,t,"Must provide valid data for the request")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1091,a,"Must supply a callback for request success")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1092,m.default.isFunction(a),"Success callback must be a valid function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1093,i,"Must supply a callback for request failure")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1094,m.default.isFunction(i),"Failure callback must be a valid function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1095,r,"Request type must be specified")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1096,s.accountID||s.token,"Must have an accountID")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1097,!s.combinable,"Combinable is not currently a valid option. Do not use.")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1098,!n||!n.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",n?n.id:"UNDEFINED")}catch(d){m.default.reportError(d)}if(!s.accountID||!this.supportSyncAccounts||this.hasSyncAccount(s.accountID)){s.token&&!s.accountID&&(s.accountID="from_token"),Me&&(this.__ReqStats[r]=this.__ReqStats[r]?this.__ReqStats[r]+1:1);var l={id:++this._requestCounter,plugin:this,attach:n?[n]:void 0,request:void 0,requestFn:e,data:t,successCB:[a],failureCB:[i],type:r,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,noBatch:s.noBatch,requestsBehind:this._pendingRequests.length,token:s.token,accountID:s.accountID,combinable:s.combinable,autoRetry:!s||void 0===s.autoRetry||s.autoRetry,timeoutMS:this._computeTimeoutMS(s),forceNoDupe:s.forceNoDupe,priority:s.priority?s.priority:v.a.RequestPriority.Default};l.autoRetry&&(l.numRetries=s&&s.numRetries?s.numRetries:2,l.currentRetries=0),this._updateRequestTimeout(l),m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Queued: ",this.name,r,l.id,l);var u=function(){var e=o._insertPendingRequest(l);l.priority>v.a.RequestPriority.Default&&m.default.log("Insert Index: ",e,o._pendingRequests.length,l),sr.pluginManager.notifyHasPendingRemoteRequest()};_.a.isLoadedRemote.onValue(!0,function(){l.token?u():ye.a.getAccountAuthToken(s.accountID,o.googleScopes(),function(e){e?(l.token=e,u()):console.log("Skipping request because of missing token")})})}}},{key:"_insertPendingRequest",value:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}},{key:"_reqSortFn",value:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(e,t,a,i,n,r,s,o){try{m.default.PAssert(1099,e,"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1100,!m.default.isArray(e),"Missing accountID paramter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1101,!m.default.isFunction(e),"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1102,!o||void 0===o.accountID,"AccountID is specified as a separate param")}catch(u){m.default.reportError(u)}var l=o?m.default.clone(o):{};return l.accountID=e,this._queuePagedRemoteRequest(t,a,i,n,r,s,l)}},{key:"_queuePagedRemoteRequest",value:function(e,t,a,i,n,r,s){var o=this;try{m.default.PAssert(1103,s,"Must supply a valid options param")}catch(p){m.default.reportError(p)}try{m.default.PAssert(1104,!s.getAllPages||!s.maxPages,"Should only define either maxPages or getAllPages: ",s.getAllPages,s.maxPages)}catch(p){m.default.reportError(p)}s.maxPages=s.maxPages||1,s.getAllPages=s.getAllPages||!1,s.maxPageResults=s.maxPageResults||(s.maxResults?s.maxResults:100),s.maxResults=s.maxResults||1/0,s.resultsField=s.resultsField||"items";var l,u=0,d=[],c=m.default.clone(t);c.maxResults=s.maxPageResults;var h=function(e){e[s.resultsField]?d.pushArray(e[s.resultsField]):e.items?d.pushArray(e.items):e.history&&d.pushArray(e.history),e.nextPageToken&&(s.getAllPages||s.maxPages>u)&&d.length<s.maxResults?l(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?a(d,t,e):a(d)},f=function(e){i(e,d)};(l=function(t){t&&(c.pageToken=t),u++,o._queueRemoteRequest(e,c,h,f,void 0,r,s)})()}},{key:"_retryRemoteRequest",value:function(e,t){var a=this;m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Re-Queued: ",this.name,e.type,e.id,e),Me&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout(function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,a._insertPendingRequest(e),sr.pluginManager.notifyHasPendingRemoteRequest()},this._getRetryDelay(e,t))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(e,t,a,i){var n=0,r=0,s=this;try{m.default.PAssert(1105,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(T){m.default.reportError(T)}try{m.default.PAssert(1106,!this.hasDependency(v.a.PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(v.a.PluginDependency.GoogleLogin),"Must be authorized to make remote requests")}catch(T){m.default.reportError(T)}var o=0,l=0,u=0,d=0,c=0,h=0,f=0;try{m.default.PAssert(1107,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(T){m.default.reportError(T)}var p=t;try{m.default.PAssert(1108,p>0,"Should never have more than max outstanding requests for a given plugin")}catch(T){m.default.reportError(T)}for(var g={},y=this._pendingRequests.filter(function(e){return!e.noBatch}),k=p>1&&y.length>1,_=[],S=0;p>0&&S<this._pendingRequests.length&&f<v.a.MaxBatchSize;++S){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var P=this._pendingRequests[S],w=void 0;if(k&&!P.noBatch&&((w=g[P.accountID])||(w=g[P.accountID]=this.createBatch())),P.priority<e)h++;else{m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Pumped: ",this.name,P.type,P.id,P);try{m.default.PAssert(1109,!m.default.isFunction(P),"Should never use a deferred request")}catch(T){m.default.reportError(T)}try{m.default.PAssert(1110,!1===P.handled,"Should never service a request that has already been handled")}catch(T){m.default.reportError(T)}var I=this._getDupeRequest(P);if(I)Me&&this.__Stats.dupedRequests++,P.duped=!0,_.push(P),u++,this._appendDupeRequest(I,P);else{var b=this._getCombineRequest(P);if(b)Me&&this.__Stats.combinedRequests++,P.combined=!0,_.push(P),d++,this._combineRequest(b,P);else{var D=!1;if(P.attach)for(var E=0,C=0;C<P.attach.length;++C){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;P.attach[C].needsRemoteData()&&(P.attach[C].notifyDataRequested(),D=!0)}else D=!0;if(D)if(P.token||this.isCurrentlyAuthorized(P.accountID)){var A=this._runRemoteRequest(w,P,a);if(Me&&this.__Stats.remoteRequests++,A.isNewRequest||0===f){try{m.default.PAssert(1111,t>o,"Should not be making more requests for plugin than allowed")}catch(T){m.default.reportError(T)}o++,p--,this._numOutstandingReqs++,Me&&this.__Stats.actualRemoteCallsSent++}A.wasBatched&&f++,_.push(P)}else ye.a.notifyUnauthorizedRequest(P.accountID),c++;else Me&&this.__Stats.canceledRequests++,P.canceled=!0,l++,_.push(P)}}}}this._pendingRequests=this._pendingRequests.removeArray(_);for(var M=0;M<_.length;++M){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;_[M].canceled||_[M].duped||this._addRequest(this._outstandingRequests,_[M])}return Object.keys(g).forEach(function(e){var t=g[e];try{m.default.PAssert(1112,!t||f+l+u+d+c+h>1,"Batches should always have multiple items in them")}catch(T){m.default.reportError(T)}t&&(f>0?(Me&&s.__Stats.remoteBatches++,s.commitBatch(t,i)):Me&&s.__Stats.canceledBatches++)}),o}},{key:"_clearRequestQueue",value:function(){m.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(e,t){try{m.default.PAssert(1113,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(a){m.default.reportError(a)}return e.push(t)}},{key:"_removeRequest",value:function(e,t){return e.remove(t)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(e){var t=!1;return e&&Ce.indexOf(e.status)>=0&&(e.status===v.a.HTTPStatusCode.Forbidden?m.default.hasGoogleError(e,v.a.GoogleErrorDomain.UsageLimits,v.a.GoogleError.UserRateLimitExceeded)?t=!0:m.default.hasGoogleError(e,v.a.GoogleErrorDomain.UsageLimits,v.a.GoogleError.RateLimitExceeded)?t=!0:m.default.hasGoogleError(e,v.a.GoogleErrorDomain.UsageLimits,v.a.GoogleError.QuotaExceeded)&&(t=!0):t=!0),t}},{key:"_getRetryDelay",value:function(e,t){var a=e.currentRetries;return t&&(a=Math.max(2,e.currentRetries)),m.default.seconds(De[a])}},{key:"_notifyRequestSuccess",value:function(e,t){var a={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_notifyRequestFailure",value:function(e,t){var a={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_handleResponse",value:function(e){for(var t=0,a=0;a<e.cbList.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e.cbList[a](e.result)}catch(i){m.default.reportError(i)}}}},{key:"_notifyBatchCompleted",value:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var a=0;sr.PaneUpdateBatcher.beginUpdateItems(),ve.a.beginBatch();for(var i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._handleResponse(t[i])}ve.a.commitBatch(),sr.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(e){return e.accountID}},{key:"computeRequestID",value:function(e){return e.id+"-"+Date.now()}},{key:"_setSendTime",value:function(e){var t=Date.now();if(0===e.sendTimes.length){var a=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=a,a>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}},{key:"_setHandleTime",value:function(e){var t=Date.now();if(0===e.handleTimes.length){var a=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=a}e.handleTimes.push(t)}},{key:"_runRemoteRequest",value:function(e,t,a){var i,n=this,r={wasBatched:!1,isNewRequest:!1};if(be.a.canConstruct(t.requestFn))i=t.request=be.a.createRequest(t.accountID,t.requestFn,t.data,t.token);else{var s=m.default.unpackFn(t.requestFn);try{m.default.PAssert(1114,m.default.isFunction(s),"Must specify a valid packed function: ",t.requestFn)}catch(d){m.default.reportError(d)}s&&(i=t.request=s(t.data))}if(i){try{m.default.PAssert(1115,i.then,"Remote request must be thenable")}catch(d){m.default.reportError(d)}if(e){var o=this.computeBatchGroupID(t),l=this.computeRequestID(t);r.isNewRequest=e.add(i,o,l);try{m.default.PAssert(1116,m.default.isBoolean(r.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(d){m.default.reportError(d)}r.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=l}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Run: ",this.name,t.type,t.id,t);try{m.default.PAssert(1117,t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(d){m.default.reportError(d)}this._clearRequestTimeout(t),this._setSendTime(t);var u=function(e){try{m.default.PAssert(1118,!1===t.handled,"Must not handle the same request multiple times")}catch(d){m.default.reportError(d)}m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Failed: ",n.name,t.type,t.id,t,e),n._setHandleTime(t);var i=n.isRateLimitError(e);if(i&&n._notifyRateLimited(e),(i||Ee.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)a(t.attach,t.plugin,t.wasBatched),n._removeRequest(n._outstandingRequests,t),n._retryRemoteRequest(t,i);else{if(t.handled=!0,t.failed=!0,t.attach)for(var r=0,s=0;s<t.attach.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t.attach[s].notifyDataRequestFailed()}n._notifyRequestFailure(t,e.result),a(t.attach,t.plugin,t.wasBatched),n._removeRequest(n._outstandingRequests,t)}};t.request.then(function(e){var i=e.result;if(!be.a.isRest||i&&!i.error||204===e.status){try{m.default.PAssert(1119,!1===t.handled,"Must not handle the same request multiple times")}catch(d){m.default.reportError(d)}m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Request Success: ",n.name,t.type,t.id,t,e),n._setHandleTime(t),t.handled=!0,n._notifyRateLimitedOver(),n._notifyRequestSuccess(t,i),a(t.attach,t.plugin,t.wasBatched),n._removeRequest(n._outstandingRequests,t)}else u(e)},u)}return r}},{key:"createPaginationToken",value:function(e,t,a,i,n,r){return new Ie(e,t,a,i,n,r)}},{key:"updatePaginationToken",value:function(e,t){try{m.default.PAssert(1120,e,"Must specify a valid token to update")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1121,t,"Must update the pagination token with a valid next page token")}catch(a){m.default.reportError(a)}return e.updateToken(t),e}},{key:"createBatch",value:function(e){return be.a.createBatch(e)}},{key:"commitBatch",value:function(e,t){var a=this;try{m.default.PAssert(1122,e,"Batch to commit must be specified")}catch(i){m.default.reportError(i)}e.then(function(){a._notifyBatchCompleted(e),t(a,!0)},function(){a._notifyBatchCompleted(e),t(a,!1)})}},{key:"addModifiedOffline",value:function(e,t){try{m.default.PAssert(1123,e,"Must have a valid cache entry to update")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1124,m.default.isBoolean(t)||m.default.isArray(t),"Incoming fields must be valid")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1125,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(i){m.default.reportError(i)}if(e){var a=e.modifiedOffline||!1;try{m.default.PAssert(1126,m.default.isBoolean(a)||m.default.isArray(a),"Previous fields must be valid")}catch(i){m.default.reportError(i)}!1===a?e.modifiedOffline=t:!0===a||(!0===t?e.modifiedOffline=!0:e.modifiedOffline?e.modifiedOffline.pushOnlyUniques(t):e.modifiedOffline=t)}}},{key:"removeModifiedOffline",value:function(e,t){try{m.default.PAssert(1127,e,"Must have a valid cache entry to update")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1128,m.default.isBoolean(t)||m.default.isArray(t),"Incoming fields must be valid")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1129,!0!==t,"Use addModifiedOffline to add data instead")}catch(i){m.default.reportError(i)}if(e){var a=e.modifiedOffline||!1;try{m.default.PAssert(1130,m.default.isBoolean(a)||m.default.isArray(a),"Previous fields must be valid")}catch(i){m.default.reportError(i)}!1===a||(!0===a?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(e,t){return e[t]}},{key:"_serializeObj",value:function(e,t){var a=0;try{m.default.PAssert(1131,e,"Must specify a valid entry to serialize")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1132,t,"Must provide a valid property list")}catch(u){m.default.reportError(u)}for(var i={},n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[n],s=this.getPropertyDescriptor(r);if(!s.isOpt||s.defaultValue!==e[r]){var o=this.compactCacheField(e,r);void 0!==o&&(i[r]=o)}}var l=this.getBlobData(e);return l&&(i._blob=l),i}},{key:"serializeEntry",value:function(e){var t=this.getPropertySet(v.a.PluginLoad.Full),a=this.getCacheData(e);if(a){var i=this._serializeObj(a,t);return i.id=e,i.plugin=this.id,i}}},{key:"serializeExternalData",value:function(e){try{m.default.PAssert(1133,e,"Must supply valid data to serialize")}catch(i){m.default.reportError(i)}var t=this.getPropertySet(v.a.PluginLoad.Full),a=this._serializeObj(e,t);return a.id=e.id,e.parents&&(a.parents=e.parents),a}},{key:"declareProperty",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(1134,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(s){m.default.reportError(s)}t=t||v.a.PluginLoad.Full,a=a||!1,m.default.forEachFlagSet(t,function(t){r._propertySets[t]||(r._propertySets[t]=[]),r._propertySets[t].push(e)}),this._propertyDescriptors[e]={isOpt:a,defaultValue:i,comparator:n}}},{key:"getPropertySet",value:function(e){return this._propertySets[e]||[]}},{key:"getPropertyDescriptor",value:function(e){return this._propertyDescriptors[e]}},{key:"getBlobData",value:function(e){}},{key:"_updateAttachmentStates",value:function(){try{var e=0;sr.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._attachCache[this._attachKeys[t]];a.isInUse()&&a.onUpdate(!1,void 0,v.a.ChangeType.Auto)}sr.PaneUpdateBatcher.commitUpdateItems()}catch(i){m.default.reportError(i)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){m.default.reportError(e)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){m.default.reportError(e)}}this._loadedInitialData||!m.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){try{m.default.PAssert(1136,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1137,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){m.default.reportError(e)}this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(e){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){try{m.default.PAssert(1138,this.useItemStore(),"Must request an item store")}catch(e){m.default.reportError(e)}return this._defaultItemStore}},{key:"getActiveItemStore",value:function(e){try{m.default.PAssert(1139,e,"Must specify a valid paneID to get the item store for")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1140,this.useItemStore(),"Must request item store usage")}catch(a){m.default.reportError(a)}var t=this._activeItemStore[e];return t||this._defaultItemStore}},{key:"getBucketItemStore",value:function(e){return this._searchBuckets[e]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(e,t){return!1}},{key:"handleTapClick",value:function(e,t,a,i){return!1}},{key:"handleDoubleTap",value:function(e,t,a,i){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--;try{m.default.PAssert(1143,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){m.default.reportError(e)}}},{key:"notifyPanesReadyForLoad",value:function(){sr.PaneManager.runForEachPane(function(e){e.notifyPluginLoaded()},this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(e,t){return!0}},{key:"_createSearchBucket",value:function(e,t){var a;a=m.default.generateTempId();var i=sr.itemStoreManager.registerItemStore(a,this,{trackGlobally:!1});return i.createRoot(t||m.default.generateTempId(),"Search Results"),this._searchBuckets[a]=i,a}},{key:"_destroySearchBucket",value:function(e){this._searchBuckets[e].clearStore()}},{key:"swapInSearchBucket",value:function(e,t){try{m.default.PAssert(1144,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(r){m.default.reportError(r)}if(m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Swap IN search bucket: ",e),sr.PaneManager.isPaneActive(t)){var a=sr.PaneManager.getPaneById(t),i=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var n=i.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=a.getItem()),this._activeItemStore[t]=i,this._activeSearchBucket[t]=i,a.setRootItem(n,!0),a.useItemStore(i)}}}},{key:"swapOutSearchBucket",value:function(e,t){try{m.default.PAssert(1145,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(s){m.default.reportError(s)}var a=this._activeSearchBucket[e].id;m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Swap OUT search bucket: ",a);var i=sr.PaneManager.getPaneById(e),n=this._searchBuckets[a];try{m.default.PAssert(1146,n,"Must have a valid bucket we are swapping from")}catch(s){m.default.reportError(s)}var r=i.getRootItem();try{m.default.PAssert(1147,r===n.getRoot(),"Current root for pane should match bucket root")}catch(s){m.default.reportError(s)}t=t||this._defaultZoomItems[e];try{m.default.PAssert(1148,t,"Must always be able to get a valid default zoom item")}catch(s){m.default.reportError(s)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,i.setItem(t,!0),i.stopUsingItemStore(n),this._destroySearchBucket(a)}},{key:"runSearch",value:function(e,t,a,i,n){try{m.default.PAssert(1149,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(s){m.default.reportError(s)}var r;return i&&(r=this._createSearchBucket(e,a)),this.runRemoteSearch(e,t,r,n)}},{key:"getSearchRoot",value:function(e){var t=this._searchBuckets[e];try{m.default.PAssert(1150,t,"Should always reference a valid search bucket")}catch(a){m.default.reportError(a)}return t.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(e){return!!this._activeSearchBucket[e]}},{key:"clearSearch",value:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}},{key:"refreshCurrentView",value:function(e){try{m.default.PAssert(1151,!1,"SubClass must override")}catch(t){m.default.reportError(t)}}},{key:"dumpRequestQueue",value:function(e){var t=0,a=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var i=0;i<this._outstandingRequests.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._outstandingRequests[i];console.log("  ",n.requestFn,":",n.id," - ",n.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var r=0;r<this._pendingRequests.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._pendingRequests[r];console.log("  ",s.requestFn,":",s.id," - ",s.data)}if(e){var o=0;try{m.default.PAssert(1152,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(d){m.default.reportError(d)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var l=0;l<this._handledRequests.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=this._handledRequests[l];u.failed?console.log(" !",u.requestFn,":",u.id," - ",u.data):console.log("  ",u.requestFn,":",u.id," - ",u.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(e,t){return""}},{key:"getSyncAccounts",value:function(e){var t=this;var a=[],i=sr.settings.syncAccounts.get();return i&&(a=Object.keys(i).filter(function(e){return!!i[e][t.id]})),0!==a.length||e||(a=[sr.settings.getUserIdentifier()]),a}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(e,t){var a=!1,i=sr.settings.syncAccounts.get();if(i){var n=i[e];a=n&&n[this.id]}return a||t||e!==sr.settings.getUserIdentifier()||(a=!0),a}},{key:"getWordStyles",value:function(){return{}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(e,t,a,i){}},{key:"googleScopes",value:function(e){return[]}},{key:"getDependencies",value:function(){return[]}}]),e}();L.a.defineBase(Te);var Le=Te,xe=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.Date,"t","Date",!0))).pluginMargin=0,e.pluginPadding=8,e.declareProperty("itemID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!1),e}return g()(t,e),o()(t,[{key:"getStyledText",value:function(e,t,a,i){return this.getUnstyledText(e,a)}},{key:"getUnstyledText",value:function(e,t){if(t=t||_.a.getItem(e.id)){var a=t.getMooDate();if(a)return a.toText(!0)}return""}},{key:"getAttachMeasure",value:function(e,t,a){}},{key:"getWordStyles",value:function(){return{fontSize:11}}},{key:"getAttachmentEmbedString",value:function(){return v.a.CharDate}},{key:"_getTextForItem",value:function(e){try{m.default.PAssert(602,e,"Must pass in a valid item to get text for")}catch(t){m.default.reportError(t)}return v.a.CharDate}},{key:"getAttachmentClass",value:function(e){var t=["inlineDate","c-date","c-shadow-thin"],a=_.a.getItem(e.id);if(a){var i=a.getMooDate();i&&i.getGCalId()&&(t=t.concat("syncedToCalendar"))}return t}},{key:"requestData",value:function(e,t){e.notifyDataLoaded(v.a.PluginLoad.Full,!1,void 0,v.a.ChangeType.Remote)}},{key:"handleTapStart",value:function(e,t,a,i){return!0}},{key:"handleTapClick",value:function(e,t,a,i){return i.altKey?(R.a.reset(),e.setMooDate(void 0,v.a.ChangeType.Local)):sr.menus.openContextMenu({componentName:"ReactContextMenuDate",element:i.target,item:e,pane:t}),!0}}]),t}(Le);function Re(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}var Oe={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){m.default.log("Pagination Update")}};L.a.defineBase(Re),L.a.extend(Re.prototype,Oe);var Fe=Re;function Ne(e,t,a){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=a,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,L.a.forceBind("onEntry",this)}var Be={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{m.default.PAssert(968,m.default.isFunction(e)&&m.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(o){m.default.reportError(o)}try{m.default.PAssert(969,!this._invalid,"Should never request another page from an invalidated search")}catch(o){m.default.reportError(o)}try{m.default.PAssert(970,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(o){m.default.reportError(o)}try{m.default.PAssert(971,!this._activePageRequest,"Should only run a single request at a time")}catch(o){m.default.reportError(o)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var a=0,i=0;i<this._pageSize;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._cachedResults[this._localPageOffset+i];try{e(n)}catch(l){m.default.reportError(l)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var r=0,s=this._localPageOffset;s<this._cachedResults.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=this._cachedResults[s];try{e(n)}catch(l){m.default.reportError(l)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};L.a.inherit(Fe,Ne),L.a.extend(Ne.prototype,Be);var Ue,Ve,He=Ne,je=a(121),ze=function(e){function t(e){var a;r()(this,t);var i={title:"Files",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return v.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,hasMoreButtons:!0,searchFilters:[],supportsDocuments:!1};return e.plugin=sr.pluginManager.getPlugin(v.a.PluginID.Drive),(a=u()(this,c()(t).call(this,e,i))).type=a.plugin._paneType,a.paneClass="paneOutline panePlugin paneDrive noComplete",a._isSearchingRemote=new z.a(!1),a._currentSearch=void 0,a.initDrive(),a}return g()(t,e),o()(t,[{key:"initDrive",value:function(){this.search.onChanged.listen(L.a.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,f()(c()(t.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&(t.indexOf(v.a.PluginDependency.PremiumSub)>=0?e="Only available to premium subscribers.":t.indexOf(v.a.PluginDependency.GoogleLogin)>=0&&(e="Missing permissions for Google Drive access.")),e}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"bottomListMessage",value:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(e){this.plugin.requestDemandLoadData(this.id,e)}},{key:"requestDataPage",value:function(e){this.plugin.requestDataPage(e)}},{key:"onAfterLoaded",value:function(){f()(c()(t.prototype),"onAfterLoaded",this).call(this)}},{key:"onClose",value:function(){f()(c()(t.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){var e=this;if(sr.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getValue();this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(t,this.id,void 0,!1,function(t){switch(e.isLoading.set(!1),t){case v.a.SearchResultStatus.Done:e.paneTopText.set("");break;case v.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case v.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case v.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(966,!1,"Invalid search state: ",t)}catch(a){m.default.reportError(a)}}})}}},{key:"notifySearchChanged",value:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView(this.id)}},{key:"notifyDropFrom",value:function(e,t){this.plugin.notifyDropFrom(e,t)}},{key:"notifyDropFromToEdit",value:function(e,t){return this.plugin.notifyDropFromToEdit(e,t)}},{key:"applyDropOnBlock",value:function(e,t){if(e.isDate){var a,i=e.dateTime||e.date;a=m.default.isString(i)?sr.International.parseDate(i,v.a.DateFormat.MDY):i;try{m.default.PAssert(967,m.default.isDateValid(a),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(n){m.default.reportError(n)}m.default.isDateValid(a)&&this.plugin.scheduleFile(t,a)}}},{key:"dropEffectCopyBehavior",value:function(e,a){return f()(c()(t.prototype),"dropEffectCopyBehavior",this).call(this,e,a)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(e,t){if(t){var a=this.plugin,i=e.getAttachmentByPlugin(a.id),n=i&&a.getCacheData(i.id);return!n||a.isFolder(n)}return e.isHeader()}},{key:"titleOfFirstItem",value:function(){return"Drive Root"}}]),t}(je.a),qe=a(28),We=a(122),Ge="application/octet-stream",Ke="application/vnd.google-apps.folder",Ye="application/vnd.google-apps.spreadsheet",Xe="application/vnd.google-apps.presentation",Qe="application/vnd.google-apps.document",Je="application/vnd.google-apps.drive-sdk.597847337936",Ze="image/png",$e="image/jpg",et="image/jpeg",tt="image/gif",at=1,it=2,nt=3,rt=4,st=5,ot=6,lt=7,ut="S~SharedWithMe",dt="https://drive.google.com/open?id=",ct="-------314159265358979323846",ht="\r\n--"+ct+"\r\n",ft=(Ue=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.Drive,"d","Files",!1))).displaySharedWithMe=!m.default.isDemoMode(),e._requiresOfflineAuth=!0,e.registerSetting("WriteAccess","writeAccess","w",!0),e.registerSetting("LastChangeId","lastChangeId","i"),e.registerSetting("DriveRootId","driveRootId","d"),e._folderCache=e.registerLocalCache(e.id,v.a.StorageType.IndexedDB,{metadataKeys:["isSyncd"],keyFieldsRN:[]}),e.declareProperty("showInline",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0),e.declareProperty("imageWidth",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0),e.declareProperty("titleLower",v.a.PluginLoad.Runtime,!1,""),e.declareProperty("dataUrl",v.a.PluginLoad.Preview|v.a.PluginLoad.Runtime,!0),e.declareProperty("pinToTop",v.a.PluginLoad.Runtime,!0,!1),e.declareProperty("title"),e.declareProperty("mimeType"),e.declareProperty("fileSize",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0),e.declareProperty("alternateLink",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0),e.declareProperty("webContentLink",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0),e.declareProperty("isDeleted",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedDate",v.a.PluginLoad.Autocomplete,!0),e.declareProperty("parents",v.a.PluginLoad.Autocomplete,!0),e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.DriveFile),e.useRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.DriveFile),e.useRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.DriveFile),e}return g()(t,e),o()(t,[{key:"getType",value:function(){return v.a.PluginType.Storage}},{key:"getDataPane",value:function(){try{m.default.PAssert(634,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){m.default.reportError(e)}return ze}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:U.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"onAuthorizedSetting",value:function(e,t){switch(e){case this.Settings.WriteAccess:t&&this._ensureAttachmentsAreShared()}}},{key:"_ensureSpecialFolders",value:function(){var e=this.getDefaultItemStore();if(e){var t=e.getRoot();if(this.displaySharedWithMe&&!e.hasItem(ut)){var a=m.default.generateTempId();this.cacheData(a,{title:"Shared With Me",titleLower:"shared with me",mimeType:Ke,pinToTop:!0});var i=this.getAttachment(a),n=e.createItem(ut,this.getAttachmentEmbedString(i),t.id,{demandLoadChildren:!0});t.insertSorted(n,this.sortFn)}}}},{key:"_load",value:function(){this._ensureSpecialFolders(),m.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:m.default.minutes(15),minDelay:m.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})}},{key:"_notifyFailedRequest",value:function(e){e&&e.error&&m.default.reportError(new Error("Failed Drive request: "+e.error.code),e)}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){var e=this;f()(c()(t.prototype),"loadInitialData",this).call(this),this._ensureSpecialFolders();var a=new Fe(function(){});setTimeout(function(){if(!e._folderCache.getMetadata("isSyncd")){m.default.log("Folder cache unsyncd - running folder sync");var t="trashed=false and mimeType contains '"+Ke+"'";e._requestRemoteFiles(it,a,t,999,function(t){e._folderCache.saveEntry(e.serializeExternalData(t)),0},function(e){0}),e._folderCache.setMetadata("isSyncd",!0)}},100);var i=!1,n=this.getDefaultItemStore(),r=n.getRoot(),s="trashed=false and 'root' in parents and mimeType != '"+Je+"'";this._requestRemoteFiles(nt,r,s,70,function(t){if(e.hasCacheData(t.id)||e._addRemoteEntry(t),!e._hasSameItem(t.id,r.id,n)){var a=n.createItem(e._createItemID(t.id,n),e._getTextForItem(t),r.id,{demandLoadChildren:t.mimeType===Ke});r.insertSorted(a,e.sortFn)}if(!e.getSetting(e.Settings.DriveRootId)&&t.parents)for(var i=0,s=0;s<t.parents.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t.parents[s].isRoot&&e.setSetting(e.Settings.DriveRootId,t.parents[s].id)}},function(){i||(i=!0)})}},{key:"performChangeListUpdate",value:function(){var e=this,t=-1,a=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(a,function(i){try{m.default.PAssert(635,!a||parseInt(i.id)>parseInt(a),"Must have correctly ordered change entry")}catch(n){m.default.reportError(n)}t=i.id;try{!i.fileId||i.file&&i.file.mimeType===Je||e._handleChange(i)}catch(r){m.default.reportError(r)}},function(a){a&&-1!==t&&e.setSetting(e.Settings.LastChangeId,t)})}},{key:"_deleteFile",value:function(e){e.forEachItem(this.getDefaultItemStore(),function(e){e.parent().removeChild(e,v.a.ChangeType.Remote),e.setParent(void 0)}),e.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(e){var t=this;try{m.default.PAssert(636,e&&(e.deleted||e.file),"Must have a valid formed change entry to handle")}catch(k){m.default.reportError(k)}if((e.deleted||e.file.mimeType===Ke)&&(e.deleted?this._folderCache.hasEntry(e.fileId).then(function(a){a&&t._folderCache.removeEntry(e.fileId)}):this._folderCache.saveEntry(this.serializeExternalData(e.file))),!this.hasCacheData(e.fileId)&&!e.deleted&&e.file){for(var a=0,i=e.file.parents,n=!1,r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.hasCacheData(i[r].id)||i[r].isRoot){n=!0;break}}n&&this._addRemoteEntry(e.file)}var s=this.getCacheData(e.fileId);if(s){e.deleted||this.dataHasChanged(s,e.file)&&this._addRemoteEntry(e.file);var o=this.getDefaultItemStore();if(e.deleted){var l=this.getAttachment(e.fileId);this._deleteFile(l)}else{var u=0,d=[];(l=this.getAttachment(e.fileId)).forEachItem(o,function(a){for(var i=0,n=!1,r=0;r<e.file.parents.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=e.file.parents[r];if(s.isRoot&&a.parent()&&a.parent().isRootItem()||a.parent()&&a.parent().hasAttachment(s.id)){n=!0,d.push(s.id);break}}a.parent()&&t._isSpecialFolder(a.parent().id)&&(n=!0,d.push(a.parent().id)),!n&&a.parent()&&(a.parent().removeChild(a,v.a.ChangeType.Remote),a.setParent(void 0))});for(var c=0;c<e.file.parents.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=e.file.parents[c];if(d.indexOf(h.id)<0)if(h.isRoot){var f=o.getRoot(),p=o.createItem(this._createItemID(e.fileId,o),this._getTextForItem(e.file),f.id,{demandLoadChildren:e.file.mimeType===Ke});f.insertSorted(p,this.sortFn)}else{this.getAttachment(h.id).forEachItem(o,function(a){var i=o.createItem(t._createItemID(e.fileId,o),t._getTextForItem(e.file),a.id,{demandLoadChildren:e.file.mimeType===Ke});a.insertSorted(i,t.sortFn)})}}if(this.displaySharedWithMe&&e.file.sharedWithMeDate&&d.indexOf(ut)<0){var g=o.getItem(ut),y=o.createItem(this._createItemID(e.fileId,o),this._getTextForItem(e.file),g.id,{demandLoadChildren:e.file.mimeType===Ke});g.insertSorted(y,this.sortFn)}}}}},{key:"_isValidFileID",value:function(e){return e.indexOf("~")<0}},{key:"_createItemID",value:function(e,t){var a=0;try{m.default.PAssert(637,e,"Must provide a fileID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(638,this._isValidFileID(e),"Invalid fileID - "+e)}catch(r){m.default.reportError(r)}try{m.default.PAssert(639,t,"Must provide a valid itemStore")}catch(r){m.default.reportError(r)}for(var i=e,n=0;t.hasItem(i)&&n<50;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=e+"~"+ ++n}try{m.default.PAssert(640,n<50,"SANITY: Should not have items with 50+ parents")}catch(r){m.default.reportError(r)}return i}},{key:"_hasSameItem",value:function(e,t,a){for(var i=0,n=!1,r=e,s=0;a.hasItem(r)&&s<50;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a.getItem(r);if(o&&o.parent()&&o.parent().id===t){n=!0;break}r=e+"~"+ ++s}return n}},{key:"_isSpecialFolder",value:function(e){return e.startsWith("S~")}},{key:"requestDemandLoadData",value:function(e,t){var a=this;try{m.default.PAssert(641,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(o){m.default.reportError(o)}var i,n=sr.PaneManager.getPaneById(e),r=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case ut:i="trashed=false and sharedWithMe and mimeType != '"+Je+"'";break;default:try{m.default.PAssert(642,!1,"Invalid special folder ID")}catch(o){m.default.reportError(o)}}i||(i="trashed=false and '"+r.id+"' in parents and mimeType != '"+Je+"'");var s=this.getActiveItemStore(e);this._requestRemoteFiles(nt,t,i,70,function(e){if(a.hasCacheData(e.id)||a._addRemoteEntry(e),!a._hasSameItem(e.id,t.id,s)){var i=s.createItem(a._createItemID(e.id,s),a._getTextForItem(e),t.id,{demandLoadChildren:e.mimeType===Ke});t.insertSorted(i,a.sortFn)}},function(e){e||t.hasPaginationToken()||t.notifyLoadDataFailed(n)}),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(e){this._requestRemoteFiles(st,e)}},{key:"_ensureAncestorChain",value:function(e,t,a,i){var n=this;try{m.default.PAssert(643,a,"Must provide a valid success callback")}catch(p){m.default.reportError(p)}try{m.default.PAssert(644,i,"Must provide a valid error callback")}catch(p){m.default.reportError(p)}if(t.parents&&t.parents.length)for(var r=0,s=t.parents.length,o=0,l=function(){++o===s&&a()},u=function(t){try{m.default.PAssert(645,t,"Must provide valid fileInfo up ancestor chain")}catch(p){m.default.reportError(p)}n.hasCacheData(t.id)||n._addRemoteEntry(t),n._ensureAncestorChain(e,t,l,i)},d=function(e){if(e){var t=n.serializeExternalData(e);n._folderCache.saveEntry(t),u(t)}else i({error:"Undefined success result."})},c=function(e){if(e)u(e);else{var t=be.a.fns("drive").files.get.packedFn,a={fileId:e.id};n._queueRemoteRequestMulti(qe.a.getDefaultAccountID(),t,a,d,i,void 0,lt)}},h=0;h<t.parents.length;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var f=t.parents[h].id;try{m.default.PAssert(646,f,"Must supply a valid parent ID to query")}catch(p){m.default.reportError(p)}c(this._folderCache.getEntry(f))}else a()}},{key:"_hasAttachmentChild",value:function(e,t){for(var a=0,i=!1,n=0;n<e.numItems();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.itemAtIndex(n).hasAttachment(t)){i=!0;break}}return i}},{key:"_attachAncestorChain",value:function(e,t){var a=this;try{m.default.PAssert(647,t,"Must provide a valid cache entry to create items for")}catch(l){m.default.reportError(l)}if(t.parents&&t.parents.length>0)for(var i=0,n=0;n<t.parents.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t.parents[n];try{m.default.PAssert(648,r&&r.id,"Must supply a valid parent ID to query")}catch(l){m.default.reportError(l)}if(r.isRoot){var s=e.getRoot();if(!this._hasAttachmentChild(s,t.id)){var o=e.createItem(this._createItemID(t.id,e),this._getTextForItem(t),s.id,{demandLoadChildren:t.mimeType===Ke});s.insertSorted(o,this.sortFn)}}else this._folderCache.getEntry(r.id).then(function(i){a._attachAncestorChain(e,i),a.getAttachment(i.id).forEachItem(e,function(i){if(!a._hasAttachmentChild(i,t.id)){var n=e.createItem(a._createItemID(t.id,e),a._getTextForItem(t),i.id,{demandLoadChildren:t.mimeType===Ke});i.insertSorted(n,a.sortFn)}})})}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(e,t,a,i){var n=this;try{m.default.PAssert(649,e,"Must provide a valid search")}catch(g){m.default.reportError(g)}try{m.default.PAssert(650,t,"Must provide a valid pane")}catch(g){m.default.reportError(g)}try{m.default.PAssert(651,m.default.isFunction(i),"Must provide a valid search callback")}catch(g){m.default.reportError(g)}var r=!1,s=0,o=0,l=0,u=new He(e,10,this.requestDataPage.bind(this)),d=function(){if(s===o&&r){m.default.log("Done Searching! "+s);var e=v.a.SearchResultStatus.Done;if(u.isValid())sr.PaneManager.getPaneById(t).search.update(!0),u.isValid()&&u.hasMoreResults()?(m.default.log("Too many search results"),e=v.a.SearchResultStatus.TooMany):u.hasError()||l>0?e=v.a.SearchResultStatus.Error:0===s&&(e=v.a.SearchResultStatus.None),n._lastCompletedSearch=u;i(e)}},c=function(e){s++,n.hasCacheData(e.id)||n._addRemoteEntry(e);var a=n.getActiveItemStore(t);n._ensureAncestorChain(a,e,function(){u.isValid()&&n._attachAncestorChain(a,e),o++,d()},function(e){m.default.reportError(new Error("Error during remote search: "+e)),o++,l++,d()})},h=function(e){r=!0,d()},f=!1,p="trashed=false and (fullText contains '"+e+"')";return this._requestRemoteFiles(rt,u,p,100,u.onEntry,function(e){u.onDone(e),f||(f=!0,u.isValid()&&(u.hasResults()?u.getNextPage(c,h):h()))}),this.sendEvent("RemoteSearch"),u}},{key:"_requestRemoteFiles",value:function(e,t,a,i,n,r){var s,o=this;t&&t.hasPaginationToken()&&!t.paginationTokenInUse()?(a=(s=t.beginDataPageLoad()).getQuery(),i=s.getMaxResults(),n=s.getEntryCB(),r=s.getDoneCB()):t&&t.needsPaginationToken()&&(s=this.createPaginationToken(void 0,a,{},i,n,r),t.setPaginationToken(s),t.beginDataPageLoad()),i=i||70;try{m.default.PAssert(652,n&&m.default.isFunction(n),"Must define a valid entry callback")}catch(h){m.default.reportError(h)}try{m.default.PAssert(653,r&&m.default.isFunction(r),"Must define a valid done callback")}catch(h){m.default.reportError(h)}var l,u,d=be.a.fns("drive").files.list.packedFn,c={fields:"items,nextPageToken",maxResults:i,q:a,pageToken:s&&s.hasMorePages()?s.getNextPageToken():void 0};s||!t?(l=function(e){if(e.items){var a=0;sr.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<e.items.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n(e.items[i])}sr.PaneUpdateBatcher.commitUpdateItems()}e.nextPageToken&&s&&o.updatePaginationToken(s,e.nextPageToken),t&&s&&t.endDataPageLoad(!!e.nextPageToken),r(!0)},u=function(){s&&t.endDataPageLoad(!!s),r(!1)}):(l=function(){r(!0)},u=function(){r(!1)}),qe.a.onActiveUser(function(t){o._queueRemoteRequestMulti(t,d,c,l,u,void 0,e)})}},{key:"getRemoteAttachmentData",value:function(e){var t=this,a=be.a.fns("drive").files.get.packedFn,i={fileId:e.id},n=function(a){try{m.default.PAssert(654,!a||a.id===e.id,"If valid result, attachment should match remote file ID")}catch(i){m.default.reportError(i)}a&&(t._addRemoteEntry(a),(a.deleted||a.mimeType===Ke)&&(a.deleted?t._folderCache.hasEntry(a.id).then(function(e){e&&t._folderCache.removeEntry(a.id)}):t._folderCache.saveEntry(t.serializeExternalData(a))))},r=function(a){if(m.default.isHTTPStatusCode(a,v.a.HTTPStatusCode.NotFound)){var i={id:e.id,mimeType:Ge,title:"Unknown",titleLower:"unknown",fileSize:0};t._addRemoteEntry(i),t._deleteFile(e)}else e.notifyDataRequestFailed(),t._notifyFailedRequest(a)};qe.a.onActiveUser(function(s){t._queueRemoteRequestMulti(s,a,i,n,r,e,at)})}},{key:"_requestChangeList",value:function(e,t,a){var i,n,r,s,o=this;if(e&&e>=0){try{m.default.PAssert(655,t,"Must supply a valid entry CB")}catch(l){m.default.reportError(l)}try{m.default.PAssert(656,a,"Must provide a valid done CB")}catch(l){m.default.reportError(l)}i=be.a.fns("drive").changes.list.packedFn,n={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+e+1,fields:"items,nextPageToken"},r=function(i){var n=0,r=e;sr.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<i.items.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=i.items[s];try{m.default.PAssert(657,u,"Must have a valid change entry")}catch(l){m.default.reportError(l)}try{m.default.PAssert(658,parseInt(u.id)<1e8,"Must have a valid entry ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(659,parseInt(u.id)>parseInt(r),"Must be ordered monotonic increasing")}catch(l){m.default.reportError(l)}r=u.id,t(u)}sr.PaneUpdateBatcher.commitUpdateItems(),i.nextPageToken?o._requestChangeList(r,t,a):a(!0)},s=function(e){a(!1)}}else i=be.a.fns("drive").changes.list.packedFn,n={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},r=function(e){var i=e.largestChangeId;t({id:i}),a(!0)},s=function(e){a(!1)};qe.a.onActiveUser(function(e){o._queueRemoteRequestMulti(e,i,n,r,s,void 0,ot)})}},{key:"_createRemoteEntry",value:function(e){var t={id:e.id,mimeType:e.mimeType,title:e.title,titleLower:e.title.toLowerCase(),alternateLink:e.alternateLink,webContentLink:e.webContentLink||e.alternateLink,dataUrl:e.dataUrl,fileSize:+e.fileSize,parents:e.parents,modifiedDate:e.modifiedDate?new Date(e.modifiedDate):void 0};if(t.parents)for(var a=0,i=0;i<t.parents.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[i])}return this.isFolder(t)&&(t.items=[]),t}},{key:"_addRemoteEntry",value:function(e){var t=this._createRemoteEntry(e);this.cacheData(t.id,t)}},{key:"createEntryFromLocal",value:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||m.default.isTempId(e),t.parents)for(var a=0,i=0;i<t.parents.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[i])}return t}},{key:"_updateParentsEntry",value:function(e){this._folderCache.getEntry(e.id).then(function(t){t&&(e.title=t.title)})}},{key:"isFolder",value:function(e){return e.mimeType===Ke}},{key:"_getCompStringForItem",value:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}},{key:"_isItemPinnedToTop",value:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}},{key:"getAttachmentClass",value:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}},{key:"getMimetypeClass",value:function(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case Ke:return"plugin_drive_folder";case Ye:return"plugin_drive_sheet";case Xe:return"plugin_drive_slide";case Qe:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(e){switch(e){case Ze:case tt:case $e:case et:return!0}}},{key:"isImage",value:function(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}},{key:"googleScopes",value:function(e){return e||this.getSetting(this.Settings.WriteAccess)?[v.a.GScope.DriveFull]:[v.a.GScope.Drive,v.a.GScope.DriveMetadataRO]}},{key:"getDependencies",value:function(){return[v.a.PluginDependency.PremiumSub,v.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(e){return ye.a.isAuthorizedForScopes(e,this.googleScopes())}},{key:"handleDropEvent",value:function(e,t){var a=e.dataTransfer?e.dataTransfer.getData("text/uri-list"):void 0,i=m.default.getPaneForElement(e.target);if(a&&a.startsWith(dt)){var n=a.replace(dt,""),r=n.indexOf("&"),s=n.substr(0,r);return m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Dropped File: ",s),t(this.getAttachment(s).getEmbedString()),!0}if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var o=0,l=0;l<e.dataTransfer.files.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=e.dataTransfer.files[l];this.handleDropFile(u,i,e,t)}return F.d.miscAction({type:F.b.Misc,misc:F.a.DriveUpload}),!0}if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0){var d=0;for(l=0;l<e.clipboardData.items.length;++l){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var c=e.clipboardData.items[l];(u=c?c.getAsFile():void 0)&&(u.customName="Moo.do Upload "+Date.now(),this.handleDropFile(u,i,e,t))}return F.d.miscAction({type:F.b.Misc,misc:F.a.DriveUpload}),!0}return!1}},{key:"highlightItem",value:function(e){e.highlight()}},{key:"handleDropFile",value:function(e,t,a,i){for(var n=0,r=this,s=e.customName||e.name,o=this.findCachedItemsByField("title",s),l=this.getDefaultItemStore(),u=t.type===v.a.PaneMode.Task&&this.isMimetypeImage(e.type)&&sr.settings.showImagesInline.get()?{showInline:!0}:void 0,d=!1,c=0;c<o.length;++c){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=o[c];if(h.fileSize===e.size&&!h.isDeleted){var f=this.getAttachment(h.id,u);if(t&&t.isWriteable&&t.plugin!==this)i(this.getAttachmentEmbedString(f),!1);else if(t&&t.plugin===this){var p=this.getDefaultItemStore();f.forEachItem(p,this.highlightItem)}d=!0;break}}if(!d){var g=m.default.generateTempId();this.cacheData(g,{title:s,titleLower:s.toLowerCase(),mimeType:e.type});var y,k,_=this.getAttachment(g,u),S=t&&t.isWriteable&&t.plugin!==this,P=!1;if(t&&t.isWriteable&&t.plugin!==this)P=!0;else if(a&&this.getSetting(this.Settings.WriteAccess)){var w=a.target;(y=m.default.hasClass(w,"paneContent")?t.getItem():m.default.getItemForElement(w))&&!y.isHeader()&&(y=y.parent())}if(y){if(!y.isRootItem()){var I=y.getAttachmentByPlugin(this.id);try{m.default.PAssert(660,I,"Drive items must have valid attachments")}catch(D){m.default.reportError(D)}k=I.id}}else y=l.getRoot(),k=this.getSetting(this.Settings.DriveRootId);var b=t.getDocument();this._upload(e,_,S,b,k,function(){try{m.default.PAssert(661,!l.hasItem(_.id),"When uploading a new file, should never have duplicated items")}catch(D){m.default.reportError(D)}var e=l.createItem(_.id,r.getAttachmentEmbedString(_),y.id);y.insertSorted(e,r.sortFn),P&&i(r.getAttachmentEmbedString(_),!0),b.isShared()&&sr.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})})}}},{key:"notifyDropFrom",value:function(e,t){var a=this;try{m.default.PAssert(662,e,"Must have a valid item that was dropped")}catch(r){m.default.reportError(r)}try{m.default.PAssert(663,t,"Must have a valid pane the item was dropped on")}catch(r){m.default.reportError(r)}if(!m.default.isDemoMode()){var i=e.getAttachmentByPlugin(this.id),n=t.getDocument();We.a.getDocumentFolder(n.id,function(e){We.a.copyFileToFolder(i.id,e,function(e,t){e||a.getSetting(a.Settings.WriteAccess)&&t.code===v.a.HTTPStatusCode.Unauthorized&&a.setSetting(a.Settings.WriteAccess,!1)})}),this.sendEvent("AttachmentDropped")}}},{key:"notifyDropFromToEdit",value:function(e,t){if(!m.default.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){if(e.getAttachmentByPlugin(this.id)){var a=document.createEvent("Event");a.item=e,a.initEvent("cdrop",!0,!0),t.dispatchEvent(a)}this.sendEvent("AttachmentDroppedEdit")}else sr.toasts.pushMessage(v.a.MessageID.NeedDrivePermission)}},{key:"getAttachUrl",value:function(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}},{key:"getAttachDataUrl",value:function(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}},{key:"handleTapStart",value:function(e,t,a,i){return!0}},{key:"handleTapClick",value:function(e,t,a,i){var n=this.getAttachment(a);if(x.a.mac&&i.metaKey||!x.a.mac&&i.ctrlKey||this.isPluginPane)return this.openAttach(n,e,t,!0,i)}},{key:"openAttach",value:function(e,t,a,i,n){var r=this.getCacheData(e.id);if(r){var s;if(this.isPluginPane(a)&&this.isFolder(r))a.zoomIn(t),this.sendEvent("Tap_FolderZoom");else r.alternateLink?s=r.alternateLink:r.id?s=this._createDriveURL(r.id,r.mimeType):sr.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:v.a.MessageAction.Okay}),s&&(i&&!(x.a.mac&&n.metaKey||!x.a.mac&&n.ctrlKey)&&this.isImage(e)?(s="https://drive.google.com/uc?export=view&id="+r.id,sr.menus.openLightbox(s)):s&&(m.default.isDemoMode()?sr.toasts.pushMessage(v.a.MessageID.DemoPluginClick):(m.default.openUrl(s,n),this.sendEvent("Tap_OpenFileDesktop"))));return!0}return!1}},{key:"createFolderURL",value:function(e){return"https://drive.google.com/drive/folders/"+e}},{key:"_createDriveURL",value:function(e,t){var a="https://docs.google.com/";switch(t){case Ke:return a+"folderview?id="+e+"&usp=drivesdk";case Ye:return a+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case Qe:return a+"document/d/"+e+"/edit?usp=drivesdk";case Xe:return a+"presentation/d/"+e+"/edit?usp=drivesdk";default:return a+"file/d/"+e+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(a=e[t]);break;default:a=e[t]}return a}},{key:"supportUsageCache",value:function(){return!0}},{key:"matchAttachment",value:function(e,t){return e.getField("titleLower").indexOf(t)>=0}},{key:"getBlockedText",value:function(e){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(e){this.getSetting(this.Settings.WriteAccess)?e&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&sr.toasts.pushMessage(v.a.MessageID.NoSharingWarning)}},{key:"_ensureAttachmentsAreShared",value:function(){}},{key:"notifyAttachmentUnused",value:function(e,a){f()(c()(t.prototype),"notifyAttachmentUnused",this).call(this,e,a),m.default.isDemoMode()}},{key:"_upload",value:function(e,t,a,i,n,r){var s=this;e.size>20971520?(sr.toasts.pushMessage(v.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var o=this.isMimetypeImage(e.type)&&sr.settings.showImagesInline.get();if(o){var l=new FileReader;l.onload=function(e){var a=s.getCacheData(t.id);a.dataUrl=e.target.result,s.cacheData(t.id,a),r(e)},l.readAsDataURL(e)}var u=new FileReader;u.readAsBinaryString(e),u.onload=function(r){var o=e.type||Ge;try{m.default.PAssert(664,i,"Must supply a valid paneDoc if uploading a file")}catch(l){m.default.reportError(l)}s.getDocumentFolder(i,function(i){ye.a.getDefaultAuthToken(s.googleScopes(),function(r){r?function(i,r){var l={title:e.customName||e.name,mimeType:o,parents:n?[{id:n}]:[]};a&&r&&l.parents.push({id:r});var d=btoa(u.result),c=ht+"Content-Type: application/json\r\n\r\n"+JSON.stringify(l)+ht+"Content-Type: "+o+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+d+"\r\n---------314159265358979323846--";window.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{Authorization:i?"Bearer "+i.access_token:void 0,"Content-Type":'multipart/mixed; boundary="'+ct+'"'},body:c}).execute(function(e){s.changeID(t,t.id,e.id),sr.remoteAPI().drivePermissionsPublic(e.id,function(){var a=s.getAttachDataUrl(t);a&&(e.dataUrl=a),s._addRemoteEntry(e)},function(e){m.default.reportError(new Error("Error adding permission"))})})}(r,i):sr.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:v.a.MessageAction.OpenSettings})})})},o||r()}},{key:"getDocumentFolder",value:function(e,t){return We.a.getDocumentFolder(e.id,t)}},{key:"scheduleFile",value:function(e,t){F.d.beginAction();var a=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(665,a,"Must be able to get a valid attachment from item")}catch(l){m.default.reportError(l)}var i=v.a.MSPerHour,n=sr.pluginManager.getPluginGCalendar();if(n){var r=n.getDefaultExportCalendarID();if(r&&(m.default.isDemoMode()||n.getSetting(n.Settings.WriteAccess))){var s=a.getField("title"),o=this._createDriveURL(a.id,a.getField("mimeType"));n.createEventForEmail(r,s,o,t,i,function(e,t,a,i){e||t?t||sr.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:v.a.MessageAction.Okay}):sr.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){sr.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:v.a.MessageAction.Okay})}})})}else sr.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:v.a.MessageAction.OpenCalendarSettings})}else sr.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:v.a.MessageAction.OpenSettings});F.d.endAction()}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=e.toLowerCase(),i=this.findCachedItemsByFn(function(e){return e.titleLower.indexOf(a)>=0},t);return i.sort(function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)}),i}},{key:"getAttachWidth",value:function(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(e,t,a){t.updateField("imageWidth",a,!0),e.onAttachInlineUpdate()}},{key:"setShowInline",value:function(e,t,a){t.updateField("showInline",a,!0),e.onAttachInlineUpdate()}}]),t}(Le),D()(Ue.prototype,"sortFn",[C.a],Object.getOwnPropertyDescriptor(Ue.prototype,"sortFn"),Ue.prototype),Ue),pt=a(62),gt=a.n(pt),mt="Gmail";function vt(e){var t={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(t.provider="Gmail",t.threadID=e.gmailID),t}var yt=new(function(){function e(){r()(this,e)}return o()(e,[{key:"dragOver",value:function(e){var t=m.default.elementFromPoint(e.x,e.y);if(t){var a=void 0!==this._prevX?e.x-this._prevX:0,i=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var n={clientX:e.x,clientY:e.y,diffX:a,diffY:i,target:t,dataTransfer:{}};sr.DragDrop.handleDragOver(n)}}},{key:"drop",value:function(e){var t=m.default.elementFromPoint(e.x,e.y);var a={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t)return vt(e)}},preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn};setTimeout(function(){sr.DragDrop.handleDrop(a)},0)}},{key:"dragLeave",value:function(){sr.DragDrop.handleDragLeave({target:document.getElementById("container")})}},{key:"reportError",value:function(e){m.default.reportError(new Error(e))}}]),e}()),kt=(Ve=function(e){function t(){var e;if(r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.Mailbird,"b","Mailbird",!0))).declareProperty("subject",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!1,""),e.declareProperty("from",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!1,""),e.declareProperty("date",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,new Date),e.declareProperty("subjectLower",v.a.PluginLoad.Runtime,!1,""),e.declareProperty("fromLower",v.a.PluginLoad.Runtime,!1,""),e.declareProperty("unread",v.a.PluginLoad.Runtime,!0,!1),e.declareProperty("snippet",v.a.PluginLoad.Runtime,!0,""),e.declareProperty("count",v.a.PluginLoad.Runtime,!0,1),e.declareProperty("latestMessageAt",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!1),e.declareProperty("provider",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0),e.declareProperty("threadID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0),e.declareProperty("hasAttachments",v.a.PluginLoad.Full,!0,!1),e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.EmailThread),e.useRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.EmailThread),e.useRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.EmailThread),e.isMailbirdEmbed=x.a.embed===v.a.EmbedApps.Mailbird,e.isMailbirdEmbed){e.setSetting(e.Settings.IsEnabled,!0),e._needInlineDataUpdate=[],sr.nativeBridge.registerEmbedBridge(gt()(e));var a=sr.nativeBridge.registerInboundAPI("mailbird");try{m.default.PAssert(612,a,"Error creating native inbound API for mailbird")}catch(i){m.default.reportError(i)}a&&(a.registerVariable("_prevX"),a.registerVariable("_prevY"),a.registerFunction("dragOver",yt.dragOver,!0),a.registerFunction("drop",yt.drop,!0),a.registerFunction("dragLeave",yt.dragLeave,!0),a.registerFunction("reportError",yt.reportError,!0)),e._mailbirdOutAPI=sr.nativeBridge.registerOutboundAPI("mailbird");try{m.default.PAssert(613,e._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(i){m.default.reportError(i)}e._mailbirdOutAPI&&(e._mailbirdOutAPI.requireFunction("selectConversation"),e._mailbirdOutAPI.requireFunction("selectConversationEx",!0),e._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),e._mailbirdOutAPI.requireFunction("getByIdEx",!0),e._canUpdateInlineData=e._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}return e}return g()(t,e),o()(t,[{key:"getPaneIcon",value:function(){return"icon-envelope"}},{key:"useItemStore",value:function(){return"Mailbird"}},{key:"_addRemoteEntry",value:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t}},{key:"createEntryFromLocal",value:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t}},{key:"getAttachmentClass",value:function(e){return["plugin_mailbird"]}},{key:"isPluginBlocked",value:function(){return!1}},{key:"handleEmbedMessage",value:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var a=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",a)}catch(i){m.default.reportError(i)}break;default:try{m.default.PAssert(614,!1,"Unknown embed message: "+e)}catch(n){m.default.reportError(n)}}}},{key:"handleDropEvent",value:function(e,t){try{m.default.PAssert(615,t,"Must provide a valid callback to the drop event")}catch(r){m.default.reportError(r)}if(e.dataTransfer){var a=e.dataTransfer.getData("mailbird/email");if(a){var i=this._addRemoteEntry(a),n=this.getAttachment(i.id,i);try{m.default.PAssert(616,n.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(r){m.default.reportError(r)}return t(this.getAttachmentEmbedString(n)),!0}}return!1}},{key:"handleTapStart",value:function(e,t,a,i){return!0}},{key:"handleTapClick",value:function(e,t,a,i){var n=this.getCacheData(a);if(!n){var r=this.getAttachment(a);r&&(n=r.getInlineData())}if(n){if(this.isMailbirdEmbed){var s;if(!n.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var o=null;if("Gmail"===n.provider){try{m.default.PAssert(617,n.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(u){m.default.reportError(u)}o=parseInt(n.threadID)}var l=n.id;s=this._mailbirdOutAPI.call("selectConversationEx",o,l,+n.latestMessageAt)}else{l=n.id.replace("mailbird_","");s=this._mailbirdOutAPI.call("selectConversation",l)}try{m.default.PAssert(618,void 0!==s,"Must always receive a value back from Mailbird")}catch(u){m.default.reportError(u)}if(!0===s||!1===s)try{m.default.PAssert(619,s,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(u){m.default.reportError(u)}else{try{m.default.PAssert(620,s&&s.then,"Must have a valid promise object returned")}catch(u){m.default.reportError(u)}s.then(function(e){try{m.default.PAssert(621,e,"Must have successfully selected the email conversation in Mailbird: ",n.id,n.provider)}catch(u){m.default.reportError(u)}},function(e){try{m.default.PAssert(622,!1,"Failed to successfully select the email conversation in Mailbird: ",n.id,n.provider)}catch(u){m.default.reportError(u)}})}}else switch(n.provider){case mt:m.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+n.threadID);break;default:sr.toasts.pushMessage(v.a.MessageID.MailbirdClick)}return!0}return!1}},{key:"getDisplayTags",value:function(e){return[]}},{key:"getDisplayParticipants",value:function(e){return""}},{key:"matchAttachment",value:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn(function(e){return e.subjectLower.indexOf(a)>=0||e.fromLower.indexOf(a)>=0},t)}},{key:"requestData",value:function(e,t){e.hasField("subject")?(e.notifyDataLoaded(v.a.PluginLoad.Full,!1,void 0,v.a.ChangeType.Remote),e.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(e)||(this._needInlineDataUpdate.push(e),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),e.hasField("latestMessageAt")||this.requestMissingData(e)):this.requestMissingData(e)}},{key:"requestMissingData",value:function(e){var t=this;this._canUpdateInlineData&&setTimeout(function(){t._mailbirdOutAPI.call("getByIdEx",e.id).then(function(a){try{var i=vt(JSON.parse(a));t.cacheData(i.id,i),t.fixAttach(e)}catch(n){m.default.reportError(n)}})},1e3)}},{key:"processMissingInlineUpdates",value:function(){var e=this._needInlineDataUpdate;if(e.length>0)for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];i.isLoaded()&&this.fixAttach(i)}}},{key:"fixAttach",value:function(e){var t=this;e.forEachItem(sr.itemStoreManager.getDefaultItemStore(),function(a){var i=a.getRawText();i=i.replace(t._getTextForItem(e.getData()),t.getAttachmentEmbedString(e)),a.setText(a.getParsedText(),v.a.ChangeType.Local)})}}]),t}(Le),D()(Ve.prototype,"processMissingInlineUpdates",[C.a],Object.getOwnPropertyDescriptor(Ve.prototype,"processMissingInlineUpdates"),Ve.prototype),Ve),_t=a(12),St=a.n(_t),Pt=a(22),wt=a.n(Pt);function It(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}It.prototype={registerOwner:function(e,t){try{m.default.PAssert(1542,e,"Must supply a valid owner object")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1543,!this._registeredOwners[t],"Must not double define an owner")}catch(a){m.default.reportError(a)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,a){try{m.default.PAssert(1544,e,"Must provide a valid owner")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1545,t,"Must provide a valid action ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1546,this._registeredOwners[e],"Must have already registered a valid owner")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1547,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1548,a,"Must pass in a valid undo/redo descriptor")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1549,m.default.isFunction(a.undo),"Must provide a valid undo fn")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1550,m.default.isFunction(a.redo),"Must provide a valid redo fn")}catch(i){m.default.reportError(i)}this._registeredActions[e][t]=a},_getOwner:function(e){try{m.default.PAssert(1551,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){m.default.reportError(t)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{m.default.PAssert(1552,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1553,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(t){m.default.reportError(t)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{m.default.PAssert(1554,0===this._currentAction.length,"Current actions should be flushed")}catch(t){m.default.reportError(t)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,a){var i={ownerID:e,actionID:t},n=this._getOwner(i);return this._getActionData(i).redo.apply(n,a)},performAction:function(e,t,a){try{m.default.PAssert(1555,this._aggregateActions>0,"Must be in a begin/end action block")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1556,a,"Must provide valid data for the action")}catch(i){m.default.reportError(i)}this._currentAction.push({ownerID:e,actionID:t,data:a})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];this.performAction(i.ownerID,i.actionID,i.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],a=t.events.length-1;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],n=this._getOwner(i);this._getActionData(i).undo.apply(n,i.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],a=0;a<t.events.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t.events[a],n=this._getOwner(i);this._getActionData(i).redo.apply(n,i.data.redoParams)}}};var bt,Dt,Et,Ct=It,At={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Mt={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},Tt={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},Lt={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},xt={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0},Rt=function(){function e(t,a,i,n,s,o){r()(this,e);try{m.default.PAssert(1559,t,"Must specify a valid account ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1560,a,"Must specify a valid label ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1562,!n||m.default.isDateValid(n),"Must provide a valid oldestSync date")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1563,o,"Must supply a valid label store this label belongs to")}catch(l){m.default.reportError(l)}this._labelStore=o,this._accountID=t,this._labelID=a,this._fullName=i,this._minName=void 0,this._matchName=i?i.toUpperCase():void 0,this._oldestSync=n,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!s||!s.isDeleted),this._labelListVisibility=s&&s.labelListVisibility?s.labelListVisibility:v.a.LabelListVisibility.Show,this._messageListVisibility=s&&s.messageListVisibility?s.messageListVisibility:v.a.MessageListVisibility.Show,this._origLabelID=void 0}return o()(e,[{key:"_getDisplayPriority",value:function(){return Mt[this.getLabelID()]||-1}},{key:"displayCompare",value:function(e){var t=this.isSystemOrSpecialLabel(),a=e.isSystemOrSpecialLabel();return t&&a?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:a?1:this.getName().localeCompare(e.getName())}},{key:"isDropTarget",value:function(){return!xt[this.getLabelID()]}},{key:"_getStoreLabel",value:function(e){var t,a=this,i=e.toUpperCase();return Object.keys(this._labelStore).some(function(e){var n=a._labelStore[e].getRawName();if(n&&n.toUpperCase()===i)return t=a._labelStore[e],!0}),t}},{key:"_computeAncestors",value:function(){try{m.default.PAssert(1564,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(r){m.default.reportError(r)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),a="",i=0;i<t.length-1;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a+=t[i];var n=this._getStoreLabel(a);n&&n!==this&&this._ancestors.push(n),a+="/"}this._computeMinName()}try{m.default.PAssert(1565,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(r){m.default.reportError(r)}}},{key:"_computeMinName",value:function(){for(var e=0,t=this.getRawName(),a=0;a<this._ancestors.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._ancestors[a].getMinName()+"/",n=t.indexOf(i);t=t.substr(n+i.length)}this._minName=t}},{key:"getAccountID",value:function(){return this._accountID}},{key:"getLabelID",value:function(){return this._labelID}},{key:"getRawName",value:function(){return this._fullName}},{key:"getMinName",value:function(){return this._minName?this._minName:this._fullName}},{key:"getMatchName",value:function(){return this._matchName}},{key:"isMatched",value:function(e){try{m.default.PAssert(1566,m.default.isString(e),"Must pass in a valid string for label name")}catch(i){m.default.reportError(i)}var t=!1,a=this.getMatchName();return e&&a&&a.indexOf(e.toUpperCase())>=0&&(t=!0),t}},{key:"isNamed",value:function(e){try{m.default.PAssert(1567,m.default.isString(e),"Must pass in a valid string for label name")}catch(i){m.default.reportError(i)}var t=!1,a=this.getMatchName();return e&&a&&a===e.toUpperCase()&&(t=!0),t}},{key:"getName",value:function(e){var t;if(At[this.getLabelID()])t=At[this.getLabelID()];else if(Tt[this.getLabelID()])t=Tt[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{m.default.PAssert(1568,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(a){m.default.reportError(a)}t=this.getLabelID()}return t||""}},{key:"hasName",value:function(){return At[this.getLabelID()]||Tt[this.getLabelID()]||!!this._fullName}},{key:"clearOldestSync",value:function(){this._oldestSync=void 0}},{key:"getOldestSync",value:function(){return this._oldestSync}},{key:"setOldestSync",value:function(e){try{m.default.PAssert(1569,m.default.isDateValid(e),"Must provide a valid oldestSync date")}catch(t){m.default.reportError(t)}this._oldestSync=e}},{key:"getMessageListVisibility",value:function(){return this._messageListVisibility}},{key:"getLabelListVisibility",value:function(){return this._labelListVisibility}},{key:"isLocalOnly",value:function(){return m.default.isTempId(this.getLabelID())}},{key:"updateLabelID",value:function(e){try{m.default.PAssert(1571,this.isLocalOnly(),"Should only ever modify local labels")}catch(t){m.default.reportError(t)}this._origLabelID=this.getLabelID(),this._labelID=e}},{key:"updateLabelName",value:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()}},{key:"getSaveData",value:function(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}}},{key:"getDisplayText",value:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr("Moo.do".length+1):this.getName(e)),t}},{key:"getOutlineText",value:function(){var e=this.getDisplayText();return e?e.replace(/ /g,"_"):void 0}},{key:"matchesText",value:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0}},{key:"hasAncestors",value:function(){return!!this._fullName&&this.getAncestors().length>0}},{key:"getAncestors",value:function(){return this._computeAncestors(),this._ancestors}},{key:"getParent",value:function(){var e=this.getAncestors();return e[e.length-1]}},{key:"isSystemLabel",value:function(){return!!At[this.getLabelID()]}},{key:"isSpecialLabel",value:function(){return!!Tt[this.getLabelID()]}},{key:"isSystemOrSpecialLabel",value:function(){return this.isSystemLabel()||this.isSpecialLabel()}},{key:"isCategoryLabel",value:function(){return!!Lt[this.getLabelID()]}},{key:"isArchived",value:function(){return"Archived"===this.getName()}},{key:"isStarred",value:function(){return"Starred"===this.getName()}},{key:"isInbox",value:function(){return"Inbox"===this.getName()}},{key:"isDraft",value:function(){return"Draft"===this.getName()}},{key:"isTrash",value:function(){return"Trash"===this.getName()}},{key:"isCustom",value:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()}},{key:"getUnreadCount",value:function(){return this._numUnread}},{key:"shouldDisplayInLabelList",value:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===v.a.LabelListVisibility.Show?e=!0:this.getLabelListVisibility()===v.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(e=!0)),e}},{key:"shouldDisplayInMessageList",value:function(){return this._messageListVisibility===v.a.MessageListVisibility.Show}},{key:"delete",value:function(){try{m.default.PAssert(1572,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){m.default.reportError(e)}this._isDeleted=!0}}]),e}(),Ot=a(78),Ft=0,Nt=function(){function e(t){r()(this,e),this._plugin=t,this._headers=[],this._mimeTree=void 0}return o()(e,[{key:"reset",value:function(){this._headers=[],this._mimeTree=void 0}},{key:"getMessageText",value:function(e){return e.decoded}},{key:"updateFromDraft",value:function(){var e=wt()(St.a.mark(function e(t,a,i,n,r,s){var o,l,u,d,c,h,f,p,g,v,y,k,_,S,P,w,I,b,D,E,C,A=this;return St.a.wrap(function(e){for(var M=0;;){if(M++>5e3&&__infLoop&&__infLoop(M))throw new RangeError;switch(e.prev=e.next){case 0:if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(i,n,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(a.to,!0)),a.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(a.cc,!0)),a.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(a.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",m.default.encodeMIMEHeader(a.subject||"(no subject)")),a.inReplyTo){this.addHeader("In-Reply-To",a.inReplyTo.trim()),l=t.messages.indexOfWithProperty("messageID",a.inReplyTo);try{m.default.PAssert(1573,l>=0,"Must always be able to find the message being replied to")}catch(T){m.default.reportError(T)}o=t.messages[l]}return a.references?u=a.references:o&&(u=(m.default.isTempId(o.messageID)?"":o.messageID)+(o.references?" "+o.references:"")),u&&this.addHeader("References",u.trim()),e.next=12,Ot.a.generatePlaintext(this.getMessageText(a));case 12:if(d=e.sent,(h=this._getAttachedResources(a)).length>0&&(c=this.createMimePart("multipart/mixed"),this.addMimePart(c)),!d){e.next=43;break}if(f=this.createMimePart("multipart/alternative"),this.addMimePart(f,c),p=this.createMimePart("text/plain",d,"7bit"),this.addMimePart(p,f),!((g=this._getInlineResources(a)).length>0)){e.next=39;break}v=0,y=this.createMimePart("multipart/related"),this.addMimePart(y,f),k=this.createMimePart("text/html",this.getMessageText(a),"7bit"),this.addMimePart(k,y),_=0;case 28:if(!(_<g.length)){e.next=37;break}if(!(v++>5e3&&__infLoop&&__infLoop(v))){e.next=31;break}throw new RangeError;case 31:S=g[_],(P=this.createResourcePart(S))&&this.addMimePart(P,y);case 34:++_,e.next=28;break;case 37:e.next=41;break;case 39:w=this.createMimePart("text/html",this.getMessageText(a),"7bit"),this.addMimePart(w,f);case 41:e.next=45;break;case 43:I=this.createMimePart(a.contentType||"text/html",this.getMessageText(a),"7bit"),this.addMimePart(I,c);case 45:if(!c||!r){e.next=59;break}b=0,D=0,E=function(){if(++D===h.length){for(var e=0,t=0,a=0;a<h.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=h[a];if(i.id&&m.default.isTempId(!i.id)){var n=A.createResourcePart(i);n&&A.addMimePart(n,c)}}s()}},C=0;case 50:if(!(C<h.length)){e.next=57;break}if(!(b++>5e3&&__infLoop&&__infLoop(b))){e.next=53;break}throw new RangeError;case 53:this._plugin.loadResource(t.id,a.id,h[C].cid,E);case 54:++C,e.next=50;break;case 57:e.next=60;break;case 59:setTimeout(s,0);case 60:case"end":return e.stop()}}},e,this)}));return function(t,a,i,n,r,s){return e.apply(this,arguments)}}()},{key:"_getInlineResources",value:function(e){var t=[];return m.default.forEachValue(e.resources,function(e){"inline"===e.disposition&&t.push(e)}),t}},{key:"_getAttachedResources",value:function(e){var t=[];return m.default.forEachValue(e.resources,function(e){"attachment"===e.disposition&&e.id&&t.push(e)}),t}},{key:"addHeader",value:function(e,t){try{m.default.PAssert(1574,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(i){m.default.reportError(i)}var a=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+a)}},{key:"_generateBoundary",value:function(){return"=========3141592653589moodo"+Date.now()+ ++Ft}},{key:"createMimePart",value:function(e,t,a,i){try{m.default.PAssert(1575,e,"Must supply a valid content type")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1576,void 0===t||a,"Must supply a valid content encoding")}catch(n){m.default.reportError(n)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:a,contentDisposition:i,children:[]}}},{key:"createResourcePart",value:function(e){try{m.default.PAssert(1577,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(n){m.default.reportError(n)}var t;if(e&&e.data){var a=e.mimeType+'; name="'+e.cid+'"',i=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(a,e.data,e.contentEncoding,i)).contentID=e.cid}return t}},{key:"addMimePart",value:function(e,t){try{m.default.PAssert(1578,e,"Must supply a valid mime part")}catch(a){m.default.reportError(a)}if(t)t.children.push(e);else{try{m.default.PAssert(1579,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(a){m.default.reportError(a)}this._mimeTree=e}}},{key:"_mimePartToBlob",value:function(e){var t="\r\n",a=[];function i(e,t){if(t){try{m.default.PAssert(1580,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(n){m.default.reportError(n)}var i=t.trim().replace(/[\r\n]/g,"");a.push(e+": "+i)}}var n=e.contentType;(e.content||(n+='; boundary="'+e.boundary+'"'),i("MIME-Version","1.0"),i("Content-Type",n),i("Content-Transfer-Encoding",e.contentEncoding),i("Content-Disposition",e.contentDisposition),e.contentID)&&i("Content-ID","<"+e.contentID+">");if(t=a.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var r=0,s=0;s<e.children.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[s])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t}},{key:"generateBlob",value:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}}]),e}(),Bt=a(74),Ut=(bt=function(e){function t(e){var a;r()(this,t);var i={title:"Email",contextMenuMode:"Gmail",paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return v.a.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,useLineCache:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:v.a.ExpandedPaneWidth,maxWidth:v.a.ExpandedPaneWidth+200,maxWidthSingle:v.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:function(e,t){var i=a.plugin.isItemUnread(t);if(e)return i&&e>0||!i&&e<0?v.a.MatchState.Yes:v.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:function(e,t){var i=a.plugin.isItemStarred(t);if(e)return i&&e>0||!i&&e<0?v.a.MatchState.Yes:v.a.MatchState.No}},{name:"priority",remoteStringFn:function(e){var t;switch(e){case v.a.VMLIFlag.P0:t="label:Moo.do/Priority High";break;case v.a.VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case v.a.VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:function(e,t){return a.plugin.getItemPriority(t)>=e?v.a.MatchState.Yes:v.a.MatchState.No}},{name:"category",remoteStringFn:function(e){return e?"category:"+e:""},matchFn:function(e,t){return e?a.plugin.itemHasLabel(t,e)?v.a.MatchState.Yes:v.a.MatchState.No:v.a.MatchState.Yes}}]};return e.plugin=sr.pluginManager.getPlugin(v.a.PluginID.Gmail),(a=u()(this,c()(t).call(this,e,i))).type=a.plugin._paneType,a.paneClass="panePlugin paneGmail",a.isInitializing=!0,a._lines=[{text:"\u2000",start:0,length:1,width:0}],a.dragMarginTop=25,a.blocks=[],a.blocksByKey={},a._focusedTrash=!1,a.shouldCheckHeight=!0,a.maxScrollOffset=0,a.selectedIndex=new z.a(-1,a.onSelectedIndexChanged.bind(gt()(a))),a._isSearchingRemote=new z.a(!1),a._overviewAccount=new z.a,a._currentSearch=void 0,a._ignoreRestoreScroll=!0,a._failedPageRequest=new z.a(!1),a.viewState=new z.a(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:v.a.GmailViewMode.Date}),a.item.listen(function(e){return a._onItemChange(e,!1)}),a.viewState.listen(a._onViewStateChange.bind(gt()(a))),L.a.binder(gt()(a),"onScroll","_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","openViewMenu","onEmailComposeClosed","onEmailPreviewClosed"),a.initGmail(),a._firstSelectedItemID=void 0,e.isExpanded&&(sr.EmailPreview.startOpenOnLoad(gt()(a)),a._firstSelectedItemID=e.selectedItem),a.isInitializing=void 0,a}return g()(t,e),o()(t,[{key:"initGmail",value:function(){O.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),k.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),k.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),k.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),k.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),O.a.unlisten("reset",this.onMultiselectReset),f()(c()(t.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(){var e=this;this.plugin.onPaneActivated(function(){e.isLoading.set(!1)})&&this.isLoading.set(!0),f()(c()(t.prototype),"onLoad",this).call(this),this.addScrollListener(this.onScroll),this._onItemChange(this.getItem(),!0)}},{key:"notifyPluginLoaded",value:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&this.setItem(t,!0)}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"searchCompare",value:function(e){var t=!1,a=e.getAttachmentByPlugin(this.plugin.id);if(a){var i=a.getField("accountID");this.plugin.hasSyncAccount(i)&&(this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e,!1)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0))}return t}},{key:"runItemSearch",value:function(e){try{m.default.PAssert(1581,e,"Must supply a valid param set for local item search")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1582,e.item,"Gmail pane always expects a valid item when running local item search")}catch(a){m.default.reportError(a)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):f()(c()(t.prototype),"runItemSearch",this).call(this,e)}},{key:"getItemSearchParams",value:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return O.a.getSelectedItems(this)}},{key:"restoreSelection",value:function(e){if(e.length>0){for(var t=0,a=[],i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.indexOfItem(e[i]);n>=0&&a.push(n)}if(a.length>1)this.selectedIndex.set(a[0],!1),O.a.setSelected(a,this);else if(1===a.length)this.selectIndex(a[0]);else{var r=this.selectedIndex.get();r>=this.numItems()&&(r=this.numItems()-1),this.selectIndex(r,!0)}}}},{key:"_setItems",value:function(e,t){for(var a,i=0,n=this,r=this.saveSelection(),s=[],o={},l=this.getViewMode()===v.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,u=0;u<e.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=e[u],c=this.plugin._getThreadIDFromItem(d);c&&!o[c]&&(s.insertSorted(d,l),this._firstSelectedItemID&&d.id===this._firstSelectedItemID&&(a=d),o[c]=!0)}if(this.updateOutline(s),this.restoreSelection(r),a&&e.length>0){var h=this.indexOfItem(a);h>=0&&(this.selectIndex(h),requestAnimationFrame(function(){n.setScrollOffset(n.getScrollTop(),v.a.ScrollDuration.Snap)})),this._firstSelectedItemID=void 0}}},{key:"setHeaders",value:function(e,t){var a=0,i=this;if(!this._overviewAccount.get()){var n=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(n.accountID)}this._allHeaders=e;for(var r=[],s={},o={},l=0;l<this._allHeaders.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u,d=this._allHeaders[l];if(s[u=this.plugin._getAccountIDFromItem(d)]||(s[u]=[]),this.plugin.isAccountItem(d))o[u]=d;else{var c=s[u];this.plugin.isDisplayHeader(d)&&c.insertSorted(d,this.plugin.labelVMLISortFn)}}var h=s[this._overviewAccount.get()];if(h){var f=o[u];try{m.default.PAssert(1583,f,"Must have valid account item")}catch(_){m.default.reportError(_)}if(f){var p=0;for(l=0;l<h.length;++l){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(l>0){var g=this.plugin.getLabelForVMLI(h[l-1]),y=this.plugin.getLabelForVMLI(h[l]);(g.isSystemOrSpecialLabel()&&!y.isSystemOrSpecialLabel()||!g.isCategoryLabel()&&y.isCategoryLabel())&&r.push(new Bt.a({type:v.a.BlockType.HR,id:"hr"+u+l,pane:this,index:l,sizeInPane:this.heightOverviewHR}))}r.push(h[l])}}}this.headersArr=r;var k=r.map(function(e,t){return m.default.isVMLI(e)?new Bt.a({type:"blockItem",item:e,id:e.id,pane:i,index:t,levelsDeep:e.levelsDeep.get()-1,sizeInPane:v.a.OverviewItemHeightDesktop}):new Bt.a(Object.assign({pane:i},e))});this.headerPaneObjects.set(k)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){var e=this.plugin.getDescriptorForItem(this.getItem()),t=this.plugin.getVMLIForAccount(e.accountID);return t===this.getItem()?[this.getItem()]:[t,this.getItem()]}},{key:"onClickTitle",value:function(e){return this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),f()(c()(t.prototype),"onClickTitle",this).call(this,e)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(e,t){try{m.default.PAssert(1584,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(a){m.default.reportError(a)}return this.plugin.createOutlinePaneItem(e,t)}},{key:"_refreshPaneData",value:function(e){this.plugin.refreshCurrentView(e)}},{key:"reportPaneError",value:function(){sr.menus.openModal(v.a.Modals.ReportBug)}},{key:"_onItemChange",value:function(e,t){var a=this;O.a.reset(this),this._clearCurrentSearch();var i=this.plugin.getLabelForVMLI(e);this._focusedTrash=i&&i.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,function(){a.isLoading.set(!1)}),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){O.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),sr.PaneManager.updatePaneStateForPane(this),this.setScrollOffset(0)}},{key:"getItemLabel",value:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}},{key:"onDataPagedIn",value:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScroll",value:function(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var e=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=e&&this.requestDataPage(this.getItem())}}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var e=this.plugin._getAccountIDFromItem(this.getItem());return ye.a.isAuthorizedForScopes(e,[v.a.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"sizeOfItem",value:function(e,a,i){if("blockHeader"===e.type)return 40;if(i)return f()(c()(t.prototype),"sizeOfItem",this).call(this,e,a,i);var n=this.objectAtIndex(a);return i?sr.DisplaySettings.lineItemHeight(n,e,this,1):v.a.EmailItemHeight}},{key:"onClickItem",value:function(e,t,a,i){m.default.activeInput.get()&&m.default.activeInput.get().blur();var n=!0;if(i.shiftKey){var r=O.a.getFirstSelectedIndex(this),s=O.a.getLastSelectedIndex(this);e<r?r=e:e>s&&(s=e),O.a.selectInOrder(r,s,this),n=!1}else if(m.default.hasClass(i.target,"emailLabel")){var o=i.target.textContent,l=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),u=this.plugin._getLabelByName(l,o);try{m.default.PAssert(1585,u,"Must be able to get a valid label if clicking a valid label: ",o)}catch(c){m.default.reportError(c)}if(u){var d=this.plugin.getVMLIForLabel(l,u);this.zoomIn(d),n=!1}}else m.default.hasClass(i.target,"itemCheckbox")||this.selectIndex(e);n&&t.onClick(e,a,i)}},{key:"onRightClickItem",value:function(e,a,i){(O.a.numSelectedInPane(this)<=1||!O.a.isSelected(e,this))&&this.selectIndex(e),f()(c()(t.prototype),"onRightClickItem",this).call(this,e,a,i),i.preventDefault(),i.stopPropagation()}},{key:"handleLeftSideTap",value:function(e,t){var a=e.item;this.toggleStar(a)}},{key:"handleRightSideTap",value:function(e,t){if(e&&e.hasPluginAttachment(this.plugin.id)){this.archiveEmailFromCurrentLabel(e);var a=this.selectedIndex.get();a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),m.default.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(e){this===e&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(e,t,a){var i=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?O.a.setSelected([e],this):O.a.reset(this),(t||i!==e)&&this.selectedIndex.notify(),a||sr.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(e,t){if(e){var a=this.indexOfItem(e);a>=0&&this.selectIndex(a,t)}else this.selectIndex(-1,t)}},{key:"onSelectedIndexChanged",value:function(e){if(sr.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&sr.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){var e=this;if(sr.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getRemoteValue(),a=this.plugin.getDescriptorForItem(this.item.get());if(a.labelID){var i=this.plugin._getLabelByID(a.accountID,a.labelID);i.isSpecialLabel()||i.isInbox()||!i.hasName()||(t+=" label:"+i.getName())}this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var n="R~"+this.getActualPaneItem().id+"~"+m.default.generateTempId();m.default.log("Gmail Remote Search ItemID: ",n),this._currentSearch=this.plugin.runSearch(t,this.id,n,!0,function(t){if(!e._destroyed&&e._isSearchingRemote.get())switch(e.paneEmptySearchMessage=t===v.a.SearchResultStatus.Done?e.paneEmptySearchMessageDefault:"",e.isLoading.set(!1),t){case v.a.SearchResultStatus.Done:e.paneTopText.set(""),e.setScrollOffset(0);break;case v.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case v.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case v.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(1586,!1,"Invalid search state: ",t)}catch(a){m.default.reportError(a)}}})}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var e=this.plugin,t=e.getDefaultAccount(),a=e._getLabelByID(t,Et.DRAFT),i=e.getVMLIForLabel(t,a);this.item.get()===i&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){0}},{key:"applyToSelection",value:function(e){var t=this.saveSelection();O.a.applyFnToSelected(e,this),this.restoreSelection(t)}},{key:"_autocompletePopup",value:function(e,t,a){var i=this;if(!e.elementDisplay){var n=O.a.getFirstSelectedIndex(this),r=this.elementAtIndex(n);e.elementDisplay=r}var s=[];O.a.applyFnToSelected(function(e){s.push(e)},this),e.items=s,e.onSelected=function(n){i.plugin.beginAction(),e.item?t(e.item,n):O.a.applyFnToSelected(function(e){t(e,n)},i),a&&a(),i.plugin.endAction()},N.a.showPopup(e)}},{key:"getPaddingForPaneObject",value:function(e,a){return a?f()(c()(t.prototype),"getPaddingForPaneObject",this).call(this,e,a):24}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return O.a.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return O.a.getFirstSelectedIndex(this)}},{key:"autocompleteSchedule",value:function(e,a){var i=this,n=this.selectedIndex.get();f()(c()(t.prototype),"autocompleteSchedule",this).call(this,e,function(){n>=i.numItems()&&(n=i.numItems()-1),i.selectIndex(n,!0),a&&a()})}},{key:"autocompleteSnooze",value:function(e,a,i){var n=this,r=this.selectedIndex.get();f()(c()(t.prototype),"autocompleteSnooze",this).call(this,e,a,function(){r>=n.numItems()&&(r=n.numItems()-1),n.selectIndex(r,!0),i&&i()})}},{key:"autocompleteMove",value:function(e,a){var i=this;e=e||{};var n=this.selectedIndex.get();e.positionOffset={left:40},f()(c()(t.prototype),"autocompleteMove",this).call(this,e,function(){n>=i.numItems()&&(n=i.numItems()-1),i.selectIndex(n,!0),a&&a()})}},{key:"autocompleteCreateTask",value:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var a=this.elementAtIndex(t),i=O.a.getSelectedItems(this);sr.menus.openItemEditor({element:a,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:i,positionOffset:{left:10},options:[{text:"Archive email",vlue:sr.pluginManager.getSetting(v.a.PluginID.Gmail,v.a.PluginSettingsID.Gmail.ArchiveOnOrganize),cb:function(){for(var t=0,a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(v.a.PluginAction.Gmail.Archive,!1,n)}}}],beginSave:function(){var t=0;sr.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=i[a].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(n,"Moo.do/Handled")||e.plugin.performAction(v.a.PluginAction.Gmail.AddLabel,!1,n,"Moo.do/Handled")}},endSave:function(t){e.plugin.endAction(),sr.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){f()(c()(t.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1588,t,"Must be able to get a valid attachment")}catch(i){m.default.reportError(i)}var a=t.getPlugin();a.isItemStarred(e)?a.performAction(v.a.PluginAction.Gmail.Unstar,!1,t):a.performAction(v.a.PluginAction.Gmail.Star,!1,t),this.updateItems()}},{key:"_openSelectedInMode",value:function(e){var t=O.a.getFirstSelectedIndex(this);this.selectIndex(t);var a=this.itemAtIndex(t);this.openEmailByItem(a,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(v.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(v.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(v.a.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveEmailFromCurrentLabel),this.plugin.endAction()}},{key:"archiveItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1589,a,"Must be able to get a valid attachment")}catch(i){m.default.reportError(i)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(v.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(v.a.PluginAction.Gmail.Archive,!1,a)}},{key:"deleteSelected",value:function(e,t){this.plugin.beginAction(),this.applyToSelection(this.deleteEmailFromCurrentLabel),this.plugin.endAction()}},{key:"applyPriorityToSelection",value:function(e,t){var a=this,i=e,n=!0;this.plugin.beginAction(),this.applyToSelection(function(r){var s=r.getAttachmentByPlugin(a.plugin.id);try{m.default.PAssert(1590,s,"Must be able to get a valid attachment")}catch(o){m.default.reportError(o)}t&&n&&(a.plugin.getAttachmentPriority(s)===e&&(i=v.a.VMLIFlag.None),n=!1),a.plugin.performAction(v.a.PluginAction.Gmail.SetPriority,!1,s,i),a.updateItems()}),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(O.a.isInverted(this)&&1===O.a.numSelectedInPane(this)&&O.a.setInverted(!1,this),O.a.isInverted(this)?(t=O.a.getFirstSelectedIndex(this),O.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(O.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(O.a.addSelected(t,this),this.scrollIndexIntoView(t,v.a.ScrollDuration.Default))):(t=this.indexOfNextVMLI(O.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t,v.a.ScrollDuration.Default))}},{key:"keyMoveUp",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(O.a.isInverted(this)||1!==O.a.numSelectedInPane(this)||O.a.setInverted(!0,this),O.a.isInverted(this)?(t=this.indexOfPrevVMLI(O.a.getFirstSelectedIndex(this)))>=0&&(O.a.addSelected(t,this),this.scrollIndexIntoView(t,v.a.ScrollDuration.Default)):(t=O.a.getLastSelectedIndex(this),O.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(O.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,v.a.ScrollDuration.Default))}},{key:"onHotkey",value:function(e,t,a){if(this.selectedIndex.get()>=0&&!sr.menus.isContextMenuOpen()&&"Email"===e){var i=this.itemAtIndex(this.selectedIndex.get()),n=!0;if(i){if("Up"===t)this.keyMoveUp(a);else if("Down"===t)this.keyMoveDown(a);else if("Open"===t)sr.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(i);else if("Archive"===t){a.shiftKey&&sr.EmailPreview.isOpenOnPane(this)&&sr.EmailPreview.close();var r=!this.getItemLabel(!0).isArchived();this.archiveSelected(r)}else if("Delete"===t)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===t)this.autocompleteSchedule();else if("Snooze"===t)this.autocompleteSnooze();else if("Move"===t)this.autocompleteMove();else if("Task"===t)this.autocompleteCreateTask();else if("Label"===t)this.autocompleteLabel({item:i});else if("MarkRead"===t)this.markReadSelected(!0);else if("MarkUnread"===t)this.markReadSelected(!1);else if("Star"===t)this.toggleStarSelected();else if("Reply"===t)this.replySelected();else if("ReplyAll"===t)this.replyAllSelected();else if("Forward"===t)this.forwardSelected();else if("Priority1"===t)this.applyPriorityToSelection(v.a.VMLIFlag.P0,!0);else if("Priority2"===t)this.applyPriorityToSelection(v.a.VMLIFlag.P1,!0);else if("Priority3"===t)this.applyPriorityToSelection(v.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===t)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel),this.plugin.endAction());else if("Undo"===t)this.handleUndo();else if("Print"===t){if(1===O.a.numSelectedInPane(this)){var s=O.a.getFirstSelectedItem(this),o=this.plugin.createPrintURLForThread(s.getAttachmentByPlugin(this.plugin.id));m.default.printPage(o)}}else if("OpenInGmail"===t){if(1===O.a.numSelectedInPane(this)){var l=O.a.getFirstSelectedItem(this),u=this.plugin.createURLForThread(l.getAttachmentByPlugin(this.plugin.id));m.default.openUrl(u)}}else n=!1;n&&m.default.preventDefault(a)}}}},{key:"archiveEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0),a=!t.isArchived();this.archiveItem(a,e),t.isInbox()||t.isArchived()||this.plugin.removeItemFromLabel(t,e)}},{key:"deleteEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.deleteItem(e,t)}},{key:"removeItemFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.removeItemFromLabel(t,e)}},{key:"canAcceptDragOver",value:function(e,t,a,i){if(e&&this.type===e.type&&(i||e&&this!==e)){var n,r=e.getItemLabel();if(i){var s=m.default.getElementParent(a);n=s&&m.default.getItemForElement(s)}else n=this.getItem();if(n&&this.plugin.isLabelItem(n)&&this.plugin.areItemsFromSameAccount(t,n)){var o=this.plugin.getLabelForVMLI(n);if(o!==r&&o.isDropTarget())return!0}}return!1}},{key:"_handleDragOverPane",value:function(e,t,a,i,n,r,s){return{targetElement:a,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(e,t,a,i,n){var r=!1;if(a){var s,o=t.pane,l=o.getItemLabel(),u=a.targetItem,d=this.plugin.getLabelForVMLI(u);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,u)){s=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1591,s,"Must be able to get a valid attachment")}catch(c){m.default.reportError(c)}this.plugin.beginAction(),this.plugin.performAction(v.a.PluginAction.Gmail.RemoveLabel,!1,s,l.getName()),this.plugin.attachmentHasLabel(s,d.getName())||this.plugin.performAction(v.a.PluginAction.Gmail.AddLabel,!1,s,d.getName()),o.notifyDropFrom(e,this),this.plugin.endAction(),r=!0}}return r}},{key:"notifyDropFrom",value:function(e,t){if(this.selectIndex(-1),t.type===v.a.PaneMode.Task){var a=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1592,a,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(v.a.PluginAction.Gmail.RemoveLabel,!1,a,"Inbox"),this.plugin.performAction(v.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction());var i=this.plugin.getAttachmentPriority(a);i!==v.a.VMLIFlag.None&&e.setPriority(i,v.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(a,"STARRED")&&e.setStarred(!0,v.a.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return this.getWidth()-56}},{key:"allowZoom",value:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}},{key:"performOverviewAction",value:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(e));this.zoomIn(t),m.default.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(e,a){return this.selectIndex(-1,void 0,!0),f()(c()(t.prototype),"setItem",this).call(this,e,a)}},{key:"isItemHeader",value:function(e,t){if(!t)return e.isHeader();for(var a=0,i=this.plugin,n=e.getItems(),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.isLabelItem(n[r])||i.isAccountItem(n[r]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!sr.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(e,a){f()(c()(t.prototype),"setExpanded",this).call(this,e,a),e||this===m.default.focusedPane||O.a.reset(this)}},{key:"applyDropOnBlock",value:function(e,t,a,i){var n=e,r=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1593,r,"Must be able to get a valid attachment")}catch(u){m.default.reportError(u)}if(n.isDate){var s,o=n.dateTime||n.date;s=m.default.isString(o)?sr.International.parseDate(o,v.a.DateFormat.MDY):o;try{m.default.PAssert(1594,m.default.isDateValid(s),"Must provide a valid date when scheduling an email",n.dateTime,n.date)}catch(u){m.default.reportError(u)}m.default.isDateValid(s)&&this.plugin.scheduleEmail(t,s)}else{var l;n.isStarred?this.plugin.performAction(v.a.PluginAction.Gmail.Star,!1,r):n.isImportant&&(l=v.a.VMLIFlag.P0),l&&this.plugin.performAction(v.a.PluginAction.Gmail.SetPriority,!1,r,l)}}},{key:"getSaveInfo",value:function(){var e=f()(c()(t.prototype),"getSaveInfo",this).call(this);e.viewState=this.viewState.get();var a=O.a.getFirstSelectedItem(this);return e.selectedItem=a?a.id:void 0,e}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItemsNew",value:function(e){var t=this,a=e.item;return{left:[{icon:"check",text:"Archive",backgroundColor:"#0c0",onActivated:function(){t.archiveEmailFromCurrentLabel(a)}}],right:[{icon:"format-align-left",backgroundColor:"#09d",onActivated:function(){sr.menus.openItemAutocomplete(function(e){t.plugin.moveEmailToItem(a,e.extraInfo)})}},{icon:"delete",backgroundColor:"#a30",onActivated:function(){t.deleteEmailFromCurrentLabel(a)}}]}}},{key:"titleOfFirstItem",value:function(){return this.getItem().getParsedText()}},{key:"onTapAddItem",value:function(e){sr.menus.openComposeEmail(sr.pluginManager.getPluginGmail())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return v.a.EmailItemHeight}},{key:"widthOfDrag",value:function(e){return this.getWidth()}},{key:"getStyledLinesForPaneObject",value:function(e,a){if(a)return f()(c()(t.prototype),"getStyledLinesForPaneObject",this).call(this,e,a);var i=e.item;return i.els||m.default.runSingleParse(i,v.a.ChangeType.Auto),U.a.generateStyledLines(i.els,this._lines,this,e.item)}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return"#2a6"}},{key:"openViewMenu",value:function(e){sr.menus.openContextMenu({componentName:"ReactContextMenuGmailSort",element:e.target,pane:this,onSelected:this.changeView})}},{key:"changeView",value:function(e){this.viewMode.set(e),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){var t=this.viewState.get();t.viewMode!==e&&(t.viewMode=e,this.viewState.set(t,!this.isFakePane))}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}},{key:"setDocument",value:function(){}},{key:"getItemHeight",value:function(){return v.a.EmailItemHeight}}]),t}(je.a),D()(bt.prototype,"archiveEmailFromCurrentLabel",[C.a],Object.getOwnPropertyDescriptor(bt.prototype,"archiveEmailFromCurrentLabel"),bt.prototype),D()(bt.prototype,"deleteEmailFromCurrentLabel",[C.a],Object.getOwnPropertyDescriptor(bt.prototype,"deleteEmailFromCurrentLabel"),bt.prototype),D()(bt.prototype,"removeItemFromCurrentLabel",[C.a],Object.getOwnPropertyDescriptor(bt.prototype,"removeItemFromCurrentLabel"),bt.prototype),bt),Vt=5e3,Ht=function(){function e(t,a,i){r()(this,e);try{m.default.PAssert(1557,m.default.isFunction(t),"Must provide a valid entry callback")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1558,m.default.isFunction(a),"Must provide a valid done callback")}catch(n){m.default.reportError(n)}this._entryCB=t,this._doneCB=a,this._delay=i||Vt,this._flushTimeout=void 0,this._entries=[],L.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}return o()(e,[{key:"getEntryCB",value:function(){return this._onEntry}},{key:"getDoneCB",value:function(){return this._onDone}},{key:"_onEntry",value:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))}},{key:"_onDone",value:function(e,t){sr.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{0,this._doneCB(e,t)}catch(a){m.default.reportError(a)}sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_flushEntriesWatchdog",value:function(){0}},{key:"_flushEntries",value:function(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),sr.PaneUpdateBatcher.beginUpdateItems(),ve.a.beginBatch();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(a){m.default.reportError(a)}}this._entries=[],ve.a.commitBatch(),sr.PaneUpdateBatcher.commitUpdateItems()}}]),e}(),jt=a(163),zt={EnsureLabelVMLI:"EnsureLabelVMLI",CreateLabelVMLI:"CreateLabelVMLI",MergeThread:"MergeThread",SyncdMessage:"SyncdMessage",ErrorSyncdMessage:"ErrorSyncdMessage",UnsyncdMessage:"UnsyncdMessage",OldUnsyncdMessage:"OldUnsyncdMessage",MessagesSyncd:"MessagesSyncd",MessageDataCached:"MessageDataCached"},qt={Snooze:"snoozemail",SendMail:"sendmail"},Wt=1,Gt=2,Kt=3,Yt=4,Xt=5,Qt=6,Jt=7,Zt=8,$t=9,ea=10,ta=11,aa=12,ia=13,na=14,ra=15,sa=16,oa=17,la=18,ua=19,da=20,ca={HistoryIDs:"historyIDs",Labels:"labels",SendAs:"sendAs"};!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(Et||(Et={}));var ha,fa={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},pa="==MOODO_ARCHIVED==",ga="==MOODO_ALLMAIL==",ma={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},va=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError","modifiedOffline"],ya="multipart/signed",ka="multipart/related",_a="message/partial",Sa="multipart/mixed",Pa="multipart/report",wa="multipart/parallel",Ia="multipart/alternative",ba="multipart/digest",Da="multipart/encrypted",Ea="multipart/voice-message",Ca="text/calendar",Aa="text/plain",Ma="text/html",Ta="text/watch-html",La="text/x-watch-html";!function(e){e.Unknown="unknown",e.Inline="inline",e.FormData="form-data",e.Attachment="attachment"}(ha||(ha={}));var xa,Ra,Oa,Fa,Na,Ba,Ua,Va,Ha,ja=["application","audio","example","image","message","model","video","text"],za=[Ia,Sa,Aa,Ma,Pa],qa=[Aa,Ma],Wa=[Ca,Ea,Da,Sa],Ga=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],Ka=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,Ya=/\'(.*)\'/g,Xa=(Dt=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.Gmail,"g","Email",!1,{s:!0})))._lastSyncTime=void 0,e._requiresOfflineAuth=!0,e.supportSyncAccounts=!0,L.a.binder(gt()(e),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),e._emailCache={},e._labelsByID={},e._labelsByName={},e._priorityLabels={},e._creatingDrafts={},e._pendingDraftUpdates={},e._pendingThreadLoads={},e._loadThreadMutex=0,e._activeDraftUpdates=0,e._accountSettings={},e._pendingSends={},e._draftCache={},e._unsyncdMessages={},e._pendingSyncdMessages={},e._numUnsyncdMessages=0,e._numSyncdMessages=0,e._outstandingContentSync=!1,e._undoStack=new Ct(10),e._generateUndoRedo(),e._syncingOfflineChanges=!1,e._draftFlushTimer=void 0,e.registerSetting("WriteAccess","writeAccess","w",!0),e.registerSetting("SyncTime","syncTime","t",!0,v.a.MaxGmailSyncTime.Free),e.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),e.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),e.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),e.addTrackedStat(zt.EnsureLabelVMLI),e.addTrackedStat(zt.CreateLabelVMLI),e.addTrackedStat(zt.MergeThread),e.addTrackedStat(zt.SyncdMessage),e.addTrackedStat(zt.ErrorSyncdMessage),e.addTrackedStat(zt.UnsyncdMessage),e.addTrackedStat(zt.OldUnsyncdMessage),e.addTrackedStat(zt.MessagesSyncd),e.addTrackedStat(zt.MessageDataCached),e._threadCache=e.registerLocalCache(e.id,v.a.StorageType.IndexedDB,{noInMemoryCache:!0,metadataKeys:[ca.HistoryIDs,ca.Labels,ca.SendAs],keyFieldsRN:["date","accountID","modifiedOffline"]}),e._rawCache=e.registerLocalCache(e.id+"Messages",v.a.StorageType.IndexedDB,{noInMemoryCache:!0,keyFieldsRN:["internalDate"]}),e.registerDeferredTaskType(qt.Snooze,e._handleDeferredSnoozeTask,e._cancelDeferredSnoozeTask,e._persistRemoteSnoozeTask),e.registerDeferredTaskType(qt.SendMail,e._handleDeferredSendMailTask,e._cancelDeferredSendMailTask,e._persistRemoteSendMailTask),e._contentSyncTask=e.registerLowImpactTask("ContentSync",e.driveMessageContentSync),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._cleanupLocalCaches),e._lastCacheCleanup=0,m.default.isDemoMode()?e.declareProperty("accountID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0,"me"):e.declareProperty("accountID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline),e.declareProperty("from",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!1,void 0,e._fromComparator),e.declareProperty("to",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!1,void 0,e._toComparator),e.declareProperty("subject",v.a.PluginLoad.Preview|v.a.PluginLoad.Full),e.declareProperty("date",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,new Date(0),e._dateComparator),e.declareProperty("lastModifiedDate",v.a.PluginLoad.Full,!0,void 0,e._dateComparator),e.declareProperty("modifiedOffline",v.a.PluginLoad.Full,!0,!1),e.declareProperty("pendingSend",v.a.PluginLoad.Full,!0,!1),e.declareProperty("messages",v.a.PluginLoad.Full,!0,[],e._messagesComparator),e.declareProperty("snippet",v.a.PluginLoad.Full),e.declareProperty("participants",v.a.PluginLoad.Runtime,!0,[]),e.declareProperty("subjectLower",v.a.PluginLoad.Runtime),e.declareProperty("count",v.a.PluginLoad.Runtime),e.declareProperty("dataLoaded",v.a.PluginLoad.Runtime,!0,!1),e.declareProperty("isDeleted",v.a.PluginLoad.Runtime,!0,!1),e.declareProperty("labelIds",v.a.PluginLoad.Runtime,!0,[]),e.declareProperty("hasAttachments",v.a.PluginLoad.Full,!0,!1),e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.EmailThread),e.useRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.EmailThread),e.useRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.EmailThread),sr.settings.syncAccounts.listen(e.onSyncAccountsChanged),e}return g()(t,e),o()(t,[{key:"getType",value:function(){return v.a.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return Ga}},{key:"getDataPane",value:function(){try{m.default.PAssert(1225,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){m.default.reportError(e)}return Ut}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:v.a.ItemStoreFilter.Priority,parserFn:U.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(e){return"me"===e?this.getDefaultAccount():e}},{key:"getDefaultAccount",value:function(){var e,t=sr.settings.getUserIdentifier();if(t){try{m.default.PAssert(1226,m.default.isDemoMode()||"me"!==t,'Should never return "me" as a valid user')}catch(a){m.default.reportError(a)}this.hasSyncAccount(t)&&(e=t)}else{try{m.default.PAssert(1227,!1,'Unable to get default account name, returning "me"')}catch(a){m.default.reportError(a)}e="me"}return e||(e=t),e}},{key:"isSameAccount",value:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}},{key:"areItemsFromSameAccount",value:function(e,t){var a=this._getAccountIDFromItem(e),i=this._getAccountIDFromItem(t);return this.isSameAccount(a,i)}},{key:"_handleAccountChanges",value:function(){var e=this,t=0,a=[];sr.PaneManager.runForEachPane(function(t){var i=e._getAccountIDFromItem(t.getItem());try{m.default.PAssert(1228,i,"Missing Account ID: ",t.id,t.getItem().id)}catch(n){m.default.reportError(n)}e.hasSyncAccount(i)||a.push(t)},this.getPaneType());for(var i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;sr.PaneManager.removePane(a[i])}0===a.length&&sr.PaneManager.notifyPanes()}},{key:"onSyncAccountsChanged",value:function(e,t){var a=this;sr.PaneUpdateBatcher.beginUpdateItems(),t&&Object.keys(t).forEach(function(i){if(t[i][a.id]&&(!e[i]||!e[i][a.id])){if(a._clearCachedData(i),a.getDefaultItemStore()){var n=a.getVMLIForAccount(i);n&&(n.deleteSelf(v.a.ChangeType.Local),n.getItemStore().destroyItem(n.id))}a._handleAccountChanges()}}),Object.keys(e).forEach(function(i){!e[i][a.id]||t[i]&&t[i][a.id]||(a.isActive()&&(a._ensureLabel(i,Et.INBOX,"Inbox",void 0,void 0,v.a.ChangeType.Local),a._ensureLabel(i,Et.UNREAD,"Unread",void 0,void 0,v.a.ChangeType.Local),a._ensureLabel(i,pa,"Archived",void 0,void 0,v.a.ChangeType.Local),a._ensureLabel(i,ga,"All Mail",void 0,void 0,v.a.ChangeType.Local),a._forceLabelSync(function(){a._forceThreadSync()})),a._handleAccountChanges())}),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_iterateSendAs",value:function(e){for(var t=0,a=this.getSyncAccounts(),i=!1,n=0;!i&&n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.getAccountSetting(a[n],"sendAs");if(r)for(var s=0,o=0;o<r.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=r[o];if(e(a[n],l)){i=!0;break}}else e(a[n])}}},{key:"getSignature",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e)return t=i.signature,!0}),t}},{key:"getReplyToAddress",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i&&i.sendAsEmail===e&&i.replyToAddress)return t=i.replyToAddress,!0}),t}},{key:"_computeDisplayName",value:function(e,t){var a;return!t.displayName&&t.isPrimary||(a=t.displayName),a}},{key:"getDisplayName",value:function(e){var t,a=this;return this._iterateSendAs(function(i,n){if(n&&n.sendAsEmail===e)return t=a._computeDisplayName(i,n),!0}),t}},{key:"getDefaultSendingAccount",value:function(e){var t;return this._iterateSendAs(function(a,i){if(a===e&&i&&i.isDefault)return t=i.sendAsEmail,!0}),t||(t=e),t}},{key:"getDefaultFromInfo",value:function(e){var t=this.getDefaultSendingAccount(e);try{m.default.PAssert(1229,t,"Must have found a valid account to send from")}catch(a){m.default.reportError(a)}return{text:this.getDisplayName(t),email:t}}},{key:"getSendingAccounts",value:function(e){var t=[];return this._iterateSendAs(function(a,i){e&&e!==a||(i?"pending"!==i.verificationStatus&&t.push(i.sendAsEmail):t.push(a))}),t}},{key:"getSyncAccount",value:function(e){var t;return this._iterateSendAs(function(a,i){if(i){if(i.sendAsEmail===e)return t=a,!0}else if(e===a)return t=a,!0}),t}},{key:"getSendingAccountInfo",value:function(e){var t,a=this;return this._iterateSendAs(function(i,n){if(n){if(n.sendAsEmail===e)return t={text:a._computeDisplayName(i,n),email:e},!0}else if(e===i)return!0}),t}},{key:"_getSettingsSendAs",value:function(e){for(var t=0,a=this,i=this.getSyncAccounts(),n=i.length,r=0,s={},o=function(t,a,i){t&&(s[a]=i.sendAs),++r===n&&e(s)},l=function(){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var e=i[u];ye.a.getAccountAuthToken(e,a.googleScopes(),function(t){t&&a._requestSettings(e,o)})},u=0;u<i.length;++u)l()}},{key:"_requestSettings",value:function(e,t){var a=this,i=be.a.fns("gmail").users.settings.sendAs.list.packedFn,n={userId:e};this._queueRemoteRequestMulti(e,i,n,function(a){t(!0,e,a)},function(i){t(!1,e,i),a._notifyFailedRequest(e,i)},void 0,da)}},{key:"_fromComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t){try{m.default.PAssert(1230,!m.default.isString(e),"Old from must not be a string")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1231,!m.default.isString(t),"New from must not be a string")}catch(i){m.default.reportError(i)}e.text===t.text&&e.email===t.email&&(a=!0)}}else a=!0;return a}},{key:"_toComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t){try{m.default.PAssert(1232,m.default.isArray(e),"Old to must be an array")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1233,m.default.isArray(t),"New to must be an array")}catch(i){m.default.reportError(i)}a=t.equals(e)}}else a=!0;return a}},{key:"_dateComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t){m.default.isString(e)&&(e=this.parseDateHeader(e)),m.default.isString(t)&&(t=this.parseDateHeader(t));try{m.default.PAssert(1234,m.default.isDateValid(e),"Must be an old valid date to compare")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1235,m.default.isDateValid(t),"Must be a new valid date to compare")}catch(i){m.default.reportError(i)}m.default.isDateValid(e)&&m.default.isDateValid(t)&&(a=e.equals(t))}}else a=!0;return a}},{key:"_messagesComparator",value:function(e,t){var a=!0;if(e&&t)if(e.length===t.length)for(var i=0,n=0;a&&n<t.length;++n){var r=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=e[n],o=t[n],l=0;l<va.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=va[l],d=!0;switch(u){case"from":d=this._fromComparator(s[u],o[u]);break;case"to":d=this._toComparator(s[u],o[u]);break;case"resources":case"listUnsubscribe":d=this._shallowObjComparator(s[u],o[u]);break;case"labelIds":d=o[u].equals(s[u]);break;case"date":case"internalDate":d=this._dateComparator(s[u],o[u]);break;default:d=s[u]===o[u]}d||(a=!1)}}else a=!1;else a=!1;return a}},{key:"_shallowObjComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t)if(e===t)a=!0;else for(var i in a=!0,e)if(!t.hasOwnProperty(i)){a=!1;break}}else a=!0;return a}},{key:"onPaneActivated",value:function(e){}},{key:"_offlineLoad",value:function(){var e=this;return qe.a.onActiveUser(function(){if(!m.default.isDemoMode()){var t=e._threadCache.getMetadata(ca.SendAs);t&&Object.keys(t).forEach(function(a){return e.setAccountSetting(a,"sendAs",t[a])})}var a=e._threadCache.getMetadata(ca.Labels);m.default.batchRenderUpdates(function(){var t=0,i=e.getSyncAccounts();!m.default.isDemoMode()&&a||(a={}),a.me&&!a[e.getDefaultAccount()]&&(a[e.getDefaultAccount()]=a.me),sr.PaneUpdateBatcher.beginUpdateItems();for(var n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n];e._ensureLabel(r,Et.INBOX,"Inbox",void 0,void 0,v.a.ChangeType.Local),e._ensureLabel(r,Et.UNREAD,"Unread",void 0,void 0,v.a.ChangeType.Local),e._ensureLabel(r,pa,"Archived",void 0,void 0,v.a.ChangeType.Local),e._ensureLabel(r,ga,"All Mail",void 0,void 0,v.a.ChangeType.Local);var s=a[r];if(s){for(var o in s)if(s.hasOwnProperty(o)){var l=s[o];if(!Et[l.id]){var u=l.name||"LocalLabel"+Date.now();m.default.isString(l.oldestSync)&&(l.oldestSync=new Date(l.oldestSync)),e._ensureLabel(r,o,u,l.oldestSync,l,v.a.ChangeType.Local)}}for(var d in Et)if(Et.hasOwnProperty(d)){var c=fa[d];e._ensureLabel(r,d,c,void 0,void 0,v.a.ChangeType.Local)}}e._ensureLabelVMLIsForAccount(r)}var h=e._getMetadataSyncTime(),f=e._getUnreadSyncTime(),p=e._threadCache.getPreloadData();if(p){try{m.default.PAssert(1237,m.default.isObject(p),"Thread preload is not object")}catch(g){m.default.reportError(g)}!function(t){if(t){e._isLoadingLocal=!0;var a=[];Object.keys(t).forEach(function(n){var r=t[n];try{m.default.PAssert(1236,r,"Must always contain a valid entry when retreiving data from preload")}catch(g){m.default.reportError(g)}if(r&&(e.ensureThreadDates(r),function(e){return i.indexOf(e.accountID)>=0&&e.date.isAfter(f)}(r))){var s=e.createEntryFromLocal(r.id,r);(e.isPriorityData(s)||r.date.isAfter(h))&&(e.cacheData(s.id,s)&&a.push(s),e._updateSpecialLabels(s))}}),e._isLoadingLocal=!1,m.default.scheduleIdleTask(function(){var t=0;ve.a.beginBatch();for(var i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e._checkUnsyncdMessageContent(a[i])}ve.a.commitBatch()})}}(p)}sr.PaneUpdateBatcher.commitUpdateItems(),e.notifyPanesReadyForLoad()})}),!0}},{key:"isPriorityData",value:function(e){var t=!1;return e.labelIds.indexOf(Et.UNREAD)>=0?t=!0:e.labelIds.indexOf(ma.PRI0)>=0?t=!0:e.labelIds.indexOf(ma.PRI1)>=0?t=!0:e.labelIds.indexOf(ma.PRI2)>=0&&(t=!0),t}},{key:"_load",value:function(){m.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runThreadSync}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:m.default.minutes(30),minDelay:m.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync})}},{key:"_notifyFailedRequest",value:function(e,t){try{m.default.PAssert(1238,m.default.isString(e),"Must supply a valid accountID string")}catch(l){m.default.reportError(l)}if(t&&t.error)if(t.error.code===v.a.HTTPStatusCode.Unauthorized)sr.pluginManager.verifyAuthorization(e);else if(t.error.code===v.a.HTTPStatusCode.BadRequest)for(var a=0,i=t.error.errors,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].reason===v.a.GoogleError.FailedPrecondition&&(sr.toasts.pushMessage(v.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===v.a.HTTPStatusCode.Forbidden)for(var r=0,s=t.error.errors,o=0;o<s.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s[o].reason===v.a.GoogleError.InsufficientPermissions&&(sr.toasts.pushMessage(v.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&m.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)}},{key:"_reportErrorCode",value:function(e){var t=!1;return e!==v.a.HTTPStatusCode.NotFound&&(t=!0),t}},{key:"_notifySendFailed",value:function(){sr.toasts.pushMessage(v.a.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(e,t){var a=0;t||(t="UnnamedFile");for(var i=t,n=1;e[i];){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t.split(".");i=r[0]+"_"+n,r[1]&&(i+="."+r[1]),n++}return i}},{key:"_createResource",value:function(e,t){try{m.default.PAssert(1239,e,"Must have valid resources lib to add to")}catch(a){m.default.reportError(a)}return{cid:this._createResourceCID(e,t.name),id:m.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:ha.Attachment,parentType:Sa,mimeType:t.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}},{key:"_removeAttachContent",value:function(){var e=wt()(St.a.mark(function e(t,a,i){var n,r;return St.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return n=!1,e.next=3,Ot.a.removeElementsByAttribute(a.decoded,"cid",i.cid);case 3:return r=e.sent,n=r!==a.decoded,a.decoded=r,e.abrupt("return",n);case 7:case"end":return e.stop()}}},e)}));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"notifyAttachLinkedFile",value:function(e,t,a,i){var n={name:a.getField("title"),type:a.getField("mimeType")},r=this._createResource(t.resources,n);r.size=a.getField("fileSize"),r.link=a.getField("alternateLink"),this._shareAttachment(e,a.id,r,i),t.resources[r.cid]=r,e.notifyDataMutated(["hasAttachments"],v.a.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(e,t,a,i){for(var n=0,r=this,s=e.getField("accountID"),o=0;o<a.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=a[o],u=this._createResource(t.resources,l);u.size=l.size,u.uploader=new jt.a(l,s,v.a.DriveFolder.Attach,void 0,function(){e.notifyDataMutated(["hasAttachments"],v.a.ChangeType.Local)},function(t,a){t.error=!1,t.link=a.alternateLink,t.thumbnail=a.thumbnailLink,r._shareAttachment(e,a.id,t,i)}.bind(this,u),function(t){t.error=!0,sr.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],v.a.ChangeType.Local),i&&i(!1)}.bind(this,u)),u.uploader.upload(),t.resources[u.cid]=u}e.notifyDataMutated(["messages"],v.a.ChangeType.Local)}},{key:"_shareAttachment",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1240,t,"Must supply a valid fileID to share")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1241,a,"Must supply a valid resource object to share")}catch(r){m.default.reportError(r)}sr.remoteAPI().drivePermissionsPublic(t,function(){a.error=!1,e.notifyDataMutated(["messages"],v.a.ChangeType.Local),i&&i(!0)},function(r){a.error=!0,m.default.isHTTPStatusCode(r,v.a.HTTPStatusCode.Forbidden)?sr.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):sr.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){n._shareAttachment(e,t,a,i)}}),e.notifyDataMutated(["hasAttachments"],v.a.ChangeType.Local),i&&i(!1)})}},{key:"removeAttachFiles",value:function(){var e=wt()(St.a.mark(function e(t,a,i){var n;return St.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(1242,i,"Must always specify a valid resource to remove from the message")}catch(s){m.default.reportError(s)}return n=!1,i.uploader&&!i.uploader.isDone()&&(i.uploader.cancel(),n=!0),a.resources[i.cid]&&delete a.resources[i.cid],e.next=6,this._removeAttachContent(t,a,i);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=n;case 9:return n=e.t0,t.notifyDataMutated(["messages"],v.a.ChangeType.Local),e.abrupt("return",n);case 12:case"end":return e.stop()}}},e,this)}));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"notifyItemPropertyChanged",value:function(e,t,a,i){var n=e.getField("accountID");if(this.hasSyncAccount(n)){var r=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore()))t.dateCompleted&&!r&&this.archiveAttachment(e);if("priority"===i)this.getAttachmentPriority(e)!==t.getPriority()&&this.setAttachmentPriority(e,t.getPriority());else"isArchived"===i&&(r&&!t.isArchived()?this.unarchiveAttachment(e):!r&&t.isArchived()&&(this.archiveAttachment(e),sr.EmailPreview.isOpenOnThread(e)&&sr.EmailPreview.reset()))}}},{key:"createLabelString",value:function(e){if(!fa[e.toUpperCase()])return e}},{key:"isDisplayTag",value:function(e,t){var a=!1;if(e&&e.shouldDisplayInMessageList()){var i=e.isCustom()||e.getLabelID()===Et.DRAFT,n=t&&!t.isInbox()&&e.isInbox();if(i||n)switch(a=!0,e.getName()){case ma.PRI0:case ma.PRI1:case ma.PRI2:case"Moo.do/Handled":case fa.STARRED:a=!1}}return a}},{key:"isDisplayHeader",value:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==Et.UNREAD&&(t=!0));return t}},{key:"isMessageDraft",value:function(e){return e&&e.labelIds&&e.labelIds.indexOf(Et.DRAFT)>=0}},{key:"getDisplayTags",value:function(e,t,a){var i,n=0,r=e.getField("labelIds"),s=e.getField("accountID"),o=[];t&&(i=t.getItemLabel(!0));for(var l=0;l<r.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=this._getLabelByID(s,r[l]);if(this.isDisplayTag(u,i)){var d=a?u.getOutlineText():u.getDisplayText();d&&o.push(d)}}return o}},{key:"_getParticipantDisplayName",value:function(e,t){var a;if(this.isMyAccountID(e.email))a="me";else if(e.text)if(1===t)a=e.text;else{var i=e.text.split(" ");a=i&&i.length>0?i[0]:e.email}else a=e.email;return a}},{key:"getDisplayParticipants",value:function(e){for(var t=0,a=e.getField("participants"),i=[],n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.push(this._getParticipantDisplayName(a[n],a.length))}return i.join(", ")}},{key:"getDefaultDisplayItem",value:function(e){e=e||this.getDefaultAccount();var t=this._getLabelByID(e,Et.INBOX);return this.getVMLIForLabel(e,t)}},{key:"getEmailRootItem",value:function(){return Y.getItems(v.a.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return Y.hasItems(v.a.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){try{m.default.PAssert(1243,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(a){m.default.reportError(a)}var e=sr.itemStoreManager.getDefaultItemStore().getRoot(),t=_.a.createVMLI({text:"Email",favorites:[v.a.FavoriteGroup.EmailRoot]},{parent:e,changeType:v.a.ChangeType.AllLocal,documentOwner:void 0});return e.insertItem(t,0),sr.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:v.a.MessageAction.Okay,hold:!0}),t}},{key:"ensureEmailItem",value:function(e){var t=0;F.d.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var a,i=this.getEmailRootItem(),n=i.getItems(),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[r].getRawText()===e){a=n[r];break}}return a||(a=_.a.createVMLI({text:e},{parent:i,changeType:v.a.ChangeType.AllLocal,documentOwner:void 0}),i.insertItem(a,0)),F.d.endAction(),a}},{key:"getWaitingItem",value:function(e){e(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(e){var t=!0,a=this.getDefaultItemStore();return e.belongsToItemStore(a)&&(t=!1),t}},{key:"getDraftForMessage",value:function(e,t,a,i){try{m.default.PAssert(1244,t,"Must have a valid thread ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1245,a,"Must have a valid message ID")}catch(l){m.default.reportError(l)}var n,r=this.getAttachment(t).getField("messages"),s=r.indexOfWithProperty("id",a);try{m.default.PAssert(1246,s>=0,"Must be able to find the requested message")}catch(l){m.default.reportError(l)}var o=r[s+1];o&&o.labelIds.indexOf(Et.DRAFT)>=0?n=o:(this.createDraft(e,t,a,{from:i}),n=r[s+1]);try{m.default.PAssert(1247,n.labelIds.indexOf(Et.DRAFT)>=0,"Must return a valid draft")}catch(l){m.default.reportError(l)}return n}},{key:"getDraftByID",value:function(e,t,a,i){var n,r;if(t){var s=(n=this.getAttachment(t)).getField("messages");r=a?this._getMessageFromAttachment(n,a):s[0];try{m.default.PAssert(1248,r.labelIds.indexOf(Et.DRAFT)>=0,"Must be a valid draft")}catch(l){m.default.reportError(l)}}else{var o=this.createDraft(e,void 0,void 0,i);r=(n=this.getAttachment(o.threadID)).getField("messages")[0]}return{attach:n,draftMsg:r}}},{key:"_notifyDraftMessage",value:function(e,t,a){var i=this;try{m.default.PAssert(1249,e,"Must supply a valid accountID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1250,t&&!m.default.isTempId(t),"Must supply a valid threadID: ",t)}catch(n){m.default.reportError(n)}try{m.default.PAssert(1251,a&&!m.default.isTempId(a),"Must supply a valid messageID: ",a)}catch(n){m.default.reportError(n)}setTimeout(function(){i.hasCacheData(t)&&i._getRemoteDraftID(e,t,a,function(e,a){a&&(m.default.log("DraftID: ",e),i.cacheData(t,i.getCacheData(t),!0,["messages"]))})},0)}},{key:"_getInlineResources",value:function(e){var t={};return m.default.forEachValue(e.resources,function(e){e.disposition===ha.Inline&&(t[e.cid]=Object.assign({},e))}),t}},{key:"createDraft",value:function(e,t,a,i){i=i||{};try{m.default.PAssert(1252,!i.body||!i.decoded,"Must not supply both a decoded field and a body")}catch(f){m.default.reportError(f)}this.sendEvent("CreateDraft");var n=m.default.generateTempId(),r=i.from||this.getDefaultFromInfo(e),s=i.body||i.decoded||"";""===s&&(s=this.createSignature(r.email));var o,l,u={id:n,modifiedOffline:!0,labelIds:[Et.DRAFT],messageID:void 0,raw:"",decoded:s,mimeType:Ma,contentType:"text/html;charset=utf-8",from:r,replyTo:this.getReplyToAddress(r.email),to:i.to||[],cc:i.cc||[],bcc:i.bcc||[],snippet:"",subject:i.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:{}};if(t){o=this.getCacheData(t);try{m.default.PAssert(1253,a,"When supplying a thread ID, must also supply a valid message ID")}catch(f){m.default.reportError(f)}var d=o.messages.indexOfWithProperty("id",a);try{m.default.PAssert(1254,d>=0,"If requesting a reply to a message, it must exist in the thread")}catch(f){m.default.reportError(f)}var c=o.messages[d];if(c&&(u.references=(m.default.isTempId(c.messageID)?"":c.messageID)+(c.references?" "+c.references:""),m.default.isTempId(c.messageID)||(u.inReplyTo=c.messageID),u.resources=this._getInlineResources(c)),o.messages.splice(d+1,0,u),this.hasAttachment(t)){var h=this.getAttachment(t);this._updateAttachmentFromMessages(h,v.a.ChangeType.Local),h.notifyDataMutated(["messages"],v.a.ChangeType.Local)}this.addModifiedOffline(o,["messages"]),l=o}else o={id:n,accountID:e,modifiedOffline:!0,messages:[u],labelIds:[Et.DRAFT],subject:i.subject||"",from:e},l=this.createEntryFromLocal(n,o),this.cacheData(l.id,l);return this.cacheThreadData(l.id,this.serializeExternalData(l)),{threadID:l.id,draftID:n,messageID:a}}},{key:"_updateDraftID",value:function(e,t,a){try{m.default.PAssert(1255,a,"Must provide a valid set of draft info")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1256,a.id&&a.message,"Draft info must contain valid data")}catch(r){m.default.reportError(r)}var i=e.isLocalOnlyAttachment();i&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.message.threadId),this._threadCache.removeEntry(t));var n=this._findDraft(e,t,a.id);if(n){n.id=a.message.id;try{m.default.PAssert(1257,n.draftID===a.id,"Should have valid draft ID associated with the message")}catch(r){m.default.reportError(r)}this._draftCache[n.id]=a.id,i&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[n.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[n.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],v.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}}},{key:"_updateDraftFromSend",value:function(e,t,a){try{m.default.PAssert(1258,a,"Must provide a valid set of draft info")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1259,a.id&&a.threadId,"Draft info must contain valid data")}catch(n){m.default.reportError(n)}if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.threadId);try{m.default.PAssert(1260,!m.default.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(n){m.default.reportError(n)}this._threadCache.removeEntry(t)}var i=this._getMessageFromAttachment(e,t);i.id=a.id,i.labelIds=a.labelIds||[],this._updateAttachmentFromMessages(e,v.a.ChangeType.Remote),this._draftCache[i.id]=a.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[i.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[i.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],v.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},{key:"_createRemoteDraft",value:function(e,t,a){var i=this;if(this._creatingDrafts[t])a(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var n=this._getMessageFromAttachment(e,t);if(n)this._createRFC822Message(e.getData(),n,!1,function(r){var s={raw:r};e.isLocalOnlyAttachment()||(s.threadId=e.id);var o=be.a.fns("gmail").users.drafts.create.packedFn,l={userId:e.getField("accountID"),resource:{message:s}};i._queueRemoteRequestMulti(e.getField("accountID"),o,l,function(r){i._attachmentHasMessage(e,t)&&(delete i._creatingDrafts[t],n.draftID=r.id,i.removeModifiedOffline(e.getData(),!1),i.removeModifiedOffline(n,!1),i._pendingDraftUpdates[t]&&i._notifyPendingDraftUpdate(),i._updateDraftID(e,t,r),i._updateIsSavingDrafts()),a(!0)},function(n){delete i._creatingDrafts[t],i._updateIsSavingDrafts(),a(!1,n),i._notifyFailedRequest(e.getField("accountID"),n)},void 0,ia,{noBatch:!0})});else{try{var r={length:e.getField("messages").length};m.default.reportError(new Error("Unable to find valid draft for creation"),r)}catch(s){m.default.reportError(s)}a(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){m.default.isSavingDrafts=this._activeDraftUpdates>0||!m.default.isEmpty(this._pendingDraftUpdates)||!m.default.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(e,t,a,i){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:a,lastUpdate:Date.now()},i&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(e){var t=this;if(!this._creatingDrafts[e]){var a=this._pendingDraftUpdates[e];try{m.default.PAssert(1261,a,"Must be able to find valid draft info for pending draft update")}catch(i){m.default.reportError(i)}this._updateRemoteDraft(a.attach,e,a.draftID,!1,function(e,a){e?sr.toasts.clearMessage(v.a.MessageID.EmailUpdateFail):m.default.isHTTPStatusCode(a,v.a.HTTPStatusCode.NotFound)?sr.toasts.clearMessage(v.a.MessageID.EmailUpdateFail):sr.toasts.pushMessage(v.a.MessageID.EmailUpdateFail),t._updateIsSavingDrafts()}),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(e,t){var a=this._pendingDraftUpdates[t];if(a){try{m.default.PAssert(1262,a.attach===e,"Must have the correct attachment for the draft update")}catch(i){m.default.reportError(i)}delete this._pendingDraftUpdates[t]}}},{key:"hasPendingSends",value:function(){return Object.keys(this._pendingSends).length>0}},{key:"notifyPendingSend",value:function(e,t){try{m.default.PAssert(1263,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(a){m.default.reportError(a)}this._pendingSends[t]=e,m.default.isSendingEmail=!0}},{key:"notifySent",value:function(e,t){try{m.default.PAssert(1264,this._pendingSends[t],"Must have a pending send to be sent")}catch(a){m.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"notifySendError",value:function(e,t){try{m.default.PAssert(1265,this._pendingSends[t],"Must have a pending send to have an error")}catch(a){m.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(e){var t=[];return m.default.forEachValue(e,function(e){"attachment"===e.disposition&&e.link&&t.push(e)}),t}},{key:"_createDraftBody",value:function(e,t){var a;if(t){var i=this._getLinkedResources(t);if(i.length>0){for(var n=0,r="<br/><br/>",s=0;s<i.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r+=this._getLinkedResourceString(i[s])}a=e+'<var id="moodoAttach" moodoAttach="true">'+r+"</var>"}else a=e}else a=e;return a}},{key:"updateDraft",value:function(e,t,a,i,n,r,s){try{m.default.PAssert(1266,m.default.isBoolean(n),"Must supply a valid bool for updateRemoteDraft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1267,m.default.isBoolean(r),"Must supply a valid bool for forceFlush")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1268,m.default.isFunction(s),"Must supply a valid bool for cb")}catch(l){m.default.reportError(l)}var o=this._findDraft(e,t,a);if(o)return o.to=i.to,o.from=i.from||o.from,o.cc=i.cc,o.bcc=i.bcc,o.subject=i.subject,o.decoded=this._createDraftBody(i.decoded,o.resources),o.snippet=i.snippet?m.default.escape(i.snippet.substring(0,60)):"",o.modifiedOffline=!0,i.hasOwnProperty("resources")&&(o.resources=i.resources),this._updateAttachmentFromMessages(e,v.a.ChangeType.Local),e.notifyDataMutated(["messages"],v.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[o.id]&&n?m.default.isTempId(o.id)?this._createRemoteDraft(e,o.id,function(e,t){e||sr.toasts.pushMessage(v.a.MessageID.EmailUpdateFail),s(e,t)}):(this._notifyPendingDraftUpdate(e,o.id,o.draftID,r),s(!0)):(n&&this._notifyPendingDraftUpdate(e,o.id,o.draftID,r),s(!0)),this._updateIsSavingDrafts(),{threadID:e.id,draftID:o.draftID,messageID:o.id};try{m.default.PAssert(1269,!1,"Unable to update draft as expected from compose window")}catch(l){m.default.reportError(l)}s(!1)}},{key:"_updateRemoteDraft",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(1270,t&&a,"Must specify both a valid messageID and draftID"+t+"."+a)}catch(o){m.default.reportError(o)}var s=this._findDraft(e,t,a);try{m.default.PAssert(1271,s&&s.labelIds.indexOf(Et.DRAFT)>=0,"Must be updating a valid draft"+!!s)}catch(o){m.default.reportError(o)}try{m.default.PAssert(1272,!this._creatingDrafts[s.id],"Should not send a remote update while the original draft is being created")}catch(o){m.default.reportError(o)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,s.id,function(t){if(t)r._createRFC822Message(e.getData(),s,i,function(a){var i=be.a.fns("gmail").users.drafts.update.packedFn,o={userId:e.getField("accountID"),id:t,resource:{message:{raw:a,threadId:e.id}}};r._queueRemoteRequestMulti(e.getField("accountID"),i,o,function(t){r._updateDraftID(e,s.id,t),r._activeDraftUpdates--,n(t)},function(t){n(void 0,t),r._activeDraftUpdates--,r._notifyFailedRequest(e.getField("accountID"),t)},void 0,na)});else{try{m.default.PAssert(1273,!1,"Must always be able to get a valid draft ID when updating")}catch(o){m.default.reportError(o)}n(!1)}})}},{key:"sendDraft",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(1274,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(h){m.default.reportError(h)}var s=!0,o=this._findDraft(e,t,a),l=function(t,a){t?(e.updateField("pendingSend",!1),r.removeModifiedOffline(e.getData(),!1),r.removeModifiedOffline(o,!1),r.notifySent(e,o.id)):(m.default.isHTTPStatusCode(a,v.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),r.notifySendError(e,o.id)),n(t,a)},u=this._verifyEmailRecipients(e,o.id,o.draftID);if(u||(u=this._verifyEmailAttachments(e,o.id,o.draftID)),u){s=!1;var d=sr.toasts.pushMessage({text:u.message,action:v.a.MessageAction.Okay});u.handleMessageFn&&u.handleMessageFn(d),this.notifyPendingSend(e,o.id),l(!1)}else if(!i){e.updateField("pendingSend",!0),this.notifyPendingSend(e,o.id);var c=!1;this.onEmailReadyToSend(o,function(){try{m.default.PAssert(1275,!c,"Should not send an email twice")}catch(h){m.default.reportError(h)}c||(c=!0,e.isLocalOnlyAttachment()||m.default.isTempId(o.id)?r._sendEmail(e,o.id,o.draftID,l):r._sendRemoteDraft(e,o.id,l))})}return s}},{key:"onEmailReadyToSend",value:function(e,t){var a=this,i=!0;m.default.forEachValue(e.resources,function(n){if(n.uploader&&!n.uploader.isDone())if(i=!1,n.uploader.hasError())try{m.default.PAssert(1276,!1,"Attachment has error when sending.")}catch(r){m.default.reportError(r)}else n.uploader.notifyOnComplete(a.onEmailReadyToSend.bind(a,e,t))}),i&&setTimeout(t,0)}},{key:"_sendRemoteDraft",value:function(e,t,a){var i=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(n){if(n)i._updateRemoteDraft(e,t,n,!0,function(t){if(t&&t.message){var r=be.a.fns("gmail").users.drafts.send.packedFn,s={userId:e.getField("accountID"),resource:{id:n}};i._queueRemoteRequestMulti(e.getField("accountID"),r,s,function(n){i._updateLocalDraftFromSend(e,t.message.id,n,a)},function(t){i._notifySendFailed(),a(!1,t),i._notifyFailedRequest(e.getField("accountID"),t)},void 0,sa)}else sr.toasts.pushMessage(v.a.MessageID.EmailUpdateFail),a(!1)});else{try{m.default.PAssert(1277,!1,"Must always be able to get a valid draft ID when sending")}catch(r){m.default.reportError(r)}sr.toasts.pushMessage(v.a.MessageID.EmailUpdateFail),a(!1)}})}},{key:"_updateLocalDraftFromSend",value:function(e,t,a,i){try{m.default.PAssert(1278,a,"Must have a valid draft result")}catch(r){m.default.reportError(r)}var n=this._getMessageFromAttachment(e,t);try{m.default.PAssert(1279,n,"Must always be able to find the sent message")}catch(r){m.default.reportError(r)}n&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(n,!1),this._updateDraftFromSend(e,t,a)),m.default.isDemoMode()||this._requestRemoteMessageData(e,a.id,function(e){try{m.default.PAssert(1280,e,"Should always be able to update message data after send")}catch(r){m.default.reportError(r)}}),i(!0)}},{key:"runDiscardDraft",value:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,function(e){try{m.default.PAssert(1281,e,"Must be able to discard message draft")}catch(t){m.default.reportError(t)}})}},{key:"discardDraft",value:function(e,t,a,i){var n=e.getData(),r=this._findDraft(e,t,a),s=n.messages.indexOf(r);m.default.isTempId(t)?i(!0):this._deleteRemoteDraft(e,t,i);var o=n.messages[s];n.messages.splice(s,1),this._removeRemoteResources(o),this._updateAttachmentFromMessages(e,v.a.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],v.a.ChangeType.Local),this.cacheThreadData(n.id,this.serializeExternalData(n)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(e){e&&m.default.forEachValue(e.resources,function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()})}},{key:"_deleteRemoteDraft",value:function(e,t,a){var i=this;try{m.default.PAssert(1282,!m.default.isTempId(t),"Should not try to remotely delete a local message")}catch(n){m.default.reportError(n)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(t){if(t){var r=be.a.fns("gmail").users.drafts.delete.packedFn,s={userId:e.getField("accountID"),id:t};i._queueRemoteRequestMulti(e.getField("accountID"),r,s,function(){a(!0)},function(t){m.default.isHTTPStatusCode(t,v.a.HTTPStatusCode.NotFound)?a(!0):a(!1,t),i._notifyFailedRequest(e.getField("accountID"),t)},void 0,ra)}else{try{m.default.PAssert(1283,!1,"Must always be able to get a valid draft ID when deleting")}catch(n){m.default.reportError(n)}sr.toasts.pushMessage(v.a.MessageID.EmailUpdateFail),a(!1)}})}},{key:"_getRemoteDraftIDRaw",value:function(e,t,a,i){var n=be.a.fns("gmail").users.drafts.list.packedFn,r={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,n,r,a,i,void 0,oa,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1284,m.default.isString(e),"Must provide a valid accountID")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1285,m.default.isString(t)&&!m.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(o){m.default.reportError(o)}try{m.default.PAssert(1286,m.default.isString(a)&&!m.default.isTempId(a),"Should not try to remotely get the draft ID of a local draft: ",a)}catch(o){m.default.reportError(o)}var r=this.getAttachment(t);try{m.default.PAssert(1287,r,"Must be able to find a valid attachment for the requested thread")}catch(o){m.default.reportError(o)}if(!r)return setTimeout(i,0,void 0,!1);var s=this._getMessageFromAttachment(r,a);try{m.default.PAssert(1288,s,"Must be able to find a valid message for the requested draft")}catch(o){m.default.reportError(o)}if(!s)return setTimeout(i,0,void 0,!1);if(s.draftID)setTimeout(i,0,s.draftID,!1);else{try{m.default.PAssert(1289,s.messageID&&!m.default.isTempId(s.messageID),"Must have a valid messageID for the draft being queried")}catch(o){m.default.reportError(o)}if(!s.messageID||m.default.isTempId(s.messageID))return setTimeout(i,0,void 0,!1);this._getRemoteDraftIDRaw(e,s.messageID,function(l){try{m.default.PAssert(1290,l&&l.length<=1,"Must find only a single draft ID for a given message: ",l.length,s.messageID)}catch(o){m.default.reportError(o)}if(l){for(var u=0,d=0;d<l.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=l[d];if(1===l.length||c.message.threadId===t){try{m.default.PAssert(1291,!s.draftID||s.draftID===c.id,"Draft ID must either match or not be known yet")}catch(o){m.default.reportError(o)}s.draftID=c.id}}try{m.default.PAssert(1292,0===l.length||s.draftID,"Draft returned but IDs dont match: ",l[0]?l[0].message.threadId:"NO RESULT",t,l[0]?l[0].message.id:"NO RESULT",a)}catch(o){m.default.reportError(o)}}return s.draftID?i(s.draftID,!0):s.contentType&&s.mimeType&&s.decoded?void n._createRemoteDraft(r,s.id,function(a,r){return a?i(s.draftID,!0):(m.default.isHTTPStatusCode(r,v.a.HTTPStatusCode.NotFound)&&n._deleteCachedThread(e,t),i(void 0,!1))}):i(void 0,!1)},function(t){return n._notifyFailedRequest(e,t),i(void 0,!1)})}}},{key:"_attachmentHasMessage",value:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}},{key:"_getMessageFromAttachment",value:function(e,t){var a=e.getField("messages"),i=a.indexOfWithProperty("id",t);try{m.default.PAssert(1293,i>=0,"Must have a vald draft")}catch(n){m.default.reportError(n)}return a[i]}},{key:"_getDraftFromAttachment",value:function(e,t){for(var a,i=0,n=e.getField("messages"),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n[r].labelIds.indexOf(Et.DRAFT)>=0){t&&t!==n[r].draftID||(a=n[r]);break}}return a}},{key:"_findDraft",value:function(e,t,a){var i,n=e.getField("messages"),r=n.indexOfWithProperty("id",t);if(r>=0)i=n[r];else if(a){var s=n.indexOfWithProperty("draftID",a);s>=0&&(i=n[s])}try{m.default.PAssert(1294,i,"Must be able to find a valid draft for given messageID/draftID")}catch(o){m.default.reportError(o)}return i}},{key:"isAttachmentDraftOnly",value:function(e){return this.attachmentHasLabel(e,fa.DRAFT)&&1===e.getField("messages").length}},{key:"archiveAttachment",value:function(e){try{m.default.PAssert(1295,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(t){m.default.reportError(t)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,fa.INBOX)}},{key:"unarchiveAttachment",value:function(e){try{m.default.PAssert(1296,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(t){m.default.reportError(t)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,fa.INBOX)}},{key:"trashAttachment",value:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,function(e){try{m.default.PAssert(1297,e,"Must have successfully trashed remote thread")}catch(t){m.default.reportError(t)}})}},{key:"untrashAttachment",value:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,function(e){try{m.default.PAssert(1298,e,"Must have successfully untrashed remote thread")}catch(t){m.default.reportError(t)}})}},{key:"markAttachmentRead",value:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,fa.UNREAD)}},{key:"markAttachmentUnread",value:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,fa.UNREAD)}},{key:"snoozeAttachment",value:function(e,t){}},{key:"unsnoozeAttachment",value:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,fa.INBOX),this.addLabelToAttachment(e,fa.UNREAD),this.cancelDeferredTask(e.id,qt.Snooze)}},{key:"_handleDeferredSnoozeTask",value:function(e){}},{key:"scheduleSendMessage",value:function(e,t,a){}},{key:"cancelSendMessage",value:function(e,t){var a=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,function(e){e&&a.cancelDeferredTask(e,qt.SendMail)})}},{key:"_handleDeferredSendMailTask",value:function(e){var t=e.getData();try{m.default.PAssert(1301,t.gidLinked,"Must have valid gidLinked")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1302,t.threadID,"Must have a valid threadID")}catch(a){m.default.reportError(a)}m.default.log("Handling deferred send mail: ",t)}},{key:"_ensureNoPriority",value:function(e){var t=v.a.VMLIFlag.None;return this.attachmentHasLabel(e,ma.PRI0)&&(this.removeLabelFromAttachment(e,ma.PRI0),t=v.a.VMLIFlag.P0),this.attachmentHasLabel(e,ma.PRI1)&&(this.removeLabelFromAttachment(e,ma.PRI1),t=v.a.VMLIFlag.P1),this.attachmentHasLabel(e,ma.PRI2)&&(this.removeLabelFromAttachment(e,ma.PRI2),t=v.a.VMLIFlag.P2),t}},{key:"getAttachmentPriority",value:function(e){return this._attachmentHasPriorityLabel(e,v.a.VMLIFlag.P0)&&v.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(e,v.a.VMLIFlag.P1)&&v.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,v.a.VMLIFlag.P2)&&v.a.VMLIFlag.P2||v.a.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(e,t){this.sendEvent("SetMailPriority");var a=this._ensureNoPriority(e);switch(t){case v.a.VMLIFlag.None:break;case v.a.VMLIFlag.P0:this.addLabelToAttachment(e,ma.PRI0);break;case v.a.VMLIFlag.P1:this.addLabelToAttachment(e,ma.PRI1);break;case v.a.VMLIFlag.P2:this.addLabelToAttachment(e,ma.PRI2);break;default:try{m.default.PAssert(1303,!1,"Invalid priority for email attachment")}catch(i){m.default.reportError(i)}}return a}},{key:"markAttachmentStarred",value:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,fa.STARRED)}},{key:"markAttachmentUnstarred",value:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,fa.STARRED)}},{key:"attachmentHasLabelByID",value:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasLabel",value:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasFullLabel",value:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}},{key:"attachmentIsArchived",value:function(e){return this._threadIsArchived(e.getData())}},{key:"addLabelToAttachment",value:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"removeLabelFromAttachment",value:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"trashMail",value:function(e,t,a,i){var n=this.getAttachment(t);if(this.isAttachmentDraftOnly(n)){var r=n.getField("messages")[0];this.discardDraft(n,r.id,r.draftID,i)}else this.removeLabelsFromMessage(e,t,a,[Et.INBOX],v.a.ChangeType.Local),this.addLabelsToMessage(e,t,a,[Et.TRASH],v.a.ChangeType.Local),m.default.isTempId(t)?i(!0):this._trashRemoteMail(e,t,a,i)}},{key:"untrashMail",value:function(e,t,a,i){this.removeLabelsFromMessage(e,t,a,[Et.TRASH],v.a.ChangeType.Local),m.default.isTempId(t)?(this.addLabelsToMessage(e,t,a,[Et.INBOX],v.a.ChangeType.Local),i(!0)):(this.addLabel(e,t,a,fa.INBOX),this._untrashRemoteMail(e,t,a,i))}},{key:"moveItem",value:function(e,t,a){return a.insertItem(t,0),[t,a]}},{key:"unmoveItem",value:function(e,t,a){return a.removeChild(t,v.a.ChangeType.Local),[t,a]}},{key:"hasLabelByID",value:function(e,t,a,i){try{m.default.PAssert(1304,!a,"We don't support individual queries on messages, only threads")}catch(n){m.default.reportError(n)}return this.getAttachment(t).getField("labelIds").indexOf(i)>=0}},{key:"hasLabel",value:function(e,t,a,i){try{m.default.PAssert(1305,!a,"We don't support individual queries on messages, only threads")}catch(s){m.default.reportError(s)}var n=!1;if(!a){var r=this._getLabelByName(e,i,!0);r&&(n=this.hasLabelByID(e,t,a,r.getLabelID()))}return n}},{key:"hasFullLabel",value:function(e,t,a){var i=!1,n=this.getCacheData(t),r=this._getLabelByName(e,a,!0);if(r&&n){var s=0,o=n.messages;i=!0;for(var l=0;l<o.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(o[l].labelIds.indexOf(r.getLabelID())<0){i=!1;break}}}return i}},{key:"hasLabelLike",value:function(e,t,a){var i=!1,n=this.getAttachment(t);if(n){var r=n.getField("labelIds"),s=this._getAccountLib(e,this._labelsByID);if(s)for(var o=0,l=0;l<r.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[r[l]];u&&u.isMatched(a)&&(i=!0)}}return i}},{key:"addLabel",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1306,!a,"We currently do not support setting labels on single messages")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1307,!this.hasLabel(e,t,a,i),"Should not add the same label to a thread/message twice")}catch(o){m.default.reportError(o)}var r=this._getLabelByName(e,i,!0);if(r)r.isLocalOnly()?this._createRemoteLabel(e,i,function(a){if(a){try{m.default.PAssert(1309,a,"Should have successfully created the remote label")}catch(o){m.default.reportError(o)}n._changeLabelID(e,r.getLabelID(),a.id),n._modifyRemoteThreadLabels(e,t,[a.id],void 0)}}):this._modifyRemoteThreadLabels(e,t,[r.getLabelID()],void 0);else{var s=m.default.generateTempId();r=this._ensureLabel(e,s,i,void 0,void 0,v.a.ChangeType.Local),this._ensureVMLIsForLabel(e,r),this._writeLabelsToCache(),this._createRemoteLabel(e,i,function(a){try{m.default.PAssert(1308,a,"Should have successfully created the remote label")}catch(o){m.default.reportError(o)}a&&(n._changeLabelID(e,s,a.id),n._modifyRemoteThreadLabels(e,t,[a.id],void 0))})}return this.addLabelsToMessage(e,t,a,[r.getLabelID()],v.a.ChangeType.Local),i}},{key:"removeLabel",value:function(e,t,a,i){try{m.default.PAssert(1310,!a,"We currently do not support setting labels on single messages")}catch(r){m.default.reportError(r)}var n=this._getLabelByName(e,i);try{m.default.PAssert(1311,n,"Must have valid label for gmail in order to remove")}catch(r){m.default.reportError(r)}return n&&(n.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[n.getLabelID()]),this.removeLabelsFromMessage(e,t,a,[n.getLabelID()],v.a.ChangeType.Local)),i}},{key:"_threadIsArchived",value:function(e){if(e){var t=e.labelIds.indexOf(Et.INBOX)>=0,a=this.hasFullLabel(e.accountID,e.id,fa.TRASH),i=e.labelIds.indexOf(Et.SPAM)>=0,n=this.hasFullLabel(e.accountID,e.id,fa.DRAFT);return!m.default.isTempId(e.id)&&!t&&!a&&!i&&!n}return!1}},{key:"_trashRemoteMail",value:function(e,t,a,i){var n,r,s=this;try{m.default.PAssert(1312,!m.default.isTempId(t),"Should not try to trash local only threads")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1313,!a||!m.default.isTempId(a),"Should not try to trash local only messages")}catch(o){m.default.reportError(o)}a?(n=be.a.fns("gmail").users.messages.trash.packedFn,r={userId:e,id:a}):(n=be.a.fns("gmail").users.threads.trash.packedFn,r={userId:e,id:t});this._queueRemoteRequestMulti(e,n,r,function(){i(!0)},function(t){i(!1,t),s._notifyFailedRequest(e,t)},void 0,ta)}},{key:"_untrashRemoteMail",value:function(e,t,a,i){var n,r,s=this;try{m.default.PAssert(1314,!m.default.isTempId(t),"Should not try to untrash local only threads")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1315,!a||!m.default.isTempId(a),"Should not try to untrash local only messages")}catch(o){m.default.reportError(o)}a?(n=be.a.fns("gmail").users.messages.untrash.packedFn,r={userId:e,id:a}):(n=be.a.fns("gmail").users.threads.untrash.packedFn,r={userId:e,id:t});this._queueRemoteRequestMulti(e,n,r,function(){i(!0)},function(t){i(!1,t),s._notifyFailedRequest(e,t)},void 0,ta)}},{key:"_createRemoteLabel",value:function(e,t,a){var i=this,n=be.a.fns("gmail").users.labels.create.packedFn,r={userId:e,resource:{name:t,labelListVisibility:"labelHide",messageListVisibility:"hide"}};this._queueRemoteRequestMulti(e,n,r,function(e){a&&a(e)},function(t){m.default.isHTTPStatusCode(t,v.a.HTTPStatusCode.Conflict)?a&&a(void 0,t):(a&&a(void 0,t),i._notifyFailedRequest(e,t))},void 0,$t)}},{key:"_modifyRemoteThreadLabels",value:function(e,t,a,i,n){var r=this,s=be.a.fns("gmail").users.threads.modify.packedFn,o={userId:e,id:t,resource:{addLabelIds:a,removeLabelIds:i}};this._queueRemoteRequestMulti(e,s,o,function(e){n&&n(e)},function(t){n&&n(void 0,t),r._notifyFailedRequest(e,t)},void 0,ea)}},{key:"_ensureRemoteLabel",value:function(e,t,a,i){this._getLabelByName(e,t,!0)?i&&i(!0):(this._ensureLabel(e,m.default.generateTempId(),t,void 0,void 0,a),this._createRemoteLabel(e,t,function(e,t){try{m.default.PAssert(1316,e||m.default.isHTTPStatusCode(t,v.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(a){m.default.reportError(a)}i&&i(!!e)}))}},{key:"_createInMemoryLabel",value:function(e,t,a,i,n,r){var s=new Rt(e,t,a,this._clampSyncTime(i),n,r);r[t]=s,this._ensureAccountLib(e,this._labelsByName)[a]=s}},{key:"_updateLabelName",value:function(e,t){var a=e.getAccountID(),i=this._getAccountLib(a,this._labelsByName);try{m.default.PAssert(1317,i,"Must have valid label name bucket")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1318,i[e.getRawName()],"Must have valid label in bucket")}catch(n){m.default.reportError(n)}e.updateLabelName(t),delete i[e.getRawName()],i[t]=e}},{key:"_ensureLabel",value:function(e,t,a,i,n,r){try{m.default.PAssert(1319,t.length>3,"Label ID should be longer than a couple of chars")}catch(l){m.default.reportError(l)}var s=this._ensureAccountLib(e,this._labelsByID);if(s[t])!m.default.isRemoteChange(r)&&s[t].hasName()||s[t].isSystemLabel()||this._updateLabelName(s[t],a);else{var o=this._getLabelByName(e,a,!0);if(o)o.isLocalOnly()&&!m.default.isTempId(t)?this._changeLabelID(e,o.getLabelID(),t):o.isLocalOnly()||(s[t]=o);else{try{m.default.PAssert(1321,a||!m.default.isTempId(t),"All local labels must have a valid name")}catch(l){m.default.reportError(l)}this._createInMemoryLabel(e,t,a,i,n,s)}}return s[t]}},{key:"_clampSyncTime",value:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}},{key:"_ensureLabelVMLIsForAccount",value:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var a in t)t.hasOwnProperty(a)&&this._ensureVMLIsForLabel(e,t[a])}},{key:"_changeLabelID",value:function(e,t,a){var i=this._getLabelByID(e,t);sr.PaneUpdateBatcher.beginUpdateItems(),i.updateLabelID(a),this._getAccountLib(e,this._labelsByID)[a]=i,this._ensureVMLIsForLabel(e,i),sr.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment(function(e){var i=e.getField("labelIds");if(i.remove(t)>=0){for(var n=0,r=e.getField("messages"),s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[s].labelIds.remove(t)>=0&&r[s].labelIds.push(a)}i.push(a),e.updateField("labelIds",i)}});var n=this.getDefaultItemStore(),r="L~"+e+"~"+t;n.hasItem(r)&&n.destroyItem(r)}},{key:"labelExists",value:function(e,t){var a=this._getAccountLib(e,this._labelsByID);return a&&a[t]}},{key:"_getLabelByID",value:function(e,t){try{m.default.PAssert(1322,e,"Must supply a valid accountID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1323,t,"Must supply a valid labelID")}catch(n){m.default.reportError(n)}var a=this._ensureAccountLib(e,this._labelsByID);if(!a[t]){var i=fa[t];this._createInMemoryLabel(e,t,i,void 0,void 0,a)}return a[t]}},{key:"_getLabelByName",value:function(e,t,a){try{m.default.PAssert(1324,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(r){m.default.reportError(r)}var i,n=this._getAccountLib(e,this._labelsByName);try{m.default.PAssert(1325,a||n,"Unable to find labelsByName for given account: "+e)}catch(r){m.default.reportError(r)}return n&&(i=n[t]),i}},{key:"_getPriorityLabel",value:function(e,t){var a=this._ensureAccountLib(e,this._priorityLabels);if(!a[t]){var i;switch(t){case v.a.VMLIFlag.P0:i=ma.PRI0;break;case v.a.VMLIFlag.P1:i=ma.PRI1;break;case v.a.VMLIFlag.P2:i=ma.PRI2;break;default:try{m.default.PAssert(1326,!1,"Invalid priority for email attachment")}catch(n){m.default.reportError(n)}}a[t]=this._getLabelByName(e,i)}return a[t]}},{key:"_getAccountLib",value:function(e,t){try{m.default.PAssert(1327,e,"Must provide valid accountID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1328,t,"Must provide valid lib object")}catch(n){m.default.reportError(n)}var a;if(e)if(t[e])a=t[e];else for(var i in t)if(i.toUpperCase()===e.toUpperCase())try{m.default.PAssert(1329,!1,"Mismatch case request found for accountIDs: "+e,i)}catch(n){m.default.reportError(n)}return a}},{key:"_ensureAccountLib",value:function(e,t){try{m.default.PAssert(1330,e,"Must provide valid accountID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1331,t,"Must provide valid lib object")}catch(n){m.default.reportError(n)}var a;if(e)if(t[e=e.toLowerCase()])a=t[e];else{for(var i in t)if(t.hasOwnProperty(i))try{m.default.PAssert(1332,!e||!i||i.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,i)}catch(n){m.default.reportError(n)}a=t[e]={}}return a}},{key:"_deleteAccountLib",value:function(e,t){try{m.default.PAssert(1333,e,"Must provide valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1334,t,"Must provide valid lib object")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1335,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(a){m.default.reportError(a)}delete t[e]}},{key:"_attachmentHasPriorityLabel",value:function(e,t){var a=this._getPriorityLabel(e.getField("accountID"),t);return!!a&&e.getField("labelIds").indexOf(a.getLabelID())>=0}},{key:"getLabels",value:function(e,t,a){var i=[],n=t.toLowerCase(),r=0,s=this._labelsByID[e];for(var o in s)if(s.hasOwnProperty(o)){var l=s[o];if(l.matchesText(n)&&this.isDisplayTag(l)&&i.indexOf(l)<0&&(i.push(l),r++),a&&r>=a)break}return i}},{key:"_writeLabelsToCache",value:function(){var e={};for(var t in this._labelsByID)if(this._labelsByID.hasOwnProperty(t)){e[t]={};var a=this._labelsByID[t];for(var i in a)a.hasOwnProperty(i)&&(e[t][i]=a[i].getSaveData())}this._threadCache.setMetadata(ca.Labels,e)}},{key:"_writeSendAsToCache",value:function(){var e={};this._iterateSendAs(function(t,a){e[t]||(e[t]=[]),e[t].push(a)}),this._threadCache.setMetadata(ca.SendAs,e)}},{key:"runLabelSync",value:function(e){for(var t=this,a=0,i=this.getSyncAccounts(),n=i.length,r=0,s=0,o=function(a,i){if(t.hasSyncAccount(a)){sr.PaneUpdateBatcher.beginUpdateItems();var o={};if(i)for(var l=0,u=0;u<i.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d,c=i[u];o[c.id]=!0,d="system"===c.type&&fa[c.id]?fa[c.id]:c.name,t._ensureLabel(a,c.id,d,void 0,c,v.a.ChangeType.Remote)}t._ensureLabelVMLIsForAccount(a),t._ensureRemoteLabel(a,"Moo.do",v.a.ChangeType.Local),t._ensureRemoteLabel(a,ma.PRI0,v.a.ChangeType.Local),t._ensureRemoteLabel(a,ma.PRI1,v.a.ChangeType.Local),t._ensureRemoteLabel(a,ma.PRI2,v.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Snoozed",v.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Handled",v.a.ChangeType.Local),t._ensureRemoteLabel(a,"Moo.do/Scheduled",v.a.ChangeType.Local);var h=t._getAccountLib(a,t._labelsByID);if(h)for(var f in h)if(h.hasOwnProperty(f)){var p=h[f];if(p.isLocalOnly()){try{m.default.PAssert(1336,p.hasName(),"Label must have a valid name to be created on remote")}catch(g){m.default.reportError(g)}t._createRemoteLabel(a,p.getName(),function(e,t){t&&this._changeLabelID(a,e,t.id)}.bind(t,f))}else 0!==s||o[f]||p.isSystemOrSpecialLabel()||m.default.isDemoMode()||p.delete()}sr.PaneUpdateBatcher.commitUpdateItems(),t._writeLabelsToCache(),s+r===n&&e&&e()}else e&&e()},l=function(e,a){s++,o(e),t._notifyFailedRequest(e,a)},u=function(e,t){t?(r++,o(e,t.labels)):l(e,t)},d=function(e){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;h=be.a.fns("gmail").users.labels.list.packedFn;var n=i[e];f={userId:n,timeoutMS:0},ye.a.getAccountAuthToken(n,t.googleScopes(),function(e){e&&t._queueRemoteRequestMulti(n,h,f,u.bind(t,n),l.bind(t,n),void 0,Zt)})},c=0;c<i.length;++c){var h,f;d(c)}}},{key:"getDescriptorForItem",value:function(e){try{m.default.PAssert(1338,e,"Must have a valid item to get a description for")}catch(r){m.default.reportError(r)}var t=this._getAccountIDFromItem(e),a=this._getLabelIDFromItem(e),i={accountID:t,labelID:a,threadID:this._getThreadIDFromItem(e)};if(t&&a){var n=this._getLabelByID(t,a);i.labelName=n.getName()}return i}},{key:"handleItemChange",value:function(e,t){var a=this.getDescriptorForItem(e);if(a.labelID){try{m.default.PAssert(1339,a.accountID,"Must specify a valid accountID")}catch(i){m.default.reportError(i)}this._getThreadsForLabel(a.accountID,this._getLabelByID(a.accountID,a.labelID),e,!1,function(e){try{m.default.PAssert(1340,e,"Expected success when querying for remote threads")}catch(i){m.default.reportError(i)}t&&t()})}}},{key:"handleViewModeChange",value:function(e,t){if(t===v.a.GmailViewMode.Priority){var a=this._getAccountIDFromItem(e);try{m.default.PAssert(1341,a,"Missing Account ID: ",e.id)}catch(s){m.default.reportError(s)}var i=this._getLabelByName(a,ma.PRI0);i&&this._getThreadsForLabel(a,i,void 0,!1,function(e){try{m.default.PAssert(1342,e,"Expected success when querying for remote PRI0 threads")}catch(s){m.default.reportError(s)}});var n=this._getLabelByName(a,ma.PRI1);n&&this._getThreadsForLabel(a,n,void 0,!1,function(e){try{m.default.PAssert(1343,e,"Expected success when querying for remote PRI1 threads")}catch(s){m.default.reportError(s)}});var r=this._getLabelByName(a,ma.PRI2);r&&this._getThreadsForLabel(a,r,void 0,!1,function(e){try{m.default.PAssert(1344,e,"Expected success when querying for remote PRI2 threads")}catch(s){m.default.reportError(s)}})}}},{key:"_getThreadsForLabel",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(1345,t,"Must provide a valid label to get thrads for")}catch(d){m.default.reportError(d)}var s="-in:chats -in:spam label:"+t.getName(),o=t.getOldestSync();m.default.isDateValid(o)&&(s+=" before:"+Math.floor(o.getTime()/1e3));var l=new Date,u=new Ht(function(t){if(t){var a=r._addRemoteEntry(e,t);a.internalDate.isBefore(l)&&(l=a.internalDate),r.cacheThreadData(a.id,r.serializeExternalData(a))}},function(e){t.setOldestSync(l),r._writeLabelsToCache(),n(e)});this._requestRemoteThreads(e,aa,a,s,i?999:25,void 0,u.getEntryCB(),u.getDoneCB())}},{key:"createOutlinePaneItem",value:function(e,t){for(var a=0,i=t.getItemStore(),n=e.getRawText(),r=e.getAttachmentByPlugin(this.id),s=this.getDisplayTags(r,void 0,!0),o=0;o<s.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n+=" #"+s[o]}return i.createItem(m.default.generateTempId(),n,t.id,void 0,v.a.ChangeType.Local,t.getDocumentOwner())}},{key:"refreshCurrentView",value:function(e){this._forceThreadSync(e)}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate)}},{key:"loadInitialData",value:function(){f()(c()(t.prototype),"loadInitialData",this).call(this),m.default.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},{key:"_forceLabelSync",value:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},{key:"_syncOfflineChanges",value:function(){try{m.default.PAssert(1346,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){m.default.reportError(e)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(e){var t=this;try{m.default.PAssert(1347,m.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(l){m.default.reportError(l)}var a=0,i=0,n=this._getFullSyncTime(),r=this._getUnreadSyncTime(),s=this._getMetadataSyncTime(),o=function(e){if(e&&e.date)return m.default.isString(e.date)&&(e.date=new Date(e.date)),e.date.isBefore(n)};this._threadCache.getFilterEntries(o).then(function(n){if(n)for(var o=0,l=0;l<n.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=n[l],d=!0;if(t.ensureThreadDates(u),!u.date.isBefore(r))for(var c=0,h=0;d&&h<u.messages.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=u.messages[h];if(t.isPriorityData(f)){d=!1;break}}if(d){var p=0;u.date.isBefore(s)&&(t._threadCache.removeEntry(u.id),a++);for(var g=0;g<u.messages.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var v=u.messages[g];t._rawCache.removeEntry(v.id),i++}}}m.default.log("Gmail Cache Pruned: ",a,i),e(!1)})}},{key:"_cleanupRawCache",value:function(e){var t=this;try{m.default.PAssert(1348,m.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(r){m.default.reportError(r)}var a=0,i=this._getUnreadSyncTime(),n=function(e){return!e.internalDate||new Date(parseInt(e.internalDate)).isBefore(i)};this._rawCache.getFilterEntries(n).then(function(i){if(i)for(var n=0,r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[r];t._rawCache.removeEntry(s.id),a++}m.default.log("Raw Cache Pruned: ",a),e()})}},{key:"getAccountSetting",value:function(e,t){var a,i=this._getAccountLib(e,this._accountSettings);return i&&(a=i[t]),a}},{key:"setAccountSetting",value:function(e,t,a){var i,n=this._ensureAccountLib(e,this._accountSettings);return i=n[t],n[t]=a,i}},{key:"runSettingsSync",value:function(){var e=this;this._getSettingsSendAs(function(t){for(var a in t)t.hasOwnProperty(a)&&e.setAccountSetting(a,"sendAs",t[a]);e._writeSendAsToCache()})}},{key:"_getSyncDays",value:function(){var e=this.getSetting(this.Settings.SyncTime);sr.billingManager.isTrialOver()&&(e=v.a.MaxGmailSyncTime.Free);var t=sr.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}},{key:"_getMetadataSyncDays",value:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=sr.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}},{key:"_getUnreadSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}},{key:"_getFullSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-e)}},{key:"_getMetadataSyncTime",value:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(e){var t,a=this,i=0,n=0,r=[],s=[],o=function(o,l,u){o?(i++,r.push(l)):(n++,!m.default.isHTTPStatusCode(u,v.a.HTTPStatusCode.Network)&&a.isOnline()&&s.push(l)),n+i===t&&(s.length>0?sr.toasts.pushMessage(v.a.MessageID.EmailSyncFail):sr.toasts.clearMessage(v.a.MessageID.EmailSyncFail),r.length>0&&a._contentSyncTask.requestRun(),e&&e(0===s.length))},l=!1,u=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<u&&(l=!0,m.default.log("Forcing full gmail sync")),this._lastSyncTime=u;var d=this._threadCache.getMetadata(ca.HistoryIDs),c=this.getSyncAccounts();t=c.length,c.forEach(function(e){var t;if(!l){var i=d?d[e]:void 0;t=i?i.historyID:void 0}ye.a.getAccountAuthToken(e,a.googleScopes(),function(i){i&&a.performThreadSync(e,t,o)})})}},{key:"syncAllAccountsFull",value:function(e){this._lastSyncTime=0,this.runThreadSync(e)}},{key:"performThreadSync",value:function(e,t,a){t?(Date.now()-this._lastCacheCleanup>m.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,a)):this._performThreadSyncFull(e,a)}},{key:"_performThreadSyncFull",value:function(e,t){var a,i=this,n="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),r=this.getDefaultItemStore(),s=this._ensureVMLIsForAccount(e,r);s.clearPaginationToken();var o=new Ht(function(t){if(t&&(!a&&t.historyId&&(a=t.historyId,i.setHistoryID(e,a)),i._shouldCacheThread(t))){var n=i._addRemoteEntry(e,t);i.cacheThreadData(n.id,i.serializeExternalData(n))}},function(a){t(a,e)});this._requestRemoteThreads(e,Wt,s,n,999,0,o.getEntryCB(),o.getDoneCB()),this.runLabelSync(function(){var t=i._getLabelByName(e,"Moo.do/Handled",!0);t&&i._getThreadsForLabel(e,t,void 0,!0,function(e){try{m.default.PAssert(1349,e,"Expect to be able to get all handled messages")}catch(t){m.default.reportError(t)}}),i._getThreadsForLabel(e,i._getLabelByID(e,Et.UNREAD),void 0,!1,function(e){try{m.default.PAssert(1350,e,"Expect to be able to get all unread messages")}catch(t){m.default.reportError(t)}})})}},{key:"_compactHistoryEntries",value:function(e){for(var t=0,a={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i],r=0;if(n.messagesAdded){for(var s=0,o=0;o<n.messagesAdded.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=n.messagesAdded[o].message,u=a.messagesAdded[l.threadId];u||(u=a.messagesAdded[l.threadId]=[]),u.indexOf(l.id)<0&&u.push(l.id)}r+=n.messagesAdded.length}if(n.messagesDeleted){for(var d=0,c=0;c<n.messagesDeleted.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=n.messagesDeleted[c].message,f=a.messagesDeleted[h.threadId];f||(f=a.messagesDeleted[h.threadId]=[]),f.indexOf(h.id)<0&&f.push(h.id)}r+=n.messagesDeleted.length}if(n.labelsAdded){for(var p=0,g=0;g<n.labelsAdded.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var v=n.labelsAdded[g].message,y=a.labelsAdded[v.threadId];y||(y=a.labelsAdded[v.threadId]={}),y[v.id]||(y[v.id]=[]),y[v.id].pushOnlyUniques(n.labelsAdded[g].labelIds)}r+=n.labelsAdded.length}if(n.labelsRemoved){for(var k=0,_=0;_<n.labelsRemoved.length;++_){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var S=n.labelsRemoved[_].message,P=a.labelsRemoved[S.threadId];P||(P=a.labelsRemoved[S.threadId]={}),P[S.id]||(P[S.id]=[]),P[S.id].pushOnlyUniques(n.labelsRemoved[_].labelIds)}r+=n.labelsRemoved.length}try{m.default.PAssert(1351,0===r||r===n.messages.length,"Must have handled all or none of the generic messages")}catch(O){m.default.reportError(O)}if(0===r)for(var w=0,I=0;I<n.messages.length;++I){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var b=n.messages[I],D=a.messages[b.threadId];D||(D=a.messages[b.threadId]=[]),D.indexOf(b.id)<0&&D.push(b.id)}}var E={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var C in a.messages)a.messages.hasOwnProperty(C)&&E.messages.push({id:C,msgIDs:a.messages[C]});for(var A in a.messagesAdded)a.messagesAdded.hasOwnProperty(A)&&!a.messages[A]&&E.messagesAdded.push({id:A,msgIDs:a.messagesAdded[A]});for(var M in a.messagesDeleted)a.messagesDeleted.hasOwnProperty(M)&&!a.messages[M]&&E.messagesDeleted.push({id:M,msgIDs:a.messagesDeleted[M]});for(var T in a.labelsAdded)if(a.labelsAdded.hasOwnProperty(T)&&!a.labelsAdded[T])for(var L in a.labelsAdded[T])a.labelsAdded[T].hasOwnProperty(L)&&E.labelsAdded.push({id:T,msgID:L,labelIDs:a.labelsAdded[T][L]});for(var x in a.labelsRemoved)if(a.labelsRemoved.hasOwnProperty(x)&&!a.messages[x])for(var R in a.labelsRemoved[x])a.labelsRemoved[x].hasOwnProperty(R)&&E.labelsRemoved.push({id:x,msgID:R,labelIDs:a.labelsRemoved[x][R]});return E}},{key:"_performThreadSyncPartial",value:function(e,t,a){var i=this,n=be.a.fns("gmail").users.history.list.packedFn,r={userId:e,startHistoryId:t},s={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},o=function(e,t){m.default.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,n,r,function(t,n,r){var s;r&&(s=r.historyId,i.setHistoryID(e,s)),sr.PaneUpdateBatcher.beginUpdateItems();var l=i._compactHistoryEntries(t);i._handleCompactHistory(e,l,o),sr.PaneUpdateBatcher.commitUpdateItems(),a(!0,e)},function(t){t&&t.error&&t.error.code===v.a.HTTPStatusCode.NotFound?i._clearCachedData(e,function(n){n?i.performThreadSync(e,void 0,a):a(!1,e,t)}):(a(!1,e,t),i._notifyFailedRequest(e,t))},void 0,Gt,s)}},{key:"_handleCompactHistory",value:function(e,t,a){for(var i=0,n=0,r=0,s=0,o=0,l=0,u=0;u<t.messages.length;++u){var d=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var c=t.messages[u],h=0;h<c.msgIDs.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;this._handleMessageUpdated(e,c.id,c.msgIDs[h],a),l++}}for(var f=0;f<t.messagesAdded.length;++f){var p=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var g=t.messagesAdded[f],m=0;m<g.msgIDs.length;++m){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;this._handleMessageAdded(e,g.id,g.msgIDs[m],a),l++}}for(var v=0;v<t.messagesDeleted.length;++v){var y=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var k=t.messagesDeleted[v],_=0;_<k.msgIDs.length;++_){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleMessageDeleted(e,k.id,k.msgIDs[_]),l++}}for(var S=0;S<t.labelsAdded.length;++S){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var P=t.labelsAdded[S];this._handleLabelsAdded(e,P.id,P.msgID,P.labelIDs),l++}for(var w=0;w<t.labelsRemoved.length;++w){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var I=t.labelsRemoved[w];this._handleLabelsRemoved(e,I.id,I.msgID,I.labelIDs),l++}return l}},{key:"_handleMessageAdded",value:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}},{key:"_handleMessageDeleted",value:function(e,t,a){this._deleteCachedMessage(e,t,a)}},{key:"_handleLabelsAdded",value:function(e,t,a,i){this.addLabelsToMessage(e,t,a,i,v.a.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(e,t,a,i){this.removeLabelsFromMessage(e,t,a,i,v.a.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(e,t,a,i){this.refreshThreadCacheData(e,t,a,i)}},{key:"getLastSyncTime",value:function(e){var t,a=this._threadCache.getMetadata(ca.HistoryIDs);if(a){var i=a[e];i&&i.date&&(t=new Date(i.date))}return t}},{key:"getAllLastSyncTimes",value:function(){for(var e=0,t=this._threadCache.getMetadata(ca.HistoryIDs),a={},i=this.getSyncAccounts(),n=0;n<i.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=i[n],s=t?t[r]:void 0;s&&s.date?a[r]=new Date(s.date):a[r]=void 0}return a}},{key:"setHistoryID",value:function(e,t){try{m.default.PAssert(1353,m.default.isString(e),"Must provide a valid account ID to set history ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1354,m.default.isString(t),"Must provide a valid history ID to set")}catch(i){m.default.reportError(i)}var a=Object.assign({},this._threadCache.getMetadata(ca.HistoryIDs));a[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(ca.HistoryIDs,a)}},{key:"clearHistoryID",value:function(e){try{m.default.PAssert(1355,m.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(a){m.default.reportError(a)}var t=this._threadCache.getMetadata(ca.HistoryIDs);t&&(delete t[e],this._threadCache.setMetadata(ca.HistoryIDs,t))}},{key:"clearCachedLabel",value:function(e){try{m.default.PAssert(1356,m.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(a){m.default.reportError(a)}var t=this._threadCache.getMetadata(ca.Labels);t&&(delete t[e],this._threadCache.setMetadata(ca.Labels,t))}},{key:"_clearCachedData",value:function(e,t){this.clearHistoryID(e),this.clearCachedLabel(e),this.clearAccountThreadCache(e,t)}},{key:"clearAccountThreadCache",value:function(e,t){var a=this;try{m.default.PAssert(1357,m.default.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1358,!t||m.default.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(n){m.default.reportError(n)}var i=function(t){return t.accountID===e};this._threadCache.getFilterEntries(i).then(function(i){if(i){var n=0;m.default.log("Clearing account thread cache: "+e);for(var r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[r];if(a._threadCache.removeEntry(s.id),s.messages)for(var o=0,l=0;l<s.messages.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a._rawCache.removeEntry(s.messages[l].id)}}t&&t(!0)}else t&&t(!1)})}},{key:"requestDataPage",value:function(e,t){m.default.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()&&e?this._requestRemoteThreads(void 0,Qt,e,void 0,25,void 0,void 0,t):t(!0)}},{key:"_requestRemoteThreads",value:function(e,t,a,i,n,r,s,o){var l,u=this;if(a&&a.hasPaginationToken()&&!a.paginationTokenInUse()){l=a.beginDataPageLoad();try{m.default.PAssert(1361,!i,"Should not define a new q for paged token")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1362,!s,"Should not define a new entryCB for paged token")}catch(g){m.default.reportError(g)}if(i=l.getQuery(),n=l.getMaxResults(),s=l.getEntryCB(),o){var d=o;o=function(){for(var e=0,t=0,a=arguments.length,i=new Array(a),n=0;n<a;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[n]=arguments[n]}l.getDoneCB().apply(null,i),d.apply(null,i)}}else o=l.getDoneCB();e=e||l.getInfo().accountID}else a&&a.needsPaginationToken()&&(l=this.createPaginationToken(void 0,i,{accountID:e},n,s,o),a.setPaginationToken(l),a.beginDataPageLoad());n=n||25;try{m.default.PAssert(1363,s&&m.default.isFunction(s),"Must define a valid entry callback")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1364,o&&m.default.isFunction(o),"Must define a valid done callback")}catch(g){m.default.reportError(g)}var c,h,f=be.a.fns("gmail").users.threads.list.packedFn,p={userId:e,maxResults:n,timeoutMS:r,q:i,pageToken:l&&l.hasMorePages()?l.getNextPageToken():void 0};l||!a?(c=function(t){if(t.nextPageToken&&l&&u.updatePaginationToken(l,t.nextPageToken),a&&l&&a.endDataPageLoad(!!t.nextPageToken),t.threads)for(var i=0,n=t.threads.length,r=0,d=0,c=function(e){e?(s(e),r++):(s(void 0),d++),r+d===n&&o(!0)},h=0;h<t.threads.length;++h){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var f=t.threads[h];u._requestRemoteThreadMetadata(e,f.id,void 0,c)}else o(!0)},h=function(t){a&&l&&a.endDataPageLoad(l),o(!1),u._notifyFailedRequest(e,t)}):(c=function(){o(!0)},h=function(t){o(!1),u._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,f,p,c,h,void 0,t)}},{key:"_requestRemoteMessageData",value:function(e,t,a){var i=this;try{m.default.PAssert(1365,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(o){m.default.reportError(o)}var n=be.a.fns("gmail").users.messages.get.packedFn,r={userId:e.getField("accountID"),id:t,format:"full"},s=function(){var n=wt()(St.a.mark(function n(r){var s;return St.a.wrap(function(n){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(n.prev=n.next){case 0:return n.next=2,i._parseMailMessage(r);case 2:s=n.sent;try{m.default.PAssert(1366,s,"Must be able to parse message")}catch(o){m.default.reportError(o)}i._updateMessageData(e,t,s),a(!0);case 6:case"end":return n.stop()}}},n)}));return function(e){return n.apply(this,arguments)}}();this._queueRemoteRequestMulti(e.getField("accountID"),n,r,s,function(t){a(!1,t),i._notifyFailedRequest(e.getField("accountID"),t)},void 0,ua)}},{key:"_requestRemoteMessageDataRaw",value:function(e,t,a,i,n){var r=this,s=be.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full"},l=function(t){n(void 0,t),r._notifyFailedRequest(e,t)},u=function(a){a&&r._handleContentSyncdMessage(e,t,a),n(a)};ye.a.getAccountAuthToken(e,[v.a.GScope.GmailModify],function(t){t?r._queueRemoteRequestMulti(e,s,o,u,l,void 0,ua,{priority:i?v.a.RequestPriority.UserBlocking:v.a.RequestPriority.Default}):n(!1,!1,"This thread belongs to an account ("+e+") you are not authorized to access.")})}},{key:"_requestRemoteThreadDataRaw",value:function(e,t,a){var i=this,n=be.a.fns("gmail").users.threads.get.packedFn,r={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,n,r,a,function(t){a(void 0,t),i._notifyFailedRequest(e,t)},void 0,Kt)}},{key:"_requestRemoteThreadMetadata",value:function(e,t,a,i){var n=this,r=be.a.fns("gmail").users.threads.get.packedFn,s={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,r,s,function(e){i(e)},function(t){i(void 0,t),n._notifyFailedRequest(e,t)},a,Yt)}},{key:"_persistRemoteSnoozeTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSnoozeTask",value:function(e,t){e.getData()}},{key:"_persistRemoteSendMailTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSendMailTask",value:function(e,t){e.getData()}},{key:"_handleRemotePersist",value:function(e,t){if(t.status!==v.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(a){return m.default.reportError(a),e(!1)}}},{key:"_parseMailThread",value:function(){var e=wt()(St.a.mark(function e(t,a){var i,n,r=this;return St.a.wrap(function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return i=[],e.next=3,Promise.all(a.messages.map(function(){var e=wt()(St.a.mark(function e(t){var a;return St.a.wrap(function(e){for(var n=0,s=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,r._parseMailMessage(t);case 2:a=e.sent;try{m.default.PAssert(1367,a,"Must be able to parse each message")}catch(o){m.default.reportError(o)}a&&i.push(a);case 5:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:n=t.getField("messages"),this._mergeMessagesData(n,i,["labelIds","draftID"]),t.updateField("dataLoaded",!0),t.updateField("messages",i),this._updateAttachmentFromMessages(t,v.a.ChangeType.Remote);case 8:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAttachmentURL",value:function(e,t,a){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+a)}},{key:"getPreviewURL",value:function(e){return e.link}},{key:"reportMessage",value:function(e,t,a,i,n){var r=be.a.fns("gmail").users.messages.get.packedFn,s={userId:e,id:a,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,r,s,this._sendReport.bind(this,n,i),function(){try{m.default.PAssert(1368,!1,"Failed to report message")}catch(e){m.default.reportError(e)}},void 0,ua)}},{key:"dumpMessage",value:function(e,t,a){var i=this.getAttachment(t),n=this._getMessageFromAttachment(i,a);console.log("Message Dump: ",n)}},{key:"_sanitizeMessage",value:function(){var e=wt()(St.a.mark(function e(t){var a,i,n,r,s,o=this;return St.a.wrap(function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.parts){e.next=3;break}return e.next=3,Promise.all(t.parts.map(function(e){return o._sanitizeMessage(e)}));case 3:if(!t.body||!t.body.data){e.next=13;break}if(!(a=this._runDecodeEmail(t))||a.mimeType!==Ma){e.next=11;break}return e.next=8,Ot.a.sanitizeContent(a.decoded);case 8:i=e.sent,e.next=12;break;case 11:t.body.data=this._encodeEmail(Ot.a.sanitizePlaintext(a.decoded));case 12:t.body.data=this._encodeEmail(i);case 13:if(!t.headers){e.next=30;break}n=0,r=0;case 16:if(!(r<t.headers.length)){e.next=30;break}if(!(n++>5e3&&__infLoop&&__infLoop(n))){e.next=19;break}throw new RangeError;case 19:s=t.headers[r],e.t0=s.name.toUpperCase(),e.next="TO"===e.t0?23:"CC"===e.t0?23:"BCC"===e.t0?23:"FROM"===e.t0?23:"SUBJECT"===e.t0?25:"SNIPPET"===e.t0?25:27;break;case 23:return s.value=s.value.replace(/[A-Za-z0-9]/g,"#"),e.abrupt("break",27);case 25:return s.value=new Array(s.name.length+1).join("#"),e.abrupt("break",27);case 27:++r,e.next=16;break;case 30:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_sendReport",value:function(){var e=wt()(St.a.mark(function e(t,a,i){var n;return St.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(1369,m.default.isBoolean(t),"Must provide a valid boolean for sendContent")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1370,m.default.isString(a),"Must provide a valid description string")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1371,m.default.isObject(i),"Must provide valid raw data")}catch(s){m.default.reportError(s)}if(e.prev=3,m.default.log("Sending Message Report",i),t){e.next=8;break}return e.next=8,this._sanitizeMessage(i.payload);case 8:n={description:a,payload:i.payload},m.default.reportError(new Error("Report Message"),n),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),m.default.reportError(e.t0);case 15:case"end":return e.stop()}}},e,this,[[3,12]])}));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"loadResource",value:function(e,t,a,i){if(this.hasCacheData(e)){var n=this.getAttachment(e),r=this._getMessageFromAttachment(n,t).resources[a];r?(r.data?i(r,a):this._requestRemoteAttachment(n.getField("accountID"),t,r.id,function(e,t){e&&(r.data=e,r.size=t),i(r,a)}),this.sendEvent("FetchAttachment")):i(void 0,a)}else i(void 0,a)}},{key:"_requestRemoteAttachment",value:function(e,t,a,i){var n=this,r=be.a.fns("gmail").users.messages.attachments.get.packedFn,s={id:a,messageId:t,userId:e};this._queueRemoteRequestMulti(e,r,s,function(e){i(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)},function(t){i(void 0),n._notifyFailedRequest(e,t)},void 0,la)}},{key:"_parseAttachment",value:function(e,t,a){try{m.default.PAssert(1372,e,"Must have valid multipart lib")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1373,a.body,"Must have a valid attachment body")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1374,a.body.attachmentId,"Must have a valid attachment ID")}catch(g){m.default.reportError(g)}var i,n,r,s,o,l="0."+a.partId;if(a.headers)for(var u=0,d=0;d<a.headers.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=a.headers[d];switch(c.name.toUpperCase()){case"CONTENT-ID":var h=/^<(.*)>$/.exec(c.value);n=i=h?h[1]:c.value;break;case"CONTENT-TRANSFER-ENCODING":o=c.value;break;case"CONTENT-DISPOSITION":var f=c.value.split(";");s=f[0]?f[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":r=c.value}}i&&s!==ha.Attachment||!a.filename?!i&&a.body.attachmentId&&(i=a.body.attachmentId):i=a.filename;try{m.default.PAssert(1375,i,"Must be able to find a valid resource ID")}catch(g){m.default.reportError(g)}var p={cid:i,rawContentID:n,id:a.body.attachmentId,attID:l,realAttrID:r,data:void 0,size:a.body.size,uploader:void 0,disposition:s,parentType:t.mimeType,mimeType:a.mimeType,contentEncoding:o};e[p.cid]=p}},{key:"_decodeFlowed",value:function(e,t){return e.split(/\r?\n/).reduce(function(e,a,i){var n=e;return t&&(n=n.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===i?n+a:n+"\n"+a}).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(e,t,a){try{m.default.PAssert(1376,m.default.isString(e),"Passing in an invalid string to decode")}catch(n){m.default.reportError(n)}var i;if(e)try{i=m.default.b64_to_utf8(e),"FLOWED"===a.format&&(i=this._decodeFlowed(i,a.delSp))}catch(r){m.default.reportError(r)}return i}},{key:"_encodeEmail",value:function(e){var t;try{t=m.default.utf8_to_b64(e)}catch(a){m.default.reportError(a)}return t}},{key:"_runDecodeEmail",value:function(e){try{m.default.PAssert(1377,e&&e.body,"Must pass in a valid part")}catch(s){m.default.reportError(s)}var t,a=this._getHeader(e,"Content-Transfer-Encoding"),i=!1;if(Wa.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:Ma,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:i};var n=this._getHeader(e,"Content-Type")||"text/html;charset=utf-8";try{m.default.PAssert(1378,n,"Must have a valid contentType")}catch(s){m.default.reportError(s)}var r=this._sanitizeContentType(n);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,a,r):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",i=!0),{decoded:t,mimeType:e.mimeType,contentType:r.type,name:r.name,hasError:i}}},{key:"_runDecodeMessage",value:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?za.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:Wa.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}},{key:"_decodeMessagePart",value:function(e){var t=[];if(e)if(e.mimeType===Sa||e.mimeType===Pa||e.mimeType===_a)for(var a=0,i=0;i<e.parts.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._decodeMessagePart(e.parts[i]);t.pushArray(n)}else if(e.mimeType===ka||e.mimeType===ya||e.mimeType===ya||e.mimeType===Ia)for(var r=0,s=e.parts.length-1;s>=0;s--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this._isValidDisplayPart(e.parts[s])){var o=this._decodeMessagePart(e.parts[s]);if(o.length>0){t.pushArray(o);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}},{key:"_combineMessageParts",value:function(){var e=wt()(St.a.mark(function e(t){var a,i,n,r,s,o;return St.a.wrap(function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(a="",i=Aa,n="text/html;charset=utf-8",r=!1,!(t&&t.length>0)){e.next=22;break}s=0,i=t[0].mimeType,n=t[0].contentType,t.length,o=0;case 10:if(!(o<t.length)){e.next=17;break}if(!(s++>5e3&&__infLoop&&__infLoop(s))){e.next=13;break}throw new RangeError;case 13:qa.indexOf(t[o].mimeType)<0&&(r=!0);case 14:++o,e.next=10;break;case 17:return e.next=19,Ot.a.combineParts(t);case 19:a=e.sent,e.next=23;break;case 22:a=" ";case 23:return i===Aa&&(i=Ma,n=Ma+";charset="+n.split(";charset=")[1]),e.abrupt("return",{decoded:a,mimeType:i,contentType:n,reportMessage:r});case 25:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"_isValidDisplayPart",value:function(e){var t=!1;return!this._isResourcePart(e)&&za.indexOf(e.mimeType)>=0&&(t=!0),t}},{key:"_isResourcePart",value:function(e){var t=!1;return e.filename?t=!0:this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||za.indexOf(e.mimeType)<0)&&(t=!0),t}},{key:"_parseMessagePart",value:function(e,t){var a=0,i=0,n={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case Aa:case Ma:case ba:break;case ya:case _a:case Da:case ka:case wa:case Pa:case Ea:case Sa:for(var r=0;r<e.parts.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e.parts[r],o=this._parseMessagePart(s,n);this._isResourcePart(s)?n.resources.push(o):n.children.push(o)}break;case Ia:for(var l=0;l<e.parts.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=this._parseMessagePart(e.parts[l],n);n.children.push(u)}break;default:var d=e.mimeType.split("/")[0];ja.indexOf(d)<0&&(m.default.log("Unknown Part Mimetype: ",e),m.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return n}},{key:"_getMessageDisplay",value:function(e,t){var a=0;switch(e.mimeType){case Aa:case Ma:case Sa:case Pa:case wa:t.push(e);break;case ka:case ya:case Ia:case _a:for(var i=0;i<e.children.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getMessageDisplay(e.children[i],t)}break;case Ta:case La:break;case Da:case Ca:case Ea:t.push(e);break;default:try{m.default.PAssert(1379,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(n){m.default.reportError(n)}}}},{key:"_getResourcesForNode",value:function(e,t){for(var a=0,i=e.resources,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n].raw;this._parseAttachment(t,e,r)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}},{key:"_getResourcesForPart",value:function(e){var t=0,a={};if(e.mimeType===Sa||e.mimeType===Pa)for(var i=0,n=0;n<e.children.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getResourcesForNode(e.children[n],a)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,a),e=e.parent}return a}},{key:"_displayAttachment",value:function(e,t){var a=!1;return e.cid===t&&(e.disposition===ha.Attachment?a=!0:e.disposition===ha.Inline&&e.parentType===Sa&&(a=!0)),a}},{key:"getMessageAttachments",value:function(e){var t=this,a=[];return m.default.forEachValue(e.resources,function(e){t._displayAttachment(e,e.cid)&&a.push(e)}),a}},{key:"getMessageDisplayAttachments",value:function(){var e=wt()(St.a.mark(function e(t){var a,i,n,r,s,o,l=0;return St.a.wrap(function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(a=this.getMessageAttachments(t),!t.initializedForDisplay){e.next=5;break}i=t.specialLinks?t.specialLinks.attachments:[],e.next=9;break;case 5:return n={ignoreQuotedAttachments:!!(t.labelIds.indexOf(Et.DRAFT)>=0)},e.next=8,Ot.a.getAttachmentLinks(t.decoded,n);case 8:i=e.sent;case 9:r=0;case 10:if(!(r<i.length)){e.next=18;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=13;break}throw new RangeError;case 13:s=i[r],t.resources[s.name]||((o=this._createResource(t.resources,s)).link=s.href,a.push(o));case 15:++r,e.next=10;break;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyDKIM",value:function(e){var t;if(e)for(var a=0,i=e.split(";"),n=/([a-z]+)[=](.*)/i,r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[r].trim();if(s){var o=n.exec(s);if(o)switch(t={},o[1]){case"d":t.domain=o[2];break;case"h":t.headers=o[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}},{key:"_sanitizeContentType",value:function(e){var t="text/html;charset=utf-8";try{var a,i,n,r,s=0,o=e.replace(/[\"\']/g,"").split(";"),l=o[0].trim().toLowerCase();try{m.default.PAssert(1380,l===Aa||l===Ma,"Unknown ContentType MediaType: "+l)}catch(p){m.default.reportError(p)}for(var u=1;u<o.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=o[u].trim();if(d){var c=d.indexOf("=");if(c>=1){var h=d.substr(0,c).trim(),f=d.substr(c+1).trim();if(h&&f)switch(h.toUpperCase()){case"CHARSET":a=f;break;case"FORMAT":i=f.toUpperCase();break;case"DELSP":n="YES"===f.toUpperCase();break;case"NAME":r=f;break;case"BOUNDARY":break;default:try{m.default.PAssert(1381,!1,"Unknown param in ContentType: "+d)}catch(p){m.default.reportError(p)}}else try{m.default.PAssert(1382,!1,"Malformed contentType part: ",e)}catch(p){m.default.reportError(p)}}else try{m.default.PAssert(1383,!1,"Invalid contentType part: ",e)}catch(p){m.default.reportError(p)}}}a||(a="utf-8"),l&&a&&(t=l+";charset="+a)}catch(g){m.default.reportError(g)}return{type:t,format:i,delSp:n,name:r}}},{key:"_getHeader",value:function(e,t){var a;if(e&&e.headers)for(var i=0,n=0;n<e.headers.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.headers[n].name.toUpperCase()===t.toUpperCase()){a=e.headers[n].value;break}}return a}},{key:"_generateMessageDisplayNode",value:function(e){try{m.default.PAssert(1385,Wa.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(i){m.default.reportError(i)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var a;switch(e.mimeType){case Ca:case Ea:case Sa:a="&nbsp;";break;case Da:a="Unable to display encrypted message content.";break;default:a="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+a+"</body></html>"}return t}},{key:"_parseMailMessage",value:function(){var e=wt()(St.a.mark(function e(t){return St.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._parseMailMessageInternal(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),m.default.reportError(e.t0);case 9:case"end":return e.stop()}}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_parseMailMessageInternal",value:function(){var e=wt()(St.a.mark(function e(t){var a,i,n,r,s,o,l,u,d,c,h,f,p,g,v,y,k=0;return St.a.wrap(function(e){for(var _=0;;){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;switch(e.prev=e.next){case 0:a=t.payload,i=!!a.body&&a.body.size>0;try{m.default.PAssert(1386,i!==a.mimeType.startsWith("multipart/")||a.mimeType===_a,"Checking the body size should be the same as checking whether this is a multipart message")}catch(S){m.default.reportError(S)}this._verifyDKIM(this._getHeader(t.payload,"DKIM-Signature")),n=t.payload.headers,r=0;case 6:if(!(r<n.length)){e.next=40;break}if(!(k++>5e3&&__infLoop&&__infLoop(k))){e.next=9;break}throw new RangeError;case 9:s=n[r],e.t0=s.name.toUpperCase(),e.next="FROM"===e.t0?13:"REPLY-TO"===e.t0?15:"TO"===e.t0?17:"CC"===e.t0?19:"BCC"===e.t0?21:"SUBJECT"===e.t0?23:"DATE"===e.t0?25:"MESSAGE-ID"===e.t0?28:"REFERENCES"===e.t0?30:"IN-REPLY-TO"===e.t0?32:"LIST-UNSUBSCRIBE"===e.t0?34:36;break;case 13:return t.from=this.parseEmailAddress(s.value),e.abrupt("break",37);case 15:return t.replyTo=this.parseEmailAddress(s.value),e.abrupt("break",37);case 17:return t.to=this.parseEmailAddresses(s.value),e.abrupt("break",37);case 19:return t.cc=this.parseEmailAddresses(s.value),e.abrupt("break",37);case 21:return t.bcc=this.parseEmailAddresses(s.value),e.abrupt("break",37);case 23:return t.subject=s.value,e.abrupt("break",37);case 25:t.date=this.parseDateHeader(s.value);try{m.default.PAssert(1387,m.default.isDateValid(t.date),"Must have a valid message date: ",t.date)}catch(S){m.default.reportError(S)}return e.abrupt("break",37);case 28:return t.messageID=s.value,e.abrupt("break",37);case 30:return t.references=s.value,e.abrupt("break",37);case 32:return t.inReplyTo=s.value,e.abrupt("break",37);case 34:return t.listUnsubscribe=s.value,e.abrupt("break",37);case 36:return e.abrupt("break",37);case 37:++r,e.next=6;break;case 40:if(t.messageID||(t.messageID=m.default.generateTempId()),!i){e.next=45;break}l=a,e.next=64;break;case 45:u=0,d=this._parseMessagePart(a),c=[],this._getMessageDisplay(d,c),f=c.length-1;case 50:if(h||!(f>=0)){e.next=57;break}if(!(u++>5e3&&__infLoop&&__infLoop(u))){e.next=53;break}throw new RangeError;case 53:if(za.indexOf(c[f].mimeType)>=0)h=c[f];else if(Wa.indexOf(c[f].mimeType)>=0)h=c[f];else{m.default.log("Unknown bestNode mimepart: ",c[f]);try{m.default.PAssert(1388,!1,"Unknown mimePart display type: ",c[f].mimeType)}catch(S){m.default.reportError(S)}}case 54:f--,e.next=50;break;case 57:if(!h){e.next=62;break}o=this._getResourcesForPart(h),l=h.raw,e.next=64;break;case 62:return e.next=64,this._sendReport(!1,"Missing bestNode",t);case 64:try{m.default.PAssert(1389,l,"Must have found a valid message part to display")}catch(S){m.default.reportError(S)}p=this._runDecodeMessage(l);try{m.default.PAssert(1390,p.length>0,"Should have at least one decoded message part available")}catch(S){m.default.reportError(S)}if(0!==p.length){e.next=77;break}return e.prev=68,g=JSON.parse(JSON.stringify(t)),e.next=72,this._sendReport(!0,"No valid decoded part",g);case 72:e.next=77;break;case 74:e.prev=74,e.t1=e.catch(68),m.default.reportError(e.t1);case 77:return e.next=79,this._combineMessageParts(p);case 79:if(!(v=e.sent)){e.next=87;break}if(y={id:t.id,labelIds:t.labelIds,messageID:t.messageID,decoded:v.decoded,mimeType:v.mimeType,contentType:v.contentType,from:t.from,to:t.to||[],cc:t.cc,bcc:t.bcc,snippet:t.snippet,subject:t.subject||"",date:t.date,internalDate:t.internalDate?m.default.isDateValid(t.internalDate)?t.internalDate:new Date(m.default.parseInt(t.internalDate)):new Date,references:t.references,inReplyTo:t.inReplyTo,listUnsubscribe:t.listUnsubscribe,resources:o||{}},!v.reportMessage){e.next=85;break}return e.next=85,this._sendReport(!1,"Mismatch mimeType/contentType",t);case 85:return e.abrupt("return",y);case 87:case"end":return e.stop()}}},e,this,[[68,74]])}));return function(t){return e.apply(this,arguments)}}()},{key:"parseEmailAddress",value:function(e){Ka.lastIndex=0;var t=Ka.exec(e),a={};if(t){var i=Ya.exec(t[1]);a.text=i?i[1]:t[1],a.email=t[2]}else a.email=e;return a.email&&(a.email=a.email.replace(/[\r\n]/g,"")),a.text&&(a.text=a.text.replace(/[\r\n]/g,"")),a}},{key:"parseEmailAddresses",value:function(e){for(var t=0,a=[],i=m.default.parseEmailAddresses(e),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n];"contact"===r.type&&r.email&&a.push(r)}return a}},{key:"parseDateHeader",value:function(e){var t=new Date(e);return m.default.isDateValid(t)||(t=sr.International.parseDate(e,v.a.DateFormat.MDY)),t}},{key:"runRemoteSearch",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1392,e,"Must provide a valid search")}catch(k){m.default.reportError(k)}try{m.default.PAssert(1393,t,"Must provide a valid pane")}catch(k){m.default.reportError(k)}try{m.default.PAssert(1394,a,"Must provide a valid bucket ID")}catch(k){m.default.reportError(k)}try{m.default.PAssert(1395,m.default.isFunction(i),"Must provide a valid search callback")}catch(k){m.default.reportError(k)}var r="-in:chats -in:spam "+e,s=sr.PaneManager.getPaneById(t),o=this._getAccountIDFromItem(s.getItem())||this.getDefaultAccount(),l=!1,u=0,d=0,c=new He(e,25,this.requestDataPage.bind(this)),h=function(e){if(u===d&&l){m.default.log("Done Searching: ",u);var r=e?v.a.SearchResultStatus.Error:u>0?v.a.SearchResultStatus.Done:v.a.SearchResultStatus.None;c.isValid()&&n.swapInSearchBucket(a,t),i(r)}},f=function(e){if(u++,e){var t=n._addRemoteEntry(o,e),i=n.getBucketItemStore(a);n._ensureVMLIsForSearchResult(t,i),d++}else d++;h()},p=function(e){l=!0,h(!e)},g=!1,y=new Ht(c.onEntry,function(e){c.onDone(e),g||(g=!0,c.isValid()&&c.hasResults()?c.getNextPage(f,p):p(e))});return this._requestRemoteThreads(o,Xt,void 0,r,25,void 0,y.getEntryCB(),y.getDoneCB()),c}},{key:"_addSearchCacheEntryInternal",value:function(e,t,a){var i=!1,n=this._ensureAccountLib(e,this._emailCache);return n[t]||(n[t]={}),n[t][a]||(n[t][a]=!0,i=!0),i}},{key:"_removeSearchCacheEntryInternal",value:function(e,t,a){var i,n=this._getAccountLib(e,this._emailCache);return n&&n[t]&&(i=n[t][a],delete n[t][a]),i}},{key:"_getSearchCacheLabelEntryInternal",value:function(e,t){var a,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(a=i[t]),a}},{key:"_addEmailToSearchCache",value:function(e,t){var a=!1;if(t&&m.default.isArray(t.labelIds))for(var i=0,n=0;n<t.labelIds.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[n],e)||a}return a}},{key:"_removeEmailFromSearchCache",value:function(e,t){var a=!1;if(t&&m.default.isArray(t.labelIds))for(var i=0,n=0;n<t.labelIds.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[n],e);a=a||r,r&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[n])}return a}},{key:"_addEmailLabelToSearchCache",value:function(e,t,a){return this._addSearchCacheEntryInternal(e,a,t)}},{key:"_removeEmailLabelFromSearchCache",value:function(e,t,a){var i=!!this._removeSearchCacheEntryInternal(e,a,t);return i&&this._removeThreadLabelVMLI(e,t,a),i}},{key:"runLocalItemSearch",value:function(e){var t=this.getDescriptorForItem(e.item),a=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(a)for(var i in a)if(a.hasOwnProperty(i)){var n=this.getCacheData(i);try{m.default.PAssert(1396,n,"Must have valid data for search entry")}catch(s){m.default.reportError(s)}if(n){var r=this._ensureThreadLabelVMLI(n,t.labelID);e.comparator&&!e.comparator(r)||e.each&&e.each(r)}}}},{key:"getRemoteAttachmentData",value:function(e){var t,a=this;try{m.default.PAssert(1397,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(n){m.default.reportError(n)}var i=function(i,n){i?a._addRemoteEntry(t,i):(e.notifyDataRequestFailed(),a._notifyFailedRequest(t,n))};e.hasField("accountID")?(t=e.getField("accountID"),this._requestRemoteThreadMetadata(t,e.id,e,i)):this.getSyncAccounts().forEach(function(n){a._requestRemoteThreadMetadata(n,e.id,e,function(a,r){a&&(t=n,a.accountID=t,i(a,r),e.notifyDataMutated(["accountID"],v.a.ChangeType.Local))})})}},{key:"_updateThreadFromMessages",value:function(e){var t=0,a=this;try{m.default.PAssert(1398,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(h){m.default.reportError(h)}var i=e.labelIds,n=sr.settings.getUserIdentifier();"me"===e.accountID&&"me"!==n&&(e.accountID=n),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var r=0;r<e.messages.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e.messages[r];try{m.default.PAssert(1399,s.id,"Each message must have a valid ID")}catch(h){m.default.reportError(h)}e.labelIds.pushOnlyUniques(s.labelIds);var o=s.labelIds.indexOf(Et.DRAFT)>=0,l=!1;if(s.labelIds.indexOf(Et.SENT)>=0)for(var u=0,d=0;d<s.to.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=s.to[d];if(this.isMyAccountID(c.email)){l=!0;break}}else l=!0;(!e.date||s.date&&e.date.isBefore(s.date)&&!o&&l)&&(e.date=s.date),(!e.internalDate||s.internalDate&&e.internalDate.isBefore(s.internalDate))&&(e.internalDate=s.internalDate),s.from&&e.participants.indexOfWithProperty("email",s.from.email)<0&&e.participants.push(s.from),s.resources&&m.default.forEachValue(s.resources,function(t){a._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)})}return e.date=e.date?new Date(e.date):new Date(0),m.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,m.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,m.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:i?e.labelIds.removeArray(i):e.labelIds,labelsRemoved:i?i.removeArray(e.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(e,t){var a=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),a.labelsAdded,a.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}},{key:"_createRemoteEntry",value:function(e,t){for(var a=0,i={id:t.id,accountID:e,messages:[],labelIds:[]},n=0;n<t.messages.length;++n){var r=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t.messages[n];try{m.default.PAssert(1400,s.id,"Message must have a valid id")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1401,!s.labelIds||s.labelIds.indexOf(Et.CHAT)<0,"Should never receive a chat message")}catch(d){m.default.reportError(d)}s.labelIds&&s.labelIds.indexOf(Et.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,s.id);for(var o={id:s.id,messageID:void 0,internalDate:s.internalDate?new Date(m.default.parseInt(s.internalDate)):new Date,snippet:s.snippet,labelIds:s.labelIds||[],to:[],resources:{},subject:""},l=0;l<s.payload.headers.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=s.payload.headers[l];switch(u.name.toUpperCase()){case"TO":o.to=this.parseEmailAddresses(u.value);break;case"FROM":o.from=this.parseEmailAddress(u.value);break;case"SUBJECT":o.subject=u.value;break;case"MESSAGE-ID":o.messageID=u.value;break;case"IN-REPLY-TO":o.inReplyTo=u.value;break;case"DATE":o.date=this.parseDateHeader(u.value);try{m.default.PAssert(1402,m.default.isDateValid(o.date),"Must have a valid message date: ",u.value)}catch(d){m.default.reportError(d)}}}m.default.isDateValid(o.date)||(o.date=o.internalDate),o.subject||(o.subject=""),o.messageID||(o.messageID=m.default.generateTempId()),i.messages.push(o)}return this._updateThreadFromMessages(i),i}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);if(this.hasCacheData(a.id)){var i=this.getCacheData(a.id);if(i){this._mergeThreadData(i,a);var n=this._updateThreadFromMessages(a);this._handleThreadLabelUpdates(a,n.labelsAdded,n.labelsRemoved)}var r=this.getChangedFields(i,a);if(this.cacheData(a.id,a,!!i,r),this.fieldsHaveParseEffect(r))if(this.hasAttachment(a.id))this.getAttachment(a.id).notifyDataMutated(r,v.a.ChangeType.Remote)}else this.cacheData(a.id,a),this._updateSearchPanes(a,a.labelIds,[]);return a}},{key:"cacheData",value:function(e,a,i,n){this._verifyMessageState(a,!1);var r=this._addEmailToSearchCache(e,a);if(f()(c()(t.prototype),"cacheData",this).call(this,e,a,i,n),a.messages&&!this._isLoadingLocal&&this._checkUnsyncdMessageContent(a),r){var s=this.getDefaultItemStore();s&&s.updateItems()}return!!a.messages}},{key:"cacheThreadData",value:function(e,t){this._verifyMessageState(t,!0),this._threadCache.saveEntry(t,this.compareCachedData)}},{key:"compareCachedData",value:function(e,t){return this._propertySets[v.a.PluginLoad.Full].some(function(a){return!m.default.deepEqual(e[a],t[a])})}},{key:"_verifyMessageState",value:function(e,t){}},{key:"ensureThreadDates",value:function(e){m.default.isString(e.internalDate)&&(e.internalDate=new Date(e.internalDate)),m.default.isString(e.date)&&(e.date=new Date(e.date))}},{key:"createEntryFromLocal",value:function(e,t){var a=0;t.subjectLower=t.subject.toLowerCase(),this.ensureThreadDates(t),t.messages=t.messages||[];for(var i=0;i<t.messages.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t.messages[i];m.default.isString(n.date)?n.date=this.parseDateHeader(n.date):n.date||(n.date=new Date),m.default.isString(n.internalDate)?n.internalDate=new Date(n.internalDate):n.internalDate||(n.internalDate=new Date),n.to||(n.to=[]),n.resources?(n.resources=Object.assign({},n.resources),delete n.resources._lib):n.resources={};try{m.default.PAssert(1406,n.draftID||n.messageID||m.default.isTempId(n.id),"Remotely saved messages must have a valid message ID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1407,m.default.isDateValid(n.date),"Must have a valid message date: ",n.date)}catch(r){m.default.reportError(r)}try{m.default.PAssert(1408,m.default.isDateValid(n.internalDate),"Must have a valid internal message date: ",n.internalDate)}catch(r){m.default.reportError(r)}!m.default.isTempId(n.id)&&!n.draftID&&n.labelIds&&n.labelIds.indexOf(Et.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,n.id),n.decoded&&this.reportTrackedStat(zt.MessageDataCached)}return this._updateThreadFromMessages(t),t}},{key:"_updateMessageData",value:function(e,t,a){var i=e.getField("messages"),n=i.indexOfWithProperty("id",t);try{m.default.PAssert(1409,n>=0,"Must always be able to find the message being updated")}catch(r){m.default.reportError(r)}n>=0&&(this._mergeMessageData(i[n],a,["labelIds"]),i[n]=a,e.updateField("messages",i),this._updateAttachmentFromMessages(e,v.a.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(e,t,a){try{m.default.PAssert(1410,m.default.isObject(e),"Must pass in a valid old message")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1411,m.default.isObject(t),"Must pass in a valid new message")}catch(o){m.default.reportError(o)}if(e.modifiedOffline){var i=e.modifiedOffline;if(m.default.isArray(i))for(var n=0,r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[i[r]]=e[i[r]]}else Object.keys(e).forEach(function(a){t[a]=e[a]}),Object.keys(t).forEach(function(a){t[a]=e[a]});t.modifiedOffline=e.modifiedOffline}for(var s in a&&a.forEach(function(a){return t[a]=e[a]}),e)if(e.hasOwnProperty(s))switch(s){case"snippet":this._pendingDraftUpdates[e.id]&&(t[s]=e[s]);break;default:t.hasOwnProperty(s)||(t[s]=e[s])}}},{key:"_mergeMessagesData",value:function(e,t,a){var i=0;try{m.default.PAssert(1412,m.default.isArray(e),"Must have a valid old messages array")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1413,m.default.isArray(t),"Must have a valid new messages array")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1414,e!==t,"Should not pass in the same array for old and new")}catch(c){m.default.reportError(c)}for(var n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n],s=t.indexOfWithProperty("id",r.id);if(s>=0){var o=t[s];try{m.default.PAssert(1415,o,"Must have a valid new message")}catch(c){m.default.reportError(c)}this._mergeMessageData(r,o,a)}else if(r.labelIds.indexOf(Et.DRAFT)>=0)if(m.default.isTempId(r.id)){var l=t.indexOfWithProperty("messageID",r.inReplyTo);try{m.default.PAssert(1416,l>=0,"Must be able to find the message being replied to")}catch(c){m.default.reportError(c)}l>=0&&t.splice(l+1,0,r)}else if(r.inReplyTo){var u=t.indexOfWithProperty("inReplyTo",r.inReplyTo);if(u>=0){var d=t[u];try{m.default.PAssert(1417,d,"Must have a valid new message")}catch(c){m.default.reportError(c)}this._mergeMessageData(r,d,a)}}}}},{key:"_mergeThreadData",value:function(e,t){this.reportTrackedStat(zt.MergeThread);try{m.default.PAssert(1419,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(o){m.default.reportError(o)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var a=0,i=e.modifiedOffline;try{m.default.PAssert(1420,m.default.isArray(i),"Should not be receiving an update for an event that was created locally")}catch(o){m.default.reportError(o)}for(var n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n];switch(r){case"messages":break;default:t[r]=e[r]}}t.modifiedOffline=e.modifiedOffline}for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s]);t.labelIds=e.labelIds}},{key:"_shouldCacheThread",value:function(e){for(var t=0,a=!0,i=0;i<e.messages.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.messages[i];if(n.labelIds&&(n.labelIds.indexOf(Et.SPAM)>=0||n.labelIds.indexOf(Et.CHAT)>=0)){a=!1;break}}return a}},{key:"_shouldCacheMessageData",value:function(e){var t=!1,a=this._getFullSyncTime(),i=this._getUnreadSyncTime();if(e.date.isAfter(a))t=!0;else if(e.date.isAfter(i))for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=e.messages[r];if(this.isPriorityData(s)){t=!0;break}}return t}},{key:"refreshThreadCacheData",value:function(e,t,a,i,n){var r=this;this._requestRemoteThreadMetadata(e,t,void 0,function(a,s){if(a)if(r._shouldCacheThread(a)){var o=r._addRemoteEntry(e,a);r.cacheThreadData(t,r.serializeExternalData(o)),n&&n(!0)}else r._deleteCachedThread(e,t,n);else s&&s.error&&s.error.code===v.a.HTTPStatusCode.NotFound?r._deleteCachedThread(e,t,n):(i(e,t),n&&n(!1))})}},{key:"_deleteCachedThread",value:function(e,t,a){if(this.hasCacheData(t)){for(var i=0,n=this.getAttachment(t),r=n.getField("messages"),s=0;s<r.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;sr.menus.isComposeOpenForEmail(r[s].id)&&(this._clearPendingDraftUpdate(n,r[s].id),k.a.fireEvent("EmailCompose","onClosed",[]),sr.menus.closeComposeEmail(n,r[s])),this._rawCache.removeEntry(r[s].id)}n.updateField("isDeleted",!0),n.updateField("messages",[]),this._updateAttachmentFromMessages(n,v.a.ChangeType.Remote)}this._threadCache.removeEntry(t),a&&a(!0)}},{key:"_deleteCachedMessage",value:function(e,t,a){var i=this;try{m.default.PAssert(1421,a,"Must specify a valid message ID to remove from thread")}catch(l){m.default.reportError(l)}if(this.hasCacheData(t))for(var n=0,r=this.getAttachment(t),s=r.getField("messages"),o=0;o<s.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(s[o].id===a){s.removeAt(o),this._updateAttachmentFromMessages(r,v.a.ChangeType.Remote),r.updateField("messages",s);break}}this._threadCache.getEntry(t,!0).then(function(e){if(e)for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.messages[r].id===a){e.messages.removeAt(r),i.cacheThreadData(t,e);break}}}),this._rawCache.removeEntry(a)}},{key:"setLastModifiedDate",value:function(e,t,a){var i=this;this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",a);this._threadCache.getEntry(t,!0).then(function(e){e&&(e.lastModifiedDate=a,i.cacheThreadData(t,e))})}},{key:"addLabelsToMessage",value:function(e,t,a,i,n){var r=this;if(this.hasCacheData(t)){for(var s=0,o=this.getAttachment(t),l=o.getField("messages"),u=0;u<l.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if((!a||l[u].id===a)&&(l[u].labelIds.pushOnlyUniques(i),a))break}this._updateAttachmentFromMessages(o,n),o.updateField("messages",l,void 0,!0);var d=o.getField("labelIds");d&&(d.pushOnlyUniques(i),o.updateField("labelIds",d,void 0,!0))}this._threadCache.getEntry(t,!0).then(function(e){if(e){var n=0,s=!1;e.labelIds&&e.labelIds.pushOnlyUniques(i);for(var o=0;o<e.messages.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!a||e.messages[o].id===a){e.messages[o].labelIds.pushOnlyUniques(i),r.cacheThreadData(t,e),s=!0;break}}try{m.default.PAssert(1423,s,"Must have found message to add labels to")}catch(l){m.default.reportError(l)}}})}},{key:"removeLabelsFromMessage",value:function(e,t,a,i,n){var r=this;if(this.hasCacheData(t)){for(var s=0,o=this.getAttachment(t),l=o.getField("messages"),u=0;u<l.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(!a||l[u].id===a){for(var d=0,c=0;c<i.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;l[u].labelIds.remove(i[c])}if(a)break}}this._updateAttachmentFromMessages(o,n),o.updateField("messages",l,void 0,!0);var h=o.getField("labelIds");if(h){for(var f=0,p=0;p<i.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;h.remove(i[p])}o.updateField("labelIds",h,void 0,!0)}}this._threadCache.getEntry(t,!0).then(function(e){if(e){var n=0,s=!1;if(e.labelIds)for(var o=0,l=0;l<i.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e.labelIds.remove(i[l])}for(var u=0;u<e.messages.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!a||e.messages[u].id===a){for(var d=0,c=0;c<i.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;e.messages[u].labelIds.remove(i[c])}r.cacheThreadData(t,e),s=!0;break}}try{m.default.PAssert(1424,s,"Must have found message to remove labels from")}catch(h){m.default.reportError(h)}}})}},{key:"changeMessageAccount",value:function(){var e=wt()(St.a.mark(function e(t,a,i,n,r,s){var o,l,u;return St.a.wrap(function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(1425,s,"Must supply a valid from contact")}catch(c){m.default.reportError(c)}return l=n!==t.getField("accountID"),u=this._findDraft(t,a,i),l&&this.discardDraft(t,u.id,u.draftID,function(e){try{m.default.PAssert(1426,e,"Must successfully delete remote draft")}catch(c){m.default.reportError(c)}}),u.from=s,u.replyTo=this.getReplyToAddress(s.email),e.next=8,Ot.a.replaceSignature(u.decoded,this.getSignature(r));case 8:return u.decoded=e.sent,o=l?this.createDraft(n,void 0,void 0,u):this.updateDraft(t,u.id,u.draftID,u,!0,!0,function(e){try{m.default.PAssert(1427,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(c){m.default.reportError(c)}}),e.abrupt("return",o);case 11:case"end":return e.stop()}}},e,this)}));return function(t,a,i,n,r,s){return e.apply(this,arguments)}}()},{key:"_ensureVMLIsForSearchResult",value:function(e,t){try{m.default.PAssert(1428,t,"Should never be ensuring a search VMLI in the default item store")}catch(s){m.default.reportError(s)}var a="S~"+e.accountID,i=this._ensureVMLIsForAccount(a,t),n=this._createThreadID(a,"",e.id);if(!t.hasItem(n)){var r=t.createItem(n,this._getTextForItem(e),i.id);i.insertSorted(r,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(e,t){try{m.default.PAssert(1429,t,"Should never be ensuring a search VMLI in the default item store")}catch(n){m.default.reportError(n)}var a="S~"+e.accountID,i=this._createThreadID(a,"",e.id);t.hasItem(i)&&t.destroyItem(i)}},{key:"_createThreadID",value:function(e,t,a){return"T~"+e+"~"+t+"~"+a}},{key:"_getItemProps",value:function(e,t){var a;return t.isNamed(ma.PRI0)?a={priority:v.a.VMLIFlag.P0}:t.isNamed(ma.PRI1)?a={priority:v.a.VMLIFlag.P1}:t.isNamed(ma.PRI2)&&(a={priority:v.a.VMLIFlag.P2}),a}},{key:"_ensureThreadLabelVMLI",value:function(e,t,a){a=a||this.getDefaultItemStore();var i,n=this._getLabelByID(e.accountID,t),r=this._ensureVMLIsForLabel(e.accountID,n,a),s=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(zt.EnsureLabelVMLI),a.hasItem(s))i=a.getItem(s);else{this.reportTrackedStat(zt.CreateLabelVMLI);var o=this._getItemProps(e,n);i=a.createItem(s,this._getTextForItem(e),r.id,o),r.insertSorted(i,this.threadSortFn,!1)}return i}},{key:"_removeThreadLabelVMLI",value:function(e,t,a,i){i=i||this.getDefaultItemStore();var n=this._createThreadID(e,a,t);i.hasItem(n)&&i.destroyItem(n)}},{key:"_getRequiredSearchLabels",value:function(e){for(var t=0,a=[Et.INBOX],i=e.split(" "),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n].split(":");r&&2===r.length&&("label"!==r[0]&&"category"!==r[0]&&"is"!==r[0]||a.push(r[1].toUpperCase()))}return a}},{key:"_handleThreadLabelUpdates",value:function(e,t,a){sr.PaneUpdateBatcher.beginUpdateItems();var i=!1;if(t)for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i=this._addEmailLabelToSearchCache(e.accountID,e.id,t[r])||i}if(a)for(var s=0,o=0;o<a.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;i=this._removeEmailLabelFromSearchCache(e.accountID,e.id,a[o])||i}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,a),i&&this.getDefaultItemStore().updateItems(),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(e,t,a){var i=this;sr.PaneUpdateBatcher.beginUpdateItems(),sr.PaneManager.runForEachPane(function(n){if(n.isSearchingRemote()){var r=i.getActiveItemStore(n.id),s=n.search.getRemoteValue(),o=i._getRequiredSearchLabels(s),l=!1,u=!1;o.forEach(function(e){a&&a.indexOf(e)>=0?l=!0:t&&t.indexOf(e)>=0&&(u=!0)}),l?r!==i.getDefaultItemStore()&&(m.default.focusedPane===n&&0===t.length&&a&&1===a.length&&a[0]===Et.UNREAD||i._removeVMLIFromSearchResult(e,r)):u&&r!==i.getDefaultItemStore()&&i._ensureVMLIsForSearchResult(e,r)}},this.getPaneType()),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,pa):this._removeEmailLabelFromSearchCache(e.accountID,e.id,pa),this._addEmailLabelToSearchCache(e.accountID,e.id,ga)}},{key:"_ensureVMLIsForAccount",value:function(e,t){try{m.default.PAssert(1430,e,"Must specify a valid account ID")}catch(r){m.default.reportError(r)}var a="A~"+e,i=(t=t||this.getDefaultItemStore()).getItem(a);if(!i){var n=t.getRoot();i=t.createItem(a,e,n.id),n.insertSorted(i,this.sortFn)}return i}},{key:"_ensureVMLIsForLabel",value:function(e,t,a){try{m.default.PAssert(1431,t,"Must specify a valid label")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1432,t instanceof Rt,"Must pass in a valid label object")}catch(l){m.default.reportError(l)}a=a||this.getDefaultItemStore();var i="L~"+e+"~"+t.getLabelID(),n=a.getItem(i),r=t.getDisplayText(!0);if(n)n.getParsedText()!==r&&n.setText(r,v.a.ChangeType.Auto);else{var s;if(t.hasAncestors()){var o=this._getLabelByName(e,t.getParent().getRawName(),!0);s=o?this._ensureVMLIsForLabel(e,o,a):this._ensureVMLIsForAccount(e,a)}else s=this._ensureVMLIsForAccount(e,a);n=a.createItem(i,r,s.id),s.insertSorted(n,this.sortFn)}return n}},{key:"getVMLIForAccount",value:function(e){return this._ensureVMLIsForAccount(e)}},{key:"getVMLIForLabel",value:function(e,t){return this._ensureVMLIsForLabel(e,t)}},{key:"getLabelForVMLI",value:function(e){var t,a=this.getDescriptorForItem(e);return a.accountID&&a.labelID&&(t=this._getLabelByID(a.accountID,a.labelID)),t}},{key:"_getAccountIDFromItem",value:function(e){var t,a=e.id;a.startsWith("R~")&&(a=a.substr(2)),a.startsWith("A~")?(t=a.substr(2)).startsWith("S~")&&(t=t.substr(2)):a.startsWith("L~")?t=a.substring(2,a.indexOf("~",2)):a.startsWith("T~")&&(t=a.substring(2,a.indexOf("~",2)));try{m.default.PAssert(1433,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(i){m.default.reportError(i)}return t}},{key:"_getLabelIDFromItem",value:function(e){var t,a=e.id;a.startsWith("L~")?t=a.substr(a.indexOf("~",2)+1):a.startsWith("T~")&&(t=a.substr(a.indexOf("~",2)+1));try{m.default.PAssert(1434,!t||m.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1435,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(i){m.default.reportError(i)}return t}},{key:"_getThreadIDFromItem",value:function(e){return this._getThreadID(e.id)}},{key:"_getThreadID",value:function(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{m.default.PAssert(1436,!t||m.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1437,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(a){m.default.reportError(a)}return t}},{key:"isAccountItem",value:function(e){return e.id.startsWith("A~")}},{key:"isLabelItem",value:function(e){return e.id.startsWith("L~")}},{key:"isThreadItem",value:function(e){return e.id.startsWith("T~")}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[v.a.GScope.GmailModify,v.a.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[v.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}},{key:"handleUnauthorized",value:function(e){0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"handleTapStart",value:function(){return!0}},{key:"handleTapClick",value:function(e,t,a,i){var n=i.target;try{m.default.PAssert(1438,t,"Gmail tapped but is not actually a pane",m.default.getElementPath(n))}catch(r){m.default.reportError(r)}if(t&&(x.a.mac&&i.metaKey||!x.a.mac&&i.ctrlKey||!this.isPluginPane(t)))return this.openEmailByItem(e,t)}},{key:"handleDoubleTap",value:function(e,t,a,i){return this.openEmailByItem(e,t),!0}},{key:"isMyAccountID",value:function(e){try{m.default.PAssert(1439,"me"!==e||m.default.isDemoMode(),"Should not be checking me")}catch(a){m.default.reportError(a)}var t=sr.settings.getUserIdentifier();try{m.default.PAssert(1440,m.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(a){m.default.reportError(a)}return e===t}},{key:"createURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=sr.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"#all/"+e.id}},{key:"createPrintURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=sr.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}},{key:"openEmailByItem",value:function(e,t,a){var i=this,n=e.getAttachmentByPlugin(v.a.PluginID.Gmail);if((n&&n!==sr.EmailPreview.getThreadAttach()||!sr.EmailPreview.isOpen()||a)&&this.getCacheData(n.id))return this.isAttachmentDraftOnly(n)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(n,function(){sr.menus.openComposeEmail(i,n.id)})):sr.EmailPreview.open(e,n,t,a),!0}},{key:"_convertRawMessage",value:function(e,t,a,i){var n={id:t,payload:a},r=this._getMessageFromAttachment(e,t);try{m.default.PAssert(1441,r,"Must be able to get message metadata")}catch(s){m.default.reportError(s)}n.labelIds=r.labelIds,n.messageID=r.messageID,n.snippet=r.snippet,n.internalDate=a.internalDate,i(n)}},{key:"getThreadData",value:function(e,t,a){var i=this;if(0!==e.getField("messages").length)return this._getThreadData(e,t,a);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,function(n,r){var s=!0;n?i._addRemoteEntry(e.getField("accountID"),n):r&&r.error&&r.error.code===v.a.HTTPStatusCode.NotFound&&(s=!1),s?i._getThreadData(e,t,a):t(!1,"The conversation that you requested no longer exists.")})}},{key:"_getThreadData",value:function(e,t,a){for(var i=0,n=e.getField("messages"),r=n.length,s=0,o=!1,l=!1,u={},d=function(){if(!l&&s===r&&o){var e=0;l=!0;for(var a={messages:[]},i=0,d=0;d<n.length;++d){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var c=u[n[d].id];c?a.messages.push(c):++i}try{m.default.PAssert(1442,a.messages.length+i===n.length,"Messages should always be found for thread")}catch(h){m.default.reportError(h)}0===n.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(a)}},c=function(e){e&&(u[e.id]=e),++s,d()},h=0;h<n.length;++h){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var f=n[h];this.getMessageData(e,f.id,c)}o=!0,setTimeout(d,0)}},{key:"getMessageData",value:function(e,t,a){var i=this;this._rawCache.getEntry(t).then(function(n){n?i._convertRawMessage(e,t,n,a):(m.default.log("Warning: Local message cache missing email display data: ",e.id,t),i._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,!0,a))})}},{key:"_handleThreadLoaded",value:function(e,t,a,i){var n=this._pendingThreadLoads[e];try{m.default.PAssert(1443,n,"Must always have a valid pending load when handling laod")}catch(o){m.default.reportError(o)}if(delete this._pendingThreadLoads[e],n)for(var r=0,s=0;s<n.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{n[s](t,a,i)}catch(l){m.default.reportError(l)}}}},{key:"loadThread",value:function(e,t){try{m.default.PAssert(1444,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(a){m.default.reportError(a)}this._loadThreadMutex++;e.getField("accountID");this._loadThread(e,t,8e3),this._loadThreadMutex--}},{key:"_loadThread",value:function(e,t,a){var i=this,n=this.isAttachmentDraftOnly(e),r=this._pendingThreadLoads[e.id];if(r)m.default.log("Duped pending thread load: ",e.id),r.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var s=0,o=e.getField("messages"),l=!1,u=!1,d=0,c=0,h=o.length,f=0,p=function(){l&&d===c&&(h===f&&(u=!0),i._handleThreadLoaded(e.id,!0,u))},g=function(){var t=wt()(St.a.mark(function t(a){var n;return St.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(c++,!a){t.next=9;break}return""===a.decoded&&(a.decoded=void 0),t.next=5,i._parseMailMessage(a);case 5:n=t.sent;try{m.default.PAssert(1445,n,"Must be able to parse message")}catch(s){m.default.reportError(s)}i._updateMessageData(e,n.id,n),u=!0;case 9:p();case 10:case"end":return t.stop()}}},t)}));return function(e){return t.apply(this,arguments)}}(),v=0;v<o.length;++v){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var y=o[v];void 0===y.decoded?(y.decoded="",d++,this.getMessageData(e,y.id,g)):(y.decoded||y.labelIds.indexOf(Et.DRAFT)>=0)&&f++}l=!0,p()}else if(n){var k=e.getField("messages")[0];this.getMessageData(e,k.id,function(){var t=wt()(St.a.mark(function t(a){var n;return St.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=6;break}return t.next=3,i._parseMailMessage(a);case 3:n=t.sent;try{m.default.PAssert(1446,n,"Must be able to parse message")}catch(s){m.default.reportError(s)}i._updateMessageData(e,n.id,n);case 6:u=!0,i._handleThreadLoaded(e.id,!0,u);case 8:case"end":return t.stop()}}},t)}));return function(e){return t.apply(this,arguments)}}())}else this.getThreadData(e,function(){var t=wt()(St.a.mark(function t(a,n){return St.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=3;break}return t.next=3,i._parseMailThread(e,a);case 3:u=!0,i._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),u,n);case 5:case"end":return t.stop()}}},t)}));return function(e,a){return t.apply(this,arguments)}}(),a)}},{key:"forceReloadMessage",value:function(e,t,a){this._requestRemoteMessageData(e,t,a)}},{key:"_verifyEmailAttachments",value:function(e,t,a){var i,n,r=this,s=this._findDraft(e,t,a);return s?m.default.forEachValue(s.resources,function(e){e.uploader&&(e.uploader.hasError()?i="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(i="One or more of your attachments is still uploading.",n=function(e){r.onEmailReadyToSend(s,function(){sr.toasts.clearMessage(e)})}))}):i="Could not find message to verify attachments.",i?{message:i,handleMessageFn:n}:void 0}},{key:"_verifyEmailRecipients",value:function(e,t,a){var i,n=this._findDraft(e,t,a);if(n)if(n.to&&0!==n.to.length)for(var r=0,s=0;s<n.to.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n.to[s];o&&o.email?m.default.isEmail(o.email)||(i="You have entered an invalid email"):i="You have entered a contact with an invalid email address"}else i="You must enter at least one person to send this email to";else i="Unable to find the message you are trying to send";return i?{message:i}:void 0}},{key:"_formatAddressText",value:function(e,t,a){return e?a?'"'+m.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}},{key:"_createAddressTextFromTokens",value:function(e,t){var a="";if(e)for(var i=0,n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e[n];m.default.isEmail(r.email)&&(0!==n&&(a+=", "),a+=this._formatAddressText(r.text,r.email,t))}try{m.default.PAssert(1447,!a.startsWith(","),"Should not start with a comma")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1448,!a.endsWith(","),"Should not end with a comma")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1449,a.indexOf(",,")<0,"Should not have two commas in a row")}catch(s){m.default.reportError(s)}return a.trim()}},{key:"_createRFC822Message",value:function(e,t,a,i){var n=this;try{m.default.PAssert(1450,t,"Must specify a valid draft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1451,t.contentType,"Must specify a valid content type for the draft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1452,t.from,"Must be able to get the from information for a user.")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1453,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(l){m.default.reportError(l)}try{m.default.PAssert(1454,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(l){m.default.reportError(l)}var r=t.from.text,s=t.from.email,o=new Nt(this);o.updateFromDraft(e,t,r,s,a,function(){var e=o.generateBlob();i(n._encodeEmail(e))})}},{key:"createSignature",value:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+m.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}},{key:"createForwardQuote",value:function(e){var t,a=m.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+m.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+m.default.escape(this._createAddressTextFromTokens(a))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}},{key:"createMessageBody",value:function(e,t,a){var i,n=this.createSignature(t);if(a===v.a.EmailResponseMode.Reply||a===v.a.EmailResponseMode.ReplyAll)i=this.createReplyQuote(e);else if(a===v.a.EmailResponseMode.Forward)i=this.createForwardQuote(e);else try{m.default.PAssert(1455,!1,"Invalid email response mode: "+a)}catch(r){m.default.reportError(r)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?n+i:i+n}},{key:"_sendEmail",value:function(e,t,a,i){var n=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var r=this._findDraft(e,t,a);this._createRFC822Message(e.getData(),r,!0,function(t){var a={raw:t};e.isLocalOnlyAttachment()||(a.threadId=e.id);var s=be.a.fns("gmail").users.messages.send.packedFn,o={userId:e.getField("accountID"),resource:a};n._queueRemoteRequestMulti(e.getField("accountID"),s,o,function(t){n._updateLocalDraftFromSend(e,r.id,t,i)},function(t){n._notifySendFailed(),i(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)},void 0,Jt)})}},{key:"_shouldSaveMessageContent",value:function(e,t){return t.labelIds.indexOf(Et.DRAFT)>=0}},{key:"compactCacheField",value:function(e,t){var a,i=0;switch(t){case"messages":a=[];for(var n=e[t],r={},s=function(e){var t=m.default.clone(e);delete t.data,delete t.size,delete t.uploader,r[e.id]=t},o=0;o<n.length;++o){var l=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var u=n[o],d={},c=0;c<va.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=u[va[c]];void 0!==h&&null!==h&&(d[va[c]]=u[va[c]])}this._shouldSaveMessageContent(e,u)||(delete d.decoded,delete d.mimeType,delete d.contentType,delete d.listUnsubscribe),m.default.forEachValue(d.resources,s),d.resources=r,a.push(d)}break;default:a=e[t]}return a}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,v.a.PluginAction.Gmail.DiscardDraft,{undo:m.default.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(e,t,a,i,n){try{m.default.PAssert(1456,e,"Must supply a valid action")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1457,m.default.isBoolean(t),"Invalid preventUndo param")}catch(l){m.default.reportError(l)}var r;this.beginAction(t);var s=[a,i,n];try{r=this._undoStack.runAction(this.id,e,s)}catch(u){m.default.reportError(u)}if(this._undoStack.isUndoableAction()){var o=[a];m.default.isArray(r)?o.pushArray(r):o.push(r),this._undoStack.performAction(this.id,e,{undoParams:o,redoParams:s})}this.endAction()}},{key:"performActions",value:function(e,t){var a=0;this.beginAction(t);for(var i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.performAction(e[i].action,!1,e[i].attach,e[i].param)}this.endAction()}},{key:"beginAction",value:function(e){this._undoStack.beginAction(e),F.d.beginAction()}},{key:"endAction",value:function(){this._undoStack.endAction(),F.d.endAction()}},{key:"handleUndo",value:function(){F.d.beginAction(),this._undoStack.undoAction(),F.d.endAction()}},{key:"handleRedo",value:function(){F.d.beginAction(),this._undoStack.redoAction(),F.d.endAction()}},{key:"supportUsageCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_matchParticipant",value:function(e,t){var a=!1;return e&&(e.text&&(a=e.text.toLowerCase().indexOf(t)>=0),!a&&e.email&&(a=e.email.toLowerCase().indexOf(t)>=0)),a}},{key:"_matchLabels",value:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)}},{key:"_matchEntry",value:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}},{key:"matchAttachment",value:function(e,t){return this._matchEntry(e.getData(),t)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(e,t){var a=this,i=e.toLowerCase();return this.findCachedItemsByFn(function(e){return a._matchEntry(e,i)},t)}},{key:"isGmailItem",value:function(e){return!!e.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabelByID(a,t)}},{key:"itemHasLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabel(a,t)}},{key:"itemHasFullLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasFullLabel(a,t)}},{key:"itemHasDraft",value:function(e){return this.itemHasLabelByID(e,Et.DRAFT)}},{key:"isItemUnread",value:function(e){return this.itemHasLabelByID(e,Et.UNREAD)}},{key:"isItemImportant",value:function(e){return this.itemHasLabelByID(e,Et.IMPORTANT)}},{key:"isItemStarred",value:function(e){return this.itemHasLabelByID(e,Et.STARRED)}},{key:"isItemArchived",value:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}},{key:"isItemTrashed",value:function(e){return this.itemHasLabelByID(e,Et.TRASH)}},{key:"isItemFullTrashed",value:function(e){return this.itemHasFullLabel(e,fa.TRASH)}},{key:"isItemSpam",value:function(e){return this.itemHasLabelByID(e,Et.SPAM)}},{key:"isDisplayItem",value:function(e,t){var a=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(a=!0),a}},{key:"getItemPriority",value:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(e){var t=0,a=e.getAttachmentByPlugin(this.id);if(a){var i=a.getField("lastModifiedDate");if(i)t=i.getTime();else{var n=a.getField("internalDate");n&&(t=n.getTime())}}return t}},{key:"_timeCompare",value:function(e,t){return e>t?1:e<t?-1:0}},{key:"threadSortFn",value:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"threadSortPriorityFn",value:function(e,t){var a=e.getAttachmentByPlugin(this.id),i=t.getAttachmentByPlugin(this.id),n=this.getAttachmentPriority(a),r=this.getAttachmentPriority(i),s=this.attachmentHasLabelByID(a,Et.STARRED),o=this.attachmentHasLabelByID(i,Et.STARRED);return n>r?-1:n<r?1:s&&!o?-1:o&&!s?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"labelSortFn",value:function(e,t){return e.displayCompare(t)}},{key:"labelVMLISortFn",value:function(e,t){var a=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e)),i=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(a,i)}},{key:"sortFn",value:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())}},{key:"getCssClass",value:function(e,t){if(t&&t.type===this.getPaneType())return m.default.classNames({starred:this.attachmentHasLabelByID(e,Et.STARRED)},{unread:this.attachmentHasLabelByID(e,Et.UNREAD)},{p0:this.attachmentHasLabel(e,ma.PRI0)},{p1:this.attachmentHasLabel(e,ma.PRI1)},{p2:this.attachmentHasLabel(e,ma.PRI2)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(e){var t=this;e.messages.forEach(function(a){a.cached?(t.reportTrackedStat(zt.SyncdMessage),t._numSyncdMessages++):a.cachedError?t.reportTrackedStat(zt.ErrorSyncdMessage):t._shouldCacheMessageData(e)?t._rawCache.getEntry(a.id).then(function(i){i||(t.reportTrackedStat(zt.UnsyncdMessage),t._notifyUnsyncdMessage(e.accountID,e.id,a.id))}):t.reportTrackedStat(zt.OldUnsyncdMessage)})}},{key:"_notifyUnsyncdMessage",value:function(e,t,a){m.default.isTempId(t)||m.default.isTempId(a)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,a),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(e,t,a){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,a)}},{key:"_handleSyncContentCacheOp",value:function(e,t,a,i){var n=this._ensureAccountLib(t,e);n[a]?!0!==n[a]&&n[a].indexOf(i)<0&&n[a].push(i):n[a]=!i||[i]}},{key:"_removeUnsyncdMessage",value:function(e,t,a){this.reportTrackedStat(zt.MessagesSyncd),this._numUnsyncdMessages--;var i=this._getAccountLib(e,this._unsyncdMessages);if(a){var n=i[t];n.remove(a),0===n.length&&delete i[t]}else delete i[t];m.default.isEmpty(i)&&this._deleteAccountLib(e,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(e,t,a){var i=this;if(this.hasCacheData(t))for(var n=0,r=this.getAttachment(t).getField("messages"),s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;(!0===a||a.indexOf(r[s].id)>=0)&&(r[s].cached=!0)}this._threadCache.getEntry(t,!0).then(function(e){if(e){for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=e.messages[r];(!0===a||a.indexOf(s.id)>=0)&&(s.cached=!0)}i.cacheThreadData(t,e)}})}},{key:"_updateCachedErrorFieldForMessage",value:function(e,t,a){var i=this;if(this.hasCacheData(t))for(var n=0,r=this.getAttachment(t).getField("messages"),s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;(!0===a||a.indexOf(r[s].id)>=0)&&(r[s].cachedError?r[s].cachedError++:r[s].cachedError=1)}this._threadCache.getEntry(t,!0).then(function(e){if(e){for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=e.messages[r];(!0===a||a.indexOf(s.id)>=0)&&(s.cached?s.cachedError++:s.cachedError=1)}i.cacheThreadData(t,e)}})}},{key:"_processSyncdContent",value:function(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];if(m.default.isArray(i)){for(var n=0,r=0;r<i.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[r];this._removeUnsyncdMessage(e,a,s)}this._setCachedFieldForMessage(e,a,i)}else!0===i&&this._removeUnsyncdMessage(e,a)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(e){for(var t in m.default.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var a=e[t];for(var i in a)if(a.hasOwnProperty(i)){var n=0,r=a[i];try{m.default.PAssert(1458,m.default.isArray(r),"Must have a valid message ID list")}catch(l){m.default.reportError(l)}for(var s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[s];this._removeUnsyncdMessage(t,i,o)}this._updateCachedErrorFieldForMessage(t,i,r)}}}},{key:"driveMessageContentSync",value:function(e){var t=this;if(sr.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0,this._runMessageContentSync(35,function(a,i){if(!a)try{t._processSyncErrors(i)}catch(n){m.default.reportError(n)}return t._processSyncdContent(),t._outstandingContentSync=!1,e(!m.default.isEmpty(t._unsyncdMessages))})}},{key:"_runMessageContentSync",value:function(e,t){var a=0,i=0,n=!1,r=0,s=0,o={},l=function(e,a,l){if(e?r++:(s++,o[a]=l),n&&r+s===i){var u=0===s;t(u,u?void 0:o)}},u=this.getSyncAccounts();for(var d in this._unsyncdMessages)if(u.indexOf(d)>=0&&(a+=this._syncMessageContentForAccount(d,this._unsyncdMessages[d],e-a,l),i++,a>=e))break;return n=!0,0===a&&setTimeout(function(){t(!0)},0),a}},{key:"_syncMessageContentForAccount",value:function(e,t,a,i){var n=0,r=0,s=0,o=0,l={},u=function(t,a,n){if(t?s++:(o++,l[a]=n),s+o===r){var u=0===o;i(u,e,u?void 0:l)}};for(var d in t)if(t.hasOwnProperty(d)&&(n+=this._syncMessageContentForThread(e,d,t[d],a-n,u),r++,n>=a))break;return n}},{key:"_syncMessageContentForThread",value:function(e,t,a,i,n){var r=this,s=0;if(m.default.isArray(a)){var o=!1,l=0,u=[],d=function(a,i){if(i?(l++,r._notifyContentCached(e,t,a)):u.push(a),o&&l+u.length===s){var d=0===u.length;n(d,t,d?void 0:u)}};a.forEach(function(a){s<i&&r._requestRemoteMessageDataRaw(e,t,a,!1,function(e,t){d(a,!!e)}),s++}),o=!0}else this._requestRemoteThreadDataRaw(e,t,function(a,i){a?r._handleContentSyncdThread(e,a,function(a){r._notifyContentCached(e,t),n(a,t)}):n(!1,t,!0)}),s++;return s}},{key:"_handleContentSyncdMessage",value:function(e,t,a,i){a.error||(a.internalDate=new Date(+a.internalDate),a.payload.id=a.id,a.payload.internalDate=a.internalDate,this._rawCache.saveEntry(a.payload)),i&&i(!0)}},{key:"_handleContentSyncdThread",value:function(e,t,a){for(var i=0,n=0;n<t.messages.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t.messages[n];this._handleContentSyncdMessage(e,t.id,r,a)}}},{key:"scheduleEmail",value:function(e,t){var a=this;F.d.beginAction();var i=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(1459,i,"Must be able to get a valid attachment from item")}catch(u){m.default.reportError(u)}var n=i.getField("subject"),r=this.createURLForThread(i),s=v.a.MSPerHour,o=sr.pluginManager.getPluginGCalendar();if(o){var l=o.getDefaultExportCalendarID();l&&(m.default.isDemoMode()||o.getSetting(o.Settings.WriteAccess))?o.createEventForEmail(l,n,r,t,s,function(e,t){e||t?t?(a.addLabelToAttachment(i,"Moo.do/Scheduled"),a.getSetting(a.Settings.ArchiveOnSchedule)&&a.archiveAttachment(i)):t||sr.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:v.a.MessageAction.Okay}):sr.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){sr.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:v.a.MessageAction.Okay})}})}):sr.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:v.a.MessageAction.OpenCalendarSettings})}else sr.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:v.a.MessageAction.OpenSettings});F.d.endAction()}},{key:"getIconInfoForLabel",value:function(e){var t,a;switch(e.getParsedText()){case"Inbox":a="inbox2",t=v.a.ColorBrand;break;case"Starred":a="star",t="#fd3";break;case"Important":a="exclamation",t="#d43";break;case"Sent Mail":a="send",t="#08c";break;case"Draft":a="drafts",t="#fafafa";break;case"Archived":a="mail";break;case"Trash":a="delete",t="#ff738c";break;case"Primary":a="user";break;case"Social":a="group";break;case"Promotions":a="tag";break;case"Updates":a="flag";break;case"Forums":a="question_answer";break;case"Chat":a="chat";break;case"Spam":a="warning";default:0}return{icon:a,color:t}}},{key:"archiveItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(1460,a,"Must be able to get a valid attachment")}catch(i){m.default.reportError(i)}!e&&this.isItemArchived(t)?this.performAction(v.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.isItemArchived(t)&&this.performAction(v.a.PluginAction.Gmail.Archive,!1,a)}},{key:"deleteItem",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(1461,a,"Must be able to get a valid attachment")}catch(i){m.default.reportError(i)}t&&t.isDraft()&&this.itemHasDraft(e)?this.performAction(v.a.PluginAction.Gmail.DiscardDraft,!0,a):t&&t.isTrash()&&this.isItemFullTrashed(e)?this.performAction(v.a.PluginAction.Gmail.Untrash,!1,a):this.isItemFullTrashed(e)||this.performAction(v.a.PluginAction.Gmail.Trash,!1,a)}},{key:"undeleteItem",value:function(e){var t=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(1462,t,"Must be able to get a valid attachment")}catch(a){m.default.reportError(a)}this.isItemFullTrashed(e)&&this.performAction(v.a.PluginAction.Gmail.Untrash,!1,t)}},{key:"removeItemFromLabel",value:function(e,t){var a=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(1463,a,"Must be able to get a valid attachment")}catch(i){m.default.reportError(i)}e&&(e.isCustom()?this.performAction(v.a.PluginAction.Gmail.RemoveLabel,!1,a,e.getName()):e.isInbox()?this.performAction(v.a.PluginAction.Gmail.Archive,!1,a):e.isArchived()?this.performAction(v.a.PluginAction.Gmail.Unarchive,!1,a):e.isStarred()&&this.performAction(v.a.PluginAction.Gmail.Unstar,!1,a))}},{key:"moveEmailToItem",value:function(e,t,a){this.beginAction(),a||(e=e.clone(t,v.a.ChangeType.Local));var i=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(1464,i,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}this.performAction(v.a.PluginAction.Gmail.Move,!1,i,e,t),this.getSetting(this.Settings.ArchiveOnOrganize)&&this.performAction(v.a.PluginAction.Gmail.Archive,!1,i),this.attachmentHasLabel(i,"Moo.do/Handled")||this.performAction(v.a.PluginAction.Gmail.AddLabel,!1,i,"Moo.do/Handled"),this.endAction()}},{key:"getLastMessage",value:function(e){var t=e.getField("messages")||[],a=t.length-1;return this.isMessageDraft(t[a])&&!this.getAttachField(e,"pendingSend")&&a--,t[a]}},{key:"sendEmail",value:function(){var e=wt()(St.a.mark(function e(t,a){var i=this;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){i.sendDraft(t,a.id,a.draftID,void 0,function(a,i){sr.EmailPreview.ensureDisplayMessages(t),a||(m.default.isHTTPStatusCode(i,v.a.HTTPStatusCode.Network)?sr.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:v.a.MessageAction.Okay,hold:!0}):i&&sr.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:v.a.MessageAction.Okay})),e(!!a)})||e(!1)}));case 1:case"end":return e.stop()}}},e)}));return function(t,a){return e.apply(this,arguments)}}()}]),t}(Le),D()(Dt.prototype,"onSyncAccountsChanged",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"onSyncAccountsChanged"),Dt.prototype),D()(Dt.prototype,"_notifyPendingDraftUpdate",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"_notifyPendingDraftUpdate"),Dt.prototype),D()(Dt.prototype,"runLabelSync",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"runLabelSync"),Dt.prototype),D()(Dt.prototype,"runThreadSync",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"runThreadSync"),Dt.prototype),D()(Dt.prototype,"compareCachedData",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"compareCachedData"),Dt.prototype),D()(Dt.prototype,"removeItemFromLabel",[C.a],Object.getOwnPropertyDescriptor(Dt.prototype,"removeItemFromLabel"),Dt.prototype),Dt),Qa=1,Ja=3,Za=4,$a=5,ei=6,ti=7,ai=8,ii=9,ni=10,ri=11,si=12,oi=13,li="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",ui=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.Moodo,"m","Moodo",!0))).setSetting(e.Settings.IsEnabled,!0,!1),e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.Unknown),e.useRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.Unknown),e}return g()(t,e),o()(t,[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"getRemoteAttachmentData",value:function(e){this.cacheData(e.id,{})}},{key:"runRemoteSingleRequest",value:function(e,t,a,i,n,r){var s=qe.a.getDefaultAccountID();this._queueRemoteRequestMulti(s,e,t,a,i,void 0,n||Qa,r)}},{key:"runRemotePagedRequest",value:function(e,t,a,i,n,r){n||(n={}),n.accountID=qe.a.getDefaultAccountID(),this._queuePagedRemoteRequest(e,t,a,i,void 0,r,n)}},{key:"drivePermissionsInsert",value:function(e,t,a,i,n){try{m.default.PAssert(623,m.default.isEmail(t),"Should pass in a valid email address")}catch(o){m.default.reportError(o)}var r=be.a.fns("drive").permissions.insert.packedFn,s={fileId:e,sendNotificationEmails:a,resource:{value:t,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(r,s,i,n,Ja)}},{key:"drivePermissionsDelete",value:function(e,t,a,i){var n=be.a.fns("drive").permissions.delete.packedFn,r={fileId:e,permissionId:t};this.runRemoteSingleRequest(n,r,a,i,Za)}},{key:"drivePermissionsList",value:function(e,t,a){var i=be.a.fns("drive").permissions.list.packedFn,n={fileId:e,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(i,n,t,a,$a)}},{key:"drivePermissionsPublic",value:function(e,t,a){var i=be.a.fns("drive").permissions.insert.packedFn,n={fileId:e,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(i,n,t,a,Ja)}},{key:"driveFilesGet",value:function(e,t,a,i){var n=be.a.fns("drive").files.get.packedFn,r={fileId:e,fields:li};i&&i.props&&Object.assign(r,i.props),this.runRemoteSingleRequest(n,r,t,a,ei)}},{key:"driveFilesExport",value:function(e,t,a,i){var n=be.a.fns("drive").files.export.packedFn,r={fileId:e,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(n,r,t,a,ei,i)}},{key:"realtimeFileGet",value:function(e,t,a,i){var n=be.a.fns("drive").realtime.get.packedFn,r={fileId:e};this.runRemoteSingleRequest(n,r,t,a,ei,i)}},{key:"driveFilesList",value:function(e,t,a,i){var n=be.a.fns("drive").files.list.packedFn,r={q:e,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};i&&i.props&&Object.assign(r,i.props),this.runRemotePagedRequest(n,r,t,a,i,ti)}},{key:"driveFilesTrash",value:function(e,t,a){var i=be.a.fns("drive").files.trash.packedFn,n={fileId:e};this.runRemoteSingleRequest(i,n,t,a,ai)}},{key:"driveFilesUntrash",value:function(e,t,a){var i=be.a.fns("drive").files.untrash.packedFn,n={fileId:e};this.runRemoteSingleRequest(i,n,t,a,ai)}},{key:"drivePropertiesInsert",value:function(e,t,a,i,n){var r=be.a.fns("drive").properties.insert.packedFn,s={fileId:e,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(r,s,i,n,ii)}},{key:"drivePropertiesUpdate",value:function(e,t,a,i,n){var r=be.a.fns("drive").properties.update.packedFn,s={fileId:e,propertyKey:t,resource:{key:t,value:a,visibility:"PRIVATE"}};this.runRemoteSingleRequest(r,s,i,n,ni)}},{key:"driveParentsInsert",value:function(e,t,a,i){var n=be.a.fns("drive").parents.insert.packedFn,r={fileId:e,resource:{id:t}};this.runRemoteSingleRequest(n,r,a,i,ri)}},{key:"driveParentsDelete",value:function(e,t,a,i){var n=be.a.fns("drive").parents.delete.packedFn,r={fileId:e,parentId:t};this.runRemoteSingleRequest(n,r,a,i,si)}},{key:"driveChildrenList",value:function(e,t,a,i){var n=be.a.fns("drive").children.list.packedFn,r={folderId:e,fields:"items(id),nextPageToken"};this.runRemotePagedRequest(n,r,t,a,i,oi)}}]),t}(Le),di=1,ci=4,hi=["description","end","start","status","summary","extendedProperties"],fi={SyncTokens:"syncTokens",CalendarList:"calendarList"},pi={IsComplete:"isComplete",Priority:"priority",IsStarred:"isStarred",IsArchived:"isArchived"},gi=["modifiedOffline"],mi=2,vi=3,yi=4,ki=6,_i=7,Si=8,Pi=9,wi=10,Ii=11,bi=12,Di=13,Ei=14,Ci=v.a.DefaultEventDuration,Ai=(xa=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this,v.a.PluginID.GCalendar,"c","Calendar",!1))).pluginMargin=4,e.pluginPadding=14,e._requiresOfflineAuth=!0,e.supportSyncAccounts=!0,e._numEntriesSyncd=0,e._calendarList={},e.registerSetting("WriteAccess","writeAccess","w",!0,!0),e.registerSetting("ImportCalendars","importCalendars","i",!0),e.registerSetting("ExportCalendar","exportCalendar","x",!0),e.registerSetting("WeeksPast","weeksPast","p",!0,di),e.registerSetting("WeeksFuture","weeksFuture","f",!0,ci),e.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),e.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),e.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),e.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),e._updateSyncTimes(),e.onCalendarsSynced=new W.a,e._eventCache=e.registerLocalCache(e.id,v.a.StorageType.IndexedDB,{metadataKeys:[fi.SyncTokens,fi.CalendarList],keyFieldsRN:["startTime","calendarID","modifiedOffline"]}),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._purgeOldData),e.declareProperty("isInvalid",v.a.PluginLoad.Runtime,!0,!1),m.default.isDemoMode()?e.declareProperty("calendarID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline,!0,"me"):e.declareProperty("calendarID",v.a.PluginLoad.Preview|v.a.PluginLoad.Full|v.a.PluginLoad.Inline),e.declareProperty("summary",v.a.PluginLoad.Preview|v.a.PluginLoad.Full),e.declareProperty("status",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,"confirmed"),e.declareProperty("startTime",v.a.PluginLoad.Preview|v.a.PluginLoad.Full),e.declareProperty("endTime",v.a.PluginLoad.Preview|v.a.PluginLoad.Full),e.declareProperty("allDayEvent",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("recurringEventId",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0),e.declareProperty("eid",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0),e.declareProperty("isComplete",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("isArchived",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("isStarred",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("priority",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,v.a.VMLIFlag.None),e.declareProperty("locked",v.a.PluginLoad.Preview|v.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedOffline",v.a.PluginLoad.Full,!0,!1),e.declareProperty("source",v.a.PluginLoad.Full,!0),e.declareProperty("location",v.a.PluginLoad.Full,!0),e.declareProperty("description",v.a.PluginLoad.Full,!0),e.declareProperty("attendees",v.a.PluginLoad.Full,!0),e.declareProperty("organizer",v.a.PluginLoad.Full,!0),e.useRenderer(v.a.PluginRenderTypes.StyledText,v.a.PluginRenderers.CalendarEvent),e.useRenderer(v.a.PluginRenderTypes.UnstyledText,v.a.PluginRenderers.CalendarEvent),e.useRenderer(v.a.PluginRenderTypes.Measure,v.a.PluginRenderers.CalendarEvent),e._pendingCreates={},e._syncingOfflineChanges=!1,e._hasInitializedTasks=!1,e._purgeOldDataTimeout=void 0,e._eventUpdateTimeout=void 0,e._eventUpdateQueue={},e._propConverter={},e._propConverter[pi.IsComplete]=m.default.parseDate,e._propConverter[pi.IsArchived]=m.default.parseBoolean,e._propConverter[pi.IsStarred]=m.default.parseBoolean,e._propConverter[pi.Priority]=e.parsePriority,sr.settings.syncAccounts.listen(e.onSyncAccountsChanged),e}return g()(t,e),o()(t,[{key:"getType",value:function(){return v.a.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return gi}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:v.a.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportUsageCache",value:function(){return!0}},{key:"googleScopes",value:function(){return this.getSetting(this.Settings.WriteAccess)?[v.a.GScope.Calendar]:[v.a.GScope.CalendarRO]}},{key:"getDependencies",value:function(){return[v.a.PluginDependency.PremiumSub,v.a.PluginDependency.GoogleLogin]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(e){var t=this.googleScopes();return ye.a.isAuthorizedForScopes(e,t)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}},{key:"_serializeDate",value:function(e){return e instanceof Date?e.toISOString():m.default.isNumber(e)?new Date(e).toISOString():e}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"startTime":case"endTime":a=this._serializeDate(e[t]);break;default:a=e[t]}return a}},{key:"_updateSyncTimes",value:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||di),t=this.getSetting(this.Settings.WeeksFuture)||ci;try{m.default.PAssert(700,m.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(n){m.default.reportError(n)}try{m.default.PAssert(701,m.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(n){m.default.reportError(n)}var a=Math.min(-7,e),i=Math.max(20,t);this._minSyncStartTime=(new Date).clearTime().addWeeks(a),this._maxSyncStartTime=(new Date).clearTime().addWeeks(i),this._syncTokenDuration=m.default.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(e),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(t);try{m.default.PAssert(702,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(n){m.default.reportError(n)}}},{key:"_shouldDisplayTime",value:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(e,t,a){return function(i){var n=new Date(i[e]);return n>=t&&n<=a}}},{key:"_purgeOldData",value:function(e){var t=this,a=new Date(0),i=this._minDisplayStartTime.clone().addDays(-1),n=function(e){var t=new Date(e.startTime);return t>=a&&t<=i};this._eventCache.getFilterEntries(n).then(function(a){if(a){var i=0;m.default.log("Removing "+a.length+" old calendar entries.");for(var n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t._eventCache.removeEntry(a[n].id)}}e&&e(!1)})}},{key:"_offlineLoad",value:function(){var e,t=this;if(this.isEnabled()){var a=this._eventCache.getMetadata(fi.CalendarList);m.default.isEmpty(this._calendarList)&&(this._calendarList=a||{});var i=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime),n=this._eventCache.getPreloadData();if(n){try{m.default.PAssert(704,m.default.isObject(n),"Calendar preload is not object")}catch(r){m.default.reportError(r)}e=n,m.default.batchRenderUpdates(function(){sr.PaneUpdateBatcher.beginUpdateItems();var a=t.getDefaultItemStore(),n=a.getRoot();Object.keys(e).forEach(function(s){var o=e[s];if(i(o)){var l=t.createEntryFromLocal(o.id,o);t.cacheData(l.id,l,void 0,void 0,v.a.ChangeType.Auto);try{m.default.PAssert(703,!a.hasItem(l.id),"Load should never try to create a VMLI that has already been created")}catch(r){m.default.reportError(r)}if(t._eventNeedsItem(l)){if(l.source){var u=sr.pluginManager.parseEmailURL(l.source.url);if(u.plugin&&!u.plugin.hasCacheData(u.threadID)){var d=u.plugin.createEntryFromLocal(u.threadID,{accountID:u.accountID,subject:l.source.title});u.plugin.cacheData(u.threadID,d)}}var c=t._createItem(a,l,n.id);n.insertItem(c)}}}),sr.PaneUpdateBatcher.commitUpdateItems(),t._cacheCleanup.notifyWorkAvailable()})}return!0}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){sr.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,sr.PaneUpdateBatcher.updateAllItems(!0,!0),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!m.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:m.default.hours(2),minDelay:m.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapStart",value:function(e,t,a,i){return!0}},{key:"handleTapClick",value:function(e,t,a,i){var n=this.getCacheData(a);if(n){var r=this.getAttachment(a).getField("calendarID"),s=this._getCalendarInfo(r);if(s)try{m.default.PAssert(705,s.accountID,"Should have an accountID on the calendar")}catch(l){m.default.reportError(l)}if(n.eid&&s.accountID){var o="https://www.google.com/calendar/event?eid="+n.eid+"&authuser="+s.accountID;m.default.isDemoMode()?sr.toasts.pushMessage(v.a.MessageID.DemoPluginClick):(m.default.openUrl(o,i),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(e){var t=Math.round(e/6e4),a=0,i=0;t>0&&(t-=60*(a=Math.floor(t/60)),a>0&&(a-=24*(i=Math.floor(a/24))));var n="";return i>0&&(n+=i+"d "),a>0&&(n+=a+"h "),t>0&&(n+=t+"m "),n.trim()}},{key:"_createItemDateText",value:function(e){return e.allDayEvent?e.startTime.toString(sr.International.getFormat(v.a.DFormat.MonthDayYear)):e.startTime.toString(sr.International.getFormat(v.a.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(e){var t,a=e.endTime-e.startTime;if(e.allDayEvent)if(a>m.default.days(1)){var i=e.endTime.clone();i.addMilliseconds(-1),t="until "+i.toString(sr.International.getFormat(v.a.DFormat.MonthDayYear))}else t="";else t=this._durationToString(a);return t}},{key:"_createItemSummaryText",value:function(e){var t;if(e.source&&e.source.url){var a=sr.pluginManager.parseEmailURL(e.source.url);a.plugin&&(t=a.plugin._getTextForItem({id:a.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t}},{key:"_createItemText",value:function(e){try{m.default.PAssert(706,e,"Must specify a valid attachment")}catch(t){m.default.reportError(t)}return this._createItemSummaryText(e)}},{key:"_eventNeedsItem",value:function(e){return"cancelled"!==e.status&&!e.isArchived}},{key:"_createItem",value:function(e,t,a){var i;try{m.default.PAssert(707,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(l){m.default.reportError(l)}m.default.isDateValid(t.isComplete)&&(i=t.isComplete);var n=!t.allDayEvent&&t.endTime-t.startTime||void 0,r={date:new j.a(new Date(t.startTime.getTime()),{gcalId:t.id,duration:n,gcalCalendar:t.calendarID}).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:i,isStarred:t.isStarred},s=e.createItem(t.id,this._createItemText(t),a,r,v.a.ChangeType.Auto);if(t.description){var o=e.createItem(t.id+"_note",t.description,s.id,{isNote:!0},v.a.ChangeType.Auto);s.setNote(o,v.a.ChangeType.Auto)}return s}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(e.hasField("calendarID")){var a=e.getField("calendarID"),i=this._getCalendarInfo(a);if(i)try{m.default.PAssert(709,i.accountID,"Should have an accountID on the calendar")}catch(s){m.default.reportError(s)}var n=be.a.fns("calendar").events.get.packedFn,r={eventId:e.id,calendarId:a};i&&this._queueRemoteRequestMulti(i.accountID,n,r,function(i){try{m.default.PAssert(710,!i||i.id===e.id,"If valid result, attachment should match remote event ID")}catch(s){m.default.reportError(s)}if(i){var n=t._addRemoteEntry(a,i);t._eventCache.saveEntry(t.serializeExternalData(n))}},function(){e.notifyDataRequestFailed()},e,ki)}else sr.settings.fixedMissingCalendars.get()?e.isLoaded()&&e.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(e),m.default.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,function(){return t.needsFixMissingData=void 0},this.needsFixMissingData))}},{key:"_createRemoteEntry",value:function(e,t){var a,i,n,r=!1;try{m.default.PAssert(711,t.start,"Must always have valid start data")}catch(u){m.default.reportError(u)}if(t.start.dateTime){try{m.default.PAssert(712,t.end.dateTime,"End date format should always match start")}catch(u){m.default.reportError(u)}a=new Date(t.start.dateTime),i=new Date(t.end.dateTime)}else if(t.start.date){try{m.default.PAssert(713,t.end.date,"End date format should always match start")}catch(u){m.default.reportError(u)}var s=t.start.date.split("-"),o=t.end.date.split("-");a=new Date(s[0],s[1]-1,s[2]),i=new Date(o[0],o[1]-1,o[2]),r=!0}t.htmlLink&&(n=t.htmlLink.split("?eid=")[1]);var l={id:t.id,calendarID:e,status:t.status,summary:t.summary,startTime:a,endTime:i,allDayEvent:r,recurringEventId:t.recurringEventId,eid:n,isComplete:this._getRemoteProperty(t,pi.IsComplete),isArchived:this._getRemoteProperty(t,pi.IsArchived),isStarred:this._getRemoteProperty(t,pi.IsStarred),priority:this._getRemoteProperty(t,pi.Priority),locked:t.locked||!1,attendees:t.attendees,location:t.location,description:t.description,organizer:t.organizer?t.organizer.displayName||t.organizer.email||t.organizer.id:"Unknown"};return t.source&&(l.source={title:t.source.title,url:t.source.url}),l}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);return this.cacheData(a.id,a),a}},{key:"createEntryFromLocal",value:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[pi.IsComplete](t.isComplete),t.isArchived=this._propConverter[pi.IsArchived](t.isArchived),t.isStarred=this._propConverter[pi.IsStarred](t.isStarred),t.priority=this._propConverter[pi.Priority](t.priority),t}},{key:"_notifyFailedRequest",value:function(e,t){e&&e.error&&(e.error.code===v.a.HTTPStatusCode.Unauthorized?sr.toasts.pushMessage(v.a.MessageID.LostPermission):e.error.code>=400&&e.error.code<500&&m.default.reportError(new Error("Failed GCalendar request: "+e.error.code),e))}},{key:"_getRemoteProperty",value:function(e,t){try{m.default.PAssert(714,e,"Must provide valid event info")}catch(i){m.default.reportError(i)}try{m.default.PAssert(715,t,"Must provide valid remote prop")}catch(i){m.default.reportError(i)}try{m.default.PAssert(716,this._propConverter[t],"Missing prop converter: ",t)}catch(i){m.default.reportError(i)}var a;return e.extendedProperties&&e.extendedProperties.private&&(a=e.extendedProperties.private["MDCProp_"+t]),this._propConverter[t]&&(a=this._propConverter[t](a)),a}},{key:"_updateAttachFromData",value:function(e,t){var a=[];for(var i in t)t.hasOwnProperty(i)&&e.isFieldDefined(i)&&(e.updateField(i,t[i]),a.push(i));return a}},{key:"_runRemoteUpdate",value:function(e,t,a,i,n,r){var s,o,l,u,d=this,c=arguments;try{m.default.PAssert(717,this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission")}catch(p){m.default.reportError(p)}try{m.default.PAssert(718,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(p){m.default.reportError(p)}try{m.default.PAssert(719,m.default.isBoolean(t)||m.default.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(p){m.default.reportError(p)}try{m.default.PAssert(720,m.default.isFunction(i),"Must provide a valid localDoneCB")}catch(p){m.default.reportError(p)}try{m.default.PAssert(721,m.default.isFunction(n),"Must provide a valid remoteDoneCB")}catch(p){m.default.reportError(p)}try{m.default.PAssert(722,m.default.isFunction(r),"Must provide a valid allDoneCB")}catch(p){m.default.reportError(p)}var h=function(e,t,a){try{m.default.PAssert(723,m.default.isFunction(e),"Must supply a valid CB function")}catch(p){m.default.reportError(p)}try{m.default.PAssert(724,void 0!==t,"Must always pass success back from CB")}catch(p){m.default.reportError(p)}if(e.apply(d,Array.prototype.slice.call(c,1)),e===i){try{m.default.PAssert(725,void 0===s,"Local CB called twice")}catch(p){m.default.reportError(p)}s=t,l=a}else if(e===n){try{m.default.PAssert(726,void 0===o,"Remote CB called twice")}catch(p){m.default.reportError(p)}o=t,u=a}void 0!==s&&void 0!==o&&r(s,o,l,u)},f=this.getCacheData(e.id);try{m.default.PAssert(727,f,"Performing update on event that does not have local data")}catch(p){m.default.reportError(p)}f?(this.addModifiedOffline(f,t),this._eventCache.saveEntry(this.serializeExternalData(f)),a(function(a,r){if(a){var s=d.getCacheData(e.id),o=!0!==t&&t;d.removeModifiedOffline(s,o),d._eventCache.saveEntry(d.serializeExternalData(s)),h(n,!0)}else h(i,!1),h(n,!1,r)})):(h(i,!1),h(n,!1))}},{key:"_updateEvent",value:function(e,t,a,i,n,r){var s=this,o=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,o,function(i){s._updateRemoteEvent(e.getField("calendarID"),e.id,t,a,i)},i,n,r)}},{key:"_updateRemoteEvent",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(728,this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission")}catch(d){m.default.reportError(d)}try{m.default.PAssert(729,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(d){m.default.reportError(d)}var s=this._createEventUpdateInfo(a),o=this._getCalendarInfo(e);try{m.default.PAssert(730,o,"Missing calendar "+e)}catch(d){m.default.reportError(d)}if(o){try{m.default.PAssert(731,o.accountID,"Should have an accountID on the calendar")}catch(d){m.default.reportError(d)}var l=be.a.fns("calendar").events.patch.packedFn,u={calendarId:e,eventId:t,resource:s};this._queueRemoteRequestMulti(o.accountID,l,u,function(){n(!0)},function(a){if(a&&a.error&&a.error.code===v.a.HTTPStatusCode.NotFound)r._eventCache.removeEntry(t),n(!0);else{var i=Object.keys(s);if(m.default.log("Failed Update: ",e,t,i),m.default.isHTTPStatusCode(a,v.a.HTTPStatusCode.Forbidden)&&!r.isRateLimitError(a)){var o=r.getCacheData(t);o&&(o.locked=!0),r.cacheData(t,o,!0,["locked"])}n(!1,a),r._notifyFailedRequest(a,e)}},void 0,Si||i)}}},{key:"_updateRemoteProperty",value:function(e,t,a,i,n,r){var s=this;e.updateField(t,a);var o={},l=void 0===a?null:a;o["MDCProp_"+t]=l;var u={extendedProperties:{private:o}};this._runRemoteUpdate(e,[t],function(t){s._updateRemoteEvent(e.getField("calendarID"),e.id,u,vi,t)},i,n,r)}},{key:"_getStartEndFromDateInfo",value:function(e,t){var a,i,n,r=!1;if(e instanceof Date)e.hasTimeOfDay()||(r=!0),a=e,i=e.clone().addMilliseconds(t);else if(e instanceof j.a)a=e.getStart(),i=e.getEnd(),n=e.toICal();else try{m.default.PAssert(732,!1,"Should always have a valid date")}catch(s){m.default.reportError(s)}return{startTime:a,endTime:i,allDayEvent:r,recurrence:n}}},{key:"deleteCalendarEventForItem",value:function(e,t,a,i,n){var r=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],function(a){e.getMooDate().removeGCal(),e.onMooDateUpdated(v.a.ChangeType.Local,!0),e.onAttachInlineUpdate(),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),a(!0)):r.deleteCalendarEvent(t,a)},a,i,n)}},{key:"deleteCalendarEvent",value:function(e,t){var a=this;try{m.default.PAssert(733,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(l){m.default.reportError(l)}var i=e.getField("calendarID"),n=this._getCalendarInfo(i);try{m.default.PAssert(734,i&&n,"Tried to delete calendar event with no calendar")}catch(l){m.default.reportError(l)}if(n){try{m.default.PAssert(735,n.accountID,"Should have an accountID on the calendar")}catch(l){m.default.reportError(l)}var r=be.a.fns("calendar").events.delete.packedFn,s={calendarId:i,eventId:e.id},o=function(){var i=a.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(i,function(e){e.parent()&&(e.parent().removeChild(e),e.setParent(void 0))}),a._eventCache.saveEntry(a.serializeExternalData(e.getData())),t(!0)};this._queueRemoteRequestMulti(n.accountID,r,s,function(){o()},function(i){i&&i.error&&i.error.code===v.a.HTTPStatusCode.Gone?o():i&&i.error&&i.error.code===v.a.HTTPStatusCode.NotFound?o():(t(!1,i),a._notifyFailedRequest(i,e.getField("calendarID")))},void 0,wi)}else t(!0)}},{key:"forceRemoteEventSync",value:function(){if(!m.default.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return m.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(e){return this.getSetting(this.Settings.ExportCalendar)===e}},{key:"hasWritePermissionForAttach",value:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=e.getField("calendarID"),i=this._getCalendarInfo(a);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(t=!0))}return t}},{key:"hasWritePermissionForCalendar",value:function(e){var t=!1;if(this.getSetting(this.Settings.WriteAccess)){var a=this._getCalendarInfo(e);a&&("writer"!==a.accessRole&&"owner"!==a.accessRole||(t=!0))}return t}},{key:"getCalendarBackgroundColor",value:function(e){var t="rgba(0, 120, 255, 0.85)",a=this._getCalendarInfo(e);return a&&a.backgroundColor&&(t=a.backgroundColor),t}},{key:"getCalendarForegroundColor",value:function(e){var t="#000000",a=this._getCalendarInfo(e);return a&&a.foregroundColor&&(t=a.foregroundColor),t}},{key:"getCalendarDisplayProps",value:function(e){var t,a=this._getCalendarInfo(e);return a&&"reader"===a.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(e,t,a,i,n,r){var s=this;try{m.default.PAssert(736,m.default.isString(e),"Must provide a valid calendarID for email")}catch(l){m.default.reportError(l)}try{m.default.PAssert(737,m.default.isString(t),"Must provide a valid subject")}catch(l){m.default.reportError(l)}try{m.default.PAssert(738,m.default.isString(a),"Must provide a valid email url")}catch(l){m.default.reportError(l)}try{m.default.PAssert(739,m.default.isDateValid(i),"Must provide a valid schedule date")}catch(l){m.default.reportError(l)}try{m.default.PAssert(740,m.default.isNumber(n),"Must provide a valid event duration")}catch(l){m.default.reportError(l)}this.sendEvent("AddEmailEvent");var o={duration:n,summary:t,date:i,source:{title:t,url:a}};this.createNewCalendarEvent(e,o,function(e){if(e){var t=s.getDefaultItemStore();if(!t.hasItem(e.id)){sr.PaneUpdateBatcher.beginUpdateItems();var a=t.getRoot(),i=s._createItem(t,e,a.id);a.insertItem(i),sr.PaneUpdateBatcher.commitUpdateItems()}}},m.default.newEmptyFn(),r)}},{key:"createEventForItem",value:function(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,function(t,a,i,n){t||a?a?F.d.miscAction({type:F.b.Misc,misc:F.a.AddToGCal,data:{item:e}}):n&&n.error&&-1===n.error.code?F.d.miscAction({type:F.b.Misc,misc:F.a.AddToGCal,data:{item:e}}):sr.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:v.a.MessageAction.Okay}):i&&!1===i.isValid?sr.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:v.a.MessageAction.Okay}):sr.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:v.a.MessageAction.OpenCalendarSettings})})):(this.sendEvent("AddRepeatEvent"),sr.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:v.a.MessageAction.Okay})):sr.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:v.a.MessageAction.OpenCalendarSettings}))}},{key:"newCalendarEventForItem",value:function(e,t,a){var i=this;try{m.default.PAssert(741,t,"Must provide a valid item")}catch(o){m.default.reportError(o)}try{m.default.PAssert(742,t.getNextDate(),"Item must have a valid date")}catch(o){m.default.reportError(o)}try{m.default.PAssert(743,!t.hasPluginAttachment(v.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(o){m.default.reportError(o)}var n=t.getDuration();n||(n=t.allDayDate()?m.default.days(1):Ci);var r={duration:n,summary:t.getCalendarParsedText()};if(t.getDate()&&(r.date=t.getDate()),t.hasNote()&&(r.description=t.getNote().getParsedText()),t.hasAttachmentType(v.a.PluginType.Email)){var s=t.getAttachmentByType(v.a.PluginType.Email);r.source={title:s.getField("subject"),url:s.getPlugin().createURLForThread(s)}}this.createNewCalendarEvent(e,r,function(e){if(e)if(t.isDestroyed()){var a=i.getDefaultItemStore();if(!a.hasItem(e.id)){sr.PaneUpdateBatcher.beginUpdateItems();var n=a.getRoot(),r=i._createItem(a,e,n.id);n.insertItem(r),sr.PaneUpdateBatcher.commitUpdateItems()}}else t.getMooDate().setGCalIdAndCalendar(e.id,e.calendarID),t.onMooDateUpdated(v.a.ChangeType.Local,!0),t.setTextToWhatItAlreadyIs(v.a.ChangeType.Local)},m.default.newEmptyFn(),a)}},{key:"createNewCalendarEvent",value:function(e,t,a,i,n){var r=this;try{m.default.PAssert(745,t,"Must have valid event info passed in")}catch(c){m.default.reportError(c)}try{m.default.PAssert(746,t.date,"Must have valid date for event")}catch(c){m.default.reportError(c)}try{m.default.PAssert(747,void 0!==t.duration,"Must have a valid event duration")}catch(c){m.default.reportError(c)}try{m.default.PAssert(748,t.summary,"Must have a valid event summary")}catch(c){m.default.reportError(c)}try{m.default.PAssert(749,m.default.isFunction(a),"Must supply a valid local done CB")}catch(c){m.default.reportError(c)}try{m.default.PAssert(750,m.default.isFunction(i),"Must supply a valid remote done CB")}catch(c){m.default.reportError(c)}var s=m.default.generateTempId(),o=this._getStartEndFromDateInfo(t.date,t.duration),l=this._getCalendarInfo(e);if(l){try{m.default.PAssert(751,l.accountID,"Should have an accountID on the calendar")}catch(c){m.default.reportError(c)}var u={id:s,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:o.startTime,endTime:o.endTime,allDayEvent:o.allDayEvent,recurrence:o.recurrence,organizer:l.accountID,modifiedOffline:!0};this.cacheData(s,u),this._eventCache.saveEntry(u),a(u,!0);var d=this.getAttachment(u.id);m.default.isDemoMode()?(i(!0),n(!0,!0)):this._runRemoteUpdate(d,!0,function(t){r._createRemoteEventFromCacheData(e,u,m.default.newEmptyFn(),t,n)},m.default.newEmptyFn(),i,function(){r.getDefaultItemStore().updateItems()})}}},{key:"_createRemoteEventFromCacheData",value:function(e,t,a,i,n){var r,s,o,l,u=this,d=arguments;try{m.default.PAssert(752,!this._pendingCreates[t.id],"Should never try and double create a calendar event")}catch(h){m.default.reportError(h)}this._pendingCreates[t.id]=!0;var c=function(e,t,c){try{m.default.PAssert(753,m.default.isFunction(e),"Must supply a valid CB function")}catch(h){m.default.reportError(h)}try{m.default.PAssert(754,void 0!==t,"Must always pass success back from CB")}catch(h){m.default.reportError(h)}if(e.apply(u,Array.prototype.slice.call(d,1)),e===a){try{m.default.PAssert(755,void 0===r,"Local CB called twice")}catch(h){m.default.reportError(h)}r=t,o=c}else if(e===i){try{m.default.PAssert(756,void 0===s,"Remote CB called twice")}catch(h){m.default.reportError(h)}s=t,l=c}void 0!==r&&void 0!==s&&n(r,s,o,l)};this._createNewRemoteEvent(e,t,function(n,r){delete u._pendingCreates[t.id],sr.PaneUpdateBatcher.beginUpdateItems();var s=u.getAttachment(t.id);if(n){var o=t.id;u.changeID(s,s.id,n.id);var l=u.getDefaultItemStore(),d=l.getRoot();l.hasItem(o)&&l.destroyItem(o),u._eventCache.removeEntry(o);var h=u._addRemoteEntry(e,n),f=u._createItem(l,h,d.id);d.insertItem(f),u._eventCache.saveEntry(u.serializeExternalData(h)),c(a,!0),s.updateField("isInvalid",!1),c(i,!0)}else s.updateField("isInvalid",!0),c(a,!1),c(i,!1,r);sr.PaneUpdateBatcher.commitUpdateItems()})}},{key:"_createNewRemoteEvent",value:function(e,t,a){var i=this;try{m.default.PAssert(757,t,"Must specify valid event info")}catch(u){m.default.reportError(u)}try{m.default.PAssert(758,t.startTime instanceof Date,"Must have a valid start time")}catch(u){m.default.reportError(u)}try{m.default.PAssert(759,t.endTime instanceof Date,"Must have a valid end time")}catch(u){m.default.reportError(u)}try{m.default.PAssert(760,t.summary,"Must have a valid event title")}catch(u){m.default.reportError(u)}var n,r,s=this._getCalendarInfo(e);try{m.default.PAssert(761,s.accountID,"Should have an accountID on the calendar")}catch(u){m.default.reportError(u)}t.allDayEvent?(n={date:t.startTime.toString("yyyy-MM-dd")},r={date:t.endTime.toString("yyyy-MM-dd")}):(n={dateTime:t.startTime.toISOString()},r={dateTime:t.endTime.toISOString()});var o=be.a.fns("calendar").events.insert.packedFn,l={calendarId:e,resource:{start:n,end:r,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(s.accountID,o,l,function(e){a(e)},function(t){a(void 0,t),i._notifyFailedRequest(t,e)},void 0,_i)}},{key:"getImportCalendarList",value:function(){var e=this,t=this.getSetting(this.Settings.ImportCalendars);if(t)return t.filter(function(t){return e.hasSyncAccount(t.accountID,!0)})}},{key:"getReadableCalendarList",value:function(e){return this._getCalendarList("reader",e)}},{key:"getWritableCalendarList",value:function(e){return this._getCalendarList("writer",e)}},{key:"getWritableCalendarListSync",value:function(e){var t=this.getImportCalendarList();if(t)return t.filter(function(t){return(!e||t.accountID===e||!t.accountID&&e===sr.settings.getUserIdentifier())&&("writer"===t.accessRole||"owner"===t.accessRole)})}},{key:"getFullCalendarList",value:function(e){var t=this,a=this.getImportCalendarList();this.getReadableCalendarList(function(i){if(a&&i){var n=a.map(function(e){if(!m.default.isObject(e))return{id:e,accessRole:"none"};var t=m.default.clone(e);return t.accessRole="none",t}).filter(function(e){if(t.hasSyncAccount(e.accountID)){for(var a=0,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i[n].id===e.id)return!1}return!0}});i.pushArray(n)}e(i)})}},{key:"createCalendar",value:function(e,t,a){var i=this,n=be.a.fns("calendar").calendars.insert.packedFn,r={resource:{summary:t}};this._queueRemoteRequestMulti(e,n,r,function(e){a(e)},function(e){a(),i._notifyFailedRequest(e,void 0)},void 0,Ii,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(e,t){var a=this.getSyncAccounts(!0),i=a.length,n=[],r=function(e){i--,e&&(n=m.default.arrayUniques(n.concat(e))),0===i&&t(n)};if(0===a.length)t([]);else for(var s=0,o=0;o<a.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;this._getCalendarListForAccount(a[o],e,r)}}},{key:"_getCalendarListForAccount",value:function(e,t,a){var i=this,n=be.a.fns("calendar").calendarList.list.packedFn,r={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,n,r,function(t){t=t.map(function(t){return t.accountID=e,t}),a(t)},function(e){a(),i._notifyFailedRequest(e,void 0)},void 0,yi,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(e,t){this._numEntriesSyncd++;var a=this.getDefaultItemStore();if("cancelled"===t.status){if(this.hasAttachment(t.id)){var i=this.getAttachment(t.id);i.getField("calendarID")===e&&(this._eventCache.removeEntry(t.id),this.hasCacheData(t.id)&&(i.updateField("status","cancelled"),i.forEachItem(a,function(e){e.parent()&&(e.parent().removeChild(e,v.a.ChangeType.Remote),e.setParent(void 0))})))}}else{var n=this.getCacheData(t.id),r=this._createRemoteEntry(e,t);n&&n.modifiedOffline&&this._mergeEventData(n,r),this.cacheData(r.id,r),this._eventCache.saveEntry(this.serializeExternalData(r));var s=a.getRoot(),o=this.getAttachment(t.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(o,n,r)}catch(u){m.default.reportError(u)}if(this._endIgnorePropertyChanges(),!a.hasItem(r.id)&&this._shouldDisplayTime(r.startTime,r.endTime)&&this._eventNeedsItem(r)){var l=this._createItem(a,r,s.id);s.insertItem(l)}}}},{key:"_mergeEventData",value:function(e,t){var a=0;try{m.default.PAssert(764,e.modifiedOffline,"Should only merge events that were locally modified")}catch(s){m.default.reportError(s)}var i=e.modifiedOffline;try{m.default.PAssert(765,m.default.isArray(i),"Should not be receiving an update for an event that was created locally")}catch(s){m.default.reportError(s)}for(var n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n];0,t[r]=e[r]}t.modifiedOffline=e.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(e,t,a){var i=this;try{m.default.PAssert(766,e,"Must provide a valid attachment")}catch(n){m.default.reportError(n)}try{m.default.PAssert(767,a,"Must provide valid new data")}catch(n){m.default.reportError(n)}if(t)e.hasInlineData(),e.forEachItem(void 0,function(e){e.getParsedText();(e.belongsToItemStore(sr.itemStoreManager.getTempItemStore()),t.summary!==a.summary)&&(e.hasAttachmentType(v.a.PluginType.Email)||a.summary&&a.summary.replace(/\u2000/g,""));if(t.description!==a.description&&e.belongsToItemStore(i.getDefaultItemStore()))if(e.hasNote())a.description?e.getNote().setText(a.description,v.a.ChangeType.Remote):e.setNote(void 0,v.a.ChangeType.Remote);else if(a.description){var n,r=a.id+"_note";i.getDefaultItemStore().hasItem(r)?(n=i.getDefaultItemStore().getItem(r)).setText(a.description,v.a.ChangeType.Remote):n=i.getDefaultItemStore().createItem(r,a.description,e.id,{isNote:!0},v.a.ChangeType.Remote),e.setNote(n,v.a.ChangeType.Remote)}i.areDatesEqual(t.isComplete,a.isComplete)||e.setComplete(!!a.isComplete,v.a.ChangeType.Remote),t.isArchived!==a.isArchived&&e.setArchived(a.isArchived),t.isStarred!==a.isStarred&&e.setStarred(a.isStarred,v.a.ChangeType.Remote),t.priority!==a.priority&&e.setPriority(a.priority,v.a.ChangeType.Remote)});else{this._createItemText(a);e.forEachItem(void 0,function(e){e.setTextToWhatItAlreadyIs(v.a.ChangeType.Remote)})}}},{key:"setSyncToken",value:function(e,t){try{m.default.PAssert(768,m.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(n){m.default.reportError(n)}try{m.default.PAssert(769,m.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(n){m.default.reportError(n)}var a=this._eventCache.getMetadata(fi.SyncTokens)||{},i=Date.now()+this._syncTokenDuration;a[e]={token:t,date:Date.now(),expires:i},this._eventCache.setMetadata(fi.SyncTokens,a)}},{key:"clearSyncToken",value:function(e){try{m.default.PAssert(770,m.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(a){m.default.reportError(a)}var t=this._eventCache.getMetadata(fi.SyncTokens);t&&(delete t[e],this._eventCache.setMetadata(fi.SyncTokens,t))}},{key:"clearCalendarEventCache",value:function(e,t){var a=this;try{m.default.PAssert(771,m.default.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(n){m.default.reportError(n)}var i=function(t){return t.calendarID===e};this._eventCache.getFilterEntries(i).then(function(e){if(e){for(var i=0,n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a._eventCache.removeEntry(e[n].id)}t&&t(!0)}else t&&t(!1)})}},{key:"_calendarSyncComplete",value:function(e,t){if(t.length>0){if(he.a.notifySyncError(t),this.isOnline())for(var a=0,i=0;i<t.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[i].result!==v.a.SyncResult.FailureNetwork&&sr.toasts.pushMessage(v.a.MessageID.CalendarSync)}}else he.a.notifySyncError(void 0),sr.toasts.clearMessage(v.a.MessageID.CalendarSync);var n=this.getSetting(this.Settings.ExportCalendar);if(n){for(var r=0,s=!1,o=0;o<t.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t[o].id===n){s=!0;break}}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}this.onCalendarsSynced.notify()}},{key:"_shouldExpireToken",value:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}},{key:"_getCalendarInfo",value:function(e){return this._calendarList[e]}},{key:"allowTextEditing",value:function(e,t){var a=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=t.getField("calendarID");(this.hasWritePermissionForCalendar(i)||t.isLocalOnlyAttachment())&&(a=!0)}return a}},{key:"_createCalendarFromRemote",value:function(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return m.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),m.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}},{key:"runCalendarListSync",value:function(e){var t=this;this.getReadableCalendarList(function(a){if(a){var i=0;t._calendarList={};for(var n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=a[n];t._calendarList[r.id]=t._createCalendarFromRemote(r)}sr.toasts.clearMessage(v.a.MessageID.CalendarSync);var s=t.getDefaultExportCalendarID();s&&!t._calendarList[s]&&(t.setSetting(t.Settings.ExportCalendar,void 0),sr.toasts.pushMessage({text:"Your Default Save calendar is no longer accessible. Please select another or update your sync accounts.",action:v.a.MessageAction.OpenCalendarSettings})),t._eventCache.setMetadata(fi.CalendarList,t._calendarList)}else t.isOnline()&&sr.toasts.pushMessage(v.a.MessageID.CalendarSync);e&&e()})}},{key:"_notifyTokenExpired",value:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(e){m.default.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,function(t){t||m.default.log("Failure unsyncing calendar "+e)}),this._clearCalendarItems(e)}},{key:"_clearCalendarItems",value:function(e){var t=this.getDefaultItemStore();sr.PaneUpdateBatcher.beginUpdateItems(),t.forEach(function(a){a.hasAttachments()&&(a.getAttachment(0).getField("calendarID")===e&&t.destroyItem(a.id))}),sr.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(e,t){var a=v.a.SyncResult.Success;if(t&&t.error&&t.error.code){var i=t.error.code;if(i===v.a.HTTPStatusCode.Unauthorized){var n=this._getCalendarInfo(e);a=n&&"owner"===n.accessRole?v.a.SyncResult.FailureOAuth:n&&"writer"===n.accessRole?v.a.SyncResult.FailureNoWrite:v.a.SyncResult.FailureNoRead}else a=i===v.a.HTTPStatusCode.NotFound?v.a.SyncResult.FailureNoRead:i===v.a.HTTPStatusCode.Network?v.a.SyncResult.FailureNetwork:i===v.a.HTTPStatusCode.Forbidden?v.a.SyncResult.FailureNoRead:v.a.SyncResult.FailureUnknown}return a}},{key:"runCalendarSync",value:function(e,t){var a=this,i=0,n=0,r=[],s=[],o=function(t,o,l){try{m.default.PAssert(772,n<i,"Should never have more calendars syncd than we tried to sync")}catch(u){m.default.reportError(u)}t?r.push({id:o,result:v.a.SyncResult.Success}):s.push({id:o,result:a._getSyncResultFromResult(o,l)}),++n===i&&(a._calendarSyncComplete(r,s),e&&e())},l=this._eventCache.getMetadata(fi.SyncTokens);this._updateSyncTimes();var u=this.getImportCalendarList();if(u&&u.length>0){var d=0;i=u.length;for(var c=0;c<u.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var h=u[c];m.default.isObject(h)||(h={id:u[c]});var f,p=l?l[h.id]:void 0;this._shouldExpireToken(p)?(this._notifyTokenExpired(h.id),f=void 0):f=p.token,this.performCalendarSync(h,f,o,t)}for(var g in l)if(l.hasOwnProperty(g)){var y=0,k=!1;for(c=0;c<u.length;++c){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;h=u[c];if(m.default.isObject(h)||(h={id:u[c]}),h.id===g){k=!0;break}}k||this._notifyCalendarUnsyncd(g)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}},{key:"performCalendarSync",value:function(e,t,a,i){var n=this,r=e.id,s=e.accountID;try{m.default.PAssert(773,m.default.isString(r),"Must provide a valid calendar ID for each sync op")}catch(d){m.default.reportError(d)}if(!s){var o=this._getCalendarInfo(e.id);o&&(s=o.accountID),s||(s=sr.settings.getUserIdentifier())}var l=be.a.fns("calendar").events.list.packedFn,u={calendarId:r,singleEvents:!0};i||(t?u.syncToken=t:(u.timeMin=this._minSyncStartTime.toISOString(),u.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(s,l,u,function(e,t,i){var s,o=0;i&&(s=i.nextSyncToken,n.setSyncToken(r,s)),sr.PaneUpdateBatcher.beginUpdateItems();for(var l=0;l<e.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n.handleEventUpdate(r,e[l])}sr.PaneUpdateBatcher.commitUpdateItems(),a(!0,r)},function(t){t&&t.error&&t.error.code===v.a.HTTPStatusCode.Gone?n._clearCachedData(r,function(s){s?n.performCalendarSync(e,void 0,a,i):a(!1,r,t)}):(a(!1,r,t),n._notifyFailedRequest(t,r))},void 0,mi,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&hi.indexOf(a)>=0&&(t[a]=e[a]);return t}},{key:"_notifyOfflineSyncFailures",value:function(e,t,a){t>0&&(he.a.notifySyncError(a),m.default.log("Failed to sync offlineChanges: ",t))}},{key:"_syncOfflineChanges",value:function(e){var t=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var a=0,i=0,n=0,r=[],s=function(s,o){o===v.a.SyncResult.Success?i++:(n++,r.push({id:s,result:o})),a===i+n&&(t._syncingOfflineChanges=!1,e(i,n,r))},o=function(e){return!!e.modifiedOffline};this._eventCache.getFilterEntries(o).then(function(e){a=e.length,e.forEach(function(e){var a=t.createEntryFromLocal(e.id,e);if(!a.isInvalid){var i=a.calendarID;m.default.isTempId(a.id)&&!t._pendingCreates[a.id]?t._createRemoteEventFromCacheData(a.calendarID,a,m.default.newEmptyFn(),function(e,a){s(i,t._getSyncResultFromResult(i,a))},m.default.newEmptyFn()):t.hasWritePermissionForCalendar(i)?t._updateRemoteEvent(i,a.id,a,Pi,function(e,n){e?(delete a.modifiedOffline,t._eventCache.saveEntry(a).then(function(){return s(i,v.a.SyncResult.Success)}).catch(function(){return s(i,v.a.SyncResult.FailureUnknown)})):s(i,t._getSyncResultFromResult(i,n))}):(delete a.modifiedOffline,t._eventCache.saveEntry(a),s(a.calendarID,v.a.SyncResult.Success))}})})}}},{key:"_getEventDuration",value:function(e){try{m.default.PAssert(774,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(i){m.default.reportError(i)}var t=e.getField("startTime"),a=e.getField("endTime");try{m.default.PAssert(775,t&&a,"Must always have valid start and end times")}catch(i){m.default.reportError(i)}return a-t}},{key:"_computeItemDates",value:function(e,t,a){var i,n;t.getDate()&&(n=(i=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),i&&n&&(t.allDayDate()?(e.start={date:i.toString("yyyy-MM-dd"),dateTime:null},e.end={date:n.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:i.toISOString(),date:null},e.end={dateTime:n.toISOString(),date:null})),e.startTime=i,e.endTime=n}},{key:"_queueEventUpdate",value:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var a=this._eventUpdateQueue[e.id];if(a)for(var i in t)t.hasOwnProperty(i)&&(a.info[i]=t[i]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var e=function(e,t){e||t?sr.toasts.clearMessage(v.a.MessageID.CalendarSaveFail):sr.toasts.pushMessage(v.a.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var a=this._eventUpdateQueue[t];this._updateEvent(a.attach,a.info,bi,m.default.newEmptyFn(),m.default.newEmptyFn(),e)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(e,t){var a=this,i=e.getField("status");this.deleteCalendarEvent(e,function(n){if(n){sr.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function n(){a._updateEvent(e,{status:i},Di,m.default.newEmptyFn(),function(e){e||sr.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:n,timeout:1e4})},m.default.newEmptyFn());var r=a._createItemText(e.getData());t.setText(r,v.a.ChangeType.Local),t.parent()||t.setParent(a.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)},timeout:1e4})}else sr.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:a._handleAttachDeleted.bind(a,e,t),timeout:1e4})})}},{key:"notifyItemNoteChanged",value:function(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}},{key:"notifyItemDateChanged",value:function(e,t){var a={};this._computeItemDates(a,t,e),this._queueEventUpdate(e,a)}},{key:"notifyItemTextChanged",value:function(e,t,a){if(a)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))sr.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!m.default.isDemoMode())if(t.getDate()){var i,n=t.getCalendarParsedText(),r=e.getField("summary"),s=e.getField("source");if(t.hasAttachmentType(v.a.PluginType.Email)){var o=t.getAttachmentByType(v.a.PluginType.Email);i={title:o.getField("subject"),url:o.getPlugin().createURLForThread(o)}}var l={summary:n,start:void 0,end:void 0,source:void 0},u=!1;n!==r&&(u=!0),s&&!i||!s&&i?u=!0:s&&i&&(s.title===i.title&&s.url===i.url||(u=!0));var d=t.getDate(),c=e.getField("startTime");this.areDatesEqual(c,d)||(u=!0);var h=t.getEndDate(),f=e.getField("endTime");this.areDatesEqual(f,h)||(u=!0),u&&(this._computeItemDates(l,t,e),l.source=i,this._queueEventUpdate(e,l)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(e,t,a){if(this.getSetting(this.Settings.WriteAccess)&&!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!m.default.isRemoteChange(a)||!this._isIgnoringPropertyChanges())){var i=e.getField("isComplete"),n=e.getField("isArchived"),r=e.getField("isStarred"),s=e.getField("priority"),o=t.dateCompleted,l=t.isArchived(),u=t.isStarred(),d=t.getPriority(),c=m.default.newEmptyFn(),h=m.default.newEmptyFn(),f=function(e,t,a,i){e||t?sr.toasts.clearMessage(v.a.MessageID.CalendarSaveFail):sr.toasts.pushMessage(v.a.MessageID.CalendarSaveFail)};this.areDatesEqual(i,o)||(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isComplete",o,c,h,f):e.updateField("isComplete",o)),n!==l&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isArchived",l,c,h,f):e.updateField("isArchived",l)),r!==u&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isStarred",u,c,h,f):e.updateField("isStarred",u)),s!==d&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"priority",d,c,h,f):e.updateField("priority",d))}}},{key:"_clearCachedData",value:function(e,t){this.clearSyncToken(e),this.clearCalendarEventCache(e,t)}},{key:"_clearAllData",value:function(e){this._eventCache.clearMetadata(),this._eventCache.clearCache().then(function(){e&&e(!0)}),this.getDefaultItemStore().clearStore()}},{key:"getAttachmentClass",value:function(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}},{key:"getAttachmentTooltip",value:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}},{key:"areDatesEqual",value:function(e,t){var a=!1;return e&&t?m.default.isDateValid(e)&&m.default.isDateValid(t)&&(a=e.equals(t)):a=!e&&!t,a}},{key:"parsePriority",value:function(e){var t=m.default.parseInt(e);return isNaN(t)&&(t=v.a.VMLIFlag.None),t}},{key:"fieldsHaveParseEffect",value:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&f()(c()(t.prototype),"fieldsHaveParseEffect",this).call(this,e)}},{key:"changeCalendarForEvent",value:function(e,t){var a=this;try{m.default.PAssert(777,e.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(u){m.default.reportError(u)}var i=e.getField("calendarID"),n=this._getCalendarInfo(i),r=n.id;try{m.default.PAssert(778,n.accountID,"Should have an accountID on the calendar")}catch(u){m.default.reportError(u)}var s=be.a.fns("calendar").events.move.packedFn,o={eventId:e.id,calendarId:i,destination:t};e.updateField("calendarID",t,!0);var l=function(){e.forEachItem(sr.itemStoreManager.getDefaultItemStore(),function(e){var a=e.getMooDate();a&&(a.setGCalCalendar(t),e.onMooDateUpdated(v.a.ChangeType.Local,!0),e.setTextToWhatItAlreadyIs(v.a.ChangeType.Local))})};this._queueRemoteRequestMulti(n.accountID,s,o,l,function(t){e.updateField("calendarID",r,!0),t&&t.error&&t.error.code===v.a.HTTPStatusCode.Gone?l():(t&&t.error&&(t.error.code,v.a.HTTPStatusCode.NotFound),a._notifyFailedRequest(t,e.getField("calendarID")))},void 0,Ei)}},{key:"getCalendarForAttach",value:function(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}},{key:"fixMissingCalendars",value:function(){this.runCalendarSync(),sr.settings.fixedMissingCalendars.set(!0)}},{key:"getWriteableCalendarsForItem",value:function(e){var t,a,i;if(this.isAvailable()&&this.isEnabled()){if(e.hasPluginAttachment(v.a.PluginID.GCalendar)){var n=e.getAttachmentByPlugin(v.a.PluginID.GCalendar),r=this.getCalendarForAttach(n);r&&(a=r.id,t=r.accountID)}i=this.getWritableCalendarListSync(t)}return{selected:a,calendars:i}}},{key:"setCalendarForItem",value:function(e,t){var a=e.getAttachmentByPlugin(v.a.PluginID.GCalendar);t?e.hasPluginAttachment(v.a.PluginID.GCalendar)?this.changeCalendarForEvent(a,t):this.createEventForItem(e,t):e.hasPluginAttachment(v.a.PluginID.GCalendar)&&this.deleteCalendarEventForItem(e,a,m.default.newEmptyFn(),m.default.newEmptyFn(),function(){console.log("Done")})}},{key:"onSyncAccountsChanged",value:function(e,t){var a=this;t&&Object.keys(t).forEach(function(i){!t[i][a.id]||e[i]&&e[i][a.id]||a._clearCachedData(i)}),this.isActive()&&Object.keys(e).some(function(i){return e[i][a.id]&&(!t[i]||!t[i][a.id])})&&this.runCalendarSync()}}]),t}(Le),D()(xa.prototype,"_purgeOldData",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"_purgeOldData"),xa.prototype),D()(xa.prototype,"createEventForItem",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"createEventForItem"),xa.prototype),D()(xa.prototype,"runCalendarListSync",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"runCalendarListSync"),xa.prototype),D()(xa.prototype,"runCalendarSync",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"runCalendarSync"),xa.prototype),D()(xa.prototype,"_flushEventUpdateQueue",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"_flushEventUpdateQueue"),xa.prototype),D()(xa.prototype,"parsePriority",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"parsePriority"),xa.prototype),D()(xa.prototype,"fixMissingCalendars",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"fixMissingCalendars"),xa.prototype),D()(xa.prototype,"onSyncAccountsChanged",[C.a],Object.getOwnPropertyDescriptor(xa.prototype,"onSyncAccountsChanged"),xa.prototype),xa),Mi=m.default.seconds(30),Ti=(Ra=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this)))._plugins={},e._activePlugins=[],e._loadedDependencies={},e._iteratingPlugins=!1,e._hasAdjustedCacheSizeRatio=!1,e._queueTimeout=void 0,e._forcedLastPossible=!1,e._numOutstandingReqs=0,e._pluginRenderer=new me,e}return g()(t,e),o()(t,[{key:"init",value:function(){var e=this;this._setupRequestQueues();try{this._pluginRenderer.registerDefaultRenderers()}catch(t){console.log(t)}m.default.isDemoMode()&&this.notifyDependencyLoad(v.a.PluginDependency.DemoMode),_.a.onlineStatus.listen(function(t){"Online"===t&&e.goOnline()}),x.a.onForeground.listen(this.goOnline),k.a.listen("resetEverything",this._clearRequestQueues),this.registerPlugins()}},{key:"printStats",value:function(e){if(m.default.log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];m.default.log(t.name),m.default.log(" Stats: ",t.getStats())}else for(var a=0,i=Object.keys(this._plugins),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._plugins[i[n]],s=r.getStats();m.default.log(r.name),m.default.log(" Stats: ",s)}m.default.log("----------------------")}},{key:"dumpQueueState",value:function(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var e=0,t=Object.keys(this._plugins),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[t[a]];console.log(i.name),i.dumpQueueStats()}}},{key:"getStats",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var a=0,i=Object.keys(this._plugins),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._plugins[i[n]];t[r.id]=r.getStats()}return t}},{key:"getCacheStats",value:function(e,t){var a={};if(void 0!==e)this._plugins[e].getCacheStats(t);else for(var i=0,n=Object.keys(this._plugins),r=0,s=0;s<n.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._plugins[n[s]].getCacheStats(function(e,i){i&&(a[e]=i),n.length===++r&&t(a)}.bind(this,n[s]))}}},{key:"getState",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var a=0,i=Object.keys(this._plugins),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._plugins[i[n]];t[r.id]=r.getState()}return t}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new ui)}catch(e){m.default.reportError(e)}try{this.registerPlugin(new ft)}catch(e){m.default.reportError(e)}try{this.registerPlugin(new Xa)}catch(e){m.default.reportError(e)}try{this.registerPlugin(new Ai)}catch(e){m.default.reportError(e)}try{this.registerPlugin(new kt)}catch(e){m.default.reportError(e)}this.registerPlugin(new xe)}},{key:"registerPlugin",value:function(e){try{m.default.PAssert(377,!this._plugins[e.id],"Should never double-register a plguin")}catch(t){m.default.reportError(t)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}},{key:"getPlugin",value:function(e){return this._plugins[e]}},{key:"getPluginGmail",value:function(){return this._plugins[v.a.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[v.a.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[v.a.PluginID.GCalendar]}},{key:"loadPlugin",value:function(e){var t=this.getPlugin(e);try{m.default.PAssert(378,t,"Must register a plugin before loading it")}catch(a){m.default.reportError(a)}this.activatePlugin(t)}},{key:"unloadPlugin",value:function(e){}},{key:"authorizePlugin",value:function(e,t,a){a(!0)}},{key:"deauthorizePlugin",value:function(e,t){try{m.default.PAssert(381,t&&m.default.isFunction(t),"Must provide a valid callback fn")}catch(i){m.default.reportError(i)}var a=this.getPlugin(e);try{m.default.PAssert(382,a,"Must register a plugin before loading it")}catch(i){m.default.reportError(i)}a.setSetting(a.Settings.IsEnabled,!1),m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin Deauthorized: ",e),this.deactivatePlugin(a),t(!0)}},{key:"onPluginAuthorized",value:function(e,t){e.setSetting(e.Settings.IsEnabled,t),m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}},{key:"activatePlugin",value:function(e){try{m.default.PAssert(383,e,"Plugin must be valid to be activated")}catch(t){m.default.reportError(t)}e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin Activated: ",e.id)}},{key:"deactivatePlugin",value:function(e){try{m.default.PAssert(384,e,"Plugin must be valid to be deactivated")}catch(t){m.default.reportError(t)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id),m.default.shouldLog(v.a.LogLevels.Plugin)&&m.default.log("Plugin Deactivated: ",e.id))}},{key:"isOnline",value:function(){return _.a.isConnected()||m.default.isDemoMode()}},{key:"goOnline",value:function(){var e=this;setTimeout(function(){var t=0;e._setupRequestQueues(!0);for(var a=0;a<e._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e._plugins[e._activePlugins[a]];try{i.goOnline()}catch(n){e._reportPluginError(n)}}},0)}},{key:"onDocumentShared",value:function(e){for(var t=0,a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[a]];try{i.onDocumentShared(e)}catch(n){this._reportPluginError(n)}}}},{key:"onShutdown",value:function(){for(var e=0,t=[],a=0;a<this._activePlugins.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this._plugins[this._activePlugins[a]];try{var n=i.onShutdown();n&&t.push(n)}catch(r){this._reportPluginError(r)}}return t.length>0?t:void 0}},{key:"onClearData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.clearData()}catch(i){this._reportPluginError(i)}}}},{key:"getCacheSizeRatio",value:function(){var e=sr.settings.cacheSizeRatio.get()||1;try{m.default.PAssert(385,e>=0&&e<=1,"Invalid ratio value: "+e)}catch(t){m.default.reportError(t)}return e}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var e=this.getCacheSizeRatio();1===e&&m.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:m.default.sendEvent("CacheRatioChange","Minimum"),m.default.sendEvent("CacheRatioChange","Change",e),sr.settings.cacheSizeRatio.set(e)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.onCacheLimitExceeded()}catch(i){this._reportPluginError(i)}}}}},{key:"getPluginsForType",value:function(e){var t;switch(e){case v.a.PluginType.Calendar:t=[v.a.PluginID.GCalendar];break;case v.a.PluginType.Email:t=[v.a.PluginID.Gmail];break;case v.a.PluginType.Storage:t=[v.a.PluginID.Drive];break;case v.a.PluginType.Unknown:t=[v.a.PluginID.Mailbird,v.a.PluginID.Moodo]}return t}},{key:"hasAttachmentType",value:function(e,t){var a=!1;if(e.hasAttachments())for(var i=0,n=this.getPluginsForType(t),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.hasPluginAttachment(n[r])){a=!0;break}}return a}},{key:"allowTextEditing",value:function(e){var t=!0;if(e&&e.hasAttachments())for(var a=0,i=e.getAttachments(),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i[n].getPlugin().allowTextEditing(e,i[n])){t=!1;break}}return t}},{key:"validatePlugin",value:function(e){}},{key:"runForEachPlugin",value:function(e){var t=0;this._iteratingPlugins=!0;for(var a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[a]))}catch(i){m.default.reportError(i)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(e,t){try{m.default.PAssert(386,e.p,"Must specify the plugin string to be used: ",e)}catch(i){m.default.reportError(i)}try{m.default.PAssert(387,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(i){m.default.reportError(i)}var a=this.getPlugin(e.p);try{m.default.PAssert(388,a,"Must specify a valid plugin: ",e)}catch(i){m.default.reportError(i)}if(a)return a.getAttachment(e.id,t?e:void 0)}},{key:"createDisplayElement",value:function(e,t){try{m.default.PAssert(389,e.p,"Must specify the plugin string to be used")}catch(r){m.default.reportError(r)}try{m.default.PAssert(390,e.id,"Must specify the ID of the data to use from the plugin")}catch(r){m.default.reportError(r)}var a,i=this.getPlugin(e.p);if(i){var n=this.getAttachment(e,t);if(n)try{a=i.createDisplayElement(n)}catch(s){this._reportPluginError(s),a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p);return a}},{key:"createUnknownPluginElement",value:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:v.a.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"measureAttachment",value:function(e,t){try{m.default.PAssert(391,t&&t.attrs&&t.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(n){m.default.reportError(n)}var a=0,i=this.getPlugin(t.attrs.plugin);try{m.default.PAssert(392,i,"Should always be able to find a valid plugin: ",t.attrs.plugin)}catch(n){m.default.reportError(n)}return i&&(a=i.measureAttachment(e,t)),a}},{key:"parseAttachmentEmbedString",value:function(e,t){try{m.default.PAssert(393,e,"Must provide a valid string to parse")}catch(r){m.default.reportError(r)}var a=e.replace(/&quot;/g,'"').split(","),i={};if(a.forEach(function(e){var t=e.indexOf(":"),a=e.substr(0,t),n=e.substr(t+1,e.length-t-1);if("p"!==a&&"id"!==a)try{n=decodeURIComponent(n)}catch(r){}i[a]=n}),t){var n=a.length>2;i.displayElement=this.createDisplayElement(i,n),i.hasInlineData=n}return i}},{key:"createSimpleAttachment",value:function(e){return e.isSimpleAttachment=!0,e}},{key:"handleDropEvent",value:function(e,t){for(var a=0,i=!1,n=!1,r=0;r<this._activePlugins.length&&!i;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._activePlugins[r],o=this.getPlugin(s);try{i=o.handleDropEvent(e,t)}catch(u){this._reportPluginError(u),n=!0}}if(!i&&(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0||e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length>0)){var l=n?{text:"An error was detected handling drag drop and the developers have been notified",action:v.a.MessageAction.OpenSettings}:{text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:v.a.MessageAction.OpenSettings};sr.toasts.pushMessage(l),i=!0}return i}},{key:"handleTapEvent",value:function(e,t,a,i){var n=!1,r=m.default.getPluginForElement(a.target);if(r){var s=r.getAttribute("plugin"),o=this.getPlugin(s);try{m.default.PAssert(394,o,"Must be able to get a valid plugin from a plugin element")}catch(u){m.default.reportError(u)}if(o.isPluginBlocked())sr.toasts.pushMessage(v.a.MessageID.PremiumRequired),n=!0;else{var l=r.getAttribute("plugin-id");try{m.default.PAssert(395,l,"Must have a valid item ID for a plugin element")}catch(u){m.default.reportError(u)}try{n=o[i](e,t,l,a)}catch(d){this._reportPluginError(d)}}}return n}},{key:"handleTapStart",value:function(e,t,a){return this.handleTapEvent(e,t,a,"handleTapStart")}},{key:"handleTapClick",value:function(e,t,a){if(!t.isEditable||m.default.findParent(a.target,"plugin"))return this.handleTapEvent(e,t,a,"handleTapClick")}},{key:"handleDoubleTap",value:function(e,t,a){return this.handleTapEvent(e,t,a,"handleDoubleTap")}},{key:"isAuthorized",value:function(e){return!!m.default.isDemoMode()||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}},{key:"getSetting",value:function(e,t){return this.getPlugin(e).getSetting(t)}},{key:"setSetting",value:function(e,t,a){return this.getPlugin(e).setSetting(t,a)}},{key:"onAuthorizedSetting",value:function(e,t,a){this.getPlugin(e).onAuthorizedSetting(t,a)}},{key:"notifyDependencyLoad",value:function(e,t){for(var a in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(a))try{this.getPlugin(a).onDependencyLoaded(e,t)}catch(i){this._reportPluginError(i)}}},{key:"notifyDependencyUnload",value:function(e,t){}},{key:"_handleBatchRequestResponse",value:function(e,t){try{m.default.PAssert(397,e,"Plugin must be passed to response to know who is handling it")}catch(a){m.default.reportError(a)}this._numOutstandingReqs--;try{m.default.PAssert(398,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){m.default.reportError(a)}try{e._handleBatchRequestResponse(t)}catch(i){this._reportPluginError(i)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(e,t,a){try{m.default.PAssert(399,t,"Plugin must be passed to response to know who is handling it")}catch(i){m.default.reportError(i)}if(!a){this._numOutstandingReqs--;try{m.default.PAssert(400,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(i){m.default.reportError(i)}}try{t._handleRequestResponse(e,a)}catch(n){this._reportPluginError(n)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){try{m.default.PAssert(401,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){m.default.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}},{key:"verifyAuthorization",value:function(e,t){for(var a,i,n=0,r=0;r<this._activePlugins.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this._activePlugins[r],o=this.getPlugin(s);if(o.isEnabled())!o.verifyAuthorization(e)&&(i=(i||[]).concat(o.googleScopes())),a=a||!o.verifyAuthorization(e)}}},{key:"_reportInvalidScopes",value:function(e,t){sr.toasts.pushMessage(v.a.MessageID.MissingOffline),sr.toasts.clearMessage(v.a.MessageID.LostPermission),m.default.reportError(new Error("Invalid scopes reported"),{accountID:e,scopes:t})}},{key:"_setupRequestQueues",value:function(e){var t=e?1:Mi;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(v.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(v.a.RequestPriority.Default),this._runPumpRequestQueues(v.a.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(e){var t=0;if(this.isOnline()){var a=0,i=6-this._numOutstandingReqs;try{m.default.PAssert(402,i>=0,"Should never have more than max outstanding requests at any given point in time")}catch(d){m.default.reportError(d)}for(var n=0;i>0&&n<this._activePlugins.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._activePlugins[n],s=this.getPlugin(r),o=4-s.getNumOutstandingReqs();try{m.default.PAssert(403,o>=0,"Must always have a postiive number of available plugin reqs")}catch(d){m.default.reportError(d)}var l=Math.min(i,o);if(l>0&&s.isReady()){var u=0;try{u=s._pumpRequestQueue(e,l,this._handleRequestResponse,this._handleBatchRequestResponse);try{m.default.PAssert(404,u>=0,"Number of requests sent can never be negative")}catch(d){m.default.reportError(d)}}catch(c){this._reportPluginError(c)}try{m.default.PAssert(405,i-u>=0,"Too Many requests sent")}catch(d){m.default.reportError(d)}t+=u,i-=u,this._numOutstandingReqs+=u}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}},{key:"_clearRequestQueues",value:function(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._activePlugins[t],i=this.getPlugin(a);try{i._clearRequestQueue()}catch(n){this._reportPluginError(n)}}}},{key:"useRenderer",value:function(e,t){return this._pluginRenderer.useRenderer(e,t)}},{key:"_reportPluginError",value:function(e){m.default.reportError(e)}},{key:"parseEmailURL",value:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},a=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return a&&(t.accountID=a[1],t.threadID=a[2],t.plugin=this.getPlugin(v.a.PluginID.Gmail)),t}},{key:"isAvailable",value:function(e){return this.getPlugin(e).isAvailable()}},{key:"isActive",value:function(e){return this.getPlugin(e).isActive()}},{key:"isEnabled",value:function(e){return this.getPlugin(e).isEnabled()}},{key:"isGmailPaneEnabled",value:function(){return this.isEnabled(v.a.PluginID.Gmail)}}]),t}(E.a),D()(Ra.prototype,"goOnline",[C.a],Object.getOwnPropertyDescriptor(Ra.prototype,"goOnline"),Ra.prototype),D()(Ra.prototype,"_handleBatchRequestResponse",[C.a],Object.getOwnPropertyDescriptor(Ra.prototype,"_handleBatchRequestResponse"),Ra.prototype),D()(Ra.prototype,"_handleRequestResponse",[C.a],Object.getOwnPropertyDescriptor(Ra.prototype,"_handleRequestResponse"),Ra.prototype),D()(Ra.prototype,"_pumpRequestQueues",[C.a],Object.getOwnPropertyDescriptor(Ra.prototype,"_pumpRequestQueues"),Ra.prototype),D()(Ra.prototype,"_clearRequestQueues",[C.a],Object.getOwnPropertyDescriptor(Ra.prototype,"_clearRequestQueues"),Ra.prototype),Ra),Li=a(110),xi=a(67),Ri=a(116),Oi=["4.95","49.95","5","49"],Fi=x.a.demo,Ni=(Oa=function(){function e(){var t=this;r()(this,e),this._premiumStatus=new z.a(v.a.PremiumStatus.Unknown),Fi&&this._premiumStatus.set(v.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new Li.a([this._premiumStatus],function(){return t.hasPremiumFeatures()}),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=v.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new z.a(!1),this.daysLeftInTrial=new z.a(-1),this.inviteCodeError=new z.a,this.inviteEmailError=new z.a,this.inviteEmailSuccess=new z.a,sr.settings.userProperties.onHasValue(function(e){return t.init()})}return o()(e,[{key:"init",value:function(){var e=this;if(this._premiumStatus.listen(function(t,a){e.hasPremiumFeatures()?(sr.pluginManager.notifyDependencyLoad(v.a.PluginDependency.EarlyAccess),sr.pluginManager.notifyDependencyLoad(v.a.PluginDependency.PremiumSub)):e.hasEarlyAccess()&&sr.pluginManager.notifyDependencyLoad(v.a.PluginDependency.EarlyAccess),t!==a&&a&&sr.DisplaySettings.onSettingChanged()}),!Fi&&(this.userProperties=sr.settings.userProperties.get(),this.userProperties)){this.updateBillingData(),m.default.shouldLog(v.a.LogLevels.Account)&&m.default.log("Premium Status (Local): ",this.userProperties.premiumStatus);var t=L.a.getURLParam("premium");void 0!==t&&L.a.removeURLParam("premium",!0),t&&setTimeout(function(){sr.menus.openSettings(v.a.SettingsSections.Account)},100)}}},{key:"setLastSignupError",value:function(e){this._lastSignupError=e}},{key:"_reportRemoteStatusFailure",value:function(){m.default.sendEvent("Billing","RemoteStatusFailure")}},{key:"getBillingIdentifier",value:function(){this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(e){}},{key:"onConnected",value:function(e){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===v.a.PremiumStatus.Active||this._premiumStatus.get()===v.a.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===v.a.PremiumStatus.Trial||this._premiumStatus.get()===v.a.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===v.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===v.a.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){var e=this.getPremiumEndDate();return this.isCanceledState()&&e&&e.getTime()>Date.now()}},{key:"isInFreeMonthAndPremium",value:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}},{key:"hasSubscription",value:function(){return!this._premiumCode&&this.getNextBillingDate()}},{key:"updateBillingData",value:function(){var e,t=this.userProperties,a=t.premiumStatus;this._earlyAdopter=t.earlyAdopter,this._joinDate=t.joinDate?new Date(t.joinDate):new Date,this._premiumStartDate=t.premiumSignupDate?new Date(t.premiumSignupDate):new Date,this._premiumEndDate=t.premiumEndDate?new Date(t.premiumEndDate):void 0,this._premiumCode=t.premiumCode,this._nextBillingDate=t.nextBillingDate?new Date(t.nextBillingDate):void 0,this._trialStart=t.trialStart?new Date(t.trialStart):new Date,this._trialDuration=t.trialDuration||v.a.TrialDuration,this._trialExtended=t.trialExtended||!1,e=a===v.a.PremiumStatus.CanceledPastDue||a===v.a.PremiumStatus.CanceledUser?-1:this._trialDuration-Math.ceil((Date.now()-this._trialStart.getTime())/864e5);try{m.default.PAssert(1158,e<=320,"Sanity check on trial length",e)}catch(i){m.default.reportError(i)}this.daysLeftInTrial.set(e),a===v.a.PremiumStatus.Trial&&e<0?(a=v.a.PremiumStatus.TrialOver,xi.a.updatePremiumStatus(),this.notifyTrialOver()):a===v.a.PremiumStatus.Trial&&e<5&&this.notifyTrialEndSoon(),a&&this.setPremiumStatus(a),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(e){try{m.default.PAssert(1159,m.default.isNumber(e),"Status must be a valid number",e)}catch(t){m.default.reportError(t)}try{m.default.PAssert(1160,e>0&&e<8,"Should be a valid status identifier",e)}catch(t){m.default.reportError(t)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),m.default.setDimension(v.a.Analytics.Dimensions.PremiumStatus,e))}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"cancelSubscription",value:function(e,t){m.default.sendEvent("Billing","SubCancelTapped");var a=function(){t&&m.default.isFunction(t)&&t()};return sr.menus.confirm("Are you sure you want to cancel your subscription?",function(e){e?(m.default.sendEvent("Billing","SubCancelYES"),xi.a.cancelPremium().then(function(e){var t=e.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";sr.menus.alert({text:t}),a()})):(a(),m.default.sendEvent("Billing","SubCancelNO"))}),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(e){sr.menus.openModal(v.a.Modals.Billing,{isUpdate:e})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!0)}},{key:"onTapViewInvoices",value:function(e,t){return xi.a.listTransactions().then(function(e){if(e&&e.value)try{sr.menus.openModal(v.a.Modals.Invoices,e.value)}catch(a){m.default.reportError(a)}else sr.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});t()}),!0}},{key:"onTapDeleteAccount",value:function(e,t){return sr.menus.openModal(v.a.Modals.DeleteAccount,{callback:function(){xi.a.deleteAccount().then(function(e){e.value?_.a.clearLocalData():sr.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),t()})}}),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+x.a.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"sendInviteEmail",value:function(e,t){}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(sr.International.getFormat(v.a.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(sr.International.getFormat(v.a.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){var e=this.getPremiumEndDate();return e?e.toString(sr.International.getFormat(v.a.DFormat.LongStrDate)):"Never"}},{key:"nextBillingDateText",value:function(){var e=this.getNextBillingDate();return e?e.toString(sr.International.getFormat(v.a.DFormat.LongStrDate)):"Never"}},{key:"shareTwitter",value:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),m.default.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),m.default.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),m.default.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(e,t,a){var i=t,n=a,r=window.screen.height,s=window.screen.width,o="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+i+",height="+n+",left="+Math.round(s/2-i/2)+",top="+Math.round(r/2-n/2);window.open(e,null,o)}},{key:"onTapSignupMonth",value:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupYear",value:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapCodeSignup",value:function(){sr.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:function(){sr.menus.openModal(v.a.Modals.ReportBug)}})}},{key:"getMonthlyPricing",value:function(){return this._earlyAdopter?v.a.Pricing.EarlyMonthly:v.a.Pricing.RegMonthly}},{key:"getYearlyPricing",value:function(){return this._earlyAdopter?v.a.Pricing.EarlyYearly:v.a.Pricing.RegYearly}},{key:"getMonthlyPrice",value:function(){return Oi[this.getMonthlyPricing()]}},{key:"getYearlyPrice",value:function(){return Oi[this.getYearlyPricing()]}},{key:"getPlanPrice",value:function(e){return Oi[e]}},{key:"notifyTrialOver",value:function(){if(!sr.settings.notifiedTrialOver.get()){if(!sr.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);sr.toasts.pushMessage(v.a.MessageID.TrialOver),sr.settings.notifiedTrialOver.set(!0)}}},{key:"notifyTrialEndSoon",value:function(){if(!sr.settings.notifiedTrialEndSoon.get()){if(!sr.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);sr.toasts.pushMessage(v.a.MessageID.TrialEndSoon),sr.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOver",value:function(){return this._premiumStatus.get()===v.a.PremiumStatus.TrialOver||(this._premiumStatus.get()===v.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===v.a.PremiumStatus.CanceledPastDue)&&!this.canceledUserHasPremiumAccess()}},{key:"startTrial",value:function(){var e=this;try{m.default.PAssert(1165,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(t){m.default.reportError(t)}xi.a.startTrial().then(function(a){if(a.error)if(a.errorCode===v.a.PrivateAPIErrorCodes.TrialOver)sr.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),e._premiumStatus.set(v.a.PremiumStatus.TrialOver);else{try{m.default.PAssert(1166,!1,"Failed to start trial for user")}catch(t){m.default.reportError(t)}sr.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:v.a.MessageAction.Contact})}})}},{key:"hasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===v.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"getBillingPeriod",value:function(){return this._pricingSelected}},{key:"loadUserProperties",value:function(e){"premiumStatus"in e&&this._premiumStatus.set(e.premiumStatus);var t=sr.settings.userProperties.get();if(t=Object.assign({},t,e),sr.settings.userProperties.set(t),this.userProperties=t,this.updateBillingData(),!this.userProperties.gid&&sr.settings.shouldShowHelp("missingGID")){var a=sr.toasts.pushMessage({id:"shouldImportMoodo",text:"If you are coming from the old Moo.do, please import your Premium settings and documents. If you're a new user just click to ignore this message.",hold:!0,actionText:"IMPORT",onClose:function(){a=void 0,sr.settings.closeHelp("missingGID")},action:function(){(new Ri.a).authAndImportDocuments()}});sr.settings.closedHelps.listen(function e(){sr.settings.shouldShowHelp("missingGID")||(setTimeout(function(){return sr.settings.closedHelps.unlisten(e)},0),a&&sr.toasts.clearMessage(a))})}}}]),e}(),D()(Oa.prototype,"cancelSubscription",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"cancelSubscription"),Oa.prototype),D()(Oa.prototype,"onTapUpdatePaymentMethod",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapUpdatePaymentMethod"),Oa.prototype),D()(Oa.prototype,"onTapViewInvoices",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapViewInvoices"),Oa.prototype),D()(Oa.prototype,"onTapDeleteAccount",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapDeleteAccount"),Oa.prototype),D()(Oa.prototype,"onTapSignupMonth",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapSignupMonth"),Oa.prototype),D()(Oa.prototype,"onTapSignupYear",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapSignupYear"),Oa.prototype),D()(Oa.prototype,"onTapCodeSignup",[C.a],Object.getOwnPropertyDescriptor(Oa.prototype,"onTapCodeSignup"),Oa.prototype),Oa),Bi=function(){function e(t,a){r()(this,e),this._id=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._useInMemoryStore=!a||!a.noInMemoryCache,this._useMetadataInMemoryStore=!a||!a.noMetadataInMemoryCache,this._metadataKeys=a&&a.metadataKeys?a.metadataKeys:[]}return o()(e,[{key:"getStats",value:function(){var e=this;return this.getFilterEntriesSync(function(){return!0}).map(function(t){return{id:e._id,count:t.length,size:JSON.stringify(t).length}})}},{key:"getState",value:function(){return{isAllLoaded:this._isAllLoaded,storageError:this._storageError}}},{key:"enableLogging",value:function(){this._loggingEnabled=!0}},{key:"disableLogging",value:function(){this._loggingEnabled=!1}},{key:"isLoggingEnabled",value:function(){return this._loggingEnabled}},{key:"usesDiskSpace",value:function(){return this._usesDiskSpace}},{key:"_cacheInMemory",value:function(){return this._useInMemoryStore}},{key:"_cacheMetadataInMemory",value:function(){return this._useMetadataInMemoryStore}},{key:"_hasLoadedAll",value:function(){return this._isAllLoaded}},{key:"getStorageType",value:function(){try{m.default.PAssert(1536,!1,"SubClass must override")}catch(e){m.default.reportError(e)}}},{key:"_setRawInMemoryCache",value:function(e){try{m.default.PAssert(1537,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){m.default.reportError(t)}this._cache=e}},{key:"_getRawInMemoryCache",value:function(){return this._cacheInMemory()?this._cache:void 0}},{key:"count",value:function(e){e(this._cacheInMemory()?Object.keys(this._cache).length:void 0)}},{key:"size",value:function(e){e(this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0)}},{key:"loadAll",value:function(e){this._isAllLoaded=!0}},{key:"getEntrySync",value:function(e){return this._cacheInMemory()?this._cache[e]:void 0}},{key:"getBoundEntries",value:function(e,t,a,i){try{m.default.PAssert(1538,!i,"In memory query is sync")}catch(s){m.default.reportError(s)}var n;if(this._cacheInMemory())for(var r in n=[],this._cache)this._cache[r][e]>=t&&this._cache[r][e]<=a&&n.push(this._cache[r]);return n}},{key:"getFilterEntriesSync",value:function(e){var t,a=this;return this._cacheInMemory()&&(t=[],Object.keys(this._cache).forEach(function(i){e&&!e(a._cache[i])||t.push(a._cache[i])})),t}},{key:"removeEntrySync",value:function(e){delete this._cache[e]}},{key:"hasEntrySync",value:function(e){return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)}},{key:"saveEntrySync",value:function(e){try{m.default.PAssert(1539,e,"Must be saving data")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1540,e&&e.id,"Saved data must have id")}catch(t){m.default.reportError(t)}this.isLoggingEnabled()&&m.default.log("Cache Entry: ",e),this._cacheInMemory()&&e&&(this._cache[e.id]=e)}},{key:"clearCacheSync",value:function(){this._cache={}}},{key:"clearBackingStore",value:function(){try{m.default.PAssert(1541,!1,"SubClass must override")}catch(e){m.default.reportError(e)}}},{key:"dumpData",value:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)}},{key:"onCacheError",value:function(e){m.default.reportError(e)}}]),e}(),Ui=function(e){function t(e,a){var i;return r()(this,t),(i=u()(this,c()(t).call(this,e,a))).keyFieldsRN=a.keyFieldsRN,i}return g()(t,e),o()(t,[{key:"getPreloadData",value:function(){return ve.a.getTableData(this._id)}},{key:"getMetadata",value:function(e){return ve.a.getValue(this._id+"_"+e)}},{key:"setMetadata",value:function(e,t){ve.a.setValue(this._id+"_"+e,t)}},{key:"removeMetadata",value:function(e){ve.a.deleteValue(this._id+"_"+e)}},{key:"clearMetadata",value:function(){var e=this;this._metadataKeys&&this._metadataKeys.forEach(function(t){return e.removeMetadata(t)})}},{key:"hasEntry",value:function(){var e=wt()(St.a.mark(function e(t){var a;return St.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getEntry(t);case 2:return a=e.sent,e.abrupt("return",void 0!==a);case 4:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=wt()(St.a.mark(function e(t,a){var i;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this._useInMemoryStore&&(i=this.getEntrySync(t)),void 0===i&&(i=ve.a.getTableValue(this._id,t)),void 0!==i){e.next=6;break}return e.next=5,ve.a.tableGet(this._id,t);case 5:i=e.sent;case 6:return i&&a&&(i=m.default.cloneDeep(i)),e.abrupt("return",i);case 8:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"removeEntry",value:function(){var e=wt()(St.a.mark(function e(a){var i;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore?f()(c()(t.prototype),"removeEntrySync",this).call(this,a):(i=ve.a.getTableData(this._id))&&delete i[a],e.abrupt("return",ve.a.tableDelete(this._id,a));case 2:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveEntry",value:function(){var e=wt()(St.a.mark(function e(a,i){var n;return St.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(n=ve.a.getTableValue(this._id,a.id),!(!n||(i?i(n,a):n!==a&&!m.default.deepEqual(n,a,!0)))){e.next=6;break}return this._useInMemoryStore?f()(c()(t.prototype),"saveEntrySync",this).call(this,a):ve.a.setTableValue(this._id,a.id,a),e.abrupt("return",ve.a.tablePut(this._id,a));case 6:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){var e=wt()(St.a.mark(function e(){return St.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore&&f()(c()(t.prototype),"clearCacheSync",this).call(this),e.abrupt("return",ve.a.tableClear(this._id));case 2:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getFilterEntries",value:function(){var e=wt()(St.a.mark(function e(t){return St.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",ve.a.tableFilter(this._id,t));case 1:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ensureTableLoaded",value:function(e){return ve.a.ensureTableLoaded(this._id,e)}}]),t}(Bi),Vi=5e3,Hi="MDC_",ji=(Fa=function(e){function t(e,a){var i;if(r()(this,t),a){try{m.default.PAssert(1194,!a.noInMemoryCache,"Invalid in-memory cache option")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1195,!a.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(s){m.default.reportError(s)}a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1}if(i=u()(this,c()(t).call(this,e,a)),a?(i.saveTime=isNaN(a.saveTime)?Vi:a.saveTime,a.writeOnUnload&&k.a.listen("onUnload",i.writeCache),a.clearBackingOnLoad&&(i.clearBackingOnLoad=!0,k.a.listen("enterForeground",i.clearBackingStore))):i.saveTime=Vi,i.storageKey=Hi+i._id,i._cache=ve.a.getValue(i.storageKey)||{},m.default.isString(i._cache))try{var n=JSON.parse(i._cache);i._cache=n}catch(o){}return i._saveTimeout=void 0,i}return g()(t,e),o()(t,[{key:"_onWrite",value:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))}},{key:"writeCache",value:function(){if(sr.settings.activeUser.get()){var e=this._getRawInMemoryCache();try{ve.a.setValue(this.storageKey,e)}catch(t){m.default.reportError(t)}}}},{key:"getStorageType",value:function(){return v.a.StorageType.LocalStorage}},{key:"removeEntrySync",value:function(e){delete this._cache[e],this._onWrite()}},{key:"getEntrySync",value:function(e){return this._cache[e]}},{key:"saveEntrySync",value:function(e){var t=e.id,a=e.value;void 0===a||null===a?delete this._cache[t]:this._cache[t]=a,this._onWrite()}},{key:"clearCacheSync",value:function(){f()(c()(t.prototype),"clearCacheSync",this).call(this),this._onWrite(!0)}},{key:"clearBackingStore",value:function(){ve.a.deleteValue(this.storageKey)}}]),t}(Bi),D()(Fa.prototype,"writeCache",[C.a],Object.getOwnPropertyDescriptor(Fa.prototype,"writeCache"),Fa.prototype),D()(Fa.prototype,"clearBackingStore",[C.a],Object.getOwnPropertyDescriptor(Fa.prototype,"clearBackingStore"),Fa.prototype),Fa),zi=function(){function e(){r()(this,e),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}return o()(e,[{key:"init",value:function(){this._storageReady[v.a.StorageType.InMemory]=!0,this._storageReady[v.a.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(e,t,a){try{m.default.PAssert(1001,e,"Must provide a valid cache ID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1002,void 0===this._registeredCaches[e],"Must not have a previously registered cache with the same id")}catch(n){m.default.reportError(n)}var i;switch(m.default.shouldWriteLocal()||(t=v.a.StorageType.InMemory,a&&(a.noInMemoryCache=!1,a.noMetadataInMemoryCache=!1)),t){case v.a.StorageType.InMemory:break;case v.a.StorageType.LocalStorage:i=new ji(e,a);break;case v.a.StorageType.IndexedDB:i=new Ui(e,a)}try{m.default.PAssert(1003,i,"Must have valid cache after creation")}catch(n){m.default.reportError(n)}return this._registeredCaches[e]=i,i}},{key:"_notifyIDBReady",value:function(e){}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==sr.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,m.default.reportError(new Error("Quota exceeded!")))}}]),e}(),qi=(Na=function(){function e(t,a,i,n,s,o,l,u,d){r()(this,e),this._id=t,this._remoteID=s,this._type=a;try{m.default.PAssert(1196,m.default.isDateValid(i),"Must specify a valid schedule date for deferred task")}catch(c){m.default.reportError(c)}this._scheduleDate=i,this._timeout=void 0,this._data=o,this._cbRun=l,this._cbCancel=u,this._cbPersistRemote=d,this._hasRun=!1,this._isCanceled=n,this._destroyed=!1}return o()(e,[{key:"schedule",value:function(){var e=this;try{m.default.PAssert(1197,!this._timeout,"Should not schedule the same task multiple times")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1198,!this._hasRun,"Should not schedule a task once it has already run once")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1199,!this._isCanceled,"Should not schedule canceled tasks")}catch(a){m.default.reportError(a)}var t=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,t),!this._remoteID&&t>0&&ye.a.onLoaded(function(){try{e._cbPersistRemote(e,e._onPersistedRemote)}catch(t){m.default.reportError(t)}})}},{key:"_onCanceled",value:function(e){e&&(this._destroyed=!0,sr.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(e,t){e&&(this._remoteID=t,sr.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(e){try{m.default.PAssert(1200,!this._hasRun,"Should never reschedule a task that has already run")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1201,!this._isCanceled,"Should not reschedule canceled tasks")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1202,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(t){m.default.reportError(t)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}},{key:"cancel",value:function(){var e=this;try{m.default.PAssert(1203,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1204,!this._hasRun,"Should not cancel tasks that have already been run")}catch(t){m.default.reportError(t)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&ye.a.onLoaded(function(){try{e._cbCancel(e,e._onCanceled)}catch(t){m.default.reportError(t)}}),sr.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){m.default.reportError(e)}sr.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}]),e}(),D()(Na.prototype,"_onCanceled",[C.a],Object.getOwnPropertyDescriptor(Na.prototype,"_onCanceled"),Na.prototype),D()(Na.prototype,"_onPersistedRemote",[C.a],Object.getOwnPropertyDescriptor(Na.prototype,"_onPersistedRemote"),Na.prototype),D()(Na.prototype,"runTask",[C.a],Object.getOwnPropertyDescriptor(Na.prototype,"runTask"),Na.prototype),Na),Wi=function(){function e(){r()(this,e),this._registeredTypes={},this._deferredTasks={},this._stats={}}return o()(e,[{key:"init",value:function(){var e=0;this._taskCache=sr.cacheManager.registerLocalCache("DeferredTasks",v.a.StorageType.LocalStorage);for(var t=this._taskCache.getFilterEntriesSync(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t[a];this.scheduleTask(i.id,i.type,new Date(i.scheduleDate),i.isCanceled,i.remoteID,i.data,!0)}}},{key:"getLastSyncDate",value:function(){var e=sr.settings.lastTaskSync.get();try{m.default.PAssert(989,!e||m.default.isString(e),"Must have a valid string sync date")}catch(t){m.default.reportError(t)}return e}},{key:"getStats",value:function(){return{}}},{key:"registerTaskType",value:function(e,t,a,i){try{m.default.PAssert(990,!this._registeredTypes[e],"Must not double register task type")}catch(n){m.default.reportError(n)}try{m.default.PAssert(991,m.default.isFunction(t),"Must register a valid run callback")}catch(n){m.default.reportError(n)}try{m.default.PAssert(992,m.default.isFunction(a),"Must register a valid cancel callback")}catch(n){m.default.reportError(n)}try{m.default.PAssert(993,m.default.isFunction(i),"Must register a valid persist callback")}catch(n){m.default.reportError(n)}this._registeredTypes[e]={cbRun:t,cbCancel:a,cbPersistRemote:i}}},{key:"_notifyTaskComplete",value:function(e){this._removeTask(e)}},{key:"scheduleTask",value:function(e,t,a,i,n,r,s){try{m.default.PAssert(994,e,"Must supply a valid task ID")}catch(d){m.default.reportError(d)}try{m.default.PAssert(995,t,"Must supply a valid task type")}catch(d){m.default.reportError(d)}try{m.default.PAssert(996,m.default.isDateValid(a),"Must always have a valid scheduled date available")}catch(d){m.default.reportError(d)}try{m.default.PAssert(997,this._registeredTypes[t],"Must request a valid registered task type")}catch(d){m.default.reportError(d)}if(this._deferredTasks[e]){var o=this._deferredTasks[e];try{m.default.PAssert(998,o.getType()===t,"Task types must match")}catch(d){m.default.reportError(d)}try{m.default.PAssert(999,o.getScheduleDate().equals(a),"Task schedule dates must match")}catch(d){m.default.reportError(d)}}else{var l=this._registeredTypes[t];if(l){var u=new qi(e,t,a,i,n,r,l.cbRun,l.cbCancel,l.cbPersistRemote);if(this._deferredTasks[e]){m.default.log("Overriding existing task");try{m.default.PAssert(1e3,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(d){m.default.reportError(d)}}this._addTask(e,u,s),i?u.cancel():u.schedule()}}}},{key:"cancelTask",value:function(e,t){this._deferredTasks[e].cancel()}},{key:"_updateTask",value:function(e){var t=this._deferredTasks[e];this._taskCache.saveEntrySync(t.getSaveData())}},{key:"_addTask",value:function(e,t,a){this._deferredTasks[e]=t,a||this._updateTask(e)}},{key:"_removeTask",value:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntrySync(e)}}]),e}(),Gi=a(104),Ki="Suspend",Yi="Resume",Xi="AsyncSkip",Qi="SyncSkip",Ji="Run",Zi="AsyncBegin",$i="AsyncComplete",en="AsyncAbort",tn="AsyncTimeout",an=(Ba=function(){function e(t,a){r()(this,e);try{m.default.PAssert(1205,a,"Must provide a valid set of task options: "+t)}catch(i){m.default.reportError(i)}this._id=t,this._iterationID=void 0,this._isAsync=a.async,this._isAsyncRunning=!1;try{m.default.PAssert(1207,a.task&&m.default.isFunction(a.task),"Must provide a valid task function")}catch(i){m.default.reportError(i)}this._task=a.task,this._delay=a.delay;try{m.default.PAssert(1208,void 0===a.asyncTimeout||a.async,"Should never specify an async timeout for a non-async task")}catch(i){m.default.reportError(i)}this._asyncTimeout=a.asyncTimeout||0,this._pauseWhileIdle=a.pauseWhileIdle||!1,this._minDelayOnResume=a.minDelayOnResume||!1;try{m.default.PAssert(1209,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(i){m.default.reportError(i)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=a.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=a.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new Gi.a(10),this._actions=new Gi.a(20),this.init()}return o()(e,[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(en),this._notifyAsyncAborted()}},{key:"performAction",value:function(e){try{m.default.PAssert(1210,e,"Invalid action reported")}catch(t){m.default.reportError(t)}this._actions.push({action:e,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(Ki),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction(Yi);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{m.default.PAssert(1211,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(a){m.default.reportError(a)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(Xi)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(Qi)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(Ji)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(Zi),this._isAsyncRunning=!0,this._iterationID=m.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction($i),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(tn),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(e){var t=this,a=arguments;try{m.default.PAssert(1212,!this._isCancelled,"Should never run a cancelled task")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1214,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(n){m.default.reportError(n)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var i=this._notifyAsyncBegin();try{this._task(function(){try{m.default.PAssert(1216,i===t._iterationID,"Callback is only valid while task is considered running")}catch(n){m.default.reportError(n)}t._notifyAsyncComplete(),e&&e.apply(t,a)})}catch(r){m.default.reportError(r),this._notifyAsyncComplete()}}else try{this._task()}catch(r){m.default.reportError(r)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(e){this._runUpdate(e)}},{key:"breakOnNextUpdate",value:function(){0}}]),e}(),D()(Ba.prototype,"_notifyAsyncComplete",[C.a],Object.getOwnPropertyDescriptor(Ba.prototype,"_notifyAsyncComplete"),Ba.prototype),D()(Ba.prototype,"_handleAsyncAbortTimeout",[C.a],Object.getOwnPropertyDescriptor(Ba.prototype,"_handleAsyncAbortTimeout"),Ba.prototype),D()(Ba.prototype,"_runUpdate",[C.a],Object.getOwnPropertyDescriptor(Ba.prototype,"_runUpdate"),Ba.prototype),Ba),nn=function(){function e(){r()(this,e),this._tasks={}}return o()(e,[{key:"init",value:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))}},{key:"getStats",value:function(){var e=this,t={};return Object.keys(this._tasks).forEach(function(a){return t[a]=e._tasks[a].getStats()}),t}},{key:"createRecurringTask",value:function(e,t){try{m.default.PAssert(1004,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(i){m.default.reportError(i)}var a=new an(e,t);return this._tasks[e]=a,a}},{key:"getRecurringTask",value:function(e){try{m.default.PAssert(1005,this._tasks[e],"Must only retreive a valid recurring task")}catch(t){m.default.reportError(t)}return this._tasks[e]}},{key:"hasRecurringTask",value:function(e){return!!this._tasks[e]}},{key:"cancelRecurringTask",value:function(e){try{m.default.PAssert(1006,this._tasks[e],"Must only cancel a valid recurring task")}catch(t){m.default.reportError(t)}this._tasks[e].cancel(),delete this._tasks[e]}},{key:"_handleFocus",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}}]),e}(),rn=(Ua=function(){function e(){r()(this,e),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._itemHeightsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}return o()(e,[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:m.default.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,sr.PaneManager.runForEachPane(function(a){(e||a.isItemsDirty())&&a.updateItemsImmediate(t,e)}),this._isUpdating=!1)}},{key:"updateWatchdog",value:function(){m.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{m.default.PAssert(366,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(e){m.default.reportError(e)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++}},{key:"commitUpdateItems",value:function(e,t){try{m.default.PAssert(369,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(a){m.default.reportError(a)}this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0,!this._itemsDirty&&this._itemHeightsDirty&&this._updateAllItemHeights(),this._itemHeightsDirty=!1),this._itemsDirty&&this.updateAllItems(e,t)}},{key:"flushItemsUpdate",value:function(e){this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()))}},{key:"updateAllItems",value:function(e,t){try{m.default.PAssert(370,void 0===e||m.default.isBoolean(e),"Must supply a bool param for updateSearch")}catch(a){m.default.reportError(a)}try{m.default.PAssert(371,void 0===t||m.default.isBoolean(t),"Must supply a bool param for forceNotify")}catch(a){m.default.reportError(a)}this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}},{key:"_updateAllItemHeights",value:function(){sr.PaneManager.runForEachPane(function(e){e.itemsHeightDirty&&e.updateItemHeights()})}},{key:"updateAllItemHeights",value:function(){0===this._isWaitingUpdateItems?this._updateAllItemHeights():this._itemHeightsDirty=!0}}]),e}(),D()(Ua.prototype,"checkItemsUpdated",[C.a],Object.getOwnPropertyDescriptor(Ua.prototype,"checkItemsUpdated"),Ua.prototype),D()(Ua.prototype,"updateWatchdog",[C.a],Object.getOwnPropertyDescriptor(Ua.prototype,"updateWatchdog"),Ua.prototype),Ua),sn=a(47),on=0,ln=(Va=function(){function e(t,a){r()(this,e);try{m.default.PAssert(625,t,"Must provide valid message info")}catch(i){m.default.reportError(i)}try{m.default.PAssert(626,a,"Must provide a valid message owner")}catch(i){m.default.reportError(i)}if(this.info=t,this.id=t.id||"Message_"+on++,this.owner=a,this.timeout=t.timeout||v.a.ToastTimeoutDefault,this.text=new z.a(t.text),this.action=t.action||v.a.MessageAction.Default,this.isBig=t.big,this.data=t.data,this.hold=!t.timeout&&!1!==t.hold&&(t.hold||this.action!==v.a.MessageAction.Default),this.noIgnore=t.noIgnore,this.onCloseFn=t.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=t.actionText,!this.actionText)switch(this.action){case v.a.MessageAction.Default:this.actionText="";break;case v.a.MessageAction.Reload:case v.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case v.a.MessageAction.Okay:this.actionText="OKAY";break;case v.a.MessageAction.Blog:this.actionText="BLOG";break;case v.a.MessageAction.Undo:this.actionText="UNDO";break;case v.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case v.a.MessageAction.Contact:this.actionText="CONTACT";break;case v.a.MessageAction.OpenSettings:case v.a.MessageAction.OpenAccountSettings:case v.a.MessageAction.OpenLinkedSettings:case v.a.MessageAction.OpenGeneralSettings:case v.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case v.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case v.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case v.a.MessageAction.StartDemo:this.actionText="START DEMO"}}return o()(e,[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(e){if(this.isVisible()){if(m.default.isFunction(this.action))this.action();else switch(this.action){case v.a.MessageAction.None:case v.a.MessageAction.Okay:case v.a.MessageAction.Default:break;case v.a.MessageAction.Reload:m.default.reload();break;case v.a.MessageAction.LoginScreen:L.a.removeURLParam("demo");break;case v.a.MessageAction.Demo:L.a.insertURLParam("demo","true");break;case v.a.MessageAction.ResetClient:break;case v.a.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{m.default.PAssert(627,t,"Should always have a valid URL to navigate")}catch(a){m.default.reportError(a)}t&&m.default.openUrl(t);break;case v.a.MessageAction.Blog:m.default.openUrl("https://www.moo.do/blog/updates");break;case v.a.MessageAction.Undo:sn.a.undo();break;case v.a.MessageAction.LoginScreen:L.a.removeURLParam("demo",!0),L.a.removeURLParam("dmode");break;case v.a.MessageAction.Contact:sr.menus.openModal(v.a.Modals.ReportBug);break;case v.a.MessageAction.OpenSettings:sr.menus.openSettings(v.a.SettingsSections.Plugins);break;case v.a.MessageAction.OpenGeneralSettings:sr.menus.openSettings(v.a.SettingsSections.General);break;case v.a.MessageAction.OpenAccountSettings:sr.menus.openSettings(v.a.SettingsSections.Account);break;case v.a.MessageAction.OpenLinkedSettings:sr.menus.openSettings(v.a.SettingsSections.Linked);break;case v.a.MessageAction.OpenCalendarSettings:sr.menus.openSettings(v.a.SettingsSections.GoogleCalendar);break;case v.a.MessageAction.OpenGoogleDrive:m.default.openUrl("https://drive.google.com");break;case v.a.MessageAction.OpenDisplaySettings:m.default.vmMain.isDisplaySettingsOpen.set(!0);break;case v.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{m.default.PAssert(628,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(a){m.default.reportError(a)}}e&&m.default.stopPropagation(e),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(e){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(e){this.text.set(e)}}]),e}(),D()(Va.prototype,"hide",[C.a],Object.getOwnPropertyDescriptor(Va.prototype,"hide"),Va.prototype),D()(Va.prototype,"onTapIgnore",[C.a],Object.getOwnPropertyDescriptor(Va.prototype,"onTapIgnore"),Va.prototype),Va),un=function(){function e(){r()(this,e),this.queue=new q.a,this.defaultMessages=[],this.defaultMessages[v.a.MessageID.Undefined]=void 0}return o()(e,[{key:"getMessageById",value:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{m.default.PAssert(473,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(t){m.default.reportError(t)}return this.defaultMessages[e]}},{key:"testMessageById",value:function(e){return!!this.defaultMessages[e]}},{key:"initMessageById",value:function(e){var t;switch(e){case v.a.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:v.a.MessageAction.Reload};break;case v.a.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case v.a.MessageID.FatalError:t={text:"There was a fatal error in the application. "+x.a.actionVerbCaps()+" to restart.",action:v.a.MessageAction.Reload};break;case v.a.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:v.a.MessageAction.Okay};break;case v.a.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:v.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case v.a.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:v.a.MessageAction.OpenSettings,timeout:8e3};break;case v.a.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case v.a.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:v.a.MessageAction.OpenAccountSettings};break;case v.a.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:v.a.MessageAction.Okay};break;case v.a.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:v.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case v.a.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:v.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case v.a.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:v.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case v.a.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:v.a.MessageAction.OpenGoogleDrive};break;case v.a.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:v.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case v.a.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:v.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case v.a.MessageID.LostPermission:t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:v.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case v.a.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:v.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case v.a.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case v.a.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case v.a.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case v.a.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:function(){sr.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case v.a.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case v.a.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:v.a.MessageAction.StartDemo};break;case v.a.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:v.a.MessageAction.Okay};break;case v.a.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:v.a.MessageAction.OpenSettings};break;case v.a.MessageID.NeedGmailPermission:t={text:"Sending email requires the Gmail plugin to be enabled in settings.",action:v.a.MessageAction.OpenSettings};break;case v.a.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:v.a.MessageAction.OpenLinkedSettings};break;case v.a.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:v.a.MessageAction.Okay};break;case v.a.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:v.a.MessageAction.Reload};break;case v.a.MessageID.MissingOffline:case v.a.MessageID.MissingOfflineMobile:t={text:"We are missing authorization for your account. Please reauthorize.",actionText:"REAUTHORIZE",action:function(){he.a.enableOfflineFeatures(!0)}};break;case v.a.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case v.a.MessageID.FlatSearchEnter:t={text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."};break;case v.a.MessageID.FlatSearchTab:t={text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."};break;case v.a.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case v.a.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case v.a.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case v.a.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case v.a.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){sr.menus.openModal(v.a.Modals.ReportBug)}};break;case v.a.MessageID.PaneLoadTimeout:t={text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:m.default.reload};break;default:try{m.default.PAssert(474,!1,"Invalid MessageID: ",e)}catch(a){m.default.reportError(a)}}t&&(this.defaultMessages[e]=new ln(t,this))}},{key:"pushMessage",value:function(e){try{m.default.PAssert(475,e,"Must supply a valid message to display")}catch(a){m.default.reportError(a)}var t;if(e instanceof ln)t=e;else if(m.default.isObject(e))this.hasMsgWithText(e.text)||(t=new ln(e,this));else if(m.default.isString(e))this.hasMsgWithText(e)||(t=new ln({text:e},this));else if(!(t=this.getMessageById(e))){try{m.default.PAssert(476,!1,"Invalid data passed to message creation")}catch(a){m.default.reportError(a)}m.default.log("Message not created properly",e)}return t&&t.show(),t}},{key:"clearMessage",value:function(e){var t;return e instanceof ln?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}},{key:"isMessageVisible",value:function(e){var t=!1;e instanceof ln?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t}},{key:"onMessageShow",value:function(e){try{m.default.PAssert(477,e,"Must pass in a valid message to add to the queue")}catch(t){m.default.reportError(t)}try{m.default.PAssert(478,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(t){m.default.reportError(t)}e instanceof ln?this.queue.push(e):m.default.reportError(new Error("Toast message must be an instance of Toast"),e)}},{key:"onMessageHide",value:function(e){try{m.default.PAssert(479,e,"Must pass in a valid message to be removed from the queue")}catch(a){m.default.reportError(a)}var t=this.queue.indexOf(e);if(t<0)try{m.default.PAssert(480,!1,"Trying to remove an invalid message from the queue")}catch(a){m.default.reportError(a)}else this.queue.splice(t,1)}},{key:"hasMsgWithText",value:function(e){return!!this.queue.get().find(function(t){return t.text.get()===e})}}]),e}(),dn=function(){function e(){r()(this,e)}return o()(e,[{key:"init",value:function(){}},{key:"render",value:function(e,t){var a,i=0,n=[],r=t.convertSpaces,s=t.pane,o=t.noPrefix,l=t.suffix,u=t.highlightSearch,d=t.item,c=t.showMarkdown,h=!1;try{m.default.PAssert(502,e,"C Item has no els: ")}catch(C){m.default.reportError(C)}e||(e=[]);for(var f=0;f<e.length;++f){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var p=e[f],g=p.getAttrs(),y="",k="",_=p.getStyledText(s,!0,d,{highlightSearch:u});if(!u||g&&p.hasClass("plugin")?p.hasClass("plugin")||(_=m.default.escape(_)):_=this.replaceTextWithSearch(_,s),r&&(_=_&&_.replace(/ /g,"&nbsp;")),!o||!p.hasClass("itemPrefix"))if(g){if(s&&!s.plugin&&p.hasClass("plugin_drive_image_inline")){var S=sr.pluginManager.getPluginDrive(),P=S.getAttachment(p.getAttr("plugin-id")),w=S.getAttachUrl(P);if(w)return{isImage:!0,isDriveImage:!0,maxWidth:S.getAttachWidth(P),src:w,srcDataUrl:S.getAttachDataUrl(P),text:p.getParsedText(),originalText:p.getParsedText(),previousText:n.join(""),attach:P,nextText:f<e.length-1?" ":""}}if(!c&&p.hasClass("mdImage"))return{isImage:!0,src:p.getAttr("data-href"),text:p.getParsedText(),maxWidth:p.getAttr("size"),originalText:p.getAttr("data-original-text"),previousText:n.join(""),nextText:f<e.length-1?" ":""};var I="",b="",D=p.getClassString();for(var E in p.getAttr("appLink")&&(h||(I+='<span class="appLink '+((p.hasClass("evernote")?"Evernote":"")||(p.hasClass("onenote")?"OneNote":"")||(p.hasClass("bear")?"Bear":""))+'">',I+='<span contenteditable="false"'+(p.getAttr("appLinkStart")?' class="appLinkStart"':"")+"></span>"),h=!0),p.hasClass("plugin")&&(_="<span>"+_+"</span>"),I+="<span ",b+=">"+_+"</span>",p.hasClass("plugin")&&(I+='contenteditable="false" '),g)g.hasOwnProperty(E)&&("cls"===E?("mdImage"===D&&c||(k='class="'+D+'" '),"itemPrefix"===g[E][0]&&(a=!0)):"appLink"!==E&&(y+=E+'="'+g[E]+'" '));!h||f!==e.length-1&&e[f+1].getAttr("appLink")||(b+="</span>",h=!1),k||y?n.push(I+(k||"")+(y?" "+y:"")+b):n.push(_)}else n.push(_)}return a&&1===e.length&&n.push("<span>"+v.a.TextSpace+"</span>"),l&&n.push(l),n.join("")}},{key:"replaceTextWithSearch",value:function(e,t){for(var a=0,i=t.search.getSearchWords(),n=e.toLowerCase(),r=[],s=e.length+1,o=0;o<i.length;o++){var l=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var u=i[o],d=void 0,c=void 0;(d=n.indexOf(u,c))>=0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(d>=0)for(var h=0,f=d;f<d+u.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;(isNaN(s)||f<s)&&(s=f),r[f]=!0}c=d+1}}if(s<=e.length)for(var p=0,g=-1,v=!0,y=e.length-1;y>=s-1;y--){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(g>=0&&(y<0||!r[y])){var k=e.substring(y+1,g+1),_=e.substr(g+1),S=e.substr(0,y+1);y===s&&(S=m.default.escape(S)),v&&(_=m.default.escape(_),v=!1),e=S+'<span class="c-search-highlight">'+m.default.escape(k)+"</span>"+_,g=-1}r[y]&&g<0&&(g=y)}else e=m.default.escape(e);return e}},{key:"renderRichText",value:function(e,t){}}]),e}(),cn=a(51),hn=function(){function e(){r()(this,e)}return o()(e,[{key:"init",value:function(){this.storage=cn.a.storage()}},{key:"uploadString",value:function(){var e=wt()(St.a.mark(function e(t,a){var i=this;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=i.storage.ref(t).putString(a);r.on("state_changed",function(e){},function(e){n(e)},function(){r.snapshot.ref.getDownloadURL().then(function(t){return e(t)})})}));case 1:case"end":return e.stop()}}},e)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"getString",value:function(){var e=wt()(St.a.mark(function e(t){var a,i;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.storage.ref(t).getDownloadURL();case 2:if(!(a=e.sent)){e.next=14;break}return e.prev=4,e.next=7,fetch(a);case 7:return i=e.sent,e.abrupt("return",i.text());case 11:e.prev=11,e.t0=e.catch(4),m.default.reportError(e.t0);case 14:case"end":return e.stop()}}},e,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),fn=a(84),pn=new(function(){function e(){r()(this,e)}return o()(e,[{key:"deriveKey",value:function(e,t){var a=(new TextEncoder).encode(e),i=fn.a.str2ab(t);return crypto.subtle.importKey("raw",a,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then(function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"])}).then(function(e){return e})}},{key:"importKey",value:function(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(e){return crypto.subtle.exportKey("raw",e)}},{key:"encrypt",value:function(e,t,a){var i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.encrypt(i,t,e)}},{key:"decrypt",value:function(e,t,a){var i={name:"AES-CTR",counter:a,length:128};return crypto.subtle.decrypt(i,t,e)}}]),e}()),gn=new(function(){function e(){r()(this,e)}return o()(e,[{key:"key",value:function(e,t){return pn.deriveKey(e,t)}},{key:"saltToCounter",value:function(e){var t=fn.a.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){for(var a=0,i=new Uint8Array(16),n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n]=t[n]}t=i}return t}},{key:"encrypt",value:function(e,t,a){var i=this.saltToCounter(a),n=fn.a.unicode2ab(e);return pn.encrypt(n,t,i).then(function(e){return fn.a.ab2str(e)})}},{key:"decrypt",value:function(e,t,a){var i=this.saltToCounter(a),n=fn.a.str2ab(e);return pn.decrypt(n,t,i).then(function(e){return fn.a.ab2unicode(e)})}}]),e}()),mn="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",vn=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function yn(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,yn):this.stack=(new Error).stack}function kn(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,kn):this.stack=(new Error).stack}yn.prototype=Object.create(Error.prototype),yn.prototype.name="InvalidArgumentError",yn.prototype.constructor=yn,kn.prototype=Object.create(yn.prototype),kn.prototype.name="InvalidPasswordError",kn.prototype.constructor=kn;var _n=(Ha=function(){function e(){var t=this;r()(this,e),this.sentinel=v.a.EncryptionSentinel,this.keys={},this.onLoadCbs=[],this.onUpdated=new W.a,this.importKeys({}).then(function(){t.isLoaded=!0,t.onLoadCbs.forEach(function(e){return e()})})}return o()(e,[{key:"onLoad",value:function(e){this.isLoaded?e():this.onLoadCbs.push(e)}},{key:"canDecryptSentinel",value:function(e){return!!this.getKeyBySentinel(e)}},{key:"getKeyBySentinel",value:function(e){for(var t in this.keys)if(this.keys[t].sentinel===e)return this.keys[t].key}},{key:"encryptSentinel",value:function(e,t){return gn.encrypt(this.sentinel,e,t)}},{key:"createKeyInfo",value:function(e){var t=this,a=e.name,i=e.password,n=e.sentinelSalt;return gn.key(i,mn).then(function(e){return t.encryptSentinel(e,n).then(function(t){return{name:a,key:e,sentinel:t}})})}},{key:"importKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(t[v.a.EncryptionKeys.Global]=vn),t[v.a.EncryptionKeys.UserPassword]&&!qe.a.getEncryptionUid()?new Promise(function(a){sr.settings.userId.onHasValue(function(i){e.importKeys(t).then(function(e){return a(e)})})}):Promise.all(Object.keys(t).map(function(a){var i=t[a],n=(a===v.a.EncryptionKeys.Global?mn:a===v.a.EncryptionKeys.UserPassword&&qe.a.getEncryptionUid())||a;return i instanceof CryptoKey?e.encryptSentinel(i,n).then(function(t){e.keys[a]={name:a,key:i,sentinel:t}}):(m.default.isString(i)&&(i=fn.a.str2ab(i)),pn.importKey(i).then(function(t){return e.encryptSentinel(t,n).then(function(i){e.keys[a]={name:a,key:t,sentinel:i}})}))})).then(function(){return e.keys}).catch(function(t){return console.log(t),e.onUpdated.notify(),e.keys})}},{key:"getGlobalKeyInfo",value:function(){return this.keys[v.a.EncryptionKeys.Global]}},{key:"getGlobalKey",value:function(){return this.keys[v.a.EncryptionKeys.Global].key}},{key:"getKey",value:function(e){return this.keys[e].key}},{key:"getKeyInfo",value:function(e){return this.keys[e]}},{key:"setKey",value:function(e){var t=this,a=e.name,i=e.password,n=e.sentinelSalt;return this.createKeyInfo({name:a,password:i,sentinelSalt:n}).then(function(e){return t.keys[a]=e,t.onUpdated.notify(),e})}},{key:"canDecrypt",value:function(e){var t=e.source,a=e.target,i=e.key;return gn.decrypt(t,i.key,i.salt).then(function(e){return e===a})}},{key:"findDecryptKeys",value:function(e){var t=e.source,a=e.target,i=e.keys,n=m.default.objectValues(i).map(function(e){return gn.decrypt(t,e.key,e.salt).then(function(t){return{name:e,text:t}})});return Promise.all(n).then(function(e){return e.filter(function(e){return e.text===a}).map(function(e){return e.name})})}},{key:"addKey",value:function(e){var t=e.name,a=e.password,i=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new yn("Name must be a string. Saw: ".concat(t))):t in this.keys?Promise.reject(new yn("".concat(t," exists. Use 'updateKey' to change existing keys."))):this.setKey({name:t,password:a,sentinelSalt:i})}},{key:"updateKey",value:function(e){var t=e.name,a=e.password,i=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new yn("Name must be a string. Saw: ".concat(t))):t in this.keys?this.setKey({name:t,password:a,sentinelSalt:i}):Promise.reject(new yn("".concat(t," does not exist. Use 'addKey' to add new key.")))}},{key:"removeKey",value:function(e){delete this.keys[e]}},{key:"createKey",value:function(e){var t=e.name,a=e.password,i=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new yn("Name must be a string. Saw: ".concat(t))):this.createKeyInfo({name:t,password:a,sentinelSalt:i})}},{key:"exists",value:function(e){return!!(e in this.keys)}},{key:"encryptText",value:function(e,t,a){var i="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;try{m.default.PAssert(376,i,"No valid encryption key")}catch(n){m.default.reportError(n)}return"string"!==typeof t?Promise.reject(new yn("Text must be a string. Saw: ".concat(t))):gn.encrypt(t,i,a)}},{key:"decryptText",value:function(e,t,a){var i="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;return"string"!==typeof t?Promise.reject(new yn("Text must be a string. Saw: ".concat(t))):gn.decrypt(t,i,a)}},{key:"exportKey",value:function(e){return pn.exportKey(e)}}]),e}(),D()(Ha.prototype,"addKey",[C.a],Object.getOwnPropertyDescriptor(Ha.prototype,"addKey"),Ha.prototype),D()(Ha.prototype,"updateKey",[C.a],Object.getOwnPropertyDescriptor(Ha.prototype,"updateKey"),Ha.prototype),Ha),Sn=function(){function e(){r()(this,e),this._items=new q.a}return o()(e,[{key:"addItemEntry",value:function(e,t){this.hasItemEntry(e)||this._items.push({id:e.id,item:e,pane:t})}},{key:"removeItemEntry",value:function(e){var t=this._items.indexOfWithProperty("id",e);if(t>=0)return this._items.splice(t,1)[0]}},{key:"hasItemEntry",value:function(e){var t=this.getItemEntry(e);return!(!t||t.isText)}},{key:"getItemEntry",value:function(e){var t=this._items.indexOfWithProperty("id",e.id);return this._items.get()[t]}},{key:"getItems",value:function(){return this._items}},{key:"hasItems",value:function(){return this._items.get().length>0}}]),e}(),Pn=function(){function e(){r()(this,e),this.modalStack=new q.a,this.contextMenuStack=new q.a,this.emailComposeStack=new q.a,L.a.forceBind("onClosingSettings",this)}return o()(e,[{key:"toggleContextMenu",value:function(e,t){this.isContextMenuOpen()?this.closeContextMenu():this.openContextMenu(e,t)}},{key:"openAddPaneMenu",value:function(e){sr.settings.testBetaFeatures.get()?(e.componentName="ReactContextMenuPaneView",e.isAddPane=!0):(e.componentName="ReactContextMenuAddPane",e.onSelected=function(e,t,a){sr.PaneManager.addPaneByButton(e,t,a)}),this.openContextMenu(e)}},{key:"openContextMenu",value:function(e,t){e.element&&m.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:sr.DesktopUI.getSidebarWidth()+4},e.side="right",m.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuNoFade=t,this.contextMenuStack.push(e)}},{key:"indexOfContextMenu",value:function(e){var t=this.contextMenuStack.get(),a=t.indexOfWithProperty("fn",e);return a<0&&(a=t.indexOfWithProperty("componentName",e)),a}},{key:"closeContextMenu",value:function(e,t,a){if(e){var i=this.indexOfContextMenu(e);try{m.default.PAssert(332,i>=0,"Tried to close a context menu that was not open")}catch(l){m.default.reportError(l)}if(i>=0){var n=this.contextMenuStack.get()[i];n.onClosed&&n.onClosed(t,a),this.contextMenuStack.removeAt(i)}}else{for(var r=0,s=this.contextMenuStack.get(),o=s.length-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s[o].onClosed&&s[o].onClosed(!1,a)}this.contextMenuStack.clear()}0===this.contextMenuStack.length()&&R.a.updateCaret()}},{key:"getTopContextMenu",value:function(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t[i].id===e)return!0}}},{key:"openModal",value:function(e,t){try{m.default.PAssert(333,void 0===t||m.default.isObject(t),"Must always pass in a valid object for params")}catch(a){m.default.reportError(a)}if(!this.isModalOpen(e)){t=t||{};try{m.default.PAssert(334,void 0===t.id,"Should not already have an ID defined with modal params")}catch(a){m.default.reportError(a)}t.id=e,R.a.reset(),this.modalStack.push(t)}}},{key:"closeModal",value:function(e,t){var a=this.modalStack.get().indexOfWithProperty("id",e);if(a>=0){var i=this.modalStack.get()[a],n=!0;i.onClosing&&(n=i.onClosing()),n&&(this.modalStack.removeAt(a),i.callback&&i.callback(t))}}},{key:"confirm",value:function(e,t){try{m.default.PAssert(335,t,"Confirm modals should have callbacks",e)}catch(a){m.default.reportError(a)}this.openModal(v.a.Modals.Confirm,{text:e,callback:t})}},{key:"prompt",value:function(e,t){try{m.default.PAssert(336,t,"Prompt modals should have callbacks",e)}catch(a){m.default.reportError(a)}this.openModal(v.a.Modals.Prompt,{text:e,callback:t})}},{key:"alert",value:function(e){try{m.default.PAssert(337,!e.action,"Still using an old style alert",e)}catch(t){m.default.reportError(t)}e.action&&(e.callback=e.action),this.openModal(v.a.Modals.Alert,e)}},{key:"options",value:function(e,t,a){try{m.default.PAssert(338,m.default.isArray(t),"Must have valid options array")}catch(i){m.default.reportError(i)}try{m.default.PAssert(339,a,"Options modal must have a callback")}catch(i){m.default.reportError(i)}this.openModal(v.a.Modals.Options,{text:e,options:t,callback:a})}},{key:"openSettings",value:function(e){F.d.performAction(F.b.UIAction,{type:F.c.OpenSettingsMenu}),this.openModal(v.a.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var e=!he.a.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(he.a.isSaveEnabled.set(!1),this.closeModal(v.a.Modals.Settings))}.bind(this)),e}},{key:"openDisplaySettings",value:function(){R.a.reset(),m.default.vmMain.isDisplaySettingsOpen.set(!0),F.d.performAction(F.b.UIAction,{type:F.c.OpenDisplaySettings})}},{key:"getUserEmail",value:function(){return sr.settings.getUserIdentifier()}},{key:"getUserName",value:function(){return m.default.isDemoMode()?"Demo":qe.a.getAccountName()}},{key:"_indexOfCompose",value:function(e){for(var t=0,a=this.emailComposeStack.get(),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].draftMsg.id===e)return i}return-1}},{key:"isComposeOpenForEmail",value:function(e){return e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0}},{key:"openComposeEmail",value:function(e,t,a,i){try{m.default.PAssert(340,e,"Must have a valid email plugin")}catch(r){m.default.reportError(r)}try{m.default.PAssert(341,!t||m.default.isString(t),"Must have a string threadID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(342,!a||m.default.isString(a),"Must have a string messageID")}catch(r){m.default.reportError(r)}if(R.a.reset(),this.isComposeOpenForEmail());else{var n=e.getDraftByID(e.getDefaultAccount(),t,a,i);try{m.default.PAssert(343,n,"Must always create a valid draft")}catch(r){m.default.reportError(r)}try{m.default.PAssert(344,this.emailComposeStack.indexOf(n)<0,"Must not double-open drafts, should re-use")}catch(r){m.default.reportError(r)}this.emailComposeStack.get().indexOfWithProperty("attach",n.attach)<0&&this.emailComposeStack.push(n)}F.d.miscAction({type:F.b.Misc,misc:F.a.ComposeEmail})}},{key:"closeComposeEmail",value:function(e,t){var a=this._indexOfCompose(t.id);try{m.default.PAssert(345,a>=0,"Must have found a valid composing email to remove")}catch(i){m.default.reportError(i)}this.emailComposeStack.removeAt(a)}},{key:"openItemEditor",value:function(e){var t=this,a=arguments;try{m.default.PAssert(346,!e.item===!!e.addOnSave,"Must be adding item if no item prop")}catch(r){m.default.reportError(r)}if(!e.item){e.parent||(e.parent=e.pane&&e.pane.type===v.a.PaneMode.Task?e.pane.getRootItem():_.a.getDefaultDocument().getRootItem());var i=_.a.createTempVMLI({text:e.text||sr.settings.getDefaultItemText(),date:e.mooDate},{changeType:v.a.ChangeType.AllLocal});e.item=i;var n=e.endSave;e.endSave=function(){setTimeout(function(){_.a.destroyTempVMLI(i.id)},0),n&&n.apply(t,a)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}},{key:"openLightbox",value:function(e,t,a){this.openModal(v.a.Modals.Lightbox,{src:e,buttonText:t,buttonAction:a})}},{key:"confirmEncrypt",value:function(e,t){this.openModal(v.a.Modals.ConfirmEncrypt,{password:e,onYes:function(){return t(!0)},onCancel:function(){return t(!1)}})}}]),e}(),wn=a(100),In=function(){function e(){r()(this,e),this.openOnPane=void 0,this.messageIDs=new q.a,this.messagesLoaded=new z.a(!1),this.isLoading=new z.a(!1),this.errorMessage=new z.a(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,L.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}return o()(e,[{key:"init",value:function(){var e=this;sr.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",function(t){if(m.default.getLocationOrigin()===t.origin&&t.data&&t.data.startsWith&&t.data.startsWith("-")){var a=t.data.indexOf("-",1),i=t.data.indexOf("-",a+1);i<0&&(i=void 0);var n=t.data.substring(1,a),r=t.data.substring(a+1,i),s=i?t.data.substring(i+1):void 0;m.default.batchRenderUpdates(function(){e.handleFrameMessage(r,n,s,t)})}}),k.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),x.a.onResize.listen(this._onWindowResize.bind(this))}},{key:"reset",value:function(e,t){if(this.threadAttach){for(var a=0,i=this.threadAttach.getField("messages"),n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[n].initializedForDisplay&&this._destroyMessageDisplay(i[n])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messageIDs.get().length>0&&this.messageIDs.set([],e)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[a].id,!0)}}},{key:"_onWindowResize",value:function(){m.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():sr.pluginManager.getPluginGmail()}},{key:"_sendReply",value:function(e,t,a){try{m.default.PAssert(481,e,"Must supply a valid target")}catch(n){m.default.reportError(n)}try{m.default.PAssert(482,t,"Must supply a valid action")}catch(n){m.default.reportError(n)}try{var i="-"+t+(void 0!==a?"-"+a:"");e.postMessage(i,"*")}catch(r){m.default.reportError(r)}}},{key:"handleFrameMessage",value:function(e,t,a,i){var n=this;switch(t){case"resize":try{var r=JSON.parse(a);this.updateMessageHeight(e,!0===r.canBeShorter,r.scale)}catch(p){m.default.reportError(p)}break;case"click":k.a.fireEvent("tapMain",[]);break;case"keypress":try{var s=JSON.parse(a);x.a.normalizeKeys(s),R.a.fireKeyEvent(document.documentElement,s)}catch(p){m.default.reportError(p)}break;case"href":if(a.startsWith("mailto:")){var o=this.parseMailtoURL(a.replace(/^mailto:/gi,"")),l={to:[{email:o.to}],subject:o.subject&&unescape(o.subject),body:o.body&&unescape(o.body).replace(/\r?\n/g,"<br>")};sr.menus.openComposeEmail(this.getPlugin(),void 0,void 0,l)}else m.default.openUrl(a);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{m.default.PAssert(483,i,"Must provide a valid request event")}catch(g){m.default.reportError(g)}if(this.threadAttach)for(var u=0,d=JSON.parse(a),c=0;c<d.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=d[c],f=!1;h.startsWith("attach:")&&(h=h.replace(/^attach:/gi,""),f=!0),this.getPlugin().loadResource(this.threadAttach.id,e,h,function(){var e=wt()(St.a.mark(function e(t,a){var r,s,o,l;return St.a.wrap(function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=10;break}if(!f){e.next=8;break}return e.next=4,n._createMessageHTML(n.getPlugin()._decodeEmail(t.data,void 0,{}),{},"text/html");case 4:o=e.sent,s=o.parsed,e.next=9;break;case 8:s=t.data;case 9:r={cid:a,data:s,mimeType:t.mimeType};case 10:try{i&&i.source&&r&&(l=f?"contentLoad":"resLoad",n._sendReply(i.source,l,r?JSON.stringify(r):void 0))}catch(d){m.default.reportError(d)}case 11:case"end":return e.stop()}}},e)}));return function(t,a){return e.apply(this,arguments)}}())}}catch(p){m.default.reportError(p)}break;default:m.default.log("Unknown message from child frame: ",e,t,a,i)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(e){return this.isOpen()&&this.threadAttach===e}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),this.reset(),this.wantsPaneTransition=!1,k.a.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}},{key:"_openPane",value:function(e,t){var a=this;try{m.default.PAssert(484,t,"Must supply a valid cb to openPane")}catch(i){m.default.reportError(i)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(function(){a.wantsPaneTransition=!1,t()},v.a.EmailOpenTime+100)):t(),this.setOpenPane(e)}},{key:"getPane",value:function(){try{m.default.PAssert(485,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){m.default.reportError(e)}return this.openOnPane}},{key:"startOpenOnLoad",value:function(e){this.setOpenPane(e,!1)}},{key:"open",value:function(e,t,a,i){var n=this;if(t!==this.threadAttach||a!==this.openOnPane){var r=t.getPlugin();this.reset(!0,!0),this.threadAttachLoading=t,sr.PaneManager.ensurePaneInView(a);var s=2,o=!1;if(i){this.messageIDs.listen(function(){var e=n.getMessages();if(e.length>0)return e[e.length-1].labelIds.indexOf("DRAFT")<0&&n.setLastMessageResponseMode(i),!1})}var l=function(){0===--s&&t===n.threadAttachLoading&&(o?(n._setThread(t,e),F.d.miscAction({type:F.b.Misc,misc:F.a.OpenEmail,data:{pane:a}})):n.errorMessage.get()?n.isLoading.set(!1):sr.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))};this._openPane(a,function(){l()}),r.loadThread(t,function(e,t,a){o=e,!e&&a?n.errorMessage.set(a):n.errorMessage.set(""),l()})}else i&&this.isOpen()&&this.setLastMessageResponseMode(i)}},{key:"_getReplyToFromMessage",value:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}},{key:"_getSenderFromMessage",value:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}},{key:"_selfSentMessage",value:function(e){return this.getPlugin().isMyAccountID(e.from.email)}},{key:"_removeSelf",value:function(e){if(e){for(var t=0,a=e.slice(0),i=this.getPlugin(),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i.isMyAccountID(a[n].email)&&(a.splice(n,1),n--)}return a}}},{key:"_findSelf",value:function(e,t){var a,i=this.getPlugin(),n=i.getSendingAccounts(e);if(n.indexOf(t.from.email)>=0)a=t.from.email;else{if(t.to)for(var r=0,s=0;s<t.to.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n.indexOf(t.to[s].email)>=0){a=t.to[s].email;break}}if(!a&&t.cc){var o=0;for(s=0;s<t.cc.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(n.indexOf(t.cc[s].email)>=0){a=t.cc[s].email;break}}}if(!a&&t.bcc){var l=0;for(s=0;s<t.bcc.length;++s){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(n.indexOf(t.bcc[s].email)>=0){a=t.bcc[s].email;break}}}}return a||(a=i.getDefaultSendingAccount(e)),{text:i.getDisplayName(a),email:a}}},{key:"_updateDraftFromMessage",value:function(e,t,a){var i,n,r,s,o=this.getPlugin(),l=e.subject,u=this._getSenderFromMessage(e);try{m.default.PAssert(486,a!==v.a.EmailResponseMode.Compose,"Should never pass Compose mode to _updateDraftFromMessage")}catch(c){m.default.reportError(c)}a===v.a.EmailResponseMode.Reply?i=this._getReplyToFromMessage(e):a===v.a.EmailResponseMode.ReplyAll?(i=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),n=this._removeSelf(e.cc)):a===v.a.EmailResponseMode.Forward&&(s=Object.assign({},e.resources)),a&&(r=o.createMessageBody(e,t.from.email,a)),i=m.default.arrayUniques(i||[],"email"),n=m.default.arrayUniques(n||[],"email"),a===v.a.EmailResponseMode.Reply||a===v.a.EmailResponseMode.ReplyAll?(0!==l.toLowerCase().indexOf("re")&&(l="Re: "+l),s=t.resources):a===v.a.EmailResponseMode.Forward&&0!==l.toLowerCase().indexOf("fwd")&&(l="Fwd: "+l);var d={id:t.id,to:i,from:u,cc:n,bcc:void 0,subject:l,decoded:r,resources:s||{}};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,d,!0,!1,function(e){try{m.default.PAssert(487,e,"Should always be able to update a draft")}catch(c){m.default.reportError(c)}})}},{key:"requestAttachment",value:function(e,t,a,i){this.getPlugin().loadResource(e,t,a,i)}},{key:"getAttachmentURL",value:function(e,t,a){return this.getPlugin().getAttachmentURL(e,t,a)}},{key:"getPreviewURL",value:function(e){return this.getPlugin().getPreviewURL(e)}},{key:"reportMessage",value:function(e,t,a,i,n){this.getPlugin().reportMessage(e,t,a,i,n)}},{key:"dumpMessage",value:function(e,t,a){try{m.default.PAssert(488,!1,"Should not be dumping message in non-__DEV__ modes")}catch(i){m.default.reportError(i)}this.getPlugin().dumpMessage(e,t,a)}},{key:"parseMailtoURL",value:function(e){var t={to:void 0,subject:void 0,body:void 0},a=e.split("?");if(t.to=a[0],a[1])for(var i=0,n=a[1].split("&"),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[r].split("=");switch(s[0].toUpperCase()){case"SUBJECT":t.subject=s[1];break;case"BODY":t.body=s[1]}}return t}},{key:"parseListUnsubscribe",value:function(e){for(var t=0,a={emailData:void 0,url:void 0},i=e.split(","),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(i[n]);if(r)switch(r[1]){case"http":case"https":a.url=r[1]+":"+r[2];break;case"mailto":a.emailData=this.parseMailtoURL(r[2]);break;default:try{m.default.PAssert(489,!1,"Unknown List Unsubscribe Format: "+e)}catch(s){m.default.reportError(s)}}}return a}},{key:"setMessageResponseMode",value:function(e,t){var a=this.getMessages(),i=a[a.indexOfWithProperty("id",e)];try{m.default.PAssert(490,i,"Must be able to find a valid reply message to update response mode for")}catch(s){m.default.reportError(s)}if(i){var n,r=this.getPlugin();if(t!==v.a.EmailResponseMode.None){try{m.default.PAssert(491,i.initializedForDisplay,"Must be initialized for display to set response mode")}catch(s){m.default.reportError(s)}n=r.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(i)),this._updateDraftFromMessage(i,n,t)}i.responseMode&&i.responseMode.set(t)}}},{key:"setLastMessageResponseMode",value:function(e){if(e){var t=this.getMessages(),a=t[t.length-1];try{m.default.PAssert(492,a,"Setting message response mode when there are no messages")}catch(i){m.default.reportError(i)}a&&this.setMessageResponseMode(a.id,e)}}},{key:"_createErrorHTML",value:function(){var e=wt()(St.a.mark(function e(){return St.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Ot.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html"));case 1:case"end":return e.stop()}}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"_createMessageHTML",value:function(){var e=wt()(St.a.mark(function e(t,a,i,n){var r,s;return St.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(r={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0},n)for(s in n)n.hasOwnProperty(s)&&(r[s]=n[s]);return e.abrupt("return",Ot.a.update(t,a,r,i));case 3:case"end":return e.stop()}}},e)}));return function(t,a,i,n){return e.apply(this,arguments)}}()},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};sr.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach(function(a){t+=a+"{",Object.keys(e[a]).forEach(function(i){var n=e[a][i];t+=i+":"+n+";"}),t+="}"}),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(e,t,a){var i={isApp:x.a.app},n=this._generateCSS(),r="<script>("+bn+')("'+a+'",'+JSON.stringify(i)+");<\/script>",s="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',x.a.supportBlobURLIFrame?new Blob([s,"<html>","<head>",t,n,r,"</head>",e,"</html>"],{type:"text/html"}):[s,"<html>","<head>",t,n,r,"</head>",e,"</html>"].join("")}},{key:"onMessageLoaded",value:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(e){return document.getElementById("emailPreview_"+e)}},{key:"updateMessageHeight",value:function(e,t,a){var i=this.getPreviewIFrame(e);if(i){var n=this.getMessages(),r=n[n.indexOfWithProperty("id",e)];t&&(i.style.height="0px");try{var s=i.contentDocument.documentElement;if(s){var o=a||r.defaultScale.get(),l=Math.ceil(s.scrollWidth*o),u=Math.ceil(s.scrollHeight*o);t&&u===r.height.get()&&(i.style.height=u+"px"),r.width.set(l),r.height.set(u),a&&r.defaultScale.get()!==a&&r.defaultScale.set(a)}}catch(d){m.default.reportError(d)}}}},{key:"_generateAltParts",value:function(e,t){var a=this.getPlugin().getMessageAttachments(t);if(a)for(var i=0,n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=a[n];"application/ics"===r.mimeType&&this.getPlugin().loadResource(e.id,t.id,r.cid,function(e){if(e){var t=wn.a.parseICS(m.default.b64_to_utf8(e.data));m.default.log("Parsed ICS Data: ",t)}})}}},{key:"_computeResponseMode",value:function(e){var t=v.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?v.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?v.a.EmailResponseMode.Reply:v.a.EmailResponseMode.ReplyAll:v.a.EmailResponseMode.Compose),t}},{key:"_createMessageDisplay",value:function(){var e=wt()(St.a.mark(function e(t,a,i,n){var r,s;return St.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(493,!a.initializedForDisplay,"Should only initialize message for display once")}catch(l){m.default.reportError(l)}try{m.default.PAssert(494,a.to,"Must have a valid to object")}catch(l){m.default.reportError(l)}try{m.default.PAssert(495,a.from,"Mus have a valid from object")}catch(l){m.default.reportError(l)}if(r=!0,!a.decoded){e.next=12;break}return a.isErrorMessage=!1,e.next=8,this._createMessageHTML(a.decoded,a.resources,a.mimeType,n);case 8:(s=e.sent).missingResourceData&&(r=!1),e.next=17;break;case 12:return m.default.reportError(new Error("Missing message decoded data"),"Missing message decoded data: "+m.default.isString(a.decoded)),a.isErrorMessage=!0,e.next=16,this._createErrorHTML();case 16:s=e.sent;case 17:0;try{m.default.PAssert(496,s.parsed,"Must have valid parsed data")}catch(l){m.default.reportError(l)}return a.blob=this._createFrameBlob(s.parsed,a.contentType,a.id),m.default.isString(a.blob)||(a.blobURL&&(x.a.URL.revokeObjectURL(a.blobURL),a.blobURL=void 0),a.blobURL=x.a.URL.createObjectURL(a.blob)),a.specialLinks=s.specialLinks,a.width||(a.width=new z.a(0)),a.height||(a.height=new z.a(0)),a.defaultScale||(a.defaultScale=new z.a(1)),a.responseMode||(a.responseMode=new z.a(this._computeResponseMode(i))),a.initializedForDisplay=!0,r||this.getPlugin().reportMessage(t.getField("accountID"),t.id,a.id,"Error creating display",!1),e.abrupt("return",a);case 29:case"end":return e.stop()}}},e,this)}));return function(t,a,i,n){return e.apply(this,arguments)}}()},{key:"_destroyMessageDisplay",value:function(e){try{m.default.PAssert(497,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(t){m.default.reportError(t)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(x.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(){var e=wt()(St.a.mark(function e(t){var a,i=this;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==this.threadAttach){e.next=11;break}return e.prev=1,a=this.getMessages(),e.next=5,Promise.all(a.map(function(e,n){if(!t.getPlugin().isMessageDraft(e)&&!e.initializedForDisplay){try{i._generateAltParts(t,e)}catch(r){m.default.reportError(r)}return i._createMessageDisplay(t,e,a[n+1],0===n?{collapseQuotes:!1}:void 0)}}));case 5:a.equals(this.messageIDs.get())||this.messageIDs.set(a.map(function(e){return e.id})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),m.default.reportError(e.t0);case 11:case"end":return e.stop()}}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){return this.threadAttach&&this.threadAttach.getField("messages")||[]}},{key:"_requestMessageReload",value:function(){var e=wt()(St.a.mark(function e(t,a,i){var n=this;return St.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:a.getPlugin().forceReloadMessage(a,i,function(){var e=wt()(St.a.mark(function e(r){var s,o,l,u,d;return St.a.wrap(function(e){for(var c=0,h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(498,r,"Must be able to re-load message data")}catch(f){m.default.reportError(f)}if(a!==n.threadAttach){e.next=12;break}if(s=a.getField("messages"),o=s.indexOfWithProperty("id",i),!(l=s[o])){e.next=12;break}if(!(u=n.getPreviewIFrame(t))){e.next=12;break}return l.initializedForDisplay=!1,e.next=11,n.ensureDisplayMessages(a);case 11:x.a.supportBlobURLIFrame?u.src=l.blobURL:((d=u.contentWindow.document).documentElement.innerHTML="",d.open(),d.write(l.blob),d.close());case 12:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}},e)}));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"onAttachmentUpdate",value:function(e,t,a){var i=this;(!t||t.indexOf("messages")>=0)&&e.getPlugin().loadThread(e,function(t,a){try{m.default.PAssert(499,t,"Must be able to re-load thread data")}catch(n){m.default.reportError(n)}a&&e===i.threadAttach&&i.ensureDisplayMessages(e)})}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(){var e=wt()(St.a.mark(function e(t,a){var i;return St.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(500,t.hasField("messages"),"Must supply valid messages to the email preview")}catch(r){m.default.reportError(r)}try{m.default.PAssert(501,this.errorMessage.get()||t.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(r){m.default.reportError(r)}if(this.threadAttach&&this.threadAttach.id===t.id){e.next=12;break}return this.reset(),this.threadAttach=t,this.threadItem=a,t.subscribe(this),e.next=9,this.ensureDisplayMessages(t);case 9:(i=t.getPlugin()).attachmentHasLabelByID(t,"UNREAD")&&i.performAction(v.a.PluginAction.Gmail.MarkRead,!0,t),k.a.fireEvent("EmailPreview","openThreadChanged",[]);case 12:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSelectedIndexChanged",value:function(e,t,a){this.isOpen()&&t===this.openOnPane&&(a&&a.hasAttachmentType(v.a.PluginType.Email)?a.getAttachmentByType(v.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(a,t):"PaneGmail"===t.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}]),e}();var bn=function(e,t){!function(){function a(e){console.log("ERROR: ",e)}var i,n=window.InjectedJS={postMessage:function(t,i){try{var n;if(void 0!==i)if("string"===typeof i)n=i;else try{n=JSON.stringify(i)}catch(r){a(r),n=""}else n="";window.parent.postMessage("-"+t+"-"+e+"-"+n,"*")}catch(r){a(r)}}};i=function(e){var a=1;t.isAndroid&&(a=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+a+")"),n.postMessage("resize",{canBeShorter:e,scale:a})};var r=!1;function s(){document.removeEventListener("DOMContentLoaded",s,!1),r?i():(r=!0,function(){var e=0,t=0,a=0;document.documentElement.addEventListener("click",function(e){n.postMessage("click")}),document.addEventListener("keydown",function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};n.postMessage("keypress",t)},!0);for(var r=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?n.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?n.postMessage(t.replace(/^moodoAction:/gi,"")):n.postMessage("href",t),!1},s=document.querySelectorAll("[mlink]"),o=0;o<s.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;s[o].addEventListener("click",r)}var l=document.querySelectorAll("[place]");for(o=0;o<l.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;l[o].addEventListener("click",function(e){for(var t=0,a=this.id,n=this.nextElementSibling,r=!1;n&&n.getAttribute("group")===a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s="collapsed"===n.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===s&&(r=!0),n.setAttribute("quote",s),n=n.nextElementSibling}return setTimeout(function(){i(r)},0),e.stopImmediatePropagation(),e.preventDefault(),!1})}var u=[],d=document.querySelectorAll("img");for(o=0;o<d.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=d[o].getAttribute("cid");c&&u.push(c),d[o].addEventListener("load",function(){i()})}u.length>0&&n.postMessage("reqResource",u)}(),n.postMessage("epLoaded"))}window.addEventListener("message",function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),n=e.data.substring(1,t),r=e.data.substring(t+1);switch(n){case"resLoad":try{if(r)for(var s=0,o=JSON.parse(r),l=document.querySelectorAll('[cid="'+o.cid+'"]'),u="data:"+o.mimeType+";base64,"+o.data,d=0;d<l.length;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l[d].src=u}}catch(c){a(c)}break;case"contentLoad":try{if(r){o=JSON.parse(r);document.open(),document.write(o.data),document.close(),setTimeout(i,0)}}catch(c){a(c)}break;default:a(new Error("Unknown PreviewFrame message: "+n))}}}),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(s):(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1))}()}.toString(),Dn=In,En=a(201),Cn=function(){function e(){r()(this,e)}return o()(e,[{key:"init",value:function(e){this.settings=new y.a,this.International=new I,this.billingManager=new Ni,this.pluginManager=new Ti,this.DisplaySettings=new A,this.itemStoreManager=new se,this.PaneUpdateBatcher=new rn,this.PaneManager=new de,this.DragDrop=new ce.default,this.timeline=new ge,this.cacheManager=new zi,this.recurringTaskManager=new nn,this.deferredTaskManager=new Wi,this.toasts=new un,this.ElementRenderer=new dn,this.crypto=new _n,this.cloudStorage=new hn,this.dropBucket=new Sn,this.menus=new Pn,this.EmailPreview=new Dn,this.International.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.ElementRenderer.init(),this.cloudStorage.init(),this.EmailPreview.init(),B.a.init()}},{key:"searchVMLIArray",value:function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!e.headers||r.showInOverview()){if(!e.comparator||e.comparator(r,e))if(e.each)if(!1===e.each(r,e))return!1;this.searchFromVMLI(r,e,a+1)}}}},{key:"searchFromVMLI",value:function(e,t,a){a=a||0;var i,n=t.noCollapsed,r=t.pane,s=t.overview;t.includeNotes&&!t.headers&&e.hasNote()&&(t.comparator&&!t.comparator(e.getNote(),t)||t.each&&(i=t.each(e.getNote(),t))),!1===i||n&&0!==a&&e.isCollapsed(r,s)||(i=this.searchVMLIArray(t,e.items.get(),a))}},{key:"searchVMLIs",value:function(e){var t=this;try{m.default.PAssert(104,e,"Must supply a valid options param")}catch(a){m.default.reportError(a)}try{if(e.itemStoreFilter)this.itemStoreManager.runForEachStore(function(a){var i=e.item,n=i&&i.belongsToItemStore(a)?i:a.getRoot();t.searchFromVMLI(n,e)},e.itemStoreFilter);else if(e.item){try{m.default.PAssert(105,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){m.default.reportError(a)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{m.default.PAssert(106,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){m.default.reportError(a)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else try{m.default.PAssert(107,!1,"Must specify a valid search root, using the default root is deprecated")}catch(a){m.default.reportError(a)}}catch(i){m.default.reportError(i)}}},{key:"sendFeedback",value:function(e,t){var a={};En.default.getAppInfo(a),a.eventStream=void 0;var i={name:e,message:t,appInfo:a,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return xi.a.sendFeedback(i)}},{key:"remoteAPI",value:function(){return this.pluginManager.getPlugin(v.a.PluginID.Moodo)}}]),e}(),An=a(35),Mn=a.n(An),Tn=a(27),Ln={" ":!0,"-":!0},xn=Mn()({},v.a.AttachChar,!0),Rn={CallCount:{GetCaretOffset:0,GetClassStyles:0,measurePaneObject:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}};var On=100;function Fn(e){return Math.round(e*On)/On}var Nn,Bn=function(){function e(){r()(this,e),L.a.binder(this,"clearCacheForItem","onDisplaySettingsChanged"),this.fontSize=sr.DisplaySettings.fontSize(),this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new z.a,this.measureTextPane=new z.a,this._paneObjectCache={},this._paneObjectsForItem={}}return o()(e,[{key:"init",value:function(){var e=this;this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel","Date"]),this._lineCache=sr.cacheManager.registerLocalCache("LineCache",v.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0}),this._imageCache=sr.cacheManager.registerLocalCache("ImageCache",v.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0}),k.a.listen("clearMeasureCacheItem",this.clearCacheForItem),k.a.listen("clearMeasureCacheAll",function(){e.clearItemCache(),e.clearLineCache()}),sr.DisplaySettings.listen("settingsChanged",this.onDisplaySettingsChanged)}},{key:"registerWordCaches",value:function(e){var t=0;this._wordCaches=[];for(var a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a],n=sr.cacheManager.registerLocalCache("WordCache"+i,v.a.StorageType.LocalStorage);this._wordCaches.push(n),this["_wordCache"+i]=n}}},{key:"updateFont",value:function(e){this.needsFontUpdate||this.fontSize!==e.fontSize||e.isBold!==this.isBold||e.isNote!==this.isNote||e.isPrefixHeader!==this.isPrefixHeader||e.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=e.fontSize,this.isBold=!!e.isBold,this.isNote=!!e.isNote,this.isPrefixHeader=e.isPrefixHeader,this.isHeaderTopLevel=e.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",Rn.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):Rn.Cache.CanvasStyleHit++}},{key:"getCanvasElement",value:function(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement}},{key:"getCanvasContext",value:function(e){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(e),this.canvasContext}},{key:"getMeasureStats",value:function(){return Rn}},{key:"_getLineOffset",value:function(e,t,a){var i=e.childNodes,n=0;if(i)for(var r=0,s=0;s<i.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[s];if(o===t){n+=a;break}if(m.default.hasClass(o,"plugin")?n+=1:o.nodeType===Node.TEXT_NODE?o.nodeValue!==v.a.TextSpace&&(n+=o.length):o.childNodes.length>0&&(n+=this._getLineOffset(o,t,a)),t&&m.default.isAncestor(t,o))break}return n}},{key:"_getCaretPosition",value:function(e,t,a,i,n){var r=m.default.element("measureTextItem"),s=r.querySelector(".line");if(s){var o,l,u,d,c=s.getBoundingClientRect(),h=r.getBoundingClientRect(),f={left:c.left,top:h.top},p=a.isNote()?m.default.unescape(a.getNotePreviewText()):a.getParsedText(),g=0,y=a.hasPrefix()&&i.isViewProject()&&i.isItemTopLevel(t,a);e>p.length&&(e=p.length);var k=Tn.default._getSelectionRange();Tn.default.selectElement(r,e);var _,S=Tn.default._getSelectionRange();if(S){l=m.default.findParent(S.startContainer,"line");var P=m.default.findParent(S.startContainer,"itemPrefix",2);if(l){var w=0;u=[].indexOf.call(l.parentNode.children,l),d=this._getLineOffset(l,S.startContainer,S.startOffset);var I=0,b=S.startContainer.parentElement,D=b.previousElementSibling;if(D&&!n&&"IMG"===D.nodeName)I=-D.getBoundingClientRect().width;else if(!n&&m.default.hasClass(b,"mdImageMarkup")){var E=b.nextElementSibling;S.startOffset>0&&S.endOffset>0&&"IMG"===E.nodeName&&(I=E.getBoundingClientRect().width+10+(a.hasPrefix()?v.a.PrefixWidth:0))}sr.settings.showMarkdown.get()||m.default.hasClass(b,"mdMarkup")&&(S=this.adjustSelectionForMarkup(S)),m.default.hasClass(S.startContainer,"plugin")?(_=S.startContainer.getBoundingClientRect(),o={left:S.startOffset>0?_.right+(m.default.hasClass(S.startContainer,"inlineDate")?1:12):_.left,top:_.top}):P&&e===a.getPrefixLength()?(_=P.getBoundingClientRect(),o={left:f.left+v.a.PrefixWidth+(x.a.isFirefox?0:5),top:_.top}):n&&d===this._getLineOffset(l)&&l.nextSibling?(o={left:(_=(l=l.nextSibling).getBoundingClientRect()).left+5+(a.hasPrefix()?v.a.PrefixWidth:0),top:_.top},d=0,u++):(_=S.getBoundingClientRect())&&(_.left===_.right&&0===_.left&&(_=S.getClientRects()[0]||l.getBoundingClientRect()),o={left:_.left,top:_.top}),x.a.isFirefox||(o.left=Math.max(o.left-5,0));for(var C=l.parentNode.childNodes,A=0;A<u;A++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;g+=this._getLineOffset(C[A])}return k&&!m.default.findParent(k.startContainer,"fancyInput")&&Tn.default.setSelectionRange(k),{left:o.left-f.left-(y?v.a.PrefixWidth:0)+I,top:o.top-f.top,line:u,lineOffset:d,lineLength:this._getLineOffset(l),lineStart:g}}}}try{m.default.PAssert(162,!1,"Failed to compute caret position: ",e,a.getParsedText().length,m.default.getElementPath(r))}catch(M){m.default.reportError(M)}return{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}}},{key:"_measureCaretPosition",value:function(e,t,a,i){for(var n=0,r=m.default.element("measureText"),s=m.default.element("measureTextItem"),o=e.item,l=a.getStyledLinesForPaneObject(e,!1,!0),u="",d=0;d<l.length;d++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=l[d],h=(0===d?"margin-top:"+sr.DisplaySettings.paddingForItemTop(e,o)+"px;":"")+(c.isImage||d===l.length-1?"margin-bottom:"+sr.DisplaySettings.paddingForItemBottom(e,o,a)+"px;":"");if(c.isImage)u+='<span class="line" style="'+(h+=c.maxWidth?"max-width: "+c.maxWidth+"px;":"")+'">'+c.previousText+'<span class="mdImageMarkup">'+c.originalText+"</span>"+(c.isDriveImage||!sr.settings.showMarkdown.get()?'<img class="inlineImage" src="'+c.src+'"></img>':"")+"<span>"+c.nextText+"</span></span>";else u+='<span class="line" style="'+(h+="font-size:"+sr.DisplaySettings.fontSizeForItem(e,o,a)+"px;line-height:"+sr.DisplaySettings.lineHeightForItem(e,o,a)+"px")+'">'+(l[d]||v.a.TextSpace)+"</span>"}return r.className="pane "+a.paneClass,s.className="item "+o.styleProps(e,a),s.innerHTML=u,this._getCaretPosition(t,e,o,a,i)}},{key:"getCaretOffset",value:function(e,t,a,i){var n=e.item;if(Rn.CallCount.GetCaretOffset++,isNaN(a)&&(a=n.getParsedText().length),void 0===i){var r=t.caretPosition.get();if(r&&R.a.getStartOffset()===R.a.getEndOffset()&&R.a.getStartIndex()===R.a.getEndIndex())i=r.left-t.getPaddingForPaneObject(e)<30;else{var s=R.a.isArrowSelectInverted(),o=s?R.a.getStartOffset():R.a.getEndOffset(),l=s?R.a.getStartObject():R.a.getEndObject(),u=this._measureCaretPosition(l,o,t,!0),d=this._measureCaretPosition(l,o,t,!1);u.left!==d.left&&(i=!s)}}return this._measureCaretPosition(e,a,t,i)}},{key:"getCaretScreenPosition",value:function(e,t,a){try{m.default.PAssert(163,t>=0,"Must provide a valid index")}catch(d){m.default.reportError(d)}var i=e.itemAtIndex(t),n=e.objectAtIndex(t);try{m.default.PAssert(164,i,"Must be able to find a valid item at index")}catch(d){m.default.reportError(d)}if(e.isIndexMounted(t)){var r=e.elementAtIndex(t);try{m.default.PAssert(165,r,"Must be able to get element for item at index")}catch(d){m.default.reportError(d)}var s=e.getPaddingForPaneObject(n),o=this.getCaretOffset(n,e,a),l={left:-1,top:-1};if(r){var u=r.getBoundingClientRect();l.left=o.left+u.left+s,l.top=o.top+u.top}return l}return{left:-1,top:-1}}},{key:"_getClassStyles",value:function(e,t,a,i){Rn.CallCount.GetClassStyles++;try{m.default.PAssert(166,m.default.isVMLI(t),"Item must be a valid VMLI instance")}catch(o){m.default.reportError(o)}var n=t.isNote(),r=t.isPrefixHeader(),s=t.isPrefixHeader()&&a.isItemTopLevel(e,t);return{isBold:a.isItemBold(t)||i.hasClass("mdBold")||i.hasClass("contact")||i.hasClass("date")||i.hasClass("duration")||i.hasClass("tag"),fontSize:t.isNote()?sr.DisplaySettings.noteFontSize():s&&sr.DisplaySettings.fontSizeHeaderTopLevel()||r&&sr.DisplaySettings.fontSizeHeader()||sr.DisplaySettings.fontSize(),isPrefixHeader:r,isHeaderTopLevel:s,isNote:n,attrs:i.getAttrs()}}},{key:"measureLines",value:function(e,t,a,i,n,r){var s=0;try{m.default.PAssert(167,m.default.isVMLI(t),"Must provide a valid item to measure lines for")}catch(ae){m.default.reportError(ae)}try{m.default.PAssert(168,m.default.isPane(a),"Must provide a valid pane to measure lines for")}catch(ae){m.default.reportError(ae)}try{m.default.PAssert(169,i>=0,"Max width must be greater than 0: ",i)}catch(ae){m.default.reportError(ae)}Rn.CallCount.MeasureLines++;var o=this.getItemDisplayText(t),l=!t.isDestroyed()&&t.requireStoredEls();n=n||!l;try{m.default.PAssert(170,t&&(t.els||!l),"A Item has no els: ",t.__TEMP_InitCalled,t.__TEMP_InitParseCalled,t.__TEMP_ParseCalled,t.__TEMP_SkippedInitParsed)}catch(ae){m.default.reportError(ae)}if(0===o.length||!t||!t.els&&l)return t&&m.default.runSingleParse(t,v.a.ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!n){var u=this.getLinesFromCache(t,a,i);if(u){for(var d=0,c=o.length,h=0,f=0;f<u.length;f++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;h+=u[f].length}if(c===h)return Rn.Cache.LinesCacheHit++,u}else Rn.Cache.LinesCacheMiss++}var p=[],g=t.els,y=0,k="",_=0,S=[],P=0;if(g&&l)for(var w=0,I=0;I<g.length;++I){var b=0;if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var D=g[I],E=this._getClassStyles(e,t,a,D),C=D.getParsedText(),A=D.getWidth(n),M=!!(E&&E.attrs&&E.attrs.attachSimple)&&!r,T=void 0;if(D.hasClass("plugin_drive_image_inline")&&(A=i,M=!0,T=!0),void 0===A){var L=C.length;try{m.default.PAssert(171,!E.plugin||C===v.a.AttachChar,"Plugin should only be set for attachment element")}catch(ae){m.default.reportError(ae)}for(var x=0;x<L;++x){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;var R=C[x];if(!Ln[R]||y===P||0===x&&I>0&&void 0!==g[I-1].getWidth(n)){var O=0;k+=R;for(var F="",N=y+1;N<o.length;++N){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;var B=o[N];if(!Ln[B])break;F+=B}var U=F||xn[R]||C[x+1]===v.a.AttachChar;if(U&&M&&x+F.length<L)k+=F;else if(U){var V=this.measureWord(a,k,E,n),H=this.measureWord(a,F,E,n);S.push({text:k,delim:F,styles:E,width:V,delimWidth:Math.min(H,i),isAttach:R===v.a.AttachChar,isImage:M,isDriveImage:T}),k=""}}y++}if(k.length>0){var j=this.measureWord(a,k,E,n);S.push({text:k,delim:"",styles:E,width:j,delimWidth:0,isImage:M,isDriveImage:T}),k=""}}else S.push({isPrefix:0===I,text:C,width:I>0||a.shouldRenderPrefix(e)?A:0,styles:E,delimWidth:0,delim:"",isImage:M,isDriveImage:T}),P+=C.length,y+=C.length}else{try{m.default.PAssert(172,t&&!l,"Items that do not have els must be marked as not requiring them to be cached")}catch(ae){m.default.reportError(ae)}t.els||m.default.runSingleParse(t,v.a.ChangeType.Auto);try{m.default.PAssert(173,t.els&&1===t.els.length,"Should always have a single el for non-measure cached items")}catch(ae){m.default.reportError(ae)}var z=this._getClassStyles(e,t,a,t.els[0]);z&&z.attrs?S.push({text:v.a.AttachChar,delim:"",styles:z,width:sr.pluginManager.measureAttachment(a,z),delimWidth:0}):(k=t.els[0].getParsedText(),S.push({text:k,delim:"",styles:z,width:this.measureWord(a,k,z,n),delimWidth:0}))}var q=0,W="",G=0,K=0;y=0;for(var Y=0;Y<S.length;++Y){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if((k=S[Y]).isPrefix&&(G=k.width),k.isImage&&1===Y&&G){var X=this.getAttachSimpleLine(k,y,S[0]);if(X){p.push(X),y+=X.length,W="",_=Y+1,G=0;continue}}if(Y>_&&(k.isImage||q+k.width>i&&!(G&&1===K&&k.width>0))&&(p.push({text:W,start:y,length:W.length,width:Fn(q)}),y+=W.length,q=0,W="",_=Y,G=0),k.isImage){var Q=this.getAttachSimpleLine(k,y);if(Q){p.push(Q),y+=Q.length,W="",_=Y+1,G=0;continue}}if(!k.isPrefix&&k.width+k.delimWidth>i&&!k.isAttach){var J=0,Z=0,$=0;q=0;for(var ee=0;ee<k.text.length;++ee){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;q=$,($+=this.measureChar(k.text[ee],k.styles))>i&&ee>0&&ee-1>Z&&(W+=k.text.substring(Z,ee),p.push({text:W,start:y,length:W.length,width:Fn(q)}),y+=W.length,Z=ee,q=0,G=0,W="",ee--,$=0)}if(Z>=0){var te=k.text.substring(Z,k.text.length);te.length>0&&(k.text=k.text.substr(0,Z),W=te+k.delim,q=this.measureWord(a,te,k.styles,!0),_=Y)}}else k.isPrefix||(q+=k.width+k.delimWidth),W+=k.text+k.delim;Y===S.length-1&&(p.push({text:W,start:y,length:W.length,width:Fn(q)}),G=0),k.width>0&&K++}return n||this.saveLinesToCache(t,a,i,p),p}},{key:"getPaneObjectFromCache",value:function(e,t){var a,i=e.item,n=e.id,r=this._paneObjectCache[n],s=t,o=this.getItemDisplayText(i);if(r&&r[s]&&r[s].isHeader===i.isHeader()&&o===r.text&&r[s].isNote===i.isNote()&&o.indexOf(v.a.AttachChar)<0){var l=r[s];if(l.els)Rn.Cache.ItemCacheHit++,a=l;else try{m.default.PAssert(174,!1,"Getting item from cache with no els")}catch(u){m.default.reportError(u)}}return a||Rn.Cache.ItemCacheMiss++,a}},{key:"savePaneObjectToCache",value:function(e,t){try{m.default.PAssert(175,t,"Must save a valid measured item to cache")}catch(c){m.default.reportError(c)}try{m.default.PAssert(176,t.els,"Measured item must have els")}catch(c){m.default.reportError(c)}try{m.default.PAssert(177,t.maxWidth,"Measured item must have a valid max width")}catch(c){m.default.reportError(c)}var a=e.item,i=this.getItemDisplayText(a),n=e.id,r=this._paneObjectCache[n];if(r&&r.text===i){var s,o=0,l=Number.MAX_VALUE;for(var u in r)if(r.hasOwnProperty(u)){o++;var d=r[u].lastAccess;d<l&&(l=d,s=u)}o>=5&&delete r[s]}else r=this._paneObjectCache[n]={text:i},this._paneObjectsForItem[a.id]||(this._paneObjectsForItem[a.id]=[]),this._paneObjectsForItem[a.id].push(n);r[t.maxWidth]=t}},{key:"getLinesFromCache",value:function(e,t,a){if(t.useLineCache){var i,n,r=this._lineCache.getEntrySync(e.id);if(r)for(var s=0,o=0;o<r.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i=r[o][a])break}if(i){var l=this.getItemDisplayText(e);if(m.default.isNumber(i))n=[{start:0,length:l.length,text:l}];else{var u=0;n=new Array(i.length);for(var d=0,c=0;c<i.length;c++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=i[c];try{m.default.PAssert(178,!m.default.isNumber(h),"Cached lines should always be line info rather than a number")}catch(f){m.default.reportError(f)}n[c]={start:d,length:h.length,text:l.substr(d,h.length)},h.size&&(n[c].size=h.size),d+=h.length}}}return n}}},{key:"saveLinesToCache",value:function(e,t,a,i){if(t.useLineCache){var n,r=0;if(i.length>1||i[0].size){var s=0;n=i;for(var o=0;o<n.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;delete n[o].imageUrl,delete n[o].originalText}}else n=1;var l=this._lineCache.getEntrySync(e.id)||[];l.length>=5&&l.pop();for(var u=0;u<l.length;u++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;l[u][a]&&(l.splice(u,1),u--)}var d={};d[a]=n,l.splice(0,0,d),this._lineCache.saveEntrySync({id:e.id,value:l})}}},{key:"measurePaneObject",value:function(e,t,a,i){Rn.CallCount.measurePaneObject++;var n,r=e.item,s=t.maxWidthOfPaneObject(e),o=this.getItemDisplayText(r),l=r.isHeader(),u=r.isNote();try{m.default.PAssert(179,m.default.isNumber(s),"Must provide a valid number for maxWidth: ",s)}catch(P){m.default.reportError(P)}try{m.default.PAssert(180,s>=0,"Max width must be greater than 0: ",s)}catch(P){m.default.reportError(P)}if(0===o.length||s<m.default.MinItemWidth){return{height:sr.DisplaySettings.lineItemHeight(e,r,t,1),maxWidth:s,lineLengths:[0],styledLines:[v.a.TextSpace],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:l,isNote:u}}if(!(n=!a&&this.getPaneObjectFromCache(e,s))||t.search.shouldHighlightSearch()){for(var d=0,c=this.measureLines(e,r,t,s,a,i),h=[],f=[],p=0,g=c.length,y=0;y<c.length;++y){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var k=c[y];if(k.size&&!isNaN(k.size.height)){var _=Math.min(k.size.width,s);p+=k.size.height*_/k.size.width+(y>0?sr.DisplaySettings.paddingForItemTop(e,r):0)+(y<c.length-1?sr.DisplaySettings.paddingForItemBottom(e,r,t):0),g--}h.push(k.length),f.push({text:k.text,start:k.start,length:k.length,width:k.width,cls:"line",index:y})}try{m.default.PAssert(182,r&&(r.els||!r.requireStoredEls()),"B Item has no els: ",r.__TEMP_InitCalled,r.__TEMP_InitParseCalled,r.__TEMP_ParseCalled,r.__TEMP_SkippedInitParsed)}catch(P){m.default.reportError(P)}if(!r.els&&r.requireStoredEls()){return{height:sr.DisplaySettings.lineItemHeight(e,r,t,1),maxWidth:s,lineLengths:[],styledLines:[],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:l,isNote:u}}var S=U.a.generateStyledLines(r.els,c,t,r,void 0,i);n={height:sr.DisplaySettings.lineItemHeight(e,r,t,g)+p,maxWidth:s,lineLengths:h,styledLines:S,els:f,isHeader:l,isNote:u,lastAccess:Date.now()},t.search.shouldHighlightSearch()&&(n.searchHighlightedLines=U.a.generateStyledLines(r.els,c,t,r,!0)),a||this.savePaneObjectToCache(e,n)}return n}},{key:"measureWord",value:function(e,t,a,i){Rn.CallCount.MeasureWord++;try{m.default.PAssert(183,void 0!==t,"Must pass in a valid word")}catch(d){m.default.reportError(d)}try{m.default.PAssert(184,a,"Must supply valid styles for word")}catch(d){m.default.reportError(d)}try{m.default.PAssert(185,t.indexOf(v.a.AttachChar)<0||1===t.length,"AttachChar should not be processed with other chars")}catch(d){m.default.reportError(d)}if(t.length>0){if(t===v.a.AttachChar&&a&&a.attrs){try{m.default.PAssert(186,!a.attrs||a.attrs.plugin,"Must have a valid plugin: ",a.attrs&&a.attrs.plugin)}catch(d){m.default.reportError(d)}try{m.default.PAssert(187,!a.attrs||a.attrs["plugin-id"],"Must have a valid attachment",a.attrs&&a.attrs["plugin-id"])}catch(d){m.default.reportError(d)}return sr.pluginManager.measureAttachment(e,a)}var n=this._selectCache(a),r=n.getEntrySync(t);if(r)return Rn.Cache.WordCacheHit++,r;for(var s=0,o=0,l=0;l<t.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;o+=this.measureChar(t[l],a)}var u=Fn(o);return i||n.saveEntrySync({id:t,value:u}),u}return 0}},{key:"measureChar",value:function(e,t){var a=this._selectCache(t),i=a.getEntrySync(e);if(i)return i;var n=this.getCanvasContext(t).measureText(e).width;return a.saveEntrySync({id:e,value:n}),n}},{key:"getOffsetForScreenPositionInLine",value:function(e,t,a,i,n){var r,s=t.item;if(a.isIndexMounted(e)){var o=a.elementAtIndex(e).querySelectorAll(".line");if(o.length>i){var l=o[i],u=l.getBoundingClientRect(),d=Tn.default.getSelectOffsetsForMouseEvent({target:l,clientX:m.default.clamp(n,u.left,u.right-2),clientY:u.top+2+(s.shouldShowParents(t,a)?v.a.HeightAgendaParents:0)+(0===i?sr.DisplaySettings.paddingForItemTop(t,s):0)});d&&(r=d.start)}}if(isNaN(r)){var c=0,h=this.measurePaneObject(t,a,!0).lineLengths;r=0;for(var f=0;f<h.length;f++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;r+=h[f]}}return r}},{key:"clearCacheForItem",value:function(e){this._lineCache.removeEntrySync(e);var t=this._paneObjectsForItem[e];if(t){for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t[i];this._paneObjectCache[n]&&delete this._paneObjectCache[n]}delete this._paneObjectsForItem[e]}}},{key:"clearWordCaches",value:function(){for(var e=0,t=0;t<this._wordCaches.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._wordCaches[t].clearCacheSync()}}},{key:"clearItemCache",value:function(){this._paneObjectCache={},this._paneObjectsForItem={}}},{key:"clearLineCache",value:function(){this._lineCache.clearCacheSync()}},{key:"_selectCache",value:function(e){var t;if(e.isHeaderTopLevel)t=this._wordCacheHeaderTopLevel;else if(e.isPrefixHeader)t=this._wordCacheHeader;else if(e.isBold){try{m.default.PAssert(188,!e.isNote,"Currently do not support bold+note")}catch(a){m.default.reportError(a)}t=this._wordCacheBold}else t=e.isNote?this._wordCacheNote:11===e.fontSize?this._wordCacheDate:this._wordCacheNormal;return t}},{key:"getItemDisplayText",value:function(e){return e.getParsedText()}},{key:"onDisplaySettingsChanged",value:function(e){this.needsFontUpdate=!0,e&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}},{key:"measureImage",value:function(e){var t=e.src.replace("&retryPermissions",""),a=!this._imageCache.getEntrySync(t);return this._imageCache.saveEntrySync({id:t,value:{width:e.naturalWidth,height:e.naturalHeight}}),a}},{key:"getImageOriginalSize",value:function(e,t){var a=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return{width:a.width,height:a.height}}},{key:"getImageSize",value:function(e,t,a){var i,n=this._imageCache.getEntrySync(e)||t&&this._imageCache.getEntrySync(t);return n&&(i=a?{width:a=Math.min(a,n.width),height:n.height*(a/n.width)}:{width:n.width,height:n.height}),i}},{key:"getAttachSimpleLine",value:function(e,t,a){var i,n,r,s=e.styles.attrs,o=(a?a.text+a.delim:"")+e.text+e.delim;if(s.plugin){try{m.default.PAssert(189,s.plugin===v.a.PluginID.Drive,"Attach simple line with a plugin other than Drive",s.plugin)}catch(c){m.default.reportError(c)}var l=sr.pluginManager.getPluginDrive(),u=l.getAttachment(s["plugin-id"]);i=l.getAttachUrl(u),n=l.getAttachDataUrl(u),r=l.getAttachWidth(u)}else i=s["data-href"],r=s.size;if(i){var d=this.getImageSize(i,n,r);return{text:o,start:t,length:o.length,size:d}}}},{key:"adjustSelectionForMarkup",value:function(e){var t=!1,a=e.startContainer.parentElement,i=m.default.hasClass(a,"mdMarkupStart"),n=m.default.hasClass(a,"mdMarkupEnd","appLinkStart");if(i||n){var r=i?1:-1,s=this.findNextNonMarkup(a,r);if(s){var o=s.childNodes[0]||s;o&&(e.setStart(o,r<0?o.length:0),t=!0)}else if(r*=-1,s=this.findNextNonMarkup(a,r)){var l=s.childNodes[0];l&&(e.setStart(l,r<0?l.length:0),t=!0)}}return t?this.adjustSelectionForMarkup(e):e}},{key:"findNextNonMarkup",value:function(e,t){for(var a=0;e&&m.default.hasClass(e,"mdMarkup","appLinkStart");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=t>0?e.nextSibling:e.previousSibling}return e}}]),e}(),Un=function(){function e(){r()(this,e),this.sidebarTransitioning=!1,this.isDraggingSidebar=new z.a(!1),this.lightboxPosition=new z.a,this.lightboxSrc=new z.a,this.lightboxElement=void 0,this.sidebarChanged=new W.a}return o()(e,[{key:"init",value:function(){this.showSidebar=x.a.isMailbirdSidebar()||m.default.isDemoInIframe()?new z.a(!1):sr.settings.showSidebar;var e=sr.settings.sidebarWidth.get()||v.a.DesktopMenuWidthDefault;this._savedSidebarWidth=e===v.a.DesktopMenuWidthSmall?v.a.DesktopMenuWidthDefault:e,this.sidebarWidth=new z.a(e)}},{key:"toggleSidebar",value:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===v.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=v.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var e=v.a.DesktopMenuWidthSmall;sr.settings.sidebarWidth.set(e),this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0),sr.settings.sidebarWidth.set(this.sidebarWidth.get())}},{key:"getSidebarWidth",value:function(){return x.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidthMoving",value:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}},{key:"setSidebarWidthUp",value:function(){var e=this.sidebarWidth.get();e<20?e=0:e<v.a.DesktopMenuWidthMinBig&&(e=v.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e,sr.settings.sidebarWidth.set(e)),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(e){sr.settings.showSidebar.set(e),this.showSidebar.set(e)}},{key:"shouldShowTopBar",value:function(){return!this.showSidebar.get()||x.a.isNativeMac()&&this.sidebarWidth.get()<v.a.DesktopMenuWidthMinBig}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()?32:0}}]),e}(),Vn=a(45),Hn=(Nn=function(){function e(){r()(this,e)}return o()(e,[{key:"setup",value:function(){this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge;try{m.default.PAssert(118,this.ipcBridge,"IPC bridge was not created")}catch(e){m.default.reportError(e)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage)}},{key:"handleMessage",value:function(e,t){try{if(isNaN(+e)){try{m.default.PAssert(119,this["onEvent_"+e],"Missing handler for native event")}catch(n){m.default.reportError(n)}this["onEvent_"+e](t)}else{var a=this.callbacks[+e],i=!1;if(a){if(m.default.isString(t)&&"{"===t[0]&&"}"===t[t.length-1])try{("error"in(t=JSON.parse(t))||"value"in t)&&(a(t.error,t.value),i=!0)}catch(r){m.default.reportError(r)}!i&&a&&a(t)}}}catch(r){m.default.reportError(r)}}},{key:"sendMessage",value:function(e,t,a){if(this.ipcBridge){var i=this.nextId++,n=i+"~"+e;void 0!==t&&(n+="~"+(m.default.isString(t)?t:JSON.stringify(t))),a&&(this.callbacks[i]=a),this.ipcBridge.send("moodo-message",n)}}},{key:"saveBackup",value:function(e,t,a){this.sendMessage("saveBackup",{filename:e,data:t},a)}},{key:"saveDoc",value:function(e,t,a){this.sendMessage("saveDoc",{filename:e,data:t},a)}},{key:"listDocss",value:function(e,t){this.sendMessage("listDocs",{folder:e},t)}},{key:"getDoc",value:function(e,t){this.sendMessage("getDoc",{filename:e},t)}},{key:"deleteDoc",value:function(e,t){this.sendMessage("deleteDoc",{filename:e},t)}},{key:"renameDoc",value:function(e,t,a){this.sendMessage("renameDoc",{filenameOld:e,filenameNew:t},a)}},{key:"getAllDocs",value:function(e){this.sendMessage("getAllDocs",void 0,function(t,a){t?e(t):e(void 0,a)})}},{key:"listenToDocChanges",value:function(e){this._fileListener=e}},{key:"getPrefs",value:function(e){this.sendMessage("getPrefs",void 0,e)}},{key:"setDocsFolder",value:function(e,t,a){this.sendMessage("setDocsFolder",{folder:e,moveFiles:t},a)}},{key:"onEvent_features",value:function(e){try{var t=JSON.parse(e);t.version&&x.a.recordAppSubVersion(t.version),!1===t.notifications&&x.a.disallowNativeNotifications()}catch(a){m.default.reportError(a)}}},{key:"onEvent_downloadProgress",value:function(e){m.default.handleNativeDownloadProgress(e)}},{key:"onEvent_reportError",value:function(e){m.default.reportError(new Error("Native Error"),e)}},{key:"onEvent_onMenuClick",value:function(e){if("NewMessage"===e||"NewEmail"===e){var t=sr.pluginManager.getPluginGmail();t.isEnabled()?sr.menus.openComposeEmail(t):sr.toasts.pushMessage(v.a.MessageID.NeedGmailPermission)}else"NewPane"===e?Vn.a.hotkeyAddPane():"NewItem"===e?Vn.a.hotkeyNewItem():"Preferences"===e?sr.menus.openSettings():"DisplaySettings"===e?sr.menus.openDisplaySettings():"ToggleSidebar"===e?sr.DesktopUI.toggleSidebar():m.default.reportError(new Error("Unknown Native Menu Click: "+e))}},{key:"onEvent_darkMode",value:function(e){console.log("dark mode",e)}},{key:"onEvent_fileChanged",value:function(e){try{var t=JSON.parse(e);this._fileListener(v.a.CrudActions.Modified,t)}catch(a){sr.toasts.pushMessage("A local document has gotten corrupted. Please check the Moo.do documents saved on your computer."),m.default.reportError(a)}}},{key:"onEvent_fileDeleted",value:function(e){try{this._fileListener(v.a.CrudActions.Removed,e)}catch(t){m.default.reportError(t)}}}]),e}(),D()(Nn.prototype,"handleMessage",[C.a],Object.getOwnPropertyDescriptor(Nn.prototype,"handleMessage"),Nn.prototype),Nn);function jn(e){try{m.default.PAssert(350,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(t){m.default.reportError(t)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}jn.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){m.default.reportError(t)}}},registerFunction:function(e,t,a){try{m.default.PAssert(351,e,"Name must be provided to register function")}catch(i){m.default.reportError(i)}try{m.default.PAssert(352,t,"A valid function must be provided to register")}catch(i){m.default.reportError(i)}try{m.default.PAssert(353,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(i){m.default.reportError(i)}try{m.default.PAssert(354,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(i){m.default.reportError(i)}this._privateObj[e]=t.bind(this._privateObj),a&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,a){try{m.default.PAssert(355,e,"Name must be provided to register variable")}catch(i){m.default.reportError(i)}try{m.default.PAssert(356,!a,"Public variables are not currently supported")}catch(i){m.default.reportError(i)}try{m.default.PAssert(357,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(i){m.default.reportError(i)}try{m.default.PAssert(358,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(i){m.default.reportError(i)}this._privateObj[e]=t}},L.a.defineBase(jn);var zn=jn;function qn(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}qn.prototype={init:function(){m.default.isObject(window[this._name])?this.onAPILoaded():(L.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{m.default.PAssert(359,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){m.default.reportError(e)}m.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;m.default.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{m.default.PAssert(360,this._apiLoaded,"API must be loaded to notify listeners")}catch(a){m.default.reportError(a)}if(this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){try{m.default.PAssert(361,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(a){m.default.reportError(a)}this._requiredFns.push(e),this._apiLoaded&&(m.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{m.default.PAssert(362,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(t){m.default.reportError(t)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{m.default.PAssert(363,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(t){m.default.reportError(t)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{m.default.PAssert(364,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(a){m.default.reportError(a)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(i){m.default.reportError(i)}}}},L.a.defineBase(qn);var Wn,Gn=qn,Kn=(Wn=function(){function e(){if(r()(this,e),x.a.app)try{this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[v.a.AppPlatform.Electron]=this.setupElectron,this.sendFns=[],this.sendFns[v.a.AppPlatform.Electron]=this.sendToAppElectron,this.setupFn=this.setupFns[x.a.appPlatform],this.sendFn=this.sendFns[x.a.appPlatform],this.init(),this._isEnabled=!0}catch(t){m.default.log("Native API Bridge Disabled"),m.default.reportError(t)}else this._isEnabled=!1;if(this._embedBridge=void 0,x.a.app||x.a.embed){try{m.default.PAssert(108,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(a){m.default.reportError(a)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}return o()(e,[{key:"init",value:function(){try{m.default.PAssert(109,this.setupFn,"Must have a valid setup function")}catch(e){m.default.reportError(e)}try{m.default.PAssert(110,this.sendFn,"Must have a valid send function")}catch(e){m.default.reportError(e)}this.setupFn&&this.sendFn&&this.setupFn()}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"registerEmbedBridge",value:function(e){try{m.default.PAssert(111,e,"Must supply a valid embed bridge")}catch(t){m.default.reportError(t)}try{m.default.PAssert(112,x.a.embed,"Must be embedded")}catch(t){m.default.reportError(t)}this._embedBridge=e}},{key:"hasEmbedBridge",value:function(){return!!this._embedBridge}},{key:"sendToEmbed",value:function(e,t){try{m.default.PAssert(113,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(a){m.default.reportError(a)}this._embedBridge.handleEmbedMessage(e,t)}},{key:"registerInboundAPI",value:function(e){try{m.default.PAssert(114,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){m.default.reportError(a)}if(this._canRegisterAPIs){var t=new zn(e);return this._inboundAPIs[e]=t,t}}},{key:"registerOutboundAPI",value:function(e){try{m.default.PAssert(115,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){m.default.reportError(a)}if(this._canRegisterAPIs){var t=new Gn(e);return this._outboundAPIs[e]=t,t}}},{key:"setupElectron",value:function(){sr.ElectronBridge.setup()}},{key:"sendToApp",value:function(e,t){try{m.default.PAssert(116,x.a.app,"Only use native bridge when creating an app")}catch(n){m.default.reportError(n)}try{m.default.PAssert(117,this.sendFn,"Must have a valid send method for the native bridge")}catch(n){m.default.reportError(n)}var a=!1;try{var i;t&&(i=m.default.isString(t)?t:JSON.stringify(t)),this.sendFn&&(this.sendFn(e,i),a=!0)}catch(r){m.default.reportError(r)}return a}},{key:"sendToAppElectron",value:function(e,t){sr.ElectronBridge.sendMessage(e,t)}}]),e}(),D()(Wn.prototype,"setupElectron",[C.a],Object.getOwnPropertyDescriptor(Wn.prototype,"setupElectron"),Wn.prototype),D()(Wn.prototype,"sendToApp",[C.a],Object.getOwnPropertyDescriptor(Wn.prototype,"sendToApp"),Wn.prototype),D()(Wn.prototype,"sendToAppElectron",[C.a],Object.getOwnPropertyDescriptor(Wn.prototype,"sendToAppElectron"),Wn.prototype),Wn),Yn=v.a.TooltipDelay,Xn=function(){function e(){r()(this,e),this.tooltip=new z.a,this.tooltipsSticky=new q.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,x.a.touch||(k.a.listen("mouseover",this.handleEleOver.bind(this)),k.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}return o()(e,[{key:"windowOut",value:function(e){(e.pageX>=x.a.windowWidth()||e.pageY>=x.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()}},{key:"register",value:function(e,t){this.update(e,t)}},{key:"update",value:function(e,t){e.setAttribute("tooltip",t)}},{key:"displayTipSticky",value:function(e){e.sticky=!0,this.displayTip(e)}},{key:"displayTip",value:function(e){try{m.default.PAssert(120,e,"When display a tooltip, must pass in some info")}catch(n){m.default.reportError(n)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var a=e.text;this.isSticky=e.sticky;try{m.default.PAssert(121,a,"When display a tooltip, elements should always have valid data set")}catch(n){m.default.reportError(n)}if(a){var i={text:a,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(i):this.tooltip.set(i)}}}},{key:"tipOut",value:function(e){var t=!0;e.target&&(t=m.default.isAttachedToDoc(e.target)&&!m.default.findParent(e.target,"tooltip")),t&&this.hideTip()}},{key:"getAttr",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))}},{key:"getAttrHotkey",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))}},{key:"getByClassName",value:function(e,t){var a,i=x.a.priModKey,n=e.parentElement,r=e.textContent,s=x.a.mac?"Option":"Alt";if(!m.default.findParent(e,"fancyInputInner"))if(m.default.hasClass(e,"linkImage"))a="<b>Click</b> to open image.<br><b>"+i+" + Click</b> to open in "+(x.a.app?"browser":"new tab")+".";else if(n&&m.default.hasClass(n,"appLink")){a="<b>"+i+" + Click</b> to open in "+((m.default.hasClass(n,"Evernote")?"Evernote":"")||(m.default.hasClass(n,"OneNote")?"OneNote":"")||(m.default.hasClass(n,"Bear")?"Bear":""))}else if(m.default.hasClass(e,"link")&&e.getAttribute("data-href")){var o=e.getAttribute("data-href");a=(o!==r?o+"<br>":"")+"<b>"+i+" + Click</b> to open"}else m.default.hasClass(e,"tag")||m.default.hasClass(e,"contact")?a="<b>"+i+"+ Click</b> to show only "+r+"<br><b>"+i+" + Shift + Click</b> to hide "+r+"<br><b>"+s+" + Click</b> to remove "+r:m.default.hasClass(e,"email")?a="<b>"+i+"+ Click</b> to email "+r:m.default.hasClass(e,"prefixHeader")||m.default.hasClass(e,"prefixBullet")?a="<b>Click</b> to zoom in":m.default.hasClass(e,"prefixTask")?a="<b>Click</b> to toggle complete.<br><b>"+x.a.priModKey+" + Click</b> to zoom in.":m.default.hasClass(e,"prefixNumList")?a="<b>"+x.a.priModKey+" + Click</b> to zoom in":m.default.hasClass(e,"inlineDate")?a="<b>Click</b> to edit date<br><b>"+s+" + Click</b> to remove date":m.default.hasClass(e,"plugin")&&(a=(t>0?"<b>"+x.a.priModKey+" + Click</b>":"<b>Click icon</b>")+" to open");return a}},{key:"getTooltipText",value:function(e,t){return this.getAttr(e)||this.getByClassName(e,t)}},{key:"handleEleOver",value:function(e){try{m.default.PAssert(122,m.default.isDOMNode(e.target),"Must have a valid DOM node: ",T()(e.target))}catch(s){m.default.reportError(s)}if(e.target){for(var t,a,i=0,n=e.target,r=0;!t&&n&&r<3;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=this.getTooltipText(n,r),a=this.getAttrHotkey(n),t||a||(n=n.parentElement)}if(n&&(!t&&a&&(t=a,a=void 0),t&&this.displayElement!==n&&!sr.DragDrop.isDragging&&!R.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),Yn,{element:n,offset:{y:5},text:t,hotkey:a})}}}},{key:"handleEleOut",value:function(e){this.tipOut(e)}},{key:"isOpenSticky",value:function(){return this.tooltipsSticky.get().length>0}},{key:"hideSticky",value:function(e){for(var t=0,a=this.tooltipsSticky.get(),i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[i].text===e){this.tooltipsSticky.removeAt(i);break}}}},{key:"hideTip",value:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}}]),e}(),Qn=a(202),Jn=a(198),Zn=a(2),$n=a.n(Zn),er=function(){function e(t,a,i){r()(this,e),this.isComplete=new z.a(!1),this.id=t,this.text=a,this.noRender=i,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}return o()(e,[{key:"loadFromSaveData",value:function(e){var t=0;this.numComplete=0;for(var a=0,i=0;i<this.items.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.items[i];e[n.id]&&(n.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,i+1))),n.hiddenObservable&&n.hiddenObservable.get()||a++}if((this.numComplete===a||e[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<a){var r=this.items[this.next];r&&r.show()}}},{key:"saveData",value:function(e,t){for(var a=0,i=0;i<this.items.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.items[i];try{m.default.PAssert(985,n,"Item entries must exist")}catch(r){m.default.reportError(r)}n.isComplete.get()&&(e[n.id]=1)}t&&this.isComplete.get()&&(e[this.id]=1)}},{key:"addStep",value:function(e){try{m.default.PAssert(986,!!e.id===!!e.check,"Invalid help step")}catch(a){m.default.reportError(a)}var t=e;!1!==t.if&&(t.isComplete||(t.isComplete=new z.a(!1)),this.inOrder?t.isDisabled||(t.isDisabled=new z.a(this.items.length>0)):t.isDisabled=new z.a(!1),t.show||(t.show=function(){return t.isDisabled.set(!1)}),this.items.push(t))}},{key:"complete",value:function(e){e.isComplete.get()||(e.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(e))}},{key:"forceComplete",value:function(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()}},{key:"check",value:function(e){var t=0;try{m.default.PAssert(987,!this.isComplete.get(),"Should never be checking items in a completed section")}catch(n){m.default.reportError(n)}for(var a=0;a<this.items.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.items[a];if(!i.isComplete.get()&&((!0===e||i.check&&i.check(e))&&(this.complete(i),this.inOrder&&a===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),this.enforceOrder))break}}}]),e}(),tr=a(20),ar={display:"inline-block",height:"24px"};function ir(){sr.menus.openSettings(v.a.SettingsSections.Plugins)}var nr=function(){function e(){r()(this,e)}return o()(e,[{key:"init",value:function(){var e=this;this.mode=new z.a(v.a.HelpMode.None),this.position=new z.a,this.sections=new q.a,this.isVisible=new Li.a([this.mode],function(){return e.isHelpShowing()}),this.priKey=x.a.priModKey,this.secKey=x.a.secModKey,this.secKeyForce=x.a.secModKeyForce,this.tooltipIntroSection=void 0;var t=sr.settings.helpPaneState.get();void 0===t&&(t=v.a.HelpMode.None),this.initItemsDesktop(),m.default.isDemoMode()||(this.initState(t),sr.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&sr.settings.inTooltipIntro.set(!1)),sr.settings.helpPaneState.listen(function(t,a){void 0!==t&&t!==a&&e.initState(t)}),sr.settings.helpState.listen(function(t,a){t&&t!==a&&e.loadState()}),F.d.addListener(this.onAction.bind(this))}},{key:"isHelpShowing",value:function(){return this.mode.get()!==v.a.HelpMode.None}},{key:"initState",value:function(e){try{m.default.PAssert(230,void 0!==e,"Must pass in a valid intro mode")}catch(t){m.default.reportError(t)}this.sections.clear(),this.mode.set(e),this.isHotkeyMode()||this.initHelp(),sr.settings.inTooltipIntro.get()&&this.initTooltipIntro(),this.loadState()}},{key:"initItemsDesktop",value:function(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:'Add a date/time by typing ! in the text of an item or pressing <span class="hHotkey">'+this.priKey+" + Shift + D</span>",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.RightClick}};var e=sr.pluginManager.getPluginGmail(),t=sr.pluginManager.getPlugin(v.a.PluginID.GCalendar),a=sr.pluginManager.getPlugin(v.a.PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:$n.a.createElement("span",null,$n.a.createElement("span",{style:ar},$n.a.createElement(tr.a,{raised:!0,primary:!0,marginRight:8,onClick:ir},"Enable plugins")),"to connect to your other services"),hiddenObservable:new Li.a([e.isActiveObs,t.isActiveObs,a.isActiveObs]),check:function(){}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenEmail&&e.data.pane.type===v.a.PaneMode.Gmail}},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Tasks to organize it",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===v.a.PaneMode.Gmail}},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.RightClick&&e.data.pane.type===v.a.PaneMode.Gmail}},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.ToggleOverview&&e.data.pane.type===v.a.PaneMode.Gmail}},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.ComposeEmail}}}},{key:"setMode",value:function(e){this.mode.set(e),sr.settings.helpPaneState.set(e)}},{key:"show",value:function(e){this.setMode(e||v.a.HelpMode.Normal)}},{key:"toggle",value:function(e){!this.isHelpShowing()||e&&this.mode.get()!==e?this.show(e):this.close()}},{key:"close",value:function(){sr.tooltip.hideTip(),this.setMode(v.a.HelpMode.None),m.default.sendEvent("Menu","CloseHelp")}},{key:"isHotkeyMode",value:function(){return this.mode.get()===v.a.HelpMode.Hotkeys}},{key:"_getHelpStateObj",value:function(){var e={},t=sr.settings.helpState.get();if(m.default.isString(t)){if(t)try{(e=JSON.parse(t))&&!m.default.isString(e)||(e={})}catch(a){m.default.reportError(a)}}else e=t;return e||{}}},{key:"loadState",value:function(){var e=this._getHelpStateObj();if(e)for(var t=0,a=0;a<this.sections.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.sections.get()[a].loadFromSaveData(e)}}},{key:"saveState",value:function(){if(m.default.shouldWriteLocal())try{var e=this.getState();0,sr.settings.helpState.set(JSON.stringify(e))}catch(t){m.default.reportError(t)}}},{key:"getState",value:function(){for(var e=0,t=m.default.clone(this._getHelpStateObj()),a=0;a<this.sections.get().length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sections.get()[a].saveData(t)}return t}},{key:"notifyOfChange",value:function(){this.saveState()}},{key:"createSection",value:function(e,t,a,i){var n=0,r=new er(e,t,i);r.owner=this;for(var s=0;s<a.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.addStep(a[s])}return r}},{key:"addSection",value:function(e,t,a,i){var n=this.createSection(e,t,a,i);return this.sections.push(n),n}},{key:"checkAddItem",value:function(e){if(e.type===F.b.Create){_.a.getItem(e.data[0].itemID);return!1}}},{key:"checkIndent",value:function(e){if(e.type===F.b.Move){var t=e.data[0].oldParent;try{m.default.PAssert(231,t&&t.items,"Old parent must have items",t)}catch(a){m.default.reportError(a)}if(t&&t.items&&t.items.get().indexOf(e.data[0].newParent)>=0)return!0}}},{key:"checkSearch",value:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged}},{key:"checkComplete",value:function(e){if(e.type===F.b.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}}},{key:"checkOverview",value:function(e){return e.type===F.b.Misc&&e.misc===F.a.ToggleOverview}},{key:"checkZoom",value:function(e){return e.type===F.b.Zoom&&!e.data[0].zoomOut&&m.default.focusedPane&&m.default.focusedPane.overview.isVisible.get()}},{key:"checkPriority",value:function(e){var t=e.data[0];return e.type===F.b.Update&&"priority"===t.field&&t.newValue>0}},{key:"checkDate",value:function(e){return e.type===F.b.Insert&&"!"===e.data[0].text}},{key:"checkGoogleCalendar",value:function(e){return e.type===F.b.Misc&&e.misc===F.a.AddToGCal}},{key:"checkGoogleDrive",value:function(){}},{key:"initHelp",value:function(){function e(){sr.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:"optionsButton"})}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:function(e){if(e.type===F.b.Misc&&e.misc===F.a.DropItem&&m.default.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function(e){if(e.type===F.b.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with "+v.a.Prefix.Header+" to create a project",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SetPrefix&&e.data.prefix===v.a.Prefix.Header}},{id:"task",text:"Start a line with [ to create a task",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SetPrefix&&e.data.prefix===v.a.Prefix.Task}},{id:"bullet",text:"Start a line with - to create a bullet",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SetPrefix&&(e.data.prefix===v.a.Prefix.Bullet||e.data.prefix===v.a.Prefix.Bullet2||e.data.prefix===v.a.Prefix.Bullet3)}},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SetPrefix&&e.data.prefix===v.a.Prefix.NumList}}]),this.addSection("cal","Dates",[this.itemDateTime,{id:"enableCalendar",jsx:$n.a.createElement("span",null,$n.a.createElement(tr.a,{raised:!0,primary:!0,marginRight:8,onClick:ir},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:sr.pluginManager.getPlugin(v.a.PluginID.GCalendar).isActiveObs,check:function(){}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:function(e){if(e.type===F.b.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===F.b.Insert&&"+"===e.data[0].text}},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenContact}}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:function(e){return e.type===F.b.Zoom&&!e.data[0].zoomOut}},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:function(e){return e.type===F.b.Zoom&&e.data[0].zoomOut}},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===F.b.Insert&&e.data[0].text===v.a.TagPrefix}},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged&&0!==e.data.priority}},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged&&0!==e.data.starred}},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged&&0!==e.data.complete}},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged&&e.data.text.indexOf("-")>=0}}]),this.addSection("gm","Gmail",[{id:"eG",jsx:$n.a.createElement("span",null,$n.a.createElement(tr.a,{raised:!0,primary:!0,marginRight:8,onClick:ir},"Enable Gmail"),"to sync Gmail."),hiddenObservable:sr.pluginManager.getPlugin(v.a.PluginID.Gmail).isActiveObs,check:function(){}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:function(e){}},{id:"link",text:"Insert links like [title](http://address.com)",check:function(e){}},{id:"hr",text:"--- to insert a horizontal line",check:function(e){}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:$n.a.createElement("span",null,$n.a.createElement("span",{style:ar},"Click the ",$n.a.createElement(tr.a,{icon:"icon-folder",iconSize:18},"File"))," in the options button to open the Files menu"),check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenDocumentsMenu}},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenDocSharing}}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:$n.a.createElement("span",null,$n.a.createElement(tr.a,{raised:!0,primary:!0,marginRight:8,onClick:ir},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:sr.pluginManager.getPlugin(v.a.PluginID.Drive).isActiveObs,check:function(){}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Task Pane to add it to a list",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===v.a.PaneMode.Drive}},{id:"drDr",text:"Drag a file from your "+(x.a.mac?"Finder":"Explorer")+" to your Tasks to upload it to Drive and add it to a list",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.DriveUpload}}]),this.addSection("set","Settings",[{id:"oS",jsx:$n.a.createElement("span",null,"Click ",$n.a.createElement("span",{style:ar},$n.a.createElement(tr.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Settings, to access plugin and account settings."),check:function(e){return e.type===F.b.UIAction&&e.data[0].type===F.c.OpenSettingsMenu}},{id:"oDS",jsx:$n.a.createElement("span",null,"Click ",$n.a.createElement("span",{style:ar},$n.a.createElement(tr.a,{icon:"icon-settings",iconSize:18,onClick:e}))," in the sidebar, then Display Settings, to change display settings."),check:function(e){return e.type===F.b.UIAction&&e.data[0].type===F.c.OpenDisplaySettings}}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:$n.a.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",$n.a.createElement(tr.a,{primary:!0,onClick:function(){sr.menus.openModal(v.a.Modals.ReportBug)}},"contact us")," and tell us what app you want to import from."),check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenImport}},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenExport}}])}},{key:"onAction",value:function(e){if(!sr.menus.isModalOpen(v.a.Modals.ImportData))try{for(var t=0,a=this.sections.get(),i=0;i<a.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[i].isComplete.get()||a[i].check(e)}}catch(n){m.default.reportError(n)}}},{key:"runTooltipIntro",value:function(){sr.settings.inTooltipIntro.set(!0),this.initTooltipIntro()}},{key:"initTooltipIntro",value:function(){function e(){return sr.pluginManager.isGmailPaneEnabled()}function t(e){try{m.default.PAssert(232,e,"Must supply a valid tooltip descriptor")}catch(t){m.default.reportError(t)}try{m.default.PAssert(233,!e||e.element,"Must specify a valid target tooltip element")}catch(t){m.default.reportError(t)}sr.tooltip.hideSticky(e.text),e.blue=!0,"top"===e.arrowDirection&&(e.offset={top:15}),sr.tooltip.displayTipSticky(e)}var a,i,n,r=[];function s(e){var a=!1;r.push({id:e.id,check:function(i){return!(!e.check2Invalidates1||!e.check2(i))||(e.check1(i)?(setTimeout(function(){var i=m.default.isFunction(e.element)?e.element():e.element,n=m.default.isFunction(e.text)?e.text():e.text;i&&(a=!0,t({text:n,element:i,arrowDirection:e.arrowDirection,onRight:e.onRight}))},1e3),!0):void 0)}}),r.push({id:e.id+"_complete",check:function(t){if(e.check2(t)){if(a){var i=m.default.isFunction(e.text)?e.text():e.text;sr.tooltip.hideSticky(i)}return!0}}})}if(s({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:function(){return m.default.element("addPaneButton")},arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenAddPaneMenu}}),s({id:"tipAddPane",text:function(){return e()?"Add a Gmail pane to organize your email":"Add another Task pane to get another view on your tasks."},element:function(){return e()?m.default.element("addPane_PaneGmail"):m.default.element("addPane_PaneTask")},arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:function(e){return e.type===F.b.Misc&&e.misc===F.a.OpenAddPaneMenu},check2:function(t){return t.type===F.b.UIAction&&t.data[0].type===F.c.AddPane&&t.data[0].data.type===(e()?v.a.PaneMode.Gmail:v.a.PaneMode.Task)}}),s({id:"tipNewTaskPane",text:"Each Task pane is a unique view on the same data. Customize your view by searching and filtering.",element:function(){if(a){var e=a.element;if(e)return e.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:function(e){if(e.type===F.b.UIAction&&e.data[0].type===F.c.AddPane&&e.data[0].data.type===v.a.PaneMode.Task)return a=e.data[0].data.pane,!0},check2:function(e){return e.type===F.b.Misc&&e.misc===F.a.SearchChanged}}),s({id:"tipNewGmailPane",text:"Try dragging an email to your Task Pane",element:function(){if(i){var e=i.element;if(e)return e.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:function(e){if(e.type===F.b.UIAction&&e.data[0].type===F.c.AddPane&&e.data[0].data.type===v.a.PaneMode.Gmail&&sr.PaneManager.getPanesByType(v.a.PaneMode.Task).length>0)return i=e.data[0].data.pane,!0},check2:function(e){return e.type===F.b.Misc&&e.misc===F.a.DropItem&&e.data.fromPane&&e.data.fromPane.type===v.a.PaneMode.Gmail}}),s({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:function(){return m.default.element("addPaneButton")},arrowDirection:"left",onRight:!0,check1:function(e){return e.type===F.b.UIAction&&e.data[0].type===F.c.AddBoard},check2:function(e){return e.type===F.b.UIAction&&e.data[0].type===F.c.AddPane}}),s({id:"tipAddToCalendar",text:function(){return"Sync items with dates to Google Calendar by pressing "+x.a.secModKeyForce+" + C"},element:function(){var e=R.a.getStartElement();if(e)return e.getElementsByClassName("date")[0]},arrowDirection:"top",check1:function(e){if(e.type===F.b.Misc&&e.misc===F.a.ChangeDate&&m.default.isLoaded&&sr.pluginManager.getPlugin(v.a.PluginID.GCalendar).isActive())return!0},check2:function(e){return e.type===F.b.Misc&&e.misc===F.a.AddToGCal}}),s({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:function(){var e=n.element;if(e)return e.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:function(e){if(e.type===F.b.Zoom)return n=e.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),sr.settings.shouldShowHelp("helpTooltip")){setTimeout(function e(){if(sr.tooltip.isOpenSticky())setTimeout(e,5e3);else if(sr.settings.closeHelp("helpTooltip"),m.default.element("helpButton")){var a={text:"See the Help to learn more",element:m.default.element("helpButton"),arrowDirection:"left",onRight:!0};k.a.listen("helpOpened",function e(){sr.tooltip.hideSticky(a.text),k.a.unlisten("helpOpened",e)}),t(a)}},9e4)}this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",r,!0)}}]),e}(),rr=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return g()(t,e),o()(t,[{key:"init",value:function(e){this.rollbar=window.Rollbar,this.ElectronBridge=new Hn,this.nativeBridge=new Kn,f()(c()(t.prototype),"init",this).call(this,e),this.setup=new Qn.a,this.Measure=new Bn,this.Measure.init(),this.DesktopUI=new Un,this.DesktopUI.init(),this.tooltip=new Xn,this.AppCache=new Jn.a,this.intro=new nr}}]),t}(Cn),sr=t.default=new rr},33:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(1),h=a(3),f=a(15),p=a(49),g=a(17),m=a(110),v=a(42),y=a(14),k=function(){function e(t){r()(this,e),this.id=t.id,this.name=new f.a(t.name),this.panes=t.panes,this.index=t.index,this.defaultPanes=t.defaultPanes}return o()(e,[{key:"getSaveInfo",value:function(){var e={id:this.id,name:this.name.get(),index:this.index};return this.panes&&(e.panes=this.panes.map(d.default.cloneWithoutUndefineds)),this.defaultPanes&&(e.defaultPanes=this.defaultPanes.map(d.default.cloneWithoutUndefineds)),e}}]),e}(),_=a(161),S=a(37),P=c.a.TaskViewMode,w=1,I=(i=function(){function e(){var t=this;r()(this,e),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._selectionState=void 0,this._boards=new v.a,this.selectedIndex=new f.a,this.selected=new m.a([this.selectedIndex],function(){return t.get()}),this.selectedChanged=new p.a}return o()(e,[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(e){this._isAdding=e}},{key:"isAdding",value:function(){return this._isAdding}},{key:"add",value:function(e){this.setIsAdding(!0);var t=new k({id:this.getNextID(),name:this.getNextName(),panes:e||[],index:""+this._boards.length()});return this._boards.push(t),this.saveBoard(t),t}},{key:"removeBoard",value:function(e){if(this._boards.length()>1){var t=this._boards.indexOf(e),a=this.selectedIndex.get();this._boards.remove(e),!isNaN(a)&&a>=t&&this.setSelectedIndex(a-1),g.a.deleteBoard(e.id),this._localState&&delete this._localState[e.id]}}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){var e=this.selectedIndex.get();(void 0===e||e<0||e>=this.length())&&this.setSelectedIndex(0,!0),h.default.PaneManager.updateDisplayPanes()}},{key:"setSelectedIndex",value:function(e,t){var a=e!==this.selectedIndex.get();this.selectedIndex.set(e),(t||!1!==t&&a)&&this.selectedChanged.notify(),this._selectionState!==e&&(this._selectionState=e,h.default.settings.selectedBoard.set(this._selectionState))}},{key:"switchTo",value:function(e,t){var a=this._boards.indexOf(e);this.setSelectedIndex(a,t)}},{key:"_findMatchingLocalPane",value:function(e,t){var a;if(t)for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[n].id===e){a=t[n];break}}return a}},{key:"_generateUsablePaneState",value:function(e,t){for(var a=0,i=[],n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n],s=this._findMatchingLocalPane(r.id,t)||r;i.push(d.default.cloneWithoutUndefineds({id:r.id,name:r.name,item:r.item,document:r.document||g.a.getDefaultDocument().id,type:r.type,showarch:r.showarch,search:r.search,viewState:r.viewState||(r.viewMode?{viewMode:r.viewMode}:void 0),displayLocalItems:r.displayLocalItems,displayCalendars:r.displayCalendars,blocksCollapsed:r.blocksCollapsed,documentSortMode:r.documentSortMode,widthManual:r.widthManual,widthManualExpanded:r.widthManualExpanded,offset:s?s.offset:0,itemState:s?s.itemState:{},isOverviewVisible:!!s&&s.isOverviewVisible,isOverviewShowingContents:!!s&&s.isOverviewShowingContents,isExpanded:!!s&&s.isExpanded,selectedItem:s?s.selectedItem:void 0}))}return i}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}},{key:"_generateSyncPaneState",value:function(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a.push({id:n.id,name:n.name,item:n.item,type:n.type,document:n.document,showarch:n.showarch,search:n.search,viewState:n.viewState,displayCalendars:n.displayCalendars,displayLocalItems:n.displayLocalItems,widthManual:n.widthManual,widthManualExpanded:n.widthManualExpanded,blocksCollapsed:n.blocksCollapsed,documentSortMode:n.documentSortMode})}return a}},{key:"_generateLocalPaneState",value:function(e){for(var t=0,a=[],i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a.push({id:n.id,offset:n.offset,itemState:n.itemState,isOverviewVisible:n.isOverviewVisible,isOverviewShowingContents:n.isOverviewShowingContents,isExpanded:n.isExpanded,selectedItem:n.selectedItem})}return a}},{key:"savePaneState",value:function(e){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard()}catch(t){d.default.reportError(t,{numBoards:this._boards.length(),selectedIndex:this.selectedIndex.get()})}}},{key:"_saveLocalState",value:function(e){var t=this.get().id;try{d.default.PAssert(148,t,"Must have a valid board ID")}catch(i){d.default.reportError(i)}var a=this._generateLocalPaneState(e);d.default.deepEqual(a,this._localState[t])||(this._localState=d.default.clone(this._localState),this._localState[t]=a)}},{key:"_saveSyncState",value:function(e){var t=this.get();try{d.default.PAssert(149,t,"Selected board does not exist")}catch(a){d.default.reportError(a)}t&&(t.panes=this._generateSyncPaneState(e))}},{key:"renameBoard",value:function(e,t){if(e.name.get()!==t){for(var a=0,i=!1,n=0;n<this._boards.length();n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._boards.get()[n];r!==e&&r.name.get()===t&&(i=!0)}if(!i)return e.name.set(t),this.saveBoard(e),this.selected.notify(),!0}return!1}},{key:"saveBoardDefault",value:function(e){e.defaultPanes=d.default.clone(e.panes),this.saveBoard(e)}},{key:"restoreBoardDefault",value:function(e){e.panes=d.default.clone(e.defaultPanes),this.selectedChanged.notify()}},{key:"get",value:function(){var e=this.selectedIndex.get();if(void 0!==e)return this._boards.get()[e]}},{key:"createDefaultState",value:function(){if(0===this._boards.length()){var e=g.a.getDefaultDocument(),t=[];if(e){var a=e.getRootItem();t=[new k({id:g.a.generateID(),name:"Tasks",index:"0",panes:[{document:e.id,item:a.id,type:c.a.PaneMode.Task,viewState:{viewMode:P.Outline},isOverviewVisible:!0}]}),new k({id:g.a.generateID(),name:"Today",index:"1",panes:[{document:e.id,item:a.id,type:c.a.PaneMode.Task,viewState:{viewMode:P.Agenda_Today},isOverviewVisible:!0}]}),new k({id:g.a.generateID(),name:"Calendar",index:"2",panes:[{document:e.id,item:a.id,type:c.a.PaneMode.Task,viewState:{viewMode:P.Calendar_Week}}]})],h.default.pluginManager.isEnabled(c.a.PluginID.Gmail)&&t.splice(2,0,new k({id:g.a.generateID(),name:"Email",index:"1,0",panes:[{type:c.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(t),this.saveAll(),this.setSelectedIndex(0,!0),t}}},{key:"getNextName",value:function(){var e,t,a=0,i=this._boards.get(),n=1;do{var r=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=!1,t="Board "+n,n++;for(var s=0;s<i.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i[s].name.get()===t){e=!0;break}}}while(e);return t}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++w}},{key:"load",value:function(){var e,t;if(d.default.isDemoMode())t=this.createDefaultState(),e={};else if(this.trackPaneState()){var a=g.a.getBoards();(t=Object.keys(a).map(function(e){return new k(a[e])})).sort(S.a.compareItemIndex);try{e=h.default.settings.localPaneState.get()||{}}catch(i){e={}}}else e={};this._localState=e,t&&t.length>0&&(this._selectionState=h.default.settings.selectedBoard.get(),void 0===this._selectionState&&(this._selectionState=0),!isNaN(this._selectionState)&&this._selectionState>=t.length&&(this._selectionState=t.length-1),this._boards.set(t),this.setSelectedIndex(this._selectionState,!0))}},{key:"setBoards",value:function(e){this._boards.set(e),this.ensureSelected()}},{key:"saveAll",value:function(){var e=this;this.trackPaneState()&&this._boards.get().forEach(function(t){e.saveBoard(t)})}},{key:"saveBoard",value:function(e){if(this.trackPaneState()&&(e||(e=this.get()),e)){var t=e.getSaveInfo();g.a.saveBoard(t),h.default.settings.localPaneState.set(d.default.cloneWithoutUndefineds(this._localState))}}},{key:"trackPaneState",value:function(){return!d.default.isRunningScript()&&!d.default.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(e,t){var a=this._boards.get(),i=a[e],n=this.get();this._boards.splice(e,1,void 0,!1);var r=a[t-1],s=a[t],o=Object(_.a)(r?r.index:void 0,s?s.index:void 0);i.index=o,this._boards.splice(t,0,i);var l=this._boards.indexOf(n);l>=0&&this.setSelectedIndex(l,!1),this.saveBoard(i)}},{key:"cloneBoard",value:function(e,t){var a;(e=e||this.get(),t)?a=[t.getSaveInfoForClone()]:a=e.panes;try{d.default.PAssert(150,a,"Must have valid panes to clone a board")}catch(n){d.default.reportError(n)}var i=this.add(a);return this.switchTo(i),i}},{key:"getById",value:function(e){return this._boards.get().find(function(t){return t.id===e})}},{key:"onRemoteUpdate",value:function(e,t){var a=t.id,i=t.name,n=t.panes,r=t.index,s=t.defaultPanes,o=this.getById(a),l=this.get();if(e===c.a.CrudActions.Removed)o&&this.removeBoard(o);else if(o){var u=o.index!==r||!o.panes.equals(n,!0);try{o.name.set(i),o.index=r,o.panes=n,o.defaultPanes=s,u&&(this._boards.sort(S.a.compareItemIndex),this.switchTo(l,o===l))}catch(h){d.default.reportError(h,o.name)}}else this._boards.insertSorted(new k({id:a,name:i,panes:n,index:r,defaultPanes:s}),S.a.compareItemIndex),this.switchTo(l)}},{key:"hotkeyPrevBoard",value:function(){var e=this.selectedIndex.get()-1;e<0&&(e=this.length()-1),this.setSelectedIndex(e)}},{key:"hotkeyNextBoard",value:function(){var e=this.selectedIndex.get()+1;e>=this.length()&&(e=0),this.setSelectedIndex(e)}},{key:"selectBoard",value:function(e){e>=0&&e<this.length()&&this.setSelectedIndex(e)}},{key:"clear",value:function(){this._boards.clear()}}]),e}(),u()(i.prototype,"saveAll",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"saveAll"),i.prototype),u()(i.prototype,"saveBoard",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"saveBoard"),i.prototype),u()(i.prototype,"hotkeyPrevBoard",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"hotkeyPrevBoard"),i.prototype),u()(i.prototype,"hotkeyNextBoard",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"hotkeyNextBoard"),i.prototype),u()(i.prototype,"selectBoard",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"selectBoard"),i.prototype),i);t.a=new I},34:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(11),f=a.n(h),p=a(13),g=a.n(p),m=a(0),v=a(3),y=a(77),k=a(15),_=a(42),S=a(14),P=(i=function(e){function t(){var e;return r()(this,t),(e=u()(this,c()(t).call(this))).selected={},e.numSelected=new k.a(0),e._queueRemoveEditables=[],e}return f()(t,e),o()(t,[{key:"_selectedObjForPane",value:function(e){try{m.default.PAssert(537,e,"Multiselect should always pass in a pane")}catch(a){m.default.reportError(a)}e=e||m.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new _.a,isInverted:!1}),t}},{key:"_selectedForPaneObs",value:function(e){return this._selectedObjForPane(e).arr}},{key:"_selectedForPane",value:function(e){return this._selectedObjForPane(e).arr.get()}},{key:"onChanged",value:function(e){this.numSelected.set(this.numSelectedInPane(e))}},{key:"isInverted",value:function(e){return this._selectedObjForPane(e).isInverted}},{key:"setInverted",value:function(e,t){this._selectedObjForPane(t).isInverted=e}},{key:"isSelected",value:function(e,t){return this._selectedForPane(t).indexOf(e)>=0}},{key:"getSelected",value:function(e){return this._selectedForPane(e)}},{key:"getSelectedItems",value:function(e,t){for(var a=0,i=this._selectedForPane(e),n=[],r=0;r<i.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[r];if(e.numItems()>s){var o=e.itemAtIndex(s);!o||!t&&o.isNote()||n.push(o)}}return n}},{key:"numSelectedInPane",value:function(e){for(var t=0,a=0,i=this._selectedForPane(e),n=0;n<i.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.itemAtIndex(i[n]);!r||r.isNote&&r.isNote()||a++}return a}},{key:"getFirstSelectedIndex",value:function(e){var t=0;e=e||m.default.focusedPane;for(var a=this._selectedForPane(e),i=Number.MAX_VALUE,n=!1,r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=a[r];s<i&&(i=s,n=!0)}return n?i:-1}},{key:"getFirstSelectedItem",value:function(e){e=e||m.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"getLastSelectedIndex",value:function(e){var t=0;e=e||m.default.focusedPane;for(var a=this._selectedForPane(e),i=-1,n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];r>i&&(i=r)}return i}},{key:"getLastSelectedItem",value:function(e){e=e||m.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"_resetPaneID",value:function(e){var t=v.default.PaneManager,a=!0;if(t.isPaneActive(e)){var i=t.getPaneById(e);i.canResetMultiselect()?(this.setSelected([],i),this.selected[e].isInverted=!1):a=!1}else delete this.selected[e];return a}},{key:"reset",value:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var a in this.selected)this.selected.hasOwnProperty(a)&&(t=t&&this._resetPaneID(a));t&&this.fireEvent("reset",[e])}},{key:"clearEditables",value:function(e){for(var t=0,a=this.getSelectedItems(e),i=1===a.length?a[0]:void 0,n=0;n<this._queueRemoveEditables.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._queueRemoveEditables[n];r!==i&&(r.isEditable.set(!1),r.itemChanged.notify())}this._queueRemoveEditables=[]}},{key:"setSelected",value:function(e,t,a){var i=0;t=t||m.default.focusedPane;var n=this._selectedForPane(t),r=m.default.arrayDiff(n,e);this.setInverted(!1,t),this._selectedForPaneObs(t).set(e);for(var s=0;s<r.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[s];if(o<t.numItems()){var l=t.itemAtIndex(o);if(l)l.itemChanged.notify()}}}},{key:"toggleSelected",value:function(e,t,a){t=t||m.default.focusedPane;var i=this._selectedForPaneObs(t),n=t.itemAtIndex(e),r=i.indexOf(e);r>=0&&!0!==a?(i.remove(e),n.itemChanged.notify()):r<0&&!1!==a&&(i.push(e),n.itemChanged.notify())}},{key:"addSelected",value:function(e,t){this.toggleSelected(e,t,!0)}},{key:"removeSelected",value:function(e,t){this.toggleSelected(e,t,!1)}},{key:"selectInOrder",value:function(e,t,a){var i=0;a=a||m.default.focusedPane;for(var n=[],r=e;r<=t;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n.push(r)}this.setSelected(n,a)}},{key:"applyFnToSelected",value:function(e,t){var a=0;v.default.PaneUpdateBatcher.beginUpdateItems(),t=t||m.default.focusedPane;for(var i,n=this.getSelectedItems(t),r=0;r<n.length&&!1!==i;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=e(n[r],r,n.length)}v.default.PaneUpdateBatcher.commitUpdateItems()}}]),t}(y.a),g()(i.prototype,"reset",[S.a],Object.getOwnPropertyDescriptor(i.prototype,"reset"),i.prototype),i);t.a=new P},36:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(7),v=a(45),y=a(2),k=a.n(y),_=a(21),S=a(20),P=a(89),w=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.createObservables({isHovered:!1})}},{key:"getElement",value:function(){var e=this.refs.element;return e.getElement?e.getElement():e}},{key:"closeMenu",value:function(){!1!==this.props.canClose&&g.default.menus.closeContextMenu()}},{key:"onClick",value:function(e){var t=this.props;t.hasButtons||this.didClickJustFire||!t.onClick||(!1!==t.clickCloses&&this.closeMenu(),t.onClick(e),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))}},{key:"onClickIcon",value:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)}},{key:"onMouseDown",value:function(e){(this.props.onClickIcon||f.default.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()}},{key:"onMouseUp",value:function(e){var t=this.props;!isNaN(e.button)&&e.button!==p.a.ButtonCode.Left||m.a.mac&&e.ctrlKey||t.onClickIcon&&f.default.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e)}},{key:"onMouseEnter",value:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"render",value:function(){var e,t=this.props,a=this.state,i=t.onClick||t.hoverEffects,n=f.default.classNames("fancyContextMenuItem",{flexbox:!t.customLayout},{"c-foreground":!t.faded},{"c-foreground-faded":t.faded},{"c-popup-item":i&&!1!==t.hoverEffects},{hover:t.selected||!1!==t.hoverEffects&&a.isHovered},{"selected c-bg-dark":t.active},{disabled:t.disabled},{hasIcon:!!t.icon},{hasContent:!!t.children},{bold:t.bold},{hasHotkey:t.hotkey},{"flex-center":t.center},{hasButtons:t.hasButtons},this.props.className);if(t.icon)if(t.onClickIcon)e=k.a.createElement(S.a,{className:"fancyContextMenuIcon",icon:t.icon,tooltip:t.iconTooltip,width:36,height:t.height||28,onClick:this.onClickIcon});else{var r=f.default.classNames("fancyContextMenuIcon c-foreground-faded",t.icon),s={fontSize:t.iconSize,height:t.height,lineHeight:t.height&&t.height+"px",color:t.iconColor};e=k.a.createElement("span",{className:r,style:s,onClick:this.onClickIcon,"data-tooltip":t.iconTooltip})}var o,l=t.hotkey;if(l){var u=f.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:t.hotkeyCentered}),d=f.default.isString(l)?l:v.a.printHotkeyByName(l.name,l.group);o=k.a.createElement("span",{className:u},d)}var c=t.style||{};c.height=t.height,c.lineHeight=t.height&&t.height+"px",c.cursor=i?"pointer":"";var h={id:t.id,className:n,"data-tooltip":t.tooltip,onMouseOver:t.onMouseOver,style:c,ref:"element"};return i&&(h.onMouseDown=t.onClick?this.onMouseDown:void 0,h.onMouseUp=t.onClick&&!t.noMouseUp?this.onMouseUp:void 0,h.onClick=t.onClick&&t.noMouseUp?this.onMouseUp:void 0,h.onMouseEnter=!1!==t.hoverEffects?this.onMouseEnter:void 0,h.onMouseLeave=!1!==t.hoverEffects?this.onMouseLeave:void 0),k.a.createElement(t.onClick?P.a:"div",h,e,o?k.a.createElement("span",{className:"f1"},t.children):t.children,o)}}]),t}(_.a);t.a=w},37:function(e,t,a){"use strict";var i=function(e){var t={};return Object.keys(e).forEach(function(a){t[e[a]]=a}),t},n=function(e){return"string"===typeof e},r={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y"},s=i(r),o={items:!0},l={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q"},u=i(l),d={id:"id",text:"t",emails:"e",phoneNumbers:"p"},c=i(d),h={validateInFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(function(e){if(e.length<2||"undefined"===e)return!1}),!0)},validateOutFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach(function(e){if(e.length>2||"undefined"===e)return!1}),!0)},itemFieldMapIn:u,itemFieldMapOut:l,documentIn:function(e){return{id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,encryptionSentinel:e.p.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c}},documentOut:function(e,t){var a={id:e.id,p:{t:e.text}};return e.dateModified&&(a.p.d=e.dateModified),e.encryptionSentinel&&(a.p.s=e.encryptionSentinel),t&&t.onlyUpdate||(a.a=e.acl,a.r=e.root,a.v=e.version),t&&t.forLocal&&e.pendingSync&&(a.m=e.pendingSync),a},documentInFlat:function(e,t){return{id:e.id,acl:e.a,dateModified:e.d,text:e.t,encryptionSentinel:e.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c}},documentOutFlat:function(e,t){var a={id:e.id,d:e.dateModified,t:e.text};return e.encryptionSentinel&&(a.s=e.encryptionSentinel),t||(a.a=e.acl,a.r=e.root,a.v=e.version),e.pendingSync&&(a.m=e.pendingSync),a},userIn:function(e){var t={};return Object.keys(e).forEach(function(a){s[a]&&"undefined"!==s[a]&&(t[s[a]]=e[a])}),t},userOut:function(e){var t={};return Object.keys(e).forEach(function(a){r[a]&&void 0!==r[a]&&"undefined"!==r[a]&&(t[r[a]]=e[a])}),t},itemIn:function(e){var t={};return Object.keys(e).forEach(function(a){u[a]&&"undefined"!==u[a]&&(t[u[a]]=e[a])}),t},itemOut:function(e){var t={};return Object.keys(e).forEach(function(a){void 0!==e[a]&&!o[a]&&l[a]&&"undefined"!==l[a]&&(t[l[a]]=e[a])}),t},decryptItem:function(e,t,a){return e.text?t.decryptText(a,e.text,e.id).then(function(t){return e.text=t,e}):Promise.resolve(e)},encryptItem:function(e,t,a){return e.text?t.encryptText(a,e.text,e.id).then(function(t){return e.text=t,e}):Promise.resolve(e)},encryptItemOut:function(e,t,a){return h.encryptItem(e,t,a).then(function(e){return h.itemOut(e)})},decryptItemIn:function(e,t,a){return e=h.itemIn(e),h.decryptItem(e,t,a)},boardIn:function(e){var t=Object.assign({},e);return n(e.panes)&&(t.panes=JSON.parse(e.panes)),n(e.defaultPanes)&&(t.defaultPanes=JSON.parse(e.defaultPanes)),t},boardOut:function(e){var t=Object.assign({},e);return e.panes&&(t.panes=JSON.stringify(e.panes)),e.defaultPanes&&(t.defaultPanes=JSON.stringify(e.defaultPanes)),t},compareItemIndex:function(e,t){var a=0,i=null!==e.index?e.index:0,n=null!==t.index?t.index:0;if(void 0===i||void 0===n)return 0;"number"===typeof i&&(i=""+i),"number"===typeof n&&(n=""+n);for(var r=i.split(","),s=n.split(","),o=0;o<r.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(void 0===s[o])return 1;var l=+r[o],u=+s[o];if(l!==u)return l-u}return-1},contactIn:function(e){if(e.t){var t={};return Object.keys(e).forEach(function(a){c[a]&&"undefined"!==c[a]&&(t[c[a]]=e[a])}),t}return e},contactOut:function(e){var t={};return Object.keys(e).forEach(function(a){d[a]&&void 0!==d[a]&&"undefined"!==d[a]&&(t[d[a]]=e[a])}),t}};t.a=h},4:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(25),h=a.n(c),f=a(11),p=a.n(f),g=a(0),m=a(1),v=a(3),y=a(7),k=a(23),_=a(24),S=a(15),P=a(27),w=a(44),I=a(34),b=a(8),D="start",E="end",C=["mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix",["searchWrap",!0],"collapser","itemMenuIcon","itemEditButton",["formattingToolbar",!0],"itemTime"],A=function(e){function t(){var e;return n()(this,t),(e=l()(this,d()(t).call(this)))._isValid=!1,e._isInRightClick=!1,e._isDirty=!1,e._isWatchingChange=!0,e._isMouseDown=!1,e.isWindowFocused=new S.a(!0),e.hoveredItem=void 0,e.hoveredReactCell=void 0,e._previousSelectedIndex=void 0,e._previousIsValid=void 0,e._selectedMap=[],e.mousePos={x:-1,y:-1},e.mouseDownPos={x:-1,y:-1},e._lastClickTime=0,e._numClicks=0,e._savedPaneSels={},e._itemHighlightPosition=void 0,e.itemHighlightPosition=new S.a,e.init(),e}return p()(t,e),s()(t,[{key:"init",value:function(){this.reset();var e={};e.onStart=this.onMouseDown.bind(this),e.onEnd=this.onMouseUp.bind(this),e.onRightStart=this.onRightMouseDown.bind(this),e.onMove=this.onMouseMove.bind(this),document.addEventListener("mousemove",this.onMouseMoveDocument.bind(this),!0),window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this)),g.default.setupClick(document,this,e),_.a.listen("paneAdded",this.onPaneAdded.bind(this)),_.a.listen("paneRemoved",this.onPaneRemoved.bind(this)),k.a.binder(this,"restore","onScroll")}},{key:"reset",value:function(e,t){if(this._isValid){g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::reset");var a=!t&&this.save();a&&(this._previousSelection=a),this._setIndexSide(D,void 0),this._setIndexSide(E,void 0),this._setOffsetSide(D,void 0),this._setOffsetSide(E,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this._itemHighlightPosition=void 0;var i=this.getPane();!i||i.isUnloaded()||i.isDestroyed()||(i.caretPosition.set(void 0),this._updateSelection())}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(a){e.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(e.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(a){e.start.item="Invalid Item"}try{void 0!==this.endIndex&&(e.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(a){e.end.item="Invalid Item"}return e}},{key:"setValid",value:function(e){if(e){try{g.default.PAssert(237,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(i){g.default.reportError(i)}try{g.default.PAssert(238,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(i){g.default.reportError(i)}try{var t=this.pane.get().items.get()[this.startIndex];try{g.default.PAssert(239,t&&(g.default.isVMLI(t)||g.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(i){g.default.reportError(i)}var a=this.pane.get().items.get()[this.endIndex];try{g.default.PAssert(240,a&&(g.default.isVMLI(a)||g.default.isVMLI(a.item)),"Valid selection must always be into a VMLI for end item")}catch(i){g.default.reportError(i)}}catch(n){g.default.reportError(n)}}else this.reset();this._isValid=e}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(e){this._isArrowSelectInverted=e}},{key:"getStartItem",value:function(){return this.getPane().itemAtIndex(this.startIndex)}},{key:"getStartObject",value:function(){return this.getPane().objectAtIndex(this.startIndex)}},{key:"getStartOffset",value:function(){var e;return-1===this.startOffset?(e=this.getStartTotal(),this.startOffset=e):e=this.startOffset,e}},{key:"getStartIndex",value:function(){return this.startIndex}},{key:"getStartTotal",value:function(){return this.getStartItem().getParsedText().length}},{key:"getEndItem",value:function(){return this.getPane().itemAtIndex(this.endIndex)}},{key:"getEndObject",value:function(){return this.getPane().objectAtIndex(this.endIndex)}},{key:"getEndOffset",value:function(){var e;return-1===this.endOffset?(e=this.getEndTotal(),this.endOffset=e):e=this.endOffset,e}},{key:"getEndIndex",value:function(){return this.endIndex}},{key:"getEndTotal",value:function(){return this.getEndItem().getParsedText().length}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"_mutateProperty",value:function(e,t){var a=this[e];this[e]=t,a!==t&&(this._isDirty=!0)}},{key:"_setIndexSide",value:function(e,t){this._mutateProperty(e+"Index",t)}},{key:"_setOffsetSide",value:function(e,t){if(v.default.settings.selectFullItems.get()&&this.getStartIndex()!==this.getEndIndex()){var a=e===D?this.getStartIndex():this.getEndIndex(),i=this.getPane().itemAtIndex(a);t=e===D?0:i.getParsedText().length}this._mutateProperty(e+"Offset",t),g.default.shouldLog(m.a.LogLevels.Edit)&&g.default.log(e,t)}},{key:"setSelection",value:function(e,t,a,i){this._setIndexSide(D,e),this._setIndexSide(E,a),this._setOffsetSide(D,t),this._setOffsetSide(E,i),this._downIndex=e,this._downOffset={start:t,end:i}}},{key:"isValid",value:function(){return this._isValid}},{key:"checkValid",value:function(){var e=!1,t=this.getPane();if(t&&this.startIndex>=0&&this.startIndex<t.numItems()&&this.endIndex>=0&&this.endIndex<t.numItems())if(this.getStartItem()&&this.getEndItem()){var a=this.getStartItem().getParsedText(),i=this.getEndItem().getParsedText();this.startOffset>=0&&this.startOffset<=a.length&&this.endOffset>=0&&this.endOffset<=i.length&&(e=!0)}else e=!1;return!e&&this.isValid()&&(g.default.log("Sel is now invalid"),this.reset(void 0,!0)),e}},{key:"clearSelection",value:function(e){this.reset(e)}},{key:"onPaneAdded",value:function(e){e.addScrollListener(this.onScroll)}},{key:"onPaneRemoved",value:function(e){e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(e){var t=g.default.getPaneForElement(e.target);if(this._isMouseDown&&t===this.getPane()&&t.isWriteable&&!a(158).default.isDragging){var i=this.getMousePos();this._mouseOffset=i.y+t.getScrollTop();var n=document.elementFromPoint(i.x,i.y),r={clientX:i.x,clientY:i.y,target:n};this._updateFromMouse(r),this._updateSelection()}}},{key:"onRightMouseDown",value:function(e){var t=!g.default.hasClass(e.target,"mdImage"),a=g.default.findParent(e.target,"item")&&g.default.getElementParent(e.target);if(a&&!g.default.findParent(a,"autocompleteItem",2)&&!g.default.hasClass(a,"itemNotInPane")){var i=g.default.getPaneObjectForElement(a);if(i){var n=g.default.getPaneForElement(a),r=i.index;this.isSelected(r,n)&&(t=!1)}}t&&(this._isInRightClick=!0,this.onMouseDown(e,!0),this._isInRightClick=!1)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"onMouseDown",value:function(e,t){var a=g.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),g.default.findParent(e.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),a&&!(e.clientX-v.default.DesktopUI.getSidebarWidth()>a.getLeft()+a.getWidth()-48)){this.setFocusedPane(a);var i=e.target,n=a.getInfiniteList();if(a.supportSel&&!C.some(function(e){return g.default.isArray(e)?g.default.findParent(i,e[0]):g.default.hasClass(i,e)})){t||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var r,s=this.mouseDownPos.x,o=this.mouseDownPos.y,l=!1,u=g.default.getElementParent(e.target),d=g.default.findParent(e.target,"line");if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,!d&&(d=u&&g.default.findChild(u,"line"))){var c=g.default.offset(d);r=e.clientX>c.left+50||e.clientY>c.top+10?"end":"start"}if(g.default.findParent(i,"paneContent")){if(a&&a.isWriteable&&a.isEditable){if(u&&d){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var h=Date.now();h-this._lastClickTime<m.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-s)<2&&Math.abs(e.pageY-o)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=h}var f=P.default.getCursorSelectionRange(e);if(f){g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::onMouseDown - Default");var p=g.default.getListCellForElement(e.target);if(p&&!p.props.overview){if(this.preferLineStart=e.clientX-g.default.offset(d).left<30,e.shiftKey&&!(y.a.mac&&e.metaKey||!y.a.mac&&e.ctrlKey))this._mouseMoved=!0,this._mouseOffset=e.eventY+a.getScrollTop(),this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){this._downIndex=p.getIndex();try{g.default.PAssert(244,this._downIndex>=0,"Must have a valid index in react item")}catch(O){g.default.reportError(O)}if(this._downIndex<0)try{g.default.PAssert(245,this._downIndex>=0,"Dead cell error",g.default.getElementPath(f.getStartElement()),g.default.getElementPath(e.target))}catch(O){g.default.reportError(O)}this._downItem=p.getItem();try{g.default.PAssert(246,this._downItem,"Must have a valid item in react item")}catch(O){g.default.reportError(O)}var k=f.getSelectOffsetsInElement(u);if(r){var _="start"===r?this._downItem.getPrefixLength():this._downItem.getTextLength();k.start=_,k.end=_}if(0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset={start:k.total,end:k.total}:this._downOffset={start:k.start,end:k.start},v.default.settings.showMarkdown.get()&&!this.isSelected(this._downIndex,a)){var S=g.default.findParent(f.getStartContainer(),"mdSpan",2);if(S&&f.getStartOffset()===S.innerHTML.length){for(var I=0,b=S.nextElementSibling,A=0;b&&g.default.hasClass(b,"mdMarkup");){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;A+=b.innerHTML.length,b=b.nextElementSibling}if(!b){var M=Math.min(this._downOffset.start+A,k.total);this._downOffset={start:M,end:M}}}}this.setSelection(this._downIndex,this._downOffset.start,this._downIndex,this._downOffset.end)}else if(2===this._numClicks){var T=this._downItem.getParsedText(),L=w.a.getPreviousWord(this._downItem,T,this._downOffset.start)+1,x=w.a.getNextWord(this._downItem,T,this._downOffset.end);this._setOffsetSide(D,L),this._setOffsetSide(E,x),this._downOffset={start:L,end:x}}else 3===this._numClicks&&(this._setOffsetSide(D,0),this._setOffsetSide(E,this._downItem.getParsedText().length),this._downOffset={start:0,end:this._downItem.getParsedText().length});l=!0}}}else if(!g.default.findParent(e.target,"paneContent")||g.default.findParent(e.target,"addItemButton")||n.disablePointerEvents.get())g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::onMouseDown - Skip");else{var R=a.indexOfLastItem();R>=0&&(e.shiftKey&&this.isValid()&&!t?this.selectIndices(this.getStartIndex(),this.getStartOffset(),R,-1):this.selectIndex(R,-1),l=!0),e.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::onMouseDown - Skip header");this.setValid(l&&this.checkValid()),this.isValid()&&(g.default.setItemAnimationMode(m.a.ItemAnimationMode.None),this._updateSelection(),g.default.resetItemAnimationMode()),n&&n.flushTimeoutPointerEvents()}}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"onMouseMoveDocument",value:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}},{key:"onMouseMove",value:function(e){if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!g.default.isDraggingImage){var t=g.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&t===this.getPane()&&t.supportSel&&t.isWriteable&&!a(158).default.isDragging)return this._mouseMoved=!0,g.default.setItemAnimationMode(m.a.ItemAnimationMode.None),this._mouseOffset=e.eventY+t.getScrollTop(),this._updateFromMouse(e),this._updateSelection(),e.preventDefault(),!1}}},{key:"onMouseUp",value:function(e){var t=g.default.isAttachedToDoc(e.target)&&g.default.getPaneForElement(e.target),a=t&&g.default.getElementParent(e.target);t&&t.supportSel&&!C.some(function(t){return g.default.isArray(t)?g.default.findParent(e.target,t[0]):g.default.hasClass(e.target,t)})&&(this._isMouseDown=!1,g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::onMouseDown - onMouseUp"),g.default.vmMain&&g.default.resetItemAnimationMode(),!a||g.default.hasClass(e.target,"contact")||g.default.hasClass(a,"itemNotInPane")||g.default.findParent(e.target,"inlineDate")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),g.default.cancelRepeatScrolls())}},{key:"focusPane",value:function(e){this.setFocusedPane(e),this.updateCaret()}},{key:"setFocusedPane",value:function(e){if(!e||!g.default.focusedPane||g.default.focusedPane.id!==e.id){var a=g.default.focusedPane;if(a&&!a.isUnloaded()&&(a.setFocused(!1),a.isEditable&&this.isValid()&&(this._savedPaneSels[a.id]=this.save())),v.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),I.a.reset(a),g.default.focusedPane=e,g.default.focusedItem=e?e.getItem():void 0,h()(d()(t.prototype),"setFocusedPane",this).call(this,e),e){var i=this._savedPaneSels[e.id];i?(i.pane=e,e.isLoaded?this.restore(i):setTimeout(this.restore,0,i),this._savedPaneSels[e.id]=void 0):this.reset(),e.setFocused(!0)}v.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"_updateWith",value:function(e,t,a){var i=t===D?a.getStartElement():a.getEndElement();try{g.default.PAssert(247,i,"Trying to select in invalid container")}catch(u){g.default.reportError(u)}if(i){var n=g.default.getListCellForElement(i),r=g.default.getElementParent(i),s=g.default.getItemForElement(r),o=a.getSelectOffsetsInElement(r),l=t===D?o.start:o.end;try{g.default.PAssert(248,n.getItem(),"Should not be updating ReactCells without VMLIs")}catch(u){g.default.reportError(u)}if(g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::_updateWith["+e+"] - ",l,n.index),this._setIndexSide(e,n.getIndex()),this._dblClickOffsets&&n.getIndex()===this._dblClickOffsets.index)if(e===D)l=Math.min(l,this._dblClickOffsets.start);else if(e===E)l=Math.max(l,this._dblClickOffsets.end);else try{g.default.PAssert(249,!1,"Invalid toUpdate value")}catch(u){g.default.reportError(u)}this._downOffset.start!==this._downOffset.end&&(l=e===D?w.a.getPreviousWord(s,s.getParsedText(),l)+1:w.a.getNextWord(s,s.getParsedText(),l-1)),this._setOffsetSide(e,l);try{g.default.PAssert(250,!isNaN(l),"Selection offsets should not be undefined")}catch(u){g.default.reportError(u)}}}},{key:"_setSelectionOnSide",value:function(e,t,a){var i=e===D?E:D;this._setIndexSide(e,t),this._setIndexSide(i,this._downIndex),this._setOffsetSide(e,a),this._setOffsetSide(i,e===D?this._downOffset.start:this._downOffset.end),this.setArrowSelectInverted(t<this._downIndex||t===this._downIndex&&a<this._downOffset.start)}},{key:"_updateFromMouse",value:function(e){var t=e.target;if(t){var a=g.default.focusedPane;if(!g.default.getElementParent(t)&&e.clientY<a.contentTop()){if(g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::_updateFromMouse - outOfPane"),t=g.default.elementFromPoint(e.clientX,a.contentTop()+1),g.default.getElementParent(t)){var i=g.default.getListCellForElement(t),n=g.default.getItemForElement(t);try{g.default.PAssert(251,n,"If it is an LI it should be an item",t)}catch(_){g.default.reportError(_)}this._setIndexSide(D,i.getIndex()),this._setOffsetSide(D,0)}}else{var r,s,o,l=g.default.getElementParent(t);if(l){if(g.default.findParent(t,"line")||(t=l.firstElementChild),(o=P.default.getCursorSelectionRange(e))&&o.getStartElement()){var u=g.default.getListCellForElement(t);try{g.default.PAssert(252,u,"Must be able to find a valid reactCell for the start element")}catch(_){g.default.reportError(_)}if(u){if((r=u.getIndex())<0)try{g.default.PAssert(254,r>=0,"Dead cell error",g.default.getElementPath(o.getStartElement()),g.default.getElementPath(t))}catch(_){g.default.reportError(_)}if(g.default.findParent(o.getStartContainer(),"line")&&g.default.findParent(o.getEndContainer(),"line"))s=o.getSelectOffsetsInElement(l).start;else r<=this._downIndex?this._setSelectionOnSide(D,r,0):this._setSelectionOnSide(E,r,0)}}}else if(a.hasNonVMLIs){var d=g.default.getPaneObjectForElement(t);if(d){var c=d.index;if(c>=0)if(!a.itemAtIndex(c))if(c<this._downIndex){var h=a.indexOfNextVMLI(c);h>=0&&this._setSelectionOnSide(D,h,0)}else{var f=a.indexOfPrevVMLI(c);if(f>=0){var p=a.itemAtIndex(f);this._setSelectionOnSide(E,f,p.getParsedText().length)}}}}else if(g.default.hasClass(t,"paneContent")){g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::_updateFromMouse - paneContent");var v=a.getLastItem();this._setIndexSide(E,a.numItems()-1),this._setOffsetSide(E,v?v.getParsedText().length:0)}if(!isNaN(r)&&!isNaN(s)&&o){var y,k=g.default.findParent(t,"line");if(k)this.preferLineStart=e.clientX-g.default.offset(k).left<30,r<this._downIndex||r===this._downIndex&&s<this._downOffset.start?(y=E,this._updateWith(D,D,o),this.setArrowSelectInverted(!0)):(r>this._downIndex||r===this._downIndex&&s>=this._downOffset.start)&&(y=D,this._updateWith(E,E,o),this.setArrowSelectInverted(!1),s===this._downOffset.start&&(this._isDirty=!0)),void 0!==y&&(g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::_updateFromMouse - RunAfterUpdates"),this._setIndexSide(y,this._downIndex),this._dblClickOffsets?this._setOffsetSide(y,this._dblClickOffsets[y]):this._setOffsetSide(y,y===D?this._downOffset.start:this._downOffset.end),this.setValid(!0))}}}}},{key:"setSelectionFromNativeRange",value:function(e){this._updateWith(D,D,e),this._updateWith(E,E,e),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(){var e=this;if(this._isDirty){var t=this.getPane(),a=this.save(),i=this._selectedMap;this.getStartIndex()!==this.getEndIndex()||(this.getStartOffset(),this.getEndOffset());if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{g.default.PAssert(255,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(c){g.default.reportError(c)}this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()}}else for(var n=0,r=this.getStartIndex();r<=this.getEndIndex();++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=!0;if(!v.default.settings.selectFullItems.get())if(r===this.getStartIndex())s={start:this.getStartOffset(),end:-1};else if(r===this.getEndIndex()){try{g.default.PAssert(256,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(c){g.default.reportError(c)}s={start:0,end:this.getEndOffset()}}this._selectedMap[r]=s}if(t){var o=!1;i.forEach(function(a,i){if(void 0===e._selectedMap[i]&&i<t.numItems()){var n=t.itemAtIndex(i);n&&(n.itemChanged.notify(),o=o||t.checkHeightChanged(n,i),0)}}),this._selectedMap.forEach(function(a,n){var r=i[n],s=e._selectedMap[n];if(void 0===r||r.start!==s.start||r.end!==s.end){var l=t.itemAtIndex(n);l&&((!r||s.start!==s.end||r&&r.start!==r.end||g.default.isObject(r)!==g.default.isObject(s))&&l.itemChanged.notify(),o=o||t.checkHeightChanged(l,n),0)}}),o&&(g.default.setItemAnimationMode(m.a.ItemAnimationMode.Move),t.updateItems(!1,!0),g.default.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,_.a.fireEvent("selectionChanged",[a]);var l=this.getStartIndex(),u=this.isValid();if(l===this.getEndIndex()||!u){if(l!==this._previousSelectedIndex||u!==this._previousIsValid){var d=u?this.getStartItem():void 0;_.a.fireEvent("selectedIndexChanged",[l,t,d])}this._previousSelectedIndex=l,this._previousIsValid=u}}}},{key:"updateCaret",value:function(){var e=this.getPane();if(e&&e.isWriteable){if(this.isValid()){var t=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();t?e.openNoteContextMenu():!v.default.menus.isAutocompleteOpen()&&v.default.menus.isContextMenuOpen()&&v.default.menus.closeContextMenu()}if(this.isValid()){0;var a=this.getStartItem(),i=this.getStartObject(),n=e.topOfIndex(this.getStartIndex())+(a&&a.shouldShowParents(i,e)?m.a.HeightAgendaParents:0),r=e.getPaddingForPaneObject(i),s=v.default.Measure.getCaretOffset(i,e,this.getStartOffset(),this.preferLineStart);if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){this._selectionBeforeUpdate={index:this.getStartIndex(),offset:this.getStartOffset()};var o=e.caretPosition.get();s.left=Math.floor(Math.min(s.left+r,e.getWidth()-10)),s.top+=n,s.isVisible=!0,s.item=a,s.pane=e,s.paneObject=i,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),o&&o.isVisible&&o.left===s.left&&o.top===s.top||e.caretPosition.set(s)}else{var l=e.caretPosition.get();l&&l.isVisible&&((l=g.default.clone(l)).isVisible=!1,e.caretPosition.set(l));var u=this.getStartIndex()===this.getEndIndex()?this.getEndOffset():a.getTextLength(),d=v.default.Measure.getCaretOffset(i,e,u,this.preferLineStart);this._itemHighlightPosition={x:r+(s.left+d.left)/2,y:n}}t||!e.hiddenInput||this.isComposing||this.focusHiddenInput()}else e.caretPosition.set(void 0)}}},{key:"focusHiddenInput",value:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput){var t=P.default.createSelectionRange(),a=e.hiddenInput,i=0,n=1,r=e.scrollElement,s=r.scrollLeft,o=r.scrollTop;if(this.isValid()){var l=this.getStartItem().getParsedText();a.innerHTML=g.default.escape(l),i=this.getStartOffset(),n=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset(),i>l.length&&(i=l.length),n>l.length&&(n=l.length)}a.firstChild&&0!==a.firstChild.length||(a.innerHTML=m.a.TextSpace);var u=a.firstChild;try{g.default.PAssert(259,u,"Empty element must have a valid child")}catch(d){g.default.reportError(d)}try{a.focus(),t.setStart(u,i),t.setEnd(u,n),P.default.setSelectionRange(t)}catch(c){g.default.reportError(c)}r.scrollLeft=s,r.scrollTop=o}}},{key:"isSelected",value:function(e,t){return t===this.getPane()&&!!this._selectedMap[e]}},{key:"getSelectionAtIndex",value:function(e){return this._selectedMap[e]}},{key:"selectIndices",value:function(e,t,a,i,n){try{g.default.PAssert(260,e>=0,"Must supply a valid start index")}catch(c){g.default.reportError(c)}try{g.default.PAssert(261,a>=0,"Must supply a valid end index")}catch(c){g.default.reportError(c)}try{g.default.PAssert(262,a>e||a===e&&(i>=t||-1===i),"Must not pass reversed selection")}catch(c){g.default.reportError(c)}if(!(e<0||a<0)){var r,s,o=!1,l=this.getPane();if(l&&l.isWriteable){r=l.itemAtIndex(e),s=l.itemAtIndex(a);try{g.default.PAssert(263,r,"Trying to select invalid start index")}catch(c){g.default.reportError(c)}try{g.default.PAssert(264,s,"Trying to select invalid end index")}catch(c){g.default.reportError(c)}if(r&&s&&n!==m.a.SelectOption.AllowPrefix){var u=r.getPrefixLength(),d=s.getPrefixLength();t>=0&&t<u&&(t=u),i>=0&&i<d&&(i=d)}}if(!r||!s||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&a===this.getEndIndex()&&i===this.getEndOffset())this.updateCaret();else{g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::selectIndices -",t,i),this.setSelection(e,t,a,i);try{g.default.PAssert(265,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(c){g.default.reportError(c)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(),o=!0}return o}}},{key:"selectItem",value:function(e,t,a){try{g.default.PAssert(266,g.default.isNumber(t),"Must pass a valid start offset")}catch(i){g.default.reportError(i)}try{g.default.PAssert(267,g.default.isNumber(a)||void 0===a,"Must pass a valid end offset")}catch(i){g.default.reportError(i)}return void 0===a&&(a=t),this.selectItems(e,t,e,a)}},{key:"selectItems",value:function(e,t,a,i){try{g.default.PAssert(268,g.default.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(o){g.default.reportError(o)}try{g.default.PAssert(269,g.default.isVMLI(a),"Should only be passing VMLIs to end this fn")}catch(o){g.default.reportError(o)}var n=this.getPane();if(n){var r=n.indexOfItem(e);try{g.default.PAssert(270,r>=0,"Must be able to find the start item in the pane")}catch(o){g.default.reportError(o)}var s=n.indexOfItem(a);try{g.default.PAssert(271,s>=0,"Must be able to find the end item in the pane")}catch(o){g.default.reportError(o)}return this.selectIndices(r,t,s,i)}}},{key:"selectElements",value:function(e,t,a,i){try{g.default.PAssert(272,!g.default.isVMLI(e),"Should not be passing VMLIs to start this fn")}catch(o){g.default.reportError(o)}try{g.default.PAssert(273,!g.default.isVMLI(a),"Should not be passing VMLIs to end this fn")}catch(o){g.default.reportError(o)}g.default.shouldLog(m.a.LogLevels.Selection)&&g.default.log("Sel::selectElements -",t,i),this._isWatchingChange=!1;var n=!1,r=P.default.getOffsetChildElement(e,t),s=P.default.getOffsetChildElement(a,i);try{g.default.PAssert(274,r&&r.element&&!isNaN(r.offset),"Start element is invalid")}catch(o){g.default.reportError(o)}try{g.default.PAssert(275,s&&s.element&&!isNaN(s.offset),"End element is invalid")}catch(o){g.default.reportError(o)}return r&&r.element&&s&&s.element&&(P.default.setSelection(r.element,r.offset,s.element,s.offset),n=!0),this._isWatchingChange=!0,n}},{key:"save",value:function(e){if(this._isValid){var t=this.getPane();if(!t.isDestroyed()&&!t.isUnloaded()){try{g.default.PAssert(276,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(i){g.default.reportError(i)}try{g.default.PAssert(277,!isNaN(this.getEndIndex()),"End index must be valid")}catch(i){g.default.reportError(i)}var a={pane:t,startIndex:this.getStartIndex(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endOffset:this.getEndOffset()};return e||(a.endItem=this.getEndItem(),a.endObject=this.getEndObject(),a.startItem=this.getStartItem(),a.startObject=this.getStartObject()),this._savedSelection=a,a}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(e,t){var a=!1;if(e&&!e.pane.isDestroyed()){try{g.default.PAssert(278,e.pane,"Must have a valid pane to restore selection to")}catch(n){g.default.reportError(n)}var i=g.default.focusedPane;g.default.focusedPane=e.pane,g.default.focusedItem=e.pane.getItem(),i&&!i.isUnloaded()&&i!==e.pane&&i.setFocused(!1),e.pane.setFocused(!0),this.pane.set(e.pane),t||(e=e.pane.adjustSelectionFromPaneObject(e))}return e&&e.startItem&&e.endItem?(this.selectIndices(e.startIndex,e.startOffset,e.endIndex,e.endOffset),a=!0):this.reset(),this._savedSelection=void 0,a}},{key:"scrollStartIntoView",value:function(e){if(this._isValid){try{g.default.PAssert(279,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){g.default.reportError(t)}try{g.default.PAssert(280,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){g.default.reportError(t)}g.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?m.a.ScrollDuration.Snap:m.a.ScrollDuration.Default)}}},{key:"scrollEndIntoView",value:function(){if(this._isValid){try{g.default.PAssert(281,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){g.default.reportError(e)}try{g.default.PAssert(282,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){g.default.reportError(e)}g.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),m.a.ScrollDuration.Default)}}},{key:"onWindowBlur",value:function(e){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(e){this.isWindowFocused.set(!0)}},{key:"getSelectedObjects",value:function(e){var t=0;if(!this._isValid)return[];for(var a=[],i=this.getPane(),n=this.getStartIndex();n<=this.getEndIndex();++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i.objectAtIndex(n),s=r.item;!s||!e&&s.isNote()||a.push(r)}return a}},{key:"getSelectedItems",value:function(e,t){var a=0;if(!this._isValid)return[];for(var i=[],n=this.getPane(),r=this.getStartIndex();r<=this.getEndIndex();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n.objectAtIndex(r),o=s.item,l=n.isPaneObjectCollapsed(s);!o||!e&&o.isNote()||(i.push(o),t&&l?o.forEachChildRecursive(function(e){return i.push(e)},e):e&&r===this.getEndIndex()&&o.hasNote()&&i.push(o.getNote()))}return i}},{key:"getStartElement",value:function(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())}},{key:"getEndElement",value:function(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())}},{key:"setHovered",value:function(e,t,a){if(this.hoveredReactCell!==a){var i=this.hoveredItem;this.hoveredItem=t,this.hoveredReactCell=a,i&&i.itemChanged.notify(),t&&t.itemChanged.notify()}}},{key:"isReactCellHovered",value:function(e){return this.hoveredReactCell===e}},{key:"isItemHovered",value:function(e){return this.hoveredItem===e}},{key:"fireKeyEvent",value:function(e,t,a){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",a||t),this.fireKeyEventInternal(e,"keyup",t)}},{key:"fireKeyEventInternal",value:function(e,t,a){try{g.default.PAssert(283,void 0!==a,"Must pass in valid key data to type")}catch(n){g.default.reportError(n)}if(e||(e=this.getStartElement()),document.createEvent&&e){var i=document.createEvent("Event");i.normCode=a.normCode,i.shiftKey=!!a.shiftKey,i.altKey=!!a.altKey,i.ctrlKey=!!a.ctrlKey,i.metaKey=!!a.metaKey,i.synthetic=!0,i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(e)try{g.default.PAssert(284,!1,"Unable to fire key event")}catch(n){g.default.reportError(n)}else try{g.default.PAssert(285,!1,"No element available to fire key event on")}catch(n){g.default.reportError(n)}}},{key:"fireClickEvent",value:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}},{key:"fireClickEventInternal",value:function(e,t,a,i){try{g.default.PAssert(286,void 0!==a,"Must pass in a valid button to click with")}catch(s){g.default.reportError(s)}if(e||(e=P.default.getSelectionNode()),document.createEvent&&e){var n=document.createEvent("Event");if(n.button=a,n.synthetic=!0,i)for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);n.initEvent(t,!0,!0),e.dispatchEvent(n)}else if(e)try{g.default.PAssert(287,!1,"Unable to fire click event")}catch(s){g.default.reportError(s)}else try{g.default.PAssert(288,!1,"No element available to fire click event on")}catch(s){g.default.reportError(s)}}},{key:"fireMouseUp",value:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},{key:"editNote",value:function(e){var t=this,a=g.default.focusedPane,i=this.getStartObject();if(e.isNote())this.selectIndex(this.getStartIndex(),0);else{e.hasNote()||(b.d.beginAction(),e.createNote(),b.d.endAction());var n=a.indexOfObject(i);setTimeout(function(){t.selectIndex(n+1,0)},0)}}}]),t}(function(){function e(){n()(this,e),this.pane=new S.a}return s()(e,[{key:"setSelectedPaneObject",value:function(e){}},{key:"scrollStartIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){try{g.default.PAssert(530,this.pane.get()===g.default.focusedPane,"Should these always match?")}catch(e){g.default.reportError(e)}return this.pane.get()}},{key:"setFocusedPane",value:function(e){g.default.focusedPane=e,this.pane.set(e)}},{key:"applyFormatToSelection",value:function(e){var t,a,i=this,n=!1;g.default.setItemAnimationMode(m.a.ItemAnimationMode.None),g.default.focusedPane.applyToSelection(function(r,s,o){var l=0===s?i.getStartOffset():0,u=s===o-1?i.getEndOffset():r.getParsedText().length,d=r.applyFormatToSelection(e,l,u,0===s?m.a.SetMode.Toggle:n?m.a.SetMode.Yes:m.a.SetMode.No);0===s&&(n=d.didSet,t=d.selStart),s===o-1&&(a=d.selEnd)}),this.selectIndices(this.getStartIndex(),t,this.getEndIndex(),a),g.default.resetItemAnimationMode()}},{key:"applyPrefixToSelection",value:function(e,t){var a,i;if(this.isValid()&&(a=this.getStartItem().getPrefixLength(),i=this.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var n=!0;g.default.focusedPane.applyToSelection(function(t){if(t.prefix!==e)return n=!1,!1}),n&&(e=null),g.default.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}if(!isNaN(a)){var r=this.getStartItem().getPrefixLength()-a,s=this.getEndItem().getPrefixLength()-i;r||s?this.selectIndices(this.getStartIndex(),this.getStartOffset()+r,this.getEndIndex(),this.getEndOffset()+s):this.updateCaret()}}},{key:"selectIndex",value:function(e,t,a,i){return void 0===a&&(a=t),this.selectIndices(e,t,e,a,i)}}]),e}());t.a=new A},41:function(e,t,a){"use strict";var i,n=a(35),r=a.n(n),s=a(5),o=a.n(s),l=a(6),u=a.n(l),d=a(13),c=a.n(d),h=a(0),f=a(1),p=a(3),g=a(7),m=a(49),v=a(28),y=a(14),k=a(15),_=a(67),S=a(65),P=(i=function(){function e(){o()(this,e),this.isLoaded=new k.a(!1),this.isGapiLoaded=new k.a(!1),this._handlersOnLoaded=[],this.authTokens={},this._scopesNeedRedo={},this.onAccountsUpdated=new m.a,this.hasTriedToLoadGapi=!1}return u()(e,[{key:"loadWithTokens",value:function(e){var t=this;this.ensureGapi(),Promise.all(Object.keys(e).map(function(e){return t.refreshAuthToken(e)})).then(function(){if(t.isLoaded.set(!0),t._runOnSyncHandlers(),!p.default.settings.syncAccounts.get()){var a={};Object.keys(e).forEach(function(t){var i,n=e[t];a[t]=(i={},r()(i,f.a.PluginID.Gmail,n.scopes.includes(f.a.GScope.GmailModify)),r()(i,f.a.PluginID.GCalendar,n.scopes.includes(f.a.GScope.Calendar)||n.scopes.includes(f.a.GScope.CalendarRO)),i)}),p.default.settings.syncAccounts.set(a)}})}},{key:"authAccount",value:function(e,t,a){var i=this,n=function(n){n&&!n.error?a(n):i.doAuthForAccount({email:e,scopes:t},a)};this.authTokens[e]?this.getAccountAuthToken(e,t,n,!0):n()}},{key:"authAccountTemp",value:function(e,t){this.doAuthForAccount({email:v.a.getDefaultAccountID(),scopes:e,temp:!0},t)}},{key:"removeAccount",value:function(e){delete this.authTokens[e],this.onAccountsUpdated.notify(),S.a.deleteAuthToken(e)}},{key:"convertScopeToScopes",value:function(e){var t=e.scope?e.scope.split(" "):void 0;return e.scopes=t?t.map(function(e){return f.a.GScopeArray[e]}):void 0,delete e.scope,e}},{key:"refreshAuthToken",value:function(e){var t=this;return new Promise(function(a){try{h.default.PAssert(532,e,"Trying to get account auth token for undefined")}catch(i){h.default.reportError(i)}e?_.a.getAccessToken(e).then(function(i){if(i.value){var n=t.convertScopeToScopes(i.value);t.authTokens[e]=n,a(n)}else console.log(i.error),i.error&&i.error.includes("invalid_grant")&&t.redoAuth(e,v.a.getScopes())}):a(void 0)})}},{key:"redoAuth",value:function(e,t,a){var i=this;this._scopesNeedRedo[e]||(this._scopesNeedRedo[e]=[]),this._scopesNeedRedo[e].pushOnlyUniques(t),p.default.toasts.pushMessage({text:"Error authorizing for account: "+e+". Please reauthorize.",actionText:"REAUTHORIZE",action:function(){i.doAuthForAccount({email:e,scopes:i._scopesNeedRedo[e]},a)}})}},{key:"getAccountAuthToken",value:function(e,t,a,i){var n=this;try{h.default.PAssert(533,e,"Trying to get account auth token for undefined")}catch(r){h.default.reportError(r)}e?this.onLoaded(function(){var r=n.authTokens[e];r?n._verifyScopes(t,r)?!r.expires_at||r.expires_at-Date.now()<f.a.MinimumTokenExpireTimeMS?n.refreshAuthToken(e).then(a):a(r):i?a(void 0):n.redoAuth(e,t,a):(a(void 0),n.redoAuth(e,t))}):a(void 0)}},{key:"isAuthorizedForScopes",value:function(e,t){var a=this.authTokens&&this.authTokens[e];return!!a&&this._verifyScopes(t,a)}},{key:"notifyUnauthorizedRequest",value:function(e){}},{key:"_verifyScopes",value:function(e,t){var a=0;if(!t||!t.scopes)return!1;for(var i=t.scopes,n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i.includes(e[n]))return!1}return!0}},{key:"_getRedirectURL",value:function(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"}},{key:"_createAuthURL",value:function(e){var t=e.email,a=e.scopes,i=e.temp;try{h.default.PAssert(534,h.default.isArray(a)&&a.length>0,"Must pass in a valid scopes array")}catch(r){h.default.reportError(r)}var n={email:t,temp:i,scope:a.join(" "),redirect_uri:this._getRedirectURL()};return _.a.createURL("auth/authGoogleAPI",n)}},{key:"doAuthForAccount",value:function(e,t){var a=this,i=e.email,n=e.scopes,r=e.temp;try{h.default.PAssert(535,i||r,"Must provide a valid email to link if not temp")}catch(l){h.default.reportError(l)}try{h.default.PAssert(536,h.default.isArray(n),"Must always provide a valid scopes array")}catch(l){h.default.reportError(l)}n=h.default.arrayUnion([f.a.GScope.UserInfoEmail],n);var s,o=!1;this._createAuthURL({email:i,scopes:n,temp:r}).then(function(e){var n,r=window.open(e,"googleauth","height=600,width=550"),l=!1,u=function e(n){if(clearInterval(s),h.default.getLocationOrigin()&&!l&&h.default.isObject(n.data)){if(window.removeEventListener("message",e),o=!0,n.data){var r=a.convertScopeToScopes(n.data);a.authTokens[i]=r,a.onAccountsUpdated.notify(),t&&t(r)}t&&!o&&t(void 0),l=!0}};g.a.isNativeApp()&&((n=new BroadcastChannel("Moo.do_auth_gapi_channel")).onmessage=function(e){u(e)}),s=setInterval(function(){n&&r&&!r.closed?(console.log("posting auth"),n.postMessage("checkAuth")):r&&!r.closed||(clearInterval(s),window.removeEventListener("message",u),!o&&t&&t(void 0))},1e3),window.addEventListener("message",u)})}},{key:"ensureGapi",value:function(e){var t=this;if(window.gapi&&window.gapi.client)e&&e();else if(!this.isGapiLoaded.get()&&!this.hasTriedToLoadGapi){setTimeout(function(){t.hasTriedToLoadGapi=!1},2e3);var a=function(e){};document.getElementById("gapiScript")||h.default.addScript("https://apis.google.com/js/api.js","gapiScript",this.ensureGapi.bind(this,e),a),window.gapi&&!window.gapi.client&&(this.hasTriedToLoadGapi=!0,window.gapi.load("client",{callback:function(a){window.gapi.client.init({apiKey:f.a.APIKey,clientId:f.a.ClientID}).then(function(){t.isGapiLoaded.set(!0),p.default.pluginManager.notifyDependencyLoad(f.a.PluginDependency.GoogleLogin)}),e&&e()},onerror:a,timeout:2e4,ontimeout:function(e){}}))}}},{key:"onLoaded",value:function(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach(function(e){return e()}),this._handlersOnLoaded=[]}},{key:"getAccountName",value:function(e){}},{key:"getDefaultAuthToken",value:function(e,t){var a=v.a.getDefaultAccountID();this.getAccountAuthToken(a,e,function(e){e?t(e):console.log("No auth token")})}},{key:"hasError",value:function(){return!1}},{key:"getError",value:function(e){return""}},{key:"getGoogleUserInfo",value:function(e){this.getDefaultAuthToken(["profile"],function(t){t?fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(t.access_token)).then(function(t){200===t.status&&t.json().then(function(t){return e(t)})}):e(void 0)})}},{key:"isEmailAuthed",value:function(e){var t=e.toLowerCase();return Object.keys(this.authTokens).some(function(e){return e.toLowerCase()===t})}}]),e}(),c()(i.prototype,"refreshAuthToken",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthToken"),i.prototype),i);t.a=new P},42:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(25),h=a.n(c),f=a(11),p=a.n(f),g=a(0),m=function(e){function t(e,a,i){var r;return n()(this,t),(r=l()(this,d()(t).call(this,e,a,i)))._value=e||[],r.version=0,r}return p()(t,e),s()(t,[{key:"notify",value:function(e,a,i){0===arguments.length&&this.version++,h()(d()(t.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(e,t){try{g.default.PAssert(138,e&&g.default.isArray(e),"Value set on an Observable array must be an array",e)}catch(a){g.default.reportError(a)}return this._value=e,this.version++,!1!==t&&this.notify(this._value),e}},{key:"clear",value:function(e){this.set([],e)}},{key:"remove",value:function(e,t){var a;if(g.default.isFunction(e))for(var i=0,n=0;n<this._value.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e(this._value[n])&&(void 0===a&&(a=n),this._value.splice(n,1),n--)}else a=this._value.remove(e);return this.version++,a>=0&&!1!==t&&this.notify(this._value),a}},{key:"removeAt",value:function(e,t){var a=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"push",value:function(e,t){var a=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"pushArray",value:function(e,t){var a=this._value.pushArray(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"insertSorted",value:function(e,t,a){var i=this._value.insertSorted(e,t);return this.version++,!1!==a&&this.notify(this._value),i}},{key:"sort",value:function(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}},{key:"splice",value:function(e,t,a,i){var n;return n=a?this._value.splice(e,t,a):this._value.splice(e,t),this.version++,!1!==i&&this.notify(this._value),n}},{key:"indexOf",value:function(e){return this._value.indexOf(e)}},{key:"indexOfWithProperty",value:function(e,t){return this._value.indexOfWithProperty(e,t)}},{key:"includes",value:function(e){return this._value.includes(e)}}]),t}(a(15).a);t.a=m},44:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=a(1),u=a(3),d=[" ","-","/","[","]","(",")","*","_","@",".",":"],c=function(){function e(){n()(this,e)}return s()(e,[{key:"getPreviousWord",value:function(e,t,a){for(var i=0,n=a-1;n>=0;n--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(o.default.shouldLog(l.a.LogLevels.Edit)&&console.log(n,r),d.indexOf(r)>=0&&!this.isInsideMarkup(e,n))return n}return-1}},{key:"getNextWord",value:function(e,t,a){for(var i=0,n=a+1;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(d.indexOf(r)>=0&&!this.isInsideMarkup(e,n,!0))return n}return t.length}},{key:"moveLeft",value:function(e,t,a){if(u.default.settings.showMarkdown.get())a--;else{var i,n=0;do{if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i=--a>0&&t.length>1&&this.isEmoji(t[a-1])&&this.isEmoji(t[a])}while(a>0&&(i||this.isInsideMarkup(e,a,!1)))}return a}},{key:"moveRight",value:function(e,t,a,i){var n=a;if(u.default.settings.showMarkdown.get())n++;else{var r,s=0;do{if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;n++,r=a+1<t.length&&t.length>1&&this.isEmoji(t[a])&&this.isEmoji(t[a+1])}while(n<=i&&(r||this.isInsideMarkup(e,n-1,!0)))}return a<i-3&&n>i&&(n=i),n}},{key:"isInsideMarkup",value:function(e,t,a,i){if(!u.default.settings.showMarkdown.get())for(var n=0,r=e.getEls(),s=0;s<r.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[s],l=o.getOrigTextLength();if(t<l)return(i?o.hasClass(i):o.isMarkdown()||o.isMDImage()||!!a&&o.hasClass("itemPrefix"))?o:void 0;t-=l}}},{key:"adjustLeftForMarkup",value:function(e,t){if(u.default.settings.showMarkdown.get())return t;for(var a=0;t>0&&this.isInsideMarkup(e,t-1,!1);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t--}return t}},{key:"isEmoji",value:function(e){return e&&!!e.match(/([\ud800-\udfff])+/g)}}]),e}();t.a=new c},45:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=a(1),u=a(3),d=a(8),c=a(23),h=a(7),f=a(15),p=a(73),g=a(27),m=function(){function e(){n()(this,e),this.stack=[]}return s()(e,[{key:"push",value:function(e){this.stack.push(e)}},{key:"pop",value:function(e){this.stack.remove(e)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(e){return this.stack.indexOf(e)>=0}},{key:"forEach",value:function(e){for(var t=0,a=this.stack.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[a],a))break}}}]),e}(),v=a(4),y=a(33),k=a(47),_={},S={Ctrl:0,Meta:1,Alt:2,Shift:3},P=function(){function e(){var t,a=this;n()(this,e),this.currentArrowsMode=void 0,this.platformPrimaryKey=h.a.mac?S.Meta:S.Ctrl,this.platformSecondaryKey=h.a.mac?S.Ctrl:S.Alt;var i=function(e,t){for(var i,n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s,l,d,c,h=t[r],f=!h.mods;if(f||(s=!!h.mods[S.Ctrl]===!!e.ctrlKey,l=!!h.mods[S.Meta]===!!e.metaKey,d=!!h.mods[S.Alt]===!!e.altKey,c=!!h.mods[S.Shift]===!!e.shiftKey),(f||s&&l&&d&&c)&&(h.isGlobal||e.target===document.body&&!u.default.menus.isContextMenuOpen()&&!u.default.menus.isModalOpen()||o.default.findParent(e.target,"paneContent"))){i=h;break}}if(i){a.currentArrowsMode&&!i.isOnPane&&(a._exitingArrowsMode=a.currentArrowsMode,a._exitArrowsMode());var p=i.callback.call(a,e);return i.stopPropagation&&e.stopPropagation(),a._exitingArrowsMode=void 0,!1===p||(e.handled=!0,e.preventDefault(),!1)}},r=function(e){if(u.default.setup&&u.default.settings.activeUser.get()){var n;if(h.a.normalizeKeys(e),t=e.normCode,a.currentArrowsMode&&a._updateArrowsMode(e),a.hotkeyStack.forEach(function(t){if(t&&t[e.normCode]&&(n=i(e,[t[e.normCode]])),void 0!==n)return!1}),void 0===n){var r=_[e.normCode];r&&(n=i(e,r))}if(void 0!==n)return o.default.vmMain&&o.default.vmMain.updateCursorFromEvent(e),n}};this.hotkeyStack=new m,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},c.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",r,!0),document.addEventListener("keyup",function(e){u.default.setup&&u.default.settings.activeUser.get()&&(h.a.normalizeKeys(e),o.default.vmMain&&o.default.vmMain.updateCursorFromEvent(e),h.a.windows&&t!==e.normCode&&(e.normCode!==l.a.KeyCode.D1&&e.normCode!==l.a.KeyCode.D2&&e.normCode!==l.a.KeyCode.D3&&e.normCode!==l.a.KeyCode.D8||_[e.normCode]&&(r(e),t=void 0)))},!0),this.loadConfig()}return s()(e,[{key:"loadConfig",value:function(){var e=this;this.config={Pane:{Search:["Pr+F"],Goto:["Se+G"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+LeftArrow"],ZoomIn:["Se+Enter","Se+RightArrow"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab","Pr+LBracket","Se+LBracket","Se+Sh+LeftArrow"],Indent:["Tab","Pr+RBracket","Se+RBracket","Se+Sh+RightArrow"],MoveUp:["Se+Sh+UpArrow","mac:Op+UpArrow","win:Pr+Sh+UpArrow"],MoveDown:["Se+Sh+DownArrow","mac:Op+DownArrow","win:Pr+Sh+DownArrow"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+RightArrow","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+LeftArrow","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],JumpAutocomplete:["Se+J"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+LBracket","win:Pr+Sh+LBracket","Se+Sh+LBracket","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"]},Email:{Down:["DownArrow","J"],Up:["UpArrow","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","Backspace","Sh+D3"],Schedule:["C"],Snooze:["D"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"]}},Object.keys(this.config.Pane).forEach(function(t){return e.createHotkeyNew(t,e.config.Pane[t],!1)}),Object.keys(this.config.Global).forEach(function(t){return e.createHotkeyNew(t,e.config.Global[t],!0)}),Object.keys(this.config.Email).forEach(function(t){return e.createHotkeyNew(t,e.config.Email[t],!1,!0,"Email")}),this.createHotkeyNew("Noop",["Pr+S"],!0)}},{key:"createHotkeyNew",value:function(e,t,a){var i=0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,s=n?this.callbackOnPane.bind(this,r,e):this["hotkey"+e];try{o.default.PAssert(406,s&&o.default.isFunction(s),"Missing hotkey handler",e)}catch(g){o.default.reportError(g)}for(var u=0;u<t.length;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=t[u],c=d.split(":"),h=c[c.length-1].split("+"),f=l.a.KeyCode[h[h.length-1]];try{o.default.PAssert(407,f,"Key code must be defined",d)}catch(g){o.default.reportError(g)}if(this.isValidPlatform(d)){var p={name:u>0?e+u:e,isGlobal:a,keyCode:f,primary:h.indexOf("Pr")>=0,secondary:h.indexOf("Se")>=0,shift:h.indexOf("Sh")>=0,option:h.indexOf("Op")>=0,isOnPane:n,callback:s};this.addHotkeyNew(p)}}}},{key:"isValidPlatform",value:function(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!h.a.mac)&&(t.indexOf("mac")<0||h.a.mac)&&(t.indexOf("app")<0||h.a.isNativeApp())}},{key:"pushStack",value:function(e){for(var t=0,a={},i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a[n.keyCode]=n}return this.hotkeyStack.push(a),a}},{key:"pushStackEscape",value:function(e){return this.pushStack([this.createEscape(e)])}},{key:"popStack",value:function(e){this.hotkeyStack.pop(e)}},{key:"getHotkey",value:function(e){var t,a=_[e.normCode];if(a)for(var i=0,n=0;n<a.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r,s,o,l,u=a[n],d=!u.mods;if(d||(r=!!u.mods[S.Ctrl]===!!e.ctrlKey,s=!!u.mods[S.Meta]===!!e.metaKey,o=!!u.mods[S.Alt]===!!e.altKey,l=!!u.mods[S.Shift]===!!e.shiftKey),d||r&&s&&o&&l){t=u.name;break}}return t}},{key:"create",value:function(e,t,a,i,n,r){try{o.default.PAssert(408,o.default.isNumber(e),"Invalid keyCode")}catch(u){o.default.reportError(u)}try{o.default.PAssert(409,o.default.isBoolean(t),"Invalid isGlobal")}catch(u){o.default.reportError(u)}try{o.default.PAssert(410,o.default.isFunction(n),"Invalid callback")}catch(u){o.default.reportError(u)}var s={keyCode:e,mods:{},callback:n,isGlobal:t};return a!==l.a.Primary.Yes&&a!==l.a.Primary.Both&&a!==l.a.Primary.Only||(s.mods[this.platformPrimaryKey]=!0),a!==l.a.Primary.No&&a!==l.a.Primary.Never&&a!==l.a.Primary.Both||(s.mods[this.platformSecondaryKey]=!0),r&&h.a.mac&&(s.mods[S.Alt]=!0),i===l.a.Shift.Yes&&(s.mods[S.Shift]=!0),s}},{key:"addHotkeyNew",value:function(e){e.mods={},e.primary&&(e.mods[this.platformPrimaryKey]=!0),e.secondary&&(e.mods[this.platformSecondaryKey]=!0),e.option&&(e.mods[S.Alt]=!0),e.shift&&(e.mods[S.Shift]=!0);var t=e.keyCode;_[t]||(_[t]=[]),_[t].push(e)}},{key:"createEscape",value:function(e){return this.create(l.a.KeyCode.Escape,!0,l.a.Primary.Either,l.a.Shift.Either,e)}},{key:"addHotkey",value:function(e,t,a,i,n,r,s,u){try{o.default.PAssert(411,a,"Must supply a valid keycode")}catch(d){o.default.reportError(d)}h.a.app&&!isNaN(i)&&i!==l.a.Primary.Both&&i!==l.a.Primary.Never&&i!==l.a.Primary.Only&&(i=l.a.Primary.Either),this._addHotkey(e,t,a,i,n,r,s,u)}},{key:"_addHotkey",value:function(e,t,a,i,n,r,s,u){try{o.default.PAssert(412,a,"Must supply a valid keycode")}catch(c){o.default.reportError(c)}if(!u||!h.a.windows){if(_[a]=_[a]||[],i===l.a.Primary.Either)return this._addHotkey(e,t,a,l.a.Primary.No,n,r,s,u),void this._addHotkey(e,t,a,l.a.Primary.Yes,n,r,s,u);if(n===l.a.Shift.Either)return this._addHotkey(e,t,a,i,l.a.Shift.No,r,s,u),void this._addHotkey(e,t,a,i,l.a.Shift.Yes,r,s,u);try{o.default.PAssert(413,!h.a.windows||i!==l.a.Primary.Both,"Should never require AltGr combo on windows")}catch(c){o.default.reportError(c)}var d=this.create(a,t,i,n,r,u);d.stopPropagation=s,d.name=e,_[a].push(d)}}},{key:"registerArrowsMode",value:function(e,t,a,i,n,r){var s=this["arrowsModeIndex"+e]=new f.a(-1);return!0===t?this._enterArrowsMode(e,a,i,n):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,a,i,n,r)),s}},{key:"getArrowsModeObs",value:function(e){return this["arrowsModeIndex"+e]}},{key:"isInArrowsMode",value:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}},{key:"exitArrowsMode",value:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(e,t,a,i,n){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,a,i,n)}},{key:"_enterArrowsMode",value:function(e,t,a,i,n){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:a,cbKey:i,cbOnHotkey:n},n&&n(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(e){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(e){var t=this.currentArrowsMode,a=this.getArrowsModeObs(t.name),i=h.a.getKeyCode(e),n=a.get(),r=t.cbGetMax();if(i===l.a.KeyCode.Enter)n>=0&&t.cbSelect(n),this._exitArrowsMode();else if(i===l.a.KeyCode.Escape)this._exitArrowsMode();else if(i===l.a.KeyCode.UpArrow)n>0&&a.set(n-1);else if(i===l.a.KeyCode.DownArrow)n<r-1&&a.set(n+1);else if(t.cbKey){var s=t.cbKey(i,e);s>=0&&(t.cbSelect(s),this._exitArrowsMode(),e.stopPropagation(),e.preventDefault())}}},{key:"checkToggleSearchFilter",value:function(e){var t=o.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}},{key:"checkToggleSearchPriority",value:function(e){var t=o.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}},{key:"hotkeyNewItem",value:function(){u.default.menus.openItemEditor({addOnSave:!0,element:o.default.element("newItemButton")})}},{key:"hotkeyAddPane",value:function(){u.default.menus.openAddPaneMenu({element:o.default.element("addPaneButton")})}},{key:"hotkeySearch",value:function(){var e=o.default.focusedPane||u.default.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}},{key:"hotkeyGoto",value:function(){o.default.focusedPane.applyToSelection(function(e){return u.default.PaneManager.scrollToAndHighlightItem(e,o.default.focusedPane),!1})}},{key:"hotkeyOverview",value:function(){o.default.focusedPane&&o.default.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var e,t=v.a.getSelectedItems();v.a.isValid()&&1===t.length&&!t[0].isComplete()&&(e=!0),o.default.beginCompleteAction(),o.default.focusedPane.applyFnToSelection("setComplete",{toggle:"isComplete",value2:l.a.ChangeType.Local}),e&&o.default.focusedPane.selectNearestItem(v.a.getStartIndex()),o.default.endCompleteAction(),o.default.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(e){o.default.focusedPane&&!this.checkToggleSearchPriority(e)&&o.default.focusedPane.applyPriorityToSelection(e,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(l.a.VMLIFlag.P0)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(l.a.VMLIFlag.P1)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(l.a.VMLIFlag.P2)}},{key:"hotkeyPriorityNone",value:function(){o.default.focusedPane.applyPriorityToSelection(l.a.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||o.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:l.a.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(e){if(e>=0&&e<u.default.PaneManager.paneCount()){var t=u.default.PaneManager.getPaneAtIndex(e);if(t&&(v.a.focusPane(t),!v.a.isValid()&&t.isEditable)){var a=t.indexOfFirstItem();t.selectIndex(a),t.scrollIndexIntoView(a,l.a.ScrollDuration.Default)}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var e=u.default.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}},{key:"hotkeyNextPane",value:function(){var e=u.default.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}},{key:"hotkeyZoomIn",value:function(){o.default.focusedPane&&o.default.focusedPane.applyToSelection(function(e){return e.isNote()||o.default.focusedPane.zoomIn(e),!1})}},{key:"hotkeyZoomOut",value:function(){var e=o.default.focusedItem;e&&e.parent()&&o.default.focusedPane.zoomOut(e.parent())}},{key:"hotkeyCollapse",value:function(){o.default.focusedPane.applyToSelection(function(e){o.default.focusedPane.supportCollapsing&&e.toggleCollapsed(o.default.focusedPane)})}},{key:"hotkeyCollapseAll",value:function(){o.default.focusedItem&&o.default.focusedPane&&o.default.focusedPane.supportCollapsing&&o.default.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){var e,t=o.default.focusedPane;o.default.focusedPane.applyToSelection(function(a,i,n,r){t.supportCollapsing&&(void 0===e&&(e=!t.isPaneObjectCollapsed(r)),t.collapseAll(a,e,!0))})}},{key:"hotkeyIndent",value:function(){p.a.compoundOperation(function(){v.a.isValid()&&p.a.handleTab()})}},{key:"hotkeyUnindent",value:function(){p.a.compoundOperation(function(){v.a.isValid()&&p.a.handleTab(!0)})}},{key:"hotkeyMoveUp",value:function(){p.a.moveUp()}},{key:"hotkeyMoveDown",value:function(){p.a.moveDown()}},{key:"hotkeySelectItem",value:function(){p.a.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(e){var t=u.default.PaneManager.removeFocusedPane();void 0!==t&&(d.d.performAction(d.b.UIAction,{type:d.c.RemovePane,data:t}),u.default.tooltip.hideTip(),e.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(e){return v.a.isValid()&&v.a.applyFormatToSelection("**"),e.preventDefault(),!1}},{key:"hotkeyItalic",value:function(e){return v.a.isValid()&&v.a.applyFormatToSelection("*"),e.preventDefault(),!1}},{key:"hotkeyUnderline",value:function(e){return v.a.isValid()&&v.a.applyFormatToSelection("__"),e.preventDefault(),!1}},{key:"hotkeyInsertLink",value:function(e){v.a.isValid()&&v.a.getStartItem().insertLinkAtSelection();return e.preventDefault(),!1}},{key:"hotkeyMoveAutocomplete",value:function(){o.default.focusedPane&&v.a.isValid()&&o.default.focusedPane.autocompleteMove()}},{key:"hotkeyJumpAutocomplete",value:function(){var e=o.default.focusedPane;if(e){var t=e.search,a={};t.isFocused.get()?a.elementDisplay=t.getSearchBox():e!==o.default.focusedPane&&(v.a.focusPane(e),a.elementDisplay=t.getSearchBox()),e.autocompleteJump(a)}}},{key:"hotkeyUndo",value:function(){g.default.hasRawSelection()&&o.default.elementInNonPaneEdit(g.default.getSelectionNode())||(o.default.focusedPane?o.default.focusedPane.handleUndo():k.a.undo())}},{key:"hotkeyRedo",value:function(){g.default.hasRawSelection()&&o.default.elementInNonPaneEdit(g.default.getSelectionNode())||(o.default.focusedPane?o.default.focusedPane.handleRedo():k.a.redo())}},{key:"hotkeyPrefixHeader",value:function(){v.a.applyPrefixToSelection(l.a.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(e){v.a.applyPrefixToSelection(l.a.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(e){v.a.applyPrefixToSelection(l.a.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(e){v.a.applyPrefixToSelection(l.a.Prefix.NumList)}},{key:"hotkeyEmailCompose",value:function(){var e=u.default.pluginManager.getPluginGmail();e.isEnabled()?u.default.menus.openComposeEmail(e):u.default.toasts.pushMessage(l.a.MessageID.NeedGmailPermission)}},{key:"hotkeyPreviousBoard",value:function(){y.a.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){y.a.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){y.a.selectBoard(0)}},{key:"hotkeySelectBoard2",value:function(){y.a.selectBoard(1)}},{key:"hotkeySelectBoard3",value:function(){y.a.selectBoard(2)}},{key:"hotkeySelectBoard4",value:function(){y.a.selectBoard(3)}},{key:"hotkeySelectBoard5",value:function(){y.a.selectBoard(4)}},{key:"hotkeySelectBoard6",value:function(){y.a.selectBoard(5)}},{key:"hotkeySelectBoard7",value:function(){y.a.selectBoard(6)}},{key:"hotkeySelectBoard8",value:function(){y.a.selectBoard(7)}},{key:"hotkeySelectBoard9",value:function(){y.a.selectBoard(8)}},{key:"hotkeySelectBoard10",value:function(){y.a.selectBoard(9)}},{key:"hotkeyAddToCalendar",value:function(){var e=u.default.pluginManager.getPluginGCalendar();e&&e.isActive()&&!e.isPluginBlocked()&&o.default.focusedPane.applyToSelection(function(t){return e.createEventForItem(t)})}},{key:"hotkeyEditNote",value:function(){o.default.focusedPane&&(u.default.PaneUpdateBatcher.beginUpdateItems(),o.default.focusedPane.clearPreventUpdate(),o.default.focusedPane.applyToSelection(function(e){e.isNote()||v.a.editNote(e)}),u.default.PaneUpdateBatcher.commitUpdateItems())}},{key:"hotkeyHelp",value:function(){u.default.intro.toggle(l.a.HelpMode.Normal)}},{key:"hotkeyHelpHotkeys",value:function(){u.default.intro.toggle(l.a.HelpMode.Hotkeys)}},{key:"hotkeySettings",value:function(){u.default.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){o.default.focusedPane.deleteSelected()}},{key:"hotkeyDate",value:function(){if(v.a.isValid()){var e=v.a.getStartIndex(),t=v.a.getStartItem(),a=v.a.getPane(),i=v.a.getStartOffset();if(e>=0){var n=a.elementAtIndex(e);n&&u.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:n,item:t,pane:a,textOffset:i>=0?i:t.getParsedText().length})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(e,t,a){var i=o.default.focusedPane;return i&&i.onHotkey&&i.onHotkey(e,t,a),!1}},{key:"printHotkeyByName",value:function(e,t){var a=this.config[t||"Pane"][e];try{o.default.PAssert(414,a,"Getting an invalid hotkey")}catch(s){o.default.reportError(s)}if(a)for(var i=0,n=0;n<a.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=a[n];if(this.isValidPlatform(r))return this.printHotkey(r)}}},{key:"printHotkey",value:function(e){for(var t=0,a=e.split(":"),i=a[a.length-1].split("+"),n="",r=0;r<i.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r];r>0&&(n+=h.a.windows?" + ":" "),n+="Pr"===s?h.a.priModKey:"Se"===s?h.a.secModKeyForce:"Sh"===s?h.a.mac?"\u21e7":"Shift":"Op"===s?"\u2325":2===s.length&&"D"===s[0]?s[1]:"Slash"===s?"/":"Tilde"===s?"~":"LeftArrow"===s?"\u2190":"RightArrow"===s?"\u2192":"UpArrow"===s?"\u2191":"DownArrow"===s?"\u2193":"Period"===s?".":"Comma"===s?",":"Equals"===s?"=":"Plus"===s?"+":"Dash"===s?"-":"Backspace"===s?h.a.mac?"Delete":s:s.endsWith("Bracket")?s.startsWith("L")?"[":"]":s}return n}},{key:"__dbgCheckHotkeyOverlap",value:function(e,t){for(var a=0,i=t.mods,n=_[e],r=0;r<n.length;++r){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=n[r].mods,u=!0,d=0;d<4;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i[d]!==l[d]){u=!1;break}}if(u){if(l[this.platformPrimaryKey]&&i[this.platformPrimaryKey])try{o.default.PAssert(415,!1,"Overlapping hotkey: ",t)}catch(c){o.default.reportError(c)}if(l[this.platformSecondaryKey]&&i[this.platformSecondaryKey])try{o.default.PAssert(416,!1,"Overlapping hotkey: ",t)}catch(c){o.default.reportError(c)}}}}}]),e}();t.a=new P},47:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(10),u=a.n(l),d=a(9),c=a.n(d),h=a(25),f=a.n(h),p=a(11),g=a.n(p),m=a(0),v=a(1),y=a(13),k=a.n(y),_=a(23),S=a(3),P=a(119),w=a(24),I=a(17),b=a(14),D=(i=function(){function e(){r()(this,e),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this.__numInBatch=0,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,_.a.binder(this,"_onSelectionChanged"),w.a.listen("selectionChanged",this._onSelectionChanged)}return o()(e,[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}},{key:"pushModified",value:function(e,t,a){if(!this.isUndoing){var i=!1;if("text"in t){var n=this._getLastAction(),r=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&r&&n&&n.itemId===e.id&&(n.changes.text=t.text,i=!0)}i||this._doPush(e,{itemId:e.id,type:"Modified",changes:t,prevState:a}),this.clearDeleteSelection()}}},{key:"pushAdded",value:function(e,t){try{m.default.PAssert(372,void 0!==t.index,"Item should have index when adding")}catch(a){m.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Added",changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}},{key:"pushRemoved",value:function(e,t){try{m.default.PAssert(373,void 0!==t.index,"Item should have index when removing")}catch(a){m.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Removed",prevSel:this._deleteSelection,changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}},{key:"clearDeleteSelection",value:function(){this.__numInBatch<=0&&(this._deleteSelection=void 0)}},{key:"_doAction",value:function(e){if(!this.isUndoing)try{var t=e?this.redoStack:this.undoStack,a=e?this.undoStack:this.redoStack,i=t.pop();if(i){var n=i.actions;try{m.default.PAssert(374,n.length>0,"Undo state should have some actions")}catch(r){m.default.reportError(r)}n.length>0&&(this.isUndoing=!0,S.default.PaneUpdateBatcher.beginUpdateItems(),m.default.focusedPane.clearPreventUpdate(),n.forEach(function(t){var a=t.type,i=a===v.a.CrudActions.Added||a===v.a.CrudActions.Removed?t.changes:e?t.changes:t.prevState;Object.keys(i).forEach(function(e){void 0===i[e]&&(i[e]=null)}),e||(a===v.a.CrudActions.Added?(a=v.a.CrudActions.Removed,i.isDeleted=!0):a===v.a.CrudActions.Removed&&(a=v.a.CrudActions.Added,i.isDeleted=!1));var n=I.a.getItem(t.itemId);if(n){var r=n.getDocumentOwner(),s=I.a.getItemDataLocal(r,t.itemId);P.a.onRemoteChange(r,s,t.itemId,i),I.a.saveItem(n,i,v.a.ChangeType.Local,v.a.SaveFlag.All)}}),S.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,i),a.push(i))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(e,t){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"beginAction",value:function(){this.__numInBatch++,m.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"endAction",value:function(e){this.__numInBatch--;try{m.default.PAssert(375,this.__numInBatch>=0,"Undo batch somehow went negative")}catch(t){m.default.reportError(t)}(this.__numInBatch<=0||e)&&(this.__numInBatch=0,this._batch.length>0&&(this.undoStack.push({prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._deleteSelection=void 0)}},{key:"onActionTimeout",value:function(){this.__numInBatch>0&&this.endAction(!0)}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}]),e}(),k()(i.prototype,"onActionTimeout",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"onActionTimeout"),i.prototype),i),E=a(4),C=function(e){function t(){return r()(this,t),u()(this,c()(t).apply(this,arguments))}return g()(t,e),o()(t,[{key:"_doPush",value:function(e,t){this.redoStack=[];var a=t.prevSel||E.a.getSavedSelection()||E.a.save();if(t.itemId=e.id,E.a.isValid()&&(t.selection=E.a.save(!0)),this.__numInBatch>0){this._batchPrevSel=a;var i=this._batch.indexOfWithProperty("itemId",e.id);if(i>=0){var n=this._batch[i];n.type===v.a.CrudActions.Modified&&"Removed"===t.type?t.changes.text=n.prevState.text:(Object.assign(t.changes,n.changes,t.changes),Object.assign(t.prevState,n.prevState,t.prevState)),this._batch[i]=t}else this._batch.push(t)}else this.undoStack.push({prevSel:a,actions:[t]})}},{key:"restoreSelFromState",value:function(e,t){var a=e?t.selection:t.prevSel;a&&E.a.restore(a,!0)}},{key:"saveDeleteSelection",value:function(){this._deleteSelection=E.a.save()}},{key:"pushRemoved",value:function(e,a){if(!this.isUndoing)try{m.default.PAssert(137,this._deleteSelection,"Must have saved delete selection before deleting")}catch(i){m.default.reportError(i)}f()(c()(t.prototype),"pushRemoved",this).call(this,e,a)}}]),t}(D);t.a=new C},470:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(7),v=a(2),y=a.n(v),k=a(21),_=a(27),S=a(20),P=a(165),w=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,I=[p.a.KeyCode.LeftArrow,p.a.KeyCode.RightArrow,p.a.KeyCode.UpArrow,p.a.KeyCode.DownArrow,p.a.KeyCode.Enter,p.a.KeyCode.Escape,p.a.KeyCode.PageUp,p.a.KeyCode.PageDown],b=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.createObservables({isFocused:this.props.focused||!1})}},{key:"onMount",value:function(){var e=this,t=this.props;if(t.value){var a=this.replaceHTMLLinks(t.value.replace(/\r?\n/g,"<br>"));this.setValue(a)}t.focused&&requestAnimationFrame(function(){e.refs.div&&e.refs.div.focus()})}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"focus",value:function(){f.default.isDemoRunning||this.refs.div.focus()}},{key:"blur",value:function(){this.refs.div.blur()}},{key:"setValue",value:function(e){this.refs.div.innerHTML=e}},{key:"getValue",value:function(){return this.refs.div.textContent.length>0?this.refs.div.innerHTML:""}},{key:"getTextValue",value:function(){return this.refs.div.textContent}},{key:"getElement",value:function(){return this.refs.div}},{key:"insertCharAtIndex",value:function(e,t){var a=this.refs.div,i=a.innerHTML;i=i.substr(0,t)+e+i.substr(t,i.length),a.innerHTML=i,_.default.selectElement(a,t+1),this.props.onChange&&this.props.onChange()}},{key:"onFocus",value:function(e){f.default.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){f.default.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)}},{key:"hasFocus",value:function(){return this.isFocused.get()}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape()}},{key:"onDrop",value:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)}},{key:"onDragEnter",value:function(){this.props.onDrop&&f.default.addClass(this.refs.div,"dragTarget")}},{key:"onDragLeave",value:function(){this.props.onDrop&&f.default.removeClass(this.refs.div,"dragTarget")}},{key:"onKeyDown",value:function(e){if(m.a.mac&&e.metaKey||!m.a.mac&&e.ctrlKey)e.keyCode===p.a.KeyCode.U?this.onClickToolbarButton("underline"):e.keyCode===p.a.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):e.keyCode===p.a.KeyCode.H?(this.makeHeading(),f.default.preventDefault(e)):e.keyCode===p.a.KeyCode.V&&(this.__pasteWithShift=e.shiftKey);else if(!I.includes(e.keyCode)){var t=_.default._getSelectionRange();if(t){var a=t.startContainer,i=a.parentElement;"A"===i.nodeName&&i.textContent===i.getAttribute("href")&&t.startOffset===t.endOffset&&t.startOffset===i.textContent.length&&(i.replaceWith(a),_.default.selectAfterNode(a))}}this.props.onKeyDown&&this.props.onKeyDown(e)}},{key:"insertNode",value:function(e){this.focus(),_.default.deleteRangeContents(),_.default.insertNode(e),_.default.selectAfterNode(e)}},{key:"insertLink",value:function(e){var t=_.default.getSelectedText(),a=e.target;this.savedSel=_.default.getSelectionRange(),g.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:a,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.focus(),_.default.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.insertNode(t)}},{key:"makeHeading",value:function(e){for(var t,a,i=0,n=window.getSelection(),r=n.rangeCount;r--;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n.getRangeAt(r),o=s.startContainer,l=s.startContainer.parentElement,u=_.default.getSelectOffsetsInElement(this.refs.div,s);if("H2"===l.nodeName)a=void 0,l.parentElement.replaceChild(o,l),_.default.selectElement(o,0,o.textContent.length);else if(u){if(!e&&u.start===u.end)return _.default.selectElement(o,0,o.textContent.length),this.makeHeading(!0);(a=document.createElement("h2")).appendChild(s.extractContents()),s.insertNode(a),t=a.textContent.length}}a&&t&&_.default.selectElement(a,0,t)}},{key:"onClickToolbarButton",value:function(e,t){f.default.isString(e)?"heading"===e?this.makeHeading():document.execCommand(e):e(t),f.default.preventAndStop(t)}},{key:"onClick",value:function(e){"A"===e.target.nodeName?f.default.openUrl(e.target.href):this.props.onClick&&this.props.onClick(e)}},{key:"onPaste",value:function(e){if(this.__pasteWithShift){var t=document.queryCommandSupported("insertText"),a=document.queryCommandSupported("paste");if(t||a){e.preventDefault();var i="";e.clipboardData||e.originalEvent.clipboardData?i=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(i=window.clipboardData.getData("Text")),i=i.trim();var n=t?"insertText":"paste";document.execCommand(n,!1,i)}}}},{key:"replaceHTMLLinks",value:function(e){return e.replace(w,function(e,t,a){return t+'<a href="'+a+'">'+a+"</a>"})}},{key:"onSetColor",value:function(e){document.execCommand("forecolor",!1,e)}},{key:"onChange",value:function(e){var t=e.target.innerHTML,a=this.replaceHTMLLinks(t);if(t!==a){var i=_.default._getSelectionRange(),n={start:0,end:0};i&&(n=_.default.getSelectOffsetsInElement(e.target,i)),e.target.innerHTML=a,_.default.selectElement(e.target,n.start,n.end)}this.props.onChange&&this.props.onChange(e)}},{key:"renderToolbarButton",value:function(e,t,a,i,n,r){var s=m.a.priModKey;return n&&(n="Escape"===n?n:s+" + "+n),y.a.createElement(S.a,{className:"button_"+i,icon:e,width:36,height:36,iconSize:t,onClick:this.onClickToolbarButton.bind(this,a),tooltip:i,tooltipHotkey:n,ref:r})}},{key:"render",value:function(){var e,t=this.props,a=f.default.classNames("fancyContenteditableWrapper flexbox flexvert",t.className),i=f.default.classNames("fancyContenteditable f1 c-background",{richText:t.richText}),n={height:this.props.height},r=!!t.spellCheck||null;return t.richText&&(e=y.a.createElement("div",{className:"fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),y.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),y.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),y.a.createElement(P.a,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),t.onClickClose&&this.renderToolbarButton("icon-close",18,t.onClickClose,"Close","Escape"),t.onMaximize&&this.renderToolbarButton(t.isMaximized?"icon-filter_none":"icon-check_box_outline_blank",14,function(){return t.onMaximize(!t.isMaximized)},t.isMaximized?"Restore":"Maximize"))),y.a.createElement("div",{className:a,style:n},e,y.a.createElement("div",{contentEditable:!1!==t.editable,className:i,style:this.props.style,ref:"div",spellCheck:r,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:t.onKeyUp,onKeyPress:t.onKeyPress,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste,tabIndex:t.tabIndex}))}}]),t}(k.a);t.a=b},471:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(2),v=a(21),y=a(63),k=a(157),_=a(72),S=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.DISABLE_LISTENER_ASSERT=!0}},{key:"getState",value:function(e){for(var t=0,a=e.pane,i=a.search,n={hasFilter:!1,showHelp:g.default.settings.shouldShowHelp("searchHelp"),viewState:a.viewState,viewMode:a.getViewMode(),sortModeBlocks:a.supportsSortBlocks()&&a.getSortModeBlocks(),sortModeItems:a.supportsSortItems()&&a.getSortModeItems(),calendars:y.a.GCalendarsAvailable,displayCalendars:a.displayCalendars,displayLocalItems:a.displayLocalItems,closedHelps:g.default.settings.closedHelps},r=0;r<i.filters.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i.filters[r];n[s.name]=s.value,n[s.name+"Enabled"]=s.enabled,0!==s.value.get()&&(n.hasFilter=!0)}return n}},{key:"onMount",value:function(){this.listenTo(this.props.pane.search.onChanged)}},{key:"componentWillReceiveProps",value:function(e){e.pane!==this.props.pane&&(this.refreshListeners(e),this.updateState(e))}},{key:"onClickSelectCalendars",value:function(e){g.default.menus.openContextMenu({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})}},{key:"saveScrollOfTop",value:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)}},{key:"onToggleButton",value:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)}},{key:"setPriority",value:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilterValue("priority")===e&&(e=0),t.setFilter("priority",e)}},{key:"onClickCloseHelp",value:function(){g.default.settings.closeHelp("searchHelp")}},{key:"onClickShowHelp",value:function(){g.default.settings.uncloseHelp("searchHelp")}},{key:"renderSearchButton",value:function(e){var t=this.props.pane,a="showOnlyMatches"===e.name&&t.isViewFlatList()?1:e.value.get();return m.createElement(k.a,{key:e.name,filter:e,filterValue:a,search:t.search,hasBorder:!0})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=f.default.classNames("searchPriorities c-border-light",{hasSelected:!!e}),a=f.default.classNames("searchPriority searchP0",{selected:e===p.a.VMLIFlag.P0}),i=f.default.classNames("searchPriority searchP1",{selected:e===p.a.VMLIFlag.P1}),n=f.default.classNames("searchPriority searchP2",{selected:e===p.a.VMLIFlag.P2});return m.createElement("span",{key:"priority",className:t},m.createElement("span",{className:a,"data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,p.a.VMLIFlag.P0)}),m.createElement("span",{className:i,"data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,p.a.VMLIFlag.P1)}),m.createElement("span",{className:n,"data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,p.a.VMLIFlag.P2)}))}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props.pane,i=a.search,n=t.showHelp,r=[],s=[],o=f.default.classNames("filterSection flexbox",{showHelp:n}),l=0;l<i.filters.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=i.filters[l];u.enabled.get()&&(u.isOption?g.default.settings.testBetaFeatures.get()&&u.hideInView||s.push(this.renderSearchButton(u)):u.icon?r.push(this.renderSearchButton(u)):"priority"===u.name&&r.push(this.renderSearchPriority()))}if(a.isViewDates()){var d=a.isCalFilterActive(),c=f.default.classNames("buttonCalendars searchButton icon-calendar c-border-light c-button",{selected:d});s.push(m.createElement("div",{key:"calendars",className:c,onClick:this.onClickSelectCalendars,"data-tooltip":"Select calendars to display in this pane"}))}return m.createElement("div",{className:o},r.length>0&&m.createElement("div",null,n&&m.createElement(_.a,null,"Filters"),m.createElement("div",{className:"searchFilters c-border-light"},r)),s.length>0&&m.createElement("div",null,n&&m.createElement(_.a,null,"Options"),m.createElement("div",{className:"searchFilters c-border-light"},s)))}}]),t}(v.a);t.a=S},472:function(e,t,a){"use strict";var i=a(133),n=a.n(i),r=a(5),s=a.n(r),o=a(6),l=a.n(o),u=a(10),d=a.n(u),c=a(9),h=a.n(c),f=a(11),p=a.n(f),g=a(1),m=a(3),v=a(0),y=a(2),k=a(21),_=a(72),S=a(36),P=a(57),w=a(17),I=a(7),b=g.a.TaskViewMode,D={Email:"PaneGmail",Files:"PaneDrive"},E={Default:function(e){return e[0]},Groups:function(e){return{Priority:"R",Created:"E",Completed:"X"}[e]||e[0]},Sorts:function(e){return{NumItems:"I",Completed:"X"}[e]||e[0]}},C=function(e){function t(){return s()(this,t),d()(this,h()(t).apply(this,arguments))}return p()(t,e),l()(t,[{key:"init",value:function(){var e=this.pane=this.props.pane||P.a.createPane(g.a.PaneMode.Task,{isFakePane:!0,document:w.a.getDefaultDocument()}),t=e.getViewMode(),a=e.getNewViewMode(),i=e.getNewViewGroup(),n="All",r="Week";e.isViewCalendar()?r=(t===b.Calendar_Day?"Day":t===b.Calendar_Custom&&"Custom")||t===b.Calendar_Week&&"Week"||t===b.Calendar_Month&&"Month"||"":e.isViewAgenda()&&(n=(t===b.Agenda_Today?"Today":t===b.Agenda_Week&&"Week")||t===b.Agenda_All&&"All"||""),this.createObservables({view:a,group:i,agendaOption:n,calOption:r,selectedColumn:0,paneType:void 0}),this.props.supportHotkeys&&document.addEventListener("keydown",this.onKeyPress)}},{key:"onUnmount",value:function(){this.props.supportHotkeys&&document.removeEventListener("keydown",this.onKeyPress)}},{key:"getState",value:function(){var e=this.pane;return{viewState:e.viewState,sortBlocks:e.getSortModeBlocks(),sortItems:e.getSortModeItems(),sortOrderBlocks:e.getSortOrderBlocks(),sortOrderItems:e.getSortOrderItems()}}},{key:"getCreationProps",value:function(){var e=this.paneType.get();return{pane:this.pane,item:void 0,type:e?D[e]:void 0}}},{key:"getViewIcon",value:function(e){switch(e){case"Outline":return"icon-format_list_bulleted";case"List":return"icon-reorder";case"Calendar":return"icon-view_comfy";case"Archived":return{name:"icon-task",size:12};case"Deleted":return"icon-delete"}}},{key:"getGroupIcon",value:function(e){switch(e){case"Project":return"icon-project";case"Agenda":return"icon-today";case"Tag":return"icon-hash";case"Contact":return"icon-user";case"Priority":return"icon-exclamation";case"Date":return{name:"icon-calendar",size:13};case"Created":return"icon-add";case"Modified":return"icon-edit";case"Completed":return"icon-check"}}},{key:"getAgendaIcon",value:function(e){switch(e){case"Today":return"icon-today";case"Week":return"icon-view-groups";case"All":return"icon-format_align_justify"}}},{key:"getCalendarIcon",value:function(e){switch(e){case"Day":return"icon-view_carousel";case"Custom":return"icon-view_week";case"Week":return"icon-cal-week";case"Month":return"icon-view_comfy"}}},{key:"getSortText",value:function(e){return"Priority"===e?e:g.a.TaskSortModeText[e]}},{key:"getCalendarText",value:function(e){return"Custom"===e?m.default.settings.calendarCustomDays.get()+" Days":e}},{key:"_setPaneView",value:function(){var e,t=this.pane,a=this.view.get(),i=this.group.get(),n="List"===a,r="Date"===i,s="None";"Outline"===a||"List"===a?(e="None"===i&&b.Outline||"Project"===i&&b.Groups_Project||"Tag"===i&&b.Groups_Tag||"Contact"===i&&b.Groups_Contact||"Priority"===i&&b.Groups_Priority)||("Agenda"===i||"Date"===i?e=this.agendaOptionToTVM():(e=b.Agenda_All,"Created"!==i&&"Completed"!==i&&"Modified"!==i||(s=i))):"Calendar"===a?e=this.calOptionToTVM():"Archived"===a?e=b.Archived:"Deleted"===a&&(e=b.Deleted),e&&t.getViewMode()!==e&&t.setViewMode(e),r!==t.search.showOnlyAgendaDates()&&t.search.setFilter("showOnlyAgendaDates",r),n===t.search.showHierarchy()&&(t.search.setShowHierarchy(!n),t.onViewStateChanged()),s&&s!==t.getSortModeBlocks()&&t.setSortModeBlocks(s,1)}},{key:"supportsGrouping",value:function(){var e=this.view.get();return"Outline"===e||"List"===e}},{key:"setViewMode",value:function(e){g.a.PaneModesNonTask.includes(e)?(this.paneType.set(e),this.props.onSelected&&this.props.onSelected()):(this.paneType.set(void 0),this.view.set(e),this._setPaneView())}},{key:"setGroupMode",value:function(e){this.group.set(e),this._setPaneView()}},{key:"setSortBlocks",value:function(e,t){this.pane.setSortModeBlocks(e,t)}},{key:"setSortItems",value:function(e,t){this.pane.setSortModeItems(e,t)}},{key:"agendaOptionToTVM",value:function(){var e=this.agendaOption.get();return"Today"===e&&b.Agenda_Today||"Week"===e&&b.Agenda_Week||b.Agenda_All}},{key:"setAgendaOption",value:function(e){this.agendaOption.set(e);var t="Today"===e&&b.Agenda_Today||"Week"===e&&b.Agenda_Week||b.Agenda_All;this.pane.setViewMode(t)}},{key:"calOptionToTVM",value:function(){var e=this.calOption.get();return"Day"===e&&b.Calendar_Day||"Custom"===e&&b.Calendar_Custom||"Week"===e&&b.Calendar_Week||"Month"===e&&b.Calendar_Month}},{key:"setCalOption",value:function(e){this.calOption.set(e);var t=this.calOptionToTVM();this.pane.setViewMode(t)}},{key:"onKeyPress",value:function(e){var t=this.props,a=e.keyCode,i=this.selectedColumn.get(),n=this.renderedColumnItems[i],r=n.items,s=n.current,o=n.hotkeysName,l=n.cb,u=r.indexOf(s);var d=function(e){"-"===r[u+=e]&&(u+=e),l(r[u])};a===g.a.KeyCode.DownArrow?u<r.length-1&&d(1):a===g.a.KeyCode.UpArrow?u>0&&d(-1):a===g.a.KeyCode.LeftArrow?i>0&&this.selectedColumn.set(i-1):a===g.a.KeyCode.RightArrow?i<this.renderedColumnItems.length-1&&this.selectedColumn.set(i+1):a===g.a.KeyCode.Enter?t.onSelected&&t.onSelected():(u=r.findIndex(function(e){return a===g.a.KeyCode[E[o](e)]}))>=0&&(l(r[u]),i<this.renderedColumnItems.length-1?this.selectedColumn.set(i+1):t.onSelected&&t.onSelected()),v.default.preventAndStop(e)}},{key:"onClickMenu",value:function(e,t,a){var i=1;(I.a.mac&&a.metaKey||!I.a.mac&&a.ctrlKey)&&(i=-1),e(t,i)}},{key:"renderColumn",value:function(e,t,a,i,n,r,s,o){var l=this,u=this.renderedColumnItems.length;this.renderedColumnItems.push({items:a,current:t,hotkeysName:n,cb:i});var d=this.state,c=d.selectedColumn,h=d.paneType;return y.createElement("div",null,y.createElement(_.a,{topHeader:!0,style:{minWidth:108}},e),a.map(function(e,a){var d=r?r(e):e,f=s?s(e):void 0;if("-"===d)return y.createElement("hr",{key:a});var p=h?e===h:e===t,g=l.props.supportHotkeys&&u===c&&E[n]&&E[n](e);return y.createElement(S.a,{key:e,active:p,canClose:!1,icon:f?f.name||f:void 0,iconSize:f&&f.size?f.size:void 0,onClick:l.onClickMenu.bind(l,i,e),hotkey:g,tooltip:o&&"<b>".concat(I.a.priModKey," + click</b> to sort in reverse")},d,p&&o&&y.createElement("i",{className:"sortOrder "+(o>0?"icon-arrow_downward":"icon-arrow_upward")}))}))}},{key:"render",value:function(){var e,t=this.props,a=t.className,i=t.isAddPane,r=this.pane,s=this.state,o=s.view,l=s.group,u=s.agendaOption,d=s.calOption,c=s.sortBlocks,h=s.sortItems,f=s.sortOrderBlocks,p=s.sortOrderItems,m=v.default.classNames(a,"flexbox"),k=i?(e=g.a.TaskViewModesNew).concat.apply(e,["-"].concat(n()(g.a.PaneModesNonTask))):g.a.TaskViewModesNew,_=r.supportsSortBlocks()&&!r.isViewAgenda()&&r.getSupportedSortBlocksModes();return this.renderedColumnItems=[],y.createElement("div",{className:m},this.renderColumn("View",o,k,this.setViewMode,"Default",void 0,this.getViewIcon),this.supportsGrouping()&&this.renderColumn("Group By",l,g.a.TaskViewGroups,this.setGroupMode,"Groups",void 0,this.getGroupIcon),_&&this.renderColumn("Sort ".concat(l,"s"),c,_,this.setSortBlocks,"Sorts",this.getSortText,void 0,f),r.supportsSortItems()&&!r.isViewAgenda()&&this.renderColumn("Sort Items",h,g.a.TaskViewSorts,this.setSortItems,"Sorts",this.getSortText,void 0,p),r.isViewAgenda()&&this.renderColumn("Agenda Mode",u,g.a.TaskAgendaOptions,this.setAgendaOption,"Default",void 0,this.getAgendaIcon),r.isViewCalendar()&&this.renderColumn("Calendar Mode",d,g.a.TaskCalendarOptions,this.setCalOption,"Default",this.getCalendarText,this.getCalendarIcon))}}]),t}(k.a);t.a=C},482:function(e,t,a){"use strict";a.r(t);var i,n,r,s=a(28),o=a(0),l=a(23),u=a(1),d=a(3),c=(a(195),a(17)),h=a(7),f=a(5),p=a.n(f),g=a(6),m=a.n(g),v=a(13),y=a.n(v),k=a(24),_=a(26),S=a(196),P=a(4),w=a(15),I=a(63),b=a(50),D=a(14),E=(i=function(){function e(){p()(this,e),this.isLoaded=!1,this.isRendered=new w.a(!1),this.isInit=!1,this.help=void 0,this._itemAnimationMode=u.a.ItemAnimationMode.Normal,this.isDisplaySettingsOpen=new w.a(!1),this.failedInitialDocLoad=new w.a(!1),this.cursor=new w.a,this.loadedImages={},o.default.vmMain=this,Rollbar.configure({payload:{environment:h.a.getDeployVar(u.a.DeployVariable.Environment),person:{id:d.default.settings.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:u.a.jsVersion,guess_uncaught_frames:!0}}},maxItems:u.a.__MAX_ERRORS_REPORTED,checkIgnore:o.default.rollbarIgnoreFn}),o.default.element("outerWrapper").addEventListener("mousemove",this.mousemove),o.default.isDemoMode()||(this.setupPageVisibility(),o.default.checkLowActivity()),d.default.PaneManager.onResize(),this.checkLastCodeVersion(),this.init()}return m()(e,[{key:"loadPlugins",value:function(){}},{key:"init",value:function(){try{o.default.PAssert(8,!this.isInit,"Should never double init VMMain, may cause severe issues")}catch(e){o.default.reportError(e)}this.isInit=!0,S.default.init(),I.a.init(),this.loadPlugins(),d.default.intro.init(),k.a.fireEvent("VMMainLoaded",[]),h.a.demo||(window.onbeforeunload=this.onUnload)}},{key:"loadData",value:function(){if(o.default.shouldLog(u.a.LogLevels.Timing))var e=performance.now();o.default.shouldLog(u.a.LogLevels.Profile)&&console.profile("Load Local Data"),o.default.checkpoint(u.a.Checkpoint.LocalDocLoad),o.default.shouldLog(u.a.LogLevels.Profile)&&console.profileEnd(),o.default.isLoaded=!0,d.default.setup.initDemo(),o.default.isDemoMode()&&setTimeout(function(){h.a.script&&d.default.setup.runScript(l.a.getURLParam("script")),window.parent.postMessage("loaded","*")},0),this.afterLoaded(),o.default.shouldLog(u.a.LogLevels.Profile)&&console.profile("Apply Bindings"),this.isRendered.set(!0),o.default.isDemoMode()&&h.a.script&&o.default.setupClick(document.getElementById("container"),this,{onStart:function(){k.a.fireEvent("tapMain",[])},onClick:function(){try{o.default.PAssert(9,o.default.isDemoMode()&&h.a.script,"Tap handler should only be active on demo page")}catch(e){o.default.reportError(e)}window.parent.postMessage("click","*")}}),o.default.shouldLog(u.a.LogLevels.Profile)&&console.profileEnd(),h.a.app&&d.default.nativeBridge.sendToApp("localLoaded"),o.default.shouldLog(u.a.LogLevels.Timing)&&(o.default.log("DONE LOCALLY",performance.now()),setTimeout(function(){var t=performance.now();o.default.log("time react:",t-e,t)},0))}},{key:"afterLoaded",value:function(){h.a.app&&(document.onreadystatechange=function(){d.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange())}},{key:"updateCursorFromEvent",value:function(e){if(this.prevMove){var t=this.prevMove.target;if(t&&o.default.isAttachedToDoc(t)){var a=o.default.getPaneForElement(t);if(a){var i=o.default.elementFromPoint(this.prevMove.clientX,this.prevMove.clientY);if(i){var n=o.default.getItemForElement(i);this.updateCursor(e,a,i,n)}}}}}},{key:"getCursorForClass",value:function(e,t,a){for(var i=0,n=e.classList,r=0;r<n.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(n[r]){case"link":case"date":case"plugin":return h.a.mac&&t.metaKey||!h.a.mac&&t.ctrlKey?"cursor-pointer":null}}if(a)return"cursor-pointer"}},{key:"updateCursor",value:function(e,t,a,i){var n;if(t&&a){if(i&&o.default.isVMLI(i)){var r=o.default.findParentInItem(a,"plugin");r&&(a=r)}var s=!!o.default.findParent(a,"paneOverviewScroller");if(!P.a.isMouseDown()&&!(n=this.getCursorForClass(a,e,s))){var l=o.default.findParent(a,"itemInCalendarResizable");if(l){var d=l.getBoundingClientRect(),c=Math.min(u.a.CalendarResizeHandleHeight,d.height/3);(e.clientY-d.top<c||d.bottom-e.clientY<c)&&(n="cursor-row-resize")}}}this.cursor.set(n)}},{key:"redoLastMouseMove",value:function(){var e=this.prevMove,t={target:document.elementFromPoint(e.clientX,e.clientY),clientX:e.clientX,clientY:e.clientY};this.mousemove(t,!0)}},{key:"mousemove",value:function(e,t){if(o.default.notifyActivity(),!(o.default.disableMouseMove&&!e.target||d.default.PaneManager.isResizingPane||!t&&this.prevMove&&e.clientX===this.prevMove.clientX&&e.clientY===this.prevMove.clientY||d.default.DragDrop.isDragging)){var a,i,n,r=o.default.ensureDOMNode(e.target);if(r)(o.default.findParent(r,"paneRoot")||o.default.findParent(r,"paneOverviewScroller"))&&(n=o.default.getPaneForElement(r))&&(a=o.default.getItemForElement(r))&&(i=o.default.getListCellForElement(r)),this.updateCursor(e,n,r,a),P.a.setHovered(n,a,i),this.prevMove&&this.prevMove.target===r||(this.prevMove&&this.prevMove.target&&k.a.fireEvent("mouseout",[{target:this.prevMove.target}]),r&&k.a.fireEvent("mouseover",[{clientX:e.clientX,clientY:e.clientY,target:r}])),this.prevMove={clientX:e.clientX,clientY:e.clientY,target:r};else try{o.default.PAssert(10,!r,"Target should be defined",o.default.getElementPath(e.target))}catch(s){o.default.reportError(s)}}}},{key:"showHelp",value:function(e){d.default.intro.show(e)}},{key:"runAfterWelcome",value:function(){d.default.intro.runTooltipIntro()}},{key:"setupPageVisibility",value:function(){var e=this;h.a.pageVisibilityChange&&document.addEventListener(h.a.pageVisibilityChange,function(){h.a.isPageVisible()?(e.updateTimeout&&(clearTimeout(e.updateTimeout),e.updateTimeout=void 0),o.default.whenLowImpactEnd()):e.updateTimeout=setTimeout(function(){o.default.whenLowImpactBegin()},5e3)})}},{key:"checkLastCodeVersion",value:function(){if(o.default.shouldWriteLocal()){var e="versionDesktop",t=+_.a.getValue(e),a=h.a[e];if(isNaN(t)&&(t=+_.a.getLegacyLocalStorage(e),isNaN(t)||(_.a.deleteLegacyLocalStorage(e),_.a.setValue(e,a))),!o.default.isDemoMode()&&t>0&&a>t)for(var i=0,n=h.a.getUpdateMessages(t),r=0;r<n.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o.default.isString(n[r]))d.default.toasts.pushMessage({text:n[r],hold:!0});else{try{o.default.PAssert(11,o.default.isFunction(n[r]),"Must supply a valid getter fn for the message")}catch(l){o.default.reportError(l)}var s=n[r]();s.isPremiumOnly&&!d.default.billingManager.hasPremium()||d.default.toasts.pushMessage({text:s.text,hold:!0,action:s.action||u.a.MessageAction.Blog,actionText:s.actionText})}}t!==a&&_.a.setValue(e,a)}}},{key:"getScrollOffset",value:function(){return this.panesContainer.scrollLeft}},{key:"setScrollOffset",value:function(e,t){o.default.scrollTo(e,0,t||u.a.ScrollDuration.Default,this.panesContainer)}},{key:"onUnload",value:function(){o.default.log("Unloading the page");try{var e,t=o.default.getAggregateEvents();for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];o.default.sendEvent(i.category,i.action,i.count),i.count=0}if(k.a.fireEvent("onUnload",[]),o.default.hasPageDataBeenCleared()?d.default.pluginManager&&(e=d.default.pluginManager.onShutdown()):self&&d.default.pluginManager&&(e=d.default.pluginManager.onShutdown()),o.default.UIAction("PageUnload"),o.default.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(o.default.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(o.default.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(e)return e[0]}catch(n){o.default.reportError(n)}}},{key:"onImageLoaded",value:function(e,t,a){var i=e.id+o.default.hashCode(t);this.loadedImages[i]||(this.loadedImages[i]=!0,d.default.Measure.measureImage(a.target),b.a.beginBatch(e),d.default.Measure.clearCacheForItem(e.id),k.a.fireEvent("imageLoaded",[e]))}},{key:"checkDragForScroll",value:function(e){var t=document.getElementById("panes");if(t){var a=t.scrollLeft,i=t.clientWidth,n=i-80,r=0;e.clientX<80&&a>0?r=o.default.computeScrollSpeed(0,80,e.clientX,4,-1):e.clientX>=n&&a<t.scrollWidth-t.clientWidth&&(r=o.default.computeScrollSpeed(n,i,e.clientX,4)),0!==r?o.default.repeatScroll("panes",r,void 0,!0):o.default.cancelRepeatScroll("panes")}}}]),e}(),y()(i.prototype,"mousemove",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"mousemove"),i.prototype),y()(i.prototype,"onUnload",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"onUnload"),i.prototype),i),C=(a(202),a(198),a(53),a(2)),A=a.n(C),M=a(88),T=a.n(M),L=a(10),x=a.n(L),R=a(9),O=a.n(R),F=a(11),N=a.n(F),B=a(99),U=a(21),V=a(33),H=a(120),j=a(72),z=a(54),q=a(36),W=a(89),G=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(e){var t=e.item,a=e.pane,i={paneName:a.name,rootText:a.titleOfFirstItem,viewState:a.viewState,viewMode:a.getViewMode(),text:""};if(e.isCustomName)i.text=a.name.get();else if(e.viewMode){var n=a;n.name.get()?i.text=n.name.get():i.text=n.getViewModeText()}else e.paneName?i.text=a.title:(i.text=this.getTextForItem(t),i.jsx=this.getJSXForItem(t),t.els&&t.els.length&&(i.html=this.getHTMLForItem(t)));return i}},{key:"init",value:function(){this._onMount()}},{key:"_onMount",value:function(e){(e=e||this.props).viewMode||(this.listenTo(e.pane.document),this.listenTo(e.item.itemChanged),e.pane.getDocument()&&this.listenTo(e.pane.getDocument().text))}},{key:"componentWillReceiveProps",value:function(e){e.viewMode===this.props.viewMode&&this.props.item===e.item||(this.refreshListeners(),this._onMount(e),this.updateState(e))}},{key:"onMouseDown",value:function(e){this._holdTimeout=setTimeout(this.openContextMenu,150,{target:e.target})}},{key:"onMouseUp",value:function(){this.clearHoldTimeout()}},{key:"onClick",value:function(e){var t=this.props,a=t.item,i=t.isLast,n=t.isDocument,r=t.pane,s=t.onClick;s?s():o.default.isString(a)||(i&&!n?this.openContextMenu(e):r.onClickTitle(a)||this.openContextMenu(e))}},{key:"onRightClick",value:function(e){e.preventDefault(),this.openContextMenu(e)}},{key:"onDoubleClick",value:function(e){var t=this.props.pane;o.default.isString(this.props.item)||t.onDoubleClickTitle()}},{key:"onClickMenuItem",value:function(e){this.props.pane.onClickTitle(e)}},{key:"onClickDocument",value:function(e){this.props.pane.setDocument(e)}},{key:"clearHoldTimeout",value:function(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0}},{key:"getTextForItem",value:function(e){return e.generateTitleText(this.props.pane)}},{key:"getHTMLForItem",value:function(e){return e.getStyledTextAsOneLine(!1,!1)}},{key:"getJSXForItem",value:function(e){var t=this.getTextForItem(e),a=d.default.pluginManager.getPluginGmail();if(a.isLabelItem(e)){var i=a.getIconInfoForLabel(e).icon,n=o.default.classNames("labelText",{hasIcon:!!i});return A.a.createElement("span",{className:n},A.a.createElement("i",{className:i&&"c-foreground-light icon-"+i}),t)}return t}},{key:"openContextMenu",value:function(e){var t=this.props,a=t.pane,i=t.item;!i.parent()&&a.supportsDocuments?d.default.menus.openContextMenu({fn:this.renderContextMenuDocuments,element:e.target,doc:a.getDocument(),pane:a,documents:c.a.getDocumentsArray()}):d.default.menus.openContextMenu({fn:this.renderContextMenuHold,element:e.target,item:a.getItem(),pane:a,titles:i.parent()?i.parent().items.get():i.items.get()}),this.clearHoldTimeout()}},{key:"renderContextMenuDocuments",value:function(e){var t=this;return A.a.createElement(z.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},A.a.createElement(j.a,{topHeader:!0},"Select document"),e.documents.map(function(a){return A.a.createElement(q.a,{key:a.id,active:a===e.doc,onClick:t.onClickDocument.bind(t,a)},a.text.get())}))}},{key:"renderContextMenuHold",value:function(e){var t=this;return A.a.createElement(z.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},A.a.createElement(j.a,{topHeader:!0},this.props.pane.titleContextMenuHeader),e.titles.map(function(a){var i=t.getJSXForItem(a);return A.a.createElement(q.a,{key:a.id,active:a===e.item,onClick:t.onClickMenuItem.bind(t,a)},i)}))}},{key:"render",value:function(){var e,t=this.props,a=t.className,i=(t.isFirst,t.isLast),n=t.viewMode,r=t.paneName,s=(t.item,t.pane),l=this.state,u=l.text,d=l.jsx,c=l.html,h=l.siblingMode,f=o.default.classNames("titleWrapper",a,{"c-foreground":i},{"c-foreground-very-faded c-color-hover":!i&&!n&&!r},{last:i},{firstRow:n||r},{viewMode:n}),p=o.default.classNames("title");return e=n?"<b>Click</b> to change view mode or name this pane":"<b>Click</b> to zoom to item\n<b>Press and hold</b> to zoom to select a "+(h?"sibling":"parent")+" to zoom to",A.a.createElement(W.a,{className:f,"data-tooltip":e,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:n?s.openViewMenu:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!1},(d||!c)&&A.a.createElement("span",{className:p},d||u),!(d||!c)&&A.a.createElement("span",{className:p,dangerouslySetInnerHTML:{__html:c}}))}}]),t}(U.a),K=a(20),Y=a(59),X=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.refTitles=C.createRef()}},{key:"getState",value:function(){var e=this.props.pane;d.default.pluginManager.getPluginGmail();return{accounts:d.default.settings.syncAccounts,isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,isFocused:e.isFocused,paneName:e.name,titles:e.getTitleList(),viewState:e.viewState,viewMode:e.getViewMode(),viewModeText:e.type===u.a.PaneMode.Task&&e.getViewModeText(),sortModeBlocks:e.supportsSortBlocks()&&e.getSortModeBlocks(),sortModeItems:e.supportsSortItems()&&e.getSortModeItems(),filterAgenda:e.search.getFilterObs("showOnlyAgendaDates"),filterHierarchy:e.search.getFilterObs("showOnlyMatches"),calendarCustomDays:d.default.settings.calendarCustomDays,hasPremium:d.default.billingManager.hasPremiumFeaturesObservable}}},{key:"onMouseDown",value:function(e){e.button===u.a.ButtonCode.Left&&this.props.startDragging(e)}},{key:"onMouseDownMore",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"numComplete",value:function(){return this.props.pane.getItemsToArchive().length}},{key:"cloneBoard",value:function(e){V.a.cloneBoard(void 0,e)}},{key:"_clonePane",value:function(e){var t=d.default.PaneManager.getPaneIndex(e),a=e.getSaveInfoForClone();d.default.PaneManager.createPaneAtIndex(a.type,t+1,a)}},{key:"onClickClonePane",value:function(){this._clonePane(this.props.pane)}},{key:"onClickStar",value:function(){this.cloneBoard(this.props.pane)}},{key:"onClickArchiveCompleted",value:function(){var e=this.props.pane,t=this.numComplete();d.default.menus.confirm("Are you sure you want to archive "+t+" completed item"+(t>1?"s":"")+"?",function(t){t&&e.archiveCompleted()})}},{key:"onDoubleClickHeader",value:function(e){o.default.hasClass(e.target,"paneDraggable")&&this.props.pane.scrollToTop(u.a.ScrollDuration.Default)}},{key:"onClickViewMode",value:function(e){d.default.menus.openContextMenu({componentName:"ReactContextMenuPaneView",element:e.target,pane:this.props.pane})}},{key:"onClickEditName",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenuEditName,element:this.refTitles.current})}},{key:"onClickSavePaneName",value:function(e){this.props.pane.setName(e),d.default.menus.closeContextMenu(this.renderContextMenuEditName)}},{key:"renderContextMenuEditName",value:function(e){var t=this.props.pane,a=this.state,i=a.hasPremium,n=(a.paneName,"Name this pane"+(i?"":" (Naming panes is a Premium feature)"));return C.createElement(z.a,{key:"contextMenuPaneEditName",id:"contextMenuPaneEditName",width:300,border:!0,padding:"0",element:e.element},C.createElement(Y.a,{className:"c-border-light",value:t&&t.name.get(),placeholder:n,readonly:!i,fontSize:13,height:32,border:!1,padding:{left:16,right:16},underline:!1,backgroundTheme:"c-bg-menu",buttonText:"SAVE",onButtonClick:this.onClickSavePaneName,buttonEnabled:!0,focused:!0}))}},{key:"renderContextMenu",value:function(e){var t=this.props.pane,a=t.supportDataRefresh||t.supportReportError;return C.createElement(z.a,{key:"contextMenuPaneHeader",element:e.element},C.createElement(C.Fragment,null,C.createElement(q.a,{icon:"icon-close",onClick:t.onTapClosePane.bind(t)},"Close"),C.createElement("hr",null)),C.createElement(q.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),t.supportClone&&h.a.isFeatureEnabled(u.a.Feature.ClonePane)&&C.createElement(q.a,{icon:"icon-align-left",onClick:this.onClickClonePane},"Clone Pane"),t.supportPerformArchive&&C.createElement(q.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),a&&C.createElement("hr",null),t.supportDataRefresh&&C.createElement(q.a,{icon:"icon-spinner",onClick:t.onClickRefreshData},"Force refresh"),t.supportReportError&&C.createElement(q.a,{icon:"icon-warning",onClick:t.onClickReportError},"Report Error"),t.widthManual&&C.createElement("hr",null),t.widthManual&&C.createElement(q.a,{icon:"icon-arrows-h",onClick:t.setWidthManual.bind(t,void 0)},"Auto-size pane"))}},{key:"renderButton",value:function(e,t,a){return C.createElement(K.a,{className:"headerButton c-border-light c-popup-item",height:28,tooltip:a,onClick:t},e)}},{key:"render",value:function(){var e=this.state,t=e.titles,a=e.isOverviewVisible,i=e.isFocused,n=(e.viewMode,e.sortModeBlocks,e.sortModeItems,e.viewModeText),r=e.paneName,s=this.props.pane,l=this.getChildByKey("headerButtons"),d=u.a.PaneHeaderButtonWidth,c=u.a.PaneHeaderButtonHeight+6,h=o.default.classNames("paneHeader paneHeaderNew c-background c-border twoRows",{focused:i}),f=r||t.length>2,p=o.default.classNames("breadcrumbs",{hasBreadcrumbs:f});return C.createElement("div",{className:h,onDoubleClick:this.onDoubleClickHeader},C.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},C.createElement(K.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:d,height:c,onClick:s.onTapOverviewButton.bind(s),tooltip:(a?"Close":"Open")+" Overview"}),C.createElement("div",{className:"f1",style:{maxWidth:2}}),C.createElement("div",{className:"titlesNew",ref:this.refTitles},C.createElement("div",{className:p},C.createElement("div",{className:"breadcrumbsInner flexbox"},f&&t.map(function(e,a){if((r||a>0)&&(r||a<t.length-1)){var i=o.default.classNames("titleItem small c-foreground-very-faded"),n=o.default.classNames("separator c-foreground-super-faded");return C.createElement(C.Fragment,{key:a},a>0&&C.createElement("span",{className:n},">"),C.createElement(G,{className:i,pane:s,item:e,isBreadcrumb:!0}))}}))),C.createElement("div",{className:"titlesNew2 flexbox"},r?C.createElement(G,{key:"title_0",className:"titlePaneName",pane:s,item:t[0],isFirst:!0,isLast:!0,isCustomName:!0,onClick:this.onClickEditName}):C.createElement(C.Fragment,null,C.createElement(G,{key:"title_0",className:"titleDoc",pane:s,item:t[0],isFirst:!0,isLast:!0,isDocument:!0}),t.length>1&&C.createElement(C.Fragment,null,C.createElement("span",{className:"separator c-foreground-very-faded"},"-"),C.createElement(G,{className:"titleItem",pane:s,item:t[t.length-1],isLast:!0}))),C.createElement(K.a,{className:"editButton",icon:"icon-edit",height:18,width:18,iconSize:14,onClick:this.onClickEditName}))),C.createElement("div",{className:"f1 paneDraggable"}),C.createElement(K.a,{className:"paneCloseButton",icon:"icon-more_vert",iconSize:17,width:d,height:c,onMouseDown:this.onMouseDownMore,tooltip:"Pane Actions"})),C.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},n&&this.renderButton(n,this.onClickViewMode,"Pane Configuration"),C.createElement(H.a,{pane:s}),l&&C.Children.map(l.props.children,function(e){return e})))}}]),t}(U.a),Q=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){}},{key:"getState",value:function(){var e=this.props.pane;d.default.pluginManager.getPluginGmail();return{accounts:d.default.settings.syncAccounts,isOverviewVisible:e.overview.isVisible,item:e.item,showingArchived:e.showArchived,isSearchFocused:e.search.isFocused,isFocused:e.isFocused,titles:e.getTitleList()}}},{key:"onPaneScroll",value:function(e){var t=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=t),t!==this.paneScrollOffset&&t>0){var a=this.headerRow2Position.get()+this.paneScrollOffset-t;this.headerRow2Position.set(o.default.clamp(a,-u.a.PaneHeaderRow2Height,0))}this.paneScrollOffset=t}},{key:"onMouseDown",value:function(e){e.button===u.a.ButtonCode.Left&&this.props.startDragging(e)}},{key:"onMouseDownMore",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"numComplete",value:function(){return this.props.pane.getItemsToArchive().length}},{key:"cloneBoard",value:function(e){V.a.cloneBoard(void 0,e)}},{key:"_clonePane",value:function(e){var t=d.default.PaneManager.getPaneIndex(e),a=e.getSaveInfoForClone();d.default.PaneManager.createPaneAtIndex(a.type,t+1,a)}},{key:"onClickClonePane",value:function(){this._clonePane(this.props.pane)}},{key:"onClickStar",value:function(){this.cloneBoard(this.props.pane)}},{key:"onClickArchiveCompleted",value:function(){var e=this.props.pane,t=this.numComplete();d.default.menus.confirm("Are you sure you want to archive "+t+" completed item"+(t>1?"s":"")+"?",function(t){t&&e.archiveCompleted()})}},{key:"onDoubleClickHeader",value:function(e){o.default.hasClass(e.target,"paneDraggable")&&this.props.pane.scrollToTop(u.a.ScrollDuration.Default)}},{key:"renderContextMenu",value:function(e){var t=this.props.pane,a=t.supportDataRefresh||t.supportReportError;return C.createElement(z.a,{key:"contextMenuPaneHeader",element:e.element},C.createElement(C.Fragment,null,C.createElement(q.a,{icon:"icon-close",onClick:t.onTapClosePane.bind(t)},"Close"),C.createElement("hr",null)),C.createElement(q.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),t.supportClone&&h.a.isFeatureEnabled(u.a.Feature.ClonePane)&&C.createElement(q.a,{icon:"icon-align-left",onClick:this.onClickClonePane},"Clone Pane"),t.supportPerformArchive&&C.createElement(q.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),a&&C.createElement("hr",null),t.supportDataRefresh&&C.createElement(q.a,{icon:"icon-spinner",onClick:t.onClickRefreshData},"Force refresh"),t.supportReportError&&C.createElement(q.a,{icon:"icon-warning",onClick:t.onClickReportError},"Report Error"),t.widthManual&&C.createElement("hr",null),t.widthManual&&C.createElement(q.a,{icon:"icon-arrows-h",onClick:t.setWidthManual.bind(t,void 0)},"Auto-size pane"))}},{key:"render",value:function(){var e=this.state,t=e.titles,a=e.isOverviewVisible,i=e.isFocused,n=this.props.pane,r=this.getChildByKey("headerButtons"),s=u.a.PaneHeaderButtonWidth,l=u.a.PaneHeaderButtonHeight,d=o.default.classNames("paneHeader c-background c-border twoRows",{focused:i});return C.createElement("div",{className:d,onDoubleClick:this.onDoubleClickHeader},C.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},C.createElement(K.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:s,height:l,onClick:n.onTapOverviewButton.bind(n),tooltip:(a?"Close":"Open")+" Overview"}),C.createElement("div",{className:"f1",style:{maxWidth:4}}),C.createElement("span",{className:"titles titlesRow1"},n.supportViewMenu&&C.createElement(G,{pane:n,item:t[t.length-1],viewMode:!0,row1:!0}),!n.supportViewMenu&&C.createElement(G,{pane:n,item:t[0],paneName:!0,row1:!0})),C.createElement(H.a,{pane:n}),C.createElement("div",{className:"f1 paneDraggable"}),r&&C.Children.map(r.props.children,function(e){return e}),C.createElement(K.a,{className:"paneCloseButton",icon:"icon-more_vert",iconSize:17,width:s,height:l,onMouseDown:this.onMouseDownMore,tooltip:"Pane Options"})),C.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},C.createElement(G,{key:"title_0",pane:n,item:t[0],isFirst:!0,isLast:1===t.length}),C.createElement("div",{className:"paneHeaderRow2Inner f1 paneDraggable"},C.createElement("div",{className:"paneHeaderRow2Inner2 paneDraggable"},t.map(function(e,a){if(a>0)return C.createElement(G,{key:"title_"+a,pane:n,item:e,isLast:a===t.length-1})})))))}}]),t}(U.a),J=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.refInput=A.a.createRef()}},{key:"getState",value:function(){return{position:this.props.pane.caretPosition}}},{key:"getElement",value:function(){return this.refInput.current}},{key:"render",value:function(){this.state;var e=this.state.position,t={};return e&&(t.left=e.left,t.top=e.top),A.a.createElement("div",{style:t,contentEditable:!0,className:"paneHiddenInput",ref:this.refInput,suppressContentEditableWarning:!0},u.a.TextSpace)}}]),t}(U.a),Z=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)}},{key:"onMount",value:function(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())}},{key:"onUnmount",value:function(){this.props.owner.notifyUnmounted()}},{key:"getState",value:function(){var e=this.props,t=e.pane,a=e.owner,i=e.overview;return{cells:a.cellsObs,paddingBottom:a.paddingBottom,contentSize:a.contentSize,bottomListMessage:!i&&t.bottomListMessage(),isLoadingNewPage:t.isLoadingNewPage,isLoading:t.isLoading,statusMessage:t.getStatusMessage(this.props.overview),disablePointerEvents:a.disablePointerEvents,rect:this.props.pane.rect,items:a._itemsObs}}},{key:"isIndexMounted",value:function(e){return e>=0&&!!this._getElementAtIndex(e)}},{key:"getElement",value:function(){return this.refs.contentElement}},{key:"_getElementAtIndex",value:function(e){for(var t,a=0,i=this.props,n=this.state,r=0;r<n.cells.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n.cells[r].index===e){t=r;break}}var s=this.getChildByKey("topBox"),o=t+(i.hiddenInput?1:0)+(s?1:0);return this.refs.contentElement.children[o]}},{key:"getElementAtIndex",value:function(e){var t=this._getElementAtIndex(e);try{o.default.PAssert(779,t,"Must have a valid mounted item at index",e)}catch(a){o.default.reportError(a)}return t}},{key:"handleClick",value:function(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()}},{key:"renderItems",value:function(){for(var e=0,t=[],a=this.state.cells,i=0;i<a.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(this.props.renderCell(i,a[i]))}return t}},{key:"render",value:function(){var e,t=this.state,a=this.props,i=a.pane,n=o.default.classNames(a.contentClass,{noClickItems:t.disablePointerEvents}),r=t.statusMessage,s=t.contentSize+t.paddingBottom;if(!a.isLoading)if(t.bottomListMessage&&t.bottomListMessage.text&&!a.overview){var l=t.bottomListMessage,d={};d[h.a.transform.react]="translateY("+t.contentSize+"px)",e=A.a.createElement("div",{className:"paneBottomMessage c-border-light",style:d},l.clickable?A.a.createElement(K.a,{className:"paneDataPageLoad"},l.text):A.a.createElement("div",{className:"paneDataPageLoad c-foreground-very-faded"},l.text)),s+=40}else a.owner.hasItems()||(n+=" noItems"+(r?" displayStatus":""));var c={};a.orientation===u.a.Orientation.Horizontal?(c.width=(s||200)+"px",c.height="100%"):(c.height=(s||200)+"px",c.width="100%");var f=null;return a.hiddenInput&&(f=A.a.createElement(J,{ref:"hiddenInput",pane:i})),A.a.createElement("ul",{className:n,style:c,onClick:this.handleClick,spellCheck:!1,draggable:!1,ref:"contentElement","data-pane-status":r},f,this.getChildByKey("topBox"),this.renderItems(),e)}}]),t}(U.a),$=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({isOn:!d.default.settings.ui.cursorBlink.get()})}},{key:"onMount",value:function(){document.addEventListener("mousedown",this.startAnim),document.addEventListener("mouseup",this.startAnim)}},{key:"onUnmount",value:function(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.startAnim),clearTimeout(this.animTimeout)}},{key:"getState",value:function(){var e=this.props.pane;return{blink:d.default.settings.ui.cursorBlink,info:e.caretPosition,isWindowFocused:P.a.isWindowFocused,activePane:P.a.pane,contextMenus:d.default.menus.contextMenuStack,isPaneActive:P.a.isWindowFocused.get()&&P.a.getPane()===e&&0===d.default.menus.contextMenuStack.get().length}}},{key:"onAfterChanged",value:function(e,t){e.blink&&e.isPaneActive&&e.info&&(e.blink!==t.blink||e.isPaneActive!==t.isPaneActive||e.info!==t.info)?this.startAnim(e):!e.blink&&t.blink&&(clearTimeout(this.animTimeout),this.isOn.set(!0))}},{key:"startAnim",value:function(e){this.animTick(!0,e)}},{key:"animTick",value:function(e,t){(t=t||this.state).isPaneActive&&t.info&&(clearTimeout(this.animTimeout),this.isOn.set(e||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))}},{key:"render",value:function(){var e=this.state,t=this.state.info,a=t&&t.item,i=t&&t.pane,n=t&&t.paneObject,r={height:"18px"};return t&&e.isPaneActive&&P.a.isValid()&&P.a.getStartItem()?(t.isVisible&&(r.height=a&&i&&d.default.DisplaySettings.fontSizeForItem(n,a,i)+"px",r.opacity=e.isOn?1:0),r[h.a.transform.react]="translate3d("+t.left+"px, "+t.top+"px, 0)"):r[h.a.transform.react]="translate3d(-1000px, -1000px, 0)",A.a.createElement("div",{className:"caret c-bg-caret",style:r})}}]),t}(U.a),ee=a(34),te=a(101),ae=a(98),ie=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({draggedWidth:void 0})}},{key:"onMouseDownResize",value:function(e){var t=this.props,a=t.line,i=this.refs.image.getBoundingClientRect(),n=d.default.Measure.getImageOriginalSize(a.src,a.srcDataUrl);this.maxWidth=Math.min(n.width,t.pane.maxWidthOfPaneObject(t.paneObject)+(t.item.hasPrefix()?u.a.PrefixWidth:0)),this.draggedWidth.set(t.line.maxWidth||i.width,!1),this.leftPos=i.left,this.rightOffset=i.right-e.clientX,t.onStartResize(),o.default.preventAndStop(e),o.default.isDraggingImage=!0}},{key:"onMouseMoveResize",value:function(e){var t=e.clientX-this.leftPos+this.rightOffset;this.draggedWidth.set(o.default.clamp(t,40,this.maxWidth)),o.default.preventAndStop(e)}},{key:"onMouseUpResize",value:function(){var e=this.draggedWidth.get();this.props.onEndResize(e),o.default.isDraggingImage=!1}},{key:"onError",value:function(e){var t=this,a=e.target,i=this.props.item.getAttachmentByPlugin(u.a.PluginID.Drive);i&&navigator.onLine&&!this.attemptedFix&&d.default.remoteAPI().drivePermissionsPublic(i.id,function(){t.attemptedFix=!0,console.log("Fixed image"),a.src=a.src+"&retryPermissions"},function(e){o.default.reportError(new Error("Error adding permission"))})}},{key:"render",value:function(){var e=this.props,t=e.line,a=e.style,i=e.isHovered,n=e.item,r=e.hasSelection,s=t.srcDataUrl&&t.src!==t.srcDataUrl,l=t.isDriveImage||!d.default.settings.showMarkdown.get()||!r,u=o.default.classNames({mdImage:!t.isDriveImage},{driveImage:t.isDriveImage}),c=o.default.classNames(u,{none:s}),h=o.default.classNames("mdMarkup",{driveImageMarkup:t.isDriveImage}),f={maxWidth:!this.state.draggedWidth&&l&&t.maxWidth,width:this.state.draggedWidth},p=t.attach&&t.attach.isLocalOnlyAttachment();return A.a.createElement("span",{className:"line",style:a},t.previousText&&A.a.createElement("span",{dangerouslySetInnerHTML:{__html:t.previousText}}),A.a.createElement("span",{className:h},t.originalText),l&&A.a.createElement("div",{className:"mdImageWrapper rel ib",style:f},A.a.createElement("img",{key:o.default.hashCode(t.src),className:c,src:t.src,onLoad:o.default.vmMain.onImageLoaded.bind(o.default.vmMain,n,t.src),onError:this.onError,"data-original-text":t.originalText,ref:"image"}),s&&A.a.createElement("img",{key:o.default.hashCode(t.srcDataUrl),className:u,src:t.srcDataUrl,onLoad:o.default.vmMain.onImageLoaded.bind(o.default.vmMain,n,t.srcDataUrl),"data-original-text":t.originalText}),p&&A.a.createElement(ae.a,{style:{background:"rgba(0,0,0,0.5)"},color:"#eee",center:!0},"Uploading..."),i&&A.a.createElement(te.a,{className:"mdImageResizer flexbox flexvert",onMouseDown:this.onMouseDownResize,onMouseMove:this.onMouseMoveResize,onMouseUp:this.onMouseUpResize,globalEvents:!0})),t.nextText&&A.a.createElement("span",{dangerouslySetInnerHTML:{__html:t.nextText}}))}}]),t}(U.a),ne=function(e,t,a){var i=t.overview,n=t.pane;return a.isHeader&&(n.supportCollapsing||i)&&(i||!n.isSearchedFlat())&&!e.isNote()&&!(i&&0===a.levelsDeep)},re=function(e,t,a,i){return e=e||u.a.TextSpace},se=function(e,t){var a=e.item||e;return!t.isViewAgenda()&&a.isNote()&&a.parent().getPrefix()&&(!e.block||e.block.item!==a.parent())&&u.a.PrefixWidth+u.a.LineLeftPad},oe=function(){this.setState({draggingImage:!0})},le=function(e,t,a){var i=this;if(e.isDriveImage){var n=e.attach;n.getPlugin().setAttachWidth(t,n,a)}else{var r,s=t.getRawText();u.a.Regexp.MDLink.lastIndex=0,null!==(r=u.a.Regexp.MDLink.exec(s))&&(s="!["+r[2]+"]("+r[3]+" ="+a+"x)"),t.setText(s,u.a.ChangeType.Local)}setTimeout(function(){i.setState({draggingImage:!1})},u.a.ItemTransitionTime)},ue=function(e,t,a,i,n){var r=[],s=a.pane,l=a.cell.paneObject,c=s.maxWidthOfPaneObject(l)+(t.hasPrefix()?u.a.PrefixWidth:0);if(i.selected||t.isNote()){var f={top:0,width:c,height:i.height};f[h.a.transform.react]="translateX("+n+"px)",r.push(A.a.createElement("span",{key:"selStart",className:"textSelected",style:f}))}else if(void 0!==i.selectedStart){var p,g=i.lines.reduce(function(e,t){return e+o.default.unescape(t).length},0),m=i.selectedStart,v=i.selectedEnd;m<0&&(m=0),v<0&&(v=g,p=!0);var y=d.default.Measure.getCaretOffset(l,s,m,!0),k=d.default.Measure.getCaretOffset(l,s,v,P.a.preferLineStart),_=d.default.DisplaySettings.paddingForItemTop(l,t),S=d.default.DisplaySettings.paddingForItemBottom(l,t,s),w=d.default.DisplaySettings.lineHeightForItem(l,t,s),I=!t.isNote()&&k.line>y.line,b=t.shouldShowParents(l,s)?u.a.HeightAgendaParents:0,D=w+(0===y.line?_:0)+(y.line===i.lines.length-1?S:0),E=function(e,t,a,i,n){var r=n.refs.li,s=0;if(r){for(var o=0,l=r.getElementsByClassName("line"),u=0;u<e&&u<l.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s+=l[u].getBoundingClientRect().height}0===s&&(s+=i)}return s}(y.line,0,0,b,e);if(y.lineOffset<y.lineLength||!I){var C=I||p?c-y.left:k.left-y.left,M=y.left<0?y.left:0,T={top:E,width:Math.min(C+M,c),height:D,marginLeft:se(l,s)};E+=D,T[h.a.transform.react]="translateX("+(y.left-M+n)+"px)",r.push(A.a.createElement("span",{key:"selStart",className:"textSelected textSelectedStart",style:T}))}if(I){var L=k.line-y.line,x=w+(k.line===i.lines.length-1?S:0),R=p?c:k.left;if(L>1){var O=w*(L-1),F={top:E,width:c,height:O};E+=O,F[h.a.transform.react]="translateX("+n+"px)",r.push(A.a.createElement("span",{key:"selMid",className:"textSelected textSelectedMid",style:F}))}var N={top:E,width:R,height:x};N[h.a.transform.react]="translateX("+n+"px)",r.push(A.a.createElement("span",{key:"selEnd",className:"textSelected textSelectedEnd",style:N}))}}return r},de=function(e,t,a){return d.default.DisplaySettings.paddingForItemTop(t,e)+(e.shouldShowParents(t,a)?u.a.HeightAgendaParents:0)},ce=function(e){return e.overview||e.cell.paneObject.levelsDeep>0?d.default.DisplaySettings.itemIndentSize()-1:20},he={onMount:function(e,t,a,i,n){var r=i.pane,s=i.overview;e.listenTo(t.itemChanged),e.listenToDispatcher("numListChanged"),e.listenToDispatcher("EmailPreview","onClosed"),e.listenToDispatcher("EmailPreview","openThreadChanged"),r&&!s&&t.onLoad(r)},onUnmount:function(e){e.disposeDispatcherListeners()},getState:function(e,t,a,i){var n=i.pane,r=i.cell.paneObject,s=i.overview;if(n.isDestroyed())return{};var l=P.a.isSelected(a,n),c={flags:t.flags,levelsDeep:t.levelsDeep,styleProps:t.styleProps(r,n),isHovered:P.a.isReactCellHovered(e),showVerticalLines:!s&&n.supportVertLines&&d.default.settings.ui.showVerticalLines.get(),isSelected:!s&&n===o.default.focusedPane&&ee.a.isSelected(a,n),hasSelection:!!l,hasNote:t.hasNote(),isCollapsed:n.isPaneObjectCollapsed(r,s),isHighlighted:t.isHighlighted,numListNumber:t.isPrefixNumList()&&t.numListNumber(),draggedInPane:t.draggedInPane,isSearchFocused:n.search.isFocused,isBeingDragged:t.draggedInPane.get()===n,isMatchStuckHiding:n.search.isMatchStuckHiding(t)};if(s){if(c.paneItem=n.item,c.lines=[t.getStyledTextAsOneLine(!1,!1)],n.type===u.a.PaneMode.Gmail){var h=d.default.pluginManager.getPluginGmail(),f=t.getParsedText(),p=h.getIconInfoForLabel(t);p.icon&&(c.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+p.icon+'"></i>'+f+"</span>")}c.isOverviewAtTop=n.getOverview().isItemAtTop(t),c.isOverviewDragHover=n.getOverview().isItemDragHovered(t),c.isOverviewVisibleInPane=n.type===u.a.PaneMode.Task?n.getItem()!==n.getRootItem()&&n.isOverviewVisibleInPane(t):t===n.getItem(),c.isOverviewFocused=n.getItem()===t,c.isOverviewRoot=n.getRootItem()===t}else{var g=t.getAttachmentByPlugin(u.a.PluginID.Gmail);if(c.isEmailOpen=g&&(n.type===u.a.PaneMode.Gmail&&c.isSelected||g===d.default.EmailPreview.getThreadAttach()&&d.default.EmailPreview.isOpenOnPane(n)),t.isNote())c.lines=n.getStyledLinesForPaneObject(r,s,c.hasSelection);else{var m=n.getMetricsForPaneObject(r,s,c.hasSelection);c.lines=n.search.shouldHighlightSearch()&&m.searchHighlightedLines||m.styledLines}if(c.selected=c.selectedText=c.selectedStart=c.selectedEnd=void 0,l){var v=P.a.getSelectionAtIndex(a);!0===v?c.selected=!0:v.start!==v.end&&(c.selectedStart=v.start,c.selectedEnd=v.end)}else c.selectedText=void 0;t.isNote()&&(c.parentFlags=t.parent().flags,c.parentStyleProps=t.parent().styleProps(r,n))}return c.isHeader=n.isItemHeader(t,s),c},render:function(e,t,a,i,n,r,s,l){var c=n.pane,f=n.cell.paneObject,p=n.overview,g=c.getPaddingForPaneObject(f,p),m=o.default.classNames("item c-foreground",l,r.styleProps,{"c-border-light ":!p},{"c-background":!p&&!a.isNote()},{"overviewItem c-button-overview":p},{overviewAncestor:p&&r.isOverviewAncestor},{overviewFocused:p&&r.isOverviewFocused},{"c-background-overview-selected":p&&r.isOverviewVisibleInPane},{overviewRoot:p&&r.isOverviewRoot},{overviewAtTop:p&&r.isOverviewAtTop},{overviewDragHover:p&&r.isOverviewDragHover},{collapsed:r.isCollapsed},{itemBeingDragged:r.isBeingDragged},{faded:r.faded},{"c-background-item-selected":r.isEmailOpen},{highlighted:r.isHighlighted&&c!==o.default.focusedPane},{"c-bg-faded":!p&&r.isHovered},{firstItem:0===i},{hasSelection:r.hasSelection},{hasNote:r.hasNote},{hasPrefix:!!a.getPrefixLength()},{blockHeader:f.isBlockHeader},{"c-foreground-very-faded":f.isBlockHeader&&r.isCollapsed},{stuckMatch:r.isMatchStuckHiding},{checked:a.isComplete()});return p||(s=o.default.extend({fontSize:d.default.DisplaySettings.fontSizeForItem(f,a,c),lineHeight:d.default.DisplaySettings.lineHeightForItem(f,a,c)+"px",zIndex:r.draggingImage?1:void 0},s)),A.a.createElement("li",{"data-moo-id":t,className:m,style:s,ref:"li",suppressContentEditableWarning:!0},function(e,t,a,i,n){var r=i.lines,s=a.pane,l=a.overview,c=a.cell.paneObject,f=!l&&s.maxWidthOfPaneObject(c),p=se(c,s),g=[];try{o.default.PAssert(1167,r,"If an item is being rendered it must have styled lines")}catch(w){o.default.reportError(w)}if(r){var m=0;try{o.default.PAssert(1168,!isNaN(n),"Should always have a valid number for padding")}catch(w){o.default.reportError(w)}var v={};l||(v.width=f-(p?p-5:0)),h.a.isFirefox||a.padInsteadOfTransformLines?v.marginLeft=n:l?v.paddingLeft=n:v[h.a.transform.react]="translateX("+n+"px)",l||t.isNote()?r=[r[0]||u.a.TextSpace]:f<o.default.MinItemWidth&&(r=["..."]);for(var y=0;y<r.length;++y){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=r[y];if(k.isImage){var _=o.default.extend({paddingTop:!l&&(0===y?de(t,c,s):d.default.DisplaySettings.paddingForItemTop(c,t)),paddingBottom:!l&&d.default.DisplaySettings.paddingForItemBottom(c,t,s)},v);l?g.push(A.a.createElement("span",{className:"line",style:_,key:"line_"+y},k.originalText)):g.push(A.a.createElement(ie,{line:k,item:t,paneObject:c,pane:s,key:"line_"+y,style:_,isHovered:i.isHovered,hasSelection:i.hasSelection,onStartResize:oe.bind(e),onEndResize:le.bind(e,k,t)}))}else{var S=o.default.classNames("line",{"c-bg-light":i.isBeingDragged},{first:0===y},{blockHeaderText:y===r.length-1&&c.isBlockHeader},{last:y===r.length-1}),P=o.default.extend({paddingTop:!l&&0===y&&de(t,c,s),paddingBottom:!l&&y===r.length-1&&d.default.DisplaySettings.paddingForItemBottom(c,t,s),height:!l&&d.default.DisplaySettings.lineHeightForItem(c,t,s)+"px",paddingLeft:p},v);k=re(k),!a.overview&&s.isViewOutline()&&i.isHovered&&t.isPrefixHeader()&&!s.isSearchedFlat()&&y===r.length-1&&(k+='<span data-tooltip="Add new item to project" class="itemAddButton itemIgnoreText icon-add c-button" />'),s.isViewProject()&&c.isBlockHeader&&y===r.length-1&&(k+='<span class="blockHeaderNumItems itemIgnoreText ns c-foreground-faded" data-num-items="'+c.block.items.length+'" />'),g.push(A.a.createElement("span",{className:S,key:"line_"+y,style:P,dangerouslySetInnerHTML:{__html:k}}))}}}return g}(e,a,n,r,g),function(e,t,a,i,n){if(t.hasPrefix()){var r=t.els[0],s=a.cell.paneObject,o=n-5,l={paddingTop:de(t,s,a.pane)};return h.a.isFirefox||a.padInsteadOfTransformLines||a.overview?l.marginLeft=o:l[h.a.transform.react]="translateX("+o+"px)",A.a.createElement("div",{className:r.getClassString(),style:l,"data-listnum":t.isPrefixNumList()?i.numListNumber:void 0})}}(0,a,n,r,g),function(e,t,a,i,n){var r=a.pane;if(!a.overview&&t.shouldShowParents(a.cell.paneObject,r)){var s=t.parents(r.getItem()),o=a.cell.paneObject,l=s.map(function(e,t){return e.generateTitleText()}).join(" > "),u={paddingTop:d.default.DisplaySettings.paddingForItemTop(o,t),marginLeft:n};return l&&A.a.createElement("div",{className:"itemParents c-foreground-very-faded",style:u,"data-tooltip":l},l)}}(0,a,n,0,g),function(e,t,a,i,n){if(i.showVerticalLines&&n>d.default.DisplaySettings.itemIndentStart()){var r=a.pane.extraPaddingForPaneObject(a.cell.paneObject),s=d.default.DisplaySettings.itemIndentStart()+r+6,o=n-s;if(o>0){var l={left:s,width:o};return A.a.createElement("div",{className:"vertLines",style:l})}}}(0,0,n,r,g),function(e,t,a,i,n){var r=a.pane,s=a.cell.paneObject,l=ce(a);if(!a.overview&&r.supportMenuIcon&&i.isHovered&&!t.isNote()&&""!==t.getParsedText()&&(!r.isViewAgenda()||!r.shouldShowTime(a.cell.paneObject))){var u={width:n-5-(ne(t,a,i)?l:0),paddingRight:l-20,height:d.default.DisplaySettings.lineHeightForItem(s,t,r)+"px",marginTop:de(t,s,r)+"px"},c=o.default.classNames("itemMenuIcon",{"c-foreground-super-faded c-color-hover":!i.isEmailOpen},{"c-background-item-selected":i.isEmailOpen}),f="<b>Drag</b> to move.<br><b>Click</b> to open menu.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.";return A.a.createElement("div",{className:c,style:u,"data-tooltip":f},A.a.createElement("i",{className:"icon-drag-handle"}))}}(0,a,n,r,g),function(e,t,a,i,n){var r=a.overview,s=a.cell.paneObject,l=a.pane;if(i.isHovered&&""===t.getParsedText()&&!t.hasChildren()){var u=o.default.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),c={marginLeft:1===i.levelsDeep?-4:-12};return c[h.a.transform.react]="translateX("+(n-24)+"px)",A.a.createElement("div",{className:u,style:c})}if(ne(t,a,i)){var f=o.default.classNames("collapser c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":i.isCollapsed},{"icon-angle-down":!i.isCollapsed}),p={left:Math.max(n-5-ce(a),0),lineHeight:!r&&d.default.DisplaySettings.lineHeightForItem(s,t,l)+"px",paddingTop:!r&&de(t,s,l)+"px"},g=(h.a.secModKey,"<b>Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(i.isCollapsed?"expand":"collapse")+" item recursively.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.");return A.a.createElement("div",{className:f,style:p,"data-tooltip":g})}}(0,a,n,r,g),function(e,t,a){var i=a.pane,n=a.cell.paneObject,r=t.getMooDate();if(r&&!t.getRawText().includes(u.a.CharDate)&&!i.isViewDates()){var s=r.isRepeatDate(),l=r.toText(!0),d=o.default.classNames("itemTime c-date pointer"),c={paddingTop:de(t,n,i)+"px"};return A.a.createElement("div",{className:d,style:c},r.getGCalId()&&A.a.createElement("i",{className:"icon-calendar"}),s&&A.a.createElement("i",{className:"icon-spinner"}),l)}}(0,a,n),function(e,t,a,i){var n,r,s=a.overview,l=a.cell.paneObject,u=a.pane,d={paddingTop:de(t,l,u)};return s||t.isNote()?s&&i.isHovered&&u.supportClickOverviewScroll&&i.isOverviewVisibleInPane&&!i.isOverviewFocused&&(n=o.default.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),r="Scroll to item"):u.supportCheckbox&&i.isHovered?n=o.default.classNames("itemCheckbox c-button icon-check",{checked:t.isComplete()}):u.isViewArchived()?(n=o.default.classNames("itemCheckbox c-button itemUnarchive","icon-task"),r="Unarchive"):u.isViewDeleted()&&(n=o.default.classNames("itemCheckbox c-button itemUnarchive icon-task"),r="Undelete"),n&&A.a.createElement("div",{"data-tooltip":r,className:n,style:d})}(0,a,n,r),p&&r.isHovered&&A.a.createElement("div",{className:"overviewOptions icon-more_horiz c-button"}),!p&&c.isViewAgenda()&&function(e,t,a){var i=a.pane,n=a.cell.paneObject;if(i.shouldShowTime(n)){var r,s=i.getItemDisplayTime(n);o.default.isArray(s)&&(r=!0,s="<div>".concat(s[0],'</div><div class="c-foreground-very-faded">').concat(s[1],"</div>"));var l=o.default.classNames("agendaTime cursor-grab",{twoLines:r},{allDay:"All day"===s},{hasParents:t.shouldShowParents(a.cell.paneObject,i)}),u={paddingTop:de(t,n,i)+"px"};return A.a.createElement("div",{className:l,style:u,dangerouslySetInnerHTML:{__html:s}})}}(0,a,n),!p&&(r.selected||void 0!==r.selectedStart)&&ue(e,a,n,r,g))}},fe={onMount:function(e,t,a,i){e.listenTo(i.pane.dragHoveredBlock)},getState:function(e,t,a,i){return{isHovered:i.cell.paneObject.block===i.pane.dragHoveredBlock.get()}},onClickNewProject:function(e,t){var a=t.pane,i=a.getItem().numItems(),n=a.addItemToPane({text:u.a.Prefix.Header+" "},i),r=a.indexOfItem(n);P.a.selectIndex(r,0)},render:function(e,t,a,i,n,r,s,l){var u,c=a.block,h=c.isCollapsed(),f=o.default.classNames(l,"blockHeader noItem c-border-light flexbox",{blockHeaderDate:c.isDate},{"c-tag":n.pane.isViewTag()},{"c-contact":n.pane.isViewContact()},{agendaBlockRed:!h&&c.isOverdue},{dragHovered:r.isHovered},{"collapsed c-foreground-very-faded":h},{firstBlock:0===i}),p=o.default.classNames("blockCollapser c-foreground-super-faded",{"icon-angle-down":!h&&!c.isNewProject},{"icon-angle-right":h&&!c.isNewProject}),g={paddingBottom:d.default.DisplaySettings.paddingForBlockHeader()},m=A.a.createElement("span",{className:"blockHeaderNumItems c-foreground-faded"},c.numItems());if(c.isDate){var v,y=c.date,k=Date.today(),_=y.isToday()?"Today":y.isSameDay((new Date).clearTime().addDays(1))?"Tomorrow":y.toString("dddd"),S=o.default.classNames("blockHeaderText blockHeaderDayName f1 ib",{"c-foreground-light":!h});y.getMonth()===k.getMonth()&&y.getYear()===k.getYear()||(v=y.toString("MMMM"),S+=" diffMonth"),y.getYear()!==k.getYear()&&(v+=", "+y.toString("yyyy")),u=A.a.createElement(A.a.Fragment,null,A.a.createElement("span",{className:"blockHeaderDateNum"},y.getDate()),A.a.createElement("span",{className:S,style:g},_&&A.a.createElement("div",null,_,m),v&&A.a.createElement("div",{className:"blockHeaderMonth"},v)))}else if(c.isNewProject)u=A.a.createElement("span",{className:"blockHeaderText pointer f1 c-foreground-very-faded",style:g,onClick:this.onClickNewProject.bind(this,e,n)},"New project");else{var P=c.isStarred&&A.a.createElement("i",{className:"icon-star"})||c.isImportant&&A.a.createElement("i",null,"!");u=A.a.createElement("span",{className:"blockHeaderText f1",style:g},P,c.text,m)}return A.a.createElement("li",{ref:"li","data-moo-id":t,className:f,style:s},A.a.createElement("span",{className:p,onClick:c.toggleCollapsed}),u)}},pe={render:function(e,t,a,i,n,r,s){var l=o.default.classNames("hr c-border-heavy",n.className);return A.a.createElement("li",{"data-moo-id":t,className:l,style:s},a.text)}},ge={onClick:function(e,t){var a=t.block;a.addFn(a)},render:function(e,t,a,i,n,r,s,l){l=o.default.classNames(l,"taskAddButton");var u=a.block,d=o.default.classNames("c-foreground-ultra-faded");return A.a.createElement("li",{ref:"li","data-moo-id":t,className:l,style:s},!u.noAddButton&&A.a.createElement(te.a,{className:d,onClick:this.onClick.bind(this,e,a,i)},A.a.createElement("i",{className:"icon-add"}),"Add item"))}},me=a(60),ve=a(107),ye=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){k.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")}},{key:"arePropsEqual",value:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}},{key:"areStatesEqual",value:function(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[n].time!==a[n].time||t[n].item!==a[n].item)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){e.items!==this.props.items&&this.updateState(e)}},{key:"getState",value:function(e){var t={};if(e.items){for(var a=0,i=[],n=[],r=0;r<e.items.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e.items[r];if(!s.isNote()){var o=s.getNextDate(this.props.date),l=o.hasTimeOfDay()&&o.toString(d.default.International.getFormat(u.a.DFormat.ShortTime));l?n.push({time:l,item:s}):i.push({item:s})}}n.sort(e.pane.compareItemDate),t.items=i.concat(n)}return t}},{key:"onMouseDown",value:function(e){e.preventDefault()}},{key:"onMouseEnter",value:function(){if(d.default.DragDrop.isDragging){this.isHovered.set(!0);var e=d.default.DragDrop.dragItem.getDate();d.default.DragDrop.setBlockTarget({pane:this.props.pane,date:this.props.date,dateTime:e&&e.hasTimeOfDay()&&e,isDate:!0})}}},{key:"onDragEnd",value:function(){this.isHovered.set(!1)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"onDoubleClick",value:function(e){var t=this.props,a=t.pane,i=t.date,n=a.item.get(),r=new me.a(i,{duration:u.a.DefaultEventDuration});a.openItemEditor({element:e.target,text:" "+u.a.CharDate,parent:n,selectIndex:0,mooDate:r,pos:{top:e.clientY},showCalendarButtons:!0,addOnSave:!0})}},{key:"render",value:function(){var e,t=this.props,a=this.state,i=t.date,n=0===i.getDay()||6===i.getDay(),r=i.getDate(),s=Date.getDaysInMonth(i.getFullYear(),i.getMonth()),l=o.default.classNames("dateBlock c-border",{firstDay:1===i.getDate()},{lastDay:i.getDate()===s},{"weekend c-bg-faded":n},{"c-background":!n},{hoveredInDrag:a.isHovered},{today:i.isToday()}),d={left:t.left-1,width:t.width+1},c=o.default.classNames("dateBlockDay");if(a.items){for(var h=0,f=0,p=[],g=!1,m=0;m<a.items.length;m++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=a.items[m];v.time&&v.item.hasAttachmentType(u.a.PluginType.Calendar)&&(g=!0)}for(var y=0;y<a.items.length;y++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var k=a.items[y],_=k.time,S=k.item,P=g&&_,w=o.default.classNames("dateBlockItem flexbox",{hasCircle:P}),I=null;if(P){var b={background:S.hasAttachmentType(u.a.PluginType.Calendar)&&S.getCalendarColor()};I=A.a.createElement("div",{className:"monthItemColorCircle",style:b})}p.push(A.a.createElement("div",{className:w,key:S.id},I,A.a.createElement(ve.a,{className:"itemInCalendar",item:S,pane:t.pane,coloredInCalendar:!_&&S.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),_&&t.width>100&&A.a.createElement("span",{className:"itemTime"},_)))}e=(t.items||a.isHovered)&&A.a.createElement("div",{className:"dateBlockItems"},p)}return A.a.createElement("div",{className:l,style:d,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},A.a.createElement("div",{className:c},r),e)}}]),t}(U.a),ke={getState:function(e,t,a,i){return{paneRect:i.pane.rect}},render:function(e,t,a,i,n,r,s){var l,u=0,d=n.pane,c=o.default.classNames("calendarWeek c-bg-app","flexbox",n.className),h=d.getWidth()+1,f=Math.floor(h/7),p=h-7*f,g=0,m=0;p>0&&(g=Math.ceil(p/2),m=p-g),s.height+=1;for(var v=0;v<a.dates.length;v++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var y=a.dates[v];y&&1===(y=y.date).getDate()&&(l=y.toString("MMMM"),y.getYear()!==Date.today().getYear()&&(l+=y.toString(" yyyy")))}return A.a.createElement("li",{"data-moo-id":t,className:c,style:s},a.dates.map(function(e,t){var a=f+(0===t?g:0)+(6===t?m:0);return A.a.createElement(ye,{key:e.date.getTime(),pane:d,date:e.date,items:e.items,left:t*f+(t>0?g:0),width:a})}),l&&A.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},l))}},_e=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}},{key:"arePropsEqual",value:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}},{key:"areStatesEqual",value:function(e,t,a){if("items"===e){var i=0;if(!t||!a||t.length!==a.length)return!1;for(var n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!t[n].date||!a[n].date||!t[n].date.equals(a[n].date)||t[n].item!==a[n].item||t[n].duration!==a[n].duration)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){e.date.equals(this.props.date)&&e.items===this.props.items||this.updateState(e)}},{key:"getState",value:function(e){var t=e.date.isToday(),a={isToday:t,todayTime:t&&new Date,numAllDay:e.pane.numAllDay};if(a.heightHeader=e.pane.getHeightAllDay(),e.items){var i=0;a.items=[];for(var n=0;n<e.items.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=e.items[n];if(!r.isNote()){var s=r.getNextDate(this.props.date);if(s){var o=s.clone();a.items.push({date:o,duration:r.getDuration(),item:r})}}}}return a}},{key:"onMount",value:function(){this.state.isToday&&this.runTimeTimer()}},{key:"onUnmount",value:function(){clearTimeout(this.timeTimeout)}},{key:"componentDidUpdate",value:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}},{key:"onBeforeChanged",value:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),!t.hoveredTime||d.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e}},{key:"runTimeTimer",value:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}},{key:"resetHovered",value:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}},{key:"onMouseUp",value:function(e){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e):this.resetHovered()}},{key:"onMouseLeave",value:function(){this.resizing||this.resetHovered()}},{key:"getTimeFromMouseEvent",value:function(e){var t=e.clientY;return d.default.DragDrop.isDragging&&d.default.DragDrop.startPane&&d.default.DragDrop.startPane.isViewDates()&&d.default.DragDrop.startInfo&&(t+=12-(d.default.DragDrop.startInfo.y-d.default.DragDrop.position.top)),t-=o.default.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(u.a.CalendarDayViewBlockHeight+1)*4)/4}},{key:"onMouseDown",value:function(e){document.addEventListener("mouseup",this.onMouseUp),o.default.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()}},{key:"onMouseMove",value:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),d.default.DragDrop.isDragging){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var a=1,i=d.default.DragDrop.dragItem;i&&i.getDuration()&&(a=i.getDuration()/u.a.MSPerHour),this.hoveredDuration.set(a,!1),this.hoveredTime.set(t),(l=this.props.date.clone()).setHours(Math.floor(t)),l.setMinutes(60*(t-Math.floor(t))),d.default.DragDrop.setBlockTarget({pane:this.props.pane,date:l,dateTime:l,duration:1!==a?a*u.a.MSPerHour:null,isDate:!0})}}else if(this.resizing){t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var n=this.resizing,r=n.pivot,s=t>=r?r:t,o=Math.floor(4*(t>=r?t-r+.5:r-t))/4;if(!isNaN(s)&&o>=.25)if(n.item){var l,c={isDate:!0};(l=this.props.date.clone()).setHours(Math.floor(s)),l.setMinutes(Math.round(60*(s-Math.floor(s)))),c.duration=o*u.a.MSPerHour,c.date=c.dateTime=l,d.default.PaneUpdateBatcher.beginUpdateItems();var h=this.props.pane;h.applyDropOnBlock(c,n.item,h),d.default.PaneUpdateBatcher.commitUpdateItems()}else n.placeholder&&(o===this.hoveredDuration.get()&&s===this.hoveredTime.get()||(this.hoveredDuration.set(o,!1),this.hoveredTime.set(s,!0)))}}}},{key:"onMouseEnterAllDay",value:function(){if(d.default.DragDrop.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),d.default.DragDrop.setBlockTarget({pane:this.props.pane,date:e,isDate:!0,allDay:!0})}}},{key:"onDoubleClickTimes",value:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)}},{key:"addTime",value:function(e,t,a){var i=this.props,n=i.pane,r=i.date,s=n.item.get();e&&(r=r.addHours(e));var o=new me.a(r,{duration:t*u.a.MSPerHour});n.openItemEditor({element:a.target,text:" "+u.a.CharDate,parent:s,selectIndex:0,mooDate:o,pos:{left:a.clientX,top:a.clientY},addOnSave:!0,onClosed:this.resetHovered})}},{key:"onItemResizeStart",value:function(e,t,a){if(e.hasTime()){var i=e.getTimeOfDay(),n=e.getDuration()/u.a.MSPerHour||1,r=o.default.round(i/u.a.MSPerHour,4),s=a?r:r+n;return this.resizing={item:e,component:t,pivot:s},this.isResizing.set(!0),!0}}},{key:"addToDay",value:function(e,t,a,i){e.push({t:t,dur:a,item:i,top:t,bottom:t+a,obj:i})}},{key:"packItems",value:function(e){var t=0;e=e.sort(function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0});for(var a=[],i=[],n=null,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e[r];if(s.isPlaceholder)i=i.concat.apply(i,this.packEvents([[s]]));else{var o=0;null!==n&&s.top>=n&&(this.packEvents(a),i=i.concat.apply(i,a),a=[],n=null);for(var l=!1,u=0;u<a.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=a[u];if(!this.collidesWith(d[d.length-1],s)){d.push(s),l=!0;break}}l||a.push([s]),(null===n||s.bottom>n)&&(n=s.bottom)}}return a.length>0&&(this.packEvents(a),i=i.concat.apply(i,a)),i}},{key:"packEvents",value:function(e){for(var t=0,a=e.length,i=0;i<a;i++){var n=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var r=e[i],s=0;s<r.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[s],l=this.expandEvent(o,i,e);o.pos=i/a*100,o.width=100*l/a}}return e}},{key:"collidesWith",value:function(e,t){return e.bottom>t.top&&e.top<t.bottom}},{key:"expandEvent",value:function(e,t,a){for(var i=0,n=1,r=t+1;r<a.length;r++){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=a[r],l=0;l<o.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o[l];if(this.collidesWith(e,u))return n}n++}return n}},{key:"renderItems",value:function(){var e,t=0,a=this.props,i=this.state,n=i.items,r=[],s=i.hoveredTime,l=i.hoveredDuration;for(e=0;e<n.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var d=n[e].item,c=a.pane.getItemPlacementOnDate(d,a.date);c&&this.addToDay(r,c.time,c.duration,d)}isNaN(s)||isNaN(l)||r.push({t:s,dur:l,top:s,bottom:s+l,isPlaceholder:!0});var h,f=this.packItems(r);if(f.length){var p=0;for(h=[],e=0;e<f.length;e++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var g=f[e],m=g.isPlaceholder,v=this.props.pane,y={height:g.dur*u.a.CalendarDayViewBlockHeight+Math.ceil(g.dur)-1,left:m?0:g.pos+"%",width:m?"95%":g.width+"%",top:Math.floor(g.t*(u.a.CalendarDayViewBlockHeight+1))},k=o.default.classNames("dayTimeBlock abs",{placeholder:m});h.push(A.a.createElement("div",{className:k,key:m?"placeholder":g.item.id,style:y},g.item&&A.a.createElement(ve.a,{className:"itemInCalendar itemInCalendarResizable",item:g.item,pane:v,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return h}},{key:"renderItemsAllDay",value:function(){for(var e=0,t=this.props,a=this.state,i=a.items,n=t.pane,r=[],s=a.hoveredTime,o={},l=0;l<i.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=i[l].item;t.pane.getItemPlacementOnDate(u,t.date)||r.push(A.a.createElement("div",{className:"dayTimeBlock",key:u.id,style:o},A.a.createElement(ve.a,{className:"itemInCalendar",item:u,pane:n,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(s)&&s<0&&r.push(A.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),r}},{key:"render",value:function(){var e,t,a,i,n,r,s=this.props,l=this.state,d=(s.pane,s.date),c=0===d.getDay()||6===d.getDay(),f=this.renderItemsAllDay();if(l.isToday){var p=l.todayTime,g={top:Math.floor((p.getHours()+p.getMinutes()/60)*(u.a.CalendarDayViewBlockHeight+1))};r=A.a.createElement("div",{className:"calendarDayTimeLine",style:g})}e={width:s.width},t={top:l.heightHeader+30+3,height:s.height-l.heightHeader,width:s.width},a={height:l.heightHeader,minHeight:l.heightHeader},e[h.a.transform.react]=t[h.a.transform.react]=s.transform;var m=o.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":c}),v=o.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":c});i=A.a.createElement("ul",{className:m,style:a,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},f),n=A.a.createElement("div",{className:v,style:t,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},A.a.createElement("div",{className:"calendarDayGradient"}),A.a.createElement("div",{className:"calendarDayItems"},this.renderItems()),r);var y,k={className:o.default.classNames("calendarDay",{"weekend c-bg-faded":c},{today:l.isToday},{resizing:l.isResizing},s.className),"data-moo-id":s["data-moo-id"]};return d.getYear()!==Date.today().getYear()&&(y=d.toString(", yyyy")),A.a.createElement(s.component,k,A.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:e},A.a.createElement("div",{className:"dayTitle"},A.a.createElement("span",null,d.toString("ddd MMM ")),A.a.createElement("span",{className:"dayTitleDay"},d.getDate()),y&&A.a.createElement("span",null,y)),i),n)}}]),t}(U.a),Se={getState:function(e,t,a,i){return{numAllDay:i.pane.numAllDay}},render:function(e,t,a,i,n,r,s){var l=n.pane,u=o.default.classNames("calendarDay",n.className);return A.a.createElement(_e,{"data-moo-id":t,component:"li",className:u,date:a.date,items:a.items,pane:l,height:s.height,transform:s[h.a.transform.react],width:l.getDayWidth()})}},Pe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)}},{key:"areStatesEqual",value:function(e,t,a){var i=this.props.cell.isLive&&this._getRenderer();if(i&&i.areStatesEqual)return i.areStatesEqual(e,t,a)}},{key:"getState",value:function(e){var t,a=e.cell,i=a.paneObject,n=i;a.isLive&&(t=this._getRenderer(),n=this._getRenderObj());var r={isLive:a.isLive,item:n,id:i&&i.id,index:a.index,height:a.height,offset:a.offset,prevOffset:a.prevOffset,renderer:t,faded:!1};return a.isLive&&t&&t.getState&&(r=o.default.extend(r,t.getState(this,n,a.index,this.props))),r}},{key:"onMount",value:function(){this.listenTo(this.props.cell.cellChanged,!1),this._onMount()}},{key:"onBeforeChanged",value:function(e,t){var a=this;this.allowTransition=this.props.pane.supportCellTransition&&e.isLive&&this.props.cell.wasLive,this.props.pane.isViewDates()&&e.isHovered!==t.isHovered&&(e.isHovered?setTimeout(function(){a.state.isHovered&&a.isHoveredLong.set(!0)},u.a.TooltipDelay):(this.isHoveredLong.set(!1,!1),e.isHoveredLong=!1))}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.item,i=t.item,n=this.state.renderer;n!==t.renderer&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,i),a!==i&&(this.needsRefresh={prevState:t},this.props.list.isDelayingMounts||this.reMount()),n&&n.onUpdate&&n.onUpdate(this,a,this.props,this.state,e,t)}},{key:"_onMount",value:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onMount&&t.onMount(this,e,this.state.index,this.props,this.state)}},{key:"onUnmount",value:function(){var e=this.state.item,t=this.state.renderer;e&&t&&t.onUnmount&&t.onUnmount(this,e,this.state.index,this.props,this.state)}},{key:"reMount",value:function(){if(this.needsRefresh){var e=this.needsRefresh.prevState,t=e.item;this.refreshListeners(),t&&e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,t),this._onMount(),this.needsRefresh=void 0}}},{key:"_getRenderer",value:function(){var e,t=this.props.cell.paneObject;return o.default.isVMLI(t)?e=he:t.type===u.a.BlockType.Item?e=he:t.type===u.a.BlockType.Header?e=fe:t.type===u.a.BlockType.HR?e=pe:"calendarWeek"===t.type?e=ke:"calendarDay"===t.type?e=Se:t.type===u.a.BlockType.AddItem&&(e=ge),e}},{key:"_getRenderObj",value:function(){var e=this.props.cell.paneObject;return"blockItem"===e.type?e.item:e}},{key:"_getCellState",value:function(){var e=this.state,t={cell:this.props.cell.getState(),reactCell:{item:e.item.id,index:e.index,height:e.height,offset:e.offset,prevOffset:e.prevOffset,isLive:e.isLive}};return this.refs.li&&(t.element=o.default.getElementPath(this.refs.li)),t}},{key:"getIndex",value:function(){try{o.default.PAssert(784,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){o.default.reportError(e)}return this.state.index}},{key:"getItem",value:function(){try{o.default.PAssert(785,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(e){o.default.reportError(e)}return this.state.item}},{key:"getCell",value:function(){return this.props.cell}},{key:"getPaneObject",value:function(){return this.props.cell.paneObject}},{key:"render",value:function(){var e=this.props,t=this.state,a=t.isLive?t.offset:-1e3,i=this.getUniqueID(),n=t.renderer,r=o.default.getItemAnimationMode(),s={height:t.height},l=o.default.classNames("cell",{transition:this.allowTransition&&r!==u.a.ItemAnimationMode.None});return e.orientation===u.a.Orientation.Horizontal?s[h.a.transform.react]="translate("+a+"px,0)":s[h.a.transform.react]="translate(0,"+a+"px)",n&&t.isLive?n.render(this,i,t.item,t.index,e,t,s,l):A.a.createElement("li",{"data-moo-id":i,className:"itemdead",style:s})}}]),t}(U.a),we=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(e){return{text:e.toast.text}}},{key:"componentWillReceiveProps",value:function(e){this.updateState(e)}},{key:"render",value:function(){var e=this.props.toast,t=this.state.text,a=o.default.classNames("toast noSelect",{hasAction:!!e.actionText},{big:e.isBig});return A.a.createElement("div",{className:a,onClick:e.onTapIgnore},A.a.createElement(K.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:e.onTapIgnore&&e.onTapIgnore}),A.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:t}}),A.a.createElement(K.a,{primary:!0,className:"messageAction",onClick:e.doAction.bind(e)},e.actionText))}}]),t}(U.a),Ie=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{showFormattingToolbar:d.default.settings.showFormattingToolbar,position:P.a.itemHighlightPosition,pane:P.a.getPane(),numSelected:P.a.getSelectedItems().length,isCollapsed:0===d.default.settings.showFormattingToolbar.get()}}},{key:"onClickFormat",value:function(e){P.a.applyFormatToSelection(e)}},{key:"onClickPrefix",value:function(e){P.a.applyPrefixToSelection(e)}},{key:"onClickNote",value:function(){var e=P.a.getStartItem();e&&P.a.editNote(e)}},{key:"onClickLink",value:function(){P.a.getStartItem().insertLinkAtSelection()}},{key:"onClickToggleShow",value:function(){var e=d.default.settings.showFormattingToolbar.get();e=0===e?1:0,d.default.settings.showFormattingToolbar.set(e)}},{key:"render",value:function(){var e=this.state,t=this.props,a=e.position,i=e.position&&e.pane===t.pane,n=e.isCollapsed;if(i){var r=n?24:32,s=n?24:36,o=n?24:329,l=Math.min(Math.max(Math.floor(a.x),o/2+4),e.pane.getWidth()-o/2-4),d={height:s,width:o,marginLeft:-o/2,marginTop:-s-4};return d[h.a.transform.react]="translate3d("+l+"px,"+Math.floor(a.y)+"px,0)",n?A.a.createElement("div",{className:"formattingToolbar collapsed c-popup c-bg-sidebar c-shadow-popup",style:d},A.a.createElement(K.a,{icon:"icon-more_horiz",width:o,height:o,iconSize:14,tooltip:"Show formatting toolbar",onClick:this.onClickToggleShow})):A.a.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:d},A.a.createElement(K.a,{icon:"icon-format_bold",width:r,height:s,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),A.a.createElement(K.a,{icon:"icon-format_italic",width:r,height:s,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),A.a.createElement(K.a,{icon:"icon-format_underlined",width:r,height:s,iconSize:18,onClick:this.onClickFormat.bind(this,"__"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),A.a.createElement("div",{className:"divider"}),A.a.createElement(K.a,{icon:"icon-project",width:r,height:s,iconSize:18,onClick:this.onClickPrefix.bind(this,u.a.Prefix.Header),tooltip:"Project",tooltipHotkey:u.a.Prefix.Header+"&nbsp;&nbsp; Space"}),A.a.createElement(K.a,{icon:"prefixTask",width:r,height:s,iconSize:20,onClick:this.onClickPrefix.bind(this,u.a.Prefix.Task),tooltip:"Task",tooltipHotkey:u.a.Prefix.Task+"&nbsp;&nbsp; Space"}),A.a.createElement(K.a,{icon:"icon-bullet",width:r,height:s,iconSize:22,onClick:this.onClickPrefix.bind(this,u.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:u.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),A.a.createElement(K.a,{icon:"icon-numlist",width:r,height:s,iconSize:14,onClick:this.onClickPrefix.bind(this,u.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:u.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),A.a.createElement("div",{className:"divider"}),A.a.createElement(K.a,{icon:"icon-link",enabled:1===e.numSelected,width:r,height:s,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),A.a.createElement(K.a,{icon:"icon-sticky-note-o",enabled:1===e.numSelected,width:r,height:s,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),A.a.createElement("div",{className:"divider"}),A.a.createElement(K.a,{icon:"icon-minus",width:r,height:s,iconSize:10,tooltip:"Hide formatting toolbar",onClick:this.onClickToggleShow}))}return null}}]),t}(U.a),be=a(76),De=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({dragOffset:0,isDragging:!1})}},{key:"onMount",value:function(){var e=this.props.pane,t=e.scrollElement=this.refs.scroller.getScrollElement(),a=e.rootElement=this.refs.rootElement,i=e.paneContent=this.refs.contentElement.getElement(),n=e.getInfiniteList(!1);e.element=this.refs.pane,n.setupScroller(t,i),n.setScrollHandler(this.onScroll),a.addEventListener("compositionstart",e.compositionStart),a.addEventListener("compositionend",e.compositionEnd),e.onInput&&a.addEventListener("input",e.onInput),o.default.setupClick(t,e,{onStart:e.onTapStart,onMove:e.onTapMove,onClick:e.onTapClick,onEnd:e.onTapEnd,onDoubleClick:e.onTapDoubleClick,onRightClick:e.onTapRightClick}),e.onLoad(),e.getOverview().onPaneLoad(),k.a.fireEvent("paneAdded",[e])}},{key:"getState",value:function(){var e=this.props.pane;return e.isDestroyed()?{}:{rect:e.rect,left:e.getLeft(),isExpanded:e.isExpanded,isActive:e.isActive,isOverviewVisible:e.overview.isVisible,isHelpVisible:!!d.default.intro&&d.default.intro.isVisible,item:e.item,paneTopText:e.paneTopText,orientation:e.orientation,titles:e.getTitleList(),showScrollbars:e.showScrollbars,toast:e.toast,_showFormattingToolbar:d.default.settings.showFormattingToolbar,showFormattingToolbar:d.default.settings.showFormattingToolbar.get()>0,parents:e.getItem().parents(),testBeta:d.default.settings.testBetaFeatures}}},{key:"getPane",value:function(){return this.props.pane}},{key:"getScrollSize",value:function(){return this.props.pane.getInfiniteList(!1).getScrollSize()}},{key:"getClientHeight",value:function(){return this.props.pane.getHeight()}},{key:"getScrollTop",value:function(){return this.props.pane.getInfiniteList(!1).getScrollTop()}},{key:"onScroll",value:function(){this.refs.scroller&&this.refs.scroller.handleScroll()}},{key:"startDragging",value:function(e){o.default.hasClass(e.target,"paneDraggable")&&d.default.PaneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=e.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))}},{key:"onDragMove",value:function(e){this.hasMovedDrag||(this.hasMovedDrag=!0,d.default.DragDrop.isDraggingPane.set(!0),this.isDragging.set(!0));var t=this.props.pane.rect.get(),a=e.clientX-this.dragStartX-t.left;this.updateDragOffset(a),d.default.PaneManager.dragPaneTo(this.props.pane,t.left+a,t.right+a)&&this.updateDragOffset(e.clientX-this.dragStartX-this.props.pane.rect.get().left)}},{key:"onDragUp",value:function(){this.isDragging.set(!1),d.default.DragDrop.isDraggingPane.set(!1),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)}},{key:"updateDragOffset",value:function(e){this.dragOffset.set(e)}},{key:"onTouchMove",value:function(e){}},{key:"onMouseDownDrag",value:function(e){this._onMouseDownDrag(e,!1)}},{key:"onMouseDownDragExpanded",value:function(e){this._onMouseDownDrag(e,!0)}},{key:"_onMouseDownDrag",value:function(e,t){var a=this.state.rect;this.resizingInfo={startPos:e.clientX,startOffset:e.clientX-o.default.offset(this.refs.pane).left-a.width-(t?a.widthExpanded:0),startWidth:this.state.rect.width,isExpanded:t},document.addEventListener("mousemove",this.onMouseMoveResize),document.addEventListener("mouseup",this.onMouseUpResize),o.default.preventDefault(e)}},{key:"onMouseMoveResize",value:function(e){var t=this.resizingInfo;if(t){var a=o.default.offset(this.refs.pane),i=e.clientX-a.left-t.startOffset;t.isExpanded&&(i-=this.state.rect.width),this.props.pane.setWidthManual(i,t.isExpanded)}}},{key:"onMouseUpResize",value:function(){this.resizingInfo=void 0,d.default.PaneManager.updatePaneRects(),document.removeEventListener("mousemove",this.onMouseMoveResize),document.removeEventListener("mouseup",this.onMouseUpResize)}},{key:"onDoubleClickDrag",value:function(e,t){this.props.pane.widthManual&&this.props.pane.setWidthManual(void 0,t)}},{key:"onDoubleClickDragExpanded",value:function(e){this.onDoubleClickDrag(e,!0)}},{key:"renderCell",value:function(e,t){var a=this.props.pane;return A.a.createElement(Pe,{key:e,list:a.getInfiniteList(!1),pane:a,orientation:this.state.orientation,cell:t})}},{key:"render",value:function(){var e,t=this.props,a=this.state,i=t.pane,n=o.default.classNames("pane c-border",i.paneClass,t.className,{designBeta:d.default.settings.testBetaFeatures.get()},{overviewOpen:a.isOverviewVisible},{expanded:a.isExpanded},{none:!a.isActive},{hasTitles:a.parents.length>0},{horizontal:a.orientation===u.a.Orientation.Horizontal},{vertical:a.orientation!==u.a.Orientation.Horizontal},{firstPane:a.rect.isFirst},{transition:!d.default.PaneManager.isResizingPane&&!a.isDragging},{dragging:a.isDragging}),r=o.default.classNames("paneScroller belowHeader c-background",{overviewOpen:a.isOverviewVisible},"f1"),s=o.default.classNames("paneRoot"),l=o.default.classNames("paneContent",{editable:i.isWriteable});i.topBoxHeight.get()>0&&(e=a.paneTopText?A.a.createElement("span",{className:"loadingText"},a.paneTopText):this.getChildByKey("topBox"));var c=A.a.createElement(Z,{owner:i.getInfiniteList(!1),pane:i,overview:!1,renderCell:this.renderCell,hiddenInput:!0,contentClass:l,orientation:a.orientation,ref:"contentElement"},i.topBoxHeight.get()>0&&A.a.createElement("div",{key:"topBox",className:"paneTopBox c-background"},e)),f=i.isWriteable?A.a.createElement($,{pane:i}):null,p=a.rect,g={width:p.width},m={left:p.width},v={left:p.width+p.widthExpanded},y="translate3d("+Math.round(a.left+(a.dragOffset||0))+"px,0,0)";h.a.isFirefox&&!o.default.isRunningScript()?(g.left=a.left,a.dragOffset&&(g[h.a.transform.react]="translate3d("+a.dragOffset+"px,0,0)")):g[h.a.transform.react]=y,m[h.a.transform.react]=y,v[h.a.transform.react]=y;var k=a.testBeta?X:Q;return A.a.createElement(A.a.Fragment,null,A.a.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:n,style:g},A.a.createElement(k,{pane:i,startDragging:this.startDragging},this.getChildByKey("headerButtons")),A.a.createElement(be.a,{className:r,getScrollSize:this.getScrollSize,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:a.orientation,showScrollbars:a.showScrollbars,ref:"scroller"},A.a.createElement("div",{className:s,ref:"rootElement",onTouchMove:this.onTouchMove},c,f,a.showFormattingToolbar&&A.a.createElement(Ie,{pane:i}))),this.getChildByKey("overlay"),a.toast&&A.a.createElement("div",{className:"paneToasts"},A.a.createElement(we,{toast:a.toast}))),A.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:a.isExpanded?this.onMouseDownDragExpanded:this.onMouseDownDrag,style:a.isExpanded?v:m,onDoubleClick:a.isExpanded?this.onDoubleClickDragExpanded:this.onDoubleClickDrag}))}}]),t}(U.a),Ee=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=this.props.pane;return{rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches")}}},{key:"render",value:function(){var e=this.state,t=this.props.pane,a=e.hasCollapsed,i=(a?"Expand":"Collapse")+" all items in view",n=u.a.PaneHeaderButtonWidth,r=u.a.PaneHeaderButtonHeight;return A.a.createElement(De,{pane:t},A.a.createElement("div",{className:"f1",key:"headerButtons"},t.supportCollapsing&&A.a.createElement(K.a,{icon:a?"icon-angle-down":"icon-angle-right",iconSize:16,width:n,height:r,onClick:t.toggleCollapseAll.bind(t),tooltip:i,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:e.allowCollapsing})))}}]),t}(U.a),Ce=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.scrollTop=void 0,this.refScroller=A.a.createRef()}},{key:"getState",value:function(){var e=this.props.pane;return{numAllDay:e.numAllDay,heightAllDay:e.getHeightAllDay()}}},{key:"onMount",value:function(){var e=this;this.props.trackPane&&setTimeout(function(){var t=e.props.pane.paneContent;t&&(e.onPaneScroll(),t.addEventListener("scroll",e.onPaneScroll))},0)}},{key:"onUnmount",value:function(){var e=this.props.pane.paneContent;e&&e.removeEventListener("scroll",this.onPaneScroll)}},{key:"onPaneScroll",value:function(){var e=this.props.pane.paneContent.scrollTop,t=this.refScroller.current;e!==this.scrollTop&&t&&(this.scrollTop=t.scrollTop=e)}},{key:"render",value:function(){for(var e=0,t=this.props,a=this.state,i={height:t.height},n={height:a.heightAllDay+2},r={top:a.heightAllDay+30+2},s=[],o=0;o<24;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l;12===o?l="Noon":(l=0===o?12:o%12,l+=" "+(o>=12?"pm":"am")),s.push(A.a.createElement("div",{key:o,className:"time"},l))}return A.a.createElement("div",{className:"calendarTimes belowHeader c-background",style:i},A.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:r,ref:this.refScroller},s),t.showAllDay&&A.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:n},"All day"))}}]),t}(U.a),Ae=a(68),Me=a.n(Ae),Te=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"render",value:function(){return A.a.createElement(K.a,Me()({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}}]),t}(U.a),Le=u.a.TaskViewMode,xe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.listenToDispatcher("dateChanged");var e=d.default.pluginManager.getPlugin(u.a.PluginID.GCalendar);e.onSettingChanged(e.Settings.IsEnabled,this.onSettingChanged)}},{key:"getState",value:function(){var e=this.props.pane,t=d.default.pluginManager.getPlugin(u.a.PluginID.GCalendar);return{item:e.item,rect:e.rect,hasCollapsed:e.hasCollapsedObs,_allowCollapsingObs:e.search.getFilterObs("showOnlyMatches"),allowCollapsing:!e.search.getFilterValue("showOnlyMatches"),viewState:e.viewState,viewMode:e.getViewMode(),isCalendarView:e.isViewCalendar(),hasPremiumFeatures:d.default.billingManager.hasPremiumFeaturesObservable,date:(new Date).getDate(),isGCalEnabled:t.isEnabled(),calendarCustomDays:d.default.settings.calendarCustomDays,dayWeekStart:d.default.settings.dayWeekStart}}},{key:"onSettingChanged",value:function(){this._isMounted&&this.updateState()}},{key:"onClickToday",value:function(){this.props.pane.scrollToToday(u.a.ScrollDuration.Default)}},{key:"onClickJumpBack",value:function(){this.props.pane.scrollJump(-1,u.a.ScrollDuration.Default)}},{key:"onClickJumpForward",value:function(){this.props.pane.scrollJump(1,u.a.ScrollDuration.Default)}},{key:"onClickAddItem",value:function(e){this.props.pane.addItem({index:0,prefix:e})}},{key:"onClickAddFile",value:function(e,t){var a=this.props.pane;d.default.menus.openContextMenu({componentName:"ReactContextMenuDropZone",element:t.target,pane:a,itemParent:a.getItem(),insertIndex:0,image:e})}},{key:"onClickAddItemPopup",value:function(e){this.props.pane.openItemEditor({element:e.target,addOnSave:!0})}},{key:"onClickViewMode",value:function(e){this.props.pane.setViewMode(e)}},{key:"renderPaneBox",value:function(){var e=this.props.pane,t=e.isViewOutline()||e.isViewProjectNoBlocks(),a=e.isViewAgenda();return A.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},A.a.createElement(K.a,{icon:"icon-project",iconSize:16,width:44,onClick:this.onClickAddItem.bind(this,u.a.Prefix.Header),tooltip:"Add project"}),(t||a)&&A.a.createElement(K.a,{icon:"icon-edit",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,""),tooltip:"Add item"}),(t||a)&&A.a.createElement(K.a,{icon:"icon-check",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,u.a.Prefix.Task),tooltip:"Add task"}),(t||a)&&A.a.createElement(K.a,{icon:"icon-bullet",iconSize:22,width:44,onClick:this.onClickAddItem.bind(this,u.a.Prefix.Bullet),tooltip:"Add bullet"}),t&&A.a.createElement(K.a,{icon:"icon-numlist",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,u.a.Prefix.NumList),tooltip:"Add numbered list"}),t&&A.a.createElement(K.a,{icon:"icon-drive-file",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!1),tooltip:"Add file"}),t&&A.a.createElement(K.a,{icon:"icon-image",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!0),tooltip:"Add image"}))}},{key:"render",value:function(){var e,t,a,i=this,n=this.state,r=this.props.pane,s=this.state.viewMode,l=u.a.TaskViewModeText[s],d=n.rect.width>550,c=u.a.PaneHeaderButtonWidth,h=u.a.PaneHeaderButtonHeight,f=o.default.classNames(n.isCalendarView?"calendar"+u.a.TaskViewModeText[s]+"View c-background":"",{showingButtons:n.isCalendarView},{premiumBlocked:r.isViewPremiumBlocked()}),p=n.hasCollapsed,g=u.a.SearchHeight,m=(p?"Expand":"Collapse")+" all items in view",v=r.isViewAgenda()&&[Le.Agenda_Today,Le.Agenda_Week,Le.Agenda_All]||r.isViewCalendar()&&[Le.Calendar_Day,Le.Calendar_Custom,Le.Calendar_Week,Le.Calendar_Month],y=A.a.createElement(Te,{day:this.state.date,width:g+(r.isViewAgenda()?8:0),height:g,onClick:this.onClickToday});return a=A.a.createElement("div",{key:"headerButtons"},r.isViewDates()&&A.a.createElement("div",{className:"calendarButtons"},A.a.createElement("div",{className:"borderButtons ib c-border-light"},r.isViewCalendar()&&A.a.createElement(K.a,{icon:"icon-caret-left",width:d?20:14,height:g,onClick:this.onClickJumpBack,enabled:n.isCalendarView,tooltip:"Previous "+l}),y,r.isViewCalendar()&&A.a.createElement(K.a,{icon:"icon-caret-right",width:d?20:14,height:g,onClick:this.onClickJumpForward,enabled:n.isCalendarView,tooltip:"Next "+l})),d&&A.a.createElement("div",{className:"viewModeButtons borderButtons ib c-border-light"},v.map(function(e){var t=u.a.TaskViewModeText[e];return e===Le.Calendar_Custom&&(t=t.replace("#",n.calendarCustomDays)),A.a.createElement(K.a,{height:g,selected:n.viewMode===e,onClick:i.onClickViewMode.bind(i,e),key:e},t)}))),r.supportCollapsing&&!r.isViewCalendar()&&A.a.createElement(K.a,{icon:p?"icon-angle-down":"icon-angle-right",iconSize:16,width:c,height:h,onClick:r.toggleCollapseAll.bind(r),tooltip:m,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:n.allowCollapsing})),r.isViewCalendar()?e=s===Le.Calendar_Month?A.a.createElement("div",{className:"calendarMonthDays belowHeader c-background c-border-heavy flexbox",key:"overlay"},0===n.dayWeekStart&&A.a.createElement("div",null,"SUN"),A.a.createElement("div",null,"MON"),A.a.createElement("div",null,"TUE"),A.a.createElement("div",null,"WED"),A.a.createElement("div",null,"THU"),A.a.createElement("div",null,"FRI"),A.a.createElement("div",null,"SAT"),1===n.dayWeekStart&&A.a.createElement("div",null,"SUN")):A.a.createElement(Ce,{pane:r,key:"overlay",trackPane:!0,showAllDay:!0}):r.shouldShowAddBox()&&(t=this.renderPaneBox()),A.a.createElement(De,{pane:r,className:f},e,t&&A.a.createElement("div",{key:"topBox"},t),a)}}]),t}(U.a),Re=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"onMount",value:function(){this.listenTo(this.props.pane.search.onChanged)}},{key:"getState",value:function(){var e=this.props.pane;return e.isDestroyed()?{}:{rootItem:e.item,messageIDs:d.default.EmailPreview.messageIDs,messages:d.default.EmailPreview.getMessages(),viewState:e.viewState,viewMode:e.getViewMode()}}},{key:"onHoldViewButton",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})}},{key:"onClickViewButton",value:function(){var e=this.state.viewMode===u.a.GmailViewMode.Priority?u.a.GmailViewMode.Date:u.a.GmailViewMode.Priority;this.setViewMode(e),d.default.menus.closeContextMenu()}},{key:"renderContextMenuSort",value:function(e){return A.a.createElement(z.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},A.a.createElement(j.a,null,"Sort by"),A.a.createElement(q.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,u.a.GmailViewMode.Date)},u.a.GmailViewMode.Date),A.a.createElement(q.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,u.a.GmailViewMode.Priority)},u.a.GmailViewMode.Priority))}},{key:"setViewMode",value:function(e){this.props.pane.setViewMode(e)}},{key:"renderViewButton",value:function(){var e=this.state.viewMode===u.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation";return A.a.createElement(K.a,{key:"sort",className:"emailViewButton",tooltip:"Sort Order",icon:e,iconSize:14,width:u.a.PaneHeaderButtonWidth,height:u.a.PaneHeaderButtonHeight,onClick:this.onClickViewButton,onHold:this.onHoldViewButton})}},{key:"render",value:function(){this.props.pane;return A.a.createElement(De,{key:"pane",pane:this.props.pane},A.a.createElement("div",{key:"headerButtons"},this.renderViewButton()))}}]),t}(U.a),Oe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=d.default.DragDrop;return{items:e.draggingItems,activePane:e.activePane,pane:e.startPane,position:e.position,transform:e.transform,isDragging:e.isInDrag,linePosition:e.linePosition,fromOverview:e.fromOverview,contextMenus:d.default.menus.contextMenuStack}}},{key:"onBeforeChanged",value:function(e,t){if(e.items!==t.items){var a=0;this.paddings=[];for(var i=0;i<e.items.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.paddings[i]=e.pane.getPaddingForPaneObject(e.items[i])-8}}}},{key:"render",value:function(){var e,t,a,i=this.state,n=i.pane,r=i.items;if(n&&i.isDragging){if(r&&r.length>0&&i.position&&i.transform){for(var s=0,l=[],u=Math.min(r.length,10),d=0;d<u;++d){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=this.paddings[d];l.push(A.a.createElement(ve.a,{key:"drag_"+d,pane:n,item:r[d].item,paneObject:r[d],renderLikePane:!0,noNotes:i.fromOverview,padding:c}))}var f=r.length-u;f>0&&l.push(A.a.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+f+" more ..."));var p=i.position,g={left:p.left+8,top:p.top,width:n.widthOfDrag(r[0]),maxWidth:n.getWidth()},m=i.transform;g[h.a.transform.react]="translate3d("+m.left+"px, "+m.top+"px, 0)",e=A.a.createElement("ul",{id:"dragUL",style:g,className:"popup c-shadow-popup c-background"},l)}if(i.linePosition&&i.activePane){var v=i.linePosition,y={width:v.width,height:v.height},k=o.default.classNames({isLine:!v.height});y[h.a.transform.react]="translate("+v.left+"px, "+v.top+"px)",t=A.a.createElement("div",{id:"dragLine",style:y,className:k})}a=o.default.classNames("from_"+n.type,i.activePane.paneClass)}return A.a.createElement("div",{id:"dragdrop",className:a},e,t)}}]),t}(U.a),Fe=a(206),Ne=a(165),Be=a(81),Ue=a(82),Ve=a.n(Ue),He=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){(this.props.canMinimize||this.props.canMaximize)&&this.createObservables({minimized:!1,maximized:!1})}},{key:"minimize",value:function(){var e=!this.minimized.get();e&&this.maximized.set(!1,!1),this.minimized.set(e)}},{key:"maximize",value:function(){var e=!this.maximized.get();e&&this.minimized.set(!1,!1),this.maximized.set(e)}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.canMinimize,i=e.canMaximize,n=e.close,r=e.title,s=e.width,l=e.height,u=e.children,d=Ve()(e,["className","canMinimize","canMaximize","close","title","width","height","children"]),c=this.state,h=c.minimized,f=c.maximized,p={height:!f&&(h?36:l),width:!f&&s},g=o.default.classNames(t,"fancyOverlayPopup popup c-shadow-popup c-background",{minimized:h},{f1:f}),m=a&&o.default.classNames("popupMinimize",{minimized:h}),v=A.a.createElement("div",Me()({},d,{className:g,style:p}),A.a.createElement("div",{className:"overlayTitleBar c-foreground c-border-heavy c-bg-popup-title flexbox"},A.a.createElement("div",{className:"displayTitle f1"},r),a&&A.a.createElement(K.a,{className:m,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:this.minimize,tooltip:h?"Restore":"Minimize"}),i&&A.a.createElement(K.a,{icon:f?"icon-filter_none":"icon-check_box_outline_blank",iconSize:14,width:36,height:36,onClick:this.maximize,tooltip:f?"Restore":"Maximize"}),A.a.createElement(K.a,{icon:"icon-close",width:36,height:36,onClick:n,tooltip:"Close"})),u);return f?A.a.createElement("div",{className:"fancyOverlayPopupMaximized flexbox flexvert absFull maximized"},A.a.createElement("div",{className:"fancyModalBackdrop"}),v):v}}]),t}(U.a),je=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({showAdvanced:d.default.billingManager.hasPremiumFeatures()})}},{key:"onMount",value:function(){}},{key:"getState",value:function(){return{isOpen:o.default.vmMain.isDisplaySettingsOpen,colorTheme:d.default.settings.ui.theme,displaySpacing:d.default.settings.ui.displaySpacing,displayPrefixes:d.default.settings.ui.displayPrefixes}}},{key:"updateSetting",value:function(e,t){e.set(t)}},{key:"onClickColorTheme",value:function(e){d.default.DisplaySettings.changeColorTheme(e)}},{key:"onClickTheme",value:function(e,t){d.default.DisplaySettings.changeTheme(e,t)}},{key:"isGrayscale",value:function(){return!0===d.default.settings.ui.grayscale.get()}},{key:"toggleAdvanced",value:function(){this.showAdvanced.set(!this.showAdvanced.get())}},{key:"updateGrayscale",value:function(e){d.default.settings.ui.grayscale.set(e),this.forceUpdate()}},{key:"close",value:function(){o.default.vmMain.isDisplaySettingsOpen.set(!1)}},{key:"renderCheckbox",value:function(e,t){return A.a.createElement(Be.a,{checked:e.get(),onChange:this.updateSetting.bind(this,e)},t)}},{key:"renderNumber",value:function(e){return A.a.createElement(Fe.a,{value:e.get(),onChange:this.updateSetting.bind(this,e)})}},{key:"renderColorPicker",value:function(e){return A.a.createElement(Ne.a,{color:e.get(),onChange:this.updateSetting.bind(this,e)})}},{key:"render",value:function(){var e,t=this.state,a=this.isGrayscale(),i=d.default.settings.ui;if(t.isOpen&&t.showAdvanced){var n=o.default.classNames("settingsAdvanced",{disabledSettings:!d.default.billingManager.hasPremiumFeatures()}),r=o.default.classNames({disabled:a});e=A.a.createElement("div",null,A.a.createElement("div",{className:"header c-foreground-very-faded"},"ADVANCED (PREMIUM)"),A.a.createElement("div",{className:n},A.a.createElement("div",null,A.a.createElement("span",null,"Item Font Size: "),this.renderNumber(i.fontSize)),A.a.createElement("div",null,A.a.createElement("span",null,"Project Font Size: "),this.renderNumber(i.fontSizeHeader)),A.a.createElement("div",null,A.a.createElement("span",null,"Top Level Project Font Size: "),this.renderNumber(i.fontSizeHeaderTopLevel)),A.a.createElement("div",null,A.a.createElement("span",null,"Note Font Size: "),this.renderNumber(i.noteFontSize)),A.a.createElement("div",null,A.a.createElement("span",null,"Item Line Height: "),this.renderNumber(i.itemLineHeight)),A.a.createElement("div",null,A.a.createElement("span",null,"Item Padding: "),this.renderNumber(i.itemPadding)),A.a.createElement("div",null,A.a.createElement("span",null,"Indent Size: "),this.renderNumber(i.itemIndentSize)),A.a.createElement("div",null,A.a.createElement("span",null,"Project Opacity: "),this.renderNumber(i.projectOpacity)),A.a.createElement("div",null,A.a.createElement("span",null,"Bullet Opacity: "),this.renderNumber(i.bulletOpacity)),A.a.createElement("div",null,A.a.createElement("span",null,"Checkbox Opacity: "),this.renderNumber(i.checkboxOpacity)),A.a.createElement("div",null,A.a.createElement("span",null,"Checkbox Background: "),this.renderNumber(i.checkboxBackgroundOpacity)),A.a.createElement("div",null,A.a.createElement("span",null,"Vertical Lines Opacity: "),this.renderNumber(i.verticalLinesOpacity)),a&&A.a.createElement("div",{className:"colorsDisabled"},"Colors disabled in Grayscale mode"),A.a.createElement("div",{className:r},A.a.createElement("span",null,"Tag Color: "),this.renderColorPicker(i.tagColor)),A.a.createElement("div",{className:r},A.a.createElement("span",null,"Date Color: "),this.renderColorPicker(i.dateColor)),A.a.createElement("div",{className:r},A.a.createElement("span",null,"Contact Color: "),this.renderColorPicker(i.contactColor)),A.a.createElement("div",{className:r},A.a.createElement("span",null,"Link Color: "),this.renderColorPicker(i.linkColor)),A.a.createElement("div",null,this.renderCheckbox(i.underlineP,"Underline tags, dates, contacts")),A.a.createElement("div",null,this.renderCheckbox(i.cursorBlink,"Text cursor blink"))))}var s=t.isOpen&&A.a.createElement("div",{className:"sidebar displaySettings"},A.a.createElement(He,{title:"Display Settings",close:this.close},A.a.createElement(be.a,null,A.a.createElement("div",null,A.a.createElement("div",{className:"header first c-foreground-very-faded"},"COLOR THEME"),A.a.createElement("div",{className:"themeButtons"},A.a.createElement(K.a,{raised:!0,primary:t.colorTheme===u.a.ColorTheme.Light,height:32,onClick:this.onClickColorTheme.bind(this,u.a.ColorTheme.Light)},"Light"),A.a.createElement(K.a,{raised:!0,primary:t.colorTheme===u.a.ColorTheme.Dark,height:32,onClick:this.onClickColorTheme.bind(this,u.a.ColorTheme.Dark)},"Dark")),A.a.createElement("div",{className:"header c-foreground-very-faded"},"SPACING"),A.a.createElement("div",{className:"themeButtons"},A.a.createElement(K.a,{raised:!0,primary:t.displaySpacing===u.a.DisplayTheme.SpacingCompact,height:32,onClick:this.onClickTheme.bind(this,i.displaySpacing,u.a.DisplayTheme.SpacingCompact)},"Compact"),A.a.createElement(K.a,{raised:!0,primary:t.displaySpacing===u.a.DisplayTheme.SpacingComfortable,height:32,onClick:this.onClickTheme.bind(this,i.displaySpacing,u.a.DisplayTheme.SpacingComfortable)},"Comfortable")),A.a.createElement("div",{className:"header c-foreground-very-faded"},"PREFIXES"),A.a.createElement("div",{className:"themeButtons"},A.a.createElement(K.a,{raised:!0,primary:t.displayPrefixes===u.a.DisplayTheme.PrefixesFaded,height:32,onClick:this.onClickTheme.bind(this,i.displayPrefixes,u.a.DisplayTheme.PrefixesFaded)},"Faded"),A.a.createElement(K.a,{raised:!0,primary:t.displayPrefixes===u.a.DisplayTheme.PrefixesStrong,height:32,onClick:this.onClickTheme.bind(this,i.displayPrefixes,u.a.DisplayTheme.PrefixesStrong)},"Strong")),A.a.createElement("div",{className:"header c-foreground-very-faded"},"OPTIONS"),A.a.createElement("div",null,A.a.createElement(Be.a,{checked:a,onChange:this.updateGrayscale},"Grayscale")),A.a.createElement("div",{style:{marginTop:8}},A.a.createElement(Be.a,{checked:d.default.settings.ui.boldHeaders.get(),onChange:this.updateSetting.bind(this,i.boldHeaders)},"Automatically Bold Parents")),A.a.createElement("div",{style:{marginTop:8}},this.renderCheckbox(i.showVerticalLines,"Show Vertical Lines"))),e,A.a.createElement("div",{style:{marginTop:16,textAlign:"center"}},A.a.createElement(K.a,{raised:!0,onClick:this.toggleAdvanced},(t.showAdvanced?"Hide":"Show")+" Advanced (Premium)")))));return A.a.createElement(B.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},s)}}]),t}(U.a),ze=a(45),qe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=this.props.item;return{isComplete:e.isComplete,isDisabled:e.isDisabled,text:e.text,jsx:e.jsx,isHidden:e.hiddenObservable}}},{key:"render",value:function(){var e=this.state,t=o.default.classNames({checked:e.isComplete},{disabled:e.isDisabled}),a=o.default.classNames("icon-check",{"c-foreground-super-faded":!e.isComplete},{"c-blue":e.isComplete});return!1!==e.isVisible&&!0!==e.isHidden&&A.a.createElement("li",{className:t},A.a.createElement("span",{className:a}),e.text&&A.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.text}}),e.jsx)}}]),t}(U.a),We=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.intro=d.default.intro,this.refScroller=A.a.createRef()}},{key:"onMount",value:function(){}},{key:"getState",value:function(){return{isOpen:this.intro.isVisible,sections:this.intro.sections,mode:this.intro.mode}}},{key:"close",value:function(){this.intro.close()}},{key:"onTapFeatures",value:function(){this.intro.setMode(u.a.HelpMode.Normal),this.refScroller.current.scrollTo(0,0,0)}},{key:"onTapHotkeys",value:function(){this.intro.setMode(u.a.HelpMode.Hotkeys),this.refScroller.current.scrollTo(0,0,0)}},{key:"renderSection",value:function(e){return A.a.createElement("div",{className:"helpSection c-border-heavy",key:e.id||e.text},A.a.createElement("div",{className:"helpTitle"},e.text),e.note&&A.a.createElement("div",{className:"helpNote c-foreground-faded"},e.note),A.a.createElement("ul",null,e.items.map(function(e,t){return A.a.createElement(qe,{item:e,key:t})})))}},{key:"renderHotkeySection",value:function(e){var t=ze.a.config[e],a=[];for(var i in t)if(t.hasOwnProperty(i)){for(var n=0,r=0,s=t[i],o=i,l=o.length-1;l>=0;l--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;(o[l]>="A"&&o[l]<="Z"||!isNaN(o[l])&&(0===l||isNaN(o[l-1])))&&(o=o.substr(0,l)+" "+o.substr(l))}for(var u=0,d=0;d<s.length;d++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=s[d].split(":"),f=!h.a.app&&c.indexOf("app")>=0;c.indexOf("win")>=0&&h.a.mac||c.indexOf("mac")>=0&&!h.a.mac||(a.push(A.a.createElement("li",{key:i+"-"+d,className:u>0?"hotkeyOr":""},A.a.createElement("span",null,A.a.createElement("span",{className:"helpHotkeyName ib"},0===u&&o),A.a.createElement("span",{className:"introHotkey c-bg-light c-blue"},ze.a.printHotkey(s[d])+(f?" (App only)":""))))),u++)}}return A.a.createElement("div",{className:"helpSection helpHotkeys c-border-heavy",key:e},A.a.createElement("div",{className:"helpTitle"},e),A.a.createElement("ul",null,a))}},{key:"renderHotkeys",value:function(){return[this.renderHotkeySection("Pane"),this.renderHotkeySection("Global"),this.renderHotkeySection("Email")]}},{key:"render",value:function(){var e=this.state;if(e.isOpen){var t=[];if(e.mode===u.a.HelpMode.Hotkeys)t=this.renderHotkeys();else for(var a=0,i=0;i<e.sections.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e.sections[i].noRender||t.push(this.renderSection(e.sections[i]))}var n=o.default.classNames("tab tabFeatures c-border-heavy f1",{selected:e.mode===u.a.HelpMode.Normal}),r=o.default.classNames("tab tabHotkeys c-border-heavy f1",{selected:e.mode===u.a.HelpMode.Hotkeys}),s=o.default.classNames("sidebar sidebarHelp intro",{helpHotkeys:e.mode===u.a.HelpMode.Hotkeys},{helpNormal:e.mode===u.a.HelpMode.Normal}),l=e.isOpen&&A.a.createElement("div",{className:s},A.a.createElement(He,{title:"Help",close:this.close},A.a.createElement("div",{className:"helpHeaderRow flexbox"},A.a.createElement(K.a,{height:36,className:n,onClick:this.onTapFeatures},"Features"),A.a.createElement(K.a,{height:36,className:r,onClick:this.onTapHotkeys},"Hotkeys")),A.a.createElement(be.a,{ref:this.refScroller},t)))}return A.a.createElement(B.CSSTransitionGroup,{transitionName:"previewOpen",component:"div",transitionEnterTimeout:200,transitionLeaveTimeout:200},l)}}]),t}(U.a),Ge=a(8),Ke=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){var e=V.a.isAdding();e&&V.a.setIsAdding(!1),this.createObservables({isEditing:e})}},{key:"getState",value:function(){return{name:this.props.board.name,selected:V.a.selected}}},{key:"onBeforeChanged",value:function(e,t){e.selected!==t.selected&&e.isEditing&&e.selected!==this.props.board&&(this.isEditing.set(!1,!1),e.isEditing=!1)}},{key:"onMouseEnter",value:function(){d.default.DragDrop.isDragging&&!this.props.active&&this.onClick()}},{key:"openMenu",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"onClickRemove",value:function(){this.props.active?d.default.tooltip.displayTip({text:"Cannot remove the active board.",element:this.refs.element}):V.a.removeBoard(this.props.board)}},{key:"onClickClone",value:function(){V.a.cloneBoard(this.props.board)}},{key:"onClick",value:function(){d.default.PaneManager.switchToBoard(this.props.board)}},{key:"edit",value:function(){this.isEditing.set(!0)}},{key:"rename",value:function(){if(this.state.isEditing){var e=this.refs.input.getValue();V.a.renameBoard(this.props.board,e)?this.isEditing.set(!1):d.default.tooltip.displayTip({text:"Please give this board a unique name.",element:this.refs.element})}}},{key:"onEscape",value:function(){this.refs.input.setValue(this.state.name),this.isEditing.set(!1)}},{key:"onClickSaveDefault",value:function(){V.a.saveBoardDefault(this.props.board)}},{key:"onClickRestoreDefault",value:function(){V.a.restoreBoardDefault(this.props.board)}},{key:"renderContextMenu",value:function(e){var t=!this.props.board.defaultPanes;return A.a.createElement(z.a,Me()({},e,{key:"contextMenuBoard",id:"contextMenuBoard"}),A.a.createElement(q.a,{onClick:this.edit},"Rename"),A.a.createElement(q.a,{onClick:this.onClickClone},"Clone as new board"),A.a.createElement("hr",null),A.a.createElement(q.a,{onClick:this.onClickSaveDefault},"Save view as default"),A.a.createElement(q.a,{disabled:t,onClick:this.onClickRestoreDefault},"Restore default view"),A.a.createElement("hr",null),A.a.createElement(q.a,{onClick:this.onClickRemove},"Delete"))}},{key:"render",value:function(){var e=this.props,t=e.inSidebar,a=e.inSidebarSmall,i=e.fontSize,n=e.className,r=e.active,s=e.buttonSize,l=this.state,u=o.default.classNames(n,{"toolbarBoard c-border-light":!t},{"sidebarBoard c-bg-sidebar":t},{"active c-background":r}),d=l.name||"Board",c=d;return a&&(c=c.substr(0,Math.min(c.length,4))),A.a.createElement("div",{className:u,ref:"element",onMouseEnter:this.onMouseEnter},l.isEditing&&A.a.createElement(Y.a,{height:s,fontSize:i,padding:a?{left:2,right:2}:void 0,value:d,border:!1,focused:!0,selectAll:!0,onEnter:this.rename,onBlur:this.rename,onEscape:this.onEscape,ref:"input"}),!l.isEditing&&A.a.createElement(K.a,{height:s,fontSize:i,onClick:this.onClick,selected:r,onMouseEnter:this.onMouseEnter,onDoubleClick:this.edit,onRightClick:this.openMenu,ref:"menu"},c,t&&!a&&A.a.createElement("i",{className:"icon-drag-handle c-button"})))}}]),t}(U.a),Ye=a(159),Xe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({isHovered:!1})}},{key:"getState",value:function(){return{hasPremiumFeatures:d.default.billingManager.hasPremiumFeaturesObservable,boards:V.a._boards,selectedIndex:V.a.selectedIndex}}},{key:"moveChild",value:function(e,t){V.a.moveTo(e,t)}},{key:"onMouseEnter",value:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseMove",value:function(e){o.default.hasClass(e.target,"sidebarDragHandle")||!o.default.isAttachedToDoc(e.target)||o.default.findParent(e.target,"sidebarBoardOutside")||o.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)}},{key:"addBoard",value:function(){var e=this.refs.newButton.getElement();!d.default.billingManager.hasPremiumFeatures()&&this.state.boards.length>=u.a.PremiumMaxBoards?d.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e,premiumMessage:"Using more than "+u.a.PremiumMaxBoards+" boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes.",enableMessage:"unlimited Boards"}):(d.default.PaneManager.addBoard(),Ge.d.performAction(Ge.b.UIAction,{type:Ge.c.AddBoard}))}},{key:"onClickNew",value:function(){this.addBoard()}},{key:"onClickAddPane",value:function(e){d.default.menus.openAddPaneMenu({element:e.target})}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props,i=(o.default.classNames({upsell:!t.hasPremiumFeatures}),o.default.classNames({flexbox:!a.isSmall})),n=[],r=0;r<t.boards.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=t.boards[r];n.push(A.a.createElement(Ke,{key:s.id,board:s,fontSize:12,active:r===t.selectedIndex,buttonSize:a.buttonSize}))}return A.a.createElement("div",{className:"toolbarBoards"},A.a.createElement(be.a,{orientation:u.a.Orientation.Horizontal,showScrollbars:!0,tinyMode:!0},A.a.createElement(Ye.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter,horizontal:!0},n),A.a.createElement("span",{className:i},A.a.createElement(K.a,{icon:"icon-add",iconSize:16,width:a.buttonSize,height:a.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:"newButton"}))))}}]),t}(U.a),Qe=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({isHovered:!1}),window.addEventListener("mouseout",this.onWindowOut),this.refNewButton=A.a.createRef()}},{key:"getState",value:function(){return{hasPremiumFeatures:d.default.billingManager.hasPremiumFeaturesObservable,boards:V.a._boards,selectedIndex:V.a.selectedIndex}}},{key:"onUnmount",value:function(){document.removeEventListener("mouseout",this.onWindowOut)}},{key:"moveChild",value:function(e,t){V.a.moveTo(e,t)}},{key:"onMouseEnter",value:function(){this.isHovered.set(!0),document.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseMove",value:function(e){o.default.hasClass(e.target,"sidebarDragHandle")||!o.default.isAttachedToDoc(e.target)||o.default.findParent(e.target,"sidebarBoardOutside")||o.default.findParent(e.target,"sidebarBoard")||this.onMouseLeave()}},{key:"onWindowOut",value:function(e){(e.pageX>=h.a.windowWidth()||e.pageY>=h.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.isHovered.set(!1)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1),document.removeEventListener("mousemove",this.onMouseMove)}},{key:"addBoard",value:function(){var e=this.refNewButton.current.getElement();!d.default.billingManager.hasPremiumFeatures()&&this.state.boards.length>=u.a.PremiumMaxBoards?d.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e,premiumMessage:"Using more than "+u.a.PremiumMaxBoards+" boards is a Premium feature that allows you to customize your workflow and save multiple sets of panes.",enableMessage:"unlimited Boards"}):(d.default.PaneManager.addBoard(),Ge.d.performAction(Ge.b.UIAction,{type:Ge.c.AddBoard}))}},{key:"onClickNew",value:function(){this.addBoard()}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props,i=[],n=0;n<t.boards.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.boards[n];i.push(A.a.createElement(Ke,{key:r.id,board:r,active:n===t.selectedIndex,fontSize:a.fontSize,buttonSize:a.buttonSize,inSidebar:!0,inSidebarSmall:a.isSmall}))}return A.a.createElement("div",{className:"sidebarBoards"},A.a.createElement(Ye.a,{moveChild:this.moveChild,onMouseEnter:this.onMouseEnter},i),A.a.createElement(K.a,{icon:"icon-add",className:"addButton",iconSize:16,width:a.isSmall?void 0:36,height:a.buttonSize,onClick:this.onClickNew,tooltip:"Add new board",ref:this.refNewButton}))}}]),t}(U.a),Je=a(41),Ze=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({isEditingBoard:!1}),this.listenToDispatcher(d.default.pluginManager,"pluginActiveChanged"),this.listenToDispatcher("windowResize"),this.listenTo(Je.a.onAccountsUpdated)}},{key:"getState",value:function(){var e,t=c.a.onlineStatus.get(),a={onlineStatus:c.a.onlineStatus,isEmailEnabled:!h.a.isMailbirdSidebar()&&d.default.pluginManager.isEnabled(u.a.PluginID.Gmail),isOnline:"Offline"!==t,isConnected:"Online"===t,onlineText:c.a.onlineText(),showSidebar:d.default.DesktopUI.showSidebar,isDraggingSidebar:d.default.DesktopUI.isDraggingSidebar,isNativeMacFullscreen:h.a.isNativeMacFullscreen(),isMailbirdSidebar:h.a.isMailbirdSidebar(),_sidebarWidth:d.default.DesktopUI.sidebarWidth,sidebarWidth:d.default.DesktopUI.getSidebarWidth(),isSmall:d.default.DesktopUI.getSidebarWidth()<u.a.DesktopMenuWidthMinBig,daysLeftInTrial:d.default.billingManager.daysLeftInTrial};o.default.isDemoMode()||(e="Offline"===t?"icon-cloud_off":Je.a.hasError()?"icon-warning":"Online"===t?"icon-cloud_done":"icon-cloud_queue",a.statusIcon=e);return a}},{key:"onMouseDownAddPane",value:function(e){!d.default.billingManager.hasPremiumFeatures()&&d.default.PaneManager.paneCount()>=u.a.PremiumMaxPanes?d.default.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e.target,premiumMessage:"Using more than "+u.a.PremiumMaxPanes+" Panes in a board is a Premium feature.",enableMessage:"unlimited Panes"}):d.default.menus.openAddPaneMenu({element:e.target})}},{key:"onMouseDownOptions",value:function(e){d.default.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:e.target})}},{key:"onClickNewEmail",value:function(){d.default.menus.openComposeEmail(d.default.pluginManager.getPluginGmail())}},{key:"onClickStatusText",value:function(e){o.default.isDemoMode()?d.default.menus.confirm("Go to the Moo.do homepage?",function(e){if(e)if(window.parent)try{window.parent.location="https://www.moo.do"}catch(t){window.location="/"}else window.location="/"}):d.default.menus.openContextMenu({componentName:"ReactContextMenuOnlineStatus",element:e.target})}},{key:"onClickToggle",value:function(){d.default.DesktopUI.toggleSidebar(),d.default.tooltip.hideTip()}},{key:"onClickMinimize",value:function(){d.default.DesktopUI.minimize(),d.default.tooltip.hideTip()}},{key:"onClickRestore",value:function(){d.default.DesktopUI.restore(),d.default.tooltip.hideTip()}},{key:"onMouseDownExpand",value:function(e){this.expandingFrom=e.clientX,this.startPosition=this.state.sidebarWidth,document.addEventListener("mousemove",this.onMouseMoveExpand),document.addEventListener("mouseup",this.onMouseUpExpand),o.default.preventDefault(e)}},{key:"onMouseMoveExpand",value:function(e){if(this.expandingFrom){var t=o.default.clamp(this.startPosition+e.clientX-this.expandingFrom,0,u.a.DesktopMenuWidthMax);d.default.DesktopUI.setSidebarWidthMoving(t)}}},{key:"onMouseUpExpand",value:function(){this.expandingFrom=void 0,this.startPosition=void 0,o.default.vmMain.cursor.set(void 0),d.default.DesktopUI.setSidebarWidthUp(),document.removeEventListener("mousemove",this.onMouseMoveExpand),document.removeEventListener("mouseup",this.onMouseUpExpand)}},{key:"onClickAddItem",value:function(e){d.default.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:e.target})}},{key:"onClickHelp",value:function(e){d.default.menus.openContextMenu({componentName:"ReactContextMenuHelp",element:e.target})}},{key:"onClickShare",value:function(e){d.default.menus.openContextMenu({componentName:"ReactContextMenuShare",element:e.target})}},{key:"onClickTrial",value:function(){d.default.menus.openSettings(u.a.SettingsSections.Account)}},{key:"render",value:function(){var e,t,a=this.state,i=o.default.classNames("desktopMenuText desktopOnline",{offline:!a.isOnline},{connected:a.isConnected}),n=d.default.billingManager,r=n.isTrialState()&&!d.default.settings.trialOverHidden.get(),s=n.isTrialOver(),l=a.isSmall,c=h.a.isNativeMac(),f=c?36:32,p=d.default.DesktopUI.shouldShowTopBar();if(a.showSidebar){var g={width:a.sidebarWidth+u.a.SidebarDragHandleSize/4},m={marginRight:u.a.SidebarDragHandleSize/4},v={marginRight:3*u.a.SidebarDragHandleSize/4},y=o.default.classNames("desktopSidebar",{transition:d.default.DesktopUI.sidebarTransitioning},{noClick:a.isDraggingSidebar},{small:l},{big:!l}),k=l?0:8,_=o.default.clamp((d.default.DesktopUI.getSidebarWidth()-u.a.DesktopMenuWidthMinBig)/(u.a.DesktopMenuWidthDefault-u.a.DesktopMenuWidthMinBig),0,1),S=l?9:Math.round(o.default.lerp(10,12,_));e=A.a.createElement("div",{id:"desktopMenu",className:y,style:g},A.a.createElement("div",{className:"desktopMenuInside ns flexbox flexvert c-bg-sidebar",style:m},A.a.createElement("div",{className:"desktopDrag sidebarPaddingTop",style:v}),A.a.createElement("div",{className:"sidebarToggle noShrink flexbox"},l&&A.a.createElement(K.a,{icon:"icon-angle-right",iconSize:16,width:32,height:32,onClick:this.onClickRestore,tooltip:"Restore Sidebar"}),!l&&A.a.createElement(A.a.Fragment,null,A.a.createElement("div",{className:"desktopDrag flex-spacer"}),A.a.createElement(K.a,{icon:"icon-minus",iconSize:8,width:32,height:32,onClick:this.onClickMinimize,tooltip:"Shrink to tiny sidebar"}),A.a.createElement(K.a,{icon:"icon-sidebar",iconSize:14,width:32,height:32,onClick:this.onClickToggle,tooltip:"Toggle Sidebar"}))),!l&&A.a.createElement("div",{className:"sidebarHeader","data-tooltip":"Use Boards to save your pane layouts and customize your workflow."},"BOARDS"),A.a.createElement("div",{className:"sidebarSection sectionBoards"},A.a.createElement(Qe,{buttonSize:26,fontSize:S,isSmall:l})),A.a.createElement("div",{style:{height:16}}),!l&&A.a.createElement("div",{className:"sidebarHeader"},"ACTIONS"),A.a.createElement("div",{className:"sidebarSection noShrink"},A.a.createElement(K.a,{id:"addPaneButton",ref:"addPane",tooltip:"Add Pane",tooltipHotkey:{name:"AddPane",group:"Global"},icon:"icon-crop_portrait",iconSize:15,fontSize:S,height:26,onMouseDown:this.onMouseDownAddPane,padding:k},!l&&"Add Pane"),A.a.createElement(K.a,{id:"newItemButton",icon:"icon-edit",iconSize:13,fontSize:S,height:26,tooltip:"New Item",tooltipHotkey:{name:"NewItem",group:"Global"},onClick:this.onClickAddItem,padding:k},!l&&"New Item"),a.isEmailEnabled&&A.a.createElement(K.a,{id:"newEmailButton",iconSize:13,fontSize:S,height:26,ref:"newEmail",icon:"icon-mail_outline",tooltip:"Compose Email",tooltipHotkey:{name:"EmailCompose",group:"Global"},onMouseDown:this.onClickNewEmail,padding:k},!l&&"New Email")),A.a.createElement("div",{className:"desktopDrag flex-spacer",style:v}),!p&&A.a.createElement("div",{className:"sidebarSection desktopMenuBottom noShrink"},!l&&A.a.createElement("div",{className:"sidebarHeader"},"MORE"),A.a.createElement(K.a,{id:"buttonOnlineStatus",icon:a.statusIcon,tooltip:"Check sync status",onClick:this.onClickStatusText,className:i,iconSize:15,fontSize:S,height:26,padding:k},!l&&a.onlineText),r&&!s&&A.a.createElement(K.a,{tooltip:a.daysLeftInTrial+" days left in trial",onClick:this.onClickTrial,fontSize:S,height:26,padding:k},"TRIAL"),r&&s&&A.a.createElement(K.a,{tooltip:"Learn more about Premium",onClick:this.onClickTrial,fontSize:S,height:26,padding:k},"TRIAL OVER"),A.a.createElement(K.a,{tooltip:"Share Moo.do with your friends or team",icon:"icon-heart",ref:"share",iconSize:12,fontSize:S,height:26,onClick:this.onClickShare},!l&&"Share"),A.a.createElement(K.a,{id:"helpButton",ref:"help",tooltip:"Show the Help",icon:"icon-question",iconSize:16,fontSize:S,height:26,onClick:this.onClickHelp,tooltipHotkey:{name:"Help",group:"Global"}},!l&&"Help"),A.a.createElement(K.a,{id:"optionsButton",ref:"options",tooltip:"Show more options",icon:"icon-settings",iconSize:14,fontSize:S,height:26,onMouseDown:this.onMouseDownOptions},!l&&"Options"),A.a.createElement("div",{style:{height:8}}))),A.a.createElement("div",{className:"sidebarDragHandle",onMouseDown:this.onMouseDownExpand,onDoubleClick:this.onClickToggle,style:{width:u.a.SidebarDragHandleSize}}))}if(p){var P=a.showSidebar&&!l,w=o.default.classNames("desktopToolbar flexbox"),I={left:!c&&a.sidebarWidth},b=o.default.classNames("desktopDrag noShrink",{"c-bg-sidebar":P}),D={width:Math.max(a.sidebarWidth,u.a.DesktopMenuWidthMinBig),height:P&&f+1};t=A.a.createElement("div",{className:w,style:I},c&&!a.isNativeMacFullscreen&&A.a.createElement("div",{className:b,style:D}),!a.isMailbirdSidebar&&A.a.createElement(K.a,{icon:"icon-sidebar",className:"noShrink",iconSize:14,width:f,height:f,tooltip:"Toggle sidebar",onClick:this.onClickToggle}),!a.showSidebar&&A.a.createElement(Xe,{buttonSize:f}),A.a.createElement("div",{className:"f1 desktopDrag"}),A.a.createElement("div",{className:"noShrink"},!1,A.a.createElement(K.a,{id:"buttonOnlineStatus",icon:a.statusIcon,iconSize:13,width:f,height:f,onClick:this.onClickStatusText,className:i,tooltip:"Check sync status"}),A.a.createElement(K.a,{id:"addPaneButton",icon:"icon-add-pane",iconSize:15,width:f,height:f,onMouseDown:this.onMouseDownAddPane,tooltip:"Add Pane",tooltipHotkey:{name:"AddPane",group:"Global"}}),A.a.createElement(K.a,{id:"newItemButton",icon:"icon-edit",iconSize:14,width:f,height:f,onClick:this.onClickAddItem,tooltip:"New Item",tooltipHotkey:{name:"NewItem",group:"Global"}}),a.isEmailEnabled&&!a.isMailbirdSidebar&&A.a.createElement(K.a,{icon:"icon-mail_outline",iconSize:15,width:f,height:f,onClick:this.onClickNewEmail,tooltip:"New Email",tooltipHotkey:{name:"EmailCompose",group:"Global"}}),A.a.createElement(K.a,{id:"optionsButton",ref:"options",tooltip:"More",icon:"icon-settings",iconSize:14,width:f,height:f,onMouseDown:this.onMouseDownOptions})))}return A.a.createElement(A.a.Fragment,null,e,t)}}]),t}(U.a),$e=a(12),et=a.n($e),tt=a(22),at=a.n(tt),it=a(27),nt=a(35),rt=a.n(nt),st=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"render",value:function(){var e=this.props,t={height:e.height},a=rt()({},h.a.transform.react,"scale("+e.percent+", 1)"),i={lineHeight:e.height-2+"px"};return A.a.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&A.a.createElement("div",{className:"fancyProgressInside",style:a}),e.error&&A.a.createElement("div",{className:"fancyProgressError",style:i},e.errorMsg))}}]),t}(U.a),ot=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({attachments:[]}),this.onAttachmentUpdate(),this.props.threadAttach.subscribe(this)}},{key:"onUnmount",value:function(){this.props.threadAttach.unsubscribe(this)}},{key:"onAttachmentUpdate",value:function(){var e=this;this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message).then(function(t){return e.attachments.set(t)})}},{key:"onAttachmentIDChange",value:function(){}},{key:"isAttachImage",value:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t}},{key:"onClickAttach",value:function(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var a=this._getURL(e);this.props.editable?o.default.openUrl(a):e.attID?h.a.mac&&t.metaKey||!h.a.mac&&t.ctrlKey||!this.isAttachImage(e)?o.default.downloadFile(a,e.cid):d.default.menus.openLightbox(a,"Download",function(){o.default.downloadFile(a,e.cid)}):o.default.openUrl(a)}t.stopPropagation()}},{key:"onClickDelete",value:function(e,t){var a=this;o.default.preventAndStop(t),at()(et.a.mark(function t(){var i,n;return et.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:return i=a.props.threadAttach.getPlugin(),t.next=3,i.removeAttachFiles(a.props.threadAttach,a.props.message,e);case 3:n=t.sent,a.props.onUpdate&&a.props.onUpdate(n);case 5:case"end":return t.stop()}}},t)}))()}},{key:"onAttachDragStart",value:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),d.default.DragDrop.setExternalData(t)}},{key:"_getURL",value:function(e){return this.props.editable||!e.attID?d.default.EmailPreview.getPreviewURL(e):d.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)}},{key:"_renderAttachment",value:function(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?o.default.clamp(e.uploader.getPercent(),.05,1):1,i=this.isAttachImage(e)?"Click to open image.\n"+h.a.priModKey+" click to download image.":"Click to download image";return A.a.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":i},A.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),A.a.createElement("div",{className:"attachmentText"},e.cid),A.a.createElement("div",{className:"f1"}),a<1&&A.a.createElement(st,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&A.a.createElement("div",null,"ERROR"),A.a.createElement("div",{className:"attachmentSize"},o.default.toFileSize(e.size)),this.props.editable&&A.a.createElement(K.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))}},{key:"render",value:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var a=0,i=[],n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[n];i.push(this._renderAttachment(r))}e=A.a.createElement("div",{className:"messageAttachments c-border"},i)}return e}}]),t}(U.a),lt=a(470),ut=a(78),dt=(n=function(){function e(t,a,i){p()(this,e),this.plugin=t.getPlugin(),this.threadAttach=t,this.message=a,this._getEmailData=i}return m()(e,[{key:"onMount",value:function(){this._isMounted=!0}},{key:"onUnmount",value:function(){this._isMounted=!1,this.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0})}},{key:"onEmailChanged",value:function(){this.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"saveDraft",value:function(e){var t=e.updateRemoteDraft,a=e.forceFlush;clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this.needsSaveDraft=t,this.needsForceFlush=a,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this.flushUnsavedChanges.bind(this,{updateRemoteDraft:t,forceFlush:a}),1e3))}},{key:"flushUnsavedChanges",value:function(e){var t=e.updateRemoteDraft,a=e.forceFlush;this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(this.needsSaveDraft||t,this.needsForceFlush||a),this.needsSaveDraft=!1,this.needsForceFlush=!1)}},{key:"discardDraft",value:function(){this.plugin.discardDraft(this.threadAttach,this.message.id,this.message.draftID,function(e){try{o.default.PAssert(1156,e,"Should always be able to delete a draft")}catch(t){o.default.reportError(t)}})}},{key:"getComposeBody",value:function(){var e=at()(et.a.mark(function e(t){var a;return et.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!t||!t.decoded){e.next=4;break}return e.next=3,ut.a.getComposeBody(t.decoded,t.resources);case 3:a=e.sent;case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"createTokensFromAddressText",value:function(e){var t=[];if(e)for(var a=0,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=e[i];n.text?t.push(n):n.email&&t.push({email:n.email,text:n.email})}return{tokens:t}}},{key:"_saveDraftUpdates",value:function(e,t){if(o.default.shouldLog(u.a.LogLevels.Compose)&&o.default.log("Queue Save Draft: ",this.threadAttach.id,this.message.id,this.message.draftID,this._isMounted),this._isMounted){var a=this._getEmailData();this.plugin.updateDraft(this.threadAttach,this.message.id,this.message.draftID,a,e,t,function(e){console.log("draft updated",e);try{o.default.PAssert(1157,e,"Should always be able to update a draft")}catch(t){o.default.reportError(t)}})}}},{key:"prepForSend",value:function(e,t){this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.to&&e.to.length?e.subject?e.decoded?t():d.default.menus.confirm("There is no email body. Send anyway?",function(e){e&&t()}):d.default.menus.confirm("There is no email subject. Send anyway?",function(e){e&&t()}):d.default.menus.alert({text:"Please enter a recipient."})}},{key:"changeFrom",value:function(){var e=at()(et.a.mark(function e(t){var a,i,n,r,s,o;return et.a.wrap(function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return a=this.threadAttach,i=this.plugin.getSyncAccount(t),n=this.plugin.getSendingAccountInfo(t),this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.next=6,this.plugin.changeMessageAccount(a,this.message.id,this.message.draftID,i,t,n);case 6:return r=e.sent,s=this.plugin.getDraftByID(i,r.threadID,r.messageID),this.threadAttach=s.attach,this.message=s.draftMsg,this.saveDraft({updateRemoteDraft:!0,forceFlush:!1}),e.next=13,this.getComposeBody(this.message);case 13:if(e.t0=e.sent,e.t0){e.next=16;break}e.t0="";case 16:return o=e.t0,e.abrupt("return",{body:o,threadAttach:this.threadAttach,message:this.message});case 18:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),y()(n.prototype,"flushUnsavedChanges",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"flushUnsavedChanges"),n.prototype),n),ct=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){var e=this.props;this.threadAttach=e.threadAttach,this.message=e.message,this._composeHelper=new dt(this.threadAttach,this.message,this.getEmailData),this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc);var t=!!this.message.cc&&this.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(Je.a.onAccountsUpdated),this.message.inReplyTo){var a=this.threadAttach.getData().messages,i=a.indexOfWithProperty("messageID",this.message.inReplyTo);if(i>=0){var n=a[i];try{o.default.PAssert(780,n.initializedForDisplay,"Message must be ready to display if being replied to")}catch(r){o.default.reportError(r)}n&&n.responseMode&&(this.modeListener=n.responseMode.listen(this.onReplyModeChanged))}}o.default.isDemoMode()&&(o.default.reactEmailCompose=this),this.refBody=A.a.createRef(),this.refContainer=A.a.createRef(),this.refPicker=A.a.createRef(),this.refTo=A.a.createRef(),this.refCc=A.a.createRef(),this.refBcc=A.a.createRef(),this.refSubject=A.a.createRef(),this.refFrom=A.a.createRef(),this.refLink=A.a.createRef()}},{key:"onReplyModeChanged",value:function(){this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()}},{key:"_getHotkeys",value:function(){return[ze.a.create(u.a.KeyCode.Escape,!0,u.a.Primary.Either,u.a.Shift.Either,this.onEscape),ze.a.create(u.a.KeyCode.Enter,!0,u.a.Primary.Yes,u.a.Shift.Either,this.sendEmail),ze.a.create(u.a.KeyCode.K,!0,u.a.Primary.Yes,u.a.Shift.No,this.insertLinkHotkey)]}},{key:"getPlugin",value:function(){return this.threadAttach.getPlugin()}},{key:"getState",value:function(){return{attachments:this.getPlugin().getMessageDisplayAttachments(this.message),fromAccounts:this.getSendingAccounts()}}},{key:"onMount",value:function(){var e=this;this._composeHelper.onMount(),at()(et.a.mark(function t(){var a,i;return et.a.wrap(function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,e._composeHelper.getComposeBody(e.message);case 2:(a=t.sent)&&e.refBody.current.setValue(a),e.refContainer.current.addEventListener("cdrop",e.onItemDrop),(i=e.refPicker.current).addEventListener("change",function(){return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,i.files,e.onAttachUpdated),i.value=null,!1},!1),e.refContainer.current.addEventListener("paste",function(t){var a=t&&t.clipboardData?t.clipboardData:t.synthetic?t.data:window.clipboardData;if(a&&a.items&&a.items.length>0){for(var i=0,n=0,r=[],s=0;s<a.items.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;"file"===a.items[s].kind&&r.push(a.items[s].getAsFile())}if(r.length>0)return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,r,e.onAttachUpdated),!1}},!1),document.addEventListener("mouseup",e.onMouseUp),document.addEventListener("keydown",e.onKeyDown);case 10:case"end":return t.stop()}}},t)}))()}},{key:"onUnmount",value:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._composeHelper.onUnmount(),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"discard",value:function(){this.close(!1,!0,!0)}},{key:"onEscape",value:function(){var e=this;this.isDragOver.get()||(this.refTo.current.getTokens().length>0||this.refBody.current.getValue()||this.state.attachments.length>0?d.default.menus.confirm("Do you want to discard this draft?",function(t){t&&e.discard()}):this.discard())}},{key:"onFocus",value:function(){this.__hotkeys||(this.__hotkeys=ze.a.pushStack(this._getHotkeys())),P.a.clearSelection()}},{key:"onBlur",value:function(){this.__hotkeys&&(ze.a.popStack(this.__hotkeys),this.__hotkeys=void 0)}},{key:"onClickAttach",value:function(){this.refPicker.current.click()}},{key:"onAttachUpdated",value:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._composeHelper.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0}),this.updateState())}},{key:"onDragEnter",value:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))}},{key:"onDragLeave",value:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)}},{key:"onMouseUp",value:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)}},{key:"onKeyDown",value:function(e){e.keyCode===u.a.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))}},{key:"onFileDrop",value:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0)this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),d.default.DragDrop.stop(),d.default.DragDrop.finish()}}},{key:"onItemDrop",value:function(e){if(e.item&&e.item.hasAttachmentType(u.a.PluginType.Storage)){var t=e.item.getAttachmentByType(u.a.PluginType.Storage);this.getPlugin().notifyAttachLinkedFile(this.threadAttach,this.message,t,this.onAttachUpdated.bind(this))}}},{key:"close",value:function(e,t,a){try{o.default.PAssert(781,o.default.isBoolean(e),"Must supply a valid value for sendDraft")}catch(i){o.default.reportError(i)}try{o.default.PAssert(782,o.default.isBoolean(t),"Must supply a valid value for discardDraft")}catch(i){o.default.reportError(i)}try{o.default.PAssert(783,o.default.isBoolean(a),"Must supply a valid value for forceFlush")}catch(i){o.default.reportError(i)}o.default.shouldLog(u.a.LogLevels.Compose)&&o.default.log("Compose Close: ",e,t,a),!e&&t?this._composeHelper.discardDraft():this._composeHelper.flushUnsavedChanges({updateRemoteDraft:e,forceFlush:a}),this.props.onClose()}},{key:"openSubject",value:function(){var e=this;this.showSubject.set(!0),setTimeout(function(){e._setFocus(e.refSubject.current),e.refSubject.current.selectEnd()},0)}},{key:"openCc",value:function(){var e=this;this.showCc.set(!0),setTimeout(function(){e._setFocus(e.refCc.current)},0)}},{key:"openBcc",value:function(){var e=this;this.showBcc.set(!0),setTimeout(function(){e._setFocus(e.refBcc.current)},0)}},{key:"focusTo",value:function(){this._setFocus(this.refTo.current)}},{key:"focusBody",value:function(){this._setFocus(this.refBody.current)}},{key:"_setFocus",value:function(e){e.isFocused.get()||e.focus()}},{key:"onClickSend",value:function(){this.sendEmail()}},{key:"sendEmail",value:function(){var e=this;this._composeHelper.prepForSend(this.message,at()(et.a.mark(function t(){return et.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return it.default.clearSelection(),e.isSending.set(!0),t.next=4,e.getPlugin().sendEmail(e.threadAttach,e.message);case 4:t.sent?e.close(!1,!1,!0):e.isSending.set(!1);case 6:case"end":return t.stop()}}},t)})))}},{key:"onDraftChanged",value:function(){this._composeHelper.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"getEmailData",value:function(){this.props;return{id:this.message.id,to:this.refTo.current.getTokens(),cc:this.refCc.current&&this.refCc.current.getTokens(),bcc:this.refBcc.current&&this.refBcc.current.getTokens(),subject:this.refSubject.current&&this.refSubject.current.getValue()||this.message.subject,decoded:this.refBody.current.getValue(),snippet:this.refBody.current.getTextValue()}}},{key:"onChangeFrom",value:function(){var e=this;at()(et.a.mark(function t(){var a,i;return et.a.wrap(function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return a=e.refFrom.current.value,t.next=3,e._composeHelper.changeFrom(a);case 3:i=t.sent,e.threadAttach=i.threadAttach,e.message=i.message,e.refBody.current.setValue(i.body);case 7:case"end":return t.stop()}}},t)}))()}},{key:"getSendingAccounts",value:function(){var e,t=this.getPlugin();return this.message.inReplyTo&&(e=this.threadAttach.getField("accountID")),t.getSendingAccounts(e)}},{key:"insertLinkHotkey",value:function(){this.refBody.current.hasFocus()&&this.insertLink()}},{key:"insertLink",value:function(){var e=it.default.getSelectedText(),t=this.refLink.current.getElement();this.savedSel=it.default.getSelectionRange(),d.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.refBody.current.focus(),it.default.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refBody.current.insertNode(t)}},{key:"render",value:function(){var e=this.state,t=this.props,a=this.to,i=this.cc,n="(no subject)"===this.message.subject?"":this.message.subject,r=this.state.showCc||this.cc&&this.cc.length>0,s=8+(r?0:28)+(e.showBcc?0:34),l=this.message.from.email,d=e.fromAccounts.slice(0),c=e.fromAccounts.length>1,h=o.default.classNames("emailCompose validDropTarget flexbox flexvert",t.className);d.remove(l),d.unshift(l);var f=o.default.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return A.a.createElement("div",{className:h,style:{},ref:this.refContainer,onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},A.a.createElement("div",{className:f},A.a.createElement("div",{className:"composeButtons"},!e.showSubject&&A.a.createElement(K.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!r&&A.a.createElement(K.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&A.a.createElement(K.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),A.a.createElement(Y.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:this.refTo,tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:s},onChange:this.onDraftChanged,onEscape:t.onEscape}),r&&A.a.createElement(Y.a,{height:50,floatingText:"Cc",display:"block",ref:this.refCc,tokens:i.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&A.a.createElement(Y.a,{height:50,floatingText:"Bcc",display:"block",ref:this.refBcc,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&A.a.createElement(Y.a,{height:50,floatingText:"Subject",display:"block",ref:this.refSubject,value:n,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),c&&A.a.createElement("div",{className:"composeFrom"},A.a.createElement("span",null,"From"),A.a.createElement("select",{ref:this.refFrom,onChange:this.onChangeFrom},d.map(function(e){return A.a.createElement("option",{key:e,value:e},e)})))),A.a.createElement(lt.a,{className:"emailComposeTextarea c-border-heavy f1",ref:this.refBody,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending,richText:!0}),A.a.createElement(ot,{onUpdate:this.onAttachUpdated,threadAttach:this.threadAttach,message:this.message,editable:!0}),A.a.createElement("div",{className:"composeFooter"},A.a.createElement(K.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),A.a.createElement(K.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),A.a.createElement(K.a,{className:"insertLink",icon:"icon-link",ref:this.refLink,iconSize:20,marginLeft:8,onClick:this.insertLink,tooltip:"Insert Link"}),this.state.isSending?A.a.createElement(ae.a,{inline:!0,color:u.a.ColorBrand,style:{height:32,lineHeight:"32px",fontWeight:"bold"}},"Sending..."):A.a.createElement(K.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:!this.state.isSending&&this.onClickSend},e.isSending?"Sending...":"SEND")),A.a.createElement("input",{type:"file",ref:this.refPicker,className:"hidden",multiple:!0}),e.isDragOver&&A.a.createElement("div",{className:"dropNotice flexbox flex-center"},A.a.createElement("div",{className:"dropBg absFull"}),A.a.createElement("div",{className:"f1 center"},A.a.createElement("div",{className:"icon-attach_file"}),A.a.createElement("div",null,"Drop to attach"))))}}]),t}(U.a),ht=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.listenToDispatcher("windowResize"),this.refCompose=A.a.createRef()}},{key:"getState",value:function(){var e=h.a.windowWidth(),t=h.a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*e,800),500),e-20),height:Math.min(Math.max(Math.min(.4*t,800),500),t)}}},{key:"close",value:function(){this.refCompose.current.close(!0,!1,!0)}},{key:"onClose",value:function(){k.a.fireEvent("EmailCompose","onClosed",[]),d.default.menus.closeComposeEmail(this.props.threadAttach,this.props.message)}},{key:"onMouseDown",value:function(){P.a.reset()}},{key:"onMount",value:function(){var e=this.refCompose.current;e.focusTo(),requestAnimationFrame(function(){e.focusTo()})}},{key:"render",value:function(){var e=this.props,t=e.threadAttach,a=e.message,i=this.state,n=i.width,r=i.height;return A.a.createElement(He,{title:"New Message",canMinimize:!0,canMaximize:!0,width:n,height:r,close:this.close,className:"composeEmail flexbox flexvert",onMouseDown:this.onMouseDown},A.a.createElement(ct,{className:"f1",threadAttach:t,message:a,showSubject:!0,onClose:this.onClose,ref:this.refCompose,focus:"to"}))}}]),t}(U.a),ft=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{emailComposes:d.default.menus.emailComposeStack}}},{key:"render",value:function(){for(var e=0,t=this.state,a=[],i=0;i<t.emailComposes.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.emailComposes[i];a.push(A.a.createElement(ht,{key:n.draftMsg.id,threadAttach:n.attach,message:n.draftMsg}))}return A.a.createElement("div",{className:"emailComposes flexbox"},a)}}]),t}(U.a),pt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({addingItem:void 0})}},{key:"onMount",value:function(){var e=this.props.pane,t=e.getOverview(),a=t.scrollElement=this.refs.overviewScroller.getScrollElement(),i=t.contentElement=this.refs.overviewContentElement.getElement();e.getInfiniteList(!0).setupScroller(a,i),o.default.setupClick(a,e.getOverview(),e.getOverview().onTap)}},{key:"getState",value:function(){var e=this.props.pane,t=e.getOverview(),a={accounts:d.default.settings.syncAccounts,isVisible:t.isVisible,activeDoc:e.document,showDocuments:e.supportsDocuments,zoomed:e.item,viewMode:e.viewState};return a.cursor=t.cursor,a.isAtRoot=e.getItem()===e.getRootItem(),e.type===u.a.PaneMode.Gmail&&(a.overviewAccount=e._overviewAccount),a}},{key:"getPane",value:function(){return this.props.pane}},{key:"renderCell",value:function(e,t){var a=this.props.pane;return A.a.createElement(Pe,{key:e,list:a.getInfiniteList(!0),pane:a,cell:t,overview:!0})}},{key:"sizeAtIndex",value:function(e){var t=this.props.pane;return t.headersArr[e].sizeInPane(t,e,!0)}},{key:"onClickAddTop",value:function(){this.addingItem.set("top")}},{key:"onClickAll",value:function(){var e=this.props.pane;e.type!==u.a.PaneMode.Task||e.isViewItems()||e.setViewMode(u.a.TaskViewMode.Outline),e.zoomOut(e.getRootItem())}},{key:"onAddItem",value:function(e){var t=this.refs.inputAddItem.getValue();this.addingItem.set(void 0);var a=this.props.pane,i=a.getRootItem(),n="top"===e?0:i.numItems(),r=a.addProject(n,t,!0);setTimeout(function(){a.getItem()!==i&&a.zoomOut(i),a.scrollItemToTop(r,u.a.ScrollDuration.Default)},0)}},{key:"onClickCancel",value:function(){this.addingItem.set(void 0)}},{key:"onClickGmailAccount",value:function(e){var t=this.props.pane;t.setOverviewAccount(e),t.zoomIn(t.getDefaultDisplayItem(e))}},{key:"renderAddProjectInput",value:function(e){var t=this.onAddItem.bind(this,e),a=this.onClickCancel.bind(this,e);return A.a.createElement("div",{className:"addProjectInput"},A.a.createElement(Y.a,{ref:"inputAddItem",focused:!0,height:32,placeholder:"Name project",onEscape:a,onEnter:t}),A.a.createElement("div",{className:"addProjectButtons"},A.a.createElement(K.a,{primary:!0,onClick:t},"Add Project"),A.a.createElement(K.a,{onClick:a},"Cancel")))}},{key:"renderShowAllButton",value:function(e){return A.a.createElement(K.a,{className:"overviewHeaderButton",icon:"icon-visibility",height:30,iconSize:15,onClick:this.onClickAll,enabled:!this.state.isAtRoot||!this.props.pane.isViewItems()},"Show all "+e)}},{key:"renderDocuments",value:function(){if(this.state.showDocuments)return A.a.createElement("div",{className:"paneOverviewTop c-border",style:{color:"c-foreground"}},A.a.createElement(K.a,{color:"c-foreground-very-faded c-color-hover",onClick:this.props.onClickViewDocuments},"Documents"),A.a.createElement("span",{className:"c-foreground-very-faded c-color-hover",style:{lineHeight:"36px",verticalAlign:"top"}},">"),A.a.createElement(K.a,{color:"c-foreground",onClick:this.props.onClickViewDocuments},"Overview"))}},{key:"renderHeader",value:function(){var e=this.state,t=this.props.pane;switch(t.type){case u.a.PaneMode.Task:var a=t.isViewOutline()||t.isViewProject();return A.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),a&&"top"!==e.addingItem&&A.a.createElement(K.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddTop},"Add project"),a&&"top"===e.addingItem&&this.renderAddProjectInput("top"),A.a.createElement("hr",null));case u.a.PaneMode.Archived:return A.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),A.a.createElement("hr",null));case u.a.PaneMode.Drive:return A.a.createElement("div",{className:"overviewHeader"},A.a.createElement("div",{className:"overviewHeaderTitle"}),this.renderShowAllButton("folders"),A.a.createElement("hr",null));case u.a.PaneMode.Gmail:var i=d.default.pluginManager.getPluginGmail(),n=e.overviewAccount,r=i.getSyncAccounts(),s=o.default.classNames("overviewHeader",{"c-border":r.length>1});return A.a.createElement("div",{className:s},r.length>1&&r.map(function(e){return A.a.createElement(K.a,{className:"overviewHeaderButton",key:e,selected:e===n,height:30,onClick:this.onClickGmailAccount.bind(this,e)},e)}.bind(this)))}}},{key:"render",value:function(){this.state;var e=this.props.pane,t=o.default.classNames("paneOverview flexbox flexvert",e.type+"Overview"),a=o.default.classNames(this.props.className,"paneOverviewScroller scroller f1",{transition:!d.default.PaneManager.isResizingPane}),i=this.renderHeader();return A.a.createElement("div",{className:"paneOverviewOutside f1 flexbox flexvert","data-moo-id":this.getUniqueID()},this.renderDocuments(),A.a.createElement(be.a,{className:a,ref:"overviewScroller",showScrollbars:!0},A.a.createElement("div",{className:t,ref:"overview"},i,A.a.createElement(Z,{owner:e.getInfiniteList(!0),pane:e,overview:!0,renderCell:this.renderCell,contentClass:"overviewList noSelect f1 mat-list",ref:"overviewContentElement"}))))}}]),t}(U.a),gt=a(64),mt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({isEditing:""===this.props.doc.text.get()})}},{key:"getState",value:function(){var e=this.props.doc;return{text:e.text,contentPreview:e.contentPreview,isLocal:e.isLocalOnly(),isSyncing:e.isSyncing,docTimeText:gt.a.toHumanText(new Date(e.dateModified.get()),!0),docTime:e.dateModified}}},{key:"onBeforeChanged",value:function(e,t){e.text&&!t.text&&e.isEditing&&(e.isEditing=!1,this.isEditing.set(!1,!1))}},{key:"onEscape",value:function(){var e=!0,t=this.props.doc;t.needsSave&&(t.getAllItems().length<=1?t.delete():(e=!1,d.default.toasts.pushMessage("You must name this document before it can sync")));e&&this.isEditing.set(!1)}},{key:"onFinishEdit",value:function(){c.a.renameDocument(this.props.doc,this.refs.inputAddDocument.getValue()),this.isEditing.set(!1)}},{key:"onClick",value:function(){this.props.onSelectDocument(this.props.doc)}},{key:"onClickOverview",value:function(){this.props.onSelectDocument(this.props.doc,!0)}},{key:"onRightClick",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"onClickRename",value:function(){this.isEditing.set(!0)}},{key:"onClickShare",value:function(){d.default.menus.openModal(u.a.Modals.ShareDoc,{doc:this.props.doc})}},{key:"onClickDelete",value:function(){if(c.a.getDocumentsArray().length>1){var e=this.props,t=(e.pane,e.doc);d.default.menus.confirm("Are you sure you want to delete ".concat(t.text.get(),"?"),function(e){e&&t.delete()})}else d.default.menus.alert({text:"Deleting the last document is not supported.",actionText:"OKAY"})}},{key:"onClickRevisionHistory",value:function(){d.default.menus.openModal(u.a.Modals.Backups,{doc:this.props.doc})}},{key:"renderContextMenu",value:function(e){var t=this.props.doc,a=t.isAdmin(),i=t.isLocalOnly();return C.createElement(z.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:e.element},a&&C.createElement(C.Fragment,null,C.createElement(q.a,{onClick:this.onClickRename},"Rename"),!i&&C.createElement(q.a,{onClick:this.onClickShare},"Share"),!i&&C.createElement(q.a,{onClick:this.onClickRevisionHistory},"Revision History"),C.createElement("hr",null),C.createElement(q.a,{onClick:this.onClickDelete},"Delete")),!a&&C.createElement("div",{style:{padding:"12px 16px"}},"Please request Admin privelege on this document to modify it."))}},{key:"render",value:function(){var e=this.props,t=e.isSelected,a=e.pane,i=this.state,n=i.text,r=i.isEditing,s=i.contentPreview,l=i.docTimeText,u=i.isLocal,d=i.isSyncing,c=o.default.classNames("paneSidebarDocument flexbox borderBottom c-background c-border noSelect",{borderLeft:a.rect.get()&&a.rect.get().isFirst},{selected:t}),h=o.default.classNames("documentStatusIcon c-foreground-faded",{"icon-drive-file":u},{"icon-cloud_upload":!u&&d},{"icon-cloud_done":!u&&!d});return C.createElement(W.a,{className:c,onClick:this.onClick,onRightClick:this.onRightClick},t&&C.createElement("div",{className:"selectedIndicator c-border-blue"}),r?C.createElement(Y.a,{ref:"inputAddDocument",focused:!0,height:32,placeholder:"Name document",buttonText:"SAVE",value:n,onButtonClick:this.onFinishEdit,onEscape:this.onEscape}):C.createElement(C.Fragment,null,C.createElement("div",{className:"mw0 f1"},C.createElement("div",{className:"documentName f1 bold"},n),C.createElement("div",{className:"documentExtra c-foreground-faded"},s),C.createElement("div",{className:"documentExtra documentTime c-foreground-faded"},l)),C.createElement("div",null,C.createElement(K.a,{display:"block",className:"buttonDocumentOverview",icon:"icon-format_list_bulleted",onClick:this.onClickOverview}),C.createElement("div",{style:{width:36,height:36,lineHeight:"36px"},className:h,onClick:this.onClickOverview}))))}}]),t}(U.a),vt=a(65),yt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){}},{key:"getState",value:function(){var e=this.props.docInfo;return{text:e.text,encryptionSentinel:e.encryptionSentinel}}},{key:"onClick",value:function(){var e=this,t=this.props.docInfo;d.default.menus.openModal(u.a.Modals.EnterCode,{isPassword:!0,text:"Please enter the password for this document: ".concat(this.state.text),onSelect:function(a){return new Promise(function(i,n){a&&d.default.crypto.addKey({name:t.id,password:a,sentinelSalt:t.id}).then(function(a){t.encryptionSentinel===a.sentinel?(i(),d.default.settings.addEncryptionKey(t.id,a.key),vt.a.loadSingleDocument(t).then(function(t){t&&e.props.onSelectDocument(t)})):(d.default.crypto.removeKey(t.id),n("The password was invalid. Please try again."))})})}})}},{key:"onRightClick",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenu,element:e.target})}},{key:"onClickDelete",value:function(){d.default.menus.alert({text:"Deleting encrypted documents is not supported yet. Please contact support if this is important to you.",actionText:"OKAY"})}},{key:"renderContextMenu",value:function(e){return C.createElement(z.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:e.element},C.createElement(q.a,{onClick:this.onClickDelete},"Delete"))}},{key:"render",value:function(){var e=this.state.text,t=o.default.classNames("paneSidebarDocument flexbox borderBottom borderLeft c-background c-border noSelect");return C.createElement(W.a,{className:t,onClick:this.onClick,onRightClick:this.onRightClick},C.createElement("div",{className:"mw0 f1"},C.createElement("div",{className:"documentName f1 bold"},e),C.createElement("div",{className:"documentExtra c-foreground-faded"},"Encrypted")))}}]),t}(U.a),kt=a(66),_t=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=this.props.pane,t={rect:e.rect,_documents:c.a.documentsArray,documentsEncrypted:c.a.documentsEncryptedArray,paneDoc:e.document,documentSortMode:e.documentSortMode};return t.documents=c.a.documentsArray.get().slice().sort(kt.a.getCompareFn(e.documentSortMode.get())),t}},{key:"addDocument",value:function(e){var t=e?c.a.getBackingLocal():c.a.getBackingRemote(),a=c.a.addEmptyDocument("",t,!0);this.props.onSelectDocument(a,!1)}},{key:"onMouseDownSort",value:function(e){d.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:e.target})}},{key:"setSortMode",value:function(e){this.props.pane.documentSortMode.set(e)}},{key:"onClickAdd",value:function(e){h.a.supportLocalFiles()?d.default.menus.openContextMenu({fn:this.renderContextMenuAdd,element:e.target}):this.addDocument(!1)}},{key:"renderContextMenuAdd",value:function(e){return A.a.createElement(z.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},A.a.createElement(q.a,{icon:"icon-drive-file",onClick:this.addDocument.bind(this,!0),tooltip:"File on your computer - does not sync with the server"},"New local file"),A.a.createElement(q.a,{icon:"icon-cloud_upload",onClick:this.addDocument.bind(this,!1),tooltip:"File synced with the server and other devices"},"New synced file"))}},{key:"renderContextMenuSort",value:function(e){var t=this,a=Object.keys(u.a.DocumentSortMode);return A.a.createElement(z.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:e.element,maxHeight:400},A.a.createElement(j.a,{topHeader:!0},"Sort mode"),a.map(function(e){return A.a.createElement(q.a,{key:e,active:t.state.documentSortMode===e,onClick:t.setSortMode.bind(t,e)},e)}))}},{key:"renderDocument",value:function(e){return A.a.createElement(mt,{key:e.id,doc:e,pane:this.props.pane,isSelected:e===this.state.paneDoc,onSelectDocument:this.props.onSelectDocument})}},{key:"renderDocumentEncrypted",value:function(e){return A.a.createElement(yt,{key:e.id,docInfo:e,onSelectDocument:this.props.onSelectDocument})}},{key:"render",value:function(){var e=this.state;return A.a.createElement("div",{className:"paneSidebarDocuments f1"},A.a.createElement("div",{className:"paneSidebarDocumentsButtons flexbox"},A.a.createElement(K.a,{fontSize:17,color:"c-foreground",onClick:this.props.onClickViewDocuments},"Documents"),A.a.createElement("div",{className:"flex-spacer"}),A.a.createElement(K.a,{icon:"icon-add",onClick:this.onClickAdd}),A.a.createElement(K.a,{icon:"icon-filter_list",fontSize:17,style:{marginRight:6},onMouseDown:this.onMouseDownSort})),A.a.createElement("div",{className:"borderTop c-border"},e.documentsEncrypted.map(this.renderDocumentEncrypted),e.documents.map(this.renderDocument)))}}]),t}(U.a),St=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=this.props.pane;return{rect:e.rect,activeDoc:e.document,isShowingContents:!e.supportsDocuments||e.overview.isShowingContents}}},{key:"getPane",value:function(){return this.props.pane}},{key:"onClickViewDocuments",value:function(){this.props.pane.overview.setShowingContents(!1)}},{key:"onSelectDocument",value:function(e,t){this.props.pane.setDocument(e),t&&this.props.pane.overview.setShowingContents(!0)}},{key:"render",value:function(){var e=this.state,t=e.rect,a=e.isShowingContents,i=this.props,n=i.className,r=i.pane,s=o.default.classNames("paneOverviewWrapper flexbox flexvert",n),l=rt()({width:u.a.OverviewWidth},h.a.transform.react,"translate("+(t.left-u.a.OverviewWidth)+"px,0)");return A.a.createElement("div",{className:s,style:l},a&&A.a.createElement(pt,{onClickViewDocuments:this.onClickViewDocuments,pane:r}),!a&&A.a.createElement(_t,{pane:r,onClickViewDocuments:this.onClickViewDocuments,onSelectDocument:this.onSelectDocument}))}}]),t}(U.a),Pt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this._initializedFrame=!1,this.createObservables({hovered:!1}),this.refFrame=A.a.createRef(),this.refMessage=A.a.createRef()}},{key:"onMount",value:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()}},{key:"_initializeFrame",value:function(){if(!this._initializedFrame){var e=this.refFrame.current;if(e){this._initializedFrame=!0;var t=e.contentWindow.document;h.a.supportBlobURLIFrame||(t.open(),t.write(this.props.message.blob),t.close())}}}},{key:"getState",value:function(){var e=this.props.message;return{responseMode:e.responseMode,height:e.height,width:e.width}}},{key:"onAfterChanged",value:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))}},{key:"checkIsHovered",value:function(){var e=P.a.getMousePos(),t=document.elementFromPoint(e.x,e.y);t&&(o.default.findParent(t,"emailMessageWrapper")===this.refMessage.current&&this.hovered.set(!0))}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current,t=o.default.findParent(e,"fancyScrollContent"),a=0;a=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,o.default.scrollTo(0,a,u.a.ScrollDuration.Snap,t)}},{key:"onClickHeader",value:function(){this.props.toggleExpanded()}},{key:"onMouseEnterMessage",value:function(){this.hovered.set(!0)}},{key:"onMouseLeaveMessage",value:function(){this.hovered.set(!1)}},{key:"onClickReply",value:function(e){d.default.EmailPreview.setMessageResponseMode(this.props.message.id,u.a.EmailResponseMode.Reply),e.stopPropagation()}},{key:"onClickReplyAll",value:function(e){d.default.EmailPreview.setMessageResponseMode(this.props.message.id,u.a.EmailResponseMode.ReplyAll),e.stopPropagation()}},{key:"onClickForward",value:function(e){d.default.EmailPreview.setMessageResponseMode(this.props.message.id,u.a.EmailResponseMode.Forward),e.stopPropagation()}},{key:"onClickReport",value:function(){d.default.menus.openModal(u.a.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})}},{key:"_generateParticipantText",value:function(e){return e.text?e.text:e.email}},{key:"isExpanded",value:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==u.a.EmailResponseMode.None}},{key:"openEmailDetails",value:function(e){var t=this.refs.messageHeaderText;d.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()}},{key:"render",value:function(){var e,t=this.props,a=this.state,i=t.message,n=this.isExpanded(),r={height:a.height},s=d.default.International.formatDate(i.date,u.a.DFormat.MonthDay),l=d.default.International.formatDate(i.date,u.a.DFormat.ShortTime),c=t.isLastMessage||a.responseMode!==u.a.EmailResponseMode.None,f=h.a.windowWidth()>1080&&!o.default.isDemoMode(),p={},g={};n||(p.opacity=a.hovered?"1":"0"),f&&(g.opacity=a.hovered?"1":"0");var m,v,y={cursor:n?"pointer":null};if(m=A.a.createElement("span",{className:"from",onClick:n?this.openEmailDetails:void 0,style:y},this._generateParticipantText(i.from)),n){var k=(i.to?i.to:[]).concat(i.cc?i.cc:[]).map(this._generateParticipantText).join(", ");v=A.a.createElement("span",{className:"to c-foreground-faded",onClick:this.openEmailDetails,style:{cursor:"pointer"}},A.a.createElement("i",{className:"icon-long-arrow-right"}),A.a.createElement("span",null,k))}else v=A.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:i.snippet}});var _,S=A.a.createElement("span",{className:"emailDate c-foreground-faded"},A.a.createElement("div",{className:"emailDateDate"},s),A.a.createElement("div",{className:"emailDateTime"},l));e=A.a.createElement(te.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},A.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},m,v),A.a.createElement("span",{className:"headerButtons",style:p},f&&A.a.createElement(K.a,{height:40,className:"reportEmail",style:g,onClick:this.onClickReport},"Report Problem"),A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),S),_=h.a.supportBlobURLIFrame?A.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:i.blobURL,style:r,scrolling:"no"}):A.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:r});var P=o.default.classNames("emailMessage emailBox c-border",{collapsed:!n},{prevCollapsed:!t.prevExpanded},{nextCollapsed:!t.nextExpanded}),w=o.default.classNames("emailMessageWrapper",{replying:a.responseMode!==u.a.EmailResponseMode.None});return A.a.createElement("div",{className:w,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:this.refMessage},A.a.createElement("div",{className:P},e,n&&A.a.createElement("div",{className:"messageContent",style:{}},_,A.a.createElement(ot,{threadAttach:t.threadAttach,message:t.message,editable:!1}))),c&&A.a.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},A.a.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:a.responseMode===u.a.EmailResponseMode.Reply,padding:24}),A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:a.responseMode===u.a.EmailResponseMode.ReplyAll,padding:24}),A.a.createElement(K.a,{iconSize:16,width:40,height:40,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:a.responseMode===u.a.EmailResponseMode.Forward,padding:24}))))}}]),t}(U.a),wt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.refMessage=A.a.createRef(),this.refCompose=A.a.createRef()}},{key:"componentDidUpdate",value:function(){this._updateFocus()}},{key:"onMount",value:function(){this.refMessage.current&&(this.scrollIntoView(),this._updateFocus())}},{key:"getState",value:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}}},{key:"onAfterChanged",value:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current;if(e){var t=o.default.findParent(e,"fancyScrollContent"),a=e.offsetTop+e.offsetHeight-t.clientHeight+16;o.default.scrollTo(0,a,u.a.ScrollDuration.Default,t)}}},{key:"_updateFocus",value:function(){var e=this.state.responseMode;switch(e){case u.a.EmailResponseMode.None:break;case u.a.EmailResponseMode.Reply:case u.a.EmailResponseMode.ReplyAll:this.focusBody();break;case u.a.EmailResponseMode.Forward:case u.a.EmailResponseMode.Compose:this.focusTo();break;default:try{o.default.PAssert(624,!1,"Unknown response mode for reply box",e)}catch(t){o.default.reportError(t)}}}},{key:"focusTo",value:function(){this.refCompose.current.focusTo()}},{key:"focusBody",value:function(){this.refCompose.current.focusBody()}},{key:"onClose",value:function(){d.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,u.a.EmailResponseMode.None)}},{key:"render",value:function(){return this.state.responseMode!==u.a.EmailResponseMode.None?A.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:this.refMessage},A.a.createElement(ct,{threadAttach:this.props.threadAttach,message:this.props.message,ref:this.refCompose,onClose:this.onClose})):null}}]),t}(U.a),It=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),o.default.isDemoMode()&&(o.default.reactEmailPreview=this)}},{key:"onBeforeChanged",value:function(e,t){if(e.threadAttach!==t.threadAttach){var a=e.messages,i=[];if(a.length>0)for(var n=0,r=this.getLastMessage(e),s=0;s<a.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=a[s];(o===r||this.isMessageUnread(o))&&i.push(o.id)}this.expandedMessages.set(i,!1),e.expandedMessages=i}}},{key:"getState",value:function(){return{rect:this.props.pane.rect,pane:d.default.EmailPreview.openOnPane,isLoading:d.default.EmailPreview.isLoading,threadAttach:d.default.EmailPreview.threadAttach,threadItem:d.default.EmailPreview.threadItem,messageIDs:d.default.EmailPreview.messageIDs,messages:d.default.EmailPreview.getMessages(),errorMessage:d.default.EmailPreview.errorMessage,messagesLoaded:d.default.EmailPreview.messagesLoaded}}},{key:"getLastMessage",value:function(e){return e=e||this.state,d.default.pluginManager.getPluginGmail().getLastMessage(e.threadAttach)}},{key:"onEscapeKey",value:function(){d.default.EmailPreview.close()}},{key:"isMessageDraft",value:function(e){return e.labelIds.indexOf("DRAFT")>=0}},{key:"isMessageUnread",value:function(e){return e.labelIds.indexOf("UNREAD")>=0}},{key:"onClickClose",value:function(){d.default.EmailPreview.close()}},{key:"onClickArchive",value:function(){this.props.pane.archiveItem(!0,this.state.threadItem)}},{key:"onClickLabel",value:function(e){this.props.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickMove",value:function(e){this.props.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickSchedule",value:function(e){this.props.pane.autocompleteSchedule({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickSnooze",value:function(e){var t=this.state.threadAttach.getField("accountID");this.props.pane.autocompleteSnooze({elementDisplay:e.target,item:this.state.threadItem},t)}},{key:"onClickUnread",value:function(){this.props.pane.markItemRead(!1,this.state.threadItem)}},{key:"onClickDelete",value:function(){var e,t=this.state,a=this.props.pane,i=d.default.pluginManager.getPluginGmail();if(a.type===u.a.PaneMode.Gmail)a.deleteSelected(i.isGmailItem,!0);else if(P.a.getStartItem()===t.threadItem&&(e=a.indexOfPrevVMLI(P.a.getStartIndex(),!0,!0)),t.threadItem.deleteSelf(u.a.ChangeType.Local),d.default.EmailPreview.reset(),e){var n=a.itemAtIndex(e);if(n){var r=n.getParsedText().length;P.a.selectIndex(e,r)}}}},{key:"onClickPrint",value:function(){var e=d.default.pluginManager.getPluginGmail().createPrintURLForThread(this.state.threadAttach);o.default.printPage(e)}},{key:"onClickViewInGmail",value:function(){var e=d.default.pluginManager.getPluginGmail().createURLForThread(this.state.threadAttach);o.default.openUrl(e)}},{key:"onClickReply",value:function(e){var t=this.getLastMessage();d.default.EmailPreview.setMessageResponseMode(t.id,u.a.EmailResponseMode.Reply)}},{key:"onClickReplyAll",value:function(e){var t=this.getLastMessage();d.default.EmailPreview.setMessageResponseMode(t.id,u.a.EmailResponseMode.ReplyAll)}},{key:"onClickForward",value:function(e){var t=this.getLastMessage();d.default.EmailPreview.setMessageResponseMode(t.id,u.a.EmailResponseMode.Forward)}},{key:"toggleExpanded",value:function(e){var t=this.state.messages,a=t[e];this.expandedMessages.indexOf(a.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(a.id):this.expandedMessages.push(a.id)}},{key:"onClickDown",value:function(){this.props.pane.keyMoveDown()}},{key:"onClickUp",value:function(){this.props.pane.keyMoveUp()}},{key:"onClickMobileReply",value:function(){d.default.menus.openContextMenu({fn:this.renderContextMenuReply})}},{key:"renderContextMenuReply",value:function(e){return A.a.createElement(z.a,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:e.element,position:"bottom"},A.a.createElement(q.a,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),A.a.createElement(q.a,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),A.a.createElement(q.a,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))}},{key:"render",value:function(){var e,t=this.state,a=t.threadAttach,i=t.messages,n=t.rect,r=t.isLoading,s=t.errorMessage,l=t.messagesLoaded;this.props.pane.type,u.a.PaneMode.Gmail;if((i=i||[]).length>0){for(var c=0,f=i[0],p=(a.getPlugin().getDisplayParticipants(a),f.subject||"(no subject)"),g=[],m=this.expandedMessages.get(),v=this.getLastMessage(),y=0;y<i.length;++y){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var k,_=i[y];if(this.isMessageDraft(_)){try{o.default.PAssert(349,y>0,"Should never have a draft as the first message in the list")}catch(T){o.default.reportError(T)}var S=i[y-1];k=A.a.createElement(wt,{key:S.id+"_draft",threadAttach:a,message:_,inReplyToMessage:S})}else{var P=m.indexOf(_.id)>=0,w=i[y-1],I=i[y+1],b=0===y||m.indexOf(w.id)>=0||this.isMessageDraft(w),D=y>=i.length-2||m.indexOf(I.id)>=0||this.isMessageDraft(I);k=A.a.createElement(Pt,{key:_.id,index:y,threadAttach:a,message:_,toggleExpanded:this.toggleExpanded.bind(this,y),expanded:P,isLastMessage:_===v,prevExpanded:b,nextExpanded:D})}g.push(k)}e=A.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:l?1:0}},g)}else e=r?A.a.createElement(ae.a,{center:!0},"Loading messages..."):s?A.a.createElement("div",{className:"noMessages center"},s):A.a.createElement("div",{className:"noMessages center"},"No conversation selected");var E=o.default.classNames("emailPreview c-background c-border",{noClick:d.default.PaneManager.isResizingPane},{transition:!d.default.PaneManager.isResizingPane}),C=rt()({width:n.widthExpanded},h.a.transform.react,"translate("+(n.left+n.width)+"px,0)"),M=o.default.classNames("emailPreviewTop c-foreground c-background c-border-light",{hasBorder:i.length>0});return A.a.createElement("div",{className:E,style:C},A.a.createElement("div",{className:M},i.length>0&&A.a.createElement(A.a.Fragment,null,A.a.createElement("div",{className:"emailHeaderRow"},A.a.createElement("div",{className:"emailButtons"},A.a.createElement(K.a,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),A.a.createElement(K.a,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),A.a.createElement(K.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),A.a.createElement(K.a,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),A.a.createElement(K.a,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),A.a.createElement(K.a,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),A.a.createElement(K.a,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!h.a.app&&A.a.createElement(K.a,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),A.a.createElement(K.a,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),A.a.createElement("div",{className:"emailHeaderRow emailSubject"},p)),A.a.createElement(K.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,onClick:this.onClickClose,tooltip:"Close"})),A.a.createElement(be.a,{className:"emailMessagesScroller"},e))}}]),t}(U.a),bt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{toasts:d.default.toasts.queue}}},{key:"render",value:function(){for(var e=0,t=this.state,a=[],i=0;i<t.toasts.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.toasts[i];o.default.classNames("toast noSelect",{hasAction:!!n.actionText},{big:n.isBig});a.push(A.a.createElement(we,{key:n.id,toast:n}))}return A.a.createElement(B.CSSTransitionGroup,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},a)}}]),t}(U.a),Dt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{caption:o.default.AScript.demoCaption}}},{key:"render",value:function(){var e=this.state.caption;if(void 0!==e){var t=o.default.classNames("demoCaption",{center:e.center},{light:e.light});return A.a.createElement("div",{className:t,style:{opacity:e.opacity}},A.a.createElement("div",{className:"demoCaptionText",dangerouslySetInnerHTML:{__html:e.text}}))}return null}}]),t}(U.a),Et=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"close",value:function(){d.default.settings.closeHelp("firstRunIntro")}},{key:"showHelp",value:function(){this.close();var e=o.default.createPath("help/basics");o.default.openUrl(e)}},{key:"render",value:function(){return A.a.createElement("div",{id:"introPopup",className:"intro"},A.a.createElement(He,{title:"Introduction",close:this.close},A.a.createElement("div",{className:"helpSection c-border-heavy"},A.a.createElement("div",{className:"helpVideo"},A.a.createElement("iframe",{src:"https://www.youtube.com/embed/"+u.a.IntroVideoID,frameBorder:"0",allowFullScreen:!0}))),A.a.createElement("div",{id:"introOpenHelp"},A.a.createElement(K.a,{primary:!0,raised:!0,onClick:this.showHelp},"How to get started"))))}}]),t}(U.a),Ct=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.listenToDispatcher("windowResize")}},{key:"getState",value:function(){var e=this.updatePosition();return{left:e.left,top:e.top}}},{key:"onMount",value:function(){this.updateState()}},{key:"updatePosition",value:function(){var e,t=this.props.tip,a=document.documentElement.getBoundingClientRect(),i=this.refs.element;if(t.element)e=t.element.getBoundingClientRect();else try{o.default.PAssert(575,!1,"Adjust bounds had no valid tip for determining an offset",t)}catch(h){o.default.reportError(h)}if(e){if(i){var n,r,s=o.default.width(i),l=o.default.height(i),u=e.left+e.width/2-s/2,c=t&&t.offset;return t&&(t.onRight||o.default.findParentID(t.element,"desktopMenu",8))&&(r=!0,c={left:8+d.default.DesktopUI.getSidebarWidth()+((c?c.left:0)||0)}),n=r?e.top+(e.height-l)/2:t&&t.above||e.bottom+l>a.bottom?e.top-l:e.bottom,c?(c.x?u+=c.x:c.right?u=a.right-s-c.right:c.left&&(u=c.left),c.y?n+=c.y:c.top&&(n+=c.top)):t&&t.above?n-=5:n+=5,u+s>a.right?u=a.right-s-4:u<0&&(u=4),n<0&&(n=4),{left:u=Math.round(u),top:n=Math.round(n)}}return{left:e.left,top:e.top}}}},{key:"onClick",value:function(){d.default.tooltip.hideSticky(this.props.tip.text)}},{key:"render",value:function(){var e=this.state,t=this.props.tip,a=t.text+(t.hotkey?'<div class="tooltipHotkey">'+t.hotkey+"</div>":""),i=o.default.classNames("tooltip flexbox flexvert",{blue:t.blue},{sticky:t.sticky},{hasHotkey:t.hotkey},{noFormat:a.indexOf("<b>")<0},{arrowDirection:t.arrowDirection}),n=o.default.classNames("tooltipArrow c-tooltip c-shadow-popup",t.arrowClass),r={maxWidth:t.maxWidth};return r[h.a.transform.react]="translate3d("+e.left+"px,"+e.top+"px,0)",A.a.createElement("div",{className:i,style:r,onClick:this.onClick,ref:"element"},A.a.createElement("div",{className:n}),A.a.createElement("div",{className:"tooltipText c-tooltip c-shadow-popup",dangerouslySetInnerHTML:{__html:a}}))}}]),t}(U.a),At=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{tooltip:d.default.tooltip.tooltip,tooltipsSticky:d.default.tooltip.tooltipsSticky}}},{key:"render",value:function(){var e=this.state,t=e.tooltip?e.tooltipsSticky.concat(e.tooltip):e.tooltipsSticky;return t.length>0?A.a.createElement("div",{className:"tooltips"},t.map(function(e){return A.a.createElement(Ct,{key:e.text,tip:e})})):null}}]),t}(U.a),Mt=a(483),Tt=a(57),Lt=a(472),xt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){this.createObservables({numPanes:1,selectedIndex:0})}},{key:"getState",value:function(){var e=d.default.PaneManager;return{registeredPanes:Tt.a.activePaneTypes,numInactivePanes:Tt.a.numInactivePanes,totalWidth:e.totalWidth,hasPremiumFeatures:d.default.billingManager.hasPremiumFeaturesObservable,sidebarWidthObs:d.default.DesktopUI.sidebarWidth,sidebarWidth:d.default.DesktopUI.getSidebarWidth(),testBetaFeatures:d.default.settings.testBetaFeatures}}},{key:"onClickCreateBoard",value:function(){for(var e=0,t=d.default.PaneManager,a=[],i=0;i<this.state.numPanes;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.refs["config_"+i].getCreationProps(),r=n.pane,s=n.item,o=n.type;o?r=t.addPaneByButton(o):(r.setDocument(c.a.getDefaultDocument(),!0),s&&r.setItem(s),t.addPaneAtIndex(r,i,!1,!1)),a[i]=r}d.default.PaneUpdateBatcher.updateAllItems(!0,!0),t.notifyPanes(),P.a.setFocusedPane(a[0])}},{key:"onMouseDownPlaceholder",value:function(){this.numPanes.set(this.numPanes.get()+1)}},{key:"renderPanes",value:function(){for(var e=0,t=this.state,a=t.numPanes,i=[],n=0;n<a+1;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=n===a,s=r&&n>=u.a.PremiumMaxPanes&&!t.hasPremiumFeatures,l=s?"Go Premium to add more panes":r?"Add another pane":"Pane "+(n+1),d=o.default.classNames("c-bg-menu",{placeholder:r});i.push(A.a.createElement("div",{key:n},A.a.createElement("div",{className:"boardBuilderPaneTitle"},l),A.a.createElement("div",{className:"boardBuilderPane c-border"},!s&&A.a.createElement("div",{onMouseDownCapture:r?this.onMouseDownPlaceholder:void 0},t.testBetaFeatures?A.a.createElement(Lt.a,{className:d,pane:void 0,isAddPane:!0,ref:"config_"+n}):A.a.createElement(Mt.a,{className:d,showSearchZoom:!0,ref:"config_"+n,hidePremiumTypes:!0})),s&&A.a.createElement("div",{className:"paneConfigPremiumBlocked flexbox flexvert"},A.a.createElement("div",{className:"ib c-border-heavy"},"Using more than ",u.a.PremiumMaxPanes," panes on a board is a Premium feature")))))}return i}},{key:"render",value:function(){var e={left:this.state.sidebarWidth};return A.a.createElement("div",{id:"addPaneAreaWrapper",className:"flexbox flexvert flex-center",style:e},A.a.createElement("div",{className:"addPaneAreaDescription"},A.a.createElement("div",{className:"addPaneHeader center bold"},"Create a new board"),A.a.createElement("div",{className:"addPaneMessage c-foreground-light"},"Each Pane is a unique view on your data. Combine multiple panes together to customize your own Boards.")),A.a.createElement("div",{className:"addPaneArea"},A.a.createElement("div",{className:"boardCreatorPanes"},this.renderPanes()),A.a.createElement("div",{className:"createBoardArea center flexbox flexvert flex-center"},A.a.createElement(K.a,{raised:!0,primary:!0,onClick:this.onClickCreateBoard},"CREATE BOARD"))))}}]),t}(U.a),Rt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){var e=d.default.setup;return{loginStatus:e.loginStatus,popupClosedError:e.popupClosedError,shouldShowLogin:e.shouldShowLogin(),gapiFailedToLoad:e.gapiFailedToLoad,loggedOutByAuthFailure:e.loggedOutByAuthFailure}}},{key:"onClickLogin",value:function(){d.default.setup.userLogin()}},{key:"onClickLanding",value:function(e){o.default.hasClass(e.target,"link")&&o.default.openUrl("https://www.moo.do",e)}},{key:"onClickDownloadApp",value:function(){o.default.openUrl(h.a.getAppDownloadURL())}},{key:"onClickPrivacy",value:function(e){o.default.hasClass(e.target,"link")&&o.default.openUrl("https://www.moo.do/privacy/",e)}},{key:"render",value:function(){var e=this.state,t=e.popupClosedError,a=e.loggedOutByAuthFailure,i=d.default.setup;return A.a.createElement("div",{id:"setupWrapper",className:"flexbox flexvert"},A.a.createElement("div",{id:"setupInner"},A.a.createElement("div",{id:"loginInfo"},A.a.createElement("div",{id:"setupLogo"})),A.a.createElement("div",{id:"setupBox"},A.a.createElement("div",{id:"login"},A.a.createElement("div",{id:"loginArea"},A.a.createElement("div",{className:"loginButton google",onClick:this.onClickLogin}),A.a.createElement("div",{id:"learnButton",onClick:this.onClickLanding},"Learn more at ",A.a.createElement("b",{className:"link"},"https://moo.do"))),t&&A.a.createElement(A.a.Fragment,null,A.a.createElement("div",{className:"popupClosedError red"},t.message),t.message2&&A.a.createElement("div",{className:"popupClosedError"},t.message2),t.learnMore&&A.a.createElement("div",{className:"popupClosedError"},A.a.createElement("a",{target:"_blank",href:t.learnMore},"Learn more"))),a&&A.a.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),i.showDownload&&A.a.createElement("div",{className:"textInLine"},A.a.createElement("div",null,"or")),i.showDownload&&A.a.createElement("div",{id:"setupDownloadArea"},A.a.createElement("div",{className:"loginButton black",onClick:this.onClickDownloadApp},A.a.createElement("span",{className:h.a.getPlatformIcon()}),A.a.createElement("span",{className:"signInText"},i.downloadText)))))))}}]),t}(U.a),Ot=a(116);!function(e){e[e.PluginSelect=0]="PluginSelect",e[e.Encrypt=1]="Encrypt",e[e.ImportData=2]="ImportData"}(r||(r={}));var Ft,Nt,Bt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){var e=r.PluginSelect;this.createObservables({page:e,colorTheme:u.a.ColorTheme.Light,errorGapiImport:"",modal:void 0,errorEncrypt:""}),Je.a.ensureGapi(),l.a.removeURLParam("ispremium",!0)}},{key:"getState",value:function(){return{modalStack:d.default.menus.modalStack,isGapiLoaded:Je.a.isGapiLoaded,loadState:c.a.loadState}}},{key:"onAfterChanged",value:function(e,t){e.modal?e.modal&&0===e.modalStack.length&&this.modal.set(void 0):this.getModal(e)}},{key:"getModal",value:function(e){var t=this,i=e.modalStack;i&&i.length>0&&(i[0].id===u.a.Modals.EnterCode?Promise.all([a.e(0),a.e(2)]).then(a.bind(null,813)).then(function(e){t.modal.set(e.default)}):i[0].id===u.a.Modals.ImportMoodo?Promise.all([a.e(0),a.e(2)]).then(a.bind(null,814)).then(function(e){t.modal.set(e.default)}):i[0].id===u.a.Modals.ConfirmEncrypt&&Promise.all([a.e(0),a.e(2)]).then(a.bind(null,815)).then(function(e){t.modal.set(e.default)}))}},{key:"nextPage",value:function(){var e=this.page.get()+1;e===r.Encrypt&&d.default.settings.userEncryptionSentinel.get()&&e++,this.page.set(e)}},{key:"onClickEnable",value:function(){var e=this,t=(this.state.page,[u.a.PluginID.Contacts,u.a.PluginID.GCalendar,u.a.PluginID.Gmail,u.a.PluginID.Drive].filter(function(t){return e.refs[t].getValue()})),a=t.map(function(t){return t===u.a.PluginID.Drive?{id:t,shared:e.refs.DriveShared.getValue()}:{id:t}});I.a.enablePlugins(a,!1,function(a){a&&(d.default.billingManager.hasPremiumFeatures()||(t.indexOf(u.a.PluginID.Drive)>=0||t.indexOf(u.a.PluginID.GCalendar)>=0)&&d.default.billingManager.startTrial(),e.nextPage())})}},{key:"onChangeDrive",value:function(e){this.onChangeFeature(e),e||this.refs.DriveShared.setValue(!1)}},{key:"onChangeDriveShared",value:function(e){this.onChangeFeature(e),e&&this.refs[u.a.PluginID.Drive].setValue(!0)}},{key:"onChangeFree",value:function(e){this.refs[u.a.PluginID.Contacts].setValue(e),this.refs[u.a.PluginID.Gmail].setValue(e)}},{key:"onChangePremium",value:function(e){this.refs[u.a.PluginID.GCalendar].setValue(e),this.refs[u.a.PluginID.Drive].setValue(e),this.refs.DriveShared.setValue(e)}},{key:"checkTier",value:function(e,t){for(var a=0,i=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.refs[t[n]].getValue()?i++:i--}i===t.length&&e.setValue(!0),i===-t.length&&e.setValue(!1)}},{key:"onChangeFeature",value:function(e){this.checkTier(this.refs.free,[u.a.PluginID.Contacts,u.a.PluginID.Gmail]),this.checkTier(this.refs.premium,[u.a.PluginID.GCalendar,u.a.PluginID.Drive,"DriveShared"])}},{key:"onClickImport",value:function(e){this.startFresh(),d.default.menus.openModal(u.a.Modals.ImportData,{importer:e})}},{key:"startFresh",value:function(){V.a.createDefaultState()}},{key:"onClickImportMoodo",value:function(e,t){(new Ot.a).authAndImportDocuments()}},{key:"onClickSkipEncryption",value:function(){this.nextPage()}},{key:"onClickSaveEncrypt",value:function(){var e=this,t=this.refs.pass1.getValue(),a=this.refs.pass2.getValue(),i=u.a.EncryptionKeys.UserPassword;t?t!==a?this.errorEncrypt.set("Passwords do not match"):t.length<5?this.errorEncrypt.set("Password is too short. Please enter a longer password to make it secure."):d.default.menus.confirmEncrypt(t,function(a){a&&(e.nextPage(),d.default.crypto.addKey({name:i,password:t,sentinelSalt:s.a.getEncryptionUid()}).then(function(e){vt.a.updateUserEncryption(e)}))}):this.errorEncrypt.set("No password entered")}},{key:"renderModal",value:function(e){var t=this.state.modalStack[0];return A.a.createElement(this.state.modal,Me()({noBackdrop:!0},t))}},{key:"renderPage",value:function(e){switch(e){case r.PluginSelect:return this.renderPagePluginSelect();case r.Encrypt:return this.renderPageEncryptionKey();case r.ImportData:return this.renderPageImportData();default:try{o.default.PAssert(236,!1,"Invalid intro page requested: "+e)}catch(t){o.default.reportError(t)}}}},{key:"renderConnecting",value:function(){return A.a.createElement("div",{key:"content"},A.a.createElement("div",{className:"flexbox flex-center",style:{margin:"64px 0"}},A.a.createElement(ae.a,{center:!0},"Connecting...")))}},{key:"renderPagePluginSelect",value:function(){return A.a.createElement("div",{key:"content",className:"pageConnect"},A.a.createElement("div",{className:"setupTitle"},"Connect with Google Services"),A.a.createElement("div",{className:"setupFeatures featureCheckboxes"},A.a.createElement("div",{className:"featureTier c-border"},A.a.createElement("div",{className:"tierTitleWrapper"},A.a.createElement(Be.a,{ref:"free",className:"tierTitle c-background",checked:!0,onChange:this.onChangeFree},"Free Features")),A.a.createElement("div",{className:"flexbox"},A.a.createElement("div",{className:"setupFeatureHalf"},A.a.createElement(Be.a,{ref:u.a.PluginID.Contacts,checked:!0,onChange:this.onChangeFeature},A.a.createElement("img",{src:"/img/plugin-gcontacts.png"}),"Google Contacts")),A.a.createElement("div",{className:"setupFeatureHalf"},A.a.createElement(Be.a,{ref:u.a.PluginID.Gmail,checked:!0,onChange:this.onChangeFeature},A.a.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail")))),A.a.createElement("div",{className:"featureTier c-border"},A.a.createElement("div",{className:"tierTitleWrapper"},A.a.createElement(Be.a,{ref:"premium",className:"tierTitle c-background",checked:!0,onChange:this.onChangePremium},"Premium Features")),!d.default.billingManager.hasPremiumFeatures()&&A.a.createElement("div",{className:"featureTierDesc c-foreground-light",style:{marginTop:-8}},"Enabling Premium features will start a free "+u.a.TrialDuration+" day trial of Moo.do Premium."),A.a.createElement("div",{className:"flexbox"},A.a.createElement("div",{className:"setupFeature setupFeatureHalf"},A.a.createElement(Be.a,{ref:u.a.PluginID.GCalendar,checked:!0,onChange:this.onChangeFeature},A.a.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar")),A.a.createElement("div",{className:"setupFeature setupFeatureHalf"},A.a.createElement(Be.a,{ref:u.a.PluginID.Drive,checked:!0,onChange:this.onChangeDrive},A.a.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),A.a.createElement(Be.a,{ref:"DriveShared",checked:!0,className:"subcheckbox",onChange:this.onChangeDriveShared},"Share files with collaborators")))),A.a.createElement("div",{className:"setupSubtext"},A.a.createElement("b",null,"Moo.do")," interacts with your Google services only client-side and your data is never sent to any server or shared with anyone. See our ",A.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),A.a.createElement("div",{className:"setupButtons center"},A.a.createElement(K.a,{raised:!0,primary:!0,onClick:this.onClickEnable},"NEXT"))))}},{key:"renderPageEncryptionKey",value:function(){var e=this.state.errorEncrypt,t={marginTop:8,width:240};return A.a.createElement("div",{key:"content"},A.a.createElement("div",{className:"setupTitle"},"Password protect your data"),A.a.createElement("div",{className:"welcomeEncryption"},A.a.createElement("div",{className:"modal-subtext c-foreground-faded"},"Your data is encrypted client-side before sending it to the database. For an extra level of security, you can enter your own password for the encryption. This makes it so that even the developers cannot read your data, and it cannot be recovered."),A.a.createElement("div",{style:{marginTop:24}},A.a.createElement(Y.a,{type:"password",placeholder:"Password",ref:"pass1",style:t}),A.a.createElement(Y.a,{type:"password",placeholder:"Confirm Password",ref:"pass2",style:t})),A.a.createElement("div",{className:"modal-warning flexbox c-warning"},A.a.createElement("i",{className:"icon-warning"}),A.a.createElement("div",null,"If you lose this password, all your data will be lost! For your security, Moo.do cannot recover your password, so keep your password safe. This is competely optional (see above).")),e&&A.a.createElement("div",{className:"error",style:{marginTop:8}},e),A.a.createElement("div",{style:{marginTop:24}},A.a.createElement(K.a,{raised:!0,onClick:this.onClickSkipEncryption},"SKIP"),A.a.createElement(K.a,{raised:!0,primary:!0,marginLeft:24,onClick:this.onClickSaveEncrypt},"SAVE"))))}},{key:"renderPageImportData",value:function(){var e=this;return A.a.createElement("div",{key:"content"},A.a.createElement("div",{className:"setupTitle"},"Coming from the old Moo.do?"),A.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Please import your Premium status, billing data, and files from the old database"),A.a.createElement("div",{style:{margin:"32px 0"}},A.a.createElement(K.a,{raised:!0,enabled:this.state.isGapiLoaded,onClick:this.onClickImportMoodo},"Import from Moo.do")),A.a.createElement("hr",{style:{width:600,margin:"32px auto"}}),A.a.createElement("div",{className:"setupTitle"},"Import from another app"),A.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Copy your data from another app into Moo.do"),A.a.createElement("div",{className:"flexbox flex-center importWrapper",style:{marginTop:32}},A.a.createElement("div",{className:"welcomeImporters"},["Wunderlist","Workflowy","Trello","Google Tasks","Todoist"].map(function(t,a){return A.a.createElement(K.a,{key:a,raised:!0,onClick:e.onClickImport.bind(e,t)},t)}))),A.a.createElement("hr",{style:{width:200,margin:"32px auto"}}),A.a.createElement("div",{className:"setupTitle"},"Just start fresh"),A.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Start from scratch with an empty document. You can always import your data later."),A.a.createElement("div",{style:{marginTop:32}},A.a.createElement(K.a,{raised:!0,onClick:this.startFresh},"Get Started")))}},{key:"render",value:function(){var e=this.state.loadState,t=o.default.classNames("welcome c-background flexbox flexvert flex-center"),a=e!==u.a.LoadState.Connected,i=this.state.modal;return A.a.createElement("div",{className:t},A.a.createElement("div",{style:{width:720}},i&&this.renderModal(i),!i&&(a?this.renderConnecting():this.renderPage(this.state.page))))}}]),t}(U.a),Ut=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"getState",value:function(){return{hasUpdate:d.default.AppCache.hasUpdate,ignoreUpdate:d.default.AppCache.ignoreUpdate}}},{key:"onClickClose",value:function(){d.default.AppCache.ignoreUpdate.set(!0)}},{key:"onClickLog",value:function(){o.default.openUrl(location.origin+"/changelog/")}},{key:"onClickUpdate",value:function(){o.default.reload()}},{key:"render",value:function(){if(this.state.hasUpdate&&!this.state.ignoreUpdate){var e={lineHeight:"32px"};return d.default.settings.showSidebar.get()?(e.bottom=6,e.left=d.default.settings.sidebarWidth.get()+6):(e.top=u.a.DesktopToolbarHeight+6,e.right=6),A.a.createElement("div",{id:"updateMessage",className:"flexbox",style:e},A.a.createElement(K.a,{color:"white",height:32,icon:"icon-close",onClick:this.onClickClose}),A.a.createElement("div",{className:"updateMessageText f1"},"A new update is available"),A.a.createElement(K.a,{color:"white",height:32,fontSize:11,padding:12,onClick:this.onClickLog},"LOG"),A.a.createElement(K.a,{color:"white",height:32,fontSize:11,padding:12,onClick:this.onClickUpdate},"UPDATE"))}return null}}]),t}(U.a),Vt=function(e){function t(){return p()(this,t),x()(this,O()(t).apply(this,arguments))}return N()(t,e),m()(t,[{key:"init",value:function(){var e=this;this.createObservables({modulesLoaded:!1,disablePointerEvents:!1}),this.scrollPos=0,setTimeout(function(){var t=2;Promise.all([a.e(0),a.e(2)]).then(a.bind(null,843)).then(function(a){Ft=a.default,0===--t&&e.modulesLoaded.set(!0)}),Promise.all([a.e(0),a.e(2)]).then(a.bind(null,844)).then(function(a){Nt=a.default,0===--t&&e.modulesLoaded.set(!0)})},100);var t=h.a.blockClient();if(void 0!==t){o.default.errorPlatformInfo=t;var i,n=t.platform;n?i=t.update?"iOS App"===n?"Please update your iOS app to the latest version in the App Store.":"Android App"===n?"Please update your Android app to the latest version in the Play Store.":"Firefox"===n?'Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"===n?'Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"===n?"Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===n?'Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===n?'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':"Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!":"Sorry, we don't support "+n+" yet. Please let us know that you're interested in using "+n+" and we will make it a higher priority. Thanks!":t.version?i="Please update your app to the latest version of Moo.do. Thanks!":t.cacheUpdate&&(i="There was an issue while updating the app, "+h.a.actionVerb()+" to try again.",d.default.AppCache.update()),h.a.app&&d.default.nativeBridge.sendToApp("localLoaded"),i&&(this.platformError=i)}}},{key:"onMount",value:function(){this.platformError||(this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged"))}},{key:"componentDidUpdate",value:function(){this.platformError||this.setPanesContainer()}},{key:"setPanesContainer",value:function(){var e=this.props.main;e.panesContainer||(e.panesContainer=this.refs.panes)}},{key:"onClickErrorRefresh",value:function(){o.default.reload(!d.default.AppCache.useServiceWorker)}},{key:"onClickErrorDownload",value:function(){o.default.openUrl(h.a.getAppDownloadURL())}},{key:"_isOkToSendKey",value:function(e){var t=P.a.getPane();return!e.defaultPrevented&&t&&!t.isDestroyed()&&!t.isUnloaded()&&!(d.default.menus.isContextMenuOpen()&&!d.default.menus.isOnlyAutocompleteOpen())&&!d.default.menus.isModalOpen()&&!o.default.activeInput.get()}},{key:"keydown",value:function(e){if(this._isOkToSendKey(e)&&P.a.getPane().keydown(e),e.target===document.body&&e.normCode===u.a.KeyCode.Backspace)return e.handled=!0,e.preventDefault(),!1}},{key:"keypress",value:function(e){this._isOkToSendKey(e)&&P.a.getPane().keypress(e)}},{key:"keyup",value:function(e){this._isOkToSendKey(e)&&P.a.getPane().keyup(e)}},{key:"onMouseDownPanes",value:function(e){"panes"===e.target.id&&P.a.reset()}},{key:"getState",value:function(){var e=this.props.main,t=d.default.PaneManager,a=h.a.blockedReason.get();return a?{blockedReason:a}:{panes:t.displayPanes,documents:c.a.documentsArray,boards:V.a._boards,isHelpShowing:d.default.intro.isVisible,helpPosition:d.default.intro.position,isWindowFocused:P.a.isWindowFocused,isDragging:d.default.DragDrop.isVisible,isDraggingPane:d.default.DragDrop.isDraggingPane,isLoading:t.isLoading,animatePaneSwap:t.animatePaneSwap,isDraggingSidebar:d.default.DesktopUI.isDraggingSidebar,showSidebar:d.default.DesktopUI.showSidebar,cursor:e.cursor,activeUser:d.default.settings.activeUser,isMainRendered:e.isRendered,showMarkdown:d.default.settings.showMarkdown,inTooltipIntro:d.default.settings.inTooltipIntro,closedHelps:d.default.settings.closedHelps,blockedReason:h.a.blockedReason,showIntroPopup:!1}}},{key:"_onTimeoutPointerEvents",value:function(){this.disablePointerEvents.set(!1)}},{key:"onScroll",value:function(e){"panes"===e.target.id&&e.target.scrollLeft!==this.scrollPos&&(this.scrollPos=e.target.scrollLeft,this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,500))}},{key:"render",value:function(){var e,t,a=this.state,i=[];if(a.blockedReason&&(this.platformError=a.blockedReason),this.platformError)e=A.a.createElement("div",{className:"centerVHFlex",style:{width:540,lineHeight:1.5}},A.a.createElement("div",null,A.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.platformError}}),A.a.createElement("br",null),A.a.createElement("br",null),A.a.createElement("div",null,A.a.createElement(K.a,{raised:!0,onClick:this.onClickErrorRefresh},"Reload")),A.a.createElement("br",null),A.a.createElement("div",null,A.a.createElement(K.a,{raised:!0,onClick:this.onClickErrorDownload},"Download app"))));else{for(var n=0,r=0;r<a.panes.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=a.panes[r],l=s.type,c=s.pane;if(c.hasBeenActive)if("overview"===l)i.push(A.a.createElement(St,{key:"overview"+c.id,pane:c}));else if("pane"===l)switch(c.type){case u.a.PaneMode.Task:i.push(A.a.createElement(xe,{key:"pane"+c.id,pane:c}));break;case u.a.PaneMode.Archived:case u.a.PaneMode.Drive:i.push(A.a.createElement(Ee,{key:"pane"+c.id,pane:c}));break;case u.a.PaneMode.Gmail:i.push(A.a.createElement(Re,{key:"pane"+c.id,pane:c}));break;default:try{o.default.PAssert(18,!1,"Invalid pane mode requested"+c.type)}catch(k){o.default.reportError(k)}}else"emailPreview"===l&&i.push(A.a.createElement(It,{key:"emailPreview"+c.id,pane:c}))}var f=a.cursor;a.isDraggingSidebar&&(f="cursor-ew-resize");var p=o.default.classNames("renderedContent c-foreground c-bg-app",f,{windowBlurred:!a.isWindowFocused},{draggingItems:!!a.isDragging||a.isDraggingPane},{draggingPane:a.isDraggingPane},{hideMDMarkup:!a.showMarkdown});if(d.default.settings.activeUser.get()){if(a.isMainRendered)if(a.isLoading&&!o.default.isDemoMode())e=A.a.createElement("div",{id:"container"},A.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"c-foreground-light centerVH"},A.a.createElement("div",{className:"loading loading20"}),A.a.createElement("div",{className:"loadingText"},"Loading documents...")),A.a.createElement(bt,null));else if(0===a.documents.length||0===a.boards.length)e=A.a.createElement("div",{id:"container"},A.a.createElement(Bt,null));else{var g,m=o.default.classNames("panes c-background",{noPanes:0===i.length},{noClick:a.isDraggingSidebar},{transition:d.default.DesktopUI.sidebarTransitioning},{noClickItems:a.disablePointerEvents}),v={left:-1,top:d.default.DesktopUI.shouldShowTopBar()?h.a.isNativeMac()?36:32:0};if(a.isHelpShowing){var y={};y[h.a.transform.react]="translate("+a.helpPosition+"px,0)",g=A.a.createElement("div",{id:"helpPlaceholder",style:y})}t=A.a.createElement("div",{id:"panes",className:m,ref:"panes","data-moo-id":"panes",style:v,onMouseDown:this.onMouseDownPanes},i.length>0?i:A.a.createElement(xt,null),g),e=A.a.createElement("div",{id:"container",className:p,onScroll:this.onScroll},A.a.createElement("div",{id:"measureText"},A.a.createElement("div",{id:"measureTextItem"})),h.a.isNativeMac()&&A.a.createElement("div",{className:"appTopBar desktopDrag c-bg-app"}),A.a.createElement(Ze,null),t,a.showIntroPopup&&A.a.createElement(Et,null),d.default.pluginManager.getPluginGmail()&&A.a.createElement(ft,null),Ft&&A.a.createElement(Ft,null),A.a.createElement(je,null),A.a.createElement(We,null),Nt&&A.a.createElement(Nt,null),A.a.createElement(Oe,null),A.a.createElement(bt,null),A.a.createElement(At,null),A.a.createElement(Ut,null),o.default.isDemoInIframe()&&A.a.createElement(Dt,null))}}else e=A.a.createElement(Rt,null)}return A.a.createElement(B.CSSTransitionGroup,{transitionName:"reactFadeMain",transitionEnterTimeout:300,transitionLeaveTimeout:100},e)}}]),t}(U.a);t.default=function(){try{if(!h.a.blockedReason.get()){var e=function(){h.a.updateOrientation()};o.default.checkpoint(u.a.Checkpoint.RequireLoaded),o.default.isDemoMode()||s.a.init(),d.default.init(),c.a.init(),window.__ERRORINMAINHEADER&&o.default.reportError(window.__ERRORINMAINHEADER);try{o.default.PAssert(0,-1===navigator.userAgent.indexOf("Electron")||h.a.appPlatform===u.a.AppPlatform.Electron,"Electron app missing app platform set")}catch(y){o.default.reportError(y)}o.default.checkpoint(u.a.Checkpoint.PageLoad);try{o.default.PAssert(1,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(y){o.default.reportError(y)}if("loading"===document.readyState){var t="ERROR: MainJS running before document load! "+document.readyState;o.default.shouldLog(u.a.LogLevels.Error)&&o.default.log(t),o.default.reportError(new Error(t))}for(var a in window.scriptErrors)window.scriptErrors.hasOwnProperty(a)&&o.default.fireCustomEvent("scriptLoadError",{src:a,id:window.scriptErrors[a],firstChance:!0});window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,o.default.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){o.default.reportError(t)}},window.oncontextmenu=function(e){o.default.isKeyboardInputElement(e.target)||e.preventDefault()},o.default.isDemoMode()||h.a.offline||(l=window,f=document,p="script",g="ga",l.GoogleAnalyticsObject=g,l.ga=l.ga||function(){(l.ga.q=l.ga.q||[]).push(arguments)},l.ga.l=1*new Date,m=f.createElement(p),v=f.getElementsByTagName(p)[0],m.async=1,m.src="//www.google-analytics.com/analytics.js",v.parentNode.insertBefore(m,v),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview")),h.a.updateBodyClass();var i=function(e){document.documentElement.addEventListener(e,function(e){o.default.reportEvent(e)},!0)};0,i("keydown"),i("keyup"),i("keypress"),i("MSPointerDown"),i("MSPointerUp"),i("MSPointerHover"),i("MSPointerCancel"),i("mousedown"),i("mouseup"),i("touchstart"),i("touchend"),d.default.AppCache.init(),o.default.localDocChangeRequested=!1;var n=function(e){var t=h.a.getActualWindowWidth(),a=h.a.getActualWindowHeight();try{o.default.PAssert(2,0!==t&&!isNaN(t)&&0!==a&&!isNaN(a),"Window size is 0",t,a)}catch(y){o.default.reportError(y)}var i=h.a.windowWidth(!0),n=h.a.windowHeight(!0);t===i&&a===n||(h.a.setWindowSize(t,a),h.a.onResize.notify(),o.default.documentHeight=a,s.a.onActiveUser(function(){k.a.fireEvent("windowResize",[])}))};n(),e(),o.default.shouldLog(u.a.LogLevels.Timing)&&o.default.log("Running main.js: ",log.now()),window.onblur=function(){o.default.hasFocus=!1},window.onfocus=function(){o.default.hasFocus=!0},new E,window.addEventListener("resize",n),window.addEventListener("orientationchange",e),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("dragover",function(e){return e.preventDefault(),!1});var r=!1;c.a.loadLocal(function(e){r||(r=!0,o.default.checkpoint(u.a.Checkpoint.InitializeMain),function(){try{!0,o.default.checkpoint(u.a.Checkpoint.OnInitializedData),o.default.isDemoMode()||(o.default.setupDateRollover(),window.addEventListener("focus",o.default.ensureDateRollover)),o.default.vmMain.loadData(),o.default.shouldLog(u.a.LogLevels.Timing)&&o.default.log("Data done loading: ",log.now())}catch(e){o.default.reportError(e)}}())}),!o.default.isDemoMode()&&h.a.app&&d.default.nativeBridge.sendToApp("loaded")}T.a.render(A.a.createElement(Vt,{main:o.default.vmMain}),document.getElementById("outerWrapper"))}catch(_){console.log(_),o.default.handleCriticalError(),o.default.reportError(_,"Critical Error")}var l,f,p,g,m,v}},483:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(3),m=a(7),v=a(2),y=a(21),k=a(57),_=a(17),S=a(120),P=a(471),w=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"getState",value:function(){return{hasPremium:g.default.billingManager.hasPremiumFeaturesObservable}}},{key:"hasChildren",value:function(){var e=!1;return v.Children.forEach(this.props.children,function(t){t&&(e=!0)}),e}},{key:"render",value:function(){var e=this.props,t=this.state;if(!1===e.needsPremium||t.hasPremium||!this.hasChildren())return e.children;if(e.children){var a=f.default.classNames(e.className,"premiumWall",{"border c-border-heavy c-bg-faded":!e.className});return v.createElement("div",{className:a,style:e.style},e.render&&e.render(),!e.render&&v.createElement(v.Fragment,null,v.createElement("div",{className:"premiumWallText c-foreground-faded flexbox flexvert flex-center",style:e.styleText},"Premium Features:"),v.createElement("div",{className:"noPremium"},e.children)))}}}]),t}(y.a),I=a(20),b=a(59),D=a(36),E=a(72),C=p.a.TaskSortMode,A=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){this.DISABLE_LISTENER_ASSERT=!0;var e=this.props;this.availablePanes=k.a.getAvailablePanes(!!e.subset);var t=e.pane||k.a.createPane(p.a.PaneMode.Task,{isFakePane:!0,document:_.a.getDefaultDocument()});this.createObservables({pane:t}),this.refZoomItem=v.createRef()}},{key:"getState",value:function(){var e=this.pane.get(),t={pane:e,activePaneTypes:k.a.activePaneTypes,numInactivePanes:k.a.numInactivePanes,hasPremium:g.default.billingManager.hasPremiumFeaturesObservable};return e&&(t.viewState=e.viewState,t.viewMode=e.getViewMode(),t.sortModeBlocks=e.supportsSortBlocks()&&e.getSortModeBlocks(),t.sortModeItems=e.supportsSortItems()&&e.getSortModeItems(),t.sortOrderBlocks=e.supportsSortBlocks()&&e.getSortOrderBlocks(),t.sortOrderItems=e.supportsSortItems()&&e.getSortOrderItems(),t.filterShowOnlyMatches=e.search.getFilter("showOnlyMatches")&&e.search.getFilterObs("showOnlyMatches")),t}},{key:"getCreationProps",value:function(){var e=this.state.pane;return{pane:e,item:this.refZoomItem.current.getItem(),type:e.type!==p.a.PaneMode.Task?e.type:void 0}}},{key:"isPaneTypeOk",value:function(){return!this.props.subset}},{key:"onClickEnableMorePanes",value:function(){g.default.menus.openSettings(p.a.SettingsSections.Plugins)}},{key:"onSelected",value:function(e,t){if(e===this.state.pane.type)this.state.pane.setViewMode(t);else{var a={isFakePane:!0,document:_.a.getDefaultDocument()};t&&(a.viewState={viewMode:t}),this.pane.set(k.a.createPane(e,a)),this.refreshListeners()}}},{key:"onSortModeClick",value:function(e,t,a){var i=1;(m.a.mac&&a.metaKey||!m.a.mac&&a.ctrlKey)&&(i=-1),this.state.pane["setSortMode"+(e?"Blocks":"Items")](t,i)}},{key:"onChangePaneName",value:function(e){this.state.pane.setName(e)}},{key:"renderSelectedNeedsPremium",value:function(){var e=this.state.pane.getViewMode();return v.createElement("div",null,v.createElement("div",{className:"ib c-border-heavy"},"The ",v.createElement("b",null,p.a.TaskViewModeText[e])," view is a Premium feature"))}},{key:"renderPaneType",value:function(e,t){var a=this.props,i=this.state;if(e.enableMore)return v.createElement(D.a,{key:"enableMore",height:32,onClick:this.onClickEnableMorePanes},"Enable more panes");if(e.viewModes){for(var n=0,r=f.default.classNames("hasHorButtons",{"hasBorder c-border":e.border}),s=[],o=e.viewModes.length,l=0;l<o;l++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e.viewModes[l],d=f.default.classNames("c-popup-item",{selected:u.viewMode===i.viewMode});a.hidePremiumTypes&&u.premium&&!i.hasPremium||s.push(v.createElement(I.a,{key:u.text,className:d,padding:0,iconSize:15,color:"c-foreground",onMouseUp:this.onSelected.bind(this,u.type,u.viewMode)},v.createElement("div",{className:"viewIcon c-foreground-faded "+u.icon}),u.text))}return v.createElement(D.a,{className:r,key:e.text,customLayout:!0,clickCloses:!1,hoverEffects:!1},v.createElement(E.a,{hotkeyCentered:!0},e.text),v.createElement("div",{className:"horButtons flexbox"},s))}var c=e.viewMode,h=e.type,p=f.default.classNames({"hasBorder c-border":e.border},{selected:this.state.pane.type===h&&(!c||this.state.viewMode===c)});return v.createElement(D.a,{key:e.text,className:p,icon:e.icon,height:32,onClick:this.onSelected.bind(this,e.type,e.viewMode),clickCloses:!1,id:"addPane_"+(c||e.type)},e.text)}},{key:"renderSortMode",value:function(e,t){var a=this.state.pane,i=this.state.viewMode;if(!e||a.supportsSortBlocksMode(t,i)){var n=t===this.state["sortMode"+(e?"Blocks":"Items")],r=n&&-1===this.state["sortOrder"+(e?"Blocks":"Items")],s=f.default.classNames("sortModeButton c-border-light c-popup-item",{selected:n},{reversed:r}),o=n?"c-foreground":"c-foreground-light",l="<b>Click</b> to sort ascending.<br><b>"+m.a.priModKey+" + Click</b> to sort descending.";return v.createElement(I.a,{className:s,color:o,height:p.a.SearchHeight,tooltip:l,onClick:this.onSortModeClick.bind(this,e,t)},p.a.TaskSortModeText[t])}}},{key:"renderSelectedPane",value:function(){var e=this.state,t=this.props,a=this.state.pane,i=a,n=e.viewMode,r=a.getViewMode(),s="Name this pane"+(e.hasPremium?"":" (Premium only)");return v.createElement(w,{className:"paneConfigNeedsPremium flexbox flexvert",needsPremium:!!p.a.TaskViewModesPremium[r],render:this.renderSelectedNeedsPremium},v.createElement("div",{className:"paneTypeDetails"},v.createElement(b.a,{className:"c-border-light",value:a&&a.name.get(),placeholder:s,readonly:!e.hasPremium,fontSize:13,height:32,border:!1,padding:{left:16,right:16},onChange:this.onChangePaneName}),t.showSearchZoom&&v.createElement(v.Fragment,null,v.createElement(b.a,{className:"c-border-light",autocompleteMode:p.a.AutocompleteMode.Item,placeholder:"Zoom to item",height:30,border:!1,padding:{left:16,right:16},autocompleteOnClick:!0,ref:this.refZoomItem,pane:a}),v.createElement(S.a,{pane:a,showFilters:!1})),v.createElement(P.a,{pane:a}),v.createElement(w,{style:{marginTop:8},styleText:{marginBottom:-8}},n&&i.supportsSortBlocks()&&v.createElement("div",{className:"sortSection"},v.createElement(E.a,null,"Sort ",p.a.TaskViewModeTextSimple[r]),v.createElement("div",{className:"borderButtons c-border-light"},this.renderSortMode(!0,C.None),this.renderSortMode(!0,C.Alphabetical),this.renderSortMode(!0,C.NumItems),this.renderSortMode(!0,C.Priority),this.renderSortMode(!0,C.Date),this.renderSortMode(!0,C.Created),this.renderSortMode(!0,C.Completed))),n&&i.supportsSortItems()&&v.createElement("div",{className:"sortSection"},v.createElement(E.a,null,"Sort Items"),v.createElement("div",{className:"borderButtons c-border-light"},this.renderSortMode(!1,C.None),this.renderSortMode(!1,C.Alphabetical),this.renderSortMode(!1,C.NumItems),this.renderSortMode(!1,C.Priority),this.renderSortMode(!1,C.Date),this.renderSortMode(!1,C.Created))))))}},{key:"render",value:function(){var e=this.props,t=f.default.classNames("addPaneTypes withSelected flexbox",e.className);return v.createElement("div",{className:t},v.createElement("div",{key:"leftcol",className:"leftSide"},this.availablePanes.map(this.renderPaneType)),v.createElement("div",{className:"selectedPaneArea c-border-light f1"},this.renderSelectedPane()))}}]),t}(y.a);t.a=A},49:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(160),l=function(){function e(t){n()(this,e),this._listeners=[],this._enabled=!0,t&&this._listeners.push(t)}return s()(e,[{key:"listen",value:function(e){return this._addListener(e),new o.a(this,e)}},{key:"_addListener",value:function(e){this._listeners.push(e)}},{key:"_hasListener",value:function(e){return this._listeners.indexOf(e)>=0}},{key:"unlisten",value:function(e){this._listeners.remove(e)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){if(this._enabled)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;arguments.length>0?this._listeners[t](arguments.length<=0?void 0:arguments[0]):this._listeners[t]()}}}]),e}();t.a=l},50:function(e,t,a){"use strict";var i,n=a(35),r=a.n(n),s=a(5),o=a.n(s),l=a(6),u=a.n(l),d=a(13),c=a.n(d),h=a(0),f=a(3),p=a(24),g=a(4),m=a(8),v=a(14),y=(i=function(){function e(){o()(this,e),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}return u()(e,[{key:"beginBatch",value:function(e,t){h.default.isEmpty(this.itemsBatchingUpdates)&&(!m.d.undoRedoActive&&t?(this._savedSelectionDrive=g.a.save(),g.a.reset()):this._savedSelectionDrive=void 0,this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}},{key:"commitBatch",value:function(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}},{key:"itemItemsChanged",value:function(e){this.updateItem(e,"Items")}},{key:"itemTextChanged",value:function(e){this.updateItem(e,"Text")}},{key:"itemDateChanged",value:function(e){this.updateItem(e,"Date")}},{key:"itemPriorityChanged",value:function(e){this.updateItem(e,"Priority")}},{key:"itemTagsChanged",value:function(e,t){this.updateItem(e,"Tags",t)}},{key:"itemModifiedChanged",value:function(e){this.updateItem(e,"Modified")}},{key:"itemFontChanged",value:function(e){this.updateItem(e,"Font")}},{key:"itemSearchChanged",value:function(e){this.updateItem(e,"Search")}},{key:"updateItem",value:function(e,t,a){if(a=a||!0,this.itemsBatchingUpdates[e.id]){var i=this.itemsBatchingUpdates[e.id];i||(i=this.itemsBatchingUpdates[e.id]={item:e}),i[t]=a,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,r()({item:e},t,a))}},{key:"_runUpdate",value:function(e,t){p.a.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}},{key:"_runUpdates",value:function(){var e=this;h.default.batchRenderUpdates(function(){for(var t in f.default.PaneUpdateBatcher.beginUpdateItems(),e.itemsBatchingUpdates)if(e.itemsBatchingUpdates.hasOwnProperty(t)){var a=e.itemsBatchingUpdates[t];e._runUpdate(a.item,a)}e.itemsBatchingUpdates={},f.default.PaneUpdateBatcher.commitUpdateItems(),e._savedSelectionDrive&&g.a.restore(e._savedSelectionDrive)})}}]),e}(),c()(i.prototype,"_runUpdate",[v.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdate"),i.prototype),c()(i.prototype,"_runUpdates",[v.a],Object.getOwnPropertyDescriptor(i.prototype,"_runUpdates"),i.prototype),i);t.a=new y},500:function(e,t,a){"use strict";a.r(t);a(501);var i=a(26),n=a(7);function r(){document.removeEventListener("DOMContentLoaded",r,!1),window.removeEventListener("load",r,!1),n.a.demo?a(482).default():i.a.preload(function(){a(482).default()})}window.__isLoaded=!0,Date.Config={__DEV__:!0,DisableCache:!0},"complete"===document.readyState||"interactive"===document.readyState?r():(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1))},501:function(e,t,a){"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(i){console.log("Error in main header",i),window.__ERRORINMAINHEADER=i}},51:function(e,t,a){"use strict";var i=a(485);a(587),a(786),a(590);t.a=i},53:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(0),u=a(3),d=a(23),c=a(1),h=a(42),f=a(4),p=function(){function e(){r()(this,e),this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.dict=this.repeatStart.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months)}return o()(e,[{key:"findMatchLike",value:function(e){for(var t=0,a=e.toLowerCase(),i=[],n=0;n<this.dict.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;0===this.dict[n].indexOf(a)&&i.push({type:"date",text:this.dict[n]})}return i}},{key:"findMatchExact",value:function(e){if(this.dict.indexOf(e)>=0)return{type:"date",text:e}}}]),e}(),g=a(225),m=a(13),v=a.n(m),y=a(14),k=new(i=function(){function e(){r()(this,e)}return o()(e,[{key:"findMatchLike",value:function(e,t,a){var i=e.toLowerCase(),n=[];return l.default.searchVMLIs({item:a,comparator:function(e){return!e.isComplete()&&!e.isDisplayComplete()},each:function(e){var a=!1;i?(e.getPrefix()+e.getSearchText()).indexOf(i)>=0&&(a=!0):a=e.isPrefixHeader();if((a=a&&(!e.els||!e.els[0]||!e.els[0].isMDImage()))&&n.push({type:"item",text:e.getParsedText(),item:e}),n.length>=t)return!1}}),n}},{key:"findMatchExact",value:function(e,t){}},{key:"getRNList",value:function(e,t,a){var i=[];return this.findMatchLike(e,t,a).forEach(function(e){i.push({type:"item",text:e.text,extraInfo:e.item})}),i}}]),e}(),v()(i.prototype,"getRNList",[y.a],Object.getOwnPropertyDescriptor(i.prototype,"getRNList"),i.prototype),i),_=new(function(){function e(){r()(this,e),this.accountID=void 0}return o()(e,[{key:"setAccountID",value:function(e){this.accountID=e}},{key:"findMatchLike",value:function(e,t){for(var a=0,i=u.default.pluginManager.getPluginGmail(),n=i.getLabels(this.accountID,e,t),r=[],s=0;s<n.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[s].isSystemLabel()||r.insertSorted(n[s],i.labelSortFn)}return r.map(function(e){return{type:c.a.AutocompleteMode.GmailLabel,text:e.getName(),label:e}})}},{key:"findMatchExact",value:function(e,t){}}]),e}()),S=a(58),P=a(17),w=function(){function e(){r()(this,e),this.matches=new h.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[c.a.ContactPrefix,c.a.TagPrefix,c.a.PrefixItemAutocomplete],this._prefixMap={},this.autocompleteDates=new p,this._prefixMap[c.a.ContactPrefix]=S.a,this._prefixMap[c.a.TagPrefix]=g.a,this._prefixMap[c.a.PrefixItemAutocomplete]=k,d.a.binder(this,"onClosed","onSelectedFromPane"),this.supportedModes=null}return o()(e,[{key:"isShowing",value:function(){return this._isShowing}},{key:"getText",value:function(){return this.text}},{key:"getProviderForPrefix",value:function(e){return this._prefixMap[e]}},{key:"_checkPrefixes",value:function(e,t){for(var a=0,i=e.startsWith("-")?1:0,n=0;n<this._prefixes.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._prefixes[n];if((r!==c.a.PrefixItemAutocomplete||t)&&e[i]===r)return{length:i+1,prefix:r}}}},{key:"_findClosestWithPrefix",value:function(e,t,a,i){for(var n,r=0,s=e.split(/ /),o=0,u=-1,d=-1,h=-1,f=0,p=0;p<s.length&&o<=t;++p){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var g=s[p],m=g.replace(/[\*_]+$/,"");s[u]===n&&(f=0);var v=this._checkPrefixes(m,i.canAutocompleteItems);v?(u=p,h=(d=o)+g.length,f=v.length,n=v.prefix):f&&n!==c.a.TagPrefix&&(h+=g.length+1),o+=g.length+1}if(f&&t>=d&&t<=h){var y=e.substr(d+f,h-d-f);return l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log("closest is",n,"--",y),{mode:a,text:e,prefix:n,searchText:y,start:d+f,end:h}}}},{key:"_findClosestDelimited",value:function(e,t,a){var i,n=0;i=a===c.a.AutocompleteMode.Item?[e]:e.split(",");for(var r=!1,s=0,o=-1,u=-1,d=0;d<i.length&&s<=t;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=i[d];o=s+this._numStartSpaces(h),u=s+h.length-this._numEndSpaces(h),o<t&&t<=u&&h.length>0?(r=!0,l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log("phrase",h,h.length),l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log("start char",o,e[o]),l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log("end char",u,e[u])):r=!1,s+=h.length+1}if(r||this._showNoMatches){var f=e.substr(o,u-o+1);return l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log("closest is",f),{mode:a,text:e,searchText:f,start:o,end:u}}}},{key:"_findClosestVMLIElement",value:function(e,t,a,i){for(var n,r,s,o=0,l=0,u=!1,d=0;d<t.length&&!1===u;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=t[d].getParsedText();if(n=l+this._numStartSpaces(c),r=l+c.length-1-this._numEndSpaces(c),n<a&&a<=r+1&&c.length>0){u=d,s=c.trim();break}l+=c.length}if(!1!==u)return{mode:i,text:e,prefix:"",searchText:s,start:n,end:r,el:t[d]}}},{key:"_numStartSpaces",value:function(e){for(var t=0,a=0,i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a}},{key:"_numEndSpaces",value:function(e){for(var t=0,a=0,i=e.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[i])break;a++}return a}},{key:"insertMatch",value:function(e){var t=this._searchInfo,a=t.text,i=a.substr(0,t.start),n=a.substr(t.end,a.length),r=t.start+e.length;" "!==n[0]&&e&&" "!==e[e.length-1]&&(e+=" ",r++);var s=i+e+n;return l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log(i,i.length,n,n.length),l.default.shouldLog(c.a.LogLevels.Autocomplete)&&l.default.log(s),{text:s,offset:r}}},{key:"onSelectedFromPane",value:function(e){e.owner.setText(e.value,c.a.ChangeType.Local),f.a.selectIndex(e.index,e.offset)}},{key:"prefixForMode",value:function(e){return"contact"===e&&c.a.ContactPrefix||"tag"===e&&c.a.TagPrefix||void 0}},{key:"startMobileAutocomplete",value:function(e){var t=e.mode,a=this.prefixForMode(t),i="date"===t?"Enter date":"Search "+t.capitalize()+"s";this.showPopup({mode:t,text:i,allowCustom:"date"===t,buttonText:"Add",pane:e.pane,onSelected:function(t){var i=e.owner;if(i){var n=i.getParsedText();n=n+(n.endsWith(" ")?"":" ")+a+t.value,i.setText(n,c.a.ChangeType.Local),f.a.selectIndex(e.index,n.length)}}})}},{key:"updateFromPane",value:function(e){var t=e.owner.getParsedText()||"";if(!(e.start<=1)||"#"!==t&&"+"!==t){var a=e.element.getBoundingClientRect(),i=u.default.Measure.getCaretScreenPosition(e.pane,e.index,e.start);this.update({mode:"all",text:t,pane:e.pane,offset:e.start,owner:e.owner,item:e.owner,positionOffset:{left:i.left-a.left,top:0},fromPane:!0,indexInPane:e.index,elementDisplay:e.element,position:void 0,onSelected:this.onSelectedFromPane})}}},{key:"update",value:function(e){var t=e.text,a=e.offset,i=e.mode,n=e.item;if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=e.text,this._isTempDisabled||!e.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;t=e.text;var r=null,s=null;this._searchInfo="all"===i?this._findClosestWithPrefix(t,e.offset,e.mode,e):this._findClosestDelimited(t,e.offset,e.mode);if(this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===i)s=this.getProviderForPrefix(this._searchInfo.prefix);else switch(i){case c.a.AutocompleteMode.Move:case c.a.AutocompleteMode.Jump:case c.a.AutocompleteMode.Item:s=k;break;case c.a.AutocompleteMode.Email:r=(s=this._prefixMap[c.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case c.a.AutocompleteMode.Contact:s=this._prefixMap[c.a.ContactPrefix];break;case c.a.AutocompleteMode.Tag:s=this._prefixMap[c.a.TagPrefix];break;case c.a.AutocompleteMode.Date:case c.a.AutocompleteMode.Snooze:s=this.autocompleteDates;break;case c.a.AutocompleteMode.GmailLabel:var o=u.default.pluginManager.getPluginGmail()._getAccountIDFromItem(e.item);(s=_).setAccountID(o);break;default:try{l.default.PAssert(17,!1,"Unknown autocomplete mode: ",i)}catch(f){l.default.reportError(f)}}if(null===r){var d,h=e.pane;d=h&&h.type===c.a.PaneMode.Task?h.getRootItem():e.item?e.item:P.a.getDefaultDocument().getRootItem(),r=s.findMatchLike(this._searchInfo.searchText,100,d)}1===r.length&&s.findMatchExact(this._searchInfo.searchText,r)&&(r=[])}this._searchInfo&&0!==r.length||!n||n.getRawText().includes(c.a.CharDate)||t[a-1]!==c.a.PrefixDate||!(a<2||" "===t[a-2]||t[a-2]===c.a.AttachChar)||t[a]&&" "!==t[a]&&t[a]!==c.a.AttachChar||u.default.menus.openContextMenu(Object.assign({componentName:"ReactContextMenuDate",item:e.item,textOffset:e.offset,element:e.elementDisplay,onClosed:function(){var t=e.owner&&e.owner.onDatePickerClosed;t&&t()}},e)),r=r||[],e.supportSearchItemAutocomplete&&"all"===i&&0===r.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(t,e.parsedEls,e.offset,i)),this.matches.set(r),!this._isShowing&&r.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===r.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}}},{key:"clearDisabled",value:function(){this._isTempDisabled=!1}},{key:"onClosed",value:function(){this._isShowing=!1,this._owner=null,this.matches.clear()}},{key:"show",value:function(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,u.default.menus.openContextMenu(e,!1)}},{key:"showPopup",value:function(e){this._isShowing=!0,this._showNoMatches=!0,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,u.default.menus.openContextMenu(e)}},{key:"hide",value:function(){this._isShowing&&(this._isShowing=!1,u.default.menus.closeContextMenu("ReactAutocomplete"))}}]),e}();t.a=new w},54:function(e,t,a){"use strict";var i=a(82),n=a.n(i),r=a(5),s=a.n(r),o=a(6),l=a.n(o),u=a(10),d=a.n(u),c=a(9),h=a.n(c),f=a(11),p=a.n(f),g=a(0),m=a(3),v=a(7),y=a(2),k=a.n(y),_=a(21),S=a(45),P=a(76),w=function(e){function t(){return s()(this,t),d()(this,h()(t).apply(this,arguments))}return p()(t,e),l()(t,[{key:"init",value:function(){var e=this.props;this.listenToDispatcher("windowResize"),e.supportArrows&&(this.selectedIndex=S.a.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))}},{key:"close",value:function(){try{g.default.PAssert(610,this.props.name,"Cannot call close on a menu without a name")}catch(e){g.default.reportError(e)}m.default.menus.closeContextMenu(this.props.name)}},{key:"getHotkeys",value:function(){var e=this.props,t=[S.a.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t}},{key:"getRefAtIndex",value:function(e){return this.refs["el_"+e]}},{key:"onMount",value:function(){this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState()}},{key:"onUnmount",value:function(){this.props.supportArrows&&S.a.exitArrowsMode("FancyContextMenu"),this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)}},{key:"getState",value:function(){var e=this.updatePosition();return{selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}}},{key:"onMouseDownNoBackdrop",value:function(e){g.default.findParent(e.target,"fancyContextMenu")||m.default.menus.closeContextMenu()}},{key:"isAtPosition",value:function(e){if(this.props.position&&this.props.position.split("-").indexOf(e)>=0)return!0;return!1}},{key:"getNumItems",value:function(){return this.numItems}},{key:"onArrowsModeSelect",value:function(e){if(e>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}}},{key:"onArrowsModeKey",value:function(e,t){var a=this.props;a.onKeyPress&&a.onKeyPress(e,t)&&a.supportArrows&&S.a.exitArrowsMode("FancyContextMenu")}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape(),m.default.menus.closeContextMenu()}},{key:"onChildMouseEnter",value:function(e,t){this.selectedIndex.set(e)}},{key:"isOnSide",value:function(e){return this.props.side?this.props.side.indexOf(e)>=0:"bottom"===e}},{key:"updatePosition",value:function(){var e=this.props,t=v.a.windowWidth(),a=v.a.windowHeight();try{g.default.PAssert(611,e.element,"Context menu needs an element to open on",e.id)}catch(y){g.default.reportError(y)}if(e.element){var i,n,r=e.element.getBoundingClientRect(),s=e.pos,o=this.refs.menu,l=s?s.left:void 0,u=s?s.top:void 0;isNaN(l)&&(this.isOnSide("right")?l=r.right:this.isOnSide("left")?i=t-("top left"===e.side?r.right:r.left):l=r.left),isNaN(u)&&(this.isOnSide("bottom")?u=r.bottom:this.isOnSide("top")?n=a-r.top:u=r.top);var d=e.positionOffset;d&&(!isNaN(l)&&d.left&&(l+=d.left),!isNaN(i)&&d.right&&(i+=d.right),!isNaN(u)&&d.top&&(u+=d.top),!isNaN(n)&&d.bottom&&(n+=d.bottom));var c={left:l,top:u,right:i,bottom:n};if(o){var h=l+o.clientWidth,f=u+o.clientHeight,p=t-8,m=a-8;"shrink"===this.props.overflowHeight&&n>a-8&&(c.maxHeight=Math.min(Math.max(a-u,260),500),f=Math.min(f,c.maxHeight+u)),h>p&&(c.left+=p-h),f>m&&(c.top+=m-f),(l<8||l+c.left<8)&&h<t&&(c.left+=8-l)}return c}return{left:0,top:0,maxHeight:400}}},{key:"remapChildren",value:function(e,t){var a=this;return k.a.Children.map(e,function(e){if(e&&"hr"!==e.type){if("leftcol"===e.key){var i=e.props,r=i.children,s=n()(i,["children"]);return k.a.createElement("div",s,a.remapChildren(r,t))}if("scroller"===e.key){return k.a.createElement(P.a,{style:{maxHeight:400}},a.remapChildren(e.props.children,t))}if(!e.props||e.props.onClick||e.props.customLayout){var o=e.props.onMouseEnter?function(i){a.onChildMouseEnter(t.index,i),e.props.onMouseEnter(i)}:a.onChildMouseEnter.bind(a,t.index);return k.a.cloneElement(e,{onMouseEnter:o,ref:"el_"+t.index,selected:a.state.selectedIndex===t.index++})}return e}return e})}},{key:"render",value:function(){var e,t=this.state,a=this.props,i=g.default.classNames("fancyContextMenu popup c-shadow-popup",a.className,a.position,a.background,{"c-border-light":a.border},{f1:a.isMaximized},{"c-bg-menu":!a.background},{loading:a.loading},{openFromBottom:a.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")});a.isMaximized||(e={left:t.left,top:t.top,right:t.right,bottom:isNaN(a.bottom)?t.bottom:a.bottom,width:a.width,height:a.height,minWidth:a.minWidth,maxHeight:t.maxHeight||a.maxHeight,maxWidth:a.maxWidth,border:a.border?"1px solid":void 0,padding:a.padding||void 0},e=g.default.extend(e,this.props.style));var n=this.props.children;if(a.supportArrows){var r={index:0};n=this.remapChildren(this.props.children,r),this.numItems=r.index}var s=k.a.createElement("div",{ref:"menu",id:a.id,className:i,style:e},n);return a.isMaximized?k.a.createElement("div",{className:"fancyContextMenuMaximized flexbox flexvert absFull maximized"},s):s}}]),t}(_.a);t.a=w},57:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(0),u=a(1),d=a(3),c=a(35),h=a.n(c),f=a(10),p=a.n(f),g=a(62),m=a.n(g),v=a(9),y=a.n(v),k=a(25),_=a.n(k),S=a(11),P=a.n(S),w=a(17),I=a(23),b=a(13),D=a.n(b),E=a(14),C=u.a.TaskSortMode,A=(i=function(){function e(t){for(var a in r()(this,e),t)t.hasOwnProperty(a)&&(this[a]=t[a]);this.id=t.id,this.text=t.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={};try{l.default.PAssert(1178,this.id,"Added an agenda block without an id")}catch(i){l.default.reportError(i)}}return o()(e,[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"heightOfHeader",value:function(){return 32}},{key:"heightOfSpaceBetween",value:function(){return 16}},{key:"heightOfAddButton",value:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}},{key:"comparePriority",value:function(e,t){var a=e.getPriority(),i=t.getPriority();return a>i?-1:a<i?1:0}},{key:"compareDate",value:function(e,t){try{l.default.PAssert(1179,this.date,"This block does not have a date",this.text)}catch(h){l.default.reportError(h)}var a=this.pane,i=e.getNextDate()||e.getDate(a),n=t.getNextDate()||t.getDate(a);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(i&&!n)return-1;if(!i&&n)return 1;if(!i&&!n)return 0;if(e.getDuration(a)>0){var r=e.getDisplayDateWithDuration(this.date);r&&(i=r)}if(t.getDuration(a)>0){var s=t.getDisplayDateWithDuration(this.date);s&&(n=s)}var o=i.clone().clearTime(),u=n.clone().clearTime();if(!o.equals(u))return o<u?-1:1;if(i.hasTimeOfDay()&&n.hasTimeOfDay()){var d=i.getTimeOfDay(),c=n.getTimeOfDay();return d===c?0:d<c?-1:1}return i.hasTimeOfDay()?1:n.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(e,t){return e.index-t.index}},{key:"compareItemsAgenda",value:function(e,t){var a=e.item,i=t.item;l.default.DAssert(a,"Must have a valid left item to compare"),l.default.DAssert(i,"Must have a valid right item to compare"),l.default.DAssert(!a||a.parent(),"Must have a valid left parent item"),l.default.DAssert(!i||i.parent(),"Must have a valid right parent item"),a.isNote()&&(a=a.parent()),i.isNote()&&(i=i.parent());var n=this.isStarred||this.isImportant?0:this.compareDate(a,i);if(0===n){var r=this.isStarred?0:this.comparePriority(a,i);return 0===r?this.compareOrder(e,t):r}return n}},{key:"compareItemsCreated",value:function(e,t){return this.pane.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareItemsCompleted",value:function(e,t){return this.pane.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"compareItemsModified",value:function(e,t){return this.pane.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"addItem",value:function(e){try{l.default.PAssert(1180,e&&l.default.isVMLI(e),"Must be adding a valid item: "+l.default.getObjectInfo(e))}catch(t){l.default.reportError(t)}this.items.indexOf(e)<0&&this.items.push(e)}},{key:"toggleCollapsed",value:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}},{key:"isCollapsed",value:function(){return this.pane.isBlockCollapsed(this)}},{key:"getItemID",value:function(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")}},{key:"sort",value:function(e){var t;if(this.pane.isViewAgenda()){var a=this.pane.getSortModeBlocks();a===C.Date?t=this.compareItemsAgenda:a===C.Created?t=this.compareItemsCreated:a===C.Completed?t=this.compareItemsCompleted:a===C.Modified&&(t=this.compareItemsModified)}else this.pane.isViewCalendarMonth()?t=this.compareItemsAgenda:this.sortMode&&this.sortMode!==C.None&&(t=this.pane.getItemComparator());if(t){var i=e.map(function(e,t){return{item:e,index:t}});return i.sort(t),i.map(function(e){return e.item})}return e}},{key:"_getAllItemsSorted",value:function(e,t,a){var i=this;t.isHidden(this.pane)||e.push(t),a&&!t.isCollapsed(this.pane)&&t.getItems().forEach(function(t){return i._getAllItemsSorted(e,t,!0)})}},{key:"getAllItemsSorted",value:function(e){var t=this,a=[];return this.items.forEach(function(i){return t._getAllItemsSorted(a,i,e)}),a=this.sort(a)}}]),e}(),D()(i.prototype,"compareItemsAgenda",[E.a],Object.getOwnPropertyDescriptor(i.prototype,"compareItemsAgenda"),i.prototype),D()(i.prototype,"compareItemsCreated",[E.a],Object.getOwnPropertyDescriptor(i.prototype,"compareItemsCreated"),i.prototype),D()(i.prototype,"compareItemsCompleted",[E.a],Object.getOwnPropertyDescriptor(i.prototype,"compareItemsCompleted"),i.prototype),D()(i.prototype,"compareItemsModified",[E.a],Object.getOwnPropertyDescriptor(i.prototype,"compareItemsModified"),i.prototype),D()(i.prototype,"toggleCollapsed",[E.a],Object.getOwnPropertyDescriptor(i.prototype,"toggleCollapsed"),i.prototype),i),M=a(121),T=a(15),L=a(24),x=a(4),R=a(8),O=a(74),F=u.a.TaskViewMode,N=u.a.TaskSortMode,B="__block_nokey",U={};U[F.Groups_Project]={Default:N.None,Available:[N.None,N.Alphabetical,N.NumItems,N.Date,N.Priority,N.Created,N.Modified,N.Completed]},U[F.Groups_Tag]=U[F.Groups_Contact]={Default:N.Alphabetical,Available:[N.Alphabetical,N.NumItems]},U[F.Agenda_Today]=U[F.Agenda_Week]=U[F.Agenda_All]={Default:N.Date,Available:[N.Date,N.Created,N.Completed,N.Modified]};var V=function(e){function t(e){var a,i;r()(this,t);d.default.pluginManager.getPlugin(u.a.PluginID.GCalendar).isActive()&&l.default.isDemoMode();e.document||(e.document=w.a.getDefaultDocument());(i=p()(this,y()(t).call(this,e,{isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]}))).type=u.a.PaneMode.Task,i.paneClass="paneTask",I.a.binder(m()(i),"getDayWidth","updateAllDay","scrollToToday","openViewMenu","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareBlockItemModified","compareBlockItemCompleted","compareItemDate","compareItemName","_itemSearchComparator","onScroll","checkFlatListMode","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","onViewStateChanged","getItemComparator","_onSelectionChanged"),i.dragHoveredBlock=new T.a;var n=e.viewState||{};return n.viewMode=n.viewMode||F.Groups_Project,n.sortModeBlocks=n.sortModeBlocks||{mode:N.None},n.sortModeItems=n.sortModeItems||{mode:N.None},l.default.isString(n.sortModeBlocks)&&(n.sortModeBlocks={mode:n.sortModeBlocks}),l.default.isString(n.sortModeItems)&&(n.sortModeItems={mode:n.sortModeItems}),i.viewState=new T.a(n,i.onViewStateChanged),i.item.get()||i.item.set(i.getDefaultDisplayItem()),i._allPaneItems=[],i._isViewHelper={},i.topBoxHeight.set(0,!1),i.blocksCollapsed=new T.a(e.blocksCollapsed||(a={},h()(a,B+"_"+F.Groups_Project,!0),h()(a,B+"_"+F.Groups_Tag,!0),h()(a,B+"_"+F.Groups_Contact,!0),h()(a,B+"_"+F.Groups_Priority,!0),a)),i.search.getFilterObs("showOnlyMatches").listen(i.checkFlatListMode),i.dropEffect=function(e){var t=u.a.DropEffect.Move;return i.isCalendarItem(e)&&(t=u.a.DropEffect.Copy),t},i.displayLocalItems=new T.a(void 0===e.displayLocalItems||e.displayLocalItems),i.displayCalendars=new T.a(e.displayCalendars||{}),i.numAllDay=new T.a(0),i.setupViewState(),i.initBlocks(),i}return P()(t,e),o()(t,[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0;var e=d.default.pluginManager.getPlugin(u.a.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=d.default.pluginManager.getPlugin(u.a.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),d.default.pluginManager.listen("pluginActiveChanged",u.a.PluginID.GCalendar,this.onGCalendarActiveChanged),d.default.pluginManager.listen("pluginActiveChanged",u.a.PluginID.Gmail,this.onGmailActiveChanged),L.a.listen("selectionChanged",this._onSelectionChanged),d.default.settings.dayWeekStart.listen(this.scrollToToday),d.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged),d.default.pluginManager.getPluginGCalendar().onCalendarsSynced.listen(this.updateItems)}},{key:"destroy",value:function(){d.default.pluginManager.unlisten("pluginActiveChanged",u.a.PluginID.GCalendar,this.onGCalendarActiveChanged),d.default.pluginManager.unlisten("pluginActiveChanged",u.a.PluginID.Gmail,this.onGmailActiveChanged),L.a.unlisten("selectionChanged",this._onSelectionChanged),d.default.settings.dayWeekStart.unlisten(this.scrollToToday),d.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),d.default.pluginManager.getPluginGCalendar().onCalendarsSynced.unlisten(this.updateItems),this._onAfterLoadedRAF||this.removeScrollListener(this.onScroll),_()(y()(t.prototype),"destroy",this).call(this)}},{key:"getPaneIcon",value:function(){return this.isViewAgenda()?"today":"format_list_bulleted"}},{key:"keydown",value:function(e){return x.a.isValid()&&x.a.getStartIndex()===x.a.getEndIndex()&&!R.d.undoRedoActive&&(this.preventUpdateItemsForItem=x.a.getStartObject(),this.search.stickMatch(x.a.getStartObject())),_()(y()(t.prototype),"keydown",this).call(this,e)}},{key:"handleLeftSideTap",value:function(e,a){return this.clearPreventUpdate(),_()(y()(t.prototype),"handleLeftSideTap",this).call(this,e,a)}},{key:"clearPreventUpdate",value:function(){var e=this,t=this.preventUpdateItemsForItem;if(t&&d.default.DragDrop.isDragging){L.a.listen("endDrag",function t(){L.a.unlisten("endDrag",t),e.clearPreventUpdate()})}else{var a=!1;t&&(a=a||this.search.unstickMatch(t),this.preventUpdateItemsForItem=void 0),a&&(this.setItemsDirty(),d.default.PaneUpdateBatcher.updateAllItems())}}},{key:"_onSelectionChanged",value:function(e){x.a.getPane()===this&&this.preventUpdateItemsForItem&&!R.d.undoRedoActive?x.a.isValid()?x.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(d.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),l.default.setItemAnimationMode(u.a.ItemAnimationMode.Move),d.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){l.default.resetItemAnimationMode()},300),d.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(e){return e.belongsToItemStore(d.default.pluginManager.getPlugin(u.a.PluginID.GCalendar).getDefaultItemStore())}},{key:"isEmailItem",value:function(e){return e.belongsToItemStore(d.default.pluginManager.getPlugin(u.a.PluginID.Gmail).getDefaultItemStore())}},{key:"_itemSearchComparator",value:function(e){var t=this,a=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),i=!1,n=!1;if(this.isCalendarItem(e)){var r=e.getAttachmentByPlugin(u.a.PluginID.GCalendar);r&&("cancelled"===r.getField("status")?n=!0:r.forEachItem(void 0,function(e){e.belongsToItemStore(r.getPlugin().getDefaultItemStore())||e.getDocumentOwner()!==t.getDocument()||(i=!0)}))}else if(this.isEmailItem(e)){var s=e.getAttachmentByPlugin(u.a.PluginID.Gmail);if(s){var o=d.default.pluginManager.getPluginGmail();if(o.isItemArchived(e))a=!1;else o.getAttachmentPriority(s)!==u.a.VMLIFlag.None&&(a=!0)}}return a&&!i&&!n}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.getItem(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeNotes:!0,pane:this}}},{key:"_setItems",value:function(e,t){this.updateBlockItems()}},{key:"onLoad",value:function(){isNaN(this.initialOffset)&&this.isViewDates()&&(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset)),_()(y()(t.prototype),"onLoad",this).call(this)}},{key:"onAfterLoaded",value:function(){this.orientation.get()===u.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.setIgnoreRestoreScroll(),_()(y()(t.prototype),"onAfterLoaded",this).call(this),this.addScrollListener(this.onScroll)}},{key:"getScrollOffsetOfToday",value:function(){var e;this.getViewMode();if(this.isViewCalendarMonth()){var t=this.getWeekStart(new Date);e=this.heightWeek()*this.items.get().findIndex(function(e){return e.date.equals(t)})}else if(this.isViewCalendarHoriz())e=this.getDayWidth()*u.a.CalendarDayViewNumDaysPad+1;else if(this.isViewAgenda())for(var a=0,i=this.items.get(),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n];if((r.isOverdue||r.isToday)&&"blockHeader"===r.type){e=this.topOfIndex(n)-16;break}}return e}},{key:"_getDateInMiddle",value:function(){var e=(new Date).clearTime(),t=this.getViewMode();return t===F.Calendar_Month?e=this.getMonthStart(e):t===F.Calendar_Week&&(e=this.getWeekStart(e)),e}},{key:"scrollToTop",value:function(e){this.isViewDates()?this.scrollToToday(e):_()(y()(t.prototype),"scrollToTop",this).call(this,e)}},{key:"scrollToToday",value:function(e){var t=this.getScrollOffsetOfToday();e=isNaN(e)?u.a.ScrollDuration.Default:e,this.setIgnoreRestoreScroll(e+100),this.setScrollOffset(t,e),this.orientation.get()===u.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0)}},{key:"weekCount",value:function(e,t,a){var i=new Date(e,t,1),n=a?new Date(e,t,a):new Date(e,t+1,0),r=i.getDay()+n.getDate();return Math.ceil(r/7)}},{key:"scrollJump",value:function(e,t){t=isNaN(t)?u.a.ScrollDuration.Default:t;var a,i,n=this.getViewMode(),r=this._infiniteList.getScrollOffset(),s=this._infiniteList.indexOfTop(),o=this._infiniteList.objectAtIndex(s),l=r-this.topOfIndex(s);if(n===F.Calendar_Month){var c=o.date;if(e<0){var h=c.clone().addMonths(-1);a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,i=this.weekCount(h.getFullYear(),h.getMonth()),r-=this.heightWeek()*(i+a)+l}else i=this.weekCount(c.getFullYear(),c.getMonth()),a=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,r+=this.heightWeek()*(i-a)-l}else if(n===F.Calendar_Custom){var f=d.default.settings.calendarCustomDays.get();r+=this.getDayWidth()*f*e-l+1}else if(n===F.Calendar_Week){var p,g=o.date.getDay(),m=d.default.settings.dayWeekStart.get();p=e<0?g>m?-g+m:-7:7-g+m,r+=this.getDayWidth()*p-l+1}else n===F.Calendar_Day&&(e<0&&l>200?r-=l:r+=this.getDayWidth()*e-l+1);this.setIgnoreRestoreScroll(),this.setScrollOffset(r,t)}},{key:"compareDate",value:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}},{key:"compareText",value:function(e,t){return e.localeCompare(t)}},{key:"comparePriority",value:function(e,t){var a=e.getPriority(this),i=t.getPriority(this);return i>a?1:i<a?-1:0}},{key:"compareBlockBase",value:function(e,t,a){try{l.default.PAssert(972,e,"Comparator was invalid")}catch(o){l.default.reportError(o)}var i,n=this.getSortOrderBlocks()||1;if(e&&(i=this.compareNoKey(t,a)*n||e(t,a)),0===i||void 0===i){var r=U[this.getViewMode()].Default,s=this._getBlockSortComparator(r);if(s!==e)return s(t,a)}return i*n}},{key:"compareBlockPriority",value:function(e,t){return t.priority-e.priority}},{key:"compareNoKey",value:function(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(e,t){return e.originalIndex-t.originalIndex}},{key:"compareBlockDate",value:function(e,t){return this.compareDate(e.date,t.date)}},{key:"compareBlockName",value:function(e,t){return this.compareText(e.name,t.name)}},{key:"compareBlockNumItems",value:function(e,t){return t.items.length-e.items.length}},{key:"compareBlockItemPriority",value:function(e,t){return this.comparePriority(e.item,t.item)}},{key:"compareBlockItemCreated",value:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareBlockItemModified",value:function(e,t){return this.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"compareBlockItemCompleted",value:function(e,t){return this.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"_getBlockSortComparator",value:function(e){return e===N.Alphabetical&&this.compareBlockName||e===N.Date&&this.compareBlockDate||e===N.NumItems&&this.compareBlockNumItems||e===N.Priority&&this.compareBlockItemPriority||e===N.Created&&this.compareBlockItemCreated||e===N.Modified&&this.compareBlockItemModified||e===N.None&&this.compareNone}},{key:"getBlockComparator",value:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}},{key:"compareItemBase",value:function(e,t,a){try{l.default.PAssert(973,e,"Comparator was invalid")}catch(r){l.default.reportError(r)}var i,n=this.getSortOrderItems();return e&&(i=e(t,a)*n),0===i||void 0===i?this.compareItemNone(t,a):i}},{key:"compareItemNone",value:function(e,t){return e.index-t.index}},{key:"compareItemDate",value:function(e,t){return this.compareDate(e.item.getNextDate(),t.item.getNextDate())}},{key:"compareItemName",value:function(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(e,t){return t.item.numItems()-e.item.numItems()}},{key:"_getItemSortComparator",value:function(e){return e===N.Alphabetical&&this.compareItemName||e===N.Date&&this.compareItemDate||e===N.NumItems&&this.compareItemNumItems||e===N.Priority&&this.compareBlockItemPriority||e===N.Created&&this.compareBlockItemCreated||e===N.Modified&&this.compareBlockItemModified||e===N.None&&this.compareItemNone}},{key:"getItemComparator",value:function(){var e,t=this.getSortModeBlocks();if(t===N.Date)e=this.compareItemDate;else if(t===N.Created)e=this.compareBlockItemCreated;else if(t===N.Modified)e=this.compareBlockItemModified;else if(t===N.Completed)e=this.compareBlockItemCompleted;else{var a=this.getSortModeItems();e=this._getItemSortComparator(a)}return this.compareItemBase.bind(this,e)}},{key:"getItemsOnDate",value:function(e){var t=0,a=[];for(var i=0;i<this._itemsWithDates.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._itemsWithDates[i];n.getMooDate().isOnDate(e)&&a.push(n)}return a}},{key:"findIndexOfNextBlock",value:function(){for(var e=0,t=new Date,a=this.items.get(),i=0;i<a.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=a[i];if("blockHeader"===n.type){var r=n.block;if(r.isOverdue||r.isNow||r.isToday||r.isStarred||r.isImportant||r.date>=t)return i}}return-1}},{key:"_keyHelper",value:function(e,t){var a=e["get"+t](this);if(a){if(a=a.map(function(e){return{value:e,lower:e.toLowerCase()}}),this.search.showOnlyMatchingTags()){var i=this.search["get"+t]();i&&i.length>0&&(i=i.map(l.default.toLowerCase),a=a.filter(function(e){for(var t=0,a=0;a<i.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.lower===i[a])return!0}}))}return a}if(!e.hasVisibleChildren(this)){for(var n=0,r=!0,s=e.parent();void 0!==s&&s!==this.getItem();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=s["get"+t](this);if(o)for(var u=0,d=0;d<o.length;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(this.blocksByKey[o[d].toLowerCase()]){r=!1;break}}s=s.parent()}if(r)return[this.blockNoKey]}}},{key:"_getKeysForItem",value:function(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var a=!0;if(this.isViewAgenda()&&e.hasAttachmentType(u.a.PluginType.Calendar)&&e.getDate()<Date.today()){var i=e.getAttachmentByType(u.a.PluginType.Calendar),n=i.getPlugin();n.shouldDisplayOverdueInAgenda()&&n.hasWritePermissionForAttach(i)||(a=!1)}if(a){var r=this._getDatesForItem(e);if(this.isViewAgenda()&&this.getSortModeBlocks()===N.Date&&!this.search.showOnlyAgendaDates()){var s=[];if(!e.isComplete()){if(e.isStarred(this)){var o="starred";d.default.timeline.getDateForKey(o)&&s.push(o)}if(e.isImportant(this)){o="important";d.default.timeline.getDateForKey(o)&&s.push(o)}}var l=e.getTagsLower();if(l)for(var c=0,h=0;l&&h<l.length;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f="#"+l[h];d.default.timeline.getDateForKey(f)&&s.push(f)}s.length>0&&(r=r?r.concat(s):s)}return r}}else if(t===F.Groups_Project){var p=e.parent();if(p===this.getItem()&&!e.isPrefixHeader())return[this.blockNoKey];if(p&&p.isPrefixHeader()&&p!==this.getItem()&&(this.search.showChildProjects()||p.parent()===this.getItem()))return[p.id]}else{if(t===F.Groups_Tag)return this._keyHelper(e,"Tags");if(t===F.Groups_Contact)return this._keyHelper(e,"Contacts");if(t===F.Groups_Priority){var g=e.getPriority(this);if(g)return[g];if(!e.hasVisibleChildren(this)){for(var m=0,v=(a=!0,e.parent());void 0!==v&&v!==this.getItem();){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;if(v.getPriority(this)){a=!1;break}v=v.parent()}if(a)return[this.blockNoKey]}}}}},{key:"isOkOnAgenda",value:function(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}},{key:"_getDatesForItem",value:function(e){var t,a=this,i=this.getSortModeBlocks();if(this.isViewCalendar()||i===N.Date){var n=e.getMooDate();if(e.isComplete()&&this.isViewAgenda())e.dateCompleted>=Date.today()&&(t=e.dateCompleted);else if(n){var r=n.getAllDates();return r.length>10&&n.isRepeatDate()&&!n.isRange()&&(r=r.slice(0,10)),r.filter(function(e){return a.isDateWithinRange(e)})}}else if(i===N.Created||i===N.Completed||i===N.Modified){var s=i===N.Created&&e.dateCreated||i===N.Completed&&e.dateCompleted||i===N.Modified&&e.dateModified;s&&(!this.startDate||s>=this.startDate)&&(t=s)}if(t&&this.isDateWithinRange(t))return[t]}},{key:"isDateWithinRange",value:function(e){return e&&(!this.endDate||e<this.endDate)}},{key:"_getKeyForDate",value:function(e){var t=Date.today();if(!(this.combineOverdue&&e<t)){var a=u.a.DFormat.MonthDayYearLong,i=d.default.International.getFormat(a);return e.toString(i)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var e,t=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var a=0;this._itemsWithDates=[];for(var i=0;i<this._allPaneItems.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this._allPaneItems[i];if(n.getMooDate()){var r=n.getAttachmentByType(u.a.PluginType.Calendar),s=r&&r.getField("calendarID");(s?!1!==this.displayCalendars.get()[s]:this.displayLocalItems.get())&&this._itemsWithDates.push(n)}}t===F.Calendar_Month?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var e,t=0;this.blocks=[],this.blocksByKey={},this.isViewAgenda()&&this.getBlock(Date.today());for(var a=0;a<this._allPaneItems.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._allPaneItems[a],n=!i.isNote();if(n)if(i.getMooDate()){var r=i.getAttachmentByType(u.a.PluginType.Calendar),s=r&&r.getField("calendarID");n=s?!1!==this.displayCalendars.get()[s]:this.displayLocalItems.get()}n&&this.addToBlock(this._allPaneItems[a])}this.isViewAgenda()?e=this.compareBlockDate:this.isViewPriority()?e=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(e=this.getBlockComparator()),e&&this.blocks.sort(e)}},{key:"addItemToPaneObjects",value:function(e,t,a,i,n,r){n=n||0;var s=new O.a({type:"blockItem",item:a,id:t.getItemID(a)+(r?"_"+r.id:""),pane:this,block:t,parentObject:r,index:e.length,levelsDeep:n,sizeInPane:a.sizeInPane});if(this.addPaneObject(e,s),a.hasNote()&&(s.noteObject=this.addItemToPaneObjects(e,t,a.getNote(),i,n,r)),i&&!a.isCollapsed(this)){var o=a.getVisibleChildren(this);if(o)for(var l=0,u=0;u<o.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;this.addItemToPaneObjects(e,t,o[u],i,n+1,s)}}return s}},{key:"updatePaneObjects",value:function(){var e,t,a,i,n=0,r=[],s=this.search.showHierarchy(),o=this.isViewAutoBlocks();for(a=0;a<this.blocks.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=this.blocks[a],d=this.isBlockCollapsed(l)&&(a===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[a+1]));if(l.item?(t=l.item,i=new O.a({type:"blockItem",item:t,id:t.id+"_"+l.id,pane:this,block:l,index:r.length,levelsDeep:0,sizePad:d?l.heightOfSpaceBetween():l.isCollapsed()?0:4,sizeInPane:t.sizeInPane,isBlockHeader:!0}),this.addPaneObject(r,i),t.hasNote()&&!this.isBlockCollapsed(l)&&this.addItemToPaneObjects(r,l,t.getNote(),s,0,i)):this.isViewProjectNoBlocks()||this.addPaneObject(r,new O.a({type:"blockHeader",block:l,id:l.id,pane:this,index:r.length,isToday:l.isToday,isOverdue:l.isOverdue,isFirstCollapsed:e&&l.isCollapsed()&&!e.isCollapsed(),sizePad:d?l.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&l.isDate?4:0,sizeInPane:l.heightOfHeader})),1===this.blocks.length&&this.isViewProject()||!this.isBlockCollapsed(l)){for(var c=0,h=!1,f=l.getAllItemsSorted(!s&&!o),p=0;p<f.length;p++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;t=f[p],i=this.addItemToPaneObjects(r,l,t,s),!h&&this.isViewAgenda()&&this.shouldShowTime(i)&&!t.getTime()&&(i.showAllDay=!0,h=!0)}this.addPaneObject(r,new O.a({type:u.a.BlockType.AddItem,id:l.id+"_add",pane:this,block:l,index:r.length,sizeInPane:l.noAddButton?l.heightOfSpaceBetween():l.heightOfAddButton(),addFn:l.addItem}))}e=l}this.isViewProject()&&!this.isViewProjectNoBlocks()&&((l=this.getBlock("newProject")).isNewProject=!0,this.addPaneObject(r,new O.a({type:u.a.BlockType.Header,block:l,id:l.id,pane:this,index:r.length,sizeInPane:l.heightOfHeader}))),this.items.set(r)}},{key:"addToBlock",value:function(e){this.isViewProject()&&e.isPrefixHeader()&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var a=0,i=0;i<t.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=this.getBlock(t[i],e);n&&n.addItem(e)}}},{key:"_addFnBase",value:function(e,t,a,i,n){e=d.default.settings.getDefaultItemText(i)+e,this.clearPreventUpdate(),d.default.PaneUpdateBatcher.beginUpdateItems(),R.d.beginAction();var r={text:e};n&&(r=l.default.extend(r,n));var s=this.createVMLI(r,{parent:a,changeType:u.a.ChangeType.AllLocal,isEditable:!0});a.insertItem(s),R.d.performAction(R.b.Create,{itemID:s.id,parent:a.id,position:a.numItems(),text:e}),R.d.endAction(),d.default.PaneUpdateBatcher.commitUpdateItems();var o=this.indexOfItem(s,t);o>=0&&x.a.selectIndex(o,0)}},{key:"addFnProject",value:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():w.a.getItem(e.id))}},{key:"addFnTag",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnDate",value:function(e){var t,a="";return e.isDate?(a=" "+u.a.CharDate,t={date:e.date}):e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:u.a.VMLIFlag.P2}:a=" "+e.id,this._addFnBase(a,e,this.getItem(),void 0,t)}},{key:"addFnContact",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnPriority",value:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}},{key:"getDateForSoftDate",value:function(e){var t=d.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var a=100*Math.round(t/100),i={days:Math.round(a/100),minutes:Math.round(t-a)};return Date.today().add(i)}}},{key:"getBlock",value:function(e,t){var a,i=this.isViewDates(),n=this.isViewAgenda(),r=e;if(i&&!l.default.isString(e))a=e,r=e=this._getKeyForDate(a),"overdue"===e&&(!t.isComplete()&&d.default.timeline.getDateForKey(e)||(e=void 0),a=void 0);else if(l.default.isObject(e)){try{l.default.PAssert(974,e.value&&e.lower,"If key is object it should have this form")}catch(p){l.default.reportError(p)}r=e.lower,e=e.value}if(e){var s,o=this.isViewAutoBlocks()?void 0:w.a.getItem(e),c=this.getViewMode(),h=this.blocksByKey[r];if(!h)if(void 0!==(s=o?o.getStyledTextAsOneLine(!0):this.isViewPriority()?e===u.a.VMLIFlag.P0?"High":e===u.a.VMLIFlag.P1?"Medium":e===u.a.VMLIFlag.P2?"Low":"(No priority)":e)){var f={pane:this,id:e,name:s,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||n&&this.addFnDate};this.isViewTag()?(f.name=e===this.blockNoKey?"(No tag)":"#"+f.name,f.isTag=!0):this.isViewContact()?(f.name=e===this.blockNoKey?"(No contact)":"+"+f.name,f.isContact=!0):this.isViewPriority()&&(f.isPriority=!0,f.priority=e),c===F.Groups_Project&&(f.name=e===this.blockNoKey?"(No project)":f.name,f.item=o,f.isEditable=!0,f.date=o&&o.getDate(this)),e===this.blockNoKey&&(f.isNoKey=!0),i&&(a?(f.date=a.clone().clearTime(),f.isDate=!0,f.date.equals(Date.today())&&(f.isToday=!0)):(f.date=this.getDateForSoftDate(e),f.name=f.name.toUpperCase(),"now"===e?f.isNow=!0:"starred"===e?f.isStarred=!0:"important"===e?f.isImportant=!0:"overdue"===e&&(f.isOverdue=!0,f.noAddButton=!0))),h=new A(f),this.blocksByKey[r]=h,h.originalIndex=this.blocks.length,this.blocks.push(h)}}return h}},{key:"closestIndexOfObject",value:function(e){return this.indexOfItem(e,e.block,e.index)}},{key:"onGCalendarActiveChanged",value:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"onGmailActiveChanged",value:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"_refreshPaneData",value:function(){var e=d.default.pluginManager.getPluginGCalendar();e.isActive()&&e.forceRemoteEventSync()}},{key:"viewModeIcon",value:function(){var e=this.getViewMode();return u.a.TaskViewModeIcon[e]}},{key:"viewModeColor",value:function(){return this.isViewOutline()?"#09d":"#a30"}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewGroups",value:function(){return this._isViewHelper.groups}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"isViewItems",value:function(){return this._isViewHelper.items}},{key:"isViewArchived",value:function(){return this._isViewHelper&&this._isViewHelper.archived}},{key:"isViewDeleted",value:function(){return this._isViewHelper&&this._isViewHelper.deleted}},{key:"canScrollToItem",value:function(){return!this.isViewCalendar()&&this.isViewItems()}},{key:"isViewPremiumBlocked",value:function(){return!d.default.billingManager.hasPremiumFeatures()&&u.a.TaskViewModesPremium[this.getViewMode()]}},{key:"shouldShowAddBox",value:function(){return this.canAddItem&&(this.isViewOutline()||this.isViewProject()||this.isViewAgenda())}},{key:"isCalFilterActive",value:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var a in e)if(e.hasOwnProperty(a)&&!1===e[a]){t=!0;break}return t}},{key:"becomeReal",value:function(){_()(y()(t.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(){var e=this;this.isFakePane?this.setupViewStateMinor():(l.default.setItemAnimationMode(u.a.ItemAnimationMode.None),this.setIgnoreRestoreScroll(void 0,function(){e._infiniteList.saveScrollOfTop()}),this.setupViewState(!0),this._infiniteList.clearCache(),this._infiniteList.alwaysRenderScroll=!0,this.isViewCalendar()||this._infiniteList.setInitialScrollOffset(0),this.updateItemsImmediate(!0,void 0,void 0,!0),d.default.PaneManager.updatePaneStateForPane(this),this.isViewDates()?(this.scrollToToday(u.a.ScrollDuration.Snap),requestAnimationFrame(function(){e.isViewDates()&&(e.scrollToToday(u.a.ScrollDuration.Snap),l.default.resetItemAnimationMode(),requestAnimationFrame(function(){e._infiniteList.alwaysRenderScroll=!1}))})):this.setScrollOffset(0,u.a.ScrollDuration.Snap),l.default.resetItemAnimationMode(),this.hasCollapsedObs.set(this.hasCollapsed()))}},{key:"setupViewStateMinor",value:function(){var e=this.getViewMode(),t=this.getSortModeBlocks(),a={agenda:e===F.Agenda_Today||e===F.Agenda_Week||e===F.Agenda_All,calendar:e===F.Calendar_Day||e===F.Calendar_Week||e===F.Calendar_Month||e===F.Calendar_Custom,calendarHoriz:e===F.Calendar_Day||e===F.Calendar_Week||e===F.Calendar_Custom,calendarMonth:e===F.Calendar_Month,project:e===F.Groups_Project,groups:e===F.Groups_Project||e===F.Groups_Tag||e===F.Groups_Contact||e===F.Groups_Priority,outline:e===F.Outline||e===F.List_Flat||e===F.Archived||e===F.Deleted,flatList:e===F.List_Flat,tag:e===F.Groups_Tag,contact:e===F.Groups_Contact,priority:e===F.Groups_Priority,archived:e===F.Archived,deleted:e===F.Deleted,items:e!==F.Archived&&e!==F.Deleted};a.dates=a.agenda||a.calendar,a.autoBlocks=a.agenda||a.tag||a.contact||a.priority,a.text=!a.calendar,this._isViewHelper=a,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(U[e].Default,1,!1),(t=this.getSortModeBlocks())===N.Completed&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(e){this.setupViewStateMinor();var t,a=this.getViewMode(),i=this.getSortModeBlocks(),n=this.isViewOutline(),r=this.isViewCalendar()||l.default.activeDisplayMode&u.a.DisplayMode.NoPaneTop?0:(this.isViewAgenda()||this.isViewProject()?48:36)||!1,s=this.isViewItems();if(this.canAddItem=s,this.supportCompleting=s,this.supportCheckbox=s,this.supportPerformArchive=s,this.supportIndent=s,this.supportClone=s,this.hasMoreButtons=s,this.contextMenuMode=(this.isViewArchived()?"Archived":this.isViewDeleted()&&"Deleted")||"Normal",this.isEditable=s,this.isDraggable=s,this.isDropTarget=s,this.search.setFilterEnabled("complete",s),this.blockNoKey=B+"_"+a,this.supportIndent=n,this.supportMultiselect=n,this.overviewTracksScroll=n,this.supportSearchFlat=n||d.default.settings.testBetaFeatures.get()&&!this.isViewCalendar(),this.supportCheckbox=!this.isViewCalendar(),this.topBoxHeight.set(r,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewArchived()?"No archived items":this.isViewDeleted()&&"No deleted items")||this.isViewAgenda()&&"Nothing on the agenda"||this.isViewOutline()&&"Write some things here to get started"||"",this.collapsedFieldName=u.a.PerPaneStateField.Collapsed+(this.viewState?a:""),this._isSearchedFlat=!(this.isViewCalendar()||!this.search)&&!this.search.showHierarchy(),this.isViewPremiumBlocked()?this.toast.set({text:"The "+u.a.TaskViewModeText[a]+" view is a Premium feature",actionText:"GO TO OUTLINE",doAction:this.switchToOutline}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(t=u.a.ItemStoreFilter.Dates,(this.isViewCalendar()||this.getSortModeBlocks()===N.Date)&&(t|=u.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=t,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&i===N.Date,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var o,c;if(a!==F.Agenda_All)a===F.Agenda_Today?c=1:a===F.Agenda_Week&&(c=7),o=Date.today().addDays(i===N.Date?c:-(c-1));i===N.Date?this.endDate=o:(this.startDate=o,this.endDate=Date.today().addDays(1))}this.isEditable=this.supportSel=s&&!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?u.a.Orientation.Horizontal:u.a.Orientation.Vertical),a===F.Calendar_Week||a===F.Calendar_Month?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=u.a.StdPaneWidthMin,this.minWidthFlex=u.a.StdPaneWidthMin,this.maxWidth=u.a.PaneWidthMax,this.maxWidthFlex=this.maxWidthSingle=u.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),d.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask pane"+((this.isViewCalendar()?"Calendar":this.isViewAgenda()&&"Agenda")||this.isViewProject()&&"Project"||this.isViewTag()&&"Tag"||this.isViewContact()&&"Contact"||this.isViewPriority()&&"Priority"||this.isViewOutline()&&"Outline")}},{key:"onScroll",value:function(){this.getViewMode();this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(e,t,a,i,n,r,s){if(e&&l.default.findParent(a,"paneContent")&&!l.default.hasClass(a,"paneContent")&&!l.default.hasClass(a,"paneTopBox")&&n&&"blockHeader"===n.type&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var o,u=l.default.getListCellForElement(a);return u&&u.props.cell&&(o=u.props.cell.paneObject.block,this.isViewAgenda()&&o.isOverdue&&(o=void 0)),this.dragHoveredBlock.set(o),d.default.DragDrop.setBlockTarget(o),{block:o}}if(!n||"blockItem"===n.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||d.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(e,t,a,i,n,r,s)}},{key:"_handleDragOverTasks",value:function(e,t,a,i,n,r,s){var o,d,c,h,f,p,g=!1,m=u.a.DragDropPosition.Below,v=!1,y=0;if(n){o=n.item,p=n.index,o.isNote()&&(p--,n=this.objectAtIndex(p),i=this.elementAtIndex(p),o=o.parent()),o.hasNote()&&(y=this.sizeOfItem(o.getNote(),p+1));var k=i.getBoundingClientRect(),_=k.height+y;m=this.isSearchedFlat()&&this.search.isFlatSearchResult(o)||this.isViewAgenda()||this.isViewAutoBlocks()?u.a.DragDropPosition.On:s<k.top+.38*_&&(!this.isViewProject()||0!==n.levelsDeep)?u.a.DragDropPosition.Above:s>k.top+.62*_?u.a.DragDropPosition.Below:u.a.DragDropPosition.On,c=i,g=!0}else if(0===this.numItems())o=this.getItem(),v=!0;else if(this.isSearchedFlat()||!l.default.findParent(a,"paneScroller")||this.isViewProject())o=this.getItem(),v=!0,h=!0;else{var S=this.indexOfLastItem();if(!g&&S>=0&&this.isIndexMounted(S))if(s>=(f=this.elementAtIndex(S)).getBoundingClientRect().bottom)o=this.getLastItem(),n=this.getLastObject(),c=f,m=u.a.DragDropPosition.Below,g=!0}if(!g&&!this.isSearchedFlat()){var P=this&&this.indexOfFirstItem();if(this&&P>=0&&this.isIndexMounted(P))if(s<(f=this.elementAtIndex(P)).getBoundingClientRect().top)o=this.getFirstItem(),n=this.getFirstObject(),c=f,m=this.isViewProject()&&0===n.levelsDeep?u.a.DragDropPosition.On:u.a.DragDropPosition.Above,g=!0}if(g){var w=c.getBoundingClientRect(),I=m!==u.a.DragDropPosition.Below?w.top:w.top+w.height+y,b=m===u.a.DragDropPosition.On?w.height:void 0;if(I>this.contentTop()){var D;m===u.a.DragDropPosition.Below&&p+1<this.numItems()&&o.hasChildren()&&((D=this.objectAtIndex(p+1)).item||(D=void 0)),D=D||n;var E=this.getPaddingForPaneObject(D);d={left:w.left+E,top:I,width:w.right-w.left-E,height:b}}}return this.scrollFromMousePosition(r,s,this.orientation.get()===u.a.Orientation.Horizontal),{position:m,targetElement:c,targetItem:o,linePosition:d,overview:!1,dropOnPane:v,atEnd:h}}},{key:"handleDragDrop",value:function(e,a,i,n){var r=this,s=d.default.DragDrop.blockTarget;if(s){var o=function(){d.default.DragDrop.startPane.applyDropOnBlock(s,e,r,a.dataTransfer.block),r.revertDrag()},l=a.dataTransfer.pane,u=l.getDocument();if(this===l||!this.isViewCalendar()||u===this.getDocument())return o(),!0;d.default.menus.confirm("Dropping onto the calendar of a different document. Do you want to move this item to ".concat(u.text.get(),"?"),function(t){t&&(r._handleDragDrop(e,a.dataTransfer,{targetItem:r.getRootItem(),dropOnPane:!0},a,n),o())})}else if(!this.isViewAutoBlocks())return _()(y()(t.prototype),"handleDragDrop",this).call(this,e,a,i,n)}},{key:"revertDrag",value:function(){_()(y()(t.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var e=_()(y()(t.prototype),"getSaveInfo",this).call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed.get(),e}},{key:"isBlockCollapsed",value:function(e){return e.item?e.item.isCollapsed(this):!0===this.blocksCollapsed.get()[e.id]}},{key:"setBlockCollapsed",value:function(e,t){x.a.reset();this.blocksCollapsed.get();this.blocksCollapsed.set(Object.assign({},this.blocksCollapsed.get(),h()({},e.id,t))),this.hasCollapsedObs.set(this.hasCollapsed()),this.updateBlockItems(),d.default.PaneManager.savePaneState()}},{key:"onInfiniteListLoaded",value:function(){!this.initialOffset&&this.isViewCalendar()&&(this.initialOffset=this.getScrollOffsetOfToday()||0,this._infiniteList.setInitialScrollOffset(this.initialOffset))}},{key:"addProject",value:function(e,t,a){return this.addItem({index:e,prefix:u.a.Prefix.Header,text:t,toRoot:a})}},{key:"onTapAddItem",value:function(){_()(y()(t.prototype),"onTapAddItem",this).call(this)}},{key:"addItem",value:function(e){var t=e.index,a=e.prefix,i=e.text,n=e.toRoot;e.date,e.e;t=t||0,i=i||"",void 0===a&&(a=d.default.settings.getDefaultItemText()),d.default.PaneUpdateBatcher.beginUpdateItems(),x.a.reset(),this.setIgnoreRestoreScroll();var r=n?this.getRootItem():this.getItem(),s={text:(a?a+" ":"")+i};1===this.search.getFilterValue("complete")&&(s.isComplete=!0),1===this.search.getFilterValue("starred")&&(s.isStarred=!0);var o=this.search.getFilterValue("priority");o&&(s.priority=o);var c=r.addItemAtIndex(s,t,this);if(this.isViewProject()&&a===u.a.Prefix.Header){var h=d.default.settings.getDefaultItemText();c.addItemAtIndex({text:h},t,this)}if(this.paneContent&&(x.a.focusPane(this),t>=0)){var f=s.text.length;x.a.selectIndex(t,f)}d.default.PaneUpdateBatcher.commitUpdateItems();var p=this.indexOfItem(c);return this.scrollIndexIntoView(p),x.a.selectIndex(p,s.text.length),l.default.sendEvent("Menu","AddItemButton"),c}},{key:"setDisplayLocal",value:function(e){this.displayLocalItems.set(e),this.updateItems()}},{key:"setDisplayCalendar",value:function(e,t){var a=l.default.clone(this.displayCalendars.get());a[e.id]=t,this.displayCalendars.set(a),this.updateItems()}},{key:"getCollapsedDefault",value:function(e,t,a){return t?e.parent()!==this.getRootItem():(a=a||this.getViewMode(),!(this.isViewOutline()||this.isViewProject()&&e.isPrefixHeader()&&this.isItemTopLevel(void 0,e)))}},{key:"getWidth",value:function(){var e=_()(y()(t.prototype),"getWidth",this).call(this);return this.isViewCalendar()&&!this.isViewCalendarMonth()&&(e-=50),e}},{key:"getMonthStart",value:function(e){return e.clone().clearTime().addDays(1-e.getDate())}},{key:"getWeekStart",value:function(e){return e.clone().clearTime().addDays(-e.getDay()+d.default.settings.dayWeekStart.get())}},{key:"doesWeekCrossMonth",value:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var e,t,a,i=0,n=0,r=[],s=this.dateInMiddle,o=this.getWeekStart(s),l=u.a.CalendarMonthViewNumWeeksPad;for(a=0;a<=l;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=-l-1+a;e=o.clone().addWeeks(d),(t=this.doesWeekCrossMonth(e))&&r.push(this.updateCalendarMonthWeek(r.length,e,!0,!1)),r.push(this.updateCalendarMonthWeek(r.length,e,!1,t))}for(l=2*u.a.CalendarMonthViewNumWeeksPad+1,a=0;r.length<l;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=o.clone().addWeeks(a),(t=this.doesWeekCrossMonth(e))&&r.length<l&&r.push(this.updateCalendarMonthWeek(r.length,e,!0,!1)),r.push(this.updateCalendarMonthWeek(r.length,e,!1,t))}this.items.set(r)}},{key:"updateCalendarMonthWeek",value:function(e,t,a,i){for(var n,r,s=0,o=[],l=1===t.getDate(),u=0;u<7;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=t.clone().addDays(u);n&&d.getDate()<n.getDate()&&(l=!0),!l&&i||l&&a||(o[u]={date:d,items:this.getItemsOnDate(d)},r||(r=d)),n=d}return new O.a({type:"calendarWeek",id:"week_"+t+(a?"_end":""),pane:this,date:r,dates:o,sizeInPane:this.heightWeek(),index:e})}},{key:"heightWeek",value:function(){return u.a.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var e=0,t=[],a=u.a.CalendarDayViewNumDaysPad,i=this.dateInMiddle,n=this.getViewMode(),r=-a;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=i.clone().addDays(r),o=(this._getKeyForDate(s),this.getItemsOnDate(s));t.push(new O.a({type:"calendarDay",id:n+"_day_"+(r+a),pane:this,date:s,items:o,sizeInPane:this.getDayWidth}))}this.items.set(t)}},{key:"getItemPlacementOnDate",value:function(e,t){var a=!e.getDate(),i=e.getNextDate(t),n=e.getDuration()&&i&&e.getEndDate();if(i&&i.hasTimeOfDay()&&(a||i.isSameDay(t))){var r=i.getHours()+i.getMinutes()/60,s=e.getDuration()?e.getDuration()/u.a.MSPerHour:1;if(s=Math.round(10*Math.min(s,24-i.getHours()))/10,r>0||s<24)return{time:r,duration:s}}else if(i&&i.hasTimeOfDay()&&n&&!i.isSameDay(t)&&n.isSameDay(t)){return{time:0,duration:n.getHours()+n.getMinutes()/60}}return!1}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),a=this.inViewCount(),i=1,n=t;n<t+a;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.items.get()[n];if(r){for(var s=0,o=0,l=r.items||[],u=0;u<l.length;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=l[u];this.getItemPlacementOnDate(d,r.date)||o++}o>i&&(i=o)}}this.numAllDay.set(i)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(u.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var e=this.getWidth(),t=this.getViewMode(),a=(t===F.Calendar_Day?1:t===F.Calendar_Week&&7)||t===F.Calendar_Custom&&d.default.settings.calendarCustomDays.get();return Math.max(e/a,40)}},{key:"getPaddingForPaneObject",value:function(e,a){var i=_()(y()(t.prototype),"getPaddingForPaneObject",this).call(this,e,a);return a||(i+=this.extraPaddingForPaneObject(e)),i}},{key:"extraPaddingForPaneObject",value:function(e){return this.isViewAgenda()?u.a.PaddingAgendaTime:0}},{key:"shouldShowTime",value:function(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeep&&e.block&&e.block.shouldShowTime()}},{key:"isSearchedFlat",value:function(){return this._isSearchedFlat}},{key:"isItemTopLevel",value:function(e,a){var i=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;i=a.isPrefixHeader(this)}return this.isViewProject()&&this.search.showChildProjects()||(i=_()(y()(t.prototype),"isItemTopLevel",this).call(this,e,a)),i}},{key:"openViewMenu",value:function(e){d.default.menus.openContextMenu({componentName:"ReactContextMenuPanes",element:e.target,pane:this,positionOffset:{left:45},subset:u.a.PaneMode.Task})}},{key:"hasCollapsed",value:function(e){if(!e&&this.isViewAutoBlocks()){for(var a=0,i=0;this.blocks&&i<this.blocks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.isBlockCollapsed(this.blocks[i]))return!0}return!1}return _()(y()(t.prototype),"hasCollapsed",this).call(this,e)}},{key:"toggleCollapseAll",value:function(){var e=!this.hasCollapsed();if(this.isViewAutoBlocks()){for(var a=0,i=l.default.clone(this.blocksCollapsed.get()),n=0;n<this.blocks.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[this.blocks[n].id]=e}this.blocksCollapsed.set(i),e||(e=void 0)}_()(y()(t.prototype),"collapseAll",this).call(this,this.item.get(),e,void 0,this.isViewAutoBlocks())}},{key:"getSupportedSortBlocksModes",value:function(){return U[this.getViewMode()].Available}},{key:"supportsSortBlocks",value:function(e){return e=e||this.getViewMode(),t.viewModeSupportsSortBlocks(e)}},{key:"supportsSortBlocksMode",value:function(e,a){return a=a||this.getViewMode(),t.viewModeSupportsSortBlocksMode(e,a)}},{key:"supportsSortItems",value:function(e){return e=e||this.getViewMode(),t.viewModeSupportsSortItems(e)||this.isViewOutline()&&this.isSearchedFlat()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var e=this.getSortModeBlocks();return e&&e!==N.None}},{key:"setSortModeBlocks",value:function(e,t,a){this.setViewProp("sortModeBlocks",{mode:e,order:t},a)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(e,t,a){this.setViewProp("sortModeItems",{mode:e,order:t},a)}},{key:"isSortedItems",value:function(){var e=this.getSortModeItems();return e&&e!==N.None}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){this.setViewProp("viewMode",e)}},{key:"setViewProp",value:function(e,t,a){var i=this.viewState.get();i[e]!==t&&(i[e]=t,this.viewState.set(i,!1!==a))}},{key:"createVMLI",value:function(e,a){var i=this.search.getTags();if(!this.isViewTag()&&i)for(var n=0,r=0;r<i.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[r],o="#"+s;if(e.text.indexOf(o)<0){for(var l=0,u=!1,d=a&&a.parent;d;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=d.getTags();if(c&&c.indexOf(s)>=0){u=!0;break}d=d.parent()}u||(e.text+=" "+o)}}return _()(y()(t.prototype),"createVMLI",this).call(this,e,a)}},{key:"getItemDisplayTime",value:function(e){var t=this.getSortModeBlocks(),a=e.item;return t===N.Date?a.getTime()||(e.showAllDay?"All day":""):t===N.Created?a._formatDateTime(a.dateCreated):t===N.Completed?a.dateCompleted?a._formatDateTime(a.dateCompleted):"no time":t===N.Modified?a.dateModified?a._formatDateTime(a.dateModified):"no time":void 0}},{key:"checkFlatListMode",value:function(){if(!d.default.settings.testBetaFeatures.get()){var e=this.getViewMode();e===F.List_Flat&&0===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(F.Outline),e===F.Outline&&1===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(F.List_Flat)}}},{key:"onCalendarCustomDaysChanged",value:function(){this.getViewMode()===F.Calendar_Custom&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode(F.Outline)}},{key:"shouldRenderPrefix",value:function(e){return e.item.hasPrefix()&&!(this.isViewProject()&&e.isBlockHeader)}},{key:"bottomListMessage",value:function(){var e;if(!(this.numItems()>0)){var t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}},{key:"needsUpdateForDate",value:function(){return this.isViewDates()}},{key:"needsUpdateForPriority",value:function(){return this.isViewPriority()||this.isViewAgenda()}},{key:"needsUpdateForModified",value:function(){return this.getSortModeBlocks()===N.Modified||this.getSortModeItems()===N.Modified}},{key:"_anyTagHasKey",value:function(e){return e&&e.some(function(e){return d.default.timeline.getDateForKey("#"+e)})}},{key:"needsUpdateForTags",value:function(e){return this.isViewAgenda()&&this._anyTagHasKey(e)}},{key:"handleItemChanged",value:function(e,a){var i=!1;return(a.Tags&&this.isViewTag()||a.Text&&this.isViewContact())&&(i=!0),_()(y()(t.prototype),"handleItemChanged",this).call(this,e,a,i)}},{key:"setDocument",value:function(e,a){_()(y()(t.prototype),"setDocument",this).call(this,e,a,!0),this.onViewStateChanged()}},{key:"getItem",value:function(e){var a=this.getDocument();return e||this.isViewItems()?_()(y()(t.prototype),"getItem",this).call(this):this.isViewArchived()?a.getRootArchivedItem():this.isViewDeleted()?a.getRootDeletedItem():void 0}},{key:"getRootItem",value:function(){var e=this.getDocument();return this.isViewArchived()?e.getRootArchivedItem():this.isViewDeleted()?e.getRootDeletedItem():_()(y()(t.prototype),"getRootItem",this).call(this)}},{key:"handleRightSideTap",value:function(e,a){this.isViewArchived()?(e.unArchive(u.a.ChangeType.Local),x.a.reset()):this.isViewDeleted()?(e.unDelete(u.a.ChangeType.Local),x.a.reset()):_()(y()(t.prototype),"handleRightSideTap",this).call(this,e,a)}},{key:"getNewViewMode",value:function(){return this.isViewCalendar()?"Calendar":this.isViewArchived()?"Archived":this.isViewDeleted()?"Deleted":this.search.showHierarchy()?"Outline":"List"}},{key:"getNewViewGroup",value:function(){if(!this.isViewCalendar()){var e=this.getViewMode(),t=(e===F.Groups_Project?"Project":e===F.Groups_Tag&&"Tag")||e===F.Groups_Contact&&"Contact"||e===F.Groups_Priority&&"Priority"||this.isViewAgenda()&&"Agenda"||"None";if("Agenda"===t){var a=this.getSortModeBlocks();a===N.Created?t="Created":a===N.Modified?t="Modified":a===N.Completed?t="Completed":this.search.showOnlyAgendaDates()&&(t="Date")}return t}}},{key:"getViewModeText",value:function(){var e,t=this.getViewMode(),a=this.getSortModeBlocks(),i=this.getSortModeItems(),n=a&&a!==u.a.TaskSortMode.None;if(d.default.settings.testBetaFeatures.get()){var r=this.getNewViewGroup();e=this.getNewViewMode()+(r&&"None"!==r?": "+r:""),this.isViewCalendar()?(e+=": "+u.a.TaskViewModeText[t],t===u.a.TaskViewMode.Calendar_Custom&&(e=e.replace("#",d.default.settings.calendarCustomDays.get()))):this.isViewAgenda()?(t===F.Agenda_Week&&(e+=", Week"),t===F.Agenda_Today&&(e+=", Today")):(n&&(e+=", "+u.a.TaskSortModeText[a]),i&&i!==u.a.TaskSortMode.None&&(e+=", "+u.a.TaskSortModeText[i]))}else e=u.a.TaskViewModeTextSimple[t],n&&(e+=": "+u.a.TaskSortModeText[a]),i&&i!==u.a.TaskSortMode.None&&(e+=(n?", ":": ")+u.a.TaskSortModeText[i]);return e}}],[{key:"viewModeSupportsSortBlocks",value:function(e){return!!U[e]}},{key:"viewModeSupportsSortBlocksMode",value:function(e,t){return U[t]&&U[t].Available.indexOf(e)>=0}},{key:"viewModeSupportsSortItems",value:function(e){return e===F.Groups_Project||e===F.Groups_Tag||e===F.Groups_Contact||e===F.Groups_Priority}}]),t}(M.a),H=a(42),j=u.a.TaskViewMode,z=function(){function e(){r()(this,e),this._inactivePaneTypes={},this.activePaneTypes=new H.a,this._registeredTypes={},this.numInactivePanes=new T.a(0),this.registerPaneType(void 0,u.a.PaneMode.Task,"Task",V,"icon-align-left",99)}return o()(e,[{key:"paneSortCompare",value:function(e,t){return e.priority<t.priority?1:-1}},{key:"registerPaneType",value:function(e,t,a,i,n,r){this._registeredTypes[t]={plugin:e,constructor:i};var s={type:t,name:a,icon:n,text:a,priority:r,tooltip:"Add "+a+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(s,this.paneSortCompare):(this._inactivePaneTypes[t]=s,this.numInactivePanes.set(this.numInactivePanes.get()+1))}},{key:"activatePaneType",value:function(e){var t=this._inactivePaneTypes[e];try{l.default.PAssert(563,t,"Must have previously registered pane type")}catch(a){l.default.reportError(a)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)}},{key:"deactivatePaneType",value:function(e){var t=this.activePaneTypes.get().find(function(t){return t.type===e});this.activePaneTypes.remove(function(t){return t.type===e});try{l.default.PAssert(564,t,"Must have previously activated pane type")}catch(a){l.default.reportError(a)}d.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)}},{key:"canCreatePane",value:function(e){var t=this._registeredTypes[e];return!(t.plugin&&(!t.plugin.isActive()||t.plugin.isPluginBlocked()))}},{key:"createPane",value:function(e,t){(t=t||{}).id||(t.id=d.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=u.a.PaneMode.Task,t.viewState={viewMode:j.Agenda_All}):"PaneOutline"===e?(e=u.a.PaneMode.Task,t.viewState={viewMode:j.Outline}):"PaneArchived"===e&&(e="PaneTask",t.viewState={viewMode:j.Archived});var a=this._registeredTypes[e];if(a){if(!a.plugin||a.plugin.isActive()&&!a.plugin.isPluginBlocked())try{d.default.PaneUpdateBatcher.beginUpdateItems();var i=new a.constructor(t);return d.default.PaneUpdateBatcher.commitUpdateItems(),i}catch(n){return void l.default.reportError(n)}}else try{l.default.PAssert(565,!1,"Invalid pane type requested")}catch(r){l.default.reportError(r)}}},{key:"isPaneTypeActive",value:function(e){var t=!!this._registeredTypes[e],a=!!this._inactivePaneTypes[e];return t&&!a}},{key:"getRegisteredPanes",value:function(){return this.activePaneTypes.get()}},{key:"_getTaskView",value:function(e,t,a,i){for(var n=0,r=[],s=0;s<a.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=a[s],l=u.a.TaskViewModeText[o];o===j.Calendar_Custom&&(l=l.replace("#",d.default.settings.calendarCustomDays.get())),r.push({text:l,type:u.a.PaneMode.Task,viewMode:o,icon:u.a.TaskViewModeIcon[o],premium:!!u.a.TaskViewModesPremium[o],canZoom:!0})}e.push({text:t,viewModes:r,border:!i})}},{key:"getAvailablePanes",value:function(e){var t=this.activePaneTypes.get(),a=this.numInactivePanes.get(),i=[];if(this._getTaskView(i,"List",[j.Outline,j.List_Flat,j.Archived,j.Deleted]),this._getTaskView(i,"Grouped by",[j.Groups_Project,j.Groups_Tag,j.Groups_Contact,j.Groups_Priority]),this._getTaskView(i,"Agenda",[j.Agenda_Today,j.Agenda_Week,j.Agenda_All]),this._getTaskView(i,"Calendar",[j.Calendar_Day,j.Calendar_Custom,j.Calendar_Week,j.Calendar_Month],e),!e){for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=t[r];if(s.type!==u.a.PaneMode.Task){var o=s.type===u.a.PaneMode.Gmail;i.push({text:s.text,type:s.type,icon:s.icon,canZoom:o,border:!0})}}i[i.length-1].border=!1,a>0&&i.push({enableMore:!0})}return i}}]),e}();t.a=new z},58:function(e,t,a){"use strict";var i,n=a(12),r=a.n(n),s=a(22),o=a.n(s),l=a(6),u=a.n(l),d=a(13),c=a.n(d),h=a(5),f=a.n(h),p=a(0),g=a(3),m=a(1),v=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,y=function(){function e(t){var a=0,i=0;f()(this,e);try{p.default.PAssert(983,p.default.isObject(t),"Should always supply a valid object to init a contact")}catch(s){p.default.reportError(s)}this.id=t.id,this.type="contact",this.text=t.text||"",this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[];for(var n=0;n<this.phoneNumbers.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.phoneNumbers[n];r.link=this.formatPhone(r.number),r.type=r.type?r.type[0].toLowerCase():""}for(n=0;n<this.emails.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.emails[n].link="mailto:"+this.emails[n].address}}return u()(e,[{key:"formatPhone",value:function(e){if(v.test(e)){var t=e.match(v),a="";return t[1]&&(a+="+1-"+t[1]+"-"),"tel:"+(a+=t[2]+"-"+t[3])}var i=e.replace(/\D+/g,"");try{p.default.PAssert(984,i&&""!==i,"Invalid phone number format: "+e)}catch(n){p.default.reportError(n)}return e.startsWith("+")&&(i="+"+i),"tel:"+i}}]),e}(),k=a(41),_=a(42),S=a(26),P=a(14),w=a(28),I=a(17),b=(i=function(){function e(){f()(this,e),this._contactCache={},this._contacts=new _.a,this._contactsByID={},this._contactsByName={},this.areContactsLoaded=!1}return u()(e,[{key:"init",value:function(){var e=this;g.default.settings.syncContacts.listen(function(t,a){t&&!t!==!a&&e.refreshContacts()})}},{key:"loadContacts",value:function(e){var t=!1,a=!!e;if(!this.areContactsLoaded){var i=e||S.a.getContacts();try{p.default.PAssert(154,0===this._contacts.get().length,"Should only load contacts once")}catch(l){p.default.reportError(l)}if(this.areContactsLoaded=!0,i){for(var n=0,r=[],s=0;s<i.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[s];if(o.name&&(o.text=o.name,i[s].text=o.name,delete i[s].name,t=!0),!a&&o.isDemo||o.text&&!o.phoneNumbers&&!o.emails)t=!0;else{o.text&&(this._contactsByName[p.default.escape(o.text)]=o,r.push(o));try{p.default.PAssert(155,o.id,"Each contact must have a valid id")}catch(l){p.default.reportError(l)}}}this._contacts.set(r)}else this.clearContacts()}return t}},{key:"updateContact",value:function(e){try{p.default.PAssert(156,e.id,"Incoming contacts must have a valid id")}catch(n){p.default.reportError(n)}try{p.default.PAssert(157,e.text,"All contacts are expected to have a text")}catch(n){p.default.reportError(n)}var t,a=p.default.escape(e.text),i=this._contactsByName[a];return e.emails&&e.emails.length&&(e.emails.forEach(function(e){return e.address=e.address.toLowerCase()}),e.emails=p.default.arrayUniques(e.emails,"address")),i?(e.emails&&!p.default.deepEqual(e.emails,i.emails)&&(i.emails=p.default.arrayUnionByKey(i.emails||[],e.emails,"address"),t=!0),e.phoneNumbers&&!p.default.deepEqual(e.phoneNumbers,i.phoneNumbers)&&(i.phoneNumbers=p.default.arrayUnionByKey(i.phoneNumbers||[],e.phoneNumbers,"number"),t=!0)):(this._contacts.push(e),e.text&&(this._contactsByName[a]=e),t=!0),this._contactCache[e.id]&&(this._contactCache[e.id]=new y(e)),t}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactsByName}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e).forEach(function(e){var a=e.text.split(" "),i=a.map(function(e){return e[0]}).slice(0,Math.min(2,a.length)).join(""),n=e.emails;t.push({text:e.text,iconText:i,subText:n.length?n[0].address:void 0})}),t.sort(this.contactComparator),t}},{key:"emailComparator",value:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}},{key:"emailComparatorSort",value:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}},{key:"phoneComparator",value:function(e,t){return e===t||e.number===t.number}},{key:"ensureCacheObject",value:function(e){try{p.default.PAssert(158,e,"Must have valid data to store in cache")}catch(a){p.default.reportError(a)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new y(e);return this._contactCache[e.id]=t,t}},{key:"findMatchExact",value:function(e){var t=this._contactsByName[p.default.escape(e)];if(t)return this.ensureCacheObject(t)}},{key:"findMatchLike",value:function(e,t){var a=0;try{p.default.PAssert(159,void 0!==e,"Must provide a valid contact part")}catch(h){p.default.reportError(h)}for(var i=e.toUpperCase(),n=[],r=this._contacts.get(),s=0;s<r.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[s],l=!1;if(o.text.toUpperCase().indexOf(i)>=0&&(l=!0),!l&&o.emails)for(var u=0,d=0;!l&&d<o.emails.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(o.emails[d].address.toUpperCase().indexOf(i)>=0){l=!0;break}}if(!l&&o.phoneNumbers){var c=0;for(d=0;!l&&d<o.phoneNumbers.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(o.phoneNumbers[d].number.indexOf(i)>=0){l=!0;break}}}if(l&&(n.push(this.ensureCacheObject(o)),n.length>=t))break}return n.sort(this.contactComparator),n}},{key:"findContactByEmail",value:function(e){for(var t=0,a=0;a<this._contacts.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._contacts.get()[a];if(i.emails)for(var n=0,r=0;r<i.emails.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i.emails[r].address===e)return i}}}},{key:"findEmailsLike",value:function(e,t){var a=0;try{p.default.PAssert(160,void 0!==e,"Must provide a valid email part")}catch(c){p.default.reportError(c)}t=t||20;for(var i=[],n=e.toUpperCase(),r=0;r<this._contacts.get().length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this._contacts.get()[r];if(s&&s.emails){var o=0,l=!1;s.text&&s.text.toUpperCase().indexOf(n)>=0&&(l=!0);for(var u=0;u<s.emails.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=s.emails[u].address;(l||d.toUpperCase().indexOf(n)>=0)&&i.push({type:"contact",text:s.text,email:d})}}if(i.length>=t)break}return i.sort(this.emailComparatorSort),i}},{key:"save",value:function(e){var t=this,a=e.map(function(e){return t._contactsByName[e]});S.a.saveContacts(this._contacts.get(),a)}},{key:"handleRemoteContactLoad",value:function(e,t){for(var a=0,i=(this.numContacts(),[]),n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n],s={id:r.resourceName.replace("people/",""),text:""};if(r.names&&r.names.length>0){var o=r.names[0].displayName;s.text=o,"'"===s.text[0]&&(s.text=s.text.substr(1))}if(!s.text&&r.organizations){for(var l=0,u=0;u<r.organizations.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=r.organizations[u];d.metadata&&d.metadata.primary&&(s.text=d.name)}s.text||(s.text=r.organizations[0].name)}if(r.emailAddresses){var c=0;s.emails=[];for(var h=0;h<r.emailAddresses.length;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=r.emailAddresses[h],v=f.metadata&&f.metadata.primary,y={address:f.value};v&&(y.isPrimary=v),f.type&&(y.type=f.type),s.emails.push(y),!s.text&&y.isPrimary&&(s.text=y.address)}!s.text&&s.emails.length>0&&(s.text=s.emails[0].address)}if(r.phoneNumbers){var k=0;s.phoneNumbers=[];for(var _=0;_<r.phoneNumbers.length;_++){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var S=r.phoneNumbers[_],P=S.metadata&&S.metadata.primary,w={number:S.value};P&&(w.isPrimary=P),S.type&&(w.type=S.type),s.phoneNumbers.push(w)}}s.text?this.updateContact(s)&&i.indexOfWithProperty("id",s.id)<0&&i.push(p.default.escape(s.text)):p.default.shouldLog(m.a.LogLevels.Data)&&p.default.log("Contact entry with no name or email address",r)}i.length&&(this.save(i),g.default.PaneUpdateBatcher.beginUpdateItems(),I.a.getDocumentsArray().forEach(function(e){return e.parseAll(m.a.ChangeType.Auto)}),g.default.PaneUpdateBatcher.updateAllItems(!1,!0),g.default.PaneUpdateBatcher.commitUpdateItems()),t&&t(e.length)}},{key:"syncContactInfo",value:function(e,t){var a=this;k.a.getAccountAuthToken(e,[m.a.GScope.Contacts],function(e){var i,n=[],s=e&&e.access_token,l=function(){var e=o()(r.a.mark(function e(s){var o;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,s.json();case 2:if((o=e.sent)&&o.connections){try{p.default.PAssert(161,p.default.isArray(o.connections),"Connections are not array")}catch(l){p.default.reportError(l)}p.default.isArray(o.connections)&&n.pushArray(o.connections),o.nextPageToken?i(o.nextPageToken):a.handleRemoteContactLoad(n,t)}case 4:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}();i=function(e){var t="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(s)+(e?"&pageToken=".concat(e):"");p.default.XHR({type:"GET",url:t}).then(l)},s&&i()})}},{key:"refreshContacts",value:function(e){var t=this;return!!g.default.settings.syncContacts.get()&&(w.a.onActiveUser(function(a){k.a.onLoaded(function(){t.syncContactInfo(a,function(t){e&&e()})})}),!0)}}]),e}(),c()(i.prototype,"getRNList",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"getRNList"),i.prototype),c()(i.prototype,"refreshContacts",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"refreshContacts"),i.prototype),i);t.a=new b},59:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(7),m=a(3),v=a(2),y=a(21),k=a(45),_=a(61),S=a(53),P=a(27),w=a(58),I=function(e){function t(e){var a;return n()(this,t),(a=l()(this,d()(t).call(this,e))).__isInput=!0,a}return h()(t,e),s()(t,[{key:"init",value:function(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput="password"===e.type,this.isInput||(this.html=this.parseHTML(t.value||p.a.TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"componentWillReceiveProps",value:function(e){this.state.item!==e.item&&e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value!==e.value&&e.value!==this.state.value&&(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)}},{key:"componentDidUpdate",value:function(e){var t=this._isDirty;if(this._isDirty=void 0,t&&this._dirtyCallbacks){for(var a=0,i=0;i<this._dirtyCallbacks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._dirtyCallbacks[i]()}this._dirtyCallbacks=void 0}this.props.autocompleteItem!==e.autocompleteItem&&this.updateAutocomplete()}},{key:"clearValue",value:function(){this.setValue("")}},{key:"clearTokens",value:function(){this.tokens.clear()}},{key:"isButtonEnabled",value:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}},{key:"getValue",value:function(){return this.value.get()}},{key:"getTokens",value:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t}},{key:"getItem",value:function(){return this.state.item}},{key:"parseHTML",value:function(e){var t;if(this.props.parse){var a=_.a.parseText(e,w.a.getContacts(),!0,!0,this.props.isSearch);this.parsedEls=a.els;var i=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);i&&(i=i.map(function(e){return e.trim().slice(1)})),this.tags=a.tags=i,this.contacts=a.contacts,this.props.onParsed&&this.props.onParsed(a),t=m.default.ElementRenderer.render(a.els,{convertSpaces:!0})}else t=e&&f.default.escape(e).replace(/ /g,"&nbsp;");return t}},{key:"addDirtyCallback",value:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)}},{key:"focus",value:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"select",value:function(){P.default.selectElement(this.refs.input)}},{key:"selectEnd",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.textContent;t.length>0&&t!==p.a.TextSpace&&P.default.selectElement(this.refs.input,t.length)}}},{key:"selectAll",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.textContent;t.length>0&&t!==p.a.TextSpace&&P.default.selectElement(this.refs.input,0,t.length)}}},{key:"handleCut",value:function(e){var t=this.getSelectionOffsets();if(t.start===t.end){var a=g.a.ie?"Text":"text/plain",i=e&&e.clipboardData?e.clipboardData:window.clipboardData,n=this.getValue();i.setData(a,n),this.clearValue(),this.onInput(),f.default.preventDefault(e),f.default.stopPropagation(e)}}},{key:"_getHotkeys",value:function(e){var t=[k.a.create(p.a.KeyCode.L,!0,p.a.Primary.No,p.a.Shift.Either,this.selectAll)];return g.a.app&&t.push(k.a.create(p.a.KeyCode.L,!0,p.a.Primary.Yes,p.a.Shift.Either,this.selectAll)),e&&t.push(k.a.create(p.a.KeyCode.Escape,!0,p.a.Primary.Either,p.a.Shift.Either,this.handleEscapeKey)),t}},{key:"onFocus",value:function(e){this.props.autocompleteMode&&S.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),f.default.activeInput.set(this),this.isFocused.set(!0),this.___hotkeys=k.a.pushStack(this._getHotkeys(!!this.props.onEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){f.default.activeInput.set(null),this.isFocused.set(!1),this.___hotkeys&&(k.a.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(e)}},{key:"getSelectionOffset",value:function(){return this.getSelectionOffsets().end}},{key:"getSelectionOffsets",value:function(){var e=P.default._getSelectionRange(),t={start:0,end:0};return e&&(t=P.default.getSelectOffsetsInElement(this.refs.input,e)),t}},{key:"_setSelectionOffset",value:function(e){var t,a;if(e>0){var i=P.default.getOffsetChildElement(this.refs.input,e);i&&(t=i.element,a=i.offset)}else t=this.refs.input,a=0;if(t){var n=P.default.createFakeRange(t,a,t,a);try{f.default.PAssert(576,n,"Range should be valid when setting selection offset")}catch(r){f.default.reportError(r)}n&&P.default.setSelectionRange(n)}}},{key:"setSelectionOffset",value:function(e){this._setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(e){var t=this.props,a=this.refs.input,i=t.autocompleteMode;if(e=t.autocompleteItem||e||this.item.get(),i){var n=P.default.getSelectionInElement(a);(t.autocompleteOnClick||n&&n.start===n.end)&&S.a.update({mode:i,canAutocompleteItems:t.canAutocompleteItems,text:this.value.get(),offset:n?n.start:0,owner:this,item:e,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:a,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick})}}},{key:"setValue",value:function(e,t,a){this._isDirty=!0;try{f.default.PAssert(577,void 0!==e,"Should not set FancyInput value to undefined")}catch(i){f.default.reportError(i)}e=e||"",this.updateHTML(e,t,a),this.value.set(e)}},{key:"updateHTML",value:function(e,t,a){var i=a;t&&void 0===i&&(i=this.getSelectionOffset());var n=this.parseHTML(e||p.a.TextSpace);n!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=n),t&&(i>e.length&&(i=e.length),this.setSelectionOffset(i))}},{key:"addToken",value:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)}},{key:"updateTokens",value:function(e){for(var t=0,a=f.default.parseTokensFromText(this.value.get()),i="",n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n];"contact"===r.type?this.addToken(r):i+=r.text}this.setValue(i,!0)}},{key:"onChange",value:function(){this.value.set(this.refs.input.value)}},{key:"onInput",value:function(){if(!this.isComposing.get()){var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(p.a.TextSpace,"g"),"").replace(/\n/g,"");this.setValue(e,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(e,this.item.get())}}},{key:"handleEscapeKey",value:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(k.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)}},{key:"onMouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)}},{key:"onKeyDown",value:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&S.a.isShowing()||t.buttonText&&e.keyCode===p.a.KeyCode.Enter&&this.onButtonClick(),e.keyCode===p.a.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=p.a.TextSpace)),e.keyCode===p.a.KeyCode.Tab&&S.a.isShowing()&&S.a.hide()),e.keyCode===p.a.KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault()),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyUp",value:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==p.a.KeyCode.LeftArrow&&e.keyCode!==p.a.KeyCode.RightArrow||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===p.a.KeyCode.Comma?this.updateTokens(!1):e.keyCode===p.a.KeyCode.Enter&&this.updateTokens(!0)),t.onKeyUp&&t.onKeyUp(e)}},{key:"onCompositionStart",value:function(){this.isComposing.set(!0)}},{key:"onCompositionEnd",value:function(e){this.isComposing.set(!1),this.onInput()}},{key:"onAutocompleteSelected",value:function(e){var t=this.props;e.item&&t.isSearch?t.onAutocompleteSelected(e):(e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&this.addToken(e.token),t.onAutocompleteSelected&&t.onAutocompleteSelected(e))}},{key:"onButtonClick",value:function(){var e=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0);S.a.isShowing()&&S.a.hide()}}},{key:"onButtonClickCallback",value:function(){this.value.set(""),this.isLoading.set(!1)}},{key:"removeToken",value:function(e){var t=this.props,a=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(a)}},{key:"removeItem",value:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}},{key:"render",value:function(){var e,t,a=this.state,i=this.props,n=i.margin||{},r=i.padding||{};isNaN(r.left)&&(r.left=8),isNaN(r.right)&&(r.right=8);var s,o=!1!==i.border,l=o?2:0,u=f.default.classNames("fancyInput",{disabled:i.disabled},{focused:a.isFocused},{hasFloatingText:!!i.floatingText},{hasButton:!!i.buttonText},{hasBorder:o},this.props.className),d=i.height||40,c=(d-40)/2,h=f.default.extend({width:i.width,height:d,display:i.display,fontSize:i.fontSize},i.style);if(i.floatingText)r.bottom=5+Math.min(c,2),r.top=d-16-r.bottom;else{var p=(d-l-16)/2;r.top=p,r.bottom=p}if(i.floatingText){var m={marginBottom:5+c,marginLeft:r.left,marginRight:r.right};a.isFocused||a.value?a.isFocused?m.color=f.default.colorBlue:m.color="#ccc":m.color="#aaa";var y=f.default.classNames("placeholder c-foreground-super-faded","noSelect",{floating:a.isFocused||a.value||a.tokens.length>0});e=v.createElement("div",{className:y,style:m},i.floatingText)}else if(i.placeholder&&!a.value&&!a.isComposing&&0===a.tokens.length&&!a.item){var k={paddingTop:r.top,marginLeft:r.left,marginRight:r.right};e=v.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:k},i.placeholder)}if(!1!==i.underline){var _={right:i.buttonText&&50};a.isFocused&&!a.item?_[g.a.transform.react]="":_[g.a.transform.react]="scale(0,1)",t=v.createElement("div",{className:"focusUnderline",style:_})}if(i.buttonText){var S=f.default.classNames("fancyInputButton c-button-raised-primary",{loading:a.isLoading},{disabled:!this.isButtonEnabled()}),P={width:i.buttonWidth,lineHeight:d+"px"};s=v.createElement("span",{className:S,style:P,onClick:this.onButtonClick},i.buttonText)}var w,I={paddingLeft:r.left,paddingRight:r.right,marginLeft:n.left,marginRight:n.right},b={ref:"input",className:"fancyInputInput",style:{paddingTop:r.top,paddingBottom:r.bottom},onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:i.tabIndex,disabled:a.isLoading};this.isInput?(b.type=i.type,b.onChange=this.onChange,w=v.createElement("input",b)):(b.onInput=this.onInput,b.contentEditable=i.readonly||a.item?null:"true",b.onCompositionStart=this.onCompositionStart,b.onCompositionEnd=this.onCompositionEnd,w=v.createElement("div",b));var D=[];if(a.tokens)for(var E=0,C=0;C<a.tokens.length;C++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;var A=a.tokens[C],M={marginTop:r.top-4,paddingLeft:i.padding&&!isNaN(i.padding.left)?i.padding.left:8};D.push(v.createElement("div",{key:"token"+C,className:"token c-button-raised c-border",style:M},v.createElement("span",{dangerouslySetInnerHTML:{__html:A.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,C)})))}if(a.item){var T={lineHeight:d+"px",marginTop:0,paddingLeft:i.padding&&!isNaN(i.padding.left)?i.padding.left:8};D.push(v.createElement("div",{key:"tokenItem",className:"token flexbox",style:T},v.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:a.item.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var L=f.default.classNames("fancyInputWrap c-foreground c-border",i.backgroundTheme,{"c-background":!i.backgroundTheme},{hasTokens:D.length>0},{hasItem:a.item});return v.createElement("div",{className:u,id:this.props.id,style:h,onClick:this.props.onClick},v.createElement("div",{className:"fancyInputContent"},v.createElement("div",{className:L,ref:"wrapper"},e,v.createElement("div",{className:"fancyInputInner",style:I,ref:"inner"},D,v.createElement("div",{className:"fancyInputInner2"},w))),s,t))}}]),t}(y.a);t.a=I},60:function(e,t,a){"use strict";var i=a(105),n=a.n(i),r=a(5),s=a.n(r),o=a(6),l=a.n(o),u=a(0),d=a(1),c=a(30),h=a(64),f={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x",repeatComplete:"r"},p=u.default.invertObject(f),g={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"t",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},m=u.default.invertObject(g),v=Object.keys(f),y=d.a.CalendarDayViewNumDaysPad,k=function(){function e(t,a){if(s()(this,e),t instanceof Date)this.date=t,this.dateCleared=t.clone().clearTime();else{this.rruleset=t;try{u.default.PAssert(696,this.rruleset._rrule[0],"MooDate missing rrule in constructor",function(){return t})}catch(i){u.default.reportError(i)}}a&&(this.notify=a.notify,this.duration=a.duration,this.gcalId=a.gcalId,this.completes=a.completes,this.gcalCalendar=a.gcalCalendar,this.repeatComplete="true"===a.repeatComplete||a.repeatComplete)}return l()(e,[{key:"getNext",value:function(e,t,a){var i=this;if(this.date)return this.date;var n=this.rruleset._rrule[0];try{u.default.PAssert(697,n,function(){return"MooDate missing rrule: "+i.toData()})}catch(l){u.default.reportError(l)}if(n){e||(e=new Date);var r,s=this.rruleset._rrule[0].options;s.dtstart&&s.dtstart>e?(r=s.dtstart,a&&(r=r.clone().addMinutes(1))):(t||!(s.freq<c.a.DAILY)&&(s.freq!==c.a.DAILY||s.byhour&&0!==s.byhour[0])||(e=new Date(e).clearTime()),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())));var o=this.rruleset.after(r,!0);return o&&(o=h.a.UTCtoLocal(o)),o}}},{key:"getStart",value:function(){if(this.date)return this.date;var e=this.rruleset._rrule[0].options;return h.a.UTCtoLocal(e.dtstart)}},{key:"getEnd",value:function(){var e=this.getDuration()||d.a.DefaultEventDuration;if(this.date)return new Date(this.date.getTime()+e);var t=this.rruleset._rrule[0].options;return t.until?h.a.UTCtoLocal(t.until):new Date(this.getStart().getTime()+e)}},{key:"isOnDate",value:function(e,t){return this.date?+e===+this.dateCleared:(this._nextDates||this._generateDates(),!0===this._nextDatesMap[+e])}},{key:"getDate",value:function(){return this.date}},{key:"getFirstDate",value:function(){return this._nextDates||this._generateDates(),this._nextDates[0]}},{key:"_generateDates",value:function(){var e=this;if(!this.date&&!this._nextDates){var t=Date.now()+y*d.a.MSPerDay,a=this.rruleset.all(function(e,a){return a<y&&+e<t});this._nextDates=a.map(function(e){return h.a.UTCtoLocal(e).clearTime()}),this._nextDatesMap={},this._nextDates.forEach(function(t){return e._nextDatesMap[+t]=!0})}}},{key:"getAllDates",value:function(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}},{key:"isRange",value:function(){if(this.date)return!1;var e=this.rruleset._rrule[0].options;return 3===e.freq&&1===e.interval&&e.until}},{key:"setDate",value:function(e){if(this.date&&!e.hasTimeOfDay()){var t=this.date.getTimeOfDay();this.date=e.clone().clearTime().addMilliseconds(t)}else this.date=e;this.dateCleared=this.date.clone().clearTime(),this._nextDates=void 0}},{key:"setDuration",value:function(e){this.duration=e}},{key:"getDuration",value:function(){return this.duration}},{key:"setHours",value:function(e){var t=Math.floor(e),a=60*(e-t);if(this.date)this.date.setHours(t),this.date.setMinutes(a);else{var i=this.rruleset._rrule[0];i.options.byhour=[t],i.origOptions.byhour=[t],i.options.byminute=[a],i.origOptions.byminute=[a],this._nextDates=void 0}}},{key:"clearTime",value:function(){if(this.date)this.date.clearTime();else{var e=this.rruleset._rrule[0];e.options.byhour=[0],delete e.origOptions.byhour,e.options.byminute=[0],delete e.origOptions.byminute,this._nextDates=void 0}this.duration=0}},{key:"toText",value:function(e){var t,a=this;if(this.date)t=h.a.toHumanText(this.date);else{var i=this.rruleset._rrule[0];try{u.default.PAssert(698,i,"MooDate has no rrule",function(){return a.toData()})}catch(r){u.default.reportError(r)}i&&(t=e?i.toTextShort():i.toText())}if(t&&!e&&this.duration){var n=this.duration/d.a.MSPerMinute;t+=" "+(n>=60?n/60+"hr":n+"m")}return t||""}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"getGCalCalendar",value:function(){return this.gcalCalendar}},{key:"setGCalId",value:function(e){this.gcalId=e}},{key:"setGCalCalendar",value:function(e){this.gcalCalendar=e}},{key:"setGCalIdAndCalendar",value:function(e,t){this.gcalId=e,this.gcalCalendar=t}},{key:"removeGCal",value:function(){this.gcalId=void 0,this.gcalCalendar=void 0}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=h.a.UTCtoLocal(e)),e?e.getTimeOfDay():void 0}},{key:"copyFrom",value:function(e){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.dateCleared=e.date.clone().clearTime(),this.rruleset=void 0),this.duration=e.duration,this._nextDates=void 0}},{key:"complete",value:function(){if(this.isRepeatDate()){var e=new Date;this.completes?this.completes.push(e):this.completes=[e];var t,a=this.rruleset._rrule[0];if(this.repeatComplete){var i=this.getTime(),n=e.addSeconds(1);0===i&&(n=n.clearTime());var r=h.a.toUTCDate(n);a.origOptions.dtstart=r,a.options.dtstart=r,a=this.rruleset._rrule[0]=c.b.fromString(this.rruleset.toString());var s=(new Date).clearTime().addDays(1);e=this.getNext(s,!0,!0)}t=this.getNext(e,!0,!0),t=h.a.toUTCDate(t),a.origOptions.dtstart=t,a.options.dtstart=t,this._nextDates=void 0}}},{key:"setRepeatOnComplete",value:function(e){this.repeatComplete=e}},{key:"toICal",value:function(){if(this.isRepeatDate())return this.rruleset.toString()}},{key:"toData",value:function(){var e=this,t=[],a=[];if(v.forEach(function(t){var i=e[t];i&&("completes"===t?i=i.filter(function(e){return!isNaN(+e)}).map(function(e){return+e}).join(","):"duration"===t&&(i=Math.round(i/1e5)),a.push("".concat(f[t],":").concat(i)))}),a.length&&t.push(a.join(";")),this.date){var i=+this.date;if(!a.length)return i;t.push(i)}else t.push(this.rruleset._rrule.map(function(e){var t=e.origOptions;return Object.keys(t).map(function(e){var a=t[e];return e=e.toLowerCase(),a instanceof Date?a=Math.round(+a/1e5):u.default.isArray(a)&&a[0]&&a[0]instanceof c.d?a=a.map(function(e){return e.weekday+(e.n&&e.n>0?"-"+e.n:"")}).join(","):u.default.isNumber(a)&&(a=Math.round(a)),"".concat(g[e],":").concat(a)}).join(";")}).join("\n"));return t.join("\\")}}],[{key:"fromData",value:function(t){if(t){var a,i;if(u.default.isString(t)){var r=t.split("\\");if(r.length>1)a={},r[0].split(";").forEach(function(e){var t=e.split(":"),i=n()(t,2),r=i[0],s=i[1];"completes"===p[r]?s=s.split(",").map(function(e){return new Date(e)}):"duration"===p[r]&&(s*=1e5),a[p[r]]=s}),t=r[1]}if(u.default.isNumber(+t))i=new Date(+t);else try{i=new c.c,t.split("n").forEach(function(e){var a={};e.split(";").forEach(function(e){var t=e.split(":"),i=n()(t,2),r=i[0],s=i[1],o=m[r];if(r===g.byweekday)s=s.split(",").map(function(e){var t=e.split("-"),a=n()(t,2),i=a[0],r=a[1],s=""!==i&&u.default.isNumber(+i)?+i:void 0,o=""!==r&&u.default.isNumber(+r)&&+r>0?+r:void 0;return new c.d(s,o)});else if(s.indexOf(",")>0)s=s.split(",").map(function(e){return+e});else if(u.default.isNumber(+s)){var l=s.indexOf(".");l>0&&(s=s.substr(0,l)),"dtstart"===o||"until"===o||s.length>6?s=new Date(1e5*+s):(s=+s,"interval"===o&&s<0&&(s=Math.abs(s)))}a[o]=s}),i.rrule(new c.b(a));try{u.default.PAssert(699,i._rrule[0],"RRuleSet created with no rrule",t)}catch(r){u.default.reportError(r)}i._rrule[0]})}catch(s){u.default.reportError(s,"Error parsing date string: "+t)}return new e(i,a)}}},{key:"fromRRuleOptions",value:function(t,a){var i=new c.c;return i.rrule(new c.b(t)),new e(i,{duration:a})}},{key:"fromRange",value:function(t,a){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(arguments.length>3&&arguments[3],Math.floor(n)),s=60*(n-r);if(t=t.clone(),a=a.clone(),t.equals(a))(i=t).setHours(r),i.setMinutes(s);else{r&&(t.setHours(r),a.setHours(r)),s&&(t.setHours(s),a.setHours(s));var o={freq:c.a.DAILY,dtstart:h.a.toUTCDate(t),until:h.a.toUTCDate(a)};r&&(o.byhour=r?[r]:void 0),s&&(o.byminute=s?[s]:void 0);var l=new c.c;l.rrule(new c.b(o)),i=l}return new e(i)}},{key:"now",value:function(){return new e(new Date)}}]),e}();t.a=k},600:function(e,t,a){var i={"./af":227,"./af.js":227,"./ar":228,"./ar-dz":229,"./ar-dz.js":229,"./ar-kw":230,"./ar-kw.js":230,"./ar-ly":231,"./ar-ly.js":231,"./ar-ma":232,"./ar-ma.js":232,"./ar-sa":233,"./ar-sa.js":233,"./ar-tn":234,"./ar-tn.js":234,"./ar.js":228,"./az":235,"./az.js":235,"./be":236,"./be.js":236,"./bg":237,"./bg.js":237,"./bm":238,"./bm.js":238,"./bn":239,"./bn.js":239,"./bo":240,"./bo.js":240,"./br":241,"./br.js":241,"./bs":242,"./bs.js":242,"./ca":243,"./ca.js":243,"./cs":244,"./cs.js":244,"./cv":245,"./cv.js":245,"./cy":246,"./cy.js":246,"./da":247,"./da.js":247,"./de":248,"./de-at":249,"./de-at.js":249,"./de-ch":250,"./de-ch.js":250,"./de.js":248,"./dv":251,"./dv.js":251,"./el":252,"./el.js":252,"./en-au":253,"./en-au.js":253,"./en-ca":254,"./en-ca.js":254,"./en-gb":255,"./en-gb.js":255,"./en-ie":256,"./en-ie.js":256,"./en-il":257,"./en-il.js":257,"./en-nz":258,"./en-nz.js":258,"./eo":259,"./eo.js":259,"./es":260,"./es-do":261,"./es-do.js":261,"./es-us":262,"./es-us.js":262,"./es.js":260,"./et":263,"./et.js":263,"./eu":264,"./eu.js":264,"./fa":265,"./fa.js":265,"./fi":266,"./fi.js":266,"./fo":267,"./fo.js":267,"./fr":180,"./fr-ca":268,"./fr-ca.js":268,"./fr-ch":269,"./fr-ch.js":269,"./fr.js":180,"./fy":270,"./fy.js":270,"./gd":271,"./gd.js":271,"./gl":272,"./gl.js":272,"./gom-latn":273,"./gom-latn.js":273,"./gu":274,"./gu.js":274,"./he":275,"./he.js":275,"./hi":276,"./hi.js":276,"./hr":277,"./hr.js":277,"./hu":278,"./hu.js":278,"./hy-am":279,"./hy-am.js":279,"./id":280,"./id.js":280,"./is":281,"./is.js":281,"./it":282,"./it.js":282,"./ja":283,"./ja.js":283,"./jv":284,"./jv.js":284,"./ka":285,"./ka.js":285,"./kk":286,"./kk.js":286,"./km":287,"./km.js":287,"./kn":288,"./kn.js":288,"./ko":289,"./ko.js":289,"./ky":290,"./ky.js":290,"./lb":291,"./lb.js":291,"./lo":292,"./lo.js":292,"./lt":293,"./lt.js":293,"./lv":294,"./lv.js":294,"./me":295,"./me.js":295,"./mi":296,"./mi.js":296,"./mk":297,"./mk.js":297,"./ml":298,"./ml.js":298,"./mr":299,"./mr.js":299,"./ms":300,"./ms-my":301,"./ms-my.js":301,"./ms.js":300,"./mt":302,"./mt.js":302,"./my":303,"./my.js":303,"./nb":304,"./nb.js":304,"./ne":305,"./ne.js":305,"./nl":306,"./nl-be":307,"./nl-be.js":307,"./nl.js":306,"./nn":308,"./nn.js":308,"./pa-in":309,"./pa-in.js":309,"./pl":310,"./pl.js":310,"./pt":311,"./pt-br":312,"./pt-br.js":312,"./pt.js":311,"./ro":313,"./ro.js":313,"./ru":314,"./ru.js":314,"./sd":315,"./sd.js":315,"./se":316,"./se.js":316,"./si":317,"./si.js":317,"./sk":318,"./sk.js":318,"./sl":319,"./sl.js":319,"./sq":320,"./sq.js":320,"./sr":321,"./sr-cyrl":322,"./sr-cyrl.js":322,"./sr.js":321,"./ss":323,"./ss.js":323,"./sv":324,"./sv.js":324,"./sw":325,"./sw.js":325,"./ta":326,"./ta.js":326,"./te":327,"./te.js":327,"./tet":328,"./tet.js":328,"./tg":329,"./tg.js":329,"./th":330,"./th.js":330,"./tl-ph":331,"./tl-ph.js":331,"./tlh":332,"./tlh.js":332,"./tr":333,"./tr.js":333,"./tzl":334,"./tzl.js":334,"./tzm":335,"./tzm-latn":336,"./tzm-latn.js":336,"./tzm.js":335,"./ug-cn":337,"./ug-cn.js":337,"./uk":338,"./uk.js":338,"./ur":339,"./ur.js":339,"./uz":340,"./uz-latn":341,"./uz-latn.js":341,"./uz.js":340,"./vi":342,"./vi.js":342,"./x-pseudo":343,"./x-pseudo.js":343,"./yo":344,"./yo.js":344,"./zh-cn":345,"./zh-cn.js":345,"./zh-hk":346,"./zh-hk.js":346,"./zh-tw":347,"./zh-tw.js":347};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=600},61:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(1),h=a(3),f=["data-href","plugin","plugin-id","appLink","tooltip","data-original-text","attachSimple","size"],p=function(){function e(t,a){r()(this,e),this._parsedText=t,this._textLength=t.length,this._attrs=a?d.default.clone(a):{},this._width=void 0}return o()(e,[{key:"setWidth",value:function(e){this._width=e}},{key:"getWidth",value:function(e){return!this.isMarkdown()||h.default.settings.showMarkdown.get()&&e?this._width:this.isAppLinkStart()?20:0}},{key:"getParsedText",value:function(){return this._parsedText}},{key:"getOrigTextLength",value:function(){return this._textLength}},{key:"setParsedText",value:function(e){this._parsedText=e}},{key:"_getTextHelper",value:function(e,t){var a;if(this.getAttr("plugin")){try{d.default.PAssert(688,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(r){d.default.reportError(r)}var i=h.default.pluginManager.getPlugin(this._attrs.plugin),n=i.getAttachment(this.getAttr("plugin-id"));a="unstyled"===t?i.getUnstyledText(n):i.getRichText(n)}else a=d.default.escape(this._parsedText);return a}},{key:"getUnstyledText",value:function(e){return this._getTextHelper(e,"unstyled")}},{key:"getRichText",value:function(e){return this._getTextHelper(e,"rich")}},{key:"getStyledText",value:function(e,t,a,i){var n;if(this.getAttr("plugin")){try{d.default.PAssert(689,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(o){d.default.reportError(o)}var r=h.default.pluginManager.getPlugin(this._attrs.plugin),s=r.getAttachment(this.getAttr("plugin-id"));n=r._getDisplayText(s,e,a,i)}else n=t?this._parsedText:d.default.escape(this._parsedText);return n}},{key:"getAttrs",value:function(){return this._attrs}},{key:"getAttr",value:function(e){var t;return this._attrs&&(t=this._attrs[e]),t}},{key:"hasAttrs",value:function(){return!!this._attrs}},{key:"getClasses",value:function(){var e;return this._attrs&&(e=this._attrs.cls),e}},{key:"hasClasses",value:function(){var e=this.getClasses();return!!e&&e.length>0}},{key:"hasClass",value:function(e){var t=!1,a=this.getClasses();return a&&(t=a.indexOf(e)>=0),t}},{key:"getClassString",value:function(){var e="",t=this.getClasses();return t&&(e=t.join(" ")),e}},{key:"addClass",value:function(e){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(e)}},{key:"mergeAttrs",value:function(e){if(e)if(this._attrs){var t=0;e.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(e.cls):this._attrs.cls=e.cls);try{d.default.PAssert(690,void 0===this._attrs.plugin||void 0===e.plugin||this._attrs.plugin===e.plugin,"A single element cannot match multiple plugins")}catch(r){d.default.reportError(r)}try{d.default.PAssert(691,void 0===this._attrs["plugin-id"]||void 0===e["plugin-id"]||this._attrs["plugin-id"]===e["plugin-id"],"A single element cannot match multiple plugins")}catch(r){d.default.reportError(r)}for(var a=0;a<f.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=f[a],n=this._attrs[i]||e[i];n&&(this._attrs[i]=n)}}else this._attrs=e}},{key:"addAttr",value:function(e,t){this._attrs||(this._attrs={}),this._attrs[e]=t}},{key:"isMarkdown",value:function(){return this.hasClass("mdMarkup")}},{key:"isMDImage",value:function(){return this.hasClass("mdImage")}},{key:"isAppLinkStart",value:function(){return this.hasClass("mdMarkupStart")&&this._attrs.appLink}}]),e}(),g=a(58),m=a(14),v=", . ? ! ) ( : ; [ ] ' \" _".split(" "),y=0,k=["http","https","evernote","onenote","bear"],_=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},S=/(^#|[\(\s-]#)([^\s\),*#]+)/g,P=(c.a.Regexp.Link,c.a.Regexp.LinkExc),w=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,I=c.a.Regexp.Prefix,b=/(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi,D=c.a.Regexp.MDLink,E=/^(-{3,})$/g,C=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,A=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) (-{3,})$/g,M=/(\*\*\*)(.*?)\1/g,T=/(\*\*)(.*?)\1/g,L=/(__)(.*?)\1/g,x=/(\*)(\u2005*?)([^\u2005|\*]+?)\2\1/gi,R=[P,/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi],O=(i=function(){function e(){r()(this,e)}return o()(e,[{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"generateStyledLines",value:function(e,t,a,i,n,r){for(var s=0,o=this.linesToEls(e,t),l=[],u=0;u<o.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l.push(h.default.ElementRenderer.render(o[u],{item:i,convertLines:!1,pane:a,highlightSearch:n,showMarkdown:r}))}return l}},{key:"linesToEls",value:function(e,t){for(var a=0,i=[],n=[],r=!1,s=0;s<t.length;++s){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=0,u=t[s].start,d=t[s].length,c=0,h=0;h<e.length;++h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var f=e[h],g=f.getParsedText().length,m=Math.max(u-l,0);if(m<g){var v=Math.min(g-m,d-c);if(v>0){var y=f.getParsedText().substr(m,v),k=new p(y,f.getAttrs());k.getAttr("appLink")&&!r&&k.addAttr("appLinkStart",!0),n.push(k),r=!!k.getAttr("appLink"),c+=v}}l+=g}i.push(n),n=[]}return i}},{key:"replaceTextInEls",value:function(e,t,a,i){var n=0;try{d.default.PAssert(568,d.default.isArray(e),"Must supply a valid VMLIElement array")}catch(p){d.default.reportError(p)}try{d.default.PAssert(569,t,"Must be replacing at least one of parsed or styled text")}catch(p){d.default.reportError(p)}for(var r=0,s=0;s<e.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[s],l=o.getParsedText();if(a+i>=r&&a<r+o.getOrigTextLength()){var u=a-r,c=Math.min(i,l.length-u),h=l.substr(0,u),f=l.substr(u+c);t&&o.setParsedText(h+t+f);break}r+=o.getOrigTextLength()}}},{key:"getElAtOffset",value:function(e,t){for(var a=0,i=0,n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n],s=r.getOrigTextLength();if(t>=i&&t<i+s)return r;i+=s}}},{key:"insertEl",value:function(e,t,a,i){var n=0;try{d.default.PAssert(570,d.default.isArray(t.cls),"Must always pass in a valid classes array")}catch(S){d.default.reportError(S)}try{d.default.PAssert(571,d.default.isNumber(a),"Must have a valid start")}catch(S){d.default.reportError(S)}try{d.default.PAssert(572,d.default.isNumber(i),"Must have a valid length")}catch(S){d.default.reportError(S)}for(var r,s=0,o=i,l=0;l<e.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e[l],c=u.getParsedText();if(s<a+i&&a<s+u.getOrigTextLength()){var h=0,f=Math.max(a-s,0),g=Math.min(o,c.length),m=f+o,v=c.length-m;if(f>0){var y=c.substr(0,f);e.splice(l,0,new p(y,u.getAttrs())),h++}var k=c.substr(f,g);if((r=new p(k,u.getAttrs())).mergeAttrs(t),e.splice(l+h,1,r),h++,v>0){var _=c.substr(m,v);e.splice(l+h,0,new p(_,u.getAttrs()))}if(l+=h-1,o-=g,v>0)break}s+=u.getOrigTextLength()}return r}},{key:"_notifyParse",value:function(e){_.total++,_[e]++}},{key:"runParseSinglePlugin",value:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)}},{key:"parseSinglePlugin",value:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{d.default.PAssert(573,!y,"We do not support recursive calls to parse")}catch(s){d.default.reportError(s)}var a,i;if(y++,"\u2001"===e[0]||"\u2003"===e[0]){var n=!d.default.isFlagSet(t,c.a.ChangeType.ItemLoad),r=h.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),n);i=[r],e=c.a.AttachChar,n&&(a=[new p(c.a.AttachChar,r.displayElement.attrs)])}else a=[new p(e)];return y--,{parsedText:e,attachments:i,els:a}}},{key:"parseNote",value:function(e){return this._notifyParse("parseNote"),{parsedText:e.getRawText(),els:[new p(e.getRawText())]}}},{key:"runParseText",value:function(e){return this.parseText(e.getRawText(),g.a.getContacts(),void 0,void 0,void 0,e)}},{key:"parseText",value:function(e,t,a,i,n,r){if(this._notifyParse("parseText"),!e||0===e.length)return{parsedText:void 0,contacts:void 0,tags:void 0,attachments:void 0,els:[]};try{d.default.PAssert(574,!y,"We do not support recursive calls to parse")}catch(Oe){d.default.reportError(Oe)}y++;var s,o,l,u,f,g,m,_,b,A=!1,O=e,F=0,N=!1,B=[new p(O)];i||(I.lastIndex=0,null!==(s=I.exec(O))&&(f=s[1])&&(F=s[0].length,0===f.indexOf("#")||0===f.indexOf("^")?(b="prefixHeader",g="header"):"["===f||"[]"===f||"[ ]"===f||"]"===f||"("===f||"()"===f||"( )"===f||")"===f?(b="prefixTask icon-square-o",g="task"):"*"===f||"-"===f||"+"===f?(b="prefixBullet",g="bullet"):(b="prefixNumList",g="numList"),this.insertEl(B,{cls:["itemPrefix",b]},0,F).setWidth(c.a.PrefixWidth)));var U=0;for(w.lastIndex=0;null!==(s=w.exec(O));){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;var V=h.default.pluginManager.parseAttachmentEmbedString(s[1],!0);this.replaceTextInEls(B,c.a.AttachChar,s.index,s[0].length);var H=this.insertEl(B,V.displayElement.attrs,s.index,1);O=O.substr(0,s.index)+c.a.AttachChar+O.substr(s.index+s[0].length);var j=B.indexOf(H);j>0&&H.addClass("padB"),j<B.length-1&&H.addClass("padA"),A=!0,u?u.push(V):u=[V]}var z=O.indexOf(c.a.CharDate);if(z>=0&&r){var q={p:c.a.PluginID.Date,id:r.id,itemID:r.id};q.displayElement=h.default.pluginManager.createDisplayElement(q,!0);H=this.insertEl(B,q.displayElement.attrs,z,1);this.replaceTextInEls(B,c.a.AttachChar,z,1),O=O.replace(c.a.CharDate,c.a.AttachChar),A=!0,u?u.push(q):u=[q]}var W=O.substr(F),G=0,K=0,Y=0,X=0,Q=0;for(D.lastIndex=0;null!==(s=D.exec(W));){if(G++>5e3&&__infLoop&&__infLoop(G))throw new RangeError;var J=s[3],Z=J.indexOf("://")>0?J:"http://"+J,$=!!d.default.parseEvernoteLink(J),ee=d.default.isOneNoteLink(J),te=d.default.isBearLink(J),ae=$||ee||te,ie=["mdMarkup","mdMarkupStart"],ne=F+s.index+s[1].length,re="!"===s[1],se=s[4]||"",oe=se&&+se.replace(/\s|=|x/g,"");re?(this.insertEl(B,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":Z,"data-original-text":s[0],size:oe},F+s.index,s[0].length),N=!0):s[2]&&($?ie.push("evernote"):ee?ie.push("onenote"):te&&ie.push("bear"),this.insertEl(B,{cls:ie,appLink:ae},F+s.index,1+s[1].length),this.insertEl(B,{cls:["mdSpan","link","c-link"].concat(d.default.isUrlImage(Z)?"linkImage":[]),appLink:ae,"data-href":Z,"data-original-text":s[0]},ne+1,s[2].length),this.insertEl(B,{cls:["mdMarkup"],appLink:ae},ne+1+s[2].length,2),this.insertEl(B,{cls:["mdSpan","link","c-link","mdMarkup"].concat(d.default.isUrlImage(Z)?"linkImage":[]),appLink:ae,"data-href":Z,"data-original-text":s[0]},ne+s[2].length+3,J.length+se.length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"],appLink:ae},ne+s[2].length+se.length+J.length+3,1),N=!0)}if(!N)for(var le,ue,de,ce,he=0,fe=0;fe<R.length;fe++){if(he++>5e3&&__infLoop&&__infLoop(he))throw new RangeError;if(!N){var pe=0,ge=R[fe];for(ge.lastIndex=0;null!==(s=ge.exec(W));){if(pe++>5e3&&__infLoop&&__infLoop(pe))throw new RangeError;if(ge===P){de=k.indexOf(s[3])>=0?s[2]:"http://"+s[2],le=s.index+F,ue=s[0].length,ce="!"===s[1]}else{var me=s[0].length-s[1].length;de=s[1].startsWith("http")?s[1]:"http://"+s[1],le=s.index+me+F,ue=s[1].length}if(de)if(N=!0,ce)this.insertEl(B,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":de,"data-original-text":s[0]},F+s.index,s[0].length);else{var ve=d.default.parseEvernoteLink(de),ye=d.default.isOneNoteLink(de),ke=d.default.isBearLink(de),_e={cls:["link","c-link"].concat(d.default.isUrlImage(de)?"linkImage":[]),"data-href":de};ve&&(_e.appLink=!0,_e.cls.push("evernote")),ye&&(_e.appLink=!0,_e.cls.push("onenote")),ke&&(_e.appLink=!0,_e.cls.push("bear")),this.insertEl(B,_e,le,ue)}}}}for(L.lastIndex=0;null!==(s=L.exec(W));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;this.isInTag(s)||this.getElAtOffset(B,s.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},F+s.index,s[1].length),this.insertEl(B,{cls:["mdSpan","mdUnderline"]},F+s.index+s[1].length,s[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},F+s.index+s[1].length+s[2].length,s[1].length))}for(M.lastIndex=0;null!==(s=M.exec(W));){if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;this.isInTag(s)||this.getElAtOffset(B,s.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},F+s.index,s[1].length),this.insertEl(B,{cls:["mdSpan","mdBold","mdItalic"]},F+s.index+s[1].length,s[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},F+s.index+s[1].length+s[2].length,s[1].length))}var Se=W.replace(M,"\u2005\u2005\u2005$2\u2005\u2005\u2005");for(T.lastIndex=0;null!==(s=T.exec(Se));){if(X++>5e3&&__infLoop&&__infLoop(X))throw new RangeError;this.isInTag(s)||this.getElAtOffset(B,s.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},F+s.index,s[1].length),this.insertEl(B,{cls:["mdSpan","mdBold"]},F+s.index+s[1].length,s[2].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},F+s.index+s[1].length+s[2].length,s[1].length))}for(Se=Se.replace(T,"\u2005\u2005$2\u2005\u2005"),x.lastIndex=0;null!==(s=x.exec(Se));){if(Q++>5e3&&__infLoop&&__infLoop(Q))throw new RangeError;this.isInTag(s)||this.getElAtOffset(B,s.index).hasClass("link")||(this.insertEl(B,{cls:["mdMarkup","mdMarkupStart"]},F+s.index,s[1].length),this.insertEl(B,{cls:["mdSpan","mdItalic"]},F+s.index+s[1].length+s[2].length,s[3].length),this.insertEl(B,{cls:["mdMarkup","mdMarkupEnd"]},F+s.index+s[1].length+s[2].length+s[3].length+s[2].length,s[1].length))}if(E.lastIndex=0,null!==(s=E.exec(W))&&this.insertEl(B,{cls:["mdSpan","mdHR","c-border-heavy"]},0,O.length),!u){var Pe=0;for(C.lastIndex=0;null!==(s=C.exec(O));){if(Pe++>5e3&&__infLoop&&__infLoop(Pe))throw new RangeError;this.getElAtOffset(B,s.index).hasClass("link")||this.insertEl(B,{cls:["email","c-contact"]},s.index,s[1].length)}}if(t&&Object.keys(t).length>0){var we=O.split(c.a.ContactPrefix);if(we.length>1){var Ie=0,be=we[0].length;for(we=we.slice(1),m=0;m<we.length;m++){if(Ie++>5e3&&__infLoop&&__infLoop(Ie))throw new RangeError;var De=we[m],Ee=void 0;if(" "!==De[0]&&!v.includes(De[0])){var Ce=0;for(_=0;_<De.length;_++){if(Ce++>5e3&&__infLoop&&__infLoop(Ce))throw new RangeError;var Ae=De.substr(0,_+1);t[Ae]&&(Ee=Ae)}}Ee&&(l?l.push(Ee):l=[Ee],this.insertEl(B,{cls:["contact","c-contact"]},be,Ee.length+1)),be+=De.length+c.a.ContactPrefix.length}}}var Me=0;for(S.lastIndex=0;null!==(s=S.exec(O));){var Te=0;if(Me++>5e3&&__infLoop&&__infLoop(Me))throw new RangeError;for(var Le=s.index+s[1].length-1,xe=s[2].length+1,Re=s[2];v.indexOf(Re.charAt(Re.length-1))>=0;){if(Te++>5e3&&__infLoop&&__infLoop(Te))throw new RangeError;xe--,Re=Re.substr(0,Re.length-1)}Re&&(o?o.push(Re):o=[Re]),this.insertEl(B,{cls:["tag","c-tag"]},Le,xe)}return u&&(w.lastIndex=0,O=O.replace(w,c.a.AttachChar)),y--,{parsedText:A?O:void 0,durations:void 0,tags:o,attachments:u,contacts:l,prefix:f,prefixType:g,els:B}}},{key:"isInTag",value:function(e){for(var t=0,a=e.index;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[a])return!1;if("#"===e.input[a])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(e){var t,a,i=0;for(b.lastIndex=0;null!==(a=b.exec(e));){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t)a.index===t[0].length&&(e=e.substr(a.index));else{if(0!==a.index)break;t=a}}return e=e.replace(A,c.a.TextMDHR)}}]),e}(),u()(i.prototype,"runParseSinglePlugin",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"runParseSinglePlugin"),i.prototype),u()(i.prototype,"runParseText",[m.a],Object.getOwnPropertyDescriptor(i.prototype,"runParseText"),i.prototype),i);t.a=new O},63:function(e,t,a){"use strict";var i,n=a(5),r=a.n(n),s=a(6),o=a.n(s),l=a(13),u=a.n(l),d=a(0),c=a(1),h=a(3),f=a(23),p=a(7),g=a(8),m=a(15),v=a(42),y=a(58),k=a(41),_=a(28),S=a(17),P=a(14),w=(i=function(){function e(){r()(this,e),this.pluginsAvailable=[c.a.PluginID.Contacts,c.a.PluginID.Drive,c.a.PluginID.GCalendar,c.a.PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new m.a(!1),this.GCalendarsAvailable=new v.a,this.GCalendarSyncErrors=new v.a(void 0),this.GCalendarAddFailure=new m.a(!1),this.GCalendarListFailure=new m.a(!1),this.GCalendarListLoading=new m.a(!1),this.GmailNumSyncd=new m.a(0),this.GmailCacheSize=new m.a(0),this.GmailSyncAccounts=new v.a,this.isSaveEnabled=new m.a(!1),this.hasRefreshed=!1,f.a.forceBind("calendarComparator",this)}return o()(e,[{key:"init",value:function(){var e=h.default.pluginManager.getPluginGCalendar().getImportCalendarList();e&&this.GCalendarsAvailable.set(e)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(e){var t=0;this.hasRefreshed=!0;for(var a=0;a<this.pluginsAvailable.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i,n=this.pluginsAvailable[a];i=n===c.a.PluginID.Contacts?h.default.settings.syncContacts.get():h.default.pluginManager.isAuthorized(n),this.updatePluginStatus(n,i)}e&&e!==c.a.PluginID.GCalendar||(this.updatePluginOptionStatus(c.a.PluginID.GCalendar,c.a.PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(c.a.PluginID.GCalendar,c.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(c.a.PluginID.GCalendar,c.a.PluginSettingsID.GCalendar.ExportCalendar)),e&&e!==c.a.PluginID.Drive||this.updatePluginOptionStatus(c.a.PluginID.Drive,c.a.PluginSettingsID.Drive.WriteAccess)}},{key:"refresh",value:function(e){this.refreshPluginStatus(),e&&e!==c.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==c.a.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(e,t){return e.summary.localeCompare(t.summary)}},{key:"updateGmailInfo",value:function(){var e=h.default.pluginManager.getPluginGmail();this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}},{key:"updateCalendarList",value:function(){var e=this;if(h.default.pluginManager.isAuthorized(c.a.PluginID.GCalendar)){var t=h.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.getFullCalendarList(function(t){e.GCalendarListLoading.set(!1,!1),t?(t.sort(e.calendarComparator),e.GCalendarsAvailable.set(t),e.GCalendarListFailure.set(!1)):e.GCalendarListFailure.set(!0)})}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter(function(t){return e[t].get()})}},{key:"getPluginEnabledObservable",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}},{key:"isPluginEnabled",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}},{key:"getPluginOptionObservable",value:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}},{key:"getPluginOptions",value:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]}},{key:"isPluginAnOption",value:function(e){return e===c.a.PluginID.Mailbird?p.a.embed===c.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}},{key:"updatePluginStatus",value:function(e,t,a){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,a):this._pluginEnabledObservables[e]=new m.a(t)}},{key:"updatePluginOptionStatus",value:function(e,t,a){var i=h.default.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(i||a&&[]):this._pluginOptionObservables[e][t]=a?new v.a(i):new m.a(i)}},{key:"onFailedAuthenticate",value:function(e){h.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(e,t){var a;if(e===c.a.PluginID.Contacts)t.indexOf(c.a.GScope.Contacts)>=0&&(a=!0);else{var i=h.default.pluginManager.getPlugin(e),n=_.a.getUserSync();n&&(a=i.verifyAuthorization(n.email))}try{d.default.PAssert(142,a,"Should always be successful at authorizing plugins")}catch(r){d.default.reportError(r)}return a}},{key:"setEnabledSyncAccount",value:function(e,t,a,i){e[t]||(e[t]={}),e[t][a]=i}},{key:"setEnabledPlugins",value:function(e,t){for(var a=0,i=h.default.settings.syncAccounts.get(),n=d.default.clone(i||{}),r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e[r],o=s.id,l=s.enable,u=this._pluginEnabledObservables[o].get(),f=h.default.pluginManager.getPlugin(s.id);l?(s.id===c.a.PluginID.GCalendar&&f.setSetting(c.a.PluginSettingsID.GCalendar.WriteAccess,!0),s.id!==c.a.PluginID.Drive||s.shared||f.setSetting(c.a.PluginSettingsID.Drive.WriteAccess,!1)):u&&this.disablePlugin(o),this.setEnabledSyncAccount(n,_.a.getDefaultAccountID(),s.id,u)}d.default.deepEqual(i,n)||h.default.settings.syncAccounts.set(n);var p=e.filter(function(e){return e.enable});this.enablePlugins(p,!1,t)}},{key:"enablePlugins",value:function(e,t,a){var i=this,n=e.map(function(e){var t=e.id,a=h.default.pluginManager.getPlugin(e.id);return a?t===c.a.PluginID.Drive?a.googleScopes(e.shared):a.googleScopes():t===c.a.PluginID.Contacts?[c.a.GScope.Contacts]:void 0}).reduce(function(e,t){return e.concat(t)},[]);if(n=d.default.arrayUnion(n,[c.a.GScope.UserInfoEmail]),t||n&&n.length>1){var r=h.default.settings.activeUser.get();k.a.authAccount(r,n,function(t){t&&!t.error?(i.refresh(),e.map(function(e){if(e.id===c.a.PluginID.Contacts)i.enableSyncContacts();else{var a=h.default.pluginManager.getPlugin(e.id);h.default.pluginManager.onPluginAuthorized(a,!0),e.id===c.a.PluginID.Drive&&e.shared&&a.setSetting(c.a.PluginSettingsID.Drive.WriteAccess,!0)}try{d.default.PAssert(143,i._wasPluginAuthorized(e.id,t.scopes),"Plugin "+e.id+" was not authorized properly.")}catch(n){d.default.reportError(n)}}),i.refresh(),a(!0)):a(!1)})}else this.refresh(),a(!0)}},{key:"_enablePlugin",value:function(e){var t=this,a=this._pluginEnabledObservables[e];h.default.pluginManager.authorizePlugin(e,!0,function(i){i?(a.set(!0),t.refresh(e),d.default.sendEvent(e,"PluginEnabled")):(t.onFailedAuthenticate(e),d.default.sendEvent(e,"PluginEnableFailed"))})}},{key:"enablePlugin",value:function(e){e===c.a.PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(e)}},{key:"disablePlugin",value:function(e){var t=this._pluginEnabledObservables[e];e===c.a.PluginID.Contacts?(d.default.sendEvent("Settings","DisableContacts"),h.default.settings.syncContacts.set(!1),y.a.clearContacts(),t.set(!1)):h.default.pluginManager.deauthorizePlugin(e,function(){t.set(!1),d.default.sendEvent(e,"PluginDisabled")})}},{key:"togglePlugin",value:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}},{key:"togglePluginOption",value:function(e,t){var a=this,i=this._pluginOptionObservables[e][t],n=!i.get();h.default.pluginManager.setSetting(e,t,n),n?h.default.pluginManager.authorizePlugin(e,!0,function(r){r?(h.default.pluginManager.onAuthorizedSetting(e,t,n),i.set(!0),d.default.sendEvent(e,"OptionEnabled_"+t)):(a.onFailedAuthenticate(t),h.default.pluginManager.setSetting(e,t,!n),d.default.sendEvent(e,"OptionEnableFailed_"+t))}):(i.set(!1),d.default.sendEvent(e,"OptionDisabled_"+t))}},{key:"setPluginOption",value:function(e,t,a,i,n){var r=this,s=this._pluginOptionObservables[e][t],o=s.get();h.default.pluginManager.setSetting(e,t,a),a&&i?h.default.pluginManager.authorizePlugin(e,!0,function(i){i?(h.default.pluginManager.onAuthorizedSetting(e,t,a),s.set(a),d.default.sendEvent(e,"OptionSet_"+t+"_"+a),n&&n(!0)):(r.onFailedAuthenticate(t),h.default.pluginManager.setSetting(e,t,o),d.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+a),n&&n(!1))}):(s.set(a),d.default.sendEvent(e,"OptionSet_"+t+"_"+a),n&&n(!0))}},{key:"enableOfflineFeatures",value:function(e,t){var a=this,i=this.getEnabledPlugins().map(function(e){return e===c.a.PluginID.Drive?{id:e,shared:a.getPluginOptionObservable(e,c.a.PluginSettingsID.Drive.WriteAccess).get()}:{id:e}});this.enablePlugins(i,e,function(e){e||(h.default.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),d.default.sendEvent("OfflineAccessFailed",!0)),t&&t(e)})}},{key:"isNotificationsEnabled",value:function(){return!h.default.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var e=h.default.settings.disableNotifications.get();h.default.settings.disableNotifications.set(!e),e?h.default.timeline.updateNotifications():h.default.timeline.clearNotifications()}},{key:"enableSyncContacts",value:function(){var e=this;d.default.sendEvent("Settings","EnableContacts");h.default.settings.syncContacts.set(!0),this.updatePluginStatus(c.a.PluginID.Contacts,!0),y.a.refreshContacts(function(t){t<0?h.default.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function(){e.enableSyncContacts()}}):t>0&&S.a.parseAll(c.a.ChangeType.Auto)}),g.d.miscAction({type:g.b.Misc,misc:g.a.SyncContacts})}},{key:"onTapRefreshContacts",value:function(e,t){var a=this,i=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),i=y.a.refreshContacts(function(){a.isRefreshingContacts.set(!1),t&&t()}),d.default.sendEvent("Menu","RefreshContacts")),i}},{key:"addCalendar",value:function(e,t){var a=this,i=h.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),i.createCalendar(e,t,function(e){a.GCalendarListLoading.set(!1),e?a.updateCalendarList():a.GCalendarAddFailure.set(!0)})}},{key:"notifySyncError",value:function(e){this.GCalendarSyncErrors.set(e||[])}}]),e}(),u()(i.prototype,"onTapRefreshContacts",[P.a],Object.getOwnPropertyDescriptor(i.prototype,"onTapRefreshContacts"),i.prototype),i);t.a=new w},64:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(3),l=a(0),u=a(1),d=a(60),c=a(487),h=a.n(c),f=a(30),p=function(){function e(){n()(this,e)}return s()(e,[{key:"parseText",value:function(e){var t,a=(e=e.toLowerCase()).substring(e.indexOf("every")),i=f.b.parseText(a,void 0);if(i){try{l.default.PAssert(786,!(i.options.interval<0),"Interval set to negative",e)}catch(P){l.default.reportError(P)}var n=i.options,r=i.fromDate,s=i.duration;r||(r=new Date,r=this.toUTCDate(r));var c=Object.assign({dtstart:r},n);delete c.interval;var p=new f.b(c).after(r,!0);if(p){p=this.UTCtoLocal(p);var g=n.byhour?n.byhour[0]:0,m=n.byminute?n.byminute[0]:0;p.setHours(g),p.setMinutes(m),p.setSeconds(0),p.setMilliseconds(0),p=new Date(this.toUTCDate(p).getTime()),n.dtstart=p,n.until&&(n.until=new Date(p.getTime()+n.until.getTime()-r.getTime())),t=d.a.fromRRuleOptions(n,s?s*u.a.MSPerMinute:void 0)}}else{var v=e.replace(/\./g,"/"),y=h.a.parse(v,void 0,{forwardDate:!0})[0];if(y){var k=o.default.International.parseDate(y.text,o.default.settings.dateFormat.get());if(k){var _,S=e.substring(y.index+y.text.length).trim().match(f.f.tokens.duration);S&&(_=Math.round(+S[1]*("h"===S[2][0]?u.a.MSPerHour:u.a.MSPerMinute))),t=new d.a(k,{duration:_})}}}return t}},{key:"toUTCDate",value:function(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()))}},{key:"UTCtoLocal",value:function(e){return new Date(e.getTime()+e.getTimezoneOffset()*u.a.MSPerMinute)}},{key:"toHumanText",value:function(e,t){var a=+new Date(e).clearTime()-+Date.today(),i="";return t||(a<0&&a>=-864e5?i="Yesterday":e.isToday()?i="Today":a>0&&a<1728e5&&(i="Tomorrow")),i||(i=e.toString(o.default.International.getFormat(e.getFullYear()!==Date.today().getFullYear()?u.a.DFormat.MonthDayYear:u.a.DFormat.MonthDay))),e.hasTimeOfDay()&&(i+=" "+e.toString("h:mmtt").toLowerCase()),i}},{key:"testGetNext",value:function(e,t,a){}},{key:"testOnDate",value:function(e,t,a){}}]),e}();t.a=new p},65:function(e,t,a){"use strict";var i,n,r,s=a(12),o=a.n(s),l=a(22),u=a.n(l),d=a(5),c=a.n(d),h=a(6),f=a.n(h),p=a(10),g=a.n(p),m=a(9),v=a.n(m),y=a(11),k=a.n(y),_=a(13),S=a.n(_),P=a(0),w=a(1),I=a(3),b=a(14),D=a(37),E=a(66),C=a(26),A=a(35),M=a.n(A),T=function(e,t,a){return Object.assign(a,M()({},e,t))},L={identity:function(e){return e},true:function(e){return!0},index:function(e,t){return t}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.identity,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.true,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return T(e(i,n),t(i,n),a)},R=function(e,t,a){return x(void 0,void 0,e,t,a)},O=function(e,t){var a={id:e.id},i=function(i){void 0===t[i]?a[i]=null:e[i]!==t[i]&&(a[i]=t[i])};return Object.keys(e).forEach(i),Object.keys(t).forEach(i),a},F=function(e,t,a){return"Removed"===e||"Added"===e?{type:e,value:a}:{type:e,value:t?O(t,a):a}},N=function(e,t){return{type:t,value:e}},B=function(e,t){return function(t){return[t].map((a=e,function(e){return F(e.type,a[e.value.id],e.value)}))[0];var a}},U=function(e,t){var a,i=t.value;return e=(a="id",function(e,t,i){return x(function(e){return function(t){return function(e,t){return t?t[e]:void 0}(e,t)}}(a),L.identity,e,t,i)})(e,i),"Removed"===t.type&&delete e[i.id],e},V=function(e){return e.changes.map(function(e){return e.value})},H=function(e){var t=e.changes,a=e.prevStore;return t.map(B(a))},j=function(e){return e._store={},e},z=function(e){var t=e.changes,a=(e.type,e.prevStore,e.api);return a._store=t.reduce(U,a._store),a},q=function(e){var t=e.item,a=e.api,i=e.changeType,n=Object.assign({},a._store),r=N(t,i);z({changes:[r],prevStore:n,api:a})},W=function(e){return function(t,a){return q({item:a,api:t,changeType:e})}},G={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return z({api:a,type:"update",changes:t,prevStore:i})},normalizeChanges:H,addItem:W("Added"),removeItem:W("Removed"),modifyItem:W("Modified")},K={load:function(e){var t=e.changes,a=e.api,i=e.prevStore;return z({changes:t,api:j(a),prevStore:i})},normalizeChanges:V},Y=a(133),X=a.n(Y),Q=function(e,t,a){return e.push(t),a},J=function(e,t,a){var i=e.indexOf(t);return i>-1&&e.splice(i,1),a},Z=function(e,t,a){var i=!0,n=!1,r=void 0;try{for(var s,o=0,l=function(){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var e=s.value;setTimeout(function(){return e.apply(void 0,X()(t))},0)},u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)l()}catch(d){n=!0,r=d}finally{try{i||null==u.return||u.return()}finally{if(n)throw r}}return a},$=function(e){return function(t,a){return function(e,t,a){var i=Object.assign({},a._store),n=a._loadingState,r="load"===n?a._loader:a._updater,s="load"===n;(s||(e=e.filter(function(e){var t=e.value;return"Removed"===e.type||!i[t.id]||t.d!==i[t.id].d})),s)&&(a._loadingState="update","load"===n&&a._earlyEdits.length&&(a._earlyEdits.forEach(function(e){Z(a._callbacks.update,[e])}),a._earlyEdits=[]));if("update"===a._loadingState){if(s||e.length>0){a=r.load({api:a,changes:e,prevStore:i});var o=r.normalizeChanges({api:a,changes:e,prevStore:i});Z(a._callbacks[n],[{responses:o},t]),Z(a._callbacks["".concat(n,"Debug")],[{responses:o,changes:e,api:a},t])}}else a._earlyEdits.push({changes:e,api:a});return a}(t,a,e)}},ee=function(e){var t=e.id,a=e.store;return a[t]?Object.assign({},a[t]):void 0},te=[],ae=function(e){var t=e.db,a=e.config,i=e.ignore,n=void 0===i?te:i,r=e.backend,s=e.path,o=e.orderBy,l=e.startAt,u=e.extraModifiedPath,d=e.encryptedFields,c={_config:a,_database:t,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:n.reduce(R,{}),_loadingState:"load",_earlyEdits:[],_backend:r.create({db:t,path:s,orderBy:o,startAt:l,extraModifiedPath:u,encryptedFields:d}),_loader:K,_updater:G};return c._backend.onUpdate($(c)),c.get=function(e){return ee({id:e,store:c._store})},c.getFromRemote=function(e){return c._backend.getFromRemote(e)},c.update=function(e){return function(e){var t=e.item,a=e.backend,i=e.api;var n,r=(n=i._ignore,function(e){return function(e,t){if(!e)return e;var a={};for(var i in e)i in t||(a[i]=e[i]);return a}(e,n)})(t);return i._updater.modifyItem(i,r),a.update(r,function(e){return i._updater.modifyItem(i,e)})}({item:e,backend:c._backend,api:c})},c.getPathForItem=function(e){return function(e){var t=e.item,a=e.backend;e.api,e.batch;return a.getPathForItem(t)}({item:e,backend:c._backend,api:c})},c.remove=function(e){return function(e){var t=e.item,a=e.backend,i=e.api;return i._updater.removeItem(i,t),console.log("remove",t),a.remove(t)}({item:e,backend:c._backend,api:c})},c.onLoad=function(e){return Q(c._callbacks.load,e)},c.offLoad=function(e){return J(c._callbacks.load,e)},c.onUpdate=function(e){return Q(c._callbacks.update,e)},c.offUpdate=function(e){return J(c._callbacks.update,e)},c.onLoadDebug=function(e){return Q(c._callbacks.loadDebug,e)},c.offLoadDebug=function(e){return J(c._callbacks.loadDebug,e)},c.onUpdateDebug=function(e){return Q(c._callbacks.updateDebug,e)},c.offUpdateDebug=function(e){return J(c._callbacks.updateDebug,e)},c.setSent=function(e,t){return c._backend.setSent(e,t)},c},ie=a(51),ne=function(){function e(t){var a=t.path,i=t.orderBy,n=t.startAt,r=t.extraModifiedPath,s=t.encryptedFields;c()(this,e),this.path=a,this.session=ie.a.database(),this.orderBy=i,this.startAt=n,this.extraModifiedPath=r,this.encryptedFields=s,this.updatesSent={},this.reqNum=0}return f()(e,[{key:"update",value:function(e){var t=this;var a={},i=Object.assign({},e);delete i.id,P.default.isObject(i)?Object.keys(i).forEach(function(n){a["".concat(t.path,"/").concat(e.id,"/").concat(n)]=i[n]}):a["".concat(this.path,"/").concat(e.id)]=i,this.extraModifiedPath&&(a[this.extraModifiedPath]=ie.a.database.ServerValue.TIMESTAMP);var n=this.setSent(e.id,a);return this.session.ref().update(a).then(function(){return delete t.updatesSent[e.id][n],P.default.isEmpty(t.updatesSent[e.id])}).catch(function(e){return P.default.reportError(e)})}},{key:"getPathForItem",value:function(e){return"".concat(this.path,"/").concat(e.id,"/")}},{key:"remove",value:function(e){var t=this,a=this.setSent(e.id,{type:w.a.CrudActions.Removed,id:e});return this.session.ref("".concat(this.path,"/").concat(e.id)).remove().then(function(){return delete t.updatesSent[e.id][a],P.default.isEmpty(t.updatesSent[e.id])})}},{key:"toChangeInternal",value:function(e,t,a){return t.id=e,{type:a,value:t}}},{key:"isChangeRemote",value:function(e){var t=e.key,a=(e.val(),this.updatesSent[t]);return!(a&&!P.default.isEmpty(a))}},{key:"onUpdate",value:function(e){var t=this;this.cbOnUpdate=e;var a=!1,i=this.session.ref(this.path);this.orderBy&&this.startAt&&(i=i.orderByChild(this.orderBy).startAt(this.startAt)),i.once("value",function(i){if(!a){a=!0;var n=i.val(),r=Object.keys(n||{}).map(function(e){return t.toChangeInternal(e,n[e],"load")});e(r,!0)}},function(e){console.log("Firebase error",e)}),i.on("child_added",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"Added")];e(n,t.isChangeRemote(i))}},function(e){console.log("Firebase error",e)}),i.on("child_changed",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"Modified")];e(n,t.isChangeRemote(i))}},function(e){console.log("Firebase error",e)}),i.on("child_removed",function(i){if(a){var n=[t.toChangeInternal(i.key,i.val(),"Removed")];e(n,t.isChangeRemote(i))}},function(e){console.log("Firebase error",e)})}},{key:"setSent",value:function(e,t){var a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}}]),e}(),re=new(i=function(){function e(){c()(this,e)}return f()(e,[{key:"init",value:function(){return this.session||(this.database=this.session=ie.a.database()),this.serverTime=ie.a.database.ServerValue.TIMESTAMP,this}},{key:"create",value:function(e){return new ne(e)}},{key:"onOnlineChange",value:function(e){this.session.ref(".info/connected").on("value",function(t){e(!0===t.val())})}},{key:"generateId",value:function(){return ie.a.database().ref().push().key}}]),e}(),S()(i.prototype,"onOnlineChange",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"onOnlineChange"),i.prototype),S()(i.prototype,"generateId",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"generateId"),i.prototype),i),se=a(56),oe=a.n(se),le=function(){function e(t,a){c()(this,e),this.path=t,this.firebasePath=new ne({path:t}),this.session=ie.a.database(),this.dataCache={},this.isLoaded=!1,this.ignoreLocalChange=!1,this.cbsOnUpdate={},this.updatesSent={},this.reqNum=0,this.encryptedFields=a}return f()(e,[{key:"toChangeInternal",value:function(e,t,a){var i=e.ref.path.slice(2),n=e.val(),r={},s=r,o=this.dataCache;if("object"===oe()(n)){var l=0;0;for(var u=0;u<i.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=i[u];s[d]={},s=s[d],"Removed"!==t&&(o[d]||(o[d]={}),o&&(o=o[d]))}Object.keys(n).forEach(function(e){s[e]=n[e],"Removed"!==t?o[e]=n[e]:o&&delete o[e]}),r=r[i[0]]}else{var c=e.key;o[a]||(o[a]={}),o=o[a],"Removed"!==t?o[c]=n:o&&delete o[c],r[c]=n}return{type:t,value:r}}},{key:"set",value:function(){var e=u()(o.a.mark(function e(t,a){var i,n,r,s,l,u,d,c=0;return o.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:i=t.split("/"),n=this.dataCache,r=i[i.length-1],s="".concat(this.path,"/").concat(t),l=0;case 3:if(!(l<i.length-1)){e.next=16;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){e.next=6;break}throw new RangeError;case 6:if(n){e.next=8;break}return e.abrupt("return",Promise.resolve(!1));case 8:if(i[l]){e.next=11;break}return e.abrupt("continue",13);case 11:n[i[l]]||(n[i[l]]={}),n=n[i[l]];case 13:l++,e.next=3;break;case 16:return n[r]=a,u=this.session.ref(s),d=this.setSent(t,a),e.prev=20,e.next=23,u.update(a);case 23:return delete this.updatesSent[t][d],e.abrupt("return",P.default.isEmpty(this.updatesSent[t]));case 27:e.prev=27,e.t0=e.catch(20),P.default.reportError(e.t0);case 30:return e.abrupt("return",!1);case 31:case"end":return e.stop()}}},e,this,[[20,27]])}));return function(t,a){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=u()(o.a.mark(function e(t){var a;return o.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a=this.setSent(t,{type:w.a.CrudActions.Removed,id:t}),e.prev=1,e.next=4,this.session.ref("".concat(this.path,"/").concat(t)).remove();case 4:return delete this.updatesSent[t][a],e.abrupt("return",P.default.isEmpty(this.updatesSent[t]));case 8:e.prev=8,e.t0=e.catch(1),P.default.reportError(e.t0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"isChangeRemote",value:function(e){var t=this.updatesSent[e];return!(t&&!P.default.isEmpty(t))}},{key:"sendChangeCB",value:function(e,t,a){var i=e.ref.path;P.default.isString(i)&&(i=i.split("/"));var n=i.slice(2).join("/"),r=this.isChangeRemote(n);r&&a(t,r)}},{key:"onLoad",value:function(e,t){var a=this;this.session.ref(this.path).once("value",function(t){if(!a.isLoaded){a.isLoaded=!0;var i=t.val()||{};a.dataCache=i,e(i)}},function(e){P.default.log("Firebase error",e),t?t(e):P.default.reportError(e,"Missing cbError handler: "+a.path)})}},{key:"onUpdate",value:function(e,t,a){var i=this;this.cbsOnUpdate[e]=t;var n=this.path+"/"+e;this.session.ref(n).on("child_added",function(a){if(i.isLoaded){var n=i.toChangeInternal(a,"Added",e);i.sendChangeCB(a,n,t)}},function(e){console.log("Firebase error",e),a&&a(e)}),this.session.ref(n).on("child_changed",function(a){if(i.isLoaded){var n=i.toChangeInternal(a,"Modified",e);i.sendChangeCB(a,n,t)}},function(e){console.log("Firebase error",e),a&&a(e)}),this.session.ref(n).on("child_removed",function(a){if(i.isLoaded){var n=i.toChangeInternal(a,"Removed",e);i.sendChangeCB(a,n,t)}},function(e){console.log("Firebase error",e),a&&a(e)})}},{key:"offUpdate",value:function(e,t){var a=this.path+"/"+e;this.session.ref(a).off("child_added",t),this.session.ref(a).off("child_changed",t),this.session.ref(a).off("child_removed",t)}},{key:"setSent",value:function(e,t){var a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}}]),e}(),ue=(n=function(){function e(t,a,i){c()(this,e),this.docID=t,this.uid=a,this.userDocuments=i,this.treeApi=new le("documents/".concat(t),{"p/s":!0}),this.cbs=[],this.cbsAcl=[]}return f()(e,[{key:"onLoad",value:function(e,t){this.treeApi.onLoad(function(t){e(t)},t)}},{key:"onUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("p",e,t)}},{key:"offUpdate",value:function(e){var t=this.cbs.indexOf(e);this.cbs.splice(t,1),this.treeApi.offUpdate("p",e)}},{key:"onAclUpdate",value:function(e,t){this.cbsAcl.push(e),this.treeApi.onUpdate("a",e,t)}},{key:"offAclUpdate",value:function(e){var t=this.cbsAcl.indexOf(e);this.cbsAcl.splice(t,1),this.treeApi.offUpdate("p",e)}},{key:"create",value:function(e,t){var a,i=Object.assign({},e),n={t:i.p.t};i.p.d&&(n.d=i.p.d),delete i.id;var r=(a={},M()(a,"/documents/".concat(this.docID),i),M()(a,"/userdocuments/".concat(this.uid,"/").concat(this.docID),n),a);if(t)for(var s=0,o=0;o<t.length;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=t[o],u=l.id;delete l.id,r["/items/".concat(this.docID,"/").concat(u)]=l}return this.userDocuments.setSent(this.docID,n),re.database.ref().update(r)}},{key:"unlisten",value:function(){this.cbs.forEach(this.offUpdate),re.database.ref("/items/".concat(this.docID)).off(),re.database.ref("/userdocuments/".concat(this.uid,"/").concat(this.docID)).off(),re.database.ref("/documents/".concat(this.docID,"/a")).off(),re.database.ref("/documents/".concat(this.docID)).off()}},{key:"deleteFully",value:function(){var e;this.unlisten();var t=(e={},M()(e,"/items/".concat(this.docID),null),M()(e,"/userdocuments/".concat(this.uid,"/").concat(this.docID),null),M()(e,"/documents/".concat(this.docID),null),e);return re.database.ref().update(t)}},{key:"update",value:function(e,t){var a=Object.assign({},e);delete a.id;var i={};t?i["/documents/".concat(this.docID,"/p")]=a.p:i["/documents/".concat(this.docID)]=a,a.p.d&&(i["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/d")]=a.p.d),a.p.t&&(i["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/t")]=a.p.t),re.database.ref().update(i)}},{key:"addBackup",value:function(e){re.database.ref("/documents/".concat(this.docID,"/c")).update(M()({},e,""))}}]),e}(),S()(n.prototype,"offUpdate",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"offUpdate"),n.prototype),S()(n.prototype,"offAclUpdate",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"offAclUpdate"),n.prototype),n),de=function(){function e(t){var a=this;c()(this,e),this.uid=t,this.session=ie.a.database(),this.treeApi=new le("users/".concat(t),{"s/aE/v":!0});var i={a:"AuthToken",b:"Board",p:"Property",s:"Setting"};Object.keys(i).forEach(function(e){var t=i[e];a["on"+t+"Update"]=a.treeApi.onUpdate.bind(a.treeApi,e),a["set"+t]=function(t,i){return a.treeApi.set(e+"/"+t,i)},a["remove"+t]=function(t){return a.treeApi.remove(e+"/"+t)}})}return f()(e,[{key:"onLoad",value:function(e){this.treeApi.onLoad(function(t){e({properties:t.p,settings:t.s,authTokens:t.a,boards:t.b})},void 0)}},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(){var e,t=(e={},M()(e,"/users/".concat(this.uid,"/a"),null),M()(e,"/users/".concat(this.uid,"/b"),null),M()(e,"/users/".concat(this.uid,"/s"),null),e);return this.session.ref().update(t)}}]),e}(),ce=function(){function e(t){c()(this,e),this.uid=t,this.docs={},this.db={firebase:ie.a,session:ie.a.database()},re.init(),this.onOnlineChange=re.onOnlineChange,this.serverTime=re.serverTime,this.generateId=re.generateId,this.user=new de(t),this.userDocuments=ae({db:this.db,backend:re,path:"userdocuments/".concat(t),encryptedFields:{s:!0}})}return f()(e,[{key:"loadDocuments",value:function(e){this.userDocuments.onLoad(function(t){var a=t.responses;e(a)})}},{key:"onDocumentsUpdate",value:function(e){this.userDocuments.onUpdate(e)}},{key:"document",value:function(e,t,a){if(!(e in this.docs)){try{P.default.PAssert(531,!t||!isNaN(t)&&t<Date.now(),"Date modified is not number: "+t)}catch(r){P.default.reportError(r)}var i=a||new ue(e,this.uid,this.userDocuments),n=ae({db:this.db,backend:re,path:"items/".concat(e),orderBy:"d",startAt:t&&!isNaN(t)?t+1:void 0,extraModifiedPath:"documents/".concat(e,"/p/d"),encryptedFields:{t:!0}});this.docs[e]={info:i,items:n}}return this.docs[e]}},{key:"addDocument",value:function(e,t){var a=this,i=e.id,n=this.docs[i];if(!n){var r=new ue(i,this.uid,this.userDocuments);return r.create(e,t).then(function(){return a.document(i,void 0,r)})}return Promise.resolve(n)}},{key:"forgetDocument",value:function(e){var t=this.docs[e];return delete this.docs[e],t._callbacks={update:[],load:[],updateDebug:[],loadDebug:[]},!0}},{key:"commitBatch",value:function(e){return this.db.session.ref().update(e)}}]),e}(),he=a(118),fe=a(119),pe=a(28),ge=a(17),me=a(41),ve=a(15),ye=a(109),ke=a(23),_e=a(67),Se=a(33),Pe=(r=function(e){function t(){var e;return c()(this,t),(e=g()(this,v()(t).call(this,!1))).documentsEncrypted={},e._isLoaded=!1,e.loadState=new ve.a(w.a.LoadState.Connecting),e}return k()(t,e),f()(t,[{key:"init",value:function(e,t){if(this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=e,this.cbOnDocumentsChanged=t,this.savedDocInfo={},C.a.init(this,this.onLoadLocal),ke.a.hasURLParam("invite")){var a=ke.a.getURLParam("invite");pe.a.onAuthed(u()(o.a.mark(function e(){return o.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_e.a.acceptInvite(a);case 2:e.sent.error||ke.a.removeURLParam("invite");case 4:case"end":return e.stop()}}},e)})))}}},{key:"onLoadLocal",value:function(e,t){var a=this,i=t.documentsPending,n=t.itemsPending,r=t.settingsPending,s=t.boardsPending,o=t.isPreload;e||(e=[]),e.forEach(function(e){return a.documents[e.id]=e}),this.documentsPending=i,this.itemsPending=n,this.settingsPending=r,this.boardsPending=s,this.cbOnLoad&&this.cbOnLoad(e),o||(this.cbOnLoad=void 0,I.default.settings.userId.onHasValue(function(){a.createStore()}))}},{key:"onLoadRemoteDocuments",value:function(){this._isLoaded=!0,this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),Se.a.ensureSelected(),I.default.settings.lastSync.set(Date.now())}},{key:"createStore",value:function(){var e,t,a=this,i=new ce(pe.a.getUid());this.api=i;var n=function(){e&&t&&(Object.keys(a.documents).forEach(function(e){!a.documentsPending[e]&&t.indexOfWithProperty("id",e)<0&&(a.documents[e].delete(!0),delete a.documents[e])}),Promise.all(Object.keys(a.documentsPending).map(function(e){var i=a.documents[e];return i&&(!t||t.indexOfWithProperty("id",i.id)<0)?a.addDocument(i,!1):Promise.resolve()})).then(function(){a.documentsPending={},C.a.beginBatch(),Promise.all(t.map(function(e){return a.loadDocumentData(D.a.documentInFlat(e))})).then(function(){a.onLoadRemoteDocuments(),a.loadState.set(w.a.LoadState.Connected),C.a.commitBatch()})}).catch(function(e){return P.default.reportError(e)}))};i.user.onLoad(function(t){var i=I.default.settings.getSettingAbbrev("userEncryptionSentinel"),r=t.settings;t.properties?(a.userProperties=D.a.userIn(t.properties),I.default.billingManager.loadUserProperties(a.userProperties),I.default.settings.userProperties.set(a.userProperties),a.userProperties.fname||a.userProperties.lname||a.onFirstSync()):a.onFirstSync(),a.checkUserEncryption(r&&r[i]&&r[i].v,function(){a.loadState.set(w.a.LoadState.LoadingDocs),r&&a.onSettingsChange("Modified",r,!0,!0),a.settingsPending&&Object.keys(a.settingsPending).forEach(function(e){var t=I.default.settings.getValueFromAbbrev(e);void 0!==t&&a._setSettingRemote(e,t)});var i=t.boards;i&&a.onBoardsChange("Modified",i,!0),a.boardsPending&&Object.keys(a.boardsPending).forEach(function(e){var t=Se.a.getById(e);try{P.default.PAssert(289,t,"Pending board that does not exist")}catch(i){P.default.reportError(i)}t&&a._saveBoardRemote(t.getSaveInfo())}),e=!0;var s=t.authTokens;a.onAuthTokensChange("Added",s,!0),n(),I.default.settings.userEncryptionSentinel.listen(function(e){e?a.checkUserEncryption(e):I.default.settings.removeEncryptionKey(w.a.EncryptionKeys.UserPassword)})})}),i.user.onPropertyUpdate(function(e,t){var a=e.type,i=e.value;if(t){"Removed"===a&&Object.keys(i).forEach(function(e){return i[e]=null});var n=D.a.userIn(i);I.default.billingManager.loadUserProperties(n)}}),i.user.onSettingUpdate(function(e,t){var i=e.type,n=e.value;a.onSettingsChange(i,n,t,!1)}),i.user.onBoardUpdate(function(e,t){var i=e.type,n=e.value;a.onBoardsChange(i,n,t)}),i.user.onAuthTokenUpdate(function(e,t){var i=e.type,n=e.value;a.onAuthTokensChange(i,n,t)}),i.loadDocuments(function(e){t=e,n()}),i.onDocumentsUpdate(function(e,t){var i=e.responses;C.a.beginBatch(),Promise.all(i.map(function(e){var t=e.type,i=e.value;if("Removed"!==t)return a.loadDocumentData(D.a.documentInFlat(i));a.documents[i.id]&&(a.documents[i.id].delete(!0),delete a.documents[i.id])})).then(function(){C.a.commitBatch(),a.cbOnDocumentsChanged(a.documents,a.documentsEncrypted)}).catch(function(e){return P.default.reportError(e)})}),i.onOnlineChange(function(e){a.updateOnlineStatus(e)}),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var e=u()(o.a.mark(function e(){var t,a,i=this;return o.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(t=function(e){i.userProperties=e;var t={email:e.email,fname:e.given_name,lname:e.family_name,picture:e.picture,displayName:e.name};_e.a.setUserProperties(D.a.userOut(t))},!pe.a.userProfile){e.next=5;break}t(pe.a.userProfile),e.next=9;break;case 5:return e.next=7,pe.a.getUser();case 7:a=e.sent,me.a.getGoogleUserInfo(function(e){e?t({email:a.email,given_name:e.given_name,family_name:e.family_name,picture:a.photoURL,name:a.displayName}):I.default.settings.activeUser.set(void 0)});case 9:case"end":return e.stop()}}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"loadSingleDocument",value:function(){var e=u()(o.a.mark(function e(t){var a;return o.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadDocumentData(t);case 3:return a=e.sent,this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),e.abrupt("return",a);case 8:e.prev=8,e.t0=e.catch(0),P.default.reportError(e.t0);case 11:case"end":return e.stop()}}},e,this,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadDocumentData",value:function(){var e=u()(o.a.mark(function e(t){var a,i,n,r,s,l,u,d,c,h,f=this;return o.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!(i=this.documents[t.id])){e.next=6;break}a=i.dateModified.get(),e.next=9;break;case 6:if(!t.encryptionSentinel||I.default.crypto.canDecryptSentinel(t.encryptionSentinel)){e.next=9;break}return this.documentsEncrypted[t.id]=t,e.abrupt("return",Promise.resolve(void 0));case 9:return e.prev=9,n=this.api.document(t.id,a),e.next=13,new Promise(function(e){var a,i;if(f.savedDocInfo[t.id])Object.assign(f.savedDocInfo[t.id].docProps,t),e(f.savedDocInfo[t.id]);else{var r=function(){if(null===a)e(void 0);else if(a&&i){var n={docProps:a,docItemsEncrypted:i};f.savedDocInfo[t.id]=n,e(n)}},s=n.info;s.onLoad(function(e){e.id=t.id;var i=D.a.documentIn(e);a=i,r()},function(e){a=null,r()}),s.onUpdate(f.onDocInfoChange.bind(f,t)),s.onAclUpdate(f.onDocAclChange.bind(f,t));var o=n.items;o.onLoad(function(e){var t=e.responses;i=t,r()}),o.onUpdate(f.onItemsChange.bind(f,t))}});case 13:if(!(r=e.sent)){e.next=31;break}if(s=r.docProps,l=r.docItemsEncrypted,u=this.getEncryptionForDocument(s)){e.next=20;break}return t.encryptionSentinel=s.encryptionSentinel,this.documentsEncrypted[t.id]=t,e.abrupt("return",Promise.resolve(void 0));case 20:return d=a||0,e.next=23,Promise.all(l.map(function(e){return f.decryptItemIn(e,I.default.crypto,u)})).then(function(e){return e.forEach(function(e){e.docId=s.id,d=Math.max(d,e.dateModified)}),ye.a.createItemHierarchy(e,C.a.getItemsMap()),i&&e.length>0&&f.resolveItemConflicts(i,e),e});case 23:return c=e.sent,i&&Object.keys(this.itemsPending).forEach(function(e){var t=C.a.getItemData(e),a=ge.a.getItem(e),n=f.itemsPending[e];if(t&&t.docId===i.id){try{P.default.PAssert(290,a||t.isArchived||t.isDeleted,"Pending update that has no parent")}catch(o){P.default.reportError(o)}if(a||t.isArchived||t.isDeleted){var r=Object.keys(n);if(r.length>0){var s={id:e};r.forEach(function(e){s[e]=t[e]}),f._saveItemRemote(i,s)}}}}),c.length>0&&C.a.ensureMirror(c,!0,!1),s.dateModified=d,i?this.documentsPending[i.id]?(this._saveDocumentRemote(i),delete this.documentsPending[i.id]):i.onRemoteUpdate(s):s.root&&(s.backing=this,(h=P.default.clone(s)).rootData=this.getItemData(s.root),h.rootData&&(delete h.pendingSync,(i=E.a.fromData(h,this)).createVMLIs())),i&&(this.documents[i.id]=i,delete this.documentsEncrypted[i.id],C.a.saveDocument(i)),i||console.log("Failed to find root item"),e.abrupt("return",i);case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(9),console.log(e.t0),P.default.reportError(e.t0);case 38:case"end":return e.stop()}}},e,this,[[9,33]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getItemData",value:function(e){var t=this._coalescedChanges[e],a=C.a.getItemData(e,!0);return t&&"Removed"!==t.type&&(a=Object.assign({},a,t.info)),a}},{key:"getItemSaveData",value:function(e){return e.getFullSaveData()}},{key:"importItem",value:function(e,t){var a=this;e.getDocumentOwner(),e.parent();t.push(e),e.hasNote()&&this.importItem(e.getNote(),t),e.getItems().forEach(function(e,i){e.index=""+i,a.importItem(e,t)}),this._seenLocal[e.id]=!0}},{key:"onSettingsChange",value:function(e,t,a,i){var n=this,r=t;Object.keys(t).forEach(function(i){var s=t[i];a&&n.settingsPending[i]?(r===t&&(r=P.default.clone(t)),delete r[i],t[i]={v:I.default.settings.getValueFromAbbrev(i)}):delete n.settingsPending[i],s.v="Removed"===e?void 0:n.decodeValue(s.v)}),"Removed"===e&&C.a.deleteSettings(r),I.default.settings.load(t,i)}},{key:"onBoardsChange",value:function(e,t,a){var i=this;Object.keys(t).forEach(function(n){if(!a||!i.boardsPending[n]){t[n].id=n;var r=D.a.boardIn(t[n]);"Removed"===e?C.a.deleteBoard(n):C.a.saveBoard(r),a&&Se.a.onRemoteUpdate(e,r)}})}},{key:"onAuthTokensChange",value:function(e,t,a){var i={};t&&"Removed"!==e&&Object.keys(t).forEach(function(e){var a=e.replace(/,/g,"."),n=t[e],r=n.s?n.s.split(" "):void 0,s={email:a,scopes:r?r.map(function(e){return w.a.GScopeArray[e]}):void 0};try{P.default.PAssert(291,"Have an auth token without scopes")}catch(o){P.default.reportError(o)}i[a]=s}),me.a.loadWithTokens(i)}},{key:"onDocAclChange",value:function(e,t,a){var i=t.type,n=t.value,r=this.documents[e.id];r&&("Removed"===i&&Object.keys(n).forEach(function(e){n[e]=void 0}),r.onAclUpdate(n),C.a.saveDocument(r))}},{key:"onDocInfoChange",value:function(e,t,a){var i=t.type,n=t.value,r=this.documents[e.id];if(r)if("Removed"!==i){if(n){var s={text:n.t,encryptionSentinel:n.s};r&&(r.onRemoteUpdate(s),s.encryptionSentinel&&!r.canDecrypt()&&(this.documentsEncrypted[r.id]=r.getSaveInfo(),delete this.savedDocInfo[r.id],r.delete(!0),this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),I.default.PaneManager.runForEachPane(function(e){e.document.get()===r&&e.setDocument(ge.a.getDefaultDocument())})),C.a.saveDocument(r))}}else 0}},{key:"_processItemsChange",value:function(){var e=u()(o.a.mark(function e(){var t,a,i,n,r,s,l,u,d,c,h,f,p,g,m,v=this;return o.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isProcessingItemsChanged||this._pauseProcessingItemsChanged||!(this._itemsChangedQueue.length>0)){e.next=32;break}if(this._isProcessingItemsChanged=!0,t=this._itemsChangedQueue[0],a=t.docInfo,i=t.responses,n=t.isRemote,this._itemsChangedQueue.splice(0,1),r=[],s=this.documents[a.id],e.prev=5,!s){e.next=25;break}return l=0,e.next=10,Promise.all(i.map(function(e){return v.decryptItemIn(e.value,I.default.crypto,s.getBestEncryption()).then(function(t){return{type:e.type,value:t}})}));case 10:u=e.sent,n&&I.default.PaneUpdateBatcher.beginUpdateItems(),d=s.dateModified.get()||0,c=0;case 14:if(!(c<u.length)){e.next=23;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=17;break}throw new RangeError;case 17:h=u[c],f=h.type,p=h.value,g=p,d=Math.max(d,p.dateModified),n?(this.handleRemoteItemChange(this.documents[a.id],p.id,p),"Removed"===f?C.a.deleteItem(p):(g.docId=a.id,r.push(g))):(m=ge.a.getItem(p.id))&&m.setDateModified(new Date(p.dateModified));case 20:c++,e.next=14;break;case 23:n&&(I.default.PaneUpdateBatcher.commitUpdateItems(),r.length>0&&C.a.ensureMirror(r,!0)),s&&(this._updateDocModified(s,d),C.a.saveDocument(s));case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(5),P.default.reportError(e.t0);case 30:this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange();case 32:case"end":return e.stop()}}},e,this,[[5,27]])}));return function(){return e.apply(this,arguments)}}()},{key:"onItemsChange",value:function(e,t,a){var i=t.responses;(i=i.filter(function(e){var t=e.value,a=Object.keys(t).length;return void 0!==t.d&&a--,void 0!==t.id&&a--,a>0})).length>0&&(this._itemsChangedQueue.push({docInfo:e,responses:i,isRemote:a}),this._processItemsChange())}},{key:"convertItemUndefineds",value:function(e,t){var a=this,i=this.getItemData(e.id);return Object.keys(t).forEach(function(n){void 0===t[n]&&(void 0===i[n]?delete t[n]:t[n]=a.getAPIForItem(e).props.remove)}),t}},{key:"_coalesceChange",value:function(e,t,a,i){var n=this._coalescedChanges[t],r=!n;i.id||(i.id=t),n&&("Modified"===n.type?n.info=Object.assign(n.info,i):n.type),r&&(n=this._coalescedChanges[t]={id:t,time:Date.now(),doc:e,type:a,info:i}),this.isCoalescing?this.needsCoalesceAfterFinish=!0:this._timeoutCoalesce||(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}},{key:"_runCoalescedChanges",value:function(){var e=u()(o.a.mark(function e(){return o.a.wrap(function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._timeoutCoalesce=void 0,this.needsCoalesceAfterFinish=!1,this.isCoalescing=!0,e.prev=3,e.next=6,this._runCoalescedChangesInside();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),P.default.reportError(e.t0);case 11:this.isCoalescing=!1,this.needsCoalesceAfterFinish&&!this._timeoutCoalesce&&(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0));case 13:case"end":return e.stop()}}},e,this,[[3,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"_runCoalescedChangesInside",value:function(){var e=u()(o.a.mark(function e(){var t,a,i,n,r,s,l=this;return o.a.wrap(function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!this._isLoaded){e.next=14;break}if(!((t=P.default.objectValues(this._coalescedChanges)).length>0)){e.next=14;break}if(a=t.sort(function(e,t){return e.time-t.time}),i=[],a.forEach(function(e){var t=e.info,a=e.doc,n=ge.a.getItem(e.id);"Added"===e.type?l.importItem(n,i):"Modified"===e.type?n.isNote()&&!t.isDeleted?l.importItem(n,i):P.default.isEmpty(t)||l._saveItem(a,n,t):"Removed"===e.type&&l._saveItem(a,n,t)}),n=[],r=[],s={},i.map(function(e){if(!s[e.id]){s[e.id]=!0;var t=e.getFullSaveData(),a=l._prepDataSaveLocal(e,t),i=a.localChanges,o=a.remoteChanges;n.push(i),r.push({item:e,itemData:o})}}),this.checkItemsPending(),this._coalescedChanges={},!(n.length>0)){e.next=13;break}return e.next=13,C.a.ensureMirror(n,!1);case 13:r.forEach(function(e){var t=e.item,a=e.itemData;l._saveItemRemote(t._documentOwner,a)});case 14:case"end":return e.stop()}}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveItem",value:function(e,t,a,i,n){P.default.isLocalChange(i)&&!P.default.isUndoRedoChange(i)&&this._coalesceChange(e,t.id,"Modified",a)}},{key:"addItem",value:function(e,t){var a=this.getItemSaveData(t);this._coalesceChange(e,t.id,"Added",a)}},{key:"deleteItem",value:function(e,t,a){this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})}},{key:"deleteItemRecursive",value:function(e,t){var a=this;t.forEachChildRecursive(function(t){a._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})},!0,!0)}},{key:"generateNewItemIDsRecursive",value:function(e){var t=this;e.forEachChildRecursive(function(e){e.id=t.generateId(),ge.a.setItem(e)},!0,!0)}},{key:"setNote",value:function(e,t,a,i,n){if(P.default.isLocalChange(n))if(a){var r=this.getItemSaveData(a);this._coalesceChange(e,a.id,"Modified",r)}else i&&this._coalesceChange(e,i.id,"Modified",{id:i.id,isDeleted:!0})}},{key:"moveItem",value:function(e,t){var a=e.parent(),i=e.index,n=e.getDocumentOwner(),r=t.getDocumentOwner();n===r?this._coalesceChange(n,e.id,"Modified",{id:e.id,parent:a.id,index:i}):(this.deleteItemRecursive(r,e),this.generateNewItemIDsRecursive(e),this.addItem(n,e))}},{key:"_prepDataSaveLocal",value:function(e,t){t.parent&&P.default.isVMLI(t.parent)&&(t.parent=t.parent.id);var a=P.default.extend({id:e.id},t),i=C.a.getItemData(e.id)||{},n=i.pendingSync||{};Object.keys(t).forEach(function(e){"id"!==e&&"dateModified"!==e&&void 0===n[e]&&(n[e]=i[e])});var r=Object.assign({pendingSync:n},a);return this.itemsPending[e.id]=Object.assign(this.itemsPending[e.id]||{},n),{localChanges:r,remoteChanges:a}}},{key:"_saveItem",value:function(e,t,a){var i=this._prepDataSaveLocal(t,a),n=i.localChanges,r=i.remoteChanges;C.a.saveItem(n,t),e.needsSave||this._saveItemRemote(e,this.convertItemUndefineds(t,r)),this.checkItemsPending()}},{key:"_saveItemRemote",value:function(){var e=u()(o.a.mark(function e(t,a){var i,n;return o.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=15;break}return e.next=4,this.encryptItemForSaveRemote(t,a);case 4:if(i=e.sent,!D.a.validateOutFields(i,!0)){e.next=14;break}return e.next=9,this.getAPIForDocumentItems(t).update(i);case 9:return(n=e.sent)&&(delete this.itemsPending[a.id],this.checkItemsPending(),C.a.saveItem({id:a.id,pendingSync:void 0})),e.abrupt("return",n);case 14:0;case 15:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return ie.a.database().ref().push().key}},{key:"addDocument",value:function(e,t){var a=this,i=e.getSaveInfo(),n=e.getRootItem(),r=this.getItemSaveDataRecursive(n);if(!1!==t&&(this.documents[e.id]=e,i.pendingSync=Date.now(),C.a.saveDocument(e),C.a.ensureMirror(r,!0)),this.documentsPending&&(this.documentsPending[e.id]=e),this.api){var s=D.a.documentOut(i);return Promise.all(r.map(function(t){return a.encryptItemForSaveRemote(e,t)})).then(function(e){a.api.addDocument(s,e).then(function(e){e.items.onLoad(P.default.emptyFn),e.items.onUpdate(a.onItemsChange.bind(a,i)),e.info.onLoad(P.default.emptyFn),e.info.onUpdate(a.onDocInfoChange.bind(a,i)),e.info.onAclUpdate(a.onDocAclChange.bind(a,i))})}).catch(function(e){return P.default.reportError(e)})}return Promise.resolve()}},{key:"encryptItemForSaveRemote",value:function(){var e=u()(o.a.mark(function e(t,a){return o.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a.dateModified=this.api.serverTime,delete a.pendingSync,delete a.docId,delete a.noteItem,e.abrupt("return",D.a.encryptItemOut(a,I.default.crypto,t.getBestEncryption()));case 6:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e){this.documentsPending[e.id]=!0,C.a.saveDocument(e,{pendingSync:Date.now()}),this._saveDocumentRemote(e)}},{key:"_saveDocumentRemote",value:function(e){var t=e.getSaveInfo();delete t.dateModified;var a=D.a.documentOut(t,{onlyUpdate:!0});D.a.validateOutFields(a,!0)&&this.getAPIForDocument(e).update(a,!0)}},{key:"getItemSaveDataRecursive",value:function(e,t){var a=this,i=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach(function(e){a.getItemSaveDataRecursive(e,t)}),i&&(t=t.map(function(e){return a.getItemSaveData(e)})),t}},{key:"encodeValue",value:function(e){return P.default.isObject(e)||P.default.isArray(e)?JSON.stringify(e):e}},{key:"decodeValue",value:function(e){if(e.length>1&&("{"===e[0]||"["===e[0]))try{e=JSON.parse(e)}catch(t){0}return e}},{key:"getSetting",value:function(e){return C.a.getSetting(e)}},{key:"setSetting",value:function(e,t){var a=Date.now();C.a.setSetting(e,{pendingSync:a,v:t}),this._setSettingRemote(e,t)}},{key:"_setSettingRemote",value:function(e,t){var a=this;if(this.api){var i;if(void 0===t||null===t)i=this.api.user.removeSetting(e);else{t=this.encodeValue(t),this.settingsPending[e]=!0;var n={v:t,d:this.api.serverTime};i=this.api.user.setSetting(e,n)}i.then(function(t){if(t){delete a.settingsPending[e];var i=C.a.getSetting(e);delete i.pendingSync,C.a.setSetting(e,i)}})}}},{key:"saveBoard",value:function(e){var t=Date.now(),a=Object.assign({pendingSync:t},e);C.a.saveBoard(a),this._saveBoardRemote(e)}},{key:"_saveBoardRemote",value:function(e){var t=this;if(this.api){var a=P.default.cloneDeep(e);delete a.id,delete a.pendingSync,this.boardsPending[e.id]=!0;var i=D.a.boardOut(a);i.d=this.api.serverTime,this.api.user.setBoard(e.id,i).then(function(a){if(a){delete t.boardsPending[e.id];var i=C.a.getBoard(e.id);delete i.pendingSync,C.a.saveBoard(i)}})}}},{key:"deleteBoard",value:function(e){C.a.deleteBoard(e),this.api&&this.api.user.removeBoard(e)}},{key:"getBoards",value:function(){return C.a.getBoards()}},{key:"deleteAuthToken",value:function(e){this.api&&(e=e.replace(/\./g,","),this.api.user.removeAuthToken(e))}},{key:"getAPIForDocument",value:function(e){return this.api.document(e.id).info}},{key:"getAPIForDocumentItems",value:function(e){return this.api.document(e.id).items}},{key:"getAPIForItem",value:function(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}},{key:"clearAllData",value:function(){var e=u()(o.a.mark(function e(){var t=this;return o.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.a.clearAllData();case 3:return e.next=5,Promise.all(Object.keys(this.documents).map(function(e){return t.documents[e].isAdmin()?t.getAPIForDocument({id:e}).deleteFully():Promise.resolve()}));case 5:return e.abrupt("return",this.api.user.deleteFully());case 8:e.prev=8,e.t0=e.catch(0),P.default.reportError(e.t0);case 11:case"end":return e.stop()}}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"deleteDocument",value:function(e,t){C.a.deleteDocument(e),t?this.getAPIForDocument(e).unlisten():this.getAPIForDocument(e).deleteFully(),this.api.forgetDocument(e.id),delete this.documents[e.id]}},{key:"unlistenDocument",value:function(e){this.getAPIForDocument(e).unlisten(),this.api.forgetDocument(e.id),delete this.documents[e.id]}},{key:"updateOnlineStatus",value:function(e){var t=ge.a.onlineStatus,a=t.get();e||"Connecting"!==a?(P.default.clearTimeoutOnce("initialOffline"),t.set(e?"Online":"Offline")):pe.a.isOnline()?P.default.timeoutOnce("initialOffline",function(){return t.set("Offline")},2e3):t.set("Offline")}},{key:"resolveItemConflicts",value:function(e,t){var a=this;I.default.PaneUpdateBatcher.beginUpdateItems();var i=e.dateModified.get()||0;t.forEach(function(t){var n=a.itemsPending[t.id],r=ge.a.getItem(t.id),s=a.getItemData(t.id);n&&(Object.keys(n).forEach(function(i){var o=s[i],l=t[i];if(l===n[i]||l===o)o===l&&delete n[i],delete t[i];else if("text"!==i||t.isDeleted)delete t[i];else{var u="Sync Conflict: ".concat(l,"  ;  ").concat(o);n[i]=t.text,a.handleRemoteItemChange(e,r.id,{text:u}),C.a.saveItem({id:r.id,text:u},r),delete t[i]}}),t.isDeleted&&(t.isDeleted=!1,n.isDeleted=!0,a.handleRemoteItemChange(e,t.id,t),r||(r=ge.a.getItem(t.id)),r&&C.a.saveItem({id:r.id,isDeleted:!1},r))),i=Math.max(i,t.dateModified);var o=t.id;P.default.isEmpty(t)||a.handleRemoteItemChange(e,o,t)}),this._updateDocModified(e,i),I.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(e,t,a){var i,n,r=this.getItemData(t);r?(n={id:t},Object.keys(a).forEach(function(e){r[e]!==a[e]&&("dateModified"!==e&&"id"!==e&&(i=!0),n[e]=a[e])}),Object.keys(r).forEach(function(e){"items"!==e&&e in a&&void 0!==r[e]&&void 0===a[e]&&(n[e]=void 0,i=!0)}),i&&r.isDeleted&&!n.isDeleted&&(n.text||n.flags||n)&&(n.isDeleted=!1,C.a.saveItem({id:t,isDeleted:!1}))):(i=!0,n=a),i&&fe.a.onRemoteChange(e,r,t,n)}},{key:"getEncryptionForDocument",value:function(e){return e.encryptionSentinel?I.default.crypto.getKeyBySentinel(e.encryptionSentinel):e.acl&&Object.keys(e.acl).length>1?I.default.crypto.getGlobalKey():I.default.crypto.getKey(I.default.settings.getBestUserEncryption())}},{key:"_getItemWithText",value:function(e){return{id:e.id,text:e.getRawText()}}},{key:"checkUserEncryption",value:function(e,t){var a=this;if(e){var i=function(){a.loadState.set(w.a.LoadState.NeedPassword),a._pauseProcessingItemsChanged=!0,I.default.menus.openModal(w.a.Modals.EnterCode,{noCancel:!0,isPassword:!0,text:"Please enter your encryption password to unlock your data.",onSelect:function(i){return new Promise(function(n,r){i&&I.default.crypto.setKey({name:w.a.EncryptionKeys.UserPassword,password:i,sentinelSalt:pe.a.getEncryptionUid()}).then(function(i){e===i.sentinel?(I.default.settings.addEncryptionKey(w.a.EncryptionKeys.UserPassword,i.key),t&&t(),n(),a._pauseProcessingItemsChanged=!1,a._processItemsChange()):(I.default.crypto.removeKey(w.a.EncryptionKeys.UserPassword),r("The password was invalid. Please try again."))}).catch(function(e){return P.default.reportError(e)})})}})},n=I.default.settings.getEncryptionKey(w.a.EncryptionKeys.UserPassword);n?I.default.crypto.decryptText(n,e,pe.a.getEncryptionUid()).then(function(e){e===w.a.EncryptionSentinel?t&&t():i()}):i()}else t&&t()}},{key:"_encryptDocumentItems",value:function(e,t,a){var i=this.getAPIForDocumentItems(t);return Promise.all(t.getAllItems().map(function(t){var n={id:t.id,text:t.getRawText()};return new Promise(function(t){D.a.encryptItemOut(n,I.default.crypto,a.key).then(function(a){if(D.a.validateOutFields(a,!0)){var n=i.getPathForItem(a,e);e[n+"t"]=a.t,t()}})})}))}},{key:"updateDocumentEncryption",value:function(e,t){var a,i=this,n={};return t&&t!==I.default.crypto.getKeyInfo(w.a.EncryptionKeys.Global)?(a=Object.assign({},I.default.settings.encryptionKeys.get()))[e.id]=t.key:t=I.default.crypto.getKeyInfo(w.a.EncryptionKeys.Global),n["documents/".concat(e.id,"/p/s")]=t.sentinel,n["userdocuments/".concat(pe.a.getUid(),"/").concat(e.id,"/s")]=t.sentinel,this._encryptDocumentItems(n,e,t).then(function(){return i.api.commitBatch(n).then(function(){a&&(e.encryptionSentinel.set(t.sentinel),I.default.settings.encryptionKeys.set(P.default.clone(a)))}).catch(function(e){return P.default.reportError(e)})}).catch(function(e){return P.default.reportError(e)})}},{key:"updateUserEncryption",value:function(e){var t=this;if(this.api){var a,i={},n=Object.assign({},I.default.settings.encryptionKeys.get());e!==I.default.crypto.getGlobalKeyInfo()?(a=e.sentinel,n[e.name]=e.key):(a=null,delete n[w.a.EncryptionKeys.UserPassword]);var r=I.default.settings.getSettingAbbrev("userEncryptionSentinel");return i[this.api.user.getPathForSettings()+r]={v:a},Promise.all(Object.keys(this.documents).filter(function(e){return!t.documents[e].encryptionSentinel.get()&&!t.documents[e].isShared()}).map(function(a){return t._encryptDocumentItems(i,t.documents[a],e)})).then(function(){return t.api.commitBatch(i).then(function(){I.default.settings.encryptionKeys.set(n),null===a&&I.default.crypto.removeKey(w.a.EncryptionKeys.UserPassword)})}).catch(function(e){return P.default.reportError(e)})}}},{key:"_checkItemsPendingTimeout",value:function(){var e=this,t={};Object.keys(this.itemsPending).forEach(function(e){var a=C.a.getItemData(e).docId;a&&(t[a]=!0)}),Object.keys(this.documents).forEach(function(a){e.documents[a].isSyncing.set(!!t[a])})}},{key:"checkItemsPending",value:function(){P.default.timeoutOnce("checkItemsPending",this._checkItemsPendingTimeout,100)}},{key:"decryptItemIn",value:function(e,t,a){return D.a.decryptItemIn(e,t,a)}},{key:"_updateDocModified",value:function(e,t){e.updateModified(t)&&C.a.saveDocument(e)}}]),t}(he.a),S()(r.prototype,"onLoadLocal",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"onLoadLocal"),r.prototype),S()(r.prototype,"onLoadRemoteDocuments",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"onLoadRemoteDocuments"),r.prototype),S()(r.prototype,"_runCoalescedChanges",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"_runCoalescedChanges"),r.prototype),S()(r.prototype,"clearAllData",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"clearAllData"),r.prototype),S()(r.prototype,"_checkItemsPendingTimeout",[b.a],Object.getOwnPropertyDescriptor(r.prototype,"_checkItemsPendingTimeout"),r.prototype),r);t.a=new Pe},659:function(e,t,a){var i={"./af":348,"./af.js":348,"./ar":349,"./ar-dz":350,"./ar-dz.js":350,"./ar-kw":351,"./ar-kw.js":351,"./ar-ly":352,"./ar-ly.js":352,"./ar-ma":353,"./ar-ma.js":353,"./ar-sa":354,"./ar-sa.js":354,"./ar-tn":355,"./ar-tn.js":355,"./ar.js":349,"./az":356,"./az.js":356,"./be":357,"./be.js":357,"./bg":358,"./bg.js":358,"./bm":359,"./bm.js":359,"./bn":360,"./bn.js":360,"./bo":361,"./bo.js":361,"./br":362,"./br.js":362,"./bs":363,"./bs.js":363,"./ca":364,"./ca.js":364,"./cs":365,"./cs.js":365,"./cv":366,"./cv.js":366,"./cy":367,"./cy.js":367,"./da":368,"./da.js":368,"./de":369,"./de-at":370,"./de-at.js":370,"./de-ch":371,"./de-ch.js":371,"./de.js":369,"./dv":372,"./dv.js":372,"./el":373,"./el.js":373,"./en-au":374,"./en-au.js":374,"./en-ca":375,"./en-ca.js":375,"./en-gb":376,"./en-gb.js":376,"./en-ie":377,"./en-ie.js":377,"./en-il":378,"./en-il.js":378,"./en-nz":379,"./en-nz.js":379,"./eo":380,"./eo.js":380,"./es":381,"./es-do":382,"./es-do.js":382,"./es-us":383,"./es-us.js":383,"./es.js":381,"./et":384,"./et.js":384,"./eu":385,"./eu.js":385,"./fa":386,"./fa.js":386,"./fi":387,"./fi.js":387,"./fo":388,"./fo.js":388,"./fr":183,"./fr-ca":389,"./fr-ca.js":389,"./fr-ch":390,"./fr-ch.js":390,"./fr.js":183,"./fy":391,"./fy.js":391,"./gd":392,"./gd.js":392,"./gl":393,"./gl.js":393,"./gom-latn":394,"./gom-latn.js":394,"./gu":395,"./gu.js":395,"./he":396,"./he.js":396,"./hi":397,"./hi.js":397,"./hr":398,"./hr.js":398,"./hu":399,"./hu.js":399,"./hy-am":400,"./hy-am.js":400,"./id":401,"./id.js":401,"./is":402,"./is.js":402,"./it":403,"./it.js":403,"./ja":404,"./ja.js":404,"./jv":405,"./jv.js":405,"./ka":406,"./ka.js":406,"./kk":407,"./kk.js":407,"./km":408,"./km.js":408,"./kn":409,"./kn.js":409,"./ko":410,"./ko.js":410,"./ky":411,"./ky.js":411,"./lb":412,"./lb.js":412,"./lo":413,"./lo.js":413,"./lt":414,"./lt.js":414,"./lv":415,"./lv.js":415,"./me":416,"./me.js":416,"./mi":417,"./mi.js":417,"./mk":418,"./mk.js":418,"./ml":419,"./ml.js":419,"./mr":420,"./mr.js":420,"./ms":421,"./ms-my":422,"./ms-my.js":422,"./ms.js":421,"./mt":423,"./mt.js":423,"./my":424,"./my.js":424,"./nb":425,"./nb.js":425,"./ne":426,"./ne.js":426,"./nl":427,"./nl-be":428,"./nl-be.js":428,"./nl.js":427,"./nn":429,"./nn.js":429,"./pa-in":430,"./pa-in.js":430,"./pl":431,"./pl.js":431,"./pt":432,"./pt-br":433,"./pt-br.js":433,"./pt.js":432,"./ro":434,"./ro.js":434,"./ru":435,"./ru.js":435,"./sd":436,"./sd.js":436,"./se":437,"./se.js":437,"./si":438,"./si.js":438,"./sk":439,"./sk.js":439,"./sl":440,"./sl.js":440,"./sq":441,"./sq.js":441,"./sr":442,"./sr-cyrl":443,"./sr-cyrl.js":443,"./sr.js":442,"./ss":444,"./ss.js":444,"./sv":445,"./sv.js":445,"./sw":446,"./sw.js":446,"./ta":447,"./ta.js":447,"./te":448,"./te.js":448,"./tet":449,"./tet.js":449,"./tg":450,"./tg.js":450,"./th":451,"./th.js":451,"./tl-ph":452,"./tl-ph.js":452,"./tlh":453,"./tlh.js":453,"./tr":454,"./tr.js":454,"./tzl":455,"./tzl.js":455,"./tzm":456,"./tzm-latn":457,"./tzm-latn.js":457,"./tzm.js":456,"./ug-cn":458,"./ug-cn.js":458,"./uk":459,"./uk.js":459,"./ur":460,"./ur.js":460,"./uz":461,"./uz-latn":462,"./uz-latn.js":462,"./uz.js":461,"./vi":463,"./vi.js":463,"./x-pseudo":464,"./x-pseudo.js":464,"./yo":465,"./yo.js":465,"./zh-cn":466,"./zh-cn.js":466,"./zh-hk":467,"./zh-hk.js":467,"./zh-tw":468,"./zh-tw.js":468};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=659},66:function(e,t,a){"use strict";var i,n=a(12),r=a.n(n),s=a(22),o=a.n(s),l=a(35),u=a.n(l),d=a(5),c=a.n(d),h=a(6),f=a.n(h),p=a(13),g=a.n(p),m=a(37),v=a(50),y=a(0),k=a(1),_=a(3),S=a(15),P=a(162),w=a(123),I=a(28),b=a(65),D=a(14),E=a(17),C=a(67),A=(i=function(){function e(t){var a=t.id,i=t.text,n=t.dateModified,r=t.rootData,s=t.acl,o=t.backing,l=t.encryptionSentinel,u=t.backups;c()(this,e);try{y.default.PAssert(151,a,"Document must have id")}catch(d){y.default.reportError(d)}try{y.default.PAssert(152,s,"Document must have acl")}catch(d){y.default.reportError(d)}try{y.default.PAssert(153,r&&r.isRoot,"Document must have root item set to root")}catch(d){y.default.reportError(d)}r&&!r.isRoot&&(r.isRoot=!0),this.id=a,this.text=new S.a(i),this.contentPreview=new S.a(""),this._root=r,this._backing=o,this._isLocalOnly=o.isLocalOnly,this.isSyncing=new S.a(!1),this.acl=new S.a(s),this.dateModified=new S.a(n),this.encryptionSentinel=new S.a(l),this.isDecrypted=this.canDecrypt(),this.backups=new S.a(u),r.archivedItems&&(this._archivedItemsData=r.archivedItems,delete r.archivedItems),r.deletedItems&&(this._deletedItemsData=r.deletedItems,delete r.deletedItems)}return f()(e,[{key:"createVMLIs",value:function(e){if(!this._rootItem||e){var t=_.default.itemStoreManager.getDefaultItemStore();e?e.items&&(_.default.PaneUpdateBatcher.beginUpdateItems(),this._rootItem.setItems(e.items),_.default.PaneUpdateBatcher.commitUpdateItems()):(this._rootItem=t.createItemRaw(this._root,{documentOwner:this,changeType:k.a.ChangeType.Auto,isRoot:!0}),t.addItemToRoot(this._rootItem)),this._rootItem.items.listen(this.updatePreviewTextListener),this.updatePreviewTextListener()}}},{key:"_ensureRootItem",value:function(e,t){e||(this["_root".concat(t,"Item")]=_.default.itemStoreManager.getDefaultItemStore().createItemRaw({id:void 0,text:"".concat(t," Root")},{documentOwner:this,changeType:k.a.ChangeType.Auto,isRoot:!0}))}},{key:"ensureRootArchivedItem",value:function(){this._ensureRootItem(this._rootArchivedItem,"Archived")}},{key:"ensureRootDeletedItem",value:function(){this._ensureRootItem(this._rootDeletedItem,"Deleted")}},{key:"_ensureHelper",value:function(e,t,a,i){if(e(),this[t]){var n=this[t];delete this[t];var r=this[a];v.a.beginBatch(r),n.forEach(i),v.a.commitBatch(r)}}},{key:"ensureArchivedItems",value:function(){this._ensureHelper(this.ensureRootArchivedItem,"_archivedItemsData","_rootArchivedItem",this.createArchivedVMLI)}},{key:"ensureDeletedItems",value:function(){this._ensureHelper(this.ensureRootDeletedItem,"_deletedItemsData","_rootDeletedItem",this.createDeletedVMLI)}},{key:"_createVMLI",value:function(e,t,a){!t.isNote&&(t.text||("Deleted"===a?t.deletedItems:t.archivedItems))&&e.items.push(_.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:e,documentOwner:this,changeType:k.a.ChangeType.Auto}))}},{key:"createArchivedVMLI",value:function(e){this._createVMLI(this._rootArchivedItem,e,"Archived")}},{key:"createDeletedVMLI",value:function(e){this._createVMLI(this._rootDeletedItem,e,"Deleted")}},{key:"_archiveDeleteHelper",value:function(e,t,a,i,n,r,s){var o=e.parent();s||o[a]()||(o.items.remove(e),i(),this[n].items.push(e));r(e,!0,t)}},{key:"archiveItem",value:function(e,t,a){this._archiveDeleteHelper(e,t,"isArchived",this.ensureRootArchivedItem,"_rootArchivedItem",this.propagateArchive,a)}},{key:"_unActionHelper",value:function(e,t,a,i,n){var r=e.parent(),s=r&&!r[a]()&&r!==i?r:this._rootItem;r&&r!==s&&r.items.indexOf(e)>=0&&r.items.remove(e),i.items.remove(e),e.setParent(s),s.items.includes(e)||e.isNote()||s.items.insertSorted(e,m.a.compareItemIndex),n(e,!1,t)}},{key:"_propagateHelper",value:function(e,t,a,i,n,r){var s=this;e[i](t,a);var o=u()({id:e.id},n,t);E.a.saveItem(e,o,a,k.a.SaveFlag.All),r&&e.items.get()&&e.items.get().forEach(function(e){return s._propagateHelper(e,t,a,i,n,r)})}},{key:"unArchiveItem",value:function(e,t){this._unActionHelper(e,t,"isArchived",this._rootArchivedItem,this.propagateArchive)}},{key:"propagateArchive",value:function(e,t,a){this._propagateHelper(e,t,a,"setArchived","isArchived",!0)}},{key:"deleteItem",value:function(e,t,a){this._archiveDeleteHelper(e,t,"isDeleted",this.ensureRootDeletedItem,"_rootDeletedItem",this.propagateDelete,a)}},{key:"unDeleteItem",value:function(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateDelete)}},{key:"propagateDelete",value:function(e,t,a){this._propagateHelper(e,t,a,"setDeleted","isDeleted",!t)}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this.ensureArchivedItems(),this._rootArchivedItem}},{key:"getRootDeletedItem",value:function(){return this.ensureDeletedItems(),this._rootDeletedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(e,t){var a={id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get()||Date.now()};return e||(a.acl=this.acl.get()),t||(a.encryptionSentinel=this.encryptionSentinel.get()),a}},{key:"setText",value:function(e,t){var a=this.text.get();this.text.set(e,t),this._isLocalOnly&&this.getBacking().renameDocument(this,a)}},{key:"onRemoteUpdate",value:function(e){e.date,void 0!==e.backups&&this.backups.set(e.backups),void 0!==e.text&&this.setText(e.text),void 0!==e.acl&&this.onAclUpdate(e.acl),void 0!==e.encryptionSentinel&&this.encryptionSentinel.set(e.encryptionSentinel)}},{key:"getBestEncryptionInfo",value:function(){var e=_.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?e.sentinel===this.encryptionSentinel.get()?e:_.default.crypto.getKeyInfo(this.id):this.isShared()?e:_.default.crypto.getKeyInfo(_.default.settings.getBestUserEncryption())}},{key:"getBestEncryption",value:function(){return this.getBestEncryptionInfo().key}},{key:"toJSON",value:function(){var e=o()(r.a.mark(function e(t){var a,i,n,s;return r.a.wrap(function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return a=this.getRootItem(),i=this.getBestEncryptionInfo(),t.encryptionKey=i.key,e.next=5,P.a.getItemsData(a,t);case 5:return n=e.sent,s={moodoVer:_.default.settings.localDataVersion.get(),doc:this.getSaveInfo(!0,!t.encrypt),items:n},t.encrypt&&(s.sentinel=i.sentinel),e.abrupt("return",JSON.stringify(s,null,2));case 9:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(e){var t=this,a=function(){var a=t.getCollaborators();!e&&a&&a.length>0?t.shareWithUser(t.getCollaborators().map(function(e){return e.email}),null).then(function(){E.a.deleteDocument(t,e)}):E.a.deleteDocument(t,e);var i=_.default.itemStoreManager.getDefaultItemStore();i.removeItemFromRoot(t._rootItem),t.getAllItems().forEach(function(e){return i.removeItemFromStore(e.id)}),_.default.PaneManager.runForEachPane(function(e){e.document.get()===t&&e.setDocument(E.a.getDefaultDocument())})};!e&&!this._isLocalOnly&&this.getAllItems().length>1?w.a.backupDocumentAll(this).then(function(){a()}):a()}},{key:"getAllItems",value:function(){var e=[],t=this._rootItem;return this._getAllItems(e,t),e}},{key:"_getAllItems",value:function(e,t){var a=0;e.push(t),t.hasNote()&&e.push(t.getNote());for(var i=t.items.get(),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getAllItems(e,i[n])}}},{key:"updateModified",value:function(e){var t=e>this.dateModified.get();if(t){this.dateModified.set(e);var a=_.default.settings.lastSync;(!a.get()||e>a.get())&&a.set(e)}return t}},{key:"updatePreviewTextListener",value:function(){var e=this._rootItem.getFirstChild();e!==this._firstChild&&(this._firstChild&&this._firstChild.itemChanged.unlisten(this.onFirstItemChanged),this._firstChild=e,e&&(this._firstChild.itemChanged.listen(this.onFirstItemChanged),this.onFirstItemChanged()))}},{key:"onFirstItemChanged",value:function(){var e=this._firstChild.getParsedText();e!==this.contentPreview.get()&&this.contentPreview.set(e)}},{key:"isShared",value:function(){return Object.keys(this.acl.get()).length>1}},{key:"isAdmin",value:function(){if(this._isLocalOnly)return!0;var e=this.acl.get()[I.a.getUid()];return e&&e.r===k.a.DocumentAccessRoles.Admin}},{key:"getCollaborators",value:function(){var e=this.acl.get();return Object.keys(e).filter(function(e){return e!==I.a.getEncryptionUid()}).map(function(t){return{uid:t,name:e[t].t,email:e[t].e,role:e[t].r}})}},{key:"shareWithUser",value:function(e,t){return C.a.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:e,accessRole:t})}},{key:"onAclUpdate",value:function(e){var t=y.default.clone(this.acl.get());Object.keys(e).forEach(function(a){e[a]?t[a]=e[a]:delete t[a]}),this.acl.set(t)}},{key:"canDecrypt",value:function(){var e=this.encryptionSentinel.get();return this.isDecrypted=!e||_.default.crypto.canDecryptSentinel(e),this.isDecrypted}},{key:"addBackup",value:function(e){this.backups.get()?this.backups.get()[e]="":this.backups.set(u()({},e,""))}},{key:"getLastBackup",value:function(){var e=this.backups.get();if(e){var t=Object.keys(e).sort();return+t[t.length-1]}return 0}},{key:"getLastBackupDrive",value:function(){var e=_.default.settings.backupsDrive.get();return e&&e[this.id]||0}},{key:"isLocalOnly",value:function(){return this._isLocalOnly}},{key:"parseAll",value:function(e){y.default.parseSubtree(this.getRootItem(),e)}}],[{key:"create",value:function(t){var a=t.id,i=t.text,n=t.rootData,r=t.backing;return new e({id:a||E.a.generateID(),rootData:n,text:i,acl:u()({},I.a.getUid(),{r:k.a.DocumentAccessRoles.Admin,e:I.a.getDefaultAccountID(),t:I.a.getAccountName()}),dateModified:Date.now(),backing:r||b.a,encryptionSentinel:void 0})}},{key:"fromData",value:function(t,a){var i={};return Object.keys(t.acl).forEach(function(e){var a=t.acl[e];i[e]=y.default.isNumber(a)?{r:a,t:I.a.getAccountName(),e:I.a.getDefaultAccountID()}:a}),new e({id:t.id,rootData:t.rootData,text:t.text,acl:i,dateModified:t.dateModified,backing:a,encryptionSentinel:t.encryptionSentinel})}},{key:"comparatorModified",value:function(e,t){return t.dateModified.get()-e.dateModified.get()}},{key:"comparatorAlpha",value:function(e,t){return e.text.get().localeCompare(t.text.get())}},{key:"getCompareFn",value:function(e){return e===k.a.DocumentSortMode.Alphabetical&&this.comparatorAlpha||e===k.a.DocumentSortMode.Modified&&this.comparatorModified}}]),e}(),g()(i.prototype,"ensureRootArchivedItem",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"ensureRootArchivedItem"),i.prototype),g()(i.prototype,"ensureRootDeletedItem",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"ensureRootDeletedItem"),i.prototype),g()(i.prototype,"createArchivedVMLI",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"createArchivedVMLI"),i.prototype),g()(i.prototype,"createDeletedVMLI",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"createDeletedVMLI"),i.prototype),g()(i.prototype,"propagateArchive",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"propagateArchive"),i.prototype),g()(i.prototype,"propagateDelete",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"propagateDelete"),i.prototype),g()(i.prototype,"updatePreviewTextListener",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"updatePreviewTextListener"),i.prototype),g()(i.prototype,"onFirstItemChanged",[D.a],Object.getOwnPropertyDescriptor(i.prototype,"onFirstItemChanged"),i.prototype),i);t.a=A},67:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(0),h=a(1),f=a(28),p=(a(23),function(){function e(){l()(this,e),this.url=h.a.CloudFunctionsURL}return d()(e,[{key:"run",value:function(){var e=s()(n.a.mark(function e(t){var a,i,r,s,o,l,u,d,c=arguments;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return a=c.length>1&&void 0!==c[1]?c[1]:{},i=a.query,r=a.body,e.next=3,this.createURL(t,i);case 3:if(!(s=e.sent)){e.next=22;break}return o=r?{method:"POST",body:JSON.stringify(r)}:void 0,e.next=8,fetch(s,o);case 8:if(200!==(l=e.sent).status){e.next=16;break}return e.next=12,l.json();case 12:return u=e.sent,e.abrupt("return",{value:u,errorCode:void 0,error:void 0});case 16:return e.next=18,l.json();case 18:return d=e.sent,e.abrupt("return",{value:void 0,errorCode:d.errorCode||d.status,error:d.message,braintreeErrorCode:d.braintreeErrorCode});case 20:e.next=23;break;case 22:return e.abrupt("return",{value:void 0,errorCode:h.a.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"});case 23:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createURL",value:function(){var e=s()(n.a.mark(function e(t){var a,i,r,s,o,l,u=arguments;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return a=u.length>1&&void 0!==u[1]?u[1]:{},e.next=3,f.a.getUser();case 3:return i=e.sent,e.next=6,i.getIdToken();case 6:r=e.sent;try{c.default.PAssert(292,r,"User does not have a valid id_token")}catch(d){c.default.reportError(d)}if(!r){e.next=14;break}for(l in a.id_token=r,s=this.url+t+"?",o=[],a)a.hasOwnProperty(l)&&a[l]&&o.push(l+"="+encodeURIComponent(a[l]));return e.abrupt("return",s+o.join("&"));case 14:return e.abrupt("return",void 0);case 15:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(e){return this.run("auth/getAccessToken",{query:{email:e}})}},{key:"sendFeedback",value:function(e){return this.run("user/sendFeedback",{body:e})}},{key:"setUserProperties",value:function(e){return this.run("user/setUserProperties",{body:e})}},{key:"shareDocument",value:function(e){return this.run("sharing/shareDocument",{body:e})}},{key:"listTransactions",value:function(){return this.run("billing/listTransactions")}},{key:"getBillingToken",value:function(){return this.run("billing/getBillingToken")}},{key:"purchasePlan",value:function(e){return this.run("billing/purchasePlan",{body:e})}},{key:"updatePlan",value:function(e){return this.run("billing/updatePlan",{body:e})}},{key:"startTrial",value:function(){return this.run("billing/startTrial")}},{key:"cancelPremium",value:function(){return this.run("billing/cancelPremium")}},{key:"updatePremiumStatus",value:function(){return this.run("billing/updatePremiumStatus")}},{key:"deleteAccount",value:function(){return this.run("user/deleteAccount")}},{key:"acceptInvite",value:function(e){return this.run("sharing/acceptInvite",{body:{token:e}})}},{key:"todoistImport",value:function(e){return this.run("oauth/todoist",{body:{code:e}})}}]),e}());t.a=new p},7:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(62),h=a.n(c),f=a(11),p=a.n(f),g=a(0),m=a(23),v=a(49),y=a(1),k=a(15),_=function(e){function t(){var e;return n()(this,t),e=l()(this,d()(t).call(this)),m.a.binder(h()(e),"normalizeKeys","getKeyCode"),e.blockedReason=new k.a,e.versionRequired=[],e.versionAvailable=[],e.versionRequired[y.a.AppPlatform.Electron]=1,e.versionAvailable[y.a.AppPlatform.Electron]=3,e.versionDesktop=16,e.versionDesktopMessages={15:"The latest version of Moo.do changes how item order is stored. Newly added items may be out of order on old versions, so please restart Moo.do on all of your devices.",16:"Plugin caching has been upgraded in the latest update so Moo.do is syncing emails and calendars again"},e.appSubVersion=void 0,e.setDeployEnvironments(),e.appPlatform=void 0,e.requireCustomRedirect=!1,e.requireCustomPurchase=!1,e.requireCustomPaypal=!1,e.bodyClass=void 0,e.b=document.documentElement,e.orientation=y.a.Orientation.Portrait,e.onResize=new v.a,e.appState=void 0,e.isHosted=!1,e.hostedBy=void 0,e.initStorageQuota={quota:NaN,usage:NaN},e.isNearStorageQuota=!1,e.pageVisibilityHidden=void 0,e.pageVisibilityChange=void 0,e._allowNativeNotifications=!0,e.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,e.isBeta="beta.moo.do"===window.location.hostname,e._features={},e.init(),e._windowWidth=new k.a(e.getActualWindowWidth()),e._windowHeight=new k.a(e.getActualWindowHeight()),e.app&&(e.customRedirectState={app:!0,appv:e.appv,webview:e.getAppState("webview")}),e}return p()(t,e),s()(t,[{key:"getDeployVar",value:function(e){return this.deployEnvironment[e]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[y.a.DeployVariable.Environment]="dev",this.deployEnvironment[y.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[y.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[y.a.DeployVariable.Environment]="beta",this.deployEnvironment[y.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[y.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[y.a.DeployVariable.Environment]="local",this.deployEnvironment[y.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[y.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[y.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[y.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[y.a.DeployVariable.APIHost]="//api-old.moo.do")}},{key:"windowWidth",value:function(){if(!this._windowWidth.get()){try{g.default.PAssert(3,!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){g.default.reportError(e)}this._windowWidth.set(this.getActualWindowWidth())}return this._windowWidth.get()}},{key:"windowHeight",value:function(){if(!this._windowHeight.get()){try{g.default.PAssert(4,!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get())}catch(e){g.default.reportError(e)}this._windowHeight.set(this.getActualWindowHeight())}return this._windowHeight.get()}},{key:"getLocaleInfo",value:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.requireCustomPurchase=this.requireCustomPurchase,e.requireCustomPaypal=this.requireCustomPaypal,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}},{key:"getUserPlatformConfig",value:function(){return(this.platformBrowser&&this.platformOS?this.platformOS+""+this.platformBrowser:navigator.userAgent)+(this.isBeta?"b":"")}},{key:"getAppDownloadURL",value:function(){return window.location.origin+"/download/"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!0;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===y.a.AppPlatform.Electron}},{key:"supportLocalFiles",value:function(){return this.isNativeApp()&&this.appv>=3}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"isNativeMacFullscreen",value:function(){return this.isNativeApp()&&this.mac&&!window.screenTop&&!window.screenY}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var e=this;this.initAppState(),this.initHostState(),this.initFeatures();var t,i,n=navigator.userAgent,r="";(this.OSName="Unknown OS",this.app&&(r+=" app"),-1!==n.indexOf("Win")?(this.platformOS=y.a.PlatformOS.Windows,this.OSName="Windows",this.windows=!0):-1!==n.indexOf("Mac")?(this.platformOS=y.a.PlatformOS.Mac,this.OSName="MacOS",this.mac=!0):-1!==n.indexOf("X11")?-1!==n.indexOf("CrOS")?(this.platformOS=y.a.PlatformOS.ChromeOS,this.OSName="ChromeOS",this.chromeOS=!0):(this.platformOS=y.a.PlatformOS.Linux,this.OSName="UNIX",this.unix=!0):-1!==n.indexOf("Linux")&&(this.platformOS=y.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0),this.majorVersion=1e3,this.minorVersion=1e3,-1!==n.indexOf("MSIE")||-1!==n.indexOf("Trident"))?(this.platformBrowser=y.a.PlatformBrowser.IE,this.browser="Trident",this.ie=!0,null!==("Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(n)?this.majorVersion=parseFloat(RegExp.$1):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(n)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==n.indexOf("Chrome")||-1!==n.indexOf("CriOS")?(this.platformBrowser=y.a.PlatformBrowser.Chrome,this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(n)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==n.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=y.a.PlatformBrowser.Edge),this.app&&this.appPlatform!==y.a.AppPlatform.Android&&(this.requireCustomPaypal=!0)):-1!==n.indexOf("Firefox")?(this.platformBrowser=y.a.PlatformBrowser.Firefox,this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(n)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==n.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.platformBrowser=y.a.PlatformBrowser.Safari,this.browser="Safari",this.safari=!0,null!==new RegExp("Version/([0-9]{1,}).([0-9]{1,}).").exec(n)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==n.indexOf("Opera")?(this.platformBrowser=y.a.PlatformBrowser.Opera,this.browser="Opera"):-1!==n.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=y.a.PlatformBrowser.Edge);if(n.indexOf("Electron")>=0&&n.indexOf(y.a.ProductName)>=0){if(this.platformBrowser=y.a.PlatformBrowser.Electron,this.app=!0,this.appPlatform=y.a.AppPlatform.Electron,r+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var s,o=function(e,t){for(var a=0,i=e.split("."),n=t.split("."),r=0;r<3;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=+i[r],o=+n[r];if(s>o)return 1;if(o>s)return-1;if(!isNaN(s)&&isNaN(o))return 1;if(isNaN(s)&&!isNaN(o))return-1}return 0},l=RegExp.$1;o(l,"1.1.4")<=0&&setTimeout(function(){Promise.resolve().then(a.bind(null,3)).then(function(t){t.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){g.default.openUrl(e.getAppDownloadURL())}})})},2e3),s=o(l,"1.2.1")>=0?3:o(l,"1.1.0")>=0?2:1,this.appv=s}this.mac&&(r+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this.requireCustomPurchase=!0,this._enableFeature(y.a.Feature.OAuth)}if(this.isTouchDevice=!!("ontouchstart"in window||navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),m.a.hasURLParam("touch","false")?this.touch=!1:m.a.hasURLParam("touch","true")&&(this.touch=!0),this.windows&&(r+=" windows",this.ie&&(r+=" ie")),"Firefox"===this.browser&&(r+=" firefox"),this.safari&&(r+=" safari"),this.embed===y.a.EmbedApps.Mailbird&&(this.platformBrowser=y.a.PlatformBrowser.Mailbird,r+=" mailbird",this.isMailbirdSidebar()&&(r+=" mailbirdSidebar")),this.demo&&(r+=" demoMode"),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app)&&(this.requireCustomRedirect=!0),r&&r.length>0&&(this.bodyClass=r,this.b.className+=r),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(t="hidden",i="visibilitychange"):["moz","ms","webkit"].forEach(function(e){if("undefined"!==document[e+"Hidden"])return t=e+"Hidden",i=e+"visibilitychange",!1}),void 0!==t&&(this.pageVisibilityHidden=t,this.pageVisibilityChange=i),this.initRedirectString(),this.supportsEstimatedStorage()){this.estimateAvailableStorage(function(e){this.initStorageQuota=e,e.usage/e.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var e=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==y.a.AppPlatform.Electron&&this.isChrome?e=!0:this.embed===y.a.EmbedApps.Mailbird&&(e=!0)),e}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}},{key:"requestStoragePersistence",value:function(e,t){navigator.storage.persisted().then(function(a){a?e():navigator.storage.persist().then(e,t)})}},{key:"isStoragePersisted",value:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var e=!1;return"storage"in navigator&&"estimate"in navigator.storage?e=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(e=!0),e&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,a){e({usage:t,quota:a})},t)}):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var e=!1;return window.Worker&&(e=!0),e}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(a){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(e,t,a){this.supportsPassiveListeners()?e.addEventListener(t,a,{passive:!0}):e.addEventListener(t,a)}},{key:"isMobro",value:function(){var e,t=null;try{new ActiveXObject("")}catch(a){e=a.name}try{t=!!new ActiveXObject("htmlfile")}catch(a){t=!1}return!(t="ReferenceError"===e||!1!==t)}},{key:"normalizeKeys",value:function(e){void 0!==e.normCode&&(e.synthetic||e instanceof KeyboardEvent)||(e.normCode=this.getKeyCode(e))}},{key:"getKeyCode",value:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}},{key:"initAppState",value:function(){var e=location.hash.substring(1);if(e)for(var t,a=0,i=/([^&=]+)=([^&]*)/g;null!==(t=i.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("state"===decodeURIComponent(t[1])){var n=decodeURIComponent(t[2]);if(n){var r=function(t){try{e=JSON.parse(t)}catch(a){}};r(n),e||r(n.replace(/\\"/g,'"')),e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||m.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||m.a.hasURLParam("offline","true")||!1,this.demo=m.a.hasURLParam("demo","true")||!1,this.script=m.a.hasURLParam("script"),this.app=this.app||!1}},{key:"getAppState",value:function(e){return this.appState?this.appState[e]:void 0}},{key:"_enableFeature",value:function(e){this._features[e]=!0}},{key:"_disableFeature",value:function(e){this._features[e]=!1}},{key:"initFeatures",value:function(){this._enableFeature(y.a.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===y.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"initRedirectString",value:function(){var e,t;e=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone?window.location.host:"www.moo.do",t=this.app&&this.appPlatform===y.a.AppPlatform.Electron?"oauthRelay.html":"app/",this.customRedirectString=window.location.protocol+"//"+e+"/"+t}},{key:"addPrefix",value:function(e,t){var a="",i=["ms","webkit","moz","o"],n=this.b.style;if(t||(t=e),"string"===typeof n[e])a="";else for(var r=0,s=0;s<i.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("string"===typeof n["-"+i[s]+"-"+t]){a=i[s];break}}var o=a.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(a){var l=a.length>0?a.charAt(0).toUpperCase()+a.slice(1):e;return{prop:"-"+a+"-"+t,style:a+o,react:l+o}}return{prop:e,style:o,react:o}}},{key:"blockClient",value:function(){if(this.isMobile&&!this.app)return{needsApp:!0};switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){a(0).default.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return a(0).default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return a(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?y.a.Orientation.Landscape:y.a.Orientation.Portrait,this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(e){for(var t=0,a=[],i=(e||0)+1;i<=this.versionDesktop;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.versionDesktopMessages[i];n&&a.push(n)}return a}},{key:"isFeatureEnabled",value:function(e){return this._features[e]}},{key:"recordAppSubVersion",value:function(e){this.appSubVersion=e}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac?"icon-apple":this.windows?"icon-windows":"icon-chrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}}]),t}(function(){function e(){n()(this,e),this.onResize=new v.a,this.onForeground=new v.a}return s()(e,[{key:"setWindowSize",value:function(e,t){this._windowWidth.set(e),this._windowHeight.set(t)}}]),e}());t.a=new _},716:function(e,t,a){"use strict";a.r(t);var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(0),l=a(24),u=a(29),d=function(){},c=function(){return{}},h=function(){return{then:d,execute:d}};function f(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}f.prototype={setGapiData:function(e,t){try{o.default.PAssert(322,o.default.isObject(t)&&!o.default.isArray(t),"Setting malformed data",e)}catch(i){o.default.reportError(i)}for(var a in this.loadedGapiData[e]=[],t)t[a].id=a,this.loadedGapiData[e].push(t[a])},setGapiDataDirect:function(e,t){try{o.default.PAssert(323,o.default.isArray(t),"Setting malformed data",e)}catch(a){o.default.reportError(a)}this.loadedGapiData[e]||(this.loadedGapiData[e]=t)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(e,t){var a=this;try{o.default.PAssert(324,e&&t,"Must supply valid remote load info as well as a cb when data is loaded")}catch(u){o.default.reportError(u)}var i=e.split(":");if(this.cache[i[0]])t(JSON.parse(JSON.stringify(this.cache[i[0]][i[1]])));else{var r=!i[0].endsWith(".txt"),l=r?i[0]+".json":i[0];o.default.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+l}).then(function(){var e=s()(n.a.mark(function e(s){var l,u,d,c;return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(200!==s.status){e.next=17;break}if(!r){e.next=11;break}return e.next=4,s.json();case 4:l=e.sent,a.cache[i[0]]=l,i[1]||(i[1]="0"),(u=l[i[1]])?(d=JSON.parse(JSON.stringify(u)),t(d)):o.default.log("Invalid data slot"),e.next=15;break;case 11:c=s.responseText.split("\n"),c="tags"===i[1]?c.map(function(e){if(e.length>0){for(var t=0,a=0,i=e.split(" "),n=0;n<i.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;Math.random()<.8&&(i[n]="#"+i[n])}e=i.join(" ")}return{text:e}}):c.map(function(e){return{text:e}}),t([{text:"Outline",items:c}]);case 15:e.next=18;break;case 17:o.default.log("Error getting demo data",s.status,s.responseText);case 18:case"end":return e.stop()}}},e)}));return function(t){return e.apply(this,arguments)}}())}},stubGapi:function(){try{o.default.PAssert(325,!window.gapi,"Should not have loaded gapi when stubbing")}catch(a){o.default.reportError(a)}var e=[];l.a.listen("resetEverything",function(){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;clearTimeout(e[a])}e=[]});var t=function(t,a){var i=setTimeout(function(){e.remove(i),t({success:!0})},0);e.push(i)};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+o.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[C.GScope.UserInfoEmail,C.GScope.Calendar,C.GScope.GmailCompose,C.GScope.GmailModify]}}},client:{request:function(e){return{then:function(t,a,i){return u.a.getAPIForRequest(e)(e.__rawParams).then(t,a,i)},execute:function(){}}},load:d,setApiKey:d,newBatch:function(){return{add:d,then:t}},drive:{files:{get:h,list:h,trash:h,insert:h,patch:h},permissions:{list:h,insert:h,delete:h},properties:{insert:h},parents:{insert:h},changes:{list:h}},gmail:{users:{threads:{list:h,get:h,modify:h,trash:h,untrash:h},labels:{list:h,create:h},history:{list:h},messages:{get:h,send:h,trash:h,untrash:h},drafts:{create:h,update:h,send:h,delete:h,list:h},settings:{sendAs:{list:h}}}},calendar:{settings:{list:h},events:{get:h,list:h,patch:h,insert:h,delete:h},calendars:{insert:h},calendarList:{list:h}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){try{o.default.PAssert(326,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(h){o.default.reportError(h)}function e(e,t){var a=0;try{o.default.PAssert(327,e,"Must load local or remote data to perform queries")}catch(h){o.default.reportError(h)}for(var i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e[i].id===t)return e[i]}}function t(e,t,a){try{o.default.PAssert(329,e,"Must load local or remote data to perform queries")}catch(h){o.default.reportError(h)}var i=[];if(o.default.isArray(a));else if(e)for(var n=0,r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e[r][t]===a&&i.push(e[r])}return i}function a(e,t,a){var i=0;try{o.default.PAssert(330,e,"Must load local or remote data to perform queries")}catch(h){o.default.reportError(h)}for(var n=[],r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e[r][t].indexOf(a)>=0&&n.push(e[r])}return n}this.stubGapi(),this._isRemoteHooked=!0;var i=0,n=[],r=this;function s(e){return function(t,a,r){var s;try{s=e(r)}catch(u){o.default.reportError(u)}var l=setTimeout(function(){n.remove(l),s?t.call(r,{result:s}):a.call(r,{error:!0})},i);n.push(l)}}function u(e){return function(t,a,r){var s=e(r),o=setTimeout(function(){n.remove(o),s?t(s):a({error:!0})},i);n.push(o)}}function d(e){return{then:s(e),execute:u(e)}}l.a.listen("resetEverything",function(){for(var e=0,t=0;t<n.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;clearTimeout(n[t])}n=[]}),gapi.client.drive.files.get=function(t){return d(function(a){return e(r.loadedGapiData.Drive,t.fileId)})},gapi.client.drive.files.list=function(e){return d(function(t){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===e.q)return{items:r.loadedGapiData.documents};var i=/\'(.*)\' in parents/g.exec(e.q),n=/title contains \'([^\']*)\'/g.exec(e.q),s=/mimeType contains \'([^\']*)\'/g.exec(e.q),l=r.loadedGapiData.Drive;return i&&(l=function(e,t){var a=0;try{o.default.PAssert(328,e,"Must load local or remote data to perform queries")}catch(h){o.default.reportError(h)}for(var i=[],n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;(e[n].parents[0].id===t||"root"===t&&e[n].parents[0].isRoot)&&i.push(e[n])}return i}(l,i[1])),n&&(l=a(l,"title",n[1])),s&&(l=a(l,"mimeType",s[1])),{items:l}})},gapi.client.drive.files.trash=function(e){return d(c)},gapi.client.drive.files.insert=function(e){return d(c)},gapi.client.drive.files.patch=function(e){return d(c)},gapi.client.drive.permissions.list=function(e){return d(function(e){return{items:r.loadedGapiData.permissions}})},gapi.client.drive.permissions.insert=function(e){return d(c)},gapi.client.drive.permissions.delete=function(e){return d(c)},gapi.client.drive.properties.insert=function(e){return d(c)},gapi.client.gmail.users.threads.list=function(e){return d(function(a){return{threads:t(r.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(t){return"me"===e.userId||t.accountID===e.userId})}})},gapi.client.gmail.users.threads.modify=function(t){return d(function(a){var i=e(r.loadedGapiData.Gmail,t.id)[0];if(!i)return{};if(i.labelIds||(i.labelIds=[]),t.removeLabelIds)for(var n=0,s=0;s<t.removeLabelIds.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i.labelIds.remove(t.removeLabelIds[s])}t.addLabelIds&&i.labelids.pushOnlyUniques(t.addLabelIds)})},gapi.client.gmail.users.threads.get=function(t){return d(function(a){return e(r.loadedGapiData.Gmail,t.id)})},gapi.client.gmail.users.messages.get=function(e){return d(function(t){return function(e,t){var a=0;try{o.default.PAssert(331,e,"Must load local or remote data to perform queries")}catch(h){o.default.reportError(h)}for(var i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var n=t(e[i]);if(n)return n}}(r.loadedGapiData.Gmail,function(t){for(var a=0,i=0;i<t.messages.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.messages[i].id===e.id)return t.messages[i]}})})},gapi.client.gmail.users.messages.send=function(e){return d(function(t){return{id:o.default.generateTempId(),threadId:e.resource.threadId||o.default.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}})},gapi.client.gmail.users.labels.list=function(e){return d(function(e){return{labels:r.loadedGapiData.Gmail_Labels}})},gapi.client.gmail.users.labels.create=function(e){return d(function(a){var i=t(r.loadedGapiData.Gmail_Labels,"name",e.resource.name)[0];if(i)return i;var n=o.default.generateTempId().substr(3);return i={name:e.resource.name,id:n},r.loadedGapiData.Gmail_Labels||(r.loadedGapiData.Gmail_Labels=[]),r.loadedGapiData.Gmail_Labels.push(i),i})},gapi.client.gmail.users.settings.sendAs.list=function(e){return d(function(e){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}})},gapi.client.calendar.calendarList.list=function(e){return d(function(e){return{items:r.loadedGapiData.calendarList}})},gapi.client.calendar.events.get=function(t){return d(function(a){return e(r.loadedGapiData.GCalendar,t.eventId)})}}},t.default=new f},72:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(2),g=a.n(p),m=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=f.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",e.className,{"border c-border-light":!1!==e.border},{topHeader:e.topHeader}),a=f.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),i=Object.assign({padding:isNaN(e.padding)?void 0:e.padding},e.style);return g.a.createElement("div",{className:t,style:i},g.a.createElement("span",{className:"f1"},e.children),e.hotkey&&g.a.createElement("span",{className:a},e.hotkey))}}]),t}(a(21).a);t.a=m},73:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=a(1),u=a(3),d=a(7),c=a(8),h=a(4),f=a(44),p=a(53),g=a(47),m={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},v=[l.a.KeyCode.Tab,l.a.KeyCode.Backspace,l.a.KeyCode.Delete],y=[l.a.KeyCode.UpArrow,l.a.KeyCode.DownArrow,l.a.KeyCode.LeftArrow,l.a.KeyCode.RightArrow,l.a.KeyCode.Home,l.a.KeyCode.End,l.a.KeyCode.A,l.a.KeyCode.E,l.a.KeyCode.F,l.a.KeyCode.B,l.a.KeyCode.PageUp,l.a.KeyCode.PageDown],k=function(){function e(){n()(this,e)}return s()(e,[{key:"getNavigationAction",value:function(e){var t=d.a.mac,a=e.ctrlKey&&!e.altKey&&!e.metaKey,i=e.altKey&&!e.ctrlKey&&!e.metaKey,n=e.metaKey&&!e.ctrlKey&&!e.altKey,r=!e.ctrlKey&&!e.altKey&&!e.metaKey,s=e.normCode,o=l.a.KeyCode,u=m;if(s===o.LeftArrow){if(a&&!d.a.mac||i&&d.a.mac)return u.LeftWord;if(n&&t)return u.StartLine;if(r)return u.Left}if(s===o.RightArrow){if(a&&!d.a.mac||i&&d.a.mac)return u.RightWord;if(n&&t)return u.EndLine;if(r)return u.Right}if(s===o.UpArrow){if(t&&n)return u.Top;if(t&&a)return u.PageUp;if(t&&i)return u.StartLine;if(!t&&a)return u.PrevHeader;if(r)return u.Up}if(s===o.DownArrow){if(t&&n)return u.Bottom;if(t&&a)return u.PageDown;if(t&&i)return u.EndLine;if(!t&&a)return u.NextHeader;if(r)return u.Down}if(s===o.A&&a&&t)return u.StartLine;if(s===o.E&&a&&t)return u.EndLine;if(s===o.B&&a&&t)return u.Left;if(s===o.F&&a&&t)return u.Right;if(s===o.Home&&!t){if(a)return u.Top;if(r)return u.StartLine}if(s===o.End&&!t){if(a)return u.Bottom;if(r)return u.EndLine}return s===o.PageUp&&r?u.PageUp:s===o.PageDown&&r?u.PageDown:s===o.A&&n&&t||s===o.A&&a&&!t?u.All:u.None}},{key:"updateAutocomplete",value:function(e){var t=e&&e.normCode&&y.indexOf(e.normCode)>=0&&"#"!==e.key;if(!o.default.isDemoRunning&&h.a.isValid()){var a=h.a.getStartIndex(),i=h.a.getStartItem(),n=h.a.getStartOffset(),r=h.a.getPane();h.a.isValid()&&i===h.a.getEndItem()&&n===h.a.getEndOffset()&&r.isIndexMounted(a)?p.a.updateFromPane({owner:i,pane:r,index:a,start:n,element:h.a.getStartElement(),fromArrows:t}):p.a.hide()}}},{key:"keyup",value:function(e,t){if(t.normCode===l.a.KeyCode.Space&&g.a.clearGroupTextChanges(),o.default.preventAndStop(t),this.isTyping=!1,t.handled)return!0}},{key:"handleSelectAll",value:function(e){var t=e.indexOfFirstItem(),a=e.indexOfLastItem();return h.a.selectIndices(t,0,a,-1,l.a.SelectOption.AllowPrefix),!1}},{key:"handleSelectAllItem",value:function(){if(o.default.focusedPane&&o.default.focusedPane.isWriteable)return h.a.selectIndex(h.a.getStartIndex(),0,-1),!1}},{key:"_move",value:function(e){try{o.default.PAssert(675,e===l.a.Direction.Up||e===l.a.Direction.Down,"Must move in a direction")}catch(m){o.default.reportError(m)}var t,a,i=o.default.focusedPane,n=h.a.getStartIndex(),r=h.a.getEndIndex(),s=h.a.getStartItem(),u=h.a.getEndItem(),d=!1;if((s.parent()===u.parent()&&(d=!0),!d)&&!i.getNextItem(h.a.getEndIndex(),!0))for(var f=0;u;){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;if(s.parent()===u.parent()){d=!0;break}u=u.parent()}if(d&&(e===l.a.Direction.Up?(t=i.getPreviousItem(n,!0),a=u.getIndex()+1):(t=i.getNextItem(r,!0),a=s.getIndex()),t)){c.d.beginAction(),i.setIgnoreRestoreScroll();var p=h.a.save();h.a.reset();var g=1+t.numChildrenRecursive();o.default.setItemAnimationMode(l.a.ItemAnimationMode.Move),t.moveTo({parent:t.parent(),index:a},l.a.ChangeType.Local),o.default.resetItemAnimationMode(),e===l.a.Direction.Up?(p.startIndex-=g,p.endIndex-=g):e===l.a.Direction.Down&&(p.startIndex+=g,p.endIndex+=g),h.a.restore(p),e===l.a.Direction.Up?h.a.scrollStartIntoView():h.a.scrollEndIntoView(),c.d.endAction()}}},{key:"moveUp",value:function(){!o.default.focusedPane.isViewAgenda()&&h.a.isValid()&&this._move(l.a.Direction.Up)}},{key:"moveDown",value:function(){!o.default.focusedPane.isViewAgenda()&&h.a.isValid()&&this._move(l.a.Direction.Down)}},{key:"handleArrows",value:function(e,t){var a=o.default.focusedPane;if(!h.a.isValid())return!0;var i=this.getNavigationAction(t),n=m;switch(h.a.preferLineStart=!1,i){case n.Left:case n.Right:case n.StartLine:case n.EndLine:case n.LeftWord:case n.RightWord:var r,s,c,p,g,v,y=i===n.Left||i===n.LeftWord||i===n.StartLine,k=i===n.Right||i===n.RightWord||i===n.EndLine;y&&(!t.shiftKey||h.a.isArrowSelectInverted())||k&&t.shiftKey&&h.a.isArrowSelectInverted()||i===n.StartLine&&h.a.getStartIndex()===h.a.getEndIndex()?(c=h.a.getStartOffset(),p=h.a.getStartIndex(),v=h.a.getStartTotal(),r=h.a.getStartObject()):(c=h.a.getEndOffset(),p=h.a.getEndIndex(),v=h.a.getEndTotal(),r=h.a.getEndObject());var _,S=r.item;if(s=S.getParsedText(),i===n.StartLine)g=u.default.Measure.getCaretOffset(r,a,c).lineStart,p=h.a.isArrowSelectInverted()?h.a.getStartIndex():h.a.getEndIndex(),v=h.a.isArrowSelectInverted()?h.a.getStartTotal():h.a.getEndTotal();else if(i===n.EndLine){var P=u.default.Measure.getCaretOffset(r,a,c);S.metricsInPane(a,p);g=P.lineStart+P.lineLength,p=h.a.isArrowSelectInverted()?h.a.getStartIndex():h.a.getEndIndex()}else if(i===n.LeftWord){var w=f.a.getPreviousWord(S,s,c-1),I=s.prevIndexOf(l.a.AttachChar,c);if(I<0||I<=w)if(-1===w&&0===c)if(u.default.settings.selectFullItems.get()&&t.shiftKey)g=0;else if(p>0){if((p=a.indexOfPrevVMLI(p,!1,!0))>=0){var b=a.itemAtIndex(p).getParsedText();g=f.a.getPreviousWord(S,b,b.length-1)+1,v=b.length}}else g=-1;else g=w+1;else I>w&&(g=I+1,I+1===c&&g--)}else if(i===n.RightWord){var D=f.a.getNextWord(S,s,c+1),E=s.indexOf(l.a.AttachChar,c);if(E<0||E>=D)if(D===v)if(c!==v||t.shiftKey&&u.default.settings.selectFullItems.get())g=v;else if(p<a.numItems()-1){if((p=a.indexOfNextVMLI(p,!1,!0))>=0){var C=(_=a.itemAtIndex(p)).getParsedText();D=f.a.getNextWord(_,C,0),v=C.length,-1===D&&(D=C.length),g=D}}else g=v+1;else g=D;else(D>E||D<0)&&E>=0&&(g=E,E===c&&g++)}else i===n.Left?g=h.a.getStartOffset()===h.a.getEndOffset()||t.shiftKey?f.a.moveLeft(S,s,c):h.a.getStartOffset():i===n.Right&&(g=h.a.getStartOffset()===h.a.getEndOffset()||t.shiftKey?f.a.moveRight(S,s,c,v):h.a.getEndOffset());if(h.a.preferLineStart=y,!_&&(!u.default.settings.selectFullItems.get()||!t.shiftKey))if(g<h.a.getStartItem().getPrefixLength()&&i!==n.StartLine)if(h.a.preferLineStart=!1,p>0){p=a.indexOfPrevVMLI(p,!1,!0);var A=a.itemAtIndex(p);g=A.getParsedText().length,f.a.isInsideMarkup(A,g)&&(g=f.a.moveLeft(A,s,g))}else g=0;else g>v&&(p<a.numItems()-1?(p=a.indexOfNextVMLI(p,!1,!0),g=0):g=v);if(t.shiftKey){var M=h.a.isArrowSelectInverted()?h.a.getEndIndex():h.a.getStartIndex(),T=h.a.isArrowSelectInverted()?h.a.getEndOffset():h.a.getStartOffset();!h.a.isArrowSelectInverted()&&y&&p<=h.a.getStartIndex()&&g>=-1&&g<h.a.getStartOffset()?h.a.setArrowSelectInverted(!0):h.a.isArrowSelectInverted()&&k&&p>=h.a.getEndIndex()&&g>h.a.getEndOffset()&&h.a.setArrowSelectInverted(!1),h.a.isArrowSelectInverted()?h.a.selectIndices(p,g,M,T):h.a.selectIndices(M,T,p,g)}else h.a.selectIndex(p,g);if(d.a.isFirefox)if(t.normCode===l.a.KeyCode.LeftArrow){if(S.getParsedText()[h.a.getStartOffset()-1]===l.a.AttachChar&&!t.shiftKey)return h.a.selectItem(S,h.a.getStartOffset()-1),!1}else if(t.normCode===l.a.KeyCode.RightArrow){if(S.getParsedText()[h.a.getEndOffset()]===l.a.AttachChar&&!t.shiftKey)return h.a.selectItem(S,h.a.getEndOffset()+1),!1}y?h.a.scrollStartIntoView():h.a.scrollEndIntoView();break;case n.Up:case n.Down:case n.Top:case n.Bottom:case n.PageUp:case n.PageDown:case n.PrevHeader:case n.NextHeader:var L,x,R,O=i===n.Up||i===n.Top||i===n.PageUp,F=i===n.Down||i===n.Bottom||i===n.PageDown;O&&(!t.shiftKey||h.a.isArrowSelectInverted())||F&&t.shiftKey&&h.a.isArrowSelectInverted()?(R=h.a.getStartOffset(),x=h.a.getStartIndex(),L=h.a.getStartObject()):(R=h.a.getEndOffset(),x=h.a.getEndIndex(),L=h.a.getEndObject());var N,B=L.item,U=u.default.Measure.getCaretOffset(L,a,R),V=u.default.Measure.getCaretScreenPosition(a,x,R),H=(U.lineOffset,V.left);if(h.a.preferLineStart=U.lineOffset<=2,i===n.Up){var j=U.line-1;if(0===x&&j<0)N=0,j=0;else{if(j<0&&x>0)if((x=a.indexOfPrevVMLI(x,!1,!0))>=0)B=a.itemAtIndex(x),L=a.objectAtIndex(x),j=u.default.Measure.getCaretOffset(L,a).line;j>=0&&(N=u.default.Measure.getOffsetForScreenPositionInLine(x,L,a,j,H))}}else if(i===n.Down){var z=U.line+1;z>B.metricsInPane(a,x).styledLines.length-1&&(x<a.numItems()-1&&(x=a.indexOfNextVMLI(x,!1,!0))>=0?(B=a.itemAtIndex(x),z=0):z=U.line),x>=0&&(L=a.objectAtIndex(x),N=u.default.Measure.getOffsetForScreenPositionInLine(x,L,a,z,H))}else if(i===n.Top)x=a.indexOfFirstItem(),N=0;else if(i===n.Bottom){var q=a.getLastItem(),W=a.numItems();q&&W>0&&(x=a.indexOfLastItem(),N=q.getParsedText().length)}else if(i===n.PageUp){x=a.indexPageUp(h.a.getStartIndex()),N=0}else if(i===n.PageDown){var G=a.indexPageDown(h.a.getStartIndex());x=G,N=a.itemAtIndex(G).getParsedText().length}else{if(i===n.PrevHeader&&a.isViewOutline()){var K=h.a.getStartItem();if(K.parent()===o.default.focusedItem){if(!K.isFirstChild()){try{o.default.PAssert(676,K.getIndex()>0,"Should never hit this with the first item in the list")}catch(Z){o.default.reportError(Z)}X=K.parent().getChild(K.getIndex()-1)}}else{for(var Y=0;K.parent()!==o.default.focusedItem;){if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;K=K.parent()}X=K}return void 0!==X&&h.a.selectItem(X,-1),!1}if(i===n.NextHeader&&a.isViewOutline()){var X,Q=h.a.getEndItem();if(Q.parent()===o.default.focusedItem)Q.isLastChild()||(X=Q.parent().getChild(Q.getIndex()+1));else{for(var J=0;Q.parent()!==o.default.focusedItem;){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;Q=Q.parent()}Q.isLastChild()||(X=Q.parent().getChild(Q.getIndex()+1))}return void 0!==X&&h.a.selectItem(X,-1),!1}}if(x>=0&&!isNaN(N))if(t.shiftKey){M=h.a.isArrowSelectInverted()?h.a.getEndIndex():h.a.getStartIndex(),T=h.a.isArrowSelectInverted()?h.a.getEndOffset():h.a.getStartOffset();!h.a.isArrowSelectInverted()&&O&&(x===h.a.getStartIndex()&&N<h.a.getStartOffset()||x<h.a.getStartIndex())?h.a.setArrowSelectInverted(!0):h.a.isArrowSelectInverted()&&F&&(x===h.a.getEndIndex()&&N>h.a.getEndOffset()||x>h.a.getEndIndex())&&h.a.setArrowSelectInverted(!1),h.a.isArrowSelectInverted()?h.a.selectIndices(x,N,M,T):h.a.selectIndices(M,T,x,N)}else h.a.selectIndex(x,N);O?h.a.scrollStartIntoView():h.a.scrollEndIntoView();break;case n.All:this.handleSelectAll(a)}return i===n.None}},{key:"keydown",value:function(e,t){this.isTyping=!0;var a=!0;if(v.indexOf(t.normCode)>=0?a=this.keypress(e,t,!0):d.a.mac&&t.ctrlKey&&t.normCode===l.a.KeyCode.D?a=this.keypress(e,t,!0):y.indexOf(t.normCode)>=0?(o.default.setItemAnimationMode(l.a.ItemAnimationMode.None),a=this.handleArrows(e,t),o.default.resetItemAnimationMode(),this.getNavigationAction(t)&&this.updateAutocomplete(t)):d.a.mac&&t.metaKey||!d.a.mac&&t.ctrlKey&&!t.altKey?t.normCode!==l.a.KeyCode.Y&&t.normCode!==l.a.KeyCode.Z||(a=this.keypress(e,t,!0)):d.a.mac&&t.ctrlKey&&t.normCode===l.a.KeyCode.H&&o.default.preventDefault(t),a&&h.a.getStartIndex()===h.a.getEndIndex()&&h.a.getStartOffset()===h.a.getEndOffset()){var i=h.a.getStartOffset(),n=h.a.getStartItem(),r=n.getParsedText();o.default.shouldLog(l.a.LogLevels.Edit)&&console.log("check markdown",i,r[i]),"]"===r[i]&&f.a.isInsideMarkup(n,i)&&(i=f.a.moveRight(n,r,i,r.length-1),h.a.selectIndex(h.a.getStartIndex(),i),h.a.focusHiddenInput(),o.default.shouldLog(l.a.LogLevels.Edit)&&console.log("Adjusted to",i))}return a&&this.keyWantsScrollIntoView(t,!0)&&h.a.scrollStartIntoView(),a}},{key:"checkKeypressSpecialCases",value:function(e,t){var a;return e.ctrlKey&&e.altKey&&t?a=!0:e.metaKey&&e.normCode===l.a.KeyCode.Tilde&&(a=!1),a}},{key:"isMultiselectDangerous",value:function(){var e=o.default.focusedPane;return e.isViewOutline()||e.isViewProject()?h.a.getSelectedItems(!0,!0).length>6&&"You have selected a large number of items to delete. Are you sure?":"Are you sure you want to delete multiple items?"}},{key:"keypress",value:function(e,t,a,i){var n=[l.a.KeyCode.Enter,l.a.KeyCode.D];o.default.stopPropagation(t);var r=!0,s=o.default.focusedPane,f=t.normCode>=32||n.indexOf(t.normCode)>=0;if(!(0===t.which)&&(a||f)){if(d.a.mac&&t.metaKey||!d.a.mac&&t.ctrlKey)switch(String.fromCharCode(t.normCode)){case"c":case"C":return t.handled=!0,!0;case"v":case"V":return t.handled=!0,!0;case"x":case"X":return t.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{o.default.PAssert(677,!1,"Should not be handled undo/redo hotkeys here")}catch(k){o.default.reportError(k)}return t.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return t.handled=!0,!0}var p=h.a.getStartItem();c.d.beginAction(),g.a.saveDeleteSelection(),g.a.beginAction();var m=[l.a.KeyCode.Tab,l.a.KeyCode.Enter,l.a.KeyCode.Backspace,l.a.KeyCode.Delete,l.a.KeyCode.D];if(h.a.getStartIndex()!==h.a.getEndIndex()&&t.normCode!==l.a.KeyCode.Tab&&(!t.metaKey&&!t.ctrlKey&&!t.altKey||m.indexOf(t.normCode)>=0))if(s.isViewOutline()||s.isViewProject()){var v;if(u.default.PaneUpdateBatcher.beginUpdateItems(),!i&&(v=this.isMultiselectDangerous())){if(s.isSearchedFlat())u.default.toasts.pushMessage(l.a.MessageID.FlatSearchMultiSelect);else{var y=h.a.save();u.default.menus.confirm(v,function(i){h.a.restore(y),i&&this.keypress(e,t,a,!0)}.bind(this))}r=!1}else r=!!s.isEditable&&(r&&this.handleMultiselect(t));u.default.PaneUpdateBatcher.commitUpdateItems()}else u.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),r=!1;r&&m.indexOf(t.normCode)>=0&&(u.default.PaneUpdateBatcher.beginUpdateItems(),t.normCode===l.a.KeyCode.Enter?r=!!s.isEditable&&(r&&this.handleEnter(t)):t.normCode===l.a.KeyCode.Backspace?r=!!(p&&p.allowTextEditing()&&s.isEditable)&&(r&&this.handleBackspace(t)):(t.normCode===l.a.KeyCode.Delete||d.a.mac&&t.ctrlKey&&t.normCode===l.a.KeyCode.D)&&(r=!!(p&&p.allowTextEditing()&&s.isEditable)&&(r&&this.handleDelete(t))),u.default.PaneUpdateBatcher.commitUpdateItems()),g.a.endAction(),c.d.endAction()}return this.keyWantsScrollIntoView(t,a)&&h.a.scrollStartIntoView(),r}},{key:"handleMultiselect",value:function(e){var t=0,a=0,i=o.default.focusedPane,n=i.indexOfNextVMLI(h.a.getStartIndex()-1),r=i.indexOfPrevVMLI(h.a.getEndIndex()+1),s=h.a.getStartOffset(),u=h.a.getEndOffset();h.a.selectIndices(n,s,r,u,l.a.SelectOption.AllowPrefix);var d=!0,f=i.objectAtIndex(n),p=h.a.getStartItem(),g=h.a.getEndItem();if(p.isNote()&&(p=p.parent()),g.isNote()&&(g=g.parent()),!i.hasNonVMLIs&&p===g)return!1;if(e.normCode===l.a.KeyCode.Enter&&e.shiftKey)return!0;var m=[];r=r;for(var v=i.indexOfNextVMLI(n);v&&v>=0&&(v<r||v===r&&h.a.getEndOffset()===h.a.getEndTotal());){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var y=i.itemAtIndex(v);y.parent()===o.default.focusedPane.getItem()&&y.isHeader()&&0,m.indexOf(y)<0&&y!==p&&m.push(y),v=i.indexOfNextVMLI(v)}var k,_=h.a.getEndItem().levelsDeep.get()-h.a.getStartItem().levelsDeep.get();if(h.a.getStartOffset()>0||h.a.getEndOffset()<h.a.getEndTotal()){var S=p.splitUsableText(p.getParsedText(),s,s),P=g.splitUsableText(g.getParsedText(),u,u);k=S.before+P.after,c.d.performAction(c.b.Remove,{itemID:p.id,position:h.a.getStartOffset(),text:p.getParsedText().slice(h.a.getStartOffset())}),c.d.performAction(c.b.Insert,{itemID:p.id,position:h.a.getStartOffset(),text:g.getParsedText().substring(h.a.getEndOffset())}),m.indexOf(g)<0&&m.push(g),0===h.a.getStartOffset()&&p.copyProperties(g)}else c.d.performAction(c.b.Remove,{itemID:p.id,position:0,text:p.getParsedText()}),k="";if(e.normCode!==l.a.KeyCode.Backspace&&e.normCode!==l.a.KeyCode.Delete&&e.normCode!==l.a.KeyCode.Enter||(d=!1),p.setText(k,l.a.ChangeType.Local),g.moveChildren(p,0,l.a.ChangeType.Local),_>0){for(var w=0,I=[],b=g.nextSibling();_>0&&b;){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;v=b.getIndex();var D=b.parent().getItems().slice(v);I=I.concat(D),b=b.parent().nextSibling(),_--}if(I.length>0){var E=0,C=p;v=0;for(var A=0;A<I.length;A++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;var M=I[A],T=M.parent();if(m.indexOf(T)>=0){var L=M.getIndex();M.moveTo({parent:C,index:v},l.a.ChangeType.Local),c.d.performAction(c.b.Move,{itemID:M.id,oldParent:T.id,oldPosition:L,newParent:C.id,newPosition:v}),v++}}}}else if(m.indexOf(g.parent())>=0)for(var x=0,R=(C=p.parent(),i.getNextItem(r,!0));R;){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;v=C.numItems();var O=R.parent(),F=O.getChildIndex(R);R.moveTo({parent:C,index:v},l.a.ChangeType.Local),c.d.performAction(c.b.Move,{itemID:R.id,oldParent:O.id,oldPosition:F,newParent:C.id,newPosition:v}),R=i.getNextItem(r,!0)}for(A=0;A<m.length;A++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var N=m[A];try{o.default.PAssert(678,N,"Item must exist")}catch(U){o.default.reportError(U)}N.isDeleted()||N.parent().deleteChild(N,void 0,void 0,l.a.ChangeType.Local)}if(i.hasNonVMLIs){var B=i.closestIndexOfObject(f);try{o.default.PAssert(679,B>=0,"Could not find item to select")}catch(U){o.default.reportError(U)}B>=0&&h.a.selectIndex(B,s)}else h.a.selectIndex(n,s);return d}},{key:"handleTab",value:function(e){var t=0,a=h.a.getPane(),i=h.a.getStartItem(),n=h.a.getStartIndex(),r=h.a.getEndItem(),s=h.a.getStartObject(),d=h.a.getEndObject(),f=h.a.getStartOffset(),p=h.a.getEndOffset(),g=!e,m=g?0:1;if(s.levelsDeep<m)return!1;if(g&&a.isViewAutoBlocks()&&s.levelsDeep===m){var v=a.prevPaneObjectAtSameLevel(n);if(!v||v.block!==s.block||v.item.parent()!==i.parent())return!1}u.default.PaneUpdateBatcher.beginUpdateItems(),i&&i.isNote()&&(i=i.parent()),r&&r.isNote()&&(r=r.parent()),h.a.scrollStartIntoView();var y=i,k={},_=[i],S={},P={};if(P[i.id]=!0,i!==r){var w=0;do{if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;(y=o.default.getNextItem(y,a,{numLevels:0,ignoreSearch:!0}))&&(_.push(y),P[y.id]=!0)}while(y!==r&&void 0!==y)}var I,b,D,E=0;for(e?(I=function(){E=_.length-1},b=function(){return E>=0},D=function(){E--}):(I=function(){E=0},b=function(){return E<_.length},D=function(){E++}),I();b();D()){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var C=_[E];try{o.default.PAssert(680,C,"Must always be tabbing/untabbing valid items")}catch(Z){o.default.reportError(Z)}var A,M,T=C.parent(),L=T.getItems().indexOf(C);if(g){var x=0,R=void 0;if(A=L>0&&!s.isBlockHeader,a.search.isFlatSearchResult(C)&&(A=!1,u.default.toasts.pushMessage(l.a.MessageID.FlatSearchTab)),A)if(s.block){var O=a.prevPaneObjectAtSameLevel(n+E);O&&O.item&&(R=O.item,!0)}else R=T.itemAtIndex(L-1);if(A&&R){for(var F=0;R.isHidden(a);){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;if(--L<=0)return u.default.PaneUpdateBatcher.commitUpdateItems(),!1;R=T.itemAtIndex(L-1)}S[T.id]||(k[C.parent().id]=C.parent(),k[R.id]=R,C.moveTo({parent:R},l.a.ChangeType.Local),R.isCollapsed(a,!1)&&R.setCollapsed(!1,a)),S[C.id]=!0,c.d.performAction(c.b.Move,{itemID:C.id,oldParent:T,oldPosition:L,newParent:R,newPosition:R.numItems()-1})}else R=T,S[C.id]=S[T.id];for(var N=!1,B=C;B;){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;if(S[B.id]){B.isCollapsed(a,!1)||(N=!0);break}B=B.parent()}var U=C.getIndex()+1;if(N){var V=0,H=C.getItems(),j=0;for(M=0;M<H.length;M++){if(V++>5e3&&__infLoop&&__infLoop(V))throw new RangeError;var z=H[M];if(!P[z.id]){if(z.isHidden(a))continue;k[z.parent().id]=z.parent(),k[C.parent().id]=C.parent();var q=U+j;z.moveTo({parent:C.parent(),index:q},l.a.ChangeType.Local),S[z.id]=!0,c.d.performAction(c.b.Move,{itemID:z.id,oldParent:C,oldPosition:M,newParent:C.parent(),newPosition:q}),j++,M--}}}}else if(A=C.parent()!==o.default.focusedItem&&!(a.isViewProject()&&s.block.id!==a.blockNoKey&&C.parent().parent()===o.default.focusedItem),(a.search.isFlatSearchResult(C)||a.search.isFlatSearchResult(C.parent()))&&(A=!1,u.default.toasts.pushMessage(l.a.MessageID.FlatSearchTab)),A){var W=0,G=C.parent().parent(),K=T.getItems();for(M=L+1;K[L+1];){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var Y=K[L+1];P[Y.id]||Y.isHidden(a)?L++:(k[Y.parent().id]=Y.parent(),k[C.id]=C,Y.moveTo({parent:C},l.a.ChangeType.Local),S[Y.id]=!0,c.d.performAction(c.b.Move,{itemID:Y.id,oldParent:T,oldPosition:M,newParent:C,newPosition:C.numItems()-1})),M++}if(P[T.id]>=0&&(!T.parent()||T.parent()!==o.default.focusedItem))continue;var X=G.getItems().indexOf(T);k[C.parent().id]=C.parent(),k[G.id]=G,C.moveTo({parent:G,index:X+1},l.a.ChangeType.Local),S[C.id]=!0,c.d.performAction(c.b.Move,{itemID:C.id,oldParent:T,oldPosition:L,newParent:G,newPosition:X+1})}}a.setIgnoreRestoreScroll(),u.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);var Q=a.indexOfObject(s),J=a.indexOfObject(d);Q>=0&&J>=0?h.a.selectIndices(Q,f,J,p):requestAnimationFrame(function(){return h.a.updateCaret()})}},{key:"handleEnter",value:function(e){var t=o.default.focusedPane,a=h.a.getStartItem(),i=h.a.getStartObject(),n=h.a.getStartIndex(),r=h.a.getStartOffset(),s=h.a.getStartTotal(),d=h.a.getEndItem(),p=h.a.getEndOffset(),g=h.a.getEndTotal();if(!a){try{o.default.PAssert(681,!1,"Invalid item in handleEnter")}catch(N){o.default.reportError(N)}return!1}var m=a.parent();if(!m){try{o.default.PAssert(682,!1,"Invalid parent in handleEnter")}catch(N){o.default.reportError(N)}return!1}var v,y=m.getItems().indexOf(a),k=a.getParsedText(),_=a.getMooDate(),S=!1,P=m;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),e&&e.shiftKey)return o.default.preventDefault(e),!1;if(a.isNote())return o.default.preventDefault(e),!1;if(t.search.isFlatSearchResult(a))return u.default.toasts.pushMessage(l.a.MessageID.FlatSearchEnter),o.default.preventDefault(e),!1;if(t.isViewProject()&&t.isItemTopLevel(i,a)&&a.hasChildren()&&0===a.getChild(0).getParsedTextWithoutPrefix().length)h.a.selectIndex(n+1,0);else if(a.shouldCopyPrefix()&&k===a.getPrefix())a.setText("",l.a.ChangeType.Local),h.a.selectIndex(n,0);else{if(!a.getPrefix()||r!==a.getPrefixLength()||p!==g){var w,I,b=!0,D=!1,E=!1,C={text:""},A=i.block;t.setIgnoreRestoreScroll(),u.default.PaneUpdateBatcher.beginUpdateItems(),t.isViewTag()&&a.getParsedText().indexOf(i.block.text)>=0&&(w=i.block.text,I=a.getParsedText()[a.getPrefixLength()]===l.a.TagPrefix?0:-1),f.a.isInsideMarkup(a,r)&&(r=f.a.moveRight(a,k,r,k.length));var M=f.a.adjustLeftForMarkup(a,p);if(!t.isViewAgenda()||0!==i.levelsDeep||a.hasVisibleChildren(t)&&!a.isCollapsed(t))if(a.hasAttachmentType(l.a.PluginType.Calendar));else if(M===d.getPrefixLength()&&""!==k)y--,b=!1,D=!0;else if(r>=s)(S=!a.isCollapsed(t,!1)&&(a.getVisibleChildren(t).length>0||a.isPrefixHeader()))&&(P=a);else if(r===a.getPrefixLength()&&p===g)a.setText(a.getPrefix(),l.a.ChangeType.Local),c.d.performAction(c.b.Remove,{itemID:a.id,position:0,text:k});else{var T=a.splitUsableText(k,r,p);w&&T.before.indexOf(T)<0&&(0===I?T.before=w+" "+T.before:T.before+=" "+w),C.text=T.after,_&&T.after.includes(l.a.CharDate)&&(C.date=_),o.default.setItemAnimationMode(l.a.ItemAnimationMode.Move),a.setText(T.before,l.a.ChangeType.Local),c.d.performAction(c.b.Remove,{itemID:a.id,position:0,text:k.substring(0,p)}),E=!0,(S=!a.isCollapsed(t,!1)&&(a.numItems()>0||a.isHeader()))&&(P=a)}else A.isStarred?C.isStarred=!0:A.isImportant?C.priority=a.getPriority():A.isDate&&A.date&&a.getMooDate()?C.date=a.getMooDate().toData():C.text=" "+A.id,a.shouldSave()||(y=-1);!S&&w&&C.text.indexOf(w)<0&&(0===I?C.text=w+" "+C.text:C.text+=" "+w);var L=u.default.settings.defaultItemPrefix.get();if(S||!a.shouldCopyPrefix()&&!E?(!S||S&&L&&(a.isPrefixHeader()||a.shouldCopyPrefix()&&a.prefix===L))&&(C.text=(L&&L+" ")+C.text):C.text=a.getPrefix()+C.text,v=t.createVMLI(C,{parent:P,changeType:l.a.ChangeType.AllLocal,isEditable:!0}),E&&v.copyProperties(a),v.parseText("",l.a.ChangeType.Local|l.a.ChangeType.All),S)a.insertItem(v,0),c.d.performAction(c.b.Create,{itemID:v.id,parent:a.id,position:0,text:v.getParsedText()});else{try{o.default.PAssert(683,!v.isNote(),"Should never be inserting a note here")}catch(N){o.default.reportError(N)}P.insertItem(v,y+1),c.d.performAction(c.b.Create,{itemID:v.id,parent:P.id,position:y+1,text:v.getParsedText()})}u.default.PaneUpdateBatcher.commitUpdateItems(),o.default.resetItemAnimationMode();var x=b?v:a;try{o.default.PAssert(684,x,"Expected another item to exist")}catch(N){o.default.reportError(N)}var R=t.closestIndexOfObject(i),O=b?t.indexOfItem(v,A):D?R-1:R,F=x.shouldCopyPrefix()&&x.getPrefixLength()||0;return O>=0&&h.a.selectIndex(O,F,F),o.default.preventDefault(e),!1}a.setText(a.getPrefix(),l.a.ChangeType.Local),h.a.selectIndex(n,0),c.d.performAction(c.b.Remove,{itemID:a.id,position:0,text:k})}}},{key:"handleBackspace",value:function(e){var t=h.a.getStartItem(),a=h.a.getStartIndex(),i=h.a.getStartOffset(),n=h.a.getEndOffset(),r=h.a.getStartObject(),s=o.default.focusedPane,p=i===n;if(!t){try{o.default.PAssert(685,!1,"Invalid item in handleBackspace")}catch(O){o.default.reportError(O)}return!1}var m=t.parent();try{o.default.PAssert(686,m,"Must always have a valid parent for an item")}catch(O){o.default.reportError(O)}d.a.ie&&o.default.preventAndStop(e);var v=t.getParsedText(),y="",k=0,_=!0,S=t.hasAttachmentType(l.a.PluginType.Calendar);if(0===i&&0===n||""===v)if(r.isBlockHeader&&t.hasChildren())_=!1;else if(t.isNote()&&""!==v)_=!1;else if(S)_=!1;else if(h.a.getStartIndex()>0){var P=o.default.focusedPane.indexOfPrevVMLI(h.a.getStartIndex(),!0,!0),w=P>=0&&o.default.focusedPane.itemAtIndex(P);if(w&&w.allowTextEditing()){if((s.isViewAgenda()||s.search.isFlatSearchResult(t))&&0!==v.length&&(_=!1),_){s.setIgnoreRestoreScroll(),u.default.PaneUpdateBatcher.beginUpdateItems(),g.a.saveDeleteSelection();var I=w.getParsedText(),b=w.isFullscreen()?0:P,D=s.objectAtIndex(b),E=w.isFullscreen()?0:I.length;h.a.selectIndex(b,E),v.length>0&&""!==v&&(0===I.length&&w.copyProperties(t),w.setText(w.generateSaveText(I)+t.generateSaveText(v),l.a.ChangeType.Local),t.hasNote()&&(w.hasNote()||w.moveNote(t,l.a.ChangeType.Local)),c.d.performAction(c.b.Insert,{itemID:w.id,position:I.length,text:v})),m.deleteChild(t,w,0,l.a.ChangeType.Local),u.default.PaneUpdateBatcher.commitUpdateItems(),b=s.indexOfObject(D),h.a.selectIndex(b,E),_=!1}}else _=!1}else _=!1;else if(p&&i<=t.getPrefixLength())r.isBlockHeader&&t.hasChildren()?_=!1:(c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v.slice(0,t.getPrefixLength())}),y=v.substr(t.getPrefixLength()),k=0);else if(0===i&&n===v.length)c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:t.getParsedText()}),y="",k=0;else if(e&&e.metaKey)if(t.isNote()){var C=v.prevIndexOf("\n",n);C<0?(y=v.substring(n),k=0,c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v.slice(0,n)})):(y=v.substring(0,C)+v.substring(n),k=C,c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v.slice(C,n)}))}else y=t.getPrefix()+v.substring(n),c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v.slice(0,n)}),k=0;else{var A=f.a.isInsideMarkup(t,i-1);if(A&&(i=f.a.moveLeft(t,v,i-1)+1,A.isMDImage()&&"!"===v[i-1]&&i--),p?n=i:f.a.isInsideMarkup(t,n-1)&&(n=f.a.moveRight(t,v,n-1,h.a.getStartTotal())-1),p=i===n,(e&&d.a.mac&&e.altKey||e&&!d.a.mac&&e.ctrlKey)&&p){var M=v.substring(i),T=f.a.getPreviousWord(t,v,i-1)+1;o.default.shouldLog(l.a.LogLevels.Edit)&&console.log(T,v[T],M),T>=0?(c.d.performAction(c.b.Remove,{itemID:t.id,position:T,text:v.slice(T,i)}),y=v.substring(0,T)+M,k=T):(i===v.length?0===i&&(y="",c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v})):(c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:v.slice(0,i)}),y=M),k=0)}else if(p){var L=1;v.length>1&&(""===v[i-1]||i>1&&f.a.isEmoji(v[i-1])&&f.a.isEmoji(v[i-2]))&&L++,y=v.substr(0,i-L)+v.substr(i),c.d.performAction(c.b.Remove,{itemID:t.id,position:i-L,text:v.slice(i-L,i)}),k=i-L}else{var x=v.slice(i,n);c.d.performAction(c.b.Remove,{itemID:t.id,position:i,text:x}),y=v.substr(0,i)+v.substr(n),k=i}}if(_){if(!u.default.settings.showMarkdown.get()){var R=y.search(/(_{4,}?|\*{4,}?)/);R>=0&&(y=y.replace(/(_{4,}?|\*{4,}?)/g,""),k>R&&(k-=k-R))}t.setText(y,l.a.ChangeType.Local),h.a.selectIndex(a,k),this.updateAutocomplete(e)}return!1}},{key:"handleDelete",value:function(e){var t=h.a.getStartItem(),a=o.default.focusedPane;if(!t)return!1;var i,n=t.parent(),r=t.getParsedText(),s=h.a.getStartIndex(),u=h.a.getStartOffset(),p=h.a.getEndOffset(),m=u===p,v=!0;if(""===r)if(a.isViewOutline()){if(t.isNote())n.setNote(void 0,l.a.ChangeType.Local),h.a.selectItem(n,-1);else if(s<a.numItems()-1){var y=s;a.setIgnoreRestoreScroll(),g.a.saveDeleteSelection(),a.numItems()>1&&(t.hasChildren()?n.replaceChild(t,t.getFirstChild(),l.a.ChangeType.Local):n.deleteChild(t,n,y,l.a.ChangeType.Local)),h.a.selectIndex(y,0)}}else v=!1;else if(u===h.a.getStartTotal()&&p===h.a.getEndTotal())if(a.isViewOutline())if(t.isNote())v=!1;else{var k=a.indexOfNextVMLI(s,!0,!0),_=k>=0&&a.itemAtIndex(k);if(a.setIgnoreRestoreScroll(),_&&v){r=t.generateSaveText(r);var S=_.generateSaveText(_.getParsedText()),P=_.hasNote()&&_.getNote();if(t.setText(r+S,l.a.ChangeType.Local),P){var w=t.hasNote()&&t.getNote();if(w){var I=w.getRawText()+"\n\n--- merged note ---\n\n"+P.getRawText();w.setText(I,l.a.ChangeType.Local)}else P.setParent(t),t.setNote(P,l.a.ChangeType.Local)}c.d.performAction(c.b.Insert,{itemID:t.id,position:r.length,text:_.getParsedText()}),g.a.saveDeleteSelection(),_.parent().deleteChild(_,t,0,l.a.ChangeType.Local),h.a.selectIndex(h.a.getEndIndex(),p)}}else v=!1;else if(e.metaKey)t.isNote()||(i=r.substring(0,u),t.setText(i,l.a.ChangeType.Local),c.d.performAction(c.b.Remove,{itemID:t.id,position:0,text:r.slice(0,u)}),h.a.selectIndex(s,u));else if((d.a.mac&&e.altKey||!d.a.mac&&e.ctrlKey)&&u===p){var b=f.a.getNextWord(t,r,u+1);b<0&&(b=h.a.getStartTotal()),b>=0&&(i=r.substring(0,u)+r.substring(b),t.setText(i,l.a.ChangeType.Local),c.d.performAction(c.b.Remove,{itemID:t.id,position:b,text:i}),h.a.selectIndex(s,u))}else{if(f.a.isInsideMarkup(t,u-1)&&(u=f.a.moveLeft(t,r,u-1)+1),f.a.isInsideMarkup(t,p)&&(p=f.a.moveRight(t,r,p,h.a.getStartTotal())-1),m){var D=1;r.length>1&&u+1<r.length&&f.a.isEmoji(r[u])&&f.a.isEmoji(r[u+1])&&D++,i=r.substr(0,u)+r.substr(u+D),c.d.performAction(c.b.Remove,{itemID:t.id,position:u,text:r.slice(u,u+1)})}else{r.slice(u,p);i=r.substr(0,u)+r.substr(p),c.d.performAction(c.b.Remove,{itemID:t.id,position:u,text:r.slice(u,p)})}void 0!==i&&(t.setText(i,l.a.ChangeType.Local),h.a.selectIndex(s,u),this.updateAutocomplete(e))}return!1}},{key:"keyWantsScrollIntoView",value:function(e,t){switch(e.normCode){case l.a.KeyCode.LeftMeta:case l.a.KeyCode.RightMeta:case l.a.KeyCode.Alt:case l.a.KeyCode.Shift:case l.a.KeyCode.Ctrl:case l.a.KeyCode.LeftArrow:case l.a.KeyCode.RightArrow:case l.a.KeyCode.UpArrow:case l.a.KeyCode.DownArrow:return!1}return!(d.a.mac&&e.metaKey&&(t&&e.normCode===l.a.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(d.a.mac&&e.metaKey||!d.a.mac&&e.ctrlKey)||e.normCode!==l.a.KeyCode.Z&&e.normCode!==l.a.KeyCode.Y)&&!(e.normCode>=l.a.KeyCode.F1&&e.normCode<=l.a.KeyCode.F12))}},{key:"compoundOperation",value:function(e){c.d.beginAction(),u.default.PaneUpdateBatcher.beginUpdateItems(),e(),u.default.PaneUpdateBatcher.commitUpdateItems(),c.d.endAction()}}]),e}();t.a=new k},74:function(e,t,a){"use strict";var i=a(5),n=a.n(i);t.a=function e(t){var a=this;n()(this,e),Object.keys(t).forEach(function(e){return a[e]=t[e]})}},76:function(e,t,a){"use strict";var i=a(68),n=a.n(i),r=a(82),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=a(1),k=a(7),_=a(2),S=a.n(_),P=a(21),w=function(e){function t(){return l()(this,t),h()(this,p()(t).apply(this,arguments))}return m()(t,e),d()(t,[{key:"init",value:function(){var e=this.props;this.thumbExtraHeight=0;try{v.default.PAssert(596,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(a){v.default.reportError(a)}var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.refs.thumb&&v.default.setupClick(this.refs.thumb,this,{onStart:this.onTapThumbStart,onMove:this.onTapThumbMove,onEnd:this.onTapThumbEnd})}},{key:"onUnmount",value:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"getScrollSize",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]}},{key:"getClientHeight",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]}},{key:"getScrollTop",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]}},{key:"calculateThumb",value:function(){this.props;var e,t=this.getScrollSize(),a=this.getClientHeight(),i=this.getScrollTop(),n=this.props.thumbHeight;(n||(t===a?n=a:(n=a/t*a,this.thumbExtraHeight=n<30?30-n:0,n=Math.floor(Math.max(n,30)))),t===a)?e=0:e=i/(t-a)*(a-n);e=Math.floor(e);var r=n!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(n,!1),this.thumbTop.set(e,r)}},{key:"onScroll",value:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)}},{key:"handleScroll",value:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)}},{key:"onMouseMove",value:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"onMouseEnter",value:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))}},{key:"onMouseLeave",value:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()}},{key:"onTapThumbStart",value:function(e){e.button===y.a.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===y.a.Orientation.Horizontal?e.clientX:e.clientY,v.default.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()}},{key:"onTapThumbMove",value:function(e){if(this.isMouseDown){var t=this.refs.scroller,a=this.props.orientation===y.a.Orientation.Horizontal,i=a?e.clientX:e.clientY,n=a?"Left":"Top",r=a?"Width":"Height",s=i-this.lastY;this.lastY=i;var o=v.default.clamp(this.thumbTop.get()+s,0,t["client"+r]-this.thumbHeight.get());this.thumbTop.set(o);var l=o/(t["client"+r]-this.thumbExtraHeight)*t["scroll"+r];t["scroll"+n]=l,e.preventDefault()}}},{key:"onTapThumbEnd",value:function(e){this.isMouseDown&&e.button===y.a.ButtonCode.Left&&(this.isMouseDown=!1,v.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},{key:"hideTimeout",value:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)}},{key:"hideScrollbar",value:function(){this.isVisible.set(!1),this.timeoutHide=void 0}},{key:"showScrollbar",value:function(){this.calculateThumb(),this.isVisible.set(!0),this.timeoutShow=void 0}},{key:"getElement",value:function(){return this.refs.element}},{key:"getScrollElement",value:function(){return this.refs.scroller}},{key:"scrollTo",value:function(e,t,a){isNaN(a)&&(a=y.a.ScrollDuration.Default),v.default.scrollTo(e,t,a,this.refs.scroller)}},{key:"scrollToBottom",value:function(){var e=this.getClientHeight();this.scrollTo(0,e)}},{key:"render",value:function(){var e=this.state,t=this.props,a=(t.getScrollSize,t.getClientHeight,t.getScrollTop,t.noOwnScroll),i=t.showScrollbars,r=(t.trackHasScrolled,t.scrollable),o=(t.orientation,t.tinyMode),l=(t.onScroll,s()(t,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode","onScroll"])),u=t.orientation===y.a.Orientation.Horizontal,d=!1!==r&&!v.default.noScrollbars,c=v.default.classNames("fancyScroller flexbox",t.className,{"flexvert horizontal":u},{vertical:!u},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:o}),h=v.default.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),f=v.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),p={};u?(p.width=e.thumbHeight,p[k.a.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(p.height=e.thumbHeight,p[k.a.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var g=v.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:d}),m={};return m[t.orientation===y.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",S.a.createElement("div",n()({},l,{className:c,ref:"element"}),S.a.createElement("div",{className:g,style:m,ref:"scroller",onScroll:a?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!k.a.isFirefox&&d&&i&&S.a.createElement("div",{className:h,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},S.a.createElement("div",{className:f,style:p,ref:"thumb"})))}}]),t}(P.a);t.a=w},77:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0),l=function(){function e(){n()(this,e)}return s()(e,[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var e=0,t=0,a=0,i=this._ensureListeners(),n=arguments.length,r=new Array(n),s=0;s<n;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[s]=arguments[s]}for(var l=0;l<r.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{o.default.PAssert(124,"callbacks"!==r[l],"Invalid event name/grouping")}catch(d){o.default.reportError(d)}try{o.default.PAssert(125,o.default.isString(r[l])||o.default.isFunction(r[l]),"Only accept string or functions for listen")}catch(d){o.default.reportError(d)}i[r[l]]||(i[r[l]]={callbacks:[]}),i=i[r[l]]}var u=r[r.length-1];try{o.default.PAssert(126,o.default.isFunction(u),"Listeners must always be valid functions")}catch(d){o.default.reportError(d)}try{o.default.PAssert(127,i.callbacks.indexOf(u)<0,"Should never listen with the same function twice")}catch(d){o.default.reportError(d)}i.callbacks.push(u)}},{key:"isListening",value:function(){for(var e=0,t=0,a=0,i=this._ensureListeners(),n=arguments.length,r=new Array(n),s=0;s<n;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[s]=arguments[s]}var l=r[r.length-1];try{o.default.PAssert(128,o.default.isFunction(l),"Listeners must always be valid functions")}catch(d){o.default.reportError(d)}for(var u=0;u<r.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[r[u]]&&(i=i[r[u]])}return i&&i.callbacks&&i.callbacks.indexOf(l)>=0}},{key:"unlisten",value:function(){for(var e=0,t=0,a=0,i=this._ensureListeners(),n=arguments.length,r=new Array(n),s=0;s<n;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[s]=arguments[s]}var l=r[r.length-1];try{o.default.PAssert(129,o.default.isFunction(l),"Listeners must always be valid functions")}catch(d){o.default.reportError(d)}for(var u=0;u<r.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{o.default.PAssert(130,"callbacks"!==r[u],"Invalid event name/grouping")}catch(d){o.default.reportError(d)}try{o.default.PAssert(131,o.default.isString(r[u]),"Only accept string for unlisten")}catch(d){o.default.reportError(d)}try{o.default.PAssert(132,i[r[u]],"Cannot unlisten something that has never been listened")}catch(d){o.default.reportError(d)}i[r[u]]&&(i=i[r[u]])}try{o.default.PAssert(133,i&&i.callbacks&&i.callbacks.indexOf(l)>=0,"Cannot unlisten something that has never been listened")}catch(d){o.default.reportError(d)}i.callbacks&&i.callbacks.remove(l)}},{key:"fireEvent",value:function(){for(var e=0,t=0,a=0,i=!0,n=this._ensureListeners(),r=arguments.length,s=new Array(r),l=0;l<r;l++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;s[l]=arguments[l]}var u=s[s.length-1];try{o.default.PAssert(134,void 0===u||o.default.isArray(u),"Last argument to fireEvent must be an array")}catch(f){o.default.reportError(f)}for(var d=0;d<s.length-1;++d){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{o.default.PAssert(135,"callbacks"!==s[d],"Invalid event name/grouping")}catch(f){o.default.reportError(f)}try{o.default.PAssert(136,o.default.isString(s[d])||o.default.isArray(s[d]),"Only accept strings for firing event")}catch(f){o.default.reportError(f)}if(!n[s[d]])break;var c=0;n=n[s[d]];for(var h=0;h<n.callbacks.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;try{i=n.callbacks[h].apply(this,u)&&i}catch(p){o.default.reportError(p)}}}return i}}]),e}();t.a=l},78:function(e,t,a){"use strict";var i=a(12),n=a.n(i),r=a(22),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=/^<(.*)>$/,k=/^[^:]+(?=:)/,_=0,S={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}},P=function(){function e(t,a){l()(this,e),this._reportError=t,this._assert=a}return d()(e,[{key:"update",value:function(e){var t,a=e.decoded,i=e.resources,n=e.options,r=e.mimeType;return this._assert(i,"Must supply a valid resource lib"),this._assert(n,"Must supply a valid options obj"),"text/plain"===r?t=this._parsePlain(a):"text/html"===r?t=this._parseHTML(a,i,n):this._reportError(new Error("Unknown email mimeType"),"Unknown email mimeType: "+r),t?t.parsed=this._escapeHTMLEntities(t.parsed):t={parsed:void 0,missingResourceData:!0},t}},{key:"getAttachmentLinks",value:function(e){var t=e.decoded,a=e.options,i=[],n=this._createDoc(t);if(n){var r=this._findLinkElements(n),s=this._findQuoteElements(n);try{i=this._findSpecialLinks(r,s,a).attachments}catch(o){this._reportError(o)}}return i}},{key:"generatePlaintext",value:function(e){var t=e.decoded;return this._createDoc(t).body.textContent}},{key:"replaceSignature",value:function(e){var t,a=e.decoded,i=e.newSignature,n=this._createDoc(a),r=this._findActiveSignature(n);if(r){var s=!!r.innerHTML;if(r.innerHTML=i||"",i)s||(r.parentNode.insertBefore(n.createElement("br"),r),r.parentNode.insertBefore(n.createElement("br"),r),r.parentNode.insertBefore(n.createTextNode("--"),r),r.parentNode.insertBefore(n.createElement("br"),r));else{var o=r.previousSibling;if(o&&"BR"===o.nodeName){var l=o.previousSibling;if(l&&3===l.nodeType&&"--"===l.textContent){var u=l.previousSibling;if(u){var d=u.previousSibling;"BR"===u.nodeName&&(u.parentElement.removeChild(u),d&&"BR"===d.nodeName&&d.parentElement.removeChild(d))}o.parentElement.removeChild(o),l.parentElement.removeChild(l)}}}t=n.body.outerHTML}else t=a;return t}},{key:"combineParts",value:function(e){var t=e.partList;this._assert(this._isArray(t)&&t.length>0,"Must always supply a valid part list with contents");var a=this._createDoc("<head></head><body></body>");if(this._assert(a,"Must always be able to create a valid document for first part in list"),a)for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=this._ensurePartDoc(t[n]);if(r)try{this._mergeDocs(r,a)}catch(s){this._reportError(s)}}return a?a.body.outerHTML:" "}},{key:"removeElementsByAttribute",value:function(e){var t=e.decoded,a=e.attr,i=e.value;this._assert(this.isString(t),"Must pass in a valid decoded HTML email string"),this._assert(this.isString(a),"Must provide a valid item ID");var n=!1;try{var r=this._createDoc(t);r&&(n=this._removeElementsByAttribute(r,a,i))}catch(s){this._reportError(s)}return n?r.body.outerHTML:t}},{key:"sanitizeContent",value:function(e){var t,a=e.decoded;if(a){var i=this._createDoc(a);try{var n=i.body;this._traverseNode(n,function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")}),t=n.outerHTML}catch(r){this._reportError(r),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t}},{key:"getComposeBody",value:function(e){var t=e.decoded,a=e.resources,i=!1;try{var n=this._createDoc(t);if(n){i=this._removeElementsByAttribute(n,"moodoAttach","true");var r=this._updateResourceImages(n,a);i=i||r.didUpdate}}catch(s){this._reportError(s)}return i?n.body.outerHTML:t}},{key:"parseResourceID",value:function(e){var t;y.lastIndex=0;var a=y.exec(e);return a&&a[1]&&(t=a[1]),t}},{key:"_escapeHTMLEntities",value:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}},{key:"_ensurePartDoc",value:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:this._assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t}},{key:"_hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"_mergeDocs",value:function(e,t){var a=e.body,i=t.body;if(a){var n=t.importNode(a,!0),r=t.createElement("div");try{for(var s=0,o=0;o<n.attributes.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=n.attributes[o];r.setAttribute(l.name,l.value)}}catch(d){this._reportError(d)}try{for(var u=0;n.childNodes&&n.childNodes.length>0;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;r.appendChild(n.firstChild)}}catch(d){this._reportError(d)}try{i.appendChild(r)}catch(d){this._reportError(d)}}}},{key:"_removeElementById",value:function(e,t){var a=!1,i=e.getElementById(t);return i&&(i.parentNode.removeChild(i),a=!0),a}},{key:"_removeElementsByAttribute",value:function(e,t,a){var i,n=0,r=!1;i=void 0!==a&&null!==a?e.querySelectorAll("["+t+'="'+a+'"]'):e.querySelectorAll("["+t+"]");for(var s=0;s<i.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[s];o.parentNode.removeChild(o),r=!0}return r}},{key:"_createFragment",value:function(){return{lines:[],isQuote:!1}}},{key:"_createPlainFragments",value:function(e){var t=0,a=[],i=e.split("\n"),n=this._createFragment();a.push(n);for(var r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=i[r].trim(),o=new RegExp(/^>+/).test(s);n.lines.length>0&&o!==n.isQuote&&""!==s&&(n=this._createFragment(),a.push(n)),n.lines.push(s),n.isQuote=n.isQuote||o}return a}},{key:"_getFragmentText",value:function(e){var t,a,i=0,n="";if(e.isQuote){var r=this._generatePlaceholderID();t='<div id="'+r+'" place="true"></div><p quote="collapsed" group="'+r+'">',a="</p>"}else t="",a="";for(var s=0;s<e.lines.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n+=e.lines[s]+"\n"}return t+n+a}},{key:"_joinPlainFragments",value:function(e){for(var t=0,a="",i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[i];a+=this._getFragmentText(n)}return a}},{key:"_parsePlain",value:function(e){var t,a=this._escapeHTMLEntities(e),i=this._createPlainFragments(a);try{t=this._joinPlainFragments(i);t=t.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(n){this._reportError(n),t="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+t+"</body><html>"}}},{key:"_parseHTML",value:function(e,t,a){var i={parsed:void 0},n=this._createDoc(e),r=this._findQuoteElements(n);if(r=this._cleanupDocQuotes(n,r),this._isFullQuote(n,r)||this._collapseAndMarkQuotes(n,r,!!a.collapseQuotes),a.createLinksFromText)try{this._createLinksFromText(n)}catch(l){this._reportError(l)}var s=this._findLinkElements(n);this._markLinks(s);try{i.specialLinks=this._findSpecialLinks(s,r,a)}catch(l){this._reportError(l)}try{i.parsedMetadata=this._parseMetadata(n)}catch(l){this._reportError(l)}try{var o=this._updateResourceImages(n,t);i.missingResourceData=o.missingData}catch(l){this._reportError(l)}return this._trimTrailingWhitespace(n),this._trimQuoteWhitespace(r),i.parsed=n.body.outerHTML,i}},{key:"_traverseNode",value:function(e,t){if(!1!==t(e)&&e.childNodes)for(var a=0,i=e.childNodes.length-1;i>=0;i--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._traverseNode(e.childNodes[i],t)}}},{key:"_sanitizeInputDoc",value:function(e,t){var a=this,i=S[t],n=e.body;n&&this._traverseNode(n,function(e){if(e.nodeType===Node.COMMENT_NODE)a._assert(!e.childNodes||0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(i.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,n=i.allowedTagAttributes[e.tagName],r=e.attributes.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=e.attributes[r].name;if(i.allowedAttributes.indexOf(s)<0&&(!n||n.indexOf(s)<0))e.removeAttribute(s);else{var o=e.getAttribute(s);o&&o.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,s),e.removeAttribute(s))}}var l=e.getAttribute("height");l&&l.indexOf("%")>=0&&(e.removeAttribute("height"),console.log("Remove Height: ",e.tagName,l))}})}},{key:"_createDoc",value:function(e){var t,a=new DOMParser;try{if(t=a.parseFromString(e,"text/html")){var i=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),i&&i.length>0&&this._reportMetadata(t,i)}}catch(n){this._reportError(n);try{t=a.parseFromString("Error parsing email message","text/html")}catch(r){this._reportError(r)}}return t}},{key:"_updateResourceImages",value:function(e,t){for(var a=0,i={missingData:!1,didUpdate:!1},n=this._findImageElements(e),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n[r],o=s.src;if(o.startsWith("cid:")){var l=o.substr(4);if(l){s.setAttribute("cid",l);var u=t[l];if(u&&u.data){var d="data:"+u.mimeType+";base64,"+u.data;s.src=d,i.didUpdate=!0}else s.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0,u||(i.missingData=!0)}else s.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",i.didUpdate=!0}}return i}},{key:"_findImageElements",value:function(e){return e.querySelectorAll("img")}},{key:"_findLinkElements",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))}},{key:"_sanitizeLink",value:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink","true");var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else k.exec(t)||e.setAttribute("href","https://"+t)}}},{key:"_createLinksFromText",value:function(e){var t=e.body;this._traverseNode(t,function(t){var a=!0;if(t.nodeType===Node.TEXT_NODE){var i=t.textContent;if(i.indexOf("http")>=0||i.indexOf("www.")>=0){var n=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,r=t.textContent.replace(n,'<a href="$1">$1</a>'),s=e.createElement("div");s.innerHTML=r;var o=s.childNodes?s.childNodes.length:0;if(o>1||1===o&&"A"===s.childNodes[0].nodeName){for(var l=0;s.firstChild;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t.parentNode.insertBefore(s.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(a=!1);return a})}},{key:"_markLinks",value:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[a])}}},{key:"_isAttachmentURL",value:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)}},{key:"_findSpecialLinks",value:function(e,t,a){for(var i=0,n={unsubscribe:[],twitter:[],attachments:[]},r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=e[r];s.href&&this._isAttachmentURL(s.href)&&(a.ignoreQuotedAttachments&&this._isInsideQuote(s,t)||n.attachments.push({href:s.href,cid:s.id,name:s.innerText,type:"application/octet-stream"}))}return n}},{key:"_parseMetadata",value:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t}},{key:"_reportMetadata",value:function(e,t){}},{key:"_parseJSONLD",value:function(e){for(var t=0,a=[],i=e.getElementsByTagName("script"),n=0;n<i.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=i[n];if("application/ld+json"===r.getAttribute("type")){var s=r.textContent.trim();if(s)try{var o=JSON.parse(s);a.push(o)}catch(l){this._reportError(new Error("Invalid JSONLD Schema String"),s)}}}return a}},{key:"_parseMicrodata",value:function(e){var t=this,a=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(a,function(e){if(!e.hasAttribute("itemprop"))return t._parseMicrodataScope(e)}).filter(function(e){return!!e})}},{key:"_parseMicrodataScope",value:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t}},{key:"_recurseMicrodataScope",value:function(e,t){for(var a=0,i=t.children,n=0;n<i.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=i[n];if(r.hasAttribute("itemprop")){var s,o=r.getAttribute("itemprop");if(r.hasAttribute("itemscope"))s=this._parseMicrodataScope(r);else switch(r.tagName.toLowerCase()){case"a":case"area":case"link":s=r.getAttribute("href");break;case"meta":s=r.getAttribute("content");break;case"img":s=r.getAttribute("src");break;case"data":case"meter":s=r.getAttribute("value");break;case"time":s=r.getAttribute("datetime");break;default:s=r.hasAttribute("content")?r.getAttribute("content"):r.textContent}o&&s&&(e.properties[o]=s)}else this._recurseMicrodataScope(e,r)}}},{key:"_cleanupDocQuotes",value:function(e,t){var a=this;return t.filter(function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(a.parseResourceID(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t})}},{key:"_generatePlaceholderID",value:function(){return"~T"+Date.now()+ ++_}},{key:"_createQuotePlaceholder",value:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place","true"),t}},{key:"_findFirstSiblingQuote",value:function(e,t){for(var a=0,i=e;i.previousElementSibling&&t.indexOf(i.previousElementSibling)>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=i.previousElementSibling}return i}},{key:"_markAdjacentQuotes",value:function(e,t,a,i){for(var n=0;e&&a.indexOf(e)>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.setAttribute("quote",i),e.setAttribute("group",t),e=e.nextElementSibling}}},{key:"_collapseAndMarkQuotes",value:function(e,t,a){for(var i=0,n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var r=t[n];if(!r.getAttribute("quote")){var s=this._findFirstSiblingQuote(r,t),o=this._createQuotePlaceholder(e),l=0===n&&a?"collapsed":"uncollapsed";this._markAdjacentQuotes(s,o.id,t,l),s.parentNode.insertBefore(o,r)}}}},{key:"_removeQuote",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"_isFullQuote",value:function(e,t){for(var a=0,i=!0,n=e.body,r=0;n.childNodes&&r<n.childNodes.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n.children[r];if(""!==s.textContent.trim()&&t.indexOf(s)<0&&t.indexOf(s.firstElementChild)<0){i=!1;break}}return i}},{key:"_findQuoteElements",value:function(e){var t=this._findGmailQuotes(e),a=this._findOffice365Quotes(e),i=this._findBlockquoteQuotes(e),n=[];return this.pushOnlyUniques(n,t),this.pushOnlyUniques(n,a),this.pushOnlyUniques(n,i),n=this._cleanupGmail(n),n=this._removeEmptyQuotes(n)}},{key:"_cleanupGmail",value:function(e){var t=this;return e.filter(function(a){var i=!1;if("BLOCKQUOTE"===a.nodeName&&t._hasClass(a,"gmail_quote"))for(var n=0,r=0;r<e.length;++r){var s=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var o=a.parentElement;o;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(t._hasClass(o,"gmail_quote")){"DIV"===o.nodeName&&(i=!0);break}o=o.parentElement}}return!i})}},{key:"_removeEmptyQuotes",value:function(e){return e}},{key:"_findGmailQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))}},{key:"_findOffice365Quotes",value:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),a=e.getElementById('3D"divRplyFwdMsg"');return a&&t.push(a),t=t.map(function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e})}},{key:"_findBlockquoteQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))}},{key:"_findGmailSignatures",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))}},{key:"_findActiveSignature",value:function(e){for(var t,a=0,i=this._findGmailSignatures(e),n=this._findQuoteElements(e),r=i.length-1;r>=0&&!t;r--){var s=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var o=i[r],l=!0,u=0;u<n.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(this._isAncestor(o,n[u])){l=!1;break}}l&&(t=o)}return t}},{key:"_isAncestor",value:function(e,t){for(var a=0;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentElement}return!!e}},{key:"_trimTrailingWhitespace",value:function(e){for(var t=0,a=e.body.childNodes,i=[],n=a.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=a[n],s=a[n-1];if(!r||"BR"!==r.nodeName||!s||"BR"!==s.nodeName)break;i.push(r)}this._removeElements(i)}},{key:"_trimQuoteWhitespace",value:function(e){for(var t=0,a=[],i=0;i<e.length;++i){var n=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var r=e[i].previousElementSibling;r;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;"BR"===r.nodeName&&r.previousElementSibling&&"BR"===r.previousElementSibling.nodeName&&a.push(r),r=r.previousElementSibling}}this._removeElements(a)}},{key:"_removeElements",value:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[a];try{i.parentNode&&i.parentNode.removeChild(i)}catch(n){}}}},{key:"_isInsideQuote",value:function(e,t){for(var a=0;e.parentNode;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},{key:"_isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"pushOnlyUniques",value:function(e,t,a){var i=0;if(!t)return e;for(var n=0,r=t.length;n<r;++n){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=!0,l=0,u=e.length;l<u;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a&&a(t[n],e[l])||!a&&t[n]===e[l]){o=!1;break}}o&&e.push(t[n])}return e}}]),e}(),w=function(e){function t(){var e;return l()(this,t),(e=h()(this,p()(t).call(this))).helper=new P(v.default.reportError,v.default.Assert),e}return m()(t,e),d()(t,[{key:"update",value:function(){var e=s()(n.a.mark(function e(t,a,i,r){return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.update({decoded:t,resources:a,options:i,mimeType:r}));case 1:case"end":return e.stop()}}},e,this)}));return function(t,a,i,n){return e.apply(this,arguments)}}()},{key:"getAttachmentLinks",value:function(){var e=s()(n.a.mark(function e(t,a){return n.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getAttachmentLinks({decoded:t,options:a}));case 1:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"generatePlaintext",value:function(){var e=s()(n.a.mark(function e(t){return n.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.generatePlaintext({decoded:t}));case 1:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceSignature",value:function(){var e=s()(n.a.mark(function e(t,a){return n.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.replaceSignature({decoded:t,newSignature:a}));case 1:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"combineParts",value:function(){var e=s()(n.a.mark(function e(t){return n.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.combineParts({partList:t}));case 1:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeElementsByAttribute",value:function(){var e=s()(n.a.mark(function e(t,a,i){return n.a.wrap(function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.removeElementsByAttribute({decoded:t,attr:a,value:i}));case 1:case"end":return e.stop()}}},e,this)}));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"sanitizeContent",value:function(){var e=s()(n.a.mark(function e(t){return n.a.wrap(function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.sanitizeContent({decoded:t}));case 1:case"end":return e.stop()}}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getComposeBody",value:function(){var e=s()(n.a.mark(function e(t,a){return n.a.wrap(function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getComposeBody({decoded:t,resources:a}));case 1:case"end":return e.stop()}}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}]),t}(function(){function e(){l()(this,e)}return d()(e,[{key:"sanitizePlaintext",value:function(e){return e?/^\s*$/.test(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"}}]),e}());t.a=new w},8:function(e,t,a){"use strict";a.d(t,"b",function(){return l}),a.d(t,"a",function(){return u}),a.d(t,"c",function(){return d});var i=a(0),n=a(3),r=a(1),s=a(23),o=a(17),l={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},u={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},d={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5,OpenDisplaySettings:6};function c(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],s.a.binder(this,"stateChangeForUndoRedo"),this.init()}function h(e){var t=e[0],a=o.a.getItem(t.oldItemID),n=i.default.focusedPane;try{i.default.PAssert(452,a,"Expected model to exist: ",t)}catch(r){i.default.reportError(r)}if(t.zoomIn)n.zoomOut(a);else if(t.zoomOut)n.zoomIn(a);else try{i.default.PAssert(453,!1,"Zoom action must define either zoomIn or zoomOut")}catch(r){i.default.reportError(r)}}function f(e){var t=e[0],a=o.a.getItem(t.itemID),n=i.default.focusedPane;try{i.default.PAssert(454,a,"Expected model to exist: ",t)}catch(r){i.default.reportError(r)}if(t.zoomIn)n.zoomOut(a);else if(t.zoomOut)n.zoomIn(a);else try{i.default.PAssert(455,!1,"Zoom action must define either zoomIn or zoomOut")}catch(r){i.default.reportError(r)}}function p(e){switch(e[0].type){case d.RemovePane:case d.SwitchPaneMode:break;default:try{i.default.PAssert(456,!1,"Invalid UIAction")}catch(t){i.default.reportError(t)}}}function g(e){}c.prototype={init:function(){this.listeners=[]},addListener:function(e){this.listeners.push(e)},removeListener:function(e){this.listeners.remove(e)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var e=this._useNextGroupID();return this.groups.push({id:e,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),e},_doAction:function(e,t){var a=this._getCurrentGroup();try{i.default.PAssert(457,a,"Expected group to exist")}catch(r){i.default.reportError(r)}var n={type:e,data:t};switch(e){case l.Zoom:n.cb={undo:h,redo:f};break;case l.UIAction:n.cb={undo:p,redo:g}}a.events.push(n)},_handleGroupTrimmed:function(e){for(var t=0,a=0;a<e.events.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.events[a];switch(n.type){case l.Insert:case l.Remove:case l.Create:case l.Delete:case l.Move:case l.Update:case l.Format:case l.Zoom:case l.UIAction:break;default:try{i.default.PAssert(459,!1,"Expected TrackerType, received: ",n.type)}catch(r){i.default.reportError(r)}}}},_mergeAction:function(e,t){i.default.log("Tracker Action Merged: ",e,t);var a=this._getCurrentAction();try{i.default.PAssert(460,a,"Expected action to exist")}catch(n){i.default.reportError(n)}switch(e){case l.Insert:case l.Remove:case l.Create:case l.Delete:case l.Move:case l.Update:break;case l.Format:try{i.default.PAssert(461,!1,"Formats cannot be merged")}catch(n){i.default.reportError(n)}break;case l.Zoom:try{i.default.PAssert(462,!1,"Zooms cannot be merged")}catch(n){i.default.reportError(n)}break;case l.UIAction:try{i.default.PAssert(463,!1,"UIActions cannot be merged")}catch(n){i.default.reportError(n)}break;default:try{i.default.PAssert(464,!1,"Expected TrackerType, received: ",e)}catch(n){i.default.reportError(n)}}},_canMerge:function(e){var t=!1,a=this._getCurrentGroup();return a&&a.events.length>0&&(a.events[a.events.length-1].type===e?e===l.Insert&&(t=!0):t=!1),t},_canCombine:function(e,t){var a=this._getCurrentGroup();return a&&(a.id===t||0===a.events.length)},performActions:function(e){try{i.default.PAssert(465,!this.disabled||n.default.intro,"Can only perform actions when enabled or during the intro")}catch(o){i.default.reportError(o)}try{i.default.PAssert(466,!this._performingActions,"Can not nest performing actions")}catch(o){i.default.reportError(o)}if(this._performingActions=!0,e&&e.length>0){var t,a=0;if(!this.disabled)this.cursor!==this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),t=this._pushGroup()):t=this._getNextGroupID();for(var r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e[r];this.fireActionEvent(s),this.disabled||(this._canCombine(s.type,t)?this._canMerge(s.type)?this._mergeAction(s.type,s.data):this._doAction(s.type,s.data):(t=this._pushGroup(),this._doAction(s.type,s.data)))}}this._performingActions=!1},beginAction:function(e){try{i.default.PAssert(467,!this._performingActions,"Should never begin an action while replaying old actions")}catch(t){i.default.reportError(t)}if(0===this._aggregateActions){this._actionsPreventUndo=!!e;try{i.default.PAssert(468,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(t){i.default.reportError(t)}}else i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("  -- Beginning Nested Action --");this._aggregateActions++},performAction:function(e,t){try{i.default.PAssert(469,!this._performingActions,"Should never perform an action while replaying old actions")}catch(s){i.default.reportError(s)}var a=!i.default.isLoaded||i.default.isLoadingRemote;this.disabled?n.default.intro?a?i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("Skipping Action For Intro: ",e,t):(i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("Performing Action For Intro: ",e,t),this.performActions([{type:e,data:[t]}])):i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("Performing Disabled Action: ",e,t):(i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("Performing Action: ",e,t),this._aggregateActions?this._currentAction.push({type:e,data:[t]}):this.performActions([{type:e,data:[t]}]))},endAction:function(){try{i.default.PAssert(470,!this._performingActions,"Should never end an action while replaying old actions")}catch(e){i.default.reportError(e)}try{i.default.PAssert(471,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(e){i.default.reportError(e)}1===this._aggregateActions?(this.disabled&&!n.default.intro||this.performActions(this._currentAction),this._currentAction.length=0,this._actionsPreventUndo=!1):i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("  -- Ending Nested Action --"),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},notifyStateChangedFromUndoRedo:function(e,t){try{i.default.PAssert(472,this.undoRedoActive)}catch(a){i.default.reportError(a)}i.default.shouldLog(r.a.LogLevels.Tracker)&&i.default.log("Tracker notified of state change: ",t),this._externalStateChanged.push({type:e,data:t})},miscAction:function(e){this.fireActionEvent(e)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(e){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=e.canRedo,this.canUndo=e.canUndo},fireActionEvent:function(e){try{if(e.data||(e.data={}),this.listeners)for(var t=0,a=0;a<this.listeners.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.listeners[a](e)}}catch(n){i.default.reportError(n)}}},t.d=new c},81:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(1),g=a(2),m=a.n(g),v=a(15),y=a(21),k=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"init",value:function(){var e={animCheck:!1};this.props.checked instanceof v.a?(this.checked=this.props.checked,this.trackObservable=!0):e.checked=this.props.checked||this.props.initialChecked,this.createObservables(e)}},{key:"getState",value:function(){return this.trackObservable?{checked:this.checked}:{}}},{key:"onClick",value:function(){var e=this.props;if(!e.disabled){this.animCheck.set(!0),setTimeout(function(){this.animCheck.set(!1)}.bind(this),300);var t=!this.checked.get();this.trackObservable&&!e.setObs||this.checked.set(t),e.onChange&&e.onChange(t)}e.onClick&&e.onClick(t)}},{key:"getValue",value:function(){return this.checked.get()}},{key:"setValue",value:function(e){return this.checked.set(e)}},{key:"resetValue",value:function(){void 0!==this.props.initialChecked&&this.checked.set(this.props.initialChecked)}},{key:"onKeyDown",value:function(e){e.keyCode===p.a.KeyCode.Enter&&this.onClick()}},{key:"onChangeInput",value:function(){}},{key:"componentWillReceiveProps",value:function(e){this.trackObservable||void 0===e.checked||e.checked===this.state.checked||this.checked.set(e.checked)}},{key:"getElement",value:function(){return this.refs.element}},{key:"getChildren",value:function(){return this.props.children}},{key:"render",value:function(){var e=this.props,t=this.state.checked,a={background:t&&e.checkedColor,width:e.size,height:e.size,lineHeight:e.size&&e.size-1+"px",fontSize:e.size&&e.size-4+"px"},i=f.default.classNames("fancyCheckbox",{checked:t},{disabled:e.disabled},{animate:this.state.animCheck},{radio:e.radio},{error:e.error},{noBG:e.noBG},e.className),n=f.default.classNames("fancyCheckboxText"),r=f.default.classNames("fancyCheckboxCheck",{"c-button-raised-primary":t&&!e.disabled}),s=m.a.createElement("span",{className:r,style:a});return m.a.createElement("span",{className:i,onClick:!1!==e.canChange?this.onClick:void 0,id:e.id,style:e.style,tabIndex:e.tabIndex,onKeyDown:this.onKeyDown,ref:"element"},m.a.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:t||!1,onChange:this.onChangeInput}),s,this.props.children&&m.a.createElement("span",{className:n},this.props.children))}}]),t}(y.a);t.a=k},84:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(0);if(!window.TextEncoder||!window.TextDecoder){var l=a(717);window.TextEncoder=l.TextEncoder,window.TextDecoder=l.TextDecoder}var u=function(){function e(){n()(this,e),this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return s()(e,[{key:"ab2str",value:function(e){var t="";try{var a=new Uint8Array(e);if(a.length>1e5){var i,n,r,s=0;for(i=0,n=a.length;i<n;i+=1e5){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;r=a.slice(i,i+1e5),t+=String.fromCharCode.apply(null,r)}}else t=String.fromCharCode.apply(null,a)}catch(l){o.default.reportError(l)}return t}},{key:"str2ab",value:function(e){for(var t=0,a=new ArrayBuffer(e.length),i=new Uint8Array(a),n=0,r=e.length;n<r;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[n]=e.charCodeAt(n)}return i}},{key:"unicode2ab",value:function(e){return this.textEncoder.encode(e)}},{key:"ab2unicode",value:function(e){return this.textDecoder.decode(e)}}]),e}();t.a=new u},89:function(e,t,a){"use strict";var i=a(68),n=a.n(i),r=a(82),s=a.n(r),o=a(5),l=a.n(o),u=a(6),d=a.n(u),c=a(10),h=a.n(c),f=a(9),p=a.n(f),g=a(11),m=a.n(g),v=a(0),y=a(2),k=a.n(y),_=a(88),S=a.n(_),P=a(21),w=function(e){function t(){return l()(this,t),h()(this,p()(t).apply(this,arguments))}return m()(t,e),d()(t,[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"getElement",value:function(){return S.a.findDOMNode(this)}},{key:"onMouseDown",value:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var a,i,n=this.refs.element,r=n.offsetWidth,s=n.offsetHeight,o=Math.min(r,s);if(this.props.center)a="50%",i="50%";else{var l=v.default.offset(n);a=e.clientX-l.left,i=e.clientY-l.top}var u={id:this.rippleNum++,left:a,top:i,width:o,height:o};this.ripples.push(u),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}}},{key:"onRightClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props,i=[],r=0;r<t.ripples.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=t.ripples[r],l={left:o.left,top:o.top,width:o.width,height:o.height,marginLeft:-o.width/2,marginTop:-o.height/2};i.push(k.a.createElement("div",{key:"ripple_"+o.id,className:"fancyRipple",style:l}))}var u=v.default.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),d=(a.center,a.onClick),c=(a.enabled,a.ripple,a.onRightClick),h=s()(a,["center","onClick","enabled","ripple","onRightClick"]);return k.a.createElement("div",n()({},h,{className:u,onMouseDown:this.onMouseDown,onClick:d,onContextMenu:c?this.onRightClick:void 0,ref:"element"}),this.props.children,i.length>0&&k.a.createElement("div",{className:"fancyRipples"},i))}}]),t}(P.a);t.a=w},98:function(e,t,a){"use strict";var i=a(5),n=a.n(i),r=a(6),s=a.n(r),o=a(10),l=a.n(o),u=a(9),d=a.n(u),c=a(11),h=a.n(c),f=a(0),p=a(2),g=a.n(p),m=function(e){function t(){return n()(this,t),l()(this,d()(t).apply(this,arguments))}return h()(t,e),s()(t,[{key:"render",value:function(){var e=this.props,t=e.style,a=e.size,i=e.left,n=e.top,r=e.center,s=e.inline,o=e.color,l=e.children;t=Object.assign({},t);var u=(a=a||20)||20,d={fontSize:a,height:u,width:u,lineHeight:u+"px",color:o};(n||i)&&(t.position="absolute",t.left=i||"50%",t.top=n||"50%",d.marginLeft=-a/2,d.marginTop=-a/2+20);var c=f.default.classNames("fancyLoader",{center:r},{inline:s}),h={color:o};return g.a.createElement("div",{className:c,style:t},g.a.createElement("div",{className:"icon-spinner",style:d}),l&&g.a.createElement("div",{className:"fancyLoaderText",style:h},l))}}]),t}(a(21).a);t.a=m}});
