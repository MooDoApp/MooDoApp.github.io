(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{595:function(e,r,t){"use strict";t.r(r);var o=t(0),i=t(1),a=t(14),n=t(25),s=t(6),l=t(91),d=t(4),c=t(542),u=t.n(c),f=t(37),h=t(63);function p(){this.workflowy={login:this.workflowyLogin.bind(this),import:this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),import:this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),import:this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),import:this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),import:this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={preload:this.trelloPreload.bind(this),login:this.trelloLogin.bind(this),import:this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.todoist={login:this.todoistLogin.bind(this),import:this.todoistImport.bind(this),save:this.todoistSave.bind(this)}}function m(e){return e.toString(d.default.International.getFormat(i.a.DFormat.MonthDay))}p.prototype={workflowyLogin:function(e,r,t,a){try{o.default.PAssert(1628,t,"Workflowy requires a success callback")}catch(n){o.default.reportError(n)}try{o.default.PAssert(1629,a,"Workflowy requires an error callback")}catch(n){o.default.reportError(n)}return e?r?void o.default.XHR_PrivateAPI({type:"POST",path:"/oauth/workflowy",data:{username:e,password:r},cb:function(e){if(o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("Workflowy Login Response: ",e),200===e.status){try{var r=JSON.parse(e.response);this.workflowy.data=JSON.parse(r.data)}catch(l){return o.default.reportError(l),a("Error parsing successful response from server. The developers have been notified with details of the error.")}return!this.workflowy.data||this.workflowy.data.error?a("Invalid username or password."):t()}var n;o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+e.status);try{var s=JSON.parse(e.response);switch(s.code){case i.a.PrivateAPIErrorCodes.InvalidParameter:n="Must specify a username and password.";break;case i.a.PrivateAPIErrorCodes.UnauthorizedUser:n="Invalid username or password.";break;case i.a.PrivateAPIErrorCodes.ErrorContactingRemote:n=s.data;break;default:n="Error contacting server. The developers have been notified with details of the error."}}catch(l){n="Error parsing error response from server. The developers have been notified with details of the error.",o.default.reportError(l)}return a(n)}.bind(this)}):a("Must provide a password."):a("Must provide a valid username.")},workflowyImport:function(e,r){try{o.default.PAssert(1630,e,"Workflowy requires a success callback")}catch(t){o.default.reportError(t)}try{o.default.PAssert(1631,r,"Workflowy requires an error callback")}catch(t){o.default.reportError(t)}return e(this.workflowy.data)},workflowyReplaceFormatting:function(e){return e.replace(/<b>|<\/b>/g,"**").replace(/<i>|<\/i>/g,"*").replace(/<u>|<\/u>/g,"__")},workflowyIterateItem:function(e,r){try{o.default.PAssert(1632,e&&void 0!==e.nm,"All items must exist and have stars and text, children and notes are optional",e)}catch(h){o.default.reportError(h)}try{o.default.PAssert(1634,r,"A valid parent must always be defined")}catch(h){o.default.reportError(h)}if(e&&r)try{var t=!!e.cp;if(!t){var n=i.a.Prefix.Bullet+" "+o.default.unescape(this.workflowyReplaceFormatting(e.nm)),s=a.a.createVMLI({text:n,isComplete:t},{parent:r,changeType:i.a.ChangeType.AllLocal});if(r.insertItem(s),e.no){var l=o.default.unescape(e.no),d=a.a.createVMLI({text:l,isNote:!0},{parent:s,changeType:i.a.ChangeType.AllLocal});s.setNote(d,i.a.ChangeType.Local)}if(e.ch)for(var c=0,u=0;u<e.ch.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=e.ch[u];this.workflowyIterateItem(f,s)}}}catch(p){throw o.default.reportError(p),p}},workflowySave:function(e,r,t){try{o.default.PAssert(1635,e,"Workflowy requires having valid data")}catch(h){o.default.reportError(h)}try{o.default.PAssert(1636,r,"Workflowy requires a success callback")}catch(h){o.default.reportError(h)}try{o.default.PAssert(1637,t,"Workflowy requires an error callback")}catch(h){o.default.reportError(h)}try{try{o.default.PAssert(1638,e.projectTreeData,"Missing Workflowy projectTreeData")}catch(h){o.default.reportError(h)}try{o.default.PAssert(1639,e.projectTreeData.mainProjectTreeInfo,"Missing Workflowy mainProjectTreeInfo")}catch(h){o.default.reportError(h)}var n=e.projectTreeData.mainProjectTreeInfo;try{o.default.PAssert(1640,n.rootProjectChildren,"Missing Workflowy rootProjectChildren")}catch(h){o.default.reportError(h)}s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var l=a.a.createEmptyDocument("Workflowy import").getRootItem();try{o.default.PAssert(1641,l,"Root item must exist in order to import")}catch(h){o.default.reportError(h)}try{for(var c=0,u=0;u<n.rootProjectChildren.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=n.rootProjectChildren[u];this.workflowyIterateItem(f,l)}o.default.vmMain.parseSubtree(l,i.a.ChangeType.Local|i.a.ChangeType.All)}catch(p){return o.default.reportError(p),t("There was an error iterating your Workflowy items. The developers have been notified with daetails of the error.",p)}return d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction(),r()}catch(m){return o.default.reportError(m),t("There was an error parsing your Workflowy data. The developers have been notified with details of the error.",m)}},wunderlistLogin:function(e,r,t,a){try{o.default.PAssert(1642,t,"Wunderlist requires a success callback")}catch(u){o.default.reportError(u)}try{o.default.PAssert(1643,a,"Wunderlist requires an error callback")}catch(u){o.default.reportError(u)}var n="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",s=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=n;var l="Dchs"+(new Date).getTime(),d="https://www.wunderlist.com/oauth/authorize?client_id="+n+"&redirect_uri="+s+"&state="+l;window.open(d,"modal-wunderlist","height=600,width=550");var c=function(e){var r=o.default.getLocationOrigin(),n=!1;try{n=e.data.state===l}catch(d){o.default.reportError(d)}if(r&&n)if(window.removeEventListener("message",c),e.data.error)a("Error authenticating with Wunderlist");else{var s=e.data.code;s&&o.default.XHR_PrivateAPI({type:"POST",path:"/oauth/wunderlist",data:{code:s},requireAuth:!0,cb:function(e){if(o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("Wunderlist Login Reponse: ",e),200===e.status){try{var r=JSON.parse(e.response).data;this.wunderlist.token=r.access_token}catch(d){a("Error parsing response from remote server.",d)}this.wunderlist.token?t():a("Invalid username or password.")}else a("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",c)},wunderlistImport:function(e,r){var t=this;try{o.default.PAssert(1644,e,"Wunderlist requires a success callback")}catch(s){o.default.reportError(s)}try{o.default.PAssert(1645,r,"Wunderlist requires an error callback")}catch(s){o.default.reportError(s)}var a={inbox:{title:"inbox",items:{},p:0}},n=0;this.wunderlistGetLists(function(s){var l=0;o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("Get ListData Response: ",s);for(var d=function(){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=s[c];a[d.id]={title:d.title,items:{},p:d.position},t.wunderlistGetTasks(d.id,function(l){var c=0;o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("Get TaskData Response: ",l);for(var u=0;u<l.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=l[u];if(f.parent_id){var h=a[f.list_id].items[f.parent_id];h?(h.items||(h.items=[]),h.items.push(f)):a[f.list_id].items[f.parent_id]={items:[f]}}else{var p=a[f.list_id].items[f.id];a[f.list_id].items[f.id]=f,p&&(a[f.list_id].items[f.id].items=p.items)}}t.wunderlistGetSubtasks(d.id,function(r){for(var t=0,o=0;o<r.length;++o){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=r[o],l=a[i.list_id];if(l)if(i.parent_id){var d=l.items[i.parent_id];d?(d.items||(d.items=[]),d.items.push(i)):l.items[i.parent_id]={items:[i]}}else{var c=l.items[i.id];l.items[i.id]=i,c&&(l.items[i.id].items=c.items)}}++n===s.length&&e(a)},r)},r)},c=0;c<s.length;++c)d()},r)},wunderlistGetLists:function(e,r){try{o.default.PAssert(1646,e,"Wunderlist requires a success callback")}catch(t){o.default.reportError(t)}try{o.default.PAssert(1647,r,"Wunderlist requires an error callback")}catch(t){o.default.reportError(t)}o.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(t){if(200===t.status){var a;try{a=JSON.parse(t.response)}catch(n){r("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",n)}e(a)}else o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+t.status),r("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(e,r,t){try{o.default.PAssert(1648,r,"Wunderlist requires a success callback")}catch(a){o.default.reportError(a)}try{o.default.PAssert(1649,t,"Wunderlist requires an error callback")}catch(a){o.default.reportError(a)}o.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var a=JSON.parse(e.response);r(a)}else o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+e.status),t("Error contacting remote server.")}.bind(this)})},wunderlistGetSubtasks:function(e,r,t){try{o.default.PAssert(1650,r,"Wunderlist requires a success callback")}catch(a){o.default.reportError(a)}try{o.default.PAssert(1651,t,"Wunderlist requires an error callback")}catch(a){o.default.reportError(a)}o.default.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+e,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function(e){if(200===e.status){var a=JSON.parse(e.response);r(a)}else o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+e.status),t("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(e,r,t){try{o.default.PAssert(1652,r,"Wunderlist requires a success callback")}catch(l){o.default.reportError(l)}try{o.default.PAssert(1653,t,"Wunderlist requires an error callback")}catch(l){o.default.reportError(l)}try{s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var n=a.a.createEmptyDocument("Wunderlist import").getRootItem();try{o.default.PAssert(1654,n,"Root item must exist in order to import")}catch(l){o.default.reportError(l)}Object.keys(e).forEach(function(r){var t=e[r];o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("List: ",t);var s=t.title,l=a.a.createVMLI({text:s},{parent:n,changeType:i.a.ChangeType.AllLocal});n.insertItem(l,0),Object.keys(t.items).forEach(function(e){var r=t.items[e];o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("  Task: ",r);var n=a.a.createVMLI({text:r.title,isComplete:!!r.completed_at,dateCompleted:r.completed_at,isStarred:r.starred},{parent:l,changeType:i.a.ChangeType.AllLocal});if(l.insertItem(n),r.note){var s=a.a.createVMLI({text:r.note},{parent:n,changeType:i.a.ChangeType.AllLocal});n.insertItem(s)}if(r.items)for(var d=0,c=0;c<r.items.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var u=r.items[c];o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("    SubTask: ",u);var f=a.a.createVMLI({text:u.title,isComplete:!!u.completed_at,dateCompleted:u.completed_at,isStarred:u.starred},{parent:n,changeType:i.a.ChangeType.AllLocal});n.insertItem(f)}})}),o.default.vmMain.parseSubtree(n,i.a.ChangeType.Local|i.a.ChangeType.All),d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction(),r()}catch(c){t(void 0,c)}},opmlLogin:function(e,r,t,i){try{o.default.PAssert(1655,t,"OPML requires a success callback")}catch(n){o.default.reportError(n)}try{o.default.PAssert(1656,i,"OPML requires an error callback")}catch(n){o.default.reportError(n)}var a=document.getElementById("importFileUploadButton");a.onchange=t,a.click()},opmlImport:function(e,r){try{o.default.PAssert(1657,e,"OPML requires a success callback")}catch(n){o.default.reportError(n)}try{o.default.PAssert(1658,r,"OPML requires an error callback")}catch(n){o.default.reportError(n)}try{var t=new FileReader,i=document.forms.importFileUpload.importFile.files[0];i?(t.onload=function(t){var i,c=t.target.result;if((c.startsWith("<?xml ")||c.startsWith("<?opml ")||c.startsWith("<opml "))&&(i=o.default.loadXML(c)),i){s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var u=a.a.createEmptyDocument("OPML import").getRootItem();try{o.default.PAssert(1659,u,"Root item must exist in order to import")}catch(n){o.default.reportError(n)}var f=l.a.parseOPML(i,u);d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction(),f?e():r("Error parsing OPML. Please validate your data.")}else r("Unable to load XML lib. Please update or try another browser.")},t.onerror=r,t.readAsText(i)):r("You must select a file before importing.")}catch(c){r(void 0,c)}},opmlSave:function(e,r,t){try{o.default.PAssert(1660,r,"OPML requires a success callback")}catch(a){o.default.reportError(a)}try{o.default.PAssert(1661,t,"OPML requires an error callback")}catch(a){o.default.reportError(a)}o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("OPML Save: ",e),r()},jsonLogin:function(e,r,t,i){try{o.default.PAssert(1662,t,"JSON requires a success callback")}catch(s){o.default.reportError(s)}try{o.default.PAssert(1663,i,"JSON requires an error callback")}catch(s){o.default.reportError(s)}var a=document.getElementById("importFileUploadButton"),n=!1;a.onchange=function(e){n=!0,t(e)},a.click();document.body.onfocus=function(){setTimeout(function(){n||i(!1),document.body.onfocus=void 0},1e3)}},jsonImport:function(e,r){try{var t=new FileReader,o=document.forms.importFileUpload.importFile.files[0];o?(t.onload=function(t){var o=t.target.result;if(!o)return r("Unable to import your requested file. Please try a different file.");try{var i=JSON.parse(o)}catch(c){return r("The JSON is not properly formatted. Please re-validate or send the file to support@moo.do.")}try{l.a.parseJSON(i,!0).then(function(t){if(t){t.text=t.text||"Imported document",s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems(),t.items&&t.items.forEach(function(e){n.a.cacheItem(e)});var o=h.a.create(t);a.a.addDocument(o),d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction()}return t?e():r("Invalid JSON format. The developers have been notified with details of the error.")})}catch(u){return r("The JSON file has errors. The developers have been notified with details of the error.",u)}},t.onerror=r,t.readAsText(o)):r("You must select a file before importing.")}catch(i){r(void 0,i)}},jsonSave:function(e,r,t){try{o.default.PAssert(1664,r,"JSON requires a success callback")}catch(i){o.default.reportError(i)}try{o.default.PAssert(1665,t,"JSON requires an error callback")}catch(i){o.default.reportError(i)}r()},gtasksLogin:function(e,r,t,a){var n=this;try{o.default.PAssert(1670,t,"GTasks requires a success callback")}catch(s){o.default.reportError(s)}try{o.default.PAssert(1671,a,"GTasks requires an error callback")}catch(s){o.default.reportError(s)}f.a.authAccountTemp([i.a.GScope.TasksRO],function(e){e&&!e.error?(n.gtasks.token=e,t(e)):(o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("Error getting Google TaskRO permission: ",e),a("Unable to authenticate with Google. Please try again.",e))})},gtasksImport:function(e,r){try{o.default.PAssert(1672,e,"GTasks requires a success callback")}catch(i){o.default.reportError(i)}try{o.default.PAssert(1673,r,"GTasks requires an error callback")}catch(i){o.default.reportError(i)}var t={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(a){var n=0;try{o.default.PAssert(1674,o.default.isArray(a),"List data must be an array")}catch(i){o.default.reportError(i)}for(var s=a.length,l=0,d=0;d<a.length;++d){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=a[d];t.remoteItems[c.id]={id:c.id,text:c.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},t.roots.push(c.id),this.gtasksGetTasks(c,function(a,n){if(a){try{o.default.PAssert(1675,o.default.isArray(a),"List data must be an array")}catch(i){o.default.reportError(i)}if(o.default.isArray(a)){for(var d=0,c=0;c<a.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var u=a[c];if(u&&"completed"!==u.status){t.remoteItems[u.id]={id:u.id,text:u.title,isComplete:"completed"===u.status,dateCompleted:u.completed?new Date(u.completed):void 0,isArchived:u.hidden,due:u.due?new Date(u.due):void 0,notes:u.notes,parent:u.parent||n.id,items:[]};var f=t.remoteItems[u.parent||n.id];f?f.items.push(u.id):t.unassigned.push(u.id)}}++l===s&&e(t)}else r("Invalid task list returned.")}else l++}.bind(this),r)}}.bind(this),r)},gtasksGetLists:function(e,r){try{o.default.PAssert(1676,e,"GTasks requires a success callback")}catch(t){o.default.reportError(t)}try{o.default.PAssert(1677,r,"GTasks requires an error callback")}catch(t){o.default.reportError(t)}o.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults=2000&key="+i.a.APIKey+"&access_token="+this.gtasks.token,cb:function(a){if(200===a.status)try{var n=JSON.parse(a.response);try{o.default.PAssert(1678,n&&n.items,"Must have a valid set of data to get tasks from")}catch(t){o.default.reportError(t)}n&&n.items?e(n.items):r("Error getting data from remote server.")}catch(s){r(s)}else o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+a.status),r("Error contacting remote server.")}})},gtasksGetTasks:function(e,r,t){try{o.default.PAssert(1679,e,"GTasks requires a valid list to get tasks from")}catch(a){o.default.reportError(a)}try{o.default.PAssert(1680,r,"GTasks requires a success callback")}catch(a){o.default.reportError(a)}try{o.default.PAssert(1681,t,"GTasks requires an error callback")}catch(a){o.default.reportError(a)}o.default.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+e.id+"/tasks?maxResults=2500&key="+i.a.APIKey+"&access_token="+this.gtasks.token,cb:function(n){if(200===n.status)try{var s=JSON.parse(n.response);try{o.default.PAssert(1682,s,"Must have a valid array of tasks")}catch(a){o.default.reportError(a)}s&&s.items?r(s.items,e):r([],e)}catch(l){t(l)}else o.default.shouldLog(i.a.LogLevels.Import)&&o.default.log("XHR Status: "+n.status),t("Error contacting remote server.")}})},gtasksSave:function(e,r,t){try{o.default.PAssert(1683,r,"GTasks requires a success callback")}catch(f){o.default.reportError(f)}try{o.default.PAssert(1684,t,"GTasks requires an error callback")}catch(f){o.default.reportError(f)}try{var n=0,l=function r(t,o){var n=0,s=t.text;t.due&&(s+=" @"+m(t.due));var l=a.a.createVMLI({text:s,isComplete:t.isComplete,dateCompleted:t.dateCompleted?t.dateCompleted.getTime():t.dateCompleted,isArchived:t.isArchived},{parent:o,changeType:i.a.ChangeType.AllLocal});if(o.insertItem(l),t.notes){var d=a.a.createVMLI({text:t.notes,isNote:!0},{parent:l,changeType:i.a.ChangeType.AllLocal});l.setNote(d,i.a.ChangeType.Local)}for(var c=0;c<t.items.length;++c){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r(e.remoteItems[t.items[c]],l)}};try{o.default.PAssert(1685,0===e.unassigned.length,"We should never have unassigned tasks")}catch(f){o.default.reportError(f)}s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var c=a.a.createEmptyDocument("Google Tasks import").getRootItem();try{o.default.PAssert(1686,c,"Root item must exist in order to import")}catch(f){o.default.reportError(f)}for(var u=0;u<e.roots.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;l(e.remoteItems[e.roots[u]],c)}o.default.vmMain.parseSubtree(c,i.a.ChangeType.Local|i.a.ChangeType.All),d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction(),r()}catch(h){t(void 0,h)}},trelloPreload:function(e,r){var t=this;window.Trello||this.trello.isLoading?e():(this.trello.isLoading=!0,o.default.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){o.default.addScript("https://api.trello.com/1/client.js?key=667ecf0c3d3e029c51d205b7173f6c38","trelloScript",function(){t.trello.isLoading=!1;try{o.default.PAssert(1687,window.Trello,"The Trello client lib must have been loaded correctly")}catch(i){o.default.reportError(i)}window.Trello?e():r("Error loading Trello. Please try again.")},function(e){t.trello.isLoading=!1,r(e)})},function(e){t.trello.isLoading=!1,r(e)}))},trelloLogin:function(e,r,t,i){try{o.default.PAssert(1688,window.Trello,"The Trello client lib was not properly loaded")}catch(a){o.default.reportError(a)}window.Trello?window.Trello.authorize({type:"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:t,error:i}):i("Error loading Trello. Please try again.")},trelloImport:function(e,r){var t=this,i=[];window.Trello.get("members/me/boards",o.default.wrapFn(function(o){var a=0,n=(o=o||[]).length,s=0;function l(){n===s&&e(i)}function d(e){s++,l()}for(var c=0;c<o.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=o[c];if(u.closed)n--;else{var f={text:u.name,items:[]};i.push(f),t._handleBoard(f,u.id,r,d)}}l()},r),r)},_handleBoard:function(e,r,t,i){var a=this;window.Trello.get("boards/"+r+"/lists",o.default.wrapFn(function(r){var o=0,n=0,s=r.length;function l(){n===s&&i()}function d(){n++,l()}for(var c=0;c<r.length;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=r[c];if(u.closed)s--;else{var f={text:u.name,items:[]};e.items.push(f),a._handleList(f,u.id,t,d)}}l()},t),t)},_handleList:function(e,r,t,a){var n=this;window.Trello.get("lists/"+r+"/cards",o.default.wrapFn(function(r){var o=0,s=0,l=r.length;function d(){s===l&&a()}function c(){s++,d()}for(var u=0;u<r.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var f=r[u];if(f.closed)l--;else{var h={text:f.name};if(f.labels&&f.labels.length>0){for(var p=0,m="",g=0;g<f.labels.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var v=f.labels[g];m+=i.a.TagPrefix+(v.name.length>0?v.name:v.color)+" "}h.text=m+h.text}if(f.due&&(f.date=new Date(f.due)),f.desc&&f.desc.length>0){var w=0;h.items=[];var y=f.desc.split("\n");for(g=0;g<y.length;++g){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var L=y[g];L&&L.length>0&&h.items.push({text:L})}}if(f.idChecklists&&f.idChecklists.length>0){var b=0;h.items||(h.items=[]);for(g=0;g<f.idChecklists.length;++g){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;n._handleChecklist(h,f.idChecklists[g],t,c)}}else s++;e.items.push(h)}}d()},t),t)},_handleChecklist:function(e,r,t,i){window.Trello.get("checklists/"+r+"/",o.default.wrapFn(function(r){for(var t=0,o={text:r.name,isCollapsed:!0,items:[]},a=0;a<r.checkItems.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=r.checkItems[a],s="complete"===n.state;if(!s){var l={text:n.name,isComplete:s};o.items.push(l)}}e.items.push(o),i()},t),t)},trelloSave:function(e,r,t){function n(e,r){var t=a.a.createVMLI({text:e.text,isComplete:e.isComplete,isCollapsed:e.isCollapsed},{parent:r,changeType:i.a.ChangeType.AllLocal});if(r.insertItem(t),e.items)for(var o=0,s=0;s<e.items.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n(e.items[s],t)}return t}try{var l=0;s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var c=a.a.createEmptyDocument("Trello import").getRootItem();try{o.default.PAssert(1689,c,"Root item must exist in order to import")}catch(f){o.default.reportError(f)}for(var u=0;u<e.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;n(e[u],c)}d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction()}catch(h){return t(h)}r()},todoistLogin:function(e,r,t,i){var a=this;try{o.default.PAssert(1690,t,"Todoist requires a success callback")}catch(d){o.default.reportError(d)}try{o.default.PAssert(1691,i,"Todoist requires an error callback")}catch(d){o.default.reportError(d)}var n="localhost"===window.location.hostname?"5d361221eddb4bcdb018457c7c74e698":"b701ac04f4df419ca4144ab208a9fb06",s="Dchs"+(new Date).getTime(),l="https://todoist.com/oauth/authorize?client_id="+n+"&scope=data:read&state="+s;window.open(l,"modal-todoist","height=600,width=550");window.addEventListener("message",function e(r){var n=o.default.getLocationOrigin(),l=!1;try{l=r.data.state===s}catch(c){o.default.reportError(c)}if(n&&l)if(window.removeEventListener("message",e),r.data.error)i("Error authenticating with Todoist");else{var d=r.data.code;d&&o.default.XHR_PrivateAPI({type:"POST",path:"/oauth/todoist",data:{code:d},requireAuth:!0,cb:function(e){if(200===e.status){try{var r=JSON.parse(e.response).data;a.todoist.data=r}catch(c){i("Error parsing response from remote server.",c)}a.todoist.data?t():i("Invalid username or password")}else i("Error contacting remote server.")}})}})},todoistImport:function(e,r){var t=0,i=0;try{o.default.PAssert(1692,e,"Todoist requires a success callback")}catch(f){o.default.reportError(f)}try{o.default.PAssert(1693,r,"Todoist requires an error callback")}catch(f){o.default.reportError(f)}for(var a=this.todoist.data,n={},s=0;s<a.projects.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=a.projects[s];l.is_archived||l.is_deleted||(n[l.id]={id:l.id,name:l.name,items:[],itemMap:{},parent_id:l.parent_id,item_order:l.item_order})}for(var d=[],c=0;c<a.items.length;++c){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=a.items[c];!n[u.project_id]||u.is_deleted||u.is_archived||u.checked||(!u.parent_id&&c>0&&!isNaN(u.indent)&&u.indent>1&&d[u.indent-1]&&(u.parent_id=d[u.indent-1].id),n[u.project_id].items.push(u),n[u.project_id].itemMap[u.id]=u,isNaN(u.indent)||(d[u.indent]=u))}e(n)},todoistSave:function(e,r,t){var n=[i.a.VMLIFlag.None,i.a.VMLIFlag.None,i.a.VMLIFlag.P2,i.a.VMLIFlag.P1,i.a.VMLIFlag.P0];try{s.e.beginAction(),d.default.PaneUpdateBatcher.beginUpdateItems();var l=a.a.createEmptyDocument("Todoist import").getRootItem();try{o.default.PAssert(1694,l,"Root item must exist in order to import")}catch(b){o.default.reportError(b)}var c={},u={},f=function(e,r){var t=u[e.id],o=u[r.id];return t.item_order-o.item_order},h=function e(r,t){if(!c[t.id]){var s=t.parent_id;t.parent_id&&!c[t.id]&&e(r,r.itemMap[t.parent_id]);var l=c[s||t.project_id];try{o.default.PAssert(1695,l,"parent item did not exist",s,t.project_id)}catch(b){o.default.reportError(b)}l&&function(e,r,t){r.priority&&(r.priority=n[r.priority]),r.due_date_utc&&(r.content+=" @"+m(new Date(r.due_date_utc)));var o=a.a.createVMLI({text:r.content||"",isCollapsed:!!r.collapsed,priority:r.priority},{parent:t,changeType:i.a.ChangeType.AllLocal});c[r.id]=o,u[o.id]=r,t.insertSorted(o,f)}(0,t,l)}},p=function r(t){if(!c[t.id]){var o,n=t.parent_id,s=t.id;n?(c[n]||r(e[n]),o=c[n]):o=l;var d=a.a.createVMLI({text:t.name},{parent:o,changeType:i.a.ChangeType.AllLocal});c[s]=d,u[d.id]=t,o.insertSorted(d,f)}};for(var g in e)if(e.hasOwnProperty(g)){var v=0,w=e[g],y=w.items;p(w);for(var L=0;L<y.length;L++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;h(w,y[L])}}d.default.PaneUpdateBatcher.commitUpdateItems(),s.e.endAction()}catch(A){return t(A)}r()},_createCSVEntry:function(e,r){for(var t=0,o={},i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;o[e[i]]=r[i]}return o},parseCSV:function(e){for(var r=0,t=u.a.parse(e),o=["Area","Client","Contacts","Category","Context","Created By","Date Created","Date Updated","Delegated To","Start Date","Due Date","Links","Notes","Originating Entry","Parent Entries","Priority","Short Description","Title","Star","Status","Website References"],i=[],a=t.data[0],n=0;n<a.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;o.indexOf(a[n])<0?console.log("Unknown CSV Headers: ",a[n]):i.indexOf(a[n])>=0&&i.remove(a[n])}if(0===i.length){var s=0,l=[];for(n=1;n<t.data.length;++n){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;l.push(this._createCSVEntry(a,t.data[n]))}}else var d="Missing required export fields: "+i.join(", ");if(a.indexOf("Short Descrption")<0&&a.indexOf("Title")<0)d="Missing required export fields: Short Descrption OR Title.";return l||d}},r.default=p}}]);
